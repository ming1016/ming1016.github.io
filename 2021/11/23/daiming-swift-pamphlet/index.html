<!DOCTYPE html>
<html lang="zh-Hans">
    <!-- title -->


    

<!-- keywords -->



<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="author" content="戴铭">
    <meta name="renderer" content="webkit">
    <meta name="copyright" content="戴铭">
    
        <meta name="keywords" content="戴铭,戴铭的博客,iOS,Swift,移动开发,JavaScript,编译">
    
    <meta name="description" content="前滴滴出行技术专家。极客时间《iOS开发高手课》和纸书《跟戴铭学iOS编程》作者。个人博客：戴铭的博客。微信公共号：starming-weixin。微博：@戴铭">
    <meta name="description" content="背景说明越来越多同学打算开始用 Swift 来开发了，可很多人以前都没接触过 Swift。这篇和我以前文章不同的是，本篇只是面向 Swift 零基础的同学，内容主要是一些直接可用的小例子，例子可以直接在工程中用或自己调试着看。 记得以前 PHP 有个 chm 的手册，写的很简单，但很全，每个知识点都有例子，社区版每个知识点下面还有留言互动。因此，我弄了个 Swift 的手册，是个 macOS 程序">
<meta property="og:type" content="article">
<meta property="og:title" content="戴铭的 Swift 小册子 4.0">
<meta property="og:url" content="http://ming1016.github.io/2021/11/23/daiming-swift-pamphlet/index.html">
<meta property="og:site_name" content="戴铭的博客 - 星光社">
<meta property="og:description" content="背景说明越来越多同学打算开始用 Swift 来开发了，可很多人以前都没接触过 Swift。这篇和我以前文章不同的是，本篇只是面向 Swift 零基础的同学，内容主要是一些直接可用的小例子，例子可以直接在工程中用或自己调试着看。 记得以前 PHP 有个 chm 的手册，写的很简单，但很全，每个知识点都有例子，社区版每个知识点下面还有留言互动。因此，我弄了个 Swift 的手册，是个 macOS 程序">
<meta property="og:locale">
<meta property="og:image" content="https://user-images.githubusercontent.com/251980/152918704-9522eb27-9304-4788-b4ed-72ffb170e1bc.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/251980/150132322-20c5c2d4-6452-4d06-9202-4b93cffd8133.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/251980/142977421-bed5b5ae-01fe-471f-a951-63dd4338c97a.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/251980/142988837-ab49c202-9779-4c7a-8dc2-5584900c0765.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/251980/142988879-af591aaf-161f-4f60-9891-d7b8d313f69f.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/251980/142988909-e6626954-2c93-4c34-b10e-5345c8015cea.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/251980/143826034-977a6d5e-f9f5-4ec3-90d0-f09281d64af6.png">
<meta property="article:published_time" content="2021-11-23T08:28:18.000Z">
<meta property="article:modified_time" content="2022-02-10T11:03:11.897Z">
<meta property="article:author" content="戴铭">
<meta property="article:tag" content="iOS">
<meta property="article:tag" content="Swift">
<meta property="article:tag" content="Apple">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://user-images.githubusercontent.com/251980/152918704-9522eb27-9304-4788-b4ed-72ffb170e1bc.png">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="icon" href="/assets/logo-starming.png">
    
    <title>戴铭的 Swift 小册子 4.0 · 戴铭的博客 - 星光社</title>
    <!-- /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
/* This file is meant as a standalone workflow for
- testing support for link[rel=preload]
- enabling async CSS loading in browsers that do not support rel=preload
- applying rel preload css once loaded, whether supported or not.
*/ -->
<script>
    (function (w) {
        'use strict'
        // rel=preload support test
        if (!w.loadCSS) {
            w.loadCSS = function () {}
        }
        // define on the loadCSS obj
        var rp = (loadCSS.relpreload = {})
        // rel=preload feature support test
        // runs once and returns a function for compat purposes
        rp.support = (function () {
            var ret
            try {
                ret = w.document.createElement('link').relList.supports('preload')
            } catch (e) {
                ret = false
            }
            return function () {
                return ret
            }
        })()

        // if preload isn't supported, get an asynchronous load by using a non-matching media attribute
        // then change that media back to its intended value on load
        rp.bindMediaToggle = function (link) {
            // remember existing media attr for ultimate state, or default to 'all'
            var finalMedia = link.media || 'all'

            function enableStylesheet() {
                link.media = finalMedia
            }

            // bind load handlers to enable media
            if (link.addEventListener) {
                link.addEventListener('load', enableStylesheet)
            } else if (link.attachEvent) {
                link.attachEvent('onload', enableStylesheet)
            }

            // Set rel and non-applicable media type to start an async request
            // note: timeout allows this to happen async to let rendering continue in IE
            setTimeout(function () {
                link.rel = 'stylesheet'
                link.media = 'only x'
            })
            // also enable media after 3 seconds,
            // which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
            setTimeout(enableStylesheet, 3000)
        }

        // loop through link elements in DOM
        rp.poly = function () {
            // double check this to prevent external calls from running
            if (rp.support()) {
                return
            }
            var links = w.document.getElementsByTagName('link')
            for (var i = 0; i < links.length; i++) {
                var link = links[i]
                // qualify links to those with rel=preload and as=style attrs
                if (
                    link.rel === 'preload' &&
                    link.getAttribute('as') === 'style' &&
                    !link.getAttribute('data-loadcss')
                ) {
                    // prevent rerunning on link
                    link.setAttribute('data-loadcss', true)
                    // bind listeners to toggle media back
                    rp.bindMediaToggle(link)
                }
            }
        }

        // if unsupported, run the polyfill
        if (!rp.support()) {
            // run once at least
            rp.poly()

            // rerun poly on an interval until onload
            var run = w.setInterval(rp.poly, 500)
            if (w.addEventListener) {
                w.addEventListener('load', function () {
                    rp.poly()
                    w.clearInterval(run)
                })
            } else if (w.attachEvent) {
                w.attachEvent('onload', function () {
                    rp.poly()
                    w.clearInterval(run)
                })
            }
        }

        // commonjs
        if (typeof exports !== 'undefined') {
            exports.loadCSS = loadCSS
        } else {
            w.loadCSS = loadCSS
        }
    })(typeof global !== 'undefined' ? global : this)
</script>

    <style type="text/css">
    @font-face {
        font-family: 'Oswald-Regular';
        src: url("/font/Oswald-Regular.ttf");
    }

    body {
        margin: 0;
    }

    header,
    footer,
    .back-top,
    .sidebar,
    .container,
    .site-intro-meta,
    .toc-wrapper {
        display: none;
    }

    .site-intro {
        position: relative;
        z-index: 3;
        width: 100%;
        /* height: 50vh; */
        overflow: hidden;
    }

    .site-intro-placeholder {
        position: absolute;
        z-index: -2;
        top: 0;
        left: 0;
        width: calc(100% + 300px);
        height: 100%;
        background: repeating-linear-gradient(-45deg, #444 0, #444 80px, #333 80px, #333 160px);
        background-position: center center;
        transform: translate3d(-226px, 0, 0);
        animation: gradient-move 2.5s ease-out 0s infinite;
    }

    @keyframes gradient-move {
        0% {
            transform: translate3d(-226px, 0, 0);
        }
        100% {
            transform: translate3d(0, 0, 0);
        }
    }
</style>

    <link rel="preload" href="/css/style.css?v=20210823" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="/css/dark.css?v=20210823" as="style">
    <link rel="stylesheet" href="/css/dark.css" media="(prefers-color-scheme: dark)">
    <link rel="stylesheet" href="/css/mobile.css?v=20210823" media="(max-width: 960px)">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" as="script">
    <link rel="preload" href="/scripts/main.js?v=20210823" as="script">
    <link rel="preload" href="/scripts/dark.js?v=20210823" as="script">
    <link rel="preload" href="/font/Oswald-Regular.ttf" as="font" crossorigin>
    <link rel="preload" href="https://at.alicdn.com/t/font_327081_1dta1rlogw17zaor.woff" as="font" crossorigin>
    <!-- algolia -->
    
    <!-- 百度统计  -->
    
    <!-- 谷歌统计  -->
    
<meta name="generator" content="Hexo 5.4.0"></head>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script type="text/javascript">
        if (typeof window.$ == undefined) {
            console.warn('jquery load from jsdelivr failed, will load local script')
            document.write('<script src="/lib/jquery.min.js" />')
        }
    </script>
    
        <body class="post-body">
    
        <!-- header -->
        <header class="header header-mobile">
    <!-- top read progress line -->
    <div class="header-element">
        <div class="read-progress"></div>
    </div>
    <!-- sidebar menu button -->
    <div class="header-element">
        
            <div class="header-sidebar-menu">
        
            
                <div style="padding-left: 1px;">&#xe775;</div>
            
        </div>
    </div>
    <!-- header actions -->
    <div class="header-actions">
        <!-- theme mode switch button -->
        <span class="header-theme-btn header-element">
            <i class="fas fa-adjust"></i>
        </span>
        <!-- back to home page text -->
        <span class="home-link header-element">
            <a href=/>戴铭的博客 - 星光社</a>
        </span>
    </div>
    <!-- toggle banner for post layout -->
    
        
            <div class="banner">
        
            <div class="blog-title header-element">
                <a href="/">戴铭的博客 - 星光社</a>
            </div>
            <div class="post-title header-element">
                <a href="#" class="post-name">戴铭的 Swift 小册子 4.0</a>
            </div>
        </div>
    
</header>

        <!-- fixed footer -->
        <footer class="footer-fixed">
    <!-- back to top button -->
    <div class="footer-fixed-element">
        
            <div class="back-top back-top-hidden">
        
        
            <div>&#xe639;</div>
        
        </div>
    </div>
</footer>

        <!-- wrapper -->
        <div class="wrapper">
            <div class="site-intro" style="







    height:50vh;

">
    
    <!-- 主页  -->
    
        
    <!-- 404页  -->
            
    <div class="site-intro-placeholder"></div>
    <div class="site-intro-img" style="background-image: url(/intro/post-bg-starming.jpg)"></div>
    <div class="site-intro-meta">
        <!-- 标题  -->
        <h1 class="intro-title">
            <!-- 主页  -->
            
                戴铭的 Swift 小册子 4.0
            <!-- 404 -->
            
        </h1>
        <!-- 副标题 -->
        <p class="intro-subtitle">
            <!-- 主页副标题  -->
            
                
            <!-- 404 -->
            
        </p>
        <!-- 文章页 meta -->
        
            <div class="post-intros">
                <!-- 文章页标签  -->
                
                    <div class= post-intro-tags >
    
        
        
            
        
        
        <span class="post-category" data-categories="Programming"">
            <i class="fas fa-folder post-category-icon"></i>
            <span class="post-category-text">
                Programming
            </span>
        </span>
    
    
        <a class="post-tag" href="javascript:void(0);" data-tags="iOS">iOS</a>
    
        <a class="post-tag" href="javascript:void(0);" data-tags="Swift">Swift</a>
    
        <a class="post-tag" href="javascript:void(0);" data-tags="Apple">Apple</a>
    
</div>

                
                
                    <div class="post-intro-read">
                        <span>字数统计: <span class="post-count word-count">23.2k</span>阅读时长: <span class="post-count reading-time">111 min</span></span>
                    </div>
                
                <div class="post-intro-meta">
                    <!-- 撰写日期 -->
                    <span class="iconfont-archer post-intro-calander">&#xe676;</span>
                    <span class="post-intro-time">2021/11/23</span>
                    <!-- busuanzi -->
                    
                        <span id="busuanzi_container_page_pv" class="busuanzi-pv">
                            <span class="iconfont-archer post-intro-busuanzi">&#xe602;</span>
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    
                    <!-- 文章分享 -->
                    <span class="share-wrapper">
                        <span class="iconfont-archer share-icon">&#xe71d;</span>
                        <span class="share-text">Share</span>
                        <ul class="share-list">
                            <li class="iconfont-archer share-qr" data-type="qr">&#xe75b;
                                <div class="share-qrcode"></div>
                            </li>
                            <li class="iconfont-archer" data-type="weibo">&#xe619;</li>
                            <li class="iconfont-archer" data-type="qzone">&#xe62e;</li>
                            <li class="iconfont-archer" data-type="twitter">&#xe634;</li>
                            <li class="iconfont-archer" data-type="facebook">&#xe67a;</li>
                        </ul>
                    </span>
                </div>
            </div>
        
    </div>
</div>

            <script>
  // get user agent
  function getBrowserVersions() {
    var u = window.navigator.userAgent
    return {
      userAgent: u,
      trident: u.indexOf('Trident') > -1, //IE内核
      presto: u.indexOf('Presto') > -1, //opera内核
      webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
      gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
      mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
      ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
      android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
      iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //是否为iPhone或者安卓QQ浏览器
      iPad: u.indexOf('iPad') > -1, //是否为iPad
      webApp: u.indexOf('Safari') == -1, //是否为web应用程序，没有头部与底部
      weixin: u.indexOf('MicroMessenger') == -1, //是否为微信浏览器
      uc: u.indexOf('UCBrowser') > -1, //是否为android下的UC浏览器
    }
  }
  var browser = {
    versions: getBrowserVersions(),
  }
  console.log('userAgent: ' + browser.versions.userAgent)

  // callback
  function fontLoaded() {
    console.log('font loaded')
    if (document.getElementsByClassName('site-intro-meta')) {
      document
        .getElementsByClassName('intro-title')[0]
        .classList.add('intro-fade-in')
      document
        .getElementsByClassName('intro-subtitle')[0]
        .classList.add('intro-fade-in')
      var postIntros = document.getElementsByClassName('post-intros')[0]
      if (postIntros) {
        postIntros.classList.add('post-fade-in')
      }
    }
  }

  // UC不支持跨域，所以直接显示
  function asyncCb() {
    if (browser.versions.uc) {
      console.log('UCBrowser')
      fontLoaded()
    } else {
      WebFont.load({
        custom: {
          families: ['Oswald-Regular'],
        },
        loading: function () {
          // 所有字体开始加载
          // console.log('font loading');
        },
        active: function () {
          // 所有字体已渲染
          fontLoaded()
        },
        inactive: function () {
          // 字体预加载失败，无效字体或浏览器不支持加载
          console.log('inactive: timeout')
          fontLoaded()
        },
        timeout: 5000, // Set the timeout to two seconds
      })
    }
  }

  function asyncErr() {
    console.warn('script load from CDN failed, will load local script')
  }

  // load webfont-loader async, and add callback function
  function async(u, cb, err) {
    var d = document,
      t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0]
    o.src = u
    if (cb) {
      o.addEventListener(
        'load',
        function (e) {
          cb(null, e)
        },
        false
      )
    }
    if (err) {
      o.addEventListener(
        'error',
        function (e) {
          err(null, e)
        },
        false
      )
    }
    s.parentNode.insertBefore(o, s)
  }

  var asyncLoadWithFallBack = function (arr, success, reject) {
    var currReject = function () {
      reject()
      arr.shift()
      if (arr.length) async(arr[0], success, currReject)
    }

    async(arr[0], success, currReject)
  }

  asyncLoadWithFallBack(
    [
      'https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js',
      'https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js',
      "/lib/webfontloader.min.js",
    ],
    asyncCb,
    asyncErr
  )
</script>

            <img class="loading" src="/assets/loading.svg" style="display: block; margin: 6rem auto 0 auto; width: 6rem; height: 6rem;" />
            <div class="container container-unloaded">
                <main class="main post-page">
    <article class="article-entry">
        <h2 id="背景说明"><a href="#背景说明" class="headerlink" title="背景说明"></a>背景说明</h2><p>越来越多同学打算开始用 Swift 来开发了，可很多人以前都没接触过 Swift。这篇和我以前文章不同的是，本篇只是面向 Swift 零基础的同学，内容主要是一些直接可用的小例子，例子可以直接在工程中用或自己调试着看。</p>
<p>记得以前 PHP 有个 chm 的手册，写的很简单，但很全，每个知识点都有例子，社区版每个知识点下面还有留言互动。因此，我弄了个 Swift 的手册，是个 macOS 程序。建议使用我开发的这个 macOS 程序来浏览。源码地址：<a target="_blank" rel="noopener" href="https://github.com/KwaiAppTeam/SwiftPamphletApp">KwaiAppTeam/SwiftPamphletApp</a>，直接下载 dmg 地址：<a target="_blank" rel="noopener" href="https://github.com/KwaiAppTeam/SwiftPamphletApp/files/8040117/Swift.4.1.dmg.zip">戴铭的Swift小册子4.1.dmg.zip</a></p>
<p><img src="https://user-images.githubusercontent.com/251980/152918704-9522eb27-9304-4788-b4ed-72ffb170e1bc.png" alt=""></p>
<p>这个程序是Swift写的，按照声明式UI，响应式编程范式开发的，源码也可以看看。与其讲一堆，不如调着试。</p>
<p>下面是文本内容。注：代码中简化变量名是为了能更快速关注到语言用法。</p>
<h2 id="语法速查"><a href="#语法速查" class="headerlink" title="语法速查"></a>语法速查</h2><h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><h4 id="变量-let-var"><a href="#变量-let-var" class="headerlink" title="变量 let, var"></a>变量 let, var</h4><p>变量是可变的，使用 var 修饰，常量是不可变的，使用 let 修饰。类、结构体和枚举里的变量是属性。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> v1:<span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;hi&quot;</span> <span class="comment">// 标注类型</span></span><br><span class="line"><span class="keyword">var</span> v2 <span class="operator">=</span> <span class="string">&quot;类型推导&quot;</span></span><br><span class="line"><span class="keyword">let</span> l1 <span class="operator">=</span> <span class="string">&quot;标题&quot;</span> <span class="comment">// 常量</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">a</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> p1 <span class="operator">=</span> <span class="number">3</span></span><br><span class="line">    <span class="keyword">var</span> p2: <span class="type">Int</span> &#123;</span><br><span class="line">        p1 <span class="operator">*</span> <span class="number">3</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>属性没有 set 可以省略 get，如果有 set 需加 get。变量设置前通过 willSet 访问到，变量设置后通过 didSet 访问。</p>
<h4 id="打印-print-“”"><a href="#打印-print-“”" class="headerlink" title="打印 print(“”)"></a>打印 print(“”)</h4><p>控制台打印值</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;hi&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> i <span class="operator">=</span> <span class="number">14</span></span><br><span class="line"><span class="built_in">print</span>(i)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;9月<span class="subst">\(i)</span>是小柠檬的生日&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span><span class="operator">...</span><span class="number">3</span>&#123;</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// output:</span></span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用terminator使循环打印更整洁</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span><span class="operator">...</span><span class="number">3</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(i)</span> &quot;</span>, terminator: <span class="string">&quot;&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// output:</span></span><br><span class="line"><span class="comment">// 1 2 3</span></span><br></pre></td></tr></table></figure>
<h4 id="注释"><a href="#注释" class="headerlink" title="注释 //"></a>注释 //</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 单行注释</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">多行注释第一行。</span></span><br><span class="line"><span class="comment">多行注释第二行。</span></span><br><span class="line"><span class="comment">*/</span> </span><br><span class="line"><span class="comment">// MARK: 会在 minimap 上展示</span></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 待做</span></span><br><span class="line"><span class="comment">// <span class="doctag">FIXME:</span> 待修复</span></span><br></pre></td></tr></table></figure>
<h4 id="可选"><a href="#可选" class="headerlink" title="可选 ?, !"></a>可选 ?, !</h4><p>可能会是 nil 的变量就是可选变量。当变量为 nil 通过??操作符可以提供一个默认值。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> o: <span class="type">Int</span>? <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"><span class="keyword">let</span> i <span class="operator">=</span> o <span class="operator">??</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>
<h4 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h4><p>闭包也可以叫做 lambda，是匿名函数，对应 OC 的 block。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a1 <span class="operator">=</span> [<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>].sorted(by: &#123; (l: <span class="type">Int</span>, r: <span class="type">Int</span>) -&gt; <span class="type">Bool</span> <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">return</span> l <span class="operator">&lt;</span> r</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 如果闭包是唯一的参数并在表达式最后可以使用结尾闭包语法，写法简化为</span></span><br><span class="line"><span class="keyword">let</span> a2 <span class="operator">=</span> [<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>].sorted &#123; (l: <span class="type">Int</span>, r: <span class="type">Int</span>) -&gt; <span class="type">Bool</span> <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">return</span> l <span class="operator">&lt;</span> r</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 已知类型可以省略</span></span><br><span class="line"><span class="keyword">let</span> a3 <span class="operator">=</span> [<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>].sorted &#123; l, r <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">return</span> l <span class="operator">&lt;</span> r</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 通过位置来使用闭包的参数，最后简化如下：</span></span><br><span class="line"><span class="keyword">let</span> a4 <span class="operator">=</span> [<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>].sorted &#123; <span class="variable">$0</span> <span class="operator">&lt;</span> <span class="variable">$1</span> &#125;</span><br></pre></td></tr></table></figure>
<p>函数也是闭包的一种，函数的参数也可以是闭包。@escaping 表示逃逸闭包，逃逸闭包是可以在函数返回之后继续调用的。@autoclosure 表示自动闭包，可以用来省略花括号。</p>
<h4 id="函数-func"><a href="#函数-func" class="headerlink" title="函数 func"></a>函数 func</h4><p>函数可以作为另一个函数的参数，也可以作为另一个函数的返回。函数是特殊的闭包，在类、结构体和枚举中是方法。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 为参数设置默认值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span>(<span class="params">p</span>: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;p&quot;</span>)</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="string">&quot;p is <span class="subst">\(p)</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数作为参数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f2</span>(<span class="params">fn</span>: (<span class="type">String</span>) -&gt; <span class="type">String</span>, <span class="params">p</span>: <span class="type">String</span>)</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fn(p)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(f2(fn:f1, p: <span class="string">&quot;d&quot;</span>)) <span class="comment">// p is d</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数作为返回值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f3</span>(<span class="params">p</span>: <span class="type">String</span>)</span> -&gt; (<span class="type">String</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> f1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(f3(p: <span class="string">&quot;yes&quot;</span>)(<span class="string">&quot;no&quot;</span>)) <span class="comment">// p is no</span></span><br></pre></td></tr></table></figure>
<p>函数可以返回多个值，函数是可以嵌套的，也就是函数里内可以定义函数，函数内定义的函数可以访问自己作用域外函数内的变量。inout 表示的是输入输出参数，函数可以在函数内改变输入输出参数。defer 标识的代码块会在函数返回之前执行。</p>
<p>函数在 Swift 5.4 时开始有了使用多个变量参数的能力，使用方法如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f4</span>(<span class="params">s</span>: <span class="type">String</span>..., <span class="params">i</span>: <span class="type">Int</span>...)</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(s)</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f4(s: <span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>, <span class="string">&quot;three&quot;</span>, i: <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="comment">/// [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]</span></span><br><span class="line"><span class="comment">/// [1, 2, 3]</span></span><br></pre></td></tr></table></figure>
<p>嵌套函数可以重载，嵌套函数可以在声明函数之前调用他。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f5</span>()</span> &#123;</span><br><span class="line">    nf5()</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">nf5</span>()</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;this is nested function&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">f5() <span class="comment">// this is nested function</span></span><br></pre></td></tr></table></figure>
<h4 id="访问控制"><a href="#访问控制" class="headerlink" title="访问控制"></a>访问控制</h4><p>在 Xcode 里的 target 就是模块，使用 import 可导入模块。模块内包含源文件，每个源文件里可以有多个类、结构体、枚举和函数等多种类型。访问级别可以通过一些关键字描述，分为如下几种：</p>
<ul>
<li>open：在模块外可以调用和继承。</li>
<li>public：在模块外可调用不可继承，open 只适用类和类成员。</li>
<li>internal：默认级别，模块内可跨源文件调用，模块外不可调用。</li>
<li>fileprivate：只能在源文件内访问。</li>
<li>private：只能在所在的作用域内访问。</li>
</ul>
<p>重写继承类的成员，可以设置成员比父类的这个成员更高的访问级别。Setter 的级别可以低于对应的 Getter 的级别，比如设置 Setter 访问级别为 private，可以在属性使用 private(set) 来修饰。</p>
<h3 id="基础类型"><a href="#基础类型" class="headerlink" title="基础类型"></a>基础类型</h3><h4 id="数字-Int-Float"><a href="#数字-Int-Float" class="headerlink" title="数字 Int, Float"></a>数字 Int, Float</h4><p>数字的类型有 Int、Float 和 Double</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Int</span></span><br><span class="line"><span class="keyword">let</span> i1 <span class="operator">=</span> <span class="number">100</span></span><br><span class="line"><span class="keyword">let</span> i2 <span class="operator">=</span> <span class="number">22</span></span><br><span class="line"><span class="built_in">print</span>(i1 <span class="operator">/</span> i2) <span class="comment">// 向下取整得 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Float</span></span><br><span class="line"><span class="keyword">let</span> f1: <span class="type">Float</span> <span class="operator">=</span> <span class="number">100.0</span></span><br><span class="line"><span class="keyword">let</span> f2: <span class="type">Float</span> <span class="operator">=</span> <span class="number">22.0</span></span><br><span class="line"><span class="built_in">print</span>(f1 <span class="operator">/</span> f2) <span class="comment">// 4.5454545</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> f3: <span class="type">Float16</span> <span class="operator">=</span> <span class="number">5.0</span> <span class="comment">// macOS 还不能用</span></span><br><span class="line"><span class="keyword">let</span> f4: <span class="type">Float32</span> <span class="operator">=</span> <span class="number">5.0</span></span><br><span class="line"><span class="keyword">let</span> f5: <span class="type">Float64</span> <span class="operator">=</span> <span class="number">5.0</span></span><br><span class="line"><span class="keyword">let</span> f6: <span class="type">Float80</span> <span class="operator">=</span> <span class="number">5.0</span></span><br><span class="line"><span class="built_in">print</span>(f4, f5, f6) <span class="comment">// 5.0 5.0 5.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Double</span></span><br><span class="line"><span class="keyword">let</span> d1: <span class="type">Double</span> <span class="operator">=</span> <span class="number">100.0</span></span><br><span class="line"><span class="keyword">let</span> d2: <span class="type">Double</span> <span class="operator">=</span> <span class="number">22.0</span></span><br><span class="line"><span class="built_in">print</span>(d1 <span class="operator">/</span> d2) <span class="comment">// 4.545454545454546</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 字面量</span></span><br><span class="line"><span class="built_in">print</span>(<span class="type">Int</span>(<span class="number">0b10101</span>)) <span class="comment">// 0b 开头是二进制 </span></span><br><span class="line"><span class="built_in">print</span>(<span class="type">Int</span>(<span class="number">0x00afff</span>)) <span class="comment">// 0x 开头是十六进制</span></span><br><span class="line"><span class="built_in">print</span>(<span class="number">2.5e4</span>) <span class="comment">// 2.5x10^4 十进制用 e</span></span><br><span class="line"><span class="built_in">print</span>(<span class="number">0xAp2</span>) <span class="comment">// 10*2^2  十六进制用 p</span></span><br><span class="line"><span class="built_in">print</span>(<span class="number">2_000_000</span>) <span class="comment">// 2000000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// isMultiple(of:) 方法检查一个数字是否是另一个数字的倍数</span></span><br><span class="line"><span class="keyword">let</span> i3 <span class="operator">=</span> <span class="number">36</span></span><br><span class="line"><span class="built_in">print</span>(i3.isMultiple(of: <span class="number">9</span>)) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>处理数字有 floor、ceil、round。floor 是向下取整，只取整数部分；cell 是向上取整，只要有不为零的小数，整数就加1;round 是四舍五入。       </p>
<h4 id="布尔数-Bool"><a href="#布尔数-Bool" class="headerlink" title="布尔数 Bool"></a>布尔数 Bool</h4><p>布尔数有 true 和 false 两种值，还有一个能够切换这两个值的 toggle 方法。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> b <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">b.toggle() <span class="comment">// true</span></span><br><span class="line">b.toggle() <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h4 id="元组-a-b-c"><a href="#元组-a-b-c" class="headerlink" title="元组 (a, b, c)"></a>元组 (a, b, c)</h4><p>元组里的值类型可以是不同的。元组可以看成是匿名的结构体。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> t1 <span class="operator">=</span> (p1: <span class="number">1</span>, p2: <span class="string">&quot;two&quot;</span>, p3: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line"><span class="built_in">print</span>(t1.p1)</span><br><span class="line"><span class="built_in">print</span>(t1.p3)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类型推导</span></span><br><span class="line"><span class="keyword">let</span> t2 <span class="operator">=</span> (<span class="number">1</span>, <span class="string">&quot;two&quot;</span>, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过下标访问</span></span><br><span class="line"><span class="built_in">print</span>(t2.<span class="number">1</span>) <span class="comment">// two</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 分解元组</span></span><br><span class="line"><span class="keyword">let</span> (dp1, dp2, <span class="keyword">_</span>) <span class="operator">=</span> t2</span><br><span class="line"><span class="built_in">print</span>(dp1)</span><br><span class="line"><span class="built_in">print</span>(dp2)</span><br></pre></td></tr></table></figure>
<h4 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s1 <span class="operator">=</span> <span class="string">&quot;Hi! This is a string. Cool?&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/// 转义符 \n 表示换行。</span></span><br><span class="line"><span class="comment">/// 其它转义字符有 \0 空字符)、\t 水平制表符 、\n 换行符、\r 回车符</span></span><br><span class="line"><span class="keyword">let</span> s2 <span class="operator">=</span> <span class="string">&quot;Hi!<span class="subst">\n</span>This is a string. Cool?&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 多行</span></span><br><span class="line"><span class="keyword">let</span> s3 <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Hi!</span></span><br><span class="line"><span class="string">This is a string.</span></span><br><span class="line"><span class="string">Cool?</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 长度</span></span><br><span class="line"><span class="built_in">print</span>(s3.count)</span><br><span class="line"><span class="built_in">print</span>(s3.isEmpty)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 拼接</span></span><br><span class="line"><span class="built_in">print</span>(s3 <span class="operator">+</span> <span class="string">&quot;<span class="subst">\n</span>Sure!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 字符串中插入变量</span></span><br><span class="line"><span class="keyword">let</span> i <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Today is good day, double <span class="subst">\(i)</span><span class="subst">\(i)</span>!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 遍历字符串</span></span><br><span class="line"><span class="comment">/// 输出：</span></span><br><span class="line"><span class="comment">/// o</span></span><br><span class="line"><span class="comment">/// n</span></span><br><span class="line"><span class="comment">/// e</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> <span class="string">&quot;one&quot;</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(c)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查找</span></span><br><span class="line"><span class="built_in">print</span>(s3.lowercased().contains(<span class="string">&quot;cool&quot;</span>)) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 替换</span></span><br><span class="line"><span class="keyword">let</span> s4 <span class="operator">=</span> <span class="string">&quot;one is two&quot;</span></span><br><span class="line"><span class="keyword">let</span> newS4 <span class="operator">=</span> s4.replacingOccurrences(of: <span class="string">&quot;two&quot;</span>, with: <span class="string">&quot;one&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(newS4)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除空格和换行</span></span><br><span class="line"><span class="keyword">let</span> s5 <span class="operator">=</span> <span class="string">&quot; Simple line. <span class="subst">\n</span><span class="subst">\n</span>  &quot;</span></span><br><span class="line"><span class="built_in">print</span>(s5.trimmingCharacters(in: .whitespacesAndNewlines))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 切割成数组</span></span><br><span class="line"><span class="keyword">let</span> s6 <span class="operator">=</span> <span class="string">&quot;one/two/three&quot;</span></span><br><span class="line"><span class="keyword">let</span> a1 <span class="operator">=</span> s6.components(separatedBy: <span class="string">&quot;/&quot;</span>) <span class="comment">// 继承自 NSString 的接口</span></span><br><span class="line"><span class="built_in">print</span>(a1) <span class="comment">// [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a2 <span class="operator">=</span> s6.split(separator: <span class="string">&quot;/&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(a2) <span class="comment">// [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;] 属于切片，性能较 components 更好</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断是否是某种类型</span></span><br><span class="line"><span class="keyword">let</span> c1: <span class="type">Character</span> <span class="operator">=</span> <span class="string">&quot;🤔&quot;</span></span><br><span class="line"><span class="built_in">print</span>(c1.isASCII) <span class="comment">// false</span></span><br><span class="line"><span class="built_in">print</span>(c1.isSymbol) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">print</span>(c1.isLetter) <span class="comment">// false</span></span><br><span class="line"><span class="built_in">print</span>(c1.isNumber) <span class="comment">// false</span></span><br><span class="line"><span class="built_in">print</span>(c1.isUppercase) <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 字符串和 Data 互转</span></span><br><span class="line"><span class="keyword">let</span> data <span class="operator">=</span> <span class="type">Data</span>(<span class="string">&quot;hi&quot;</span>.utf8)</span><br><span class="line"><span class="keyword">let</span> s7 <span class="operator">=</span> <span class="type">String</span>(decoding: data, as: <span class="type">UTF8</span>.<span class="keyword">self</span>)</span><br><span class="line"><span class="built_in">print</span>(s7) <span class="comment">// hi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 字符串可以当作集合来用。</span></span><br><span class="line"><span class="keyword">let</span> revered <span class="operator">=</span> s7.reversed()</span><br><span class="line"><span class="built_in">print</span>(<span class="type">String</span>(revered))</span><br></pre></td></tr></table></figure>
<p>Unicode、Character 和 SubString 等内容参见官方字符串文档：<a target="_blank" rel="noopener" href="https://docs.swift.org/swift-book/LanguageGuide/StringsAndCharacters.html">Strings and Characters — The Swift Programming Language (Swift 5.1)</a></p>
<p>字符串字面符号可以参看《<a target="_blank" rel="noopener" href="https://www.swiftbysundell.com/articles/string-literals-in-swift/">String literals in Swift</a>》。</p>
<p>原始字符串<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 原始字符串在字符串前加上一个或多个#符号。里面的双引号和转义符号将不再起作用了，如果想让转义符起作用，需要在转义符后面加上#符号。</span></span><br><span class="line"><span class="keyword">let</span> s8 <span class="operator">=</span> <span class="string">#&quot;\(s7)<span class="subst">\#(s7)</span> &quot;one&quot; and &quot;two&quot;\n. <span class="subst">\#n</span>The second line.&quot;#</span></span><br><span class="line"><span class="built_in">print</span>(s8)</span><br><span class="line"><span class="comment">/// \(s7)hi &quot;one&quot; and &quot;two&quot;\n.</span></span><br><span class="line"><span class="comment">/// The second line.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 原始字符串在正则使用效果更佳，反斜杠更少了。</span></span><br><span class="line"><span class="keyword">let</span> s9 <span class="operator">=</span> <span class="string">&quot;<span class="subst">\\</span><span class="subst">\\</span>[A-Z]+[A-Za-z]+<span class="subst">\\</span>.[a-z]+&quot;</span></span><br><span class="line"><span class="keyword">let</span> s10 <span class="operator">=</span> <span class="string">#&quot;\\[A-Z]+[A-Za-z]+\.[a-z]+&quot;#</span></span><br><span class="line"><span class="built_in">print</span>(s9) <span class="comment">// \\[A-Z]+[A-Za-z]+\.[a-z]+</span></span><br><span class="line"><span class="built_in">print</span>(s10) <span class="comment">// \\[A-Z]+[A-Za-z]+\.[a-z]+</span></span><br></pre></td></tr></table></figure></p>
<h4 id="枚举"><a href="#枚举" class="headerlink" title="枚举"></a>枚举</h4><p>Swift的枚举有类的一些特性，比如计算属性、实例方法、扩展、遵循协议等等。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">E1</span>:<span class="title">String</span>, <span class="title">CaseIterable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> e1, e2 <span class="operator">=</span> <span class="string">&quot;12&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关联值</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">E2</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> e1([<span class="type">String</span>])</span><br><span class="line">    <span class="keyword">case</span> e2(<span class="type">Int</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> e1 <span class="operator">=</span> <span class="type">E2</span>.e1([<span class="string">&quot;one&quot;</span>,<span class="string">&quot;two&quot;</span>])</span><br><span class="line"><span class="keyword">let</span> e2 <span class="operator">=</span> <span class="type">E2</span>.e2(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> e1 &#123;</span><br><span class="line"><span class="keyword">case</span> .e1(<span class="keyword">let</span> array):</span><br><span class="line">    <span class="built_in">print</span>(array)</span><br><span class="line"><span class="keyword">case</span> .e2(<span class="keyword">let</span> int):</span><br><span class="line">    <span class="built_in">print</span>(int)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(e2)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 原始值</span></span><br><span class="line"><span class="built_in">print</span>(<span class="type">E1</span>.e1.rawValue)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遵循 CaseIterable 协议可迭代</span></span><br><span class="line"><span class="keyword">for</span> ie <span class="keyword">in</span> <span class="type">E1</span>.allCases &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;show <span class="subst">\(ie)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 递归枚举</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">RE</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> v(<span class="type">String</span>)</span><br><span class="line">    <span class="keyword">indirect</span> <span class="keyword">case</span> node(l:<span class="type">RE</span>, r:<span class="type">RE</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> lNode <span class="operator">=</span> <span class="type">RE</span>.v(<span class="string">&quot;left&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> rNode <span class="operator">=</span> <span class="type">RE</span>.v(<span class="string">&quot;right&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> pNode <span class="operator">=</span> <span class="type">RE</span>.node(l: lNode, r: rNode)</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> pNode &#123;</span><br><span class="line"><span class="keyword">case</span> .v(<span class="keyword">let</span> string):</span><br><span class="line">    <span class="built_in">print</span>(string)</span><br><span class="line"><span class="keyword">case</span> .node(<span class="keyword">let</span> l, <span class="keyword">let</span> r):</span><br><span class="line">    <span class="built_in">print</span>(l,r)</span><br><span class="line">    <span class="keyword">switch</span> l &#123;</span><br><span class="line">    <span class="keyword">case</span> .v(<span class="keyword">let</span> string):</span><br><span class="line">        <span class="built_in">print</span>(string)</span><br><span class="line">    <span class="keyword">case</span> .node(<span class="keyword">let</span> l, <span class="keyword">let</span> r):</span><br><span class="line">        <span class="built_in">print</span>(l, r)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">switch</span> r &#123;</span><br><span class="line">    <span class="keyword">case</span> .v(<span class="keyword">let</span> string):</span><br><span class="line">        <span class="built_in">print</span>(string)</span><br><span class="line">    <span class="keyword">case</span> .node(<span class="keyword">let</span> l, <span class="keyword">let</span> r):</span><br><span class="line">        <span class="built_in">print</span>(l, r)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>@unknown 用来区分固定的枚举和可能改变的枚举的能力。@unknown 用于防止未来新增枚举属性会进行提醒提示完善每个 case 的处理。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @unknown</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">E3</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> e1, e2, e3</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fe1</span>(<span class="params">e</span>: <span class="type">E3</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> e &#123;</span><br><span class="line">    <span class="keyword">case</span> .e1:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;e1 ok&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> .e2:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;e2 ok&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> .e3:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;e3 ok&quot;</span>)</span><br><span class="line">    <span class="keyword">@unknown</span> <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;not ok&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>符合 Comparable 协议的枚举可以进行比较。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Comparable 枚举比较</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">E4</span>: <span class="title">Comparable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> e1, e2</span><br><span class="line">    <span class="keyword">case</span> e3(i: <span class="type">Int</span>)</span><br><span class="line">    <span class="keyword">case</span> e4</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> e3 <span class="operator">=</span> <span class="type">E4</span>.e4</span><br><span class="line"><span class="keyword">let</span> e4 <span class="operator">=</span> <span class="type">E4</span>.e3(i: <span class="number">3</span>)</span><br><span class="line"><span class="keyword">let</span> e5 <span class="operator">=</span> <span class="type">E4</span>.e3(i: <span class="number">2</span>)</span><br><span class="line"><span class="keyword">let</span> e6 <span class="operator">=</span> <span class="type">E4</span>.e1</span><br><span class="line"><span class="built_in">print</span>(e3 <span class="operator">&gt;</span> e4) <span class="comment">// true</span></span><br><span class="line"><span class="keyword">let</span> a1 <span class="operator">=</span> [e3, e4, e5, e6]</span><br><span class="line"><span class="keyword">let</span> a2 <span class="operator">=</span> a1.sorted()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a2 &#123;</span><br><span class="line">    <span class="built_in">print</span>(i.<span class="keyword">self</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/// e1</span></span><br><span class="line"><span class="comment">/// e3(i: 2)</span></span><br><span class="line"><span class="comment">/// e3(i: 3)</span></span><br><span class="line"><span class="comment">/// e4</span></span><br></pre></td></tr></table></figure>
<h4 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h4><p>泛型可以减少重复代码，是一种抽象的表达方式。where 关键字可以对泛型做约束。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fn</span>&lt;<span class="type">T</span>&gt;(<span class="params">p</span>: <span class="type">T</span>)</span> -&gt; [<span class="type">T</span>] &#123;</span><br><span class="line">    <span class="keyword">var</span> r <span class="operator">=</span> [<span class="type">T</span>]()</span><br><span class="line">    r.append(p)</span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(fn(p: <span class="string">&quot;one&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结构体</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S1</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> arr <span class="operator">=</span> [<span class="type">T</span>]()</span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">add</span>(<span class="keyword">_</span> <span class="params">p</span>: <span class="type">T</span>)</span> &#123;</span><br><span class="line">        arr.append(p)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> s1 <span class="operator">=</span> <span class="type">S1</span>(arr: [<span class="string">&quot;zero&quot;</span>])</span><br><span class="line">s1.add(<span class="string">&quot;one&quot;</span>)</span><br><span class="line">s1.add(<span class="string">&quot;two&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(s1.arr) <span class="comment">// [&quot;zero&quot;, &quot;one&quot;, &quot;two&quot;]</span></span><br></pre></td></tr></table></figure>
<p>关联类型</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">pc</span> </span>&#123;</span><br><span class="line">    <span class="keyword">associatedtype</span> <span class="type">T</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">add</span>(<span class="keyword">_</span> <span class="params">p</span>: <span class="type">T</span>)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S2</span>: <span class="title">pc</span> </span>&#123;</span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">T</span> <span class="operator">=</span> <span class="type">String</span> <span class="comment">// 类型推导，可省略</span></span><br><span class="line">    <span class="keyword">var</span> strs <span class="operator">=</span> [<span class="type">String</span>]()</span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">add</span>(<span class="keyword">_</span> <span class="params">p</span>: <span class="type">String</span>)</span> &#123;</span><br><span class="line">        strs.append(p)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>泛型适用于嵌套类型<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S3</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">S4</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> p: <span class="type">T</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> p1: <span class="type">T</span></span><br><span class="line">    <span class="keyword">var</span> p2: <span class="type">S4</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> s2 <span class="operator">=</span> <span class="type">S3</span>(p1: <span class="number">1</span>, p2: <span class="type">S3</span>.<span class="type">S4</span>(p: <span class="number">3</span>))</span><br><span class="line"><span class="keyword">let</span> s3 <span class="operator">=</span> <span class="type">S3</span>(p1: <span class="string">&quot;one&quot;</span>, p2: <span class="type">S3</span>.<span class="type">S4</span>(p: <span class="string">&quot;three&quot;</span>))</span><br><span class="line"><span class="built_in">print</span>(s2,s3)</span><br></pre></td></tr></table></figure></p>
<h4 id="不透明类型"><a href="#不透明类型" class="headerlink" title="不透明类型"></a>不透明类型</h4><p>不透明类型会隐藏类型，让使用者更关注功能。不透明类型和协议很类似，不同的是不透明比协议限定的要多，协议能够对应更多类型。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">f</span>()</span> -&gt; <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S1</span>: <span class="title">P</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">f</span>()</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;one<span class="subst">\n</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S2</span>&lt;<span class="title">T</span>: <span class="title">P</span>&gt;: <span class="title">P</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p: <span class="type">T</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">f</span>()</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> p.f() <span class="operator">+</span> <span class="string">&quot;two<span class="subst">\n</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S3</span>&lt;<span class="title">T1</span>: <span class="title">P</span>, <span class="title">T2</span>: <span class="title">P</span>&gt;: <span class="title">P</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p1: <span class="type">T1</span></span><br><span class="line">    <span class="keyword">var</span> p2: <span class="type">T2</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">f</span>()</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> p1.f() <span class="operator">+</span> p2.f() <span class="operator">+</span> <span class="string">&quot;three<span class="subst">\n</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">someP</span>()</span> -&gt; <span class="keyword">some</span> <span class="type">P</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">S3</span>(p1: <span class="type">S1</span>(), p2: <span class="type">S2</span>(p: <span class="type">S1</span>()))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> r <span class="operator">=</span> someP()</span><br><span class="line"><span class="built_in">print</span>(r.f())</span><br></pre></td></tr></table></figure>
<p>函数调用者决定返回什么类型是泛型，函数自身决定返回什么类型使用不透明返回类型。</p>
<h4 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h4><p>Result 类型用来处理错误，特别适用异步接口的错误处理。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">URLSession</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">dataTaskWithResult</span>(</span></span><br><span class="line"><span class="function">        <span class="params">with</span> <span class="params">url</span>: <span class="type">URL</span>,</span></span><br><span class="line"><span class="function">        <span class="params">handler</span>: <span class="keyword">@escaping</span> (<span class="type">Result</span>&lt;<span class="type">Data</span>, <span class="type">Error</span>&gt;) -&gt; <span class="type">Void</span></span></span><br><span class="line"><span class="function">    )</span> -&gt; <span class="type">URLSessionDataTask</span> &#123;</span><br><span class="line">        dataTask(with: url) &#123; data, <span class="keyword">_</span>, err <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> err <span class="operator">=</span> err &#123;</span><br><span class="line">                handler(.failure(err))</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                handler(.success(data <span class="operator">??</span> <span class="type">Data</span>()))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> url <span class="operator">=</span> <span class="type">URL</span>(string: <span class="string">&quot;https://ming1016.github.io/&quot;</span>)<span class="operator">!</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 以前网络请求</span></span><br><span class="line"><span class="keyword">let</span> t1 <span class="operator">=</span> <span class="type">URLSession</span>.shared.dataTask(with: url) &#123;</span><br><span class="line">    data, <span class="keyword">_</span>, error <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> err <span class="operator">=</span> error &#123;</span><br><span class="line">        <span class="built_in">print</span>(err)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> data <span class="operator">=</span> data &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="type">String</span>(decoding: data, as: <span class="type">UTF8</span>.<span class="keyword">self</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">t1.resume()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 Result 网络请求</span></span><br><span class="line"><span class="keyword">let</span> t2 <span class="operator">=</span> <span class="type">URLSession</span>.shared.dataTaskWithResult(with: url) &#123; result <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">switch</span> result &#123;</span><br><span class="line">    <span class="keyword">case</span> .success(<span class="keyword">let</span> data):</span><br><span class="line">        <span class="built_in">print</span>(<span class="type">String</span>(decoding: data, as: <span class="type">UTF8</span>.<span class="keyword">self</span>))</span><br><span class="line">    <span class="keyword">case</span> .failure(<span class="keyword">let</span> err):</span><br><span class="line">        <span class="built_in">print</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">t2.resume()</span><br></pre></td></tr></table></figure>
<h4 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h4><p>使用 is 关键字进行类型判断， 使用as 关键字来转换成子类。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">S0</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">S1</span>: <span class="title">S0</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">S2</span>: <span class="title">S0</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a <span class="operator">=</span> [<span class="type">S0</span>]()</span><br><span class="line">a.append(<span class="type">S1</span>())</span><br><span class="line">a.append(<span class="type">S2</span>())</span><br><span class="line"><span class="keyword">for</span> e <span class="keyword">in</span> a &#123;</span><br><span class="line">    <span class="comment">// 类型判断</span></span><br><span class="line">    <span class="keyword">if</span> e <span class="keyword">is</span> <span class="type">S1</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Type is S1&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> e <span class="keyword">is</span> <span class="type">S2</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Type is S2&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 使用 as 关键字转换成子类</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> s1 <span class="operator">=</span> e <span class="keyword">as?</span> <span class="type">S1</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;As S1 <span class="subst">\(s1)</span>&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> s2 <span class="operator">=</span> e <span class="keyword">as?</span> <span class="type">S2</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;As S2 <span class="subst">\(s2)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="类和结构体"><a href="#类和结构体" class="headerlink" title="类和结构体"></a>类和结构体</h3><h4 id="类"><a href="#类" class="headerlink" title="类"></a>类</h4><p>类可以定义属性、方法、构造器、下标操作。类使用扩展来扩展功能，遵循协议。类还以继承，运行时检查实例类型。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p: <span class="type">String</span></span><br><span class="line">    <span class="function"><span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">p</span>: <span class="type">String</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.p <span class="operator">=</span> p</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 下标操作</span></span><br><span class="line">    <span class="function"><span class="keyword">subscript</span>(<span class="params">s</span>: <span class="type">String</span>)</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> p <span class="operator">+</span> s</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            p <span class="operator">=</span> s <span class="operator">+</span> newValue</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> c <span class="operator">=</span> <span class="type">C</span>(<span class="string">&quot;hi&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(c.p)</span><br><span class="line"><span class="built_in">print</span>(c[<span class="string">&quot; ming&quot;</span>])</span><br><span class="line">c[<span class="string">&quot;k&quot;</span>] <span class="operator">=</span> <span class="string">&quot;v&quot;</span></span><br><span class="line"><span class="built_in">print</span>(c.p)</span><br></pre></td></tr></table></figure>
<h4 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h4><p>结构体是值类型，可以定义属性、方法、构造器、下标操作。结构体使用扩展来扩展功能，遵循协议。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p1: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">var</span> p2: <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">S</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">f</span>()</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> p1 <span class="operator">+</span> <span class="type">String</span>(p2)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> s <span class="operator">=</span> <span class="type">S</span>(p2: <span class="number">1</span>)</span><br><span class="line">s.p1 <span class="operator">=</span> <span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="built_in">print</span>(s.f()) <span class="comment">// 11</span></span><br></pre></td></tr></table></figure>
<h4 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h4><p>类、结构体或枚举里的变量常量就是他们的属性。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> sp <span class="operator">=</span> <span class="string">&quot;类型属性&quot;</span> <span class="comment">// 类型属性通过类型本身访问，非实例访问</span></span><br><span class="line">    <span class="keyword">var</span> p1: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">var</span> p2: <span class="type">Int</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">    <span class="comment">// cp 是计算属性</span></span><br><span class="line">    <span class="keyword">var</span> cp: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> p2 <span class="operator">*</span> <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            p2 <span class="operator">=</span> newValue <span class="operator">+</span> <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 只有 getter 的是只读计算属性</span></span><br><span class="line">    <span class="keyword">var</span> rcp: <span class="type">Int</span> &#123;</span><br><span class="line">        p2 <span class="operator">*</span> <span class="number">4</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="type">S</span>.sp)</span><br><span class="line"><span class="built_in">print</span>(<span class="type">S</span>().cp) <span class="comment">// 2</span></span><br><span class="line"><span class="keyword">var</span> s <span class="operator">=</span> <span class="type">S</span>()</span><br><span class="line">s.cp <span class="operator">=</span> <span class="number">3</span></span><br><span class="line"><span class="built_in">print</span>(s.p2) <span class="comment">// 5</span></span><br><span class="line"><span class="built_in">print</span>(<span class="type">S</span>().rcp) <span class="comment">// 4</span></span><br></pre></td></tr></table></figure>
<p>willSet 和 didSet 是属性观察器，可以在属性值设置前后插入自己的逻辑处理。</p>
<p>键路径表达式作为函数</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S2</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> p1: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> p2: <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> s2 <span class="operator">=</span> <span class="type">S2</span>(p1: <span class="string">&quot;one&quot;</span>, p2: <span class="number">1</span>)</span><br><span class="line"><span class="keyword">let</span> s3 <span class="operator">=</span> <span class="type">S2</span>(p1: <span class="string">&quot;two&quot;</span>, p2: <span class="number">2</span>)</span><br><span class="line"><span class="keyword">let</span> a1 <span class="operator">=</span> [s2, s3]</span><br><span class="line"><span class="keyword">let</span> a2 <span class="operator">=</span> a1.map(\.p1)</span><br><span class="line"><span class="built_in">print</span>(a2) <span class="comment">// [&quot;one&quot;, &quot;two&quot;]</span></span><br></pre></td></tr></table></figure>
<h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">E</span>: <span class="title">String</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> one, two, three</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">showRawValue</span>()</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(rawValue)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> e <span class="operator">=</span> <span class="type">E</span>.three</span><br><span class="line">e.showRawValue() <span class="comment">// three</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 可变的实例方法，使用 mutating 标记</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p: <span class="type">String</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">addFullStopForP</span>()</span> &#123;</span><br><span class="line">        p <span class="operator">+=</span> <span class="string">&quot;.&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> s <span class="operator">=</span> <span class="type">S</span>(p: <span class="string">&quot;hi&quot;</span>)</span><br><span class="line">s.addFullStopForP()</span><br><span class="line"><span class="built_in">print</span>(s.p)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类方法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">cf</span>() </span>&#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;类方法&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>static和class关键字修饰的方法类似 OC 的类方法。static 可以修饰存储属性，而 class 不能；class 修饰的方法可以继承，而 static 不能。在协议中需用 static 来修饰。</p>
<p>静态下标方法</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 静态下标</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S2</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> sp <span class="operator">=</span> [<span class="type">String</span>: <span class="type">Int</span>]()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">subscript</span>(<span class="keyword">_</span> <span class="params">s</span>: <span class="type">String</span>, <span class="params">d</span>: <span class="type">Int</span> <span class="operator">=</span> <span class="number">10</span>)</span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> sp[s] <span class="operator">??</span> d</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            sp[s] <span class="operator">=</span> newValue</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">S2</span>[<span class="string">&quot;key1&quot;</span>] <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="type">S2</span>[<span class="string">&quot;key2&quot;</span>] <span class="operator">=</span> <span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(<span class="type">S2</span>[<span class="string">&quot;key2&quot;</span>]) <span class="comment">// 2</span></span><br><span class="line"><span class="built_in">print</span>(<span class="type">S2</span>[<span class="string">&quot;key3&quot;</span>]) <span class="comment">// 10</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>自定义类型中实现了 callAsFunction() 的话，该类型的值就可以直接调用。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// callAsFunction()</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S3</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p1: <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">callAsFunction</span>()</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;show <span class="subst">\(p1)</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> s2 <span class="operator">=</span> <span class="type">S3</span>(p1: <span class="string">&quot;hi&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(s2()) <span class="comment">// show hi</span></span><br></pre></td></tr></table></figure>
<h4 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h4><p>类能继承另一个类，继承它的方法、属性等。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类继承</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C1</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p1: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> cp1: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> p1 <span class="operator">+</span> <span class="string">&quot; like ATM&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            p1 <span class="operator">=</span> p1 <span class="operator">+</span> newValue</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">init</span>(<span class="params">p1</span>: <span class="type">String</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.p1 <span class="operator">=</span> p1</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">sayHi</span>()</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Hi! <span class="subst">\(p1)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C2</span>: <span class="title">C1</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p2: <span class="type">String</span></span><br><span class="line">    <span class="function"><span class="keyword">init</span>(<span class="params">p2</span>: <span class="type">String</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.p2 <span class="operator">=</span> p2</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(p1: p2 <span class="operator">+</span> <span class="string">&quot;&#x27;s father&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">C2</span>(p2: <span class="string">&quot;Lemon&quot;</span>).sayHi() <span class="comment">// Hi! Lemon&#x27;s father</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写父类方法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C3</span>: <span class="title">C2</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">sayHi</span>()</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Hi! <span class="subst">\(p2)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">C3</span>(p2: <span class="string">&quot;Lemon&quot;</span>).sayHi() <span class="comment">// Hi! Lemon</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写计算属性</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C4</span>: <span class="title">C1</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> cp1: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> p1 <span class="operator">+</span> <span class="string">&quot; like Out of the blade&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            p1 <span class="operator">=</span> p1 <span class="operator">+</span> newValue</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="type">C1</span>(p1: <span class="string">&quot;Lemon&quot;</span>).cp1) <span class="comment">// Lemon like ATM</span></span><br><span class="line"><span class="built_in">print</span>(<span class="type">C4</span>(p1: <span class="string">&quot;Lemon&quot;</span>).cp1) <span class="comment">// Lemon like Out of the blade</span></span><br></pre></td></tr></table></figure>
<p>通过 final 关键字可以防止类被继承，final 还可以用于属性和方法。使用 super 关键字指代父类。</p>
<h3 id="函数式"><a href="#函数式" class="headerlink" title="函数式"></a>函数式</h3><h4 id="map"><a href="#map" class="headerlink" title="map"></a>map</h4><p>map 可以依次处理数组中元素，并返回一个处理后的新数组。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a1 <span class="operator">=</span> [<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>]</span><br><span class="line"><span class="keyword">let</span> a2 <span class="operator">=</span> a1.map &#123;</span><br><span class="line">    <span class="string">&quot;<span class="subst">\(<span class="variable">$0</span>)</span>2&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(a2) <span class="comment">// [&quot;a2&quot;, &quot;b2&quot;, &quot;c2&quot;]</span></span><br></pre></td></tr></table></figure>
<p>使用 compactMap 可以过滤 nil 的元素。flatMap 会将多个数组合成一个数组返回。</p>
<h4 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h4><p>根据指定条件返回</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a1 <span class="operator">=</span> [<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;call my name&quot;</span>]</span><br><span class="line"><span class="keyword">let</span> a2 <span class="operator">=</span> a1.filter &#123;</span><br><span class="line">    <span class="variable">$0</span>.prefix(<span class="number">1</span>) <span class="operator">==</span> <span class="string">&quot;c&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(a2) <span class="comment">// [&quot;c&quot;, &quot;call my name&quot;]</span></span><br></pre></td></tr></table></figure>
<h4 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h4><p>reduce 可以将迭代中返回的结果用于下个迭代中，并，还能让你设个初始值。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a1 <span class="operator">=</span> [<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;call my name.&quot;</span>, <span class="string">&quot;get it?&quot;</span>]</span><br><span class="line"><span class="keyword">let</span> a2 <span class="operator">=</span> a1.reduce(<span class="string">&quot;Hey u,&quot;</span>, &#123; partialResult, s <span class="keyword">in</span></span><br><span class="line">    <span class="comment">// partialResult 是前面返回的值，s 是遍历到当前的值</span></span><br><span class="line">    partialResult <span class="operator">+</span> <span class="string">&quot; <span class="subst">\(s)</span>&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(a2) <span class="comment">// Hey u, a b c call my name. get it?</span></span><br></pre></td></tr></table></figure>
<h4 id="sorted"><a href="#sorted" class="headerlink" title="sorted"></a>sorted</h4><p>排序</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类型遵循 Comparable</span></span><br><span class="line"><span class="keyword">let</span> a1 <span class="operator">=</span> [<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;call my name.&quot;</span>, <span class="string">&quot;get it?&quot;</span>]</span><br><span class="line"><span class="keyword">let</span> a2 <span class="operator">=</span> a1.sorted()</span><br><span class="line"><span class="keyword">let</span> a3 <span class="operator">=</span> a1.sorted(by: <span class="operator">&gt;</span>)</span><br><span class="line"><span class="keyword">let</span> a4 <span class="operator">=</span> a1.sorted(by: <span class="operator">&lt;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(a2) <span class="comment">// Hey u, a b c call my name. get it?</span></span><br><span class="line"><span class="built_in">print</span>(a3) <span class="comment">// [&quot;get it?&quot;, &quot;call my name.&quot;, &quot;c&quot;, &quot;b&quot;, &quot;a&quot;]</span></span><br><span class="line"><span class="built_in">print</span>(a4) <span class="comment">// [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;call my name.&quot;, &quot;get it?&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 类型不遵循 Comparable</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> s: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> i: <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a5 <span class="operator">=</span> [<span class="type">S</span>(s: <span class="string">&quot;a&quot;</span>, i: <span class="number">0</span>), <span class="type">S</span>(s: <span class="string">&quot;b&quot;</span>, i: <span class="number">1</span>), <span class="type">S</span>(s: <span class="string">&quot;c&quot;</span>, i: <span class="number">2</span>)]</span><br><span class="line"><span class="keyword">let</span> a6 <span class="operator">=</span> a5</span><br><span class="line">    .sorted &#123; l, r <span class="keyword">in</span></span><br><span class="line">        l.i <span class="operator">&gt;</span> r.i</span><br><span class="line">    &#125;</span><br><span class="line">    .map &#123;</span><br><span class="line">        <span class="variable">$0</span>.i</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(a6) <span class="comment">// [2, 1, 0]</span></span><br></pre></td></tr></table></figure>
<h3 id="控制流"><a href="#控制流" class="headerlink" title="控制流"></a>控制流</h3><h4 id="If-•-If-let-•-If-case-let"><a href="#If-•-If-let-•-If-case-let" class="headerlink" title="If • If let • If case let"></a>If • If let • If case let</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// if</span></span><br><span class="line"><span class="keyword">let</span> s <span class="operator">=</span> <span class="string">&quot;hi&quot;</span></span><br><span class="line"><span class="keyword">if</span> s.isEmpty &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;String is Empty&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;String is <span class="subst">\(s)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 三元条件</span></span><br><span class="line">s.isEmpty <span class="operator">?</span> <span class="built_in">print</span>(<span class="string">&quot;String is Empty again&quot;</span>) : <span class="built_in">print</span>(<span class="string">&quot;String is <span class="subst">\(s)</span> again&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// if let-else</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span>(<span class="params">s</span>: <span class="type">String</span>?)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> s1 <span class="operator">=</span> s &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;s1 is <span class="subst">\(s1)</span>&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;s1 is nothing&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// nil-coalescing</span></span><br><span class="line">    <span class="keyword">let</span> s2 <span class="operator">=</span> s <span class="operator">??</span> <span class="string">&quot;nothing&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;s2 is <span class="subst">\(s2)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">f(s: <span class="string">&quot;something&quot;</span>)</span><br><span class="line">f(s: <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// if case let</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">E</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> c1(<span class="type">String</span>)</span><br><span class="line">    <span class="keyword">case</span> c2([<span class="type">String</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">des</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> .c1(<span class="keyword">let</span> string):</span><br><span class="line">            <span class="built_in">print</span>(string)</span><br><span class="line">        <span class="keyword">case</span> .c2(<span class="keyword">let</span> array):</span><br><span class="line">            <span class="built_in">print</span>(array)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">E</span>.c1(<span class="string">&quot;enum c1&quot;</span>).des()</span><br><span class="line"><span class="type">E</span>.c2([<span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>, <span class="string">&quot;three&quot;</span>]).des()</span><br></pre></td></tr></table></figure>
<h4 id="Guard-guard-guard-let"><a href="#Guard-guard-guard-let" class="headerlink" title="Guard guard, guard let"></a>Guard guard, guard let</h4><p>更好地处理异常情况</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// guard</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span>(<span class="params">p</span>: <span class="type">String</span>)</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> p.isEmpty <span class="operator">!=</span> <span class="literal">true</span> <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Empty string.&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;String <span class="subst">\(p)</span> is not empty.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(f1(p: <span class="string">&quot;&quot;</span>)) <span class="comment">// Empty string.</span></span><br><span class="line"><span class="built_in">print</span>(f1(p: <span class="string">&quot;lemon&quot;</span>)) <span class="comment">// String lemon is not empty.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// guard let</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f2</span>(<span class="params">p1</span>: <span class="type">String</span>?)</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> p2 <span class="operator">=</span> p1 <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Nil.&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;String <span class="subst">\(p2)</span> is not nil.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(f2(p1: <span class="literal">nil</span>)) <span class="comment">// Nil.</span></span><br><span class="line"><span class="built_in">print</span>(f2(p1: <span class="string">&quot;lemon&quot;</span>)) <span class="comment">// String lemon is not nil.</span></span><br></pre></td></tr></table></figure>
<h4 id="遍历-For-in"><a href="#遍历-For-in" class="headerlink" title="遍历 For-in"></a>遍历 For-in</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a <span class="operator">=</span> [<span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>, <span class="string">&quot;three&quot;</span>]</span><br><span class="line"><span class="keyword">for</span> str <span class="keyword">in</span> a &#123;</span><br><span class="line">    <span class="built_in">print</span>(str)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用下标范围</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span><span class="number">10</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 enumerated</span></span><br><span class="line"><span class="keyword">for</span> (i, str) <span class="keyword">in</span> a.enumerated() &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;第<span class="subst">\(i <span class="operator">+</span> <span class="number">1</span>)</span>个是:<span class="subst">\(str)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// for in where</span></span><br><span class="line"><span class="keyword">for</span> str <span class="keyword">in</span> a <span class="keyword">where</span> str.prefix(<span class="number">1</span>) <span class="operator">==</span> <span class="string">&quot;t&quot;</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(str)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 字典 for in，遍历是无序的</span></span><br><span class="line"><span class="keyword">let</span> dic <span class="operator">=</span> [</span><br><span class="line">    <span class="string">&quot;one&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&quot;two&quot;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&quot;three&quot;</span>: <span class="number">3</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (k, v) <span class="keyword">in</span> dic &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;key is <span class="subst">\(k)</span>, value is <span class="subst">\(v)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// stride</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">stride</span>(from: <span class="number">10</span>, through: <span class="number">0</span>, by: <span class="operator">-</span><span class="number">2</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> 10</span></span><br><span class="line"><span class="comment"> 8</span></span><br><span class="line"><span class="comment"> 6</span></span><br><span class="line"><span class="comment"> 4</span></span><br><span class="line"><span class="comment"> 2</span></span><br><span class="line"><span class="comment"> 0</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>
<h4 id="While-while-repeat-while"><a href="#While-while-repeat-while" class="headerlink" title="While while, repeat-while"></a>While while, repeat-while</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// while</span></span><br><span class="line"><span class="keyword">var</span> i1 <span class="operator">=</span> <span class="number">10</span></span><br><span class="line"><span class="keyword">while</span> i1 <span class="operator">&gt;</span> <span class="number">0</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;positive even number <span class="subst">\(i1)</span>&quot;</span>)</span><br><span class="line">    i1 <span class="operator">-=</span> <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// repeat while</span></span><br><span class="line"><span class="keyword">var</span> i2 <span class="operator">=</span> <span class="number">10</span></span><br><span class="line"><span class="keyword">repeat</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;positive even number <span class="subst">\(i2)</span>&quot;</span>)</span><br><span class="line">    i2 <span class="operator">-=</span> <span class="number">2</span></span><br><span class="line">&#125; <span class="keyword">while</span> i2 <span class="operator">&gt;</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>使用 break 结束遍历，使用 continue 跳过当前作用域，继续下个循环</p>
<h4 id="Switch"><a href="#Switch" class="headerlink" title="Switch"></a>Switch</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span>(<span class="params">pa</span>: <span class="type">String</span>, <span class="params">t</span>:(<span class="type">String</span>, <span class="type">Int</span>))</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> p1 <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> p2 <span class="operator">=</span> <span class="number">10</span></span><br><span class="line">    <span class="keyword">switch</span> pa &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;one&quot;</span>:</span><br><span class="line">        p1 <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;two&quot;</span>:</span><br><span class="line">        p1 <span class="operator">=</span> <span class="number">2</span></span><br><span class="line">        <span class="keyword">fallthrough</span> <span class="comment">// 继续到下个 case 中</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        p2 <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;p1 is <span class="subst">\(p1)</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;p2 is <span class="subst">\(p2)</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 元组</span></span><br><span class="line">    <span class="keyword">switch</span> t &#123;</span><br><span class="line">    <span class="keyword">case</span> (<span class="string">&quot;0&quot;</span>, <span class="number">0</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;zero&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> (<span class="string">&quot;1&quot;</span>, <span class="number">1</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;one&quot;</span>)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;no&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f1(pa: <span class="string">&quot;two&quot;</span>, t:(<span class="string">&quot;1&quot;</span>, <span class="number">1</span>))</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> p1 is 2</span></span><br><span class="line"><span class="comment"> p2 is 0</span></span><br><span class="line"><span class="comment"> one</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 枚举</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">E</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> one, two, three, unknown(<span class="type">String</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f2</span>(<span class="params">pa</span>: <span class="type">E</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> p: <span class="type">String</span></span><br><span class="line">    <span class="keyword">switch</span> pa &#123;</span><br><span class="line">    <span class="keyword">case</span> .one:</span><br><span class="line">        p <span class="operator">=</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">    <span class="keyword">case</span> .two:</span><br><span class="line">        p <span class="operator">=</span> <span class="string">&quot;2&quot;</span></span><br><span class="line">    <span class="keyword">case</span> .three:</span><br><span class="line">        p <span class="operator">=</span> <span class="string">&quot;3&quot;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> .unknown(u) <span class="keyword">where</span> <span class="type">Int</span>(u) <span class="operator">??</span> <span class="number">0</span> <span class="operator">&gt;</span> <span class="number">0</span> : <span class="comment">// 枚举关联值，使用 where 增加条件</span></span><br><span class="line">        p <span class="operator">=</span> u</span><br><span class="line">    <span class="keyword">case</span> .unknown(<span class="keyword">_</span>):</span><br><span class="line">        p <span class="operator">=</span> <span class="string">&quot;negative number&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">print</span>(p)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f2(pa: <span class="type">E</span>.one) <span class="comment">// 1</span></span><br><span class="line">f2(pa: <span class="type">E</span>.unknown(<span class="string">&quot;10&quot;</span>)) <span class="comment">// 10</span></span><br><span class="line">f2(pa: <span class="type">E</span>.unknown(<span class="string">&quot;-10&quot;</span>)) <span class="comment">// negative number</span></span><br></pre></td></tr></table></figure>
<h3 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h3><h4 id="数组-1-2-3"><a href="#数组-1-2-3" class="headerlink" title="数组 [1, 2, 3]"></a>数组 [1, 2, 3]</h4><p>数组是有序集合</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a0: [<span class="type">Int</span>] <span class="operator">=</span> [<span class="number">1</span>, <span class="number">10</span>]</span><br><span class="line">a0.append(<span class="number">2</span>)</span><br><span class="line">a0.remove(at: <span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(a0) <span class="comment">// [10, 2]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a1 <span class="operator">=</span> [<span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>, <span class="string">&quot;three&quot;</span>]</span><br><span class="line"><span class="keyword">let</span> a2 <span class="operator">=</span> [<span class="string">&quot;three&quot;</span>, <span class="string">&quot;four&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 找两个集合的不同</span></span><br><span class="line"><span class="keyword">let</span> dif <span class="operator">=</span> a1.difference(from: a2) <span class="comment">// swift的 diffing 算法在这 http://www.xmailserver.org/diff2.pdf swift实现在  swift/stdlib/public/core/Diffing.swift</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> dif &#123;</span><br><span class="line">    <span class="keyword">switch</span> c &#123;</span><br><span class="line">    <span class="keyword">case</span> .remove(<span class="keyword">let</span> o, <span class="keyword">let</span> e, <span class="keyword">let</span> a):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;offset:<span class="subst">\(o)</span>, element:<span class="subst">\(e)</span>, associatedWith:<span class="subst">\(String(describing: a))</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> .insert(<span class="keyword">let</span> o, <span class="keyword">let</span> e, <span class="keyword">let</span> a):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;offset:<span class="subst">\(o)</span>, element:<span class="subst">\(e)</span>, associatedWith:<span class="subst">\(String(describing: a))</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> remove offset:1, element:four, associatedWith:nil</span></span><br><span class="line"><span class="comment"> insert offset:0, element:one, associatedWith:nil</span></span><br><span class="line"><span class="comment"> insert offset:1, element:two, associatedWith:nil</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> a3 <span class="operator">=</span> a2.applying(dif) <span class="operator">??</span> [] <span class="comment">// 可以用于添加删除动画</span></span><br><span class="line"><span class="built_in">print</span>(a3) <span class="comment">// [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]</span></span><br></pre></td></tr></table></figure>
<p>dif 有第三个 case 值 .insert(let offset, let element, let associatedWith) 可以跟踪成对的变化，用于高级动画。</p>
<p>从数组中随机取一个元素<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(a0.randomElement() <span class="operator">??</span> <span class="number">0</span>)</span><br></pre></td></tr></table></figure></p>
<p>数组排序</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 排序</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S1</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> n: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> b <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a4 <span class="operator">=</span> [</span><br><span class="line">    <span class="type">S1</span>(n: <span class="number">1</span>),</span><br><span class="line">    <span class="type">S1</span>(n: <span class="number">10</span>),</span><br><span class="line">    <span class="type">S1</span>(n: <span class="number">3</span>),</span><br><span class="line">    <span class="type">S1</span>(n: <span class="number">2</span>)</span><br><span class="line">]</span><br><span class="line"><span class="keyword">let</span> a5 <span class="operator">=</span> a4.sorted &#123; i1, i2 <span class="keyword">in</span></span><br><span class="line">    i1.n <span class="operator">&lt;</span> i2.n</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> a5 &#123;</span><br><span class="line">    <span class="built_in">print</span>(n)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/// S1(n: 1)</span></span><br><span class="line"><span class="comment">/// S1(n: 2)</span></span><br><span class="line"><span class="comment">/// S1(n: 3)</span></span><br><span class="line"><span class="comment">/// S1(n: 10)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a6 <span class="operator">=</span> [<span class="number">1</span>,<span class="number">10</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">2</span>]</span><br><span class="line"><span class="built_in">print</span>(a6.sorted(by: <span class="operator">&gt;</span>)) <span class="comment">// [10, 7, 4, 2, 1]</span></span><br></pre></td></tr></table></figure>
<p>可以加到数组扩展中，通过扩展约束能够指定特定元素类型的排序，代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Array</span> <span class="title">where</span> <span class="title">Element</span> == <span class="title">Int</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 升序</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">intSortedASC</span>()</span> -&gt; [<span class="type">Int</span>] &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.sorted(by: <span class="operator">&lt;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 降序</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">intSortedDESC</span>()</span> -&gt; [<span class="type">Int</span>] &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.sorted(by: <span class="operator">&lt;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(a6.intSortedASC()) <span class="comment">// 使用扩展增加自定义排序能力</span></span><br></pre></td></tr></table></figure>
<p>在数组中检索满足条件的元素，代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一个满足条件了就返回</span></span><br><span class="line"><span class="keyword">let</span> a7 <span class="operator">=</span> a4.first &#123;</span><br><span class="line">    <span class="variable">$0</span>.n <span class="operator">==</span> <span class="number">10</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(a7<span class="operator">?</span>.n <span class="operator">??</span> <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 是否都满足了条件</span></span><br><span class="line"><span class="built_in">print</span>(a4.allSatisfy &#123; <span class="variable">$0</span>.n <span class="operator">==</span> <span class="number">1</span> &#125;) <span class="comment">// false</span></span><br><span class="line"><span class="built_in">print</span>(a4.allSatisfy(\.b)) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 找出最大的那个</span></span><br><span class="line"><span class="built_in">print</span>(a4.max(by: &#123; e1, e2 <span class="keyword">in</span></span><br><span class="line">    e1.n <span class="operator">&lt;</span> e2.n</span><br><span class="line">&#125;) <span class="operator">??</span> <span class="type">S1</span>(n: <span class="number">0</span>))</span><br><span class="line"><span class="comment">// S1(n: 10, b: true)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 看看是否包含某个元素</span></span><br><span class="line"><span class="built_in">print</span>(a4.contains(where: &#123;</span><br><span class="line">    <span class="variable">$0</span>.n <span class="operator">==</span> <span class="number">7</span></span><br><span class="line">&#125;))</span><br><span class="line"><span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p>一些切割数组的方法。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 切片</span></span><br><span class="line"><span class="comment">// 取前3个，并不是直接复制，对于大的数组有性能优势。</span></span><br><span class="line"><span class="built_in">print</span>(a6[<span class="operator">..&lt;</span><span class="number">3</span>]) <span class="comment">// [1, 10, 4] 需要做越界检查</span></span><br><span class="line"><span class="built_in">print</span>(a6.prefix(<span class="number">30</span>)) <span class="comment">// [1, 10, 4, 7, 2] 不需要做越界检查，也是切片，性能一样</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 去掉前3个</span></span><br><span class="line"><span class="built_in">print</span>(a6.dropFirst(<span class="number">3</span>)) <span class="comment">// [7, 2]</span></span><br></pre></td></tr></table></figure>
<p>prefix(while:) 和 drop(while:) 方法，顺序遍历执行闭包里的逻辑判断，满足条件就返回，遇到不匹配就会停止遍历。prefix 返回满足条件的元素集合，drop 返回停止遍历之后那些元素集合。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a8 <span class="operator">=</span> [<span class="number">8</span>, <span class="number">9</span>, <span class="number">20</span>, <span class="number">1</span>, <span class="number">35</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">let</span> a9 <span class="operator">=</span> a8.prefix &#123;</span><br><span class="line">    <span class="variable">$0</span> <span class="operator">&lt;</span> <span class="number">30</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(a9) <span class="comment">// [8, 9, 20, 1]</span></span><br><span class="line"><span class="keyword">let</span> a10 <span class="operator">=</span> a8.drop &#123;</span><br><span class="line">    <span class="variable">$0</span> <span class="operator">&lt;</span> <span class="number">30</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(a10) <span class="comment">// [35, 3]</span></span><br></pre></td></tr></table></figure>
<p>比 filter 更高效的删除元素的方法 removeAll</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除所有不满足条件的元素</span></span><br><span class="line"><span class="keyword">var</span> a11 <span class="operator">=</span> [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">12</span>, <span class="number">25</span>]</span><br><span class="line">a11.removeAll &#123; <span class="variable">$0</span> <span class="operator">&lt;</span> <span class="number">10</span> &#125;</span><br><span class="line"><span class="built_in">print</span>(a11) <span class="comment">// [4, 3, 1, 3, 3] 随机</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建未初始化的数组</span></span><br><span class="line"><span class="keyword">let</span> a12 <span class="operator">=</span> (<span class="number">0</span><span class="operator">...</span><span class="number">4</span>).map &#123; <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">    <span class="type">Int</span>.random(in: <span class="number">0</span><span class="operator">...</span><span class="number">5</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(a12) <span class="comment">// [0, 3, 3, 2, 5] 随机</span></span><br></pre></td></tr></table></figure>
<p>#if 用于后缀表达式</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// #if 用于后缀表达式</span></span><br><span class="line"><span class="keyword">let</span> a13 <span class="operator">=</span> a11</span><br><span class="line"><span class="keyword">#if</span> os(iOS)</span><br><span class="line">    .count</span><br><span class="line"><span class="keyword">#else</span></span><br><span class="line">    .reduce(<span class="number">0</span>, <span class="operator">+</span>)</span><br><span class="line"><span class="keyword">#endif</span></span><br><span class="line"><span class="built_in">print</span>(a13) <span class="comment">//37</span></span><br></pre></td></tr></table></figure>
<h4 id="Sets-Set"><a href="#Sets-Set" class="headerlink" title="Sets Set"></a>Sets Set<Int></h4><p>Set 是无序集合，元素唯一</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s0: <span class="type">Set</span>&lt;<span class="type">Int</span>&gt; <span class="operator">=</span> [<span class="number">2</span>, <span class="number">4</span>]</span><br><span class="line"><span class="keyword">let</span> s1: <span class="type">Set</span> <span class="operator">=</span> [<span class="number">2</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">8</span>]</span><br><span class="line"><span class="keyword">let</span> s2: <span class="type">Set</span> <span class="operator">=</span> [<span class="number">7</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">10</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> s3 <span class="operator">=</span> s1.union(s2) <span class="comment">// 合集</span></span><br><span class="line"><span class="keyword">let</span> s4 <span class="operator">=</span> s1.intersection(s2) <span class="comment">// 交集</span></span><br><span class="line"><span class="keyword">let</span> s5 <span class="operator">=</span> s1.subtracting(s2) <span class="comment">// 非交集部分</span></span><br><span class="line"><span class="keyword">let</span> s6 <span class="operator">=</span> s1.symmetricDifference(s2) <span class="comment">// 非交集的合集</span></span><br><span class="line"><span class="built_in">print</span>(s3) <span class="comment">// [4, 2, 1, 7, 3, 10, 8, 9, 6, 5]</span></span><br><span class="line"><span class="built_in">print</span>(s4) <span class="comment">// [10]</span></span><br><span class="line"><span class="built_in">print</span>(s5) <span class="comment">// [8, 4, 2, 6]</span></span><br><span class="line"><span class="built_in">print</span>(s6) <span class="comment">// [9, 1, 3, 4, 5, 2, 6, 8, 7]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// s0 是否被 s1 包含</span></span><br><span class="line"><span class="built_in">print</span>(s0.isSubset(of: s1)) <span class="comment">// true</span></span><br><span class="line"><span class="comment">// s1 是否包含了 s0</span></span><br><span class="line"><span class="built_in">print</span>(s1.isSuperset(of: s0)) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> s7: <span class="type">Set</span> <span class="operator">=</span> [<span class="number">3</span>, <span class="number">5</span>]</span><br><span class="line"><span class="comment">// s0 和 s7 是否有交集</span></span><br><span class="line"><span class="built_in">print</span>(s0.isDisjoint(with: s7)) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 可变 Set</span></span><br><span class="line"><span class="keyword">var</span> s8: <span class="type">Set</span> <span class="operator">=</span> [<span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>]</span><br><span class="line">s8.insert(<span class="string">&quot;three&quot;</span>)</span><br><span class="line">s8.remove(<span class="string">&quot;one&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(s8) <span class="comment">// [&quot;two&quot;, &quot;three&quot;]</span></span><br></pre></td></tr></table></figure>
<h4 id="字典"><a href="#字典" class="headerlink" title="字典 [:]"></a>字典 [:]</h4><p>字典是无序集合，键值对应。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> d1 <span class="operator">=</span> [</span><br><span class="line">    <span class="string">&quot;k1&quot;</span>: <span class="string">&quot;v1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;k2&quot;</span>: <span class="string">&quot;v2&quot;</span></span><br><span class="line">]</span><br><span class="line">d1[<span class="string">&quot;k3&quot;</span>] <span class="operator">=</span> <span class="string">&quot;v3&quot;</span></span><br><span class="line">d1[<span class="string">&quot;k4&quot;</span>] <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(d1) <span class="comment">// [&quot;k2&quot;: &quot;v2&quot;, &quot;k3&quot;: &quot;v3&quot;, &quot;k1&quot;: &quot;v1&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (k, v) <span class="keyword">in</span> d1 &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;key is <span class="subst">\(k)</span>, value is <span class="subst">\(v)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> key is k1, value is v1</span></span><br><span class="line"><span class="comment"> key is k2, value is v2</span></span><br><span class="line"><span class="comment"> key is k3, value is v3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> d1.isEmpty <span class="operator">==</span> <span class="literal">false</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(d1.count) <span class="comment">// 3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// mapValues</span></span><br><span class="line"><span class="keyword">let</span> d2 <span class="operator">=</span> d1.mapValues &#123;</span><br><span class="line">    <span class="variable">$0</span> <span class="operator">+</span> <span class="string">&quot;_new&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(d2) <span class="comment">// [&quot;k2&quot;: &quot;v2_new&quot;, &quot;k3&quot;: &quot;v3_new&quot;, &quot;k1&quot;: &quot;v1_new&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 对字典的值或键进行分组</span></span><br><span class="line"><span class="keyword">let</span> d3 <span class="operator">=</span> <span class="type">Dictionary</span>(grouping: d1.values) &#123;</span><br><span class="line">    <span class="variable">$0</span>.count</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(d3) <span class="comment">// [2: [&quot;v1&quot;, &quot;v2&quot;, &quot;v3&quot;]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 从字典中取值，如果键对应无值，则使用通过 default 指定的默认值</span></span><br><span class="line">d1[<span class="string">&quot;k5&quot;</span>, <span class="keyword">default</span>: <span class="string">&quot;whatever&quot;</span>] <span class="operator">+=</span> <span class="string">&quot;.&quot;</span></span><br><span class="line"><span class="built_in">print</span>(d1[<span class="string">&quot;k5&quot;</span>] <span class="operator">??</span> <span class="string">&quot;&quot;</span>) <span class="comment">// whatever.</span></span><br><span class="line"><span class="keyword">let</span> v1 <span class="operator">=</span> d1[<span class="string">&quot;k3&quot;</span>, <span class="keyword">default</span>: <span class="string">&quot;whatever&quot;</span>]</span><br><span class="line"><span class="built_in">print</span>(v1) <span class="comment">// v3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// compactMapValues() 对字典值进行转换和解包。可以解可选类型，并去掉 nil 值</span></span><br><span class="line"><span class="keyword">let</span> d4 <span class="operator">=</span> [</span><br><span class="line">    <span class="string">&quot;k1&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&quot;k2&quot;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&quot;k3&quot;</span>: <span class="literal">nil</span></span><br><span class="line">]</span><br><span class="line"><span class="keyword">let</span> d5 <span class="operator">=</span> d4.mapValues &#123; <span class="variable">$0</span> &#125;</span><br><span class="line"><span class="keyword">let</span> d6 <span class="operator">=</span> d4.compactMapValues&#123; <span class="variable">$0</span> &#125;</span><br><span class="line"><span class="built_in">print</span>(d5)</span><br><span class="line"><span class="comment">// [&quot;k3&quot;: nil, &quot;k1&quot;: Optional(1), &quot;k2&quot;: Optional(2)]</span></span><br><span class="line"><span class="built_in">print</span>(d6)</span><br><span class="line"><span class="comment">// [&quot;k1&quot;: 1, &quot;k2&quot;: 2]</span></span><br></pre></td></tr></table></figure>
<h3 id="操作符"><a href="#操作符" class="headerlink" title="操作符"></a>操作符</h3><h4 id="赋值"><a href="#赋值" class="headerlink" title="赋值 =, +=. -=, *=, /="></a>赋值 =, +=. -=, *=, /=</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> i1 <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">var</span> i2 <span class="operator">=</span> i1</span><br><span class="line">i2 <span class="operator">=</span> <span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(i2) <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">i2 <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(i2) <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line">i2 <span class="operator">-=</span> <span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(i2) <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">i2 <span class="operator">*=</span> <span class="number">10</span></span><br><span class="line"><span class="built_in">print</span>(i2) <span class="comment">// 10</span></span><br><span class="line"></span><br><span class="line">i2 <span class="operator">/=</span> <span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(i2) <span class="comment">// 5</span></span><br></pre></td></tr></table></figure>
<h4 id="计算符"><a href="#计算符" class="headerlink" title="计算符 +, -, *, /, %"></a>计算符 +, -, *, /, %</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> i1 <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> i2 <span class="operator">=</span> i1</span><br><span class="line"><span class="built_in">print</span>((i1 <span class="operator">+</span> i2 <span class="operator">-</span> <span class="number">1</span>) <span class="operator">*</span> <span class="number">10</span> <span class="operator">/</span> <span class="number">2</span> <span class="operator">%</span> <span class="number">3</span>) <span class="comment">// 2</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;i&quot;</span> <span class="operator">+</span> <span class="string">&quot;1&quot;</span>) <span class="comment">// i1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 一元运算符</span></span><br><span class="line"><span class="built_in">print</span>(<span class="operator">-</span>i1) <span class="comment">// -1</span></span><br></pre></td></tr></table></figure>
<h4 id="比较运算符-gt"><a href="#比较运算符-gt" class="headerlink" title="比较运算符 ==, &gt;"></a>比较运算符 ==, &gt;</h4><p>遵循 Equatable 协议可以使用 == 和 != 来判断是否相等</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="number">1</span> <span class="operator">&gt;</span> <span class="number">2</span>) <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span>: <span class="title">Equatable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p1: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> p2: <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> s1 <span class="operator">=</span> <span class="type">S</span>(p1: <span class="string">&quot;one&quot;</span>, p2: <span class="number">1</span>)</span><br><span class="line"><span class="keyword">let</span> s2 <span class="operator">=</span> <span class="type">S</span>(p1: <span class="string">&quot;two&quot;</span>, p2: <span class="number">2</span>)</span><br><span class="line"><span class="keyword">let</span> s3 <span class="operator">=</span> <span class="type">S</span>(p1: <span class="string">&quot;one&quot;</span>, p2: <span class="number">2</span>)</span><br><span class="line"><span class="keyword">let</span> s4 <span class="operator">=</span> <span class="type">S</span>(p1: <span class="string">&quot;one&quot;</span>, p2: <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(s1 <span class="operator">==</span> s2) <span class="comment">// false</span></span><br><span class="line"><span class="built_in">print</span>(s1 <span class="operator">==</span> s3) <span class="comment">// false</span></span><br><span class="line"><span class="built_in">print</span>(s1 <span class="operator">==</span> s4) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>类需要实现 == 函数</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>: <span class="title">Equatable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p1: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> p2: <span class="type">Int</span></span><br><span class="line">    <span class="function"><span class="keyword">init</span>(<span class="params">p1</span>: <span class="type">String</span>, <span class="params">p2</span>: <span class="type">Int</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.p1 <span class="operator">=</span> p1</span><br><span class="line">        <span class="keyword">self</span>.p2 <span class="operator">=</span> p2</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">==</span> (<span class="params">l</span>: <span class="type">C</span>, <span class="params">r</span>: <span class="type">C</span>)</span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> l.p1 <span class="operator">==</span> r.p1 <span class="operator">&amp;&amp;</span> l.p2 <span class="operator">==</span> r.p2</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> c1 <span class="operator">=</span> <span class="type">C</span>(p1: <span class="string">&quot;one&quot;</span>, p2: <span class="number">1</span>)</span><br><span class="line"><span class="keyword">let</span> c2 <span class="operator">=</span> <span class="type">C</span>(p1: <span class="string">&quot;one&quot;</span>, p2: <span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(c1 <span class="operator">==</span> c2)</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 元组比较</span></span><br><span class="line"><span class="comment">// 会先比较第一个数，第一个无法比较才会比较第二个数</span></span><br><span class="line"><span class="comment">// 字符串比较和字母大小还有长度有关。先比较字母大小，在比较长度</span></span><br><span class="line">(<span class="string">&quot;apple&quot;</span>, <span class="number">1</span>) <span class="operator">&lt;</span> (<span class="string">&quot;apple&quot;</span>, <span class="number">2</span>) <span class="comment">// true</span></span><br><span class="line">(<span class="string">&quot;applf&quot;</span>, <span class="number">1</span>) <span class="operator">&lt;</span> (<span class="string">&quot;apple&quot;</span>, <span class="number">2</span>) <span class="comment">// false</span></span><br><span class="line">(<span class="string">&quot;appl&quot;</span>, <span class="number">2</span>) <span class="operator">&lt;</span> (<span class="string">&quot;apple&quot;</span>, <span class="number">1</span>) <span class="comment">// true</span></span><br><span class="line">(<span class="string">&quot;appm&quot;</span>, <span class="number">2</span>) <span class="operator">&lt;</span> (<span class="string">&quot;apple&quot;</span>, <span class="number">1</span>) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h4 id="三元"><a href="#三元" class="headerlink" title="三元  ?  : _"></a>三元 <em> ? </em> : _</h4><p>简化 if else 写法</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// if else</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span>(<span class="params">p</span>: <span class="type">Int</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> p <span class="operator">&gt;</span> <span class="number">0</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;positive number&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;negative number&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 三元</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f2</span>(<span class="params">p</span>: <span class="type">Int</span>)</span> &#123;</span><br><span class="line">    p <span class="operator">&gt;</span> <span class="number">0</span> <span class="operator">?</span> <span class="built_in">print</span>(<span class="string">&quot;positive number&quot;</span>) : <span class="built_in">print</span>(<span class="string">&quot;negative number&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f1(p: <span class="number">1</span>)</span><br><span class="line">f2(p: <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Nil-coalescing"><a href="#Nil-coalescing" class="headerlink" title="Nil-coalescing ??"></a>Nil-coalescing ??</h4><p>简化 if let else 写法</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// if else</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span>(<span class="params">p</span>: <span class="type">Int</span>?)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> i <span class="operator">=</span> p &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;p have value is <span class="subst">\(i)</span>&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;p is nil, use defalut value&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 ??</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f2</span>(<span class="params">p</span>: <span class="type">Int</span>?)</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> i <span class="operator">=</span> p <span class="operator">??</span> <span class="number">0</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;p is <span class="subst">\(i)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="范围-a…b"><a href="#范围-a…b" class="headerlink" title="范围 a…b"></a>范围 a…b</h4><p>简化的值范围表达方式。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 封闭范围</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">...</span><span class="number">10</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 半开范围</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span><span class="number">10</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 单侧区间</span></span><br><span class="line"><span class="keyword">let</span> nums <span class="operator">=</span> [<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>]</span><br><span class="line"><span class="built_in">print</span>(nums[<span class="number">2</span><span class="operator">...</span>]) <span class="comment">// 7 8</span></span><br></pre></td></tr></table></figure>
<h4 id="逻辑-amp-amp"><a href="#逻辑-amp-amp" class="headerlink" title="逻辑 !, &amp;&amp;, ||"></a>逻辑 !, &amp;&amp;, ||</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> i1 <span class="operator">=</span> <span class="operator">-</span><span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> i2 <span class="operator">=</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> i1 <span class="operator">!=</span> i2 <span class="operator">&amp;&amp;</span> (i1 <span class="operator">&lt;</span> <span class="number">0</span> <span class="operator">||</span> i2 <span class="operator">&lt;</span> <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;i1 and i2 not equal, and one of them is negative number.&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="恒等"><a href="#恒等" class="headerlink" title="恒等 ===, !=="></a>恒等 ===, !==</h4><p>恒等返回是否引用了相同实例。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p: <span class="type">String</span></span><br><span class="line">    <span class="function"><span class="keyword">init</span>(<span class="params">p</span>: <span class="type">String</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.p <span class="operator">=</span> p</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> c1 <span class="operator">=</span> <span class="type">C</span>(p: <span class="string">&quot;one&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> c2 <span class="operator">=</span> <span class="type">C</span>(p: <span class="string">&quot;one&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> c3 <span class="operator">=</span> c1</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(c1 <span class="operator">===</span> c2) <span class="comment">// false</span></span><br><span class="line"><span class="built_in">print</span>(c1 <span class="operator">===</span> c3) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">print</span>(c1 <span class="operator">!==</span> c2) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h4 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h4><p>位运算符</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> i1: <span class="type">UInt8</span> <span class="operator">=</span> <span class="number">0b00001111</span></span><br><span class="line"><span class="keyword">let</span> i2 <span class="operator">=</span> <span class="operator">~</span>i1 <span class="comment">// Bitwise NOT Operator（按位取反运算符），取反</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> i3: <span class="type">UInt8</span> <span class="operator">=</span> <span class="number">0b00111111</span></span><br><span class="line"><span class="keyword">let</span> i4 <span class="operator">=</span> i1 <span class="operator">&amp;</span> i3 <span class="comment">// Bitwise AND Operator（按位与运算符），都为1才是1</span></span><br><span class="line"><span class="keyword">let</span> i5 <span class="operator">=</span> i1 <span class="operator">|</span> i3 <span class="comment">// Bitwise OR Operator（按位或运算符），有一个1就是1</span></span><br><span class="line"><span class="keyword">let</span> i6 <span class="operator">=</span> i1 <span class="operator">^</span> i3 <span class="comment">// Bitwise XOR Operator（按位异或运算符），不同为1，相同为0</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(i1,i2,i3,i4,i5,i6)</span><br><span class="line"></span><br><span class="line"><span class="comment">// &lt;&lt; 按位左移，&gt;&gt; 按位右移</span></span><br><span class="line"><span class="keyword">let</span> i7 <span class="operator">=</span> i1 <span class="operator">&lt;&lt;</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> i8 <span class="operator">=</span> i1 <span class="operator">&gt;&gt;</span> <span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(i7,i8)</span><br></pre></td></tr></table></figure>
<p>溢出运算符，有 &amp;+、&amp;- 和 &amp;*</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i1 <span class="operator">=</span> <span class="type">Int</span>.max</span><br><span class="line"><span class="built_in">print</span>(i1) <span class="comment">// 9223372036854775807</span></span><br><span class="line">i1 <span class="operator">=</span> i1 <span class="operator">&amp;+</span> <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(i1) <span class="comment">// -9223372036854775808</span></span><br><span class="line">i1 <span class="operator">=</span> i1 <span class="operator">&amp;+</span> <span class="number">10</span></span><br><span class="line"><span class="built_in">print</span>(i1) <span class="comment">// -9223372036854775798</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> i2 <span class="operator">=</span> <span class="type">UInt</span>.max</span><br><span class="line">i2 <span class="operator">=</span> i2 <span class="operator">&amp;+</span> <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(i2) <span class="comment">// 0</span></span><br></pre></td></tr></table></figure>
<p>运算符函数包括前缀运算符、后缀运算符、复合赋值运算符以及等价运算符。另，还可以自定义运算符，新的运算符要用 operator 关键字进行定义，同时要指定 prefix、infix 或者 postfix 修饰符。</p>
<h3 id="基础库"><a href="#基础库" class="headerlink" title="基础库"></a>基础库</h3><h4 id="时间"><a href="#时间" class="headerlink" title="时间"></a>时间</h4><p>Date 的基本用法如下：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> now <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Date 转 时间戳</span></span><br><span class="line"><span class="keyword">let</span> interval <span class="operator">=</span> now.timeIntervalSince1970 <span class="comment">// 时间戳</span></span><br><span class="line"><span class="keyword">let</span> df <span class="operator">=</span> <span class="type">DateFormatter</span>()</span><br><span class="line">df.dateFormat <span class="operator">=</span> <span class="string">&quot;yyyy 年 MM 月 dd 日 HH:mm:ss&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;时间戳：<span class="subst">\(Int(interval))</span>&quot;</span>) <span class="comment">// 时间戳：1642399901</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;格式化的时间：&quot;</span> <span class="operator">+</span> df.string(from: now)) <span class="comment">// 格式化的时间：2022 年 01 月 17 日 14:11:41</span></span><br><span class="line">df.dateStyle <span class="operator">=</span> .short</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;short 样式时间：&quot;</span> <span class="operator">+</span> df.string(from: now)) <span class="comment">// short 样式时间：2022/1/17</span></span><br><span class="line">df.locale <span class="operator">=</span> <span class="type">Locale</span>(identifier: <span class="string">&quot;zh_Hans_CN&quot;</span>)</span><br><span class="line">df.dateStyle <span class="operator">=</span> .full</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;full 样式时间：&quot;</span> <span class="operator">+</span> df.string(from: now)) <span class="comment">// full 样式时间：2022年1月17日 星期一</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 时间戳转 Date</span></span><br><span class="line"><span class="keyword">let</span> date <span class="operator">=</span> <span class="type">Date</span>(timeIntervalSince1970: interval)</span><br><span class="line"><span class="built_in">print</span>(date) <span class="comment">// 2022-01-17 06:11:41 +0000</span></span><br></pre></td></tr></table></figure></p>
<p>复杂的时间操作，比如说 GitHub 接口使用的是 ISO 标准，RSS 输出的是 RSS 标准字符串，不同标准对应不同时区的时间计算处理，可以使用开源库  <a target="_blank" rel="noopener" href="https://github.com/malcommac/SwiftDate">SwiftDate</a>  来完成。示例代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftDate</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 SwiftDate 库</span></span><br><span class="line"><span class="keyword">let</span> cn <span class="operator">=</span> <span class="type">Region</span>(zone: <span class="type">Zones</span>.asiaShanghai, locale: <span class="type">Locales</span>.chineseChina)</span><br><span class="line"><span class="type">SwiftDate</span>.defaultRegion <span class="operator">=</span> cn</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;2008-02-14 23:12:14&quot;</span>.toDate()<span class="operator">?</span>.year <span class="operator">??</span> <span class="string">&quot;&quot;</span>) <span class="comment">// 2008</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> d1 <span class="operator">=</span> <span class="string">&quot;2022-01-17T23:20:35&quot;</span>.toISODate(region: cn)</span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> d1 <span class="operator">=</span> d1 <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(d1.minute) <span class="comment">// 20</span></span><br><span class="line"><span class="keyword">let</span> d2 <span class="operator">=</span> d1 <span class="operator">+</span> <span class="number">1</span>.minutes</span><br><span class="line"><span class="built_in">print</span>(d2.minute)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 两个 DateInRegion 相差时间 interval</span></span><br><span class="line"><span class="keyword">let</span> i1 <span class="operator">=</span> <span class="type">DateInRegion</span>(<span class="type">Date</span>(), region: cn) <span class="operator">-</span> d1</span><br><span class="line"><span class="keyword">let</span> s1 <span class="operator">=</span> i1.toString &#123;</span><br><span class="line">    <span class="variable">$0</span>.maximumUnitCount <span class="operator">=</span> <span class="number">4</span></span><br><span class="line">    <span class="variable">$0</span>.allowedUnits <span class="operator">=</span> [.day, .hour, .minute]</span><br><span class="line">    <span class="variable">$0</span>.collapsesLargestUnit <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">    <span class="variable">$0</span>.unitsStyle <span class="operator">=</span> .abbreviated</span><br><span class="line">    <span class="variable">$0</span>.locale <span class="operator">=</span> <span class="type">Locales</span>.chineseChina</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(s1) <span class="comment">// 9小时45分钟</span></span><br></pre></td></tr></table></figure>
<h4 id="格式化"><a href="#格式化" class="headerlink" title="格式化"></a>格式化</h4><p>使用标准库的格式来描述不同场景的情况可以不用去考虑由于不同地区的区别，这些在标准库里就可以自动完成了。</p>
<p>描述两个时间之间相差多长时间<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 计算两个时间之间相差多少时间，支持多种语言字符串</span></span><br><span class="line"><span class="keyword">let</span> d1 <span class="operator">=</span> <span class="type">Date</span>().timeIntervalSince1970 <span class="operator">-</span> <span class="number">60</span> <span class="operator">*</span> <span class="number">60</span> <span class="operator">*</span> <span class="number">24</span></span><br><span class="line"><span class="keyword">let</span> f1 <span class="operator">=</span> <span class="type">RelativeDateTimeFormatter</span>()</span><br><span class="line">f1.dateTimeStyle <span class="operator">=</span> .named</span><br><span class="line">f1.formattingContext <span class="operator">=</span> .beginningOfSentence</span><br><span class="line">f1.locale <span class="operator">=</span> <span class="type">Locale</span>(identifier: <span class="string">&quot;zh_Hans_CN&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> str <span class="operator">=</span> f1.localizedString(for: <span class="type">Date</span>(timeIntervalSince1970: d1), relativeTo: <span class="type">Date</span>())</span><br><span class="line"><span class="built_in">print</span>(str) <span class="comment">// 昨天</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 简写</span></span><br><span class="line"><span class="keyword">let</span> str2 <span class="operator">=</span> <span class="type">Date</span>.now.addingTimeInterval(<span class="operator">-</span>(<span class="number">60</span> <span class="operator">*</span> <span class="number">60</span> <span class="operator">*</span> <span class="number">24</span>))</span><br><span class="line">    .formatted(.relative(presentation: .named))</span><br><span class="line"><span class="built_in">print</span>(str2) <span class="comment">// yesterday</span></span><br></pre></td></tr></table></figure></p>
<p>描述多个事物<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 描述多个事物</span></span><br><span class="line"><span class="keyword">let</span> s1 <span class="operator">=</span> <span class="type">ListFormatter</span>.localizedString(byJoining: [<span class="string">&quot;冬天&quot;</span>,<span class="string">&quot;春天&quot;</span>,<span class="string">&quot;夏天&quot;</span>,<span class="string">&quot;秋天&quot;</span>])</span><br><span class="line"><span class="built_in">print</span>(s1)</span><br></pre></td></tr></table></figure></p>
<p>描述名字<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 名字</span></span><br><span class="line"><span class="keyword">let</span> f2 <span class="operator">=</span> <span class="type">PersonNameComponentsFormatter</span>()</span><br><span class="line"><span class="keyword">var</span> nc1 <span class="operator">=</span> <span class="type">PersonNameComponents</span>()</span><br><span class="line">nc1.familyName <span class="operator">=</span> <span class="string">&quot;戴&quot;</span></span><br><span class="line">nc1.givenName <span class="operator">=</span> <span class="string">&quot;铭&quot;</span></span><br><span class="line">nc1.nickname <span class="operator">=</span> <span class="string">&quot;铭哥&quot;</span></span><br><span class="line"><span class="built_in">print</span>(f2.string(from: nc1)) <span class="comment">// 戴铭</span></span><br><span class="line">f2.style <span class="operator">=</span> .short</span><br><span class="line"><span class="built_in">print</span>(f2.string(from: nc1)) <span class="comment">// 铭哥</span></span><br><span class="line">f2.style <span class="operator">=</span> .abbreviated</span><br><span class="line"><span class="built_in">print</span>(f2.string(from: nc1)) <span class="comment">// 戴</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> nc2 <span class="operator">=</span> <span class="type">PersonNameComponents</span>()</span><br><span class="line">nc2.familyName <span class="operator">=</span> <span class="string">&quot;Dai&quot;</span></span><br><span class="line">nc2.givenName <span class="operator">=</span> <span class="string">&quot;Ming&quot;</span></span><br><span class="line">nc2.nickname <span class="operator">=</span> <span class="string">&quot;Starming&quot;</span></span><br><span class="line">f2.style <span class="operator">=</span> .default</span><br><span class="line"><span class="built_in">print</span>(f2.string(from: nc2)) <span class="comment">// Ming Dai</span></span><br><span class="line">f2.style <span class="operator">=</span> .short</span><br><span class="line"><span class="built_in">print</span>(f2.string(from: nc2)) <span class="comment">// Starming</span></span><br><span class="line">f2.style <span class="operator">=</span> .abbreviated</span><br><span class="line"><span class="built_in">print</span>(f2.string(from: nc2)) <span class="comment">// MD</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 取出名</span></span><br><span class="line"><span class="keyword">let</span> componets <span class="operator">=</span> f2.personNameComponents(from: <span class="string">&quot;戴铭&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(componets<span class="operator">?</span>.givenName <span class="operator">??</span> <span class="string">&quot;&quot;</span>) <span class="comment">// 铭</span></span><br></pre></td></tr></table></figure></p>
<p>描述数字<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数字</span></span><br><span class="line"><span class="keyword">let</span> f3 <span class="operator">=</span> <span class="type">NumberFormatter</span>()</span><br><span class="line">f3.locale <span class="operator">=</span> <span class="type">Locale</span>(identifier: <span class="string">&quot;zh_Hans_CN&quot;</span>)</span><br><span class="line">f3.numberStyle <span class="operator">=</span> .currency</span><br><span class="line"><span class="built_in">print</span>(f3.string(from: <span class="number">123456</span>) <span class="operator">??</span> <span class="string">&quot;&quot;</span>) <span class="comment">// ¥123,456.00</span></span><br><span class="line">f3.numberStyle <span class="operator">=</span> .percent</span><br><span class="line"><span class="built_in">print</span>(f3.string(from: <span class="number">123456</span>) <span class="operator">??</span> <span class="string">&quot;&quot;</span>) <span class="comment">// 12,345,600%</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> n1 <span class="operator">=</span> <span class="number">1.23456</span></span><br><span class="line"><span class="keyword">let</span> n1Str <span class="operator">=</span> n1.formatted(.number.precision(.fractionLength(<span class="number">3</span>)).rounded())</span><br><span class="line"><span class="built_in">print</span>(n1Str) <span class="comment">// 1.235</span></span><br></pre></td></tr></table></figure></p>
<p>描述地址<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 地址</span></span><br><span class="line"><span class="keyword">import</span> Contacts</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> f4 <span class="operator">=</span> <span class="type">CNPostalAddressFormatter</span>()</span><br><span class="line"><span class="keyword">let</span> address <span class="operator">=</span> <span class="type">CNMutablePostalAddress</span>()</span><br><span class="line">address.street <span class="operator">=</span> <span class="string">&quot;海淀区王庄路XX号院X号楼X门XXX&quot;</span></span><br><span class="line">address.postalCode <span class="operator">=</span> <span class="string">&quot;100083&quot;</span></span><br><span class="line">address.city <span class="operator">=</span> <span class="string">&quot;北京&quot;</span></span><br><span class="line">address.country <span class="operator">=</span> <span class="string">&quot;中国&quot;</span></span><br><span class="line"><span class="built_in">print</span>(f4.string(from: address))</span><br><span class="line"><span class="comment">/// 海淀区王庄路XX号院X号楼X门XXX</span></span><br><span class="line"><span class="comment">/// 北京 100083</span></span><br><span class="line"><span class="comment">/// 中国</span></span><br></pre></td></tr></table></figure></p>
<h4 id="度量值"><a href="#度量值" class="headerlink" title="度量值"></a>度量值</h4><p>标准库里的物理量，在这个文档里有详细列出，包括角度、平方米等。<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 参考：https://developer.apple.com/documentation/foundation/nsdimension</span></span><br><span class="line"><span class="keyword">let</span> m1 <span class="operator">=</span> <span class="type">Measurement</span>(value: <span class="number">1</span>, unit: <span class="type">UnitLength</span>.kilometers)</span><br><span class="line"><span class="keyword">let</span> m2 <span class="operator">=</span> m1.converted(to: .meters) <span class="comment">// 千米转米</span></span><br><span class="line"><span class="built_in">print</span>(m2) <span class="comment">// 1000.0 m</span></span><br><span class="line"><span class="comment">// 度量值转为本地化的值</span></span><br><span class="line"><span class="keyword">let</span> mf <span class="operator">=</span> <span class="type">MeasurementFormatter</span>()</span><br><span class="line">mf.locale <span class="operator">=</span> <span class="type">Locale</span>(identifier: <span class="string">&quot;zh_Hans_CN&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(mf.string(from: m1)) <span class="comment">// 1公里</span></span><br></pre></td></tr></table></figure></p>
<p>一些物理公式供参考：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">面积 = 长度 × 长度</span><br><span class="line">体积 = 长度 × 长度 × 长度 = 面积 × 长度</span><br><span class="line"></span><br><span class="line">速度=长度/时间</span><br><span class="line">加速度=速度/时间</span><br><span class="line"></span><br><span class="line">力 = 质量 × 加速度</span><br><span class="line">扭矩 = 力 × 长度</span><br><span class="line">压力 = 力 / 面积</span><br><span class="line"></span><br><span class="line">密度=质量 / 体积</span><br><span class="line">能量 = 功率 × 时间</span><br><span class="line">电阻 = 电压 / 电流</span><br></pre></td></tr></table></figure></p>
<h4 id="Data"><a href="#Data" class="headerlink" title="Data"></a>Data</h4><p>数据压缩和解压<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对数据的压缩</span></span><br><span class="line"><span class="keyword">let</span> d1 <span class="operator">=</span> <span class="string">&quot;看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？&quot;</span>.data(using: .utf8)<span class="operator">!</span> <span class="keyword">as</span> <span class="type">NSData</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;ori <span class="subst">\(d1.count)</span> bytes&quot;</span>)</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="comment">/// 压缩算法</span></span><br><span class="line">    <span class="comment">/// * lz4</span></span><br><span class="line">    <span class="comment">/// * lzma</span></span><br><span class="line">    <span class="comment">/// * zlib</span></span><br><span class="line">    <span class="comment">/// * lzfse</span></span><br><span class="line">    <span class="keyword">let</span> compressed <span class="operator">=</span> <span class="keyword">try</span> d1.compressed(using: .zlib)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;comp <span class="subst">\(compressed.count)</span> bytes&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 对数据解压</span></span><br><span class="line">    <span class="keyword">let</span> decomressed <span class="operator">=</span> <span class="keyword">try</span> compressed.decompressed(using: .zlib)</span><br><span class="line">    <span class="keyword">let</span> deStr <span class="operator">=</span> <span class="type">String</span>(data: decomressed <span class="keyword">as</span> <span class="type">Data</span>, encoding: .utf8)</span><br><span class="line">    <span class="built_in">print</span>(deStr <span class="operator">??</span> <span class="string">&quot;&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;&#125;</span><br><span class="line"><span class="comment">/// ori 297 bytes</span></span><br><span class="line"><span class="comment">/// comp 37 bytes</span></span><br></pre></td></tr></table></figure></p>
<h4 id="文件"><a href="#文件" class="headerlink" title="文件"></a>文件</h4><p>文件的一些基本操作的代码如下：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> path1 <span class="operator">=</span> <span class="string">&quot;/Users/mingdai/Downloads/1.html&quot;</span></span><br><span class="line"><span class="keyword">let</span> path2 <span class="operator">=</span> <span class="string">&quot;/Users/mingdai/Documents/GitHub/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> u1 <span class="operator">=</span> <span class="type">URL</span>(string: path1)</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="comment">// 写入</span></span><br><span class="line">    <span class="keyword">let</span> url1 <span class="operator">=</span> <span class="keyword">try</span> <span class="type">FileManager</span>.default.url(for: .itemReplacementDirectory, in: .userDomainMask, appropriateFor: u1, create: <span class="literal">true</span>) <span class="comment">// 保证原子性安全保存</span></span><br><span class="line">    <span class="built_in">print</span>(url1)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取</span></span><br><span class="line">    <span class="keyword">let</span> s1 <span class="operator">=</span> <span class="keyword">try</span> <span class="type">String</span>(contentsOfFile: path1, encoding: .utf8)</span><br><span class="line">    <span class="built_in">print</span>(s1)</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查路径是否可用</span></span><br><span class="line"><span class="keyword">let</span> u2 <span class="operator">=</span> <span class="type">URL</span>(fileURLWithPath:path2)</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> values <span class="operator">=</span> <span class="keyword">try</span> u2.resourceValues(forKeys: [.volumeAvailableCapacityForImportantUsageKey])</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> capacity <span class="operator">=</span> values.volumeAvailableCapacityForImportantUsage &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;可用: <span class="subst">\(capacity)</span>&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;不可用&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;错误: <span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>怎么遍历多级目录结构中的文件呢？看下面的代码的实现：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 遍历路径下所有目录</span></span><br><span class="line"><span class="keyword">let</span> u3 <span class="operator">=</span> <span class="type">URL</span>(fileURLWithPath: <span class="type">FileManager</span>.default.currentDirectoryPath)</span><br><span class="line"><span class="keyword">let</span> fm <span class="operator">=</span> <span class="type">FileManager</span>.default</span><br><span class="line">fm.enumerator(atPath: u3.path)<span class="operator">?</span>.forEach(&#123; path <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> path <span class="operator">=</span> path <span class="keyword">as?</span> <span class="type">String</span> <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> url <span class="operator">=</span> <span class="type">URL</span>(fileURLWithPath: path, relativeTo: u3)</span><br><span class="line">    <span class="built_in">print</span>(url.lastPathComponent)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>可以使用 FileWrapper 来创建文件夹和文件。举个例子：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// FileWrapper 的使用</span></span><br><span class="line"><span class="comment">// 创建文件</span></span><br><span class="line"><span class="keyword">let</span> f1 <span class="operator">=</span> <span class="type">FileWrapper</span>(regularFileWithContents: <span class="type">Data</span>(<span class="string">&quot;# 第 n 个文件<span class="subst">\n</span> ## 标题&quot;</span>.utf8))</span><br><span class="line">f1.fileAttributes[<span class="type">FileAttributeKey</span>.creationDate.rawValue] <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line">f1.fileAttributes[<span class="type">FileAttributeKey</span>.modificationDate.rawValue] <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line"><span class="comment">// 创建文件夹</span></span><br><span class="line"><span class="keyword">let</span> folder1 <span class="operator">=</span> <span class="type">FileWrapper</span>(directoryWithFileWrappers: [</span><br><span class="line">    <span class="string">&quot;file1.md&quot;</span>: f1</span><br><span class="line">])</span><br><span class="line">folder1.fileAttributes[<span class="type">FileAttributeKey</span>.creationDate.rawValue] <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line">folder1.fileAttributes[<span class="type">FileAttributeKey</span>.modificationDate.rawValue] <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> folder1.write(</span><br><span class="line">        to: <span class="type">URL</span>(fileURLWithPath: <span class="type">FileManager</span>.default.currentDirectoryPath).appendingPathComponent(<span class="string">&quot;NewFolder&quot;</span>),</span><br><span class="line">        options: .atomic,</span><br><span class="line">        originalContentsURL: <span class="literal">nil</span></span><br><span class="line">    )</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="type">FileManager</span>.default.currentDirectoryPath)</span><br></pre></td></tr></table></figure></p>
<p>上面代码写起来比较繁琐，对 FileWrapper 更好的封装可以参考这篇文章《 <a target="_blank" rel="noopener" href="https://heberti.com/posts/filewrapper/">A Type-Safe FileWrapper | Heberti Almeida</a> 》。</p>
<p>文件读写处理完整能力可以参看这个库  <a target="_blank" rel="noopener" href="https://github.com/JohnSundell/Files">GitHub - JohnSundell/Files: A nicer way to handle files &amp; folders in Swift</a> </p>
<p>本地或者网络上，比如网盘和FTP的文件发生变化时，怎样知道能够观察到呢？</p>
<p>通过 HTTPHeader 里的 If-Modified-Since、Last-Modified、If-None-Match 和 Etag 等字段来判断文件的变化，本地则是使用 DispatchSource.makeFileSystemObjectSource 来进行的文件变化监听。可以参考  <a target="_blank" rel="noopener" href="https://github.com/krzysztofzablocki/KZFileWatchers">KZFileWatchers</a>  库的做法。</p>
<h4 id="Scanner"><a href="#Scanner" class="headerlink" title="Scanner"></a>Scanner</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s1 <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">one1,</span></span><br><span class="line"><span class="string">two2,</span></span><br><span class="line"><span class="string">three3.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">let</span> sn1 <span class="operator">=</span> <span class="type">Scanner</span>(string: s1)</span><br><span class="line"><span class="keyword">while</span> <span class="operator">!</span>sn1.isAtEnd &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> r1 <span class="operator">=</span> sn1.scanUpToCharacters(from: .newlines) &#123;</span><br><span class="line">        <span class="built_in">print</span>(r1 <span class="keyword">as</span> <span class="type">String</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/// one1,</span></span><br><span class="line"><span class="comment">/// two2,</span></span><br><span class="line"><span class="comment">/// three3.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 找出数字</span></span><br><span class="line"><span class="keyword">let</span> sn2 <span class="operator">=</span> <span class="type">Scanner</span>(string: s1)</span><br><span class="line">sn2.charactersToBeSkipped <span class="operator">=</span> <span class="type">CharacterSet</span>.decimalDigits.inverted <span class="comment">// 不是数字的就跳过</span></span><br><span class="line"><span class="keyword">var</span> p: <span class="type">Int</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="operator">!</span>sn2.isAtEnd &#123;</span><br><span class="line">    <span class="keyword">if</span> sn2.scanInt(<span class="operator">&amp;</span>p) &#123;</span><br><span class="line">        <span class="built_in">print</span>(p)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/// 1</span></span><br><span class="line"><span class="comment">/// 2</span></span><br><span class="line"><span class="comment">/// 3</span></span><br></pre></td></tr></table></figure>
<p>上面的代码还不是那么 Swifty，可以通过用AnySequence和AnyIterator来包装下，将序列中的元素推迟到实际需要时再来处理，这样性能也会更好些。具体实现可以参看《 <a target="_blank" rel="noopener" href="https://www.swiftbysundell.com/articles/string-parsing-in-swift/">String parsing in Swift</a> 》这篇文章。</p>
<h4 id="AttributeString"><a href="#AttributeString" class="headerlink" title="AttributeString"></a>AttributeString</h4><p>效果如下：</p>
<p><img src="https://user-images.githubusercontent.com/251980/150132322-20c5c2d4-6452-4d06-9202-4b93cffd8133.png" alt=""></p>
<p>代码如下：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> aStrs <span class="operator">=</span> [<span class="type">AttributedString</span>]()</span><br><span class="line"><span class="keyword">var</span> aStr1 <span class="operator">=</span> <span class="type">AttributedString</span>(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">标题</span></span><br><span class="line"><span class="string">正文内容，具体查看链接。</span></span><br><span class="line"><span class="string">这里摘出第一个重点，还要强调的内容。</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>)</span><br><span class="line"><span class="comment">// 标题</span></span><br><span class="line"><span class="keyword">let</span> title <span class="operator">=</span> aStr1.range(of: <span class="string">&quot;标题&quot;</span>)</span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> title <span class="operator">=</span> title <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> aStrs</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c1 <span class="operator">=</span> <span class="type">AttributeContainer</span>() <span class="comment">// 可复用容器</span></span><br><span class="line">c1.inlinePresentationIntent <span class="operator">=</span> .stronglyEmphasized</span><br><span class="line">c1.font <span class="operator">=</span> .largeTitle</span><br><span class="line">aStr1[title].setAttributes(c1)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 链接</span></span><br><span class="line"><span class="keyword">let</span> link <span class="operator">=</span> aStr1.range(of: <span class="string">&quot;链接&quot;</span>)</span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> link <span class="operator">=</span> link <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> aStrs</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c2 <span class="operator">=</span> <span class="type">AttributeContainer</span>() <span class="comment">// 链接</span></span><br><span class="line">c2.strokeColor <span class="operator">=</span> .blue</span><br><span class="line">c2.link <span class="operator">=</span> <span class="type">URL</span>(string: <span class="string">&quot;https://ming1016.github.io/&quot;</span>)</span><br><span class="line">aStr1[link].setAttributes(c2.merging(c1)) <span class="comment">// 合并 AttributeContainer</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Runs</span></span><br><span class="line"><span class="keyword">let</span> i1 <span class="operator">=</span> aStr1.range(of: <span class="string">&quot;重点&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> i2 <span class="operator">=</span> aStr1.range(of: <span class="string">&quot;强调&quot;</span>)</span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> i1 <span class="operator">=</span> i1, <span class="keyword">let</span> i2 <span class="operator">=</span> i2 <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> aStrs</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c3 <span class="operator">=</span> <span class="type">AttributeContainer</span>()</span><br><span class="line">c3.foregroundColor <span class="operator">=</span> .yellow</span><br><span class="line">c3.inlinePresentationIntent <span class="operator">=</span> .stronglyEmphasized</span><br><span class="line">aStr1[i1].setAttributes(c3)</span><br><span class="line">aStr1[i2].setAttributes(c3)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> r <span class="keyword">in</span> aStr1.runs &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;-------------&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(r.attributes)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">aStrs.append(aStr1)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Markdown</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> aStr2 <span class="operator">=</span> <span class="keyword">try</span> <span class="type">AttributedString</span>(markdown: <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    内容[链接](https://ming1016.github.io/)。需要**强调**的内容。</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    aStrs.append(aStr2)</span><br><span class="line">    </span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;&#125;</span><br></pre></td></tr></table></figure></p>
<p>SwiftUI 的 Text 可以直接读取 AttributedString 来进行显示。</p>
<h4 id="随机"><a href="#随机" class="headerlink" title="随机"></a>随机</h4><p>用法：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ri <span class="operator">=</span> <span class="type">Int</span>.random(in: <span class="number">0</span><span class="operator">..&lt;</span><span class="number">10</span>)</span><br><span class="line"><span class="built_in">print</span>(ri) <span class="comment">// 0到10随机数</span></span><br><span class="line"><span class="keyword">let</span> a <span class="operator">=</span> [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="built_in">print</span>(a.randomElement() <span class="operator">??</span> <span class="number">0</span>) <span class="comment">// 数组中随机取个数</span></span><br><span class="line"><span class="built_in">print</span>(a.shuffled()) <span class="comment">// 随机打乱数组顺序</span></span><br></pre></td></tr></table></figure></p>
<h4 id="UserDefaults"><a href="#UserDefaults" class="headerlink" title="UserDefaults"></a>UserDefaults</h4><p>使用方法如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">UDKey</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> k1 <span class="operator">=</span> <span class="string">&quot;token&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> ud <span class="operator">=</span> <span class="type">UserDefaults</span>.standard</span><br><span class="line">ud.set(<span class="string">&quot;xxxxxx&quot;</span>, forKey: <span class="type">UDKey</span>.k1)</span><br><span class="line"><span class="keyword">let</span> tk <span class="operator">=</span> ud.string(forKey: <span class="type">UDKey</span>.k1)</span><br><span class="line"><span class="built_in">print</span>(tk <span class="operator">??</span> <span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="模式"><a href="#模式" class="headerlink" title="模式"></a>模式</h3><h4 id="单例"><a href="#单例" class="headerlink" title="单例"></a>单例</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> shared <span class="operator">=</span> <span class="type">S</span>()</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">init</span>()</span> &#123;</span><br><span class="line">        <span class="comment">// 防止实例初始化</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="系统及设备"><a href="#系统及设备" class="headerlink" title="系统及设备"></a>系统及设备</h3><h4 id="系统判断"><a href="#系统判断" class="headerlink" title="系统判断"></a>系统判断</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">#if</span> os(tvOS)</span><br><span class="line">     <span class="comment">// do something in tvOS</span></span><br><span class="line"><span class="keyword">#elseif</span> os(iOS)</span><br><span class="line">     <span class="comment">// do somthing in iOS</span></span><br><span class="line"><span class="keyword">#elseif</span> os(macOS)</span><br><span class="line">    <span class="comment">// do somthing in macOS</span></span><br><span class="line"><span class="keyword">#endif</span></span><br></pre></td></tr></table></figure>
<h4 id="版本兼容"><a href="#版本兼容" class="headerlink" title="版本兼容"></a>版本兼容</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 版本</span></span><br><span class="line"><span class="keyword">@available</span>(<span class="keyword">iOS</span> <span class="number">15</span>, <span class="operator">*</span>)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span>()</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 版本检查</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">#available</span>(<span class="keyword">iOS</span> <span class="number">15</span>, <span class="keyword">macOS</span> <span class="number">12</span>, <span class="operator">*</span>) &#123;</span><br><span class="line">    f()</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// nothing happen</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="canImport-判断库是否可使用"><a href="#canImport-判断库是否可使用" class="headerlink" title="canImport 判断库是否可使用"></a>canImport 判断库是否可使用</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">#if</span> canImport(<span class="type">SpriteKit</span>)</span><br><span class="line">   <span class="comment">// iOS 等苹果系统执行</span></span><br><span class="line"><span class="keyword">#else</span></span><br><span class="line">   <span class="comment">// 非苹果系统</span></span><br><span class="line"><span class="keyword">#endif</span></span><br></pre></td></tr></table></figure>
<h4 id="targetEnvironment-环境的判断"><a href="#targetEnvironment-环境的判断" class="headerlink" title="targetEnvironment 环境的判断"></a>targetEnvironment 环境的判断</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">#if</span> targetEnvironment(simulator)</span><br><span class="line">   <span class="comment">// 模拟器</span></span><br><span class="line"><span class="keyword">#else</span></span><br><span class="line">   <span class="comment">// 真机</span></span><br><span class="line"><span class="keyword">#endif</span></span><br></pre></td></tr></table></figure>
<h3 id="自带属性包装"><a href="#自带属性包装" class="headerlink" title="自带属性包装"></a>自带属性包装</h3><h4 id="resultBuilder"><a href="#resultBuilder" class="headerlink" title="@resultBuilder"></a>@resultBuilder</h4><p>结果生成器（Result builders），通过传递序列创建新值，SwiftUI就是使用的结果生成器将多个视图生成一个视图</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@resultBuilder</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">RBS</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 基本闭包支持</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">buildBlock</span>(<span class="keyword">_</span> <span class="params">components</span>: <span class="type">Int</span>...)</span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        components.reduce(<span class="number">0</span>) &#123; partialResult, i <span class="keyword">in</span></span><br><span class="line">            partialResult <span class="operator">+</span> i</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 支持条件判断</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">buildEither</span>(<span class="params">first</span> <span class="params">component</span>: <span class="type">Int</span>)</span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        component</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">buildEither</span>(<span class="params">second</span> <span class="params">component</span>: <span class="type">Int</span>)</span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        component</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 支持循环</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">buildArray</span>(<span class="keyword">_</span> <span class="params">components</span>: [<span class="type">Int</span>])</span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        components.reduce(<span class="number">0</span>) &#123; partialResult, i <span class="keyword">in</span></span><br><span class="line">            partialResult <span class="operator">+</span> i</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a <span class="operator">=</span> <span class="type">RBS</span>.buildBlock(</span><br><span class="line">    <span class="number">1</span>,</span><br><span class="line">    <span class="number">2</span>,</span><br><span class="line">    <span class="number">3</span></span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(a) <span class="comment">// 6</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 应用到函数中</span></span><br><span class="line"><span class="meta">@RBS</span> <span class="function"><span class="keyword">func</span> <span class="title">f1</span>()</span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="number">1</span></span><br><span class="line">    <span class="number">2</span></span><br><span class="line">    <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(f1()) <span class="comment">// 6</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置了 buildEither 就可以在闭包中进行条件判断。</span></span><br><span class="line"><span class="meta">@RBS</span> <span class="function"><span class="keyword">func</span> <span class="title">f2</span>(<span class="params">stopAtThree</span>: <span class="type">Bool</span>)</span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="number">1</span></span><br><span class="line">    <span class="number">2</span></span><br><span class="line">    <span class="number">3</span></span><br><span class="line">    <span class="keyword">if</span> stopAtThree <span class="operator">==</span> <span class="literal">true</span> &#123;</span><br><span class="line">        <span class="number">0</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="number">4</span></span><br><span class="line">        <span class="number">5</span></span><br><span class="line">        <span class="number">6</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(f2(stopAtThree: <span class="literal">false</span>)) <span class="comment">// 21</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置了 buildArray 就可以在闭包内使用循环了</span></span><br><span class="line"><span class="meta">@RBS</span> <span class="function"><span class="keyword">func</span> <span class="title">f3</span>()</span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span><span class="operator">...</span><span class="number">3</span> &#123;</span><br><span class="line">        i <span class="operator">*</span> <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(f3()) <span class="comment">// 12</span></span><br></pre></td></tr></table></figure>
<h4 id="dynamicMemberLookup-动态成员查询"><a href="#dynamicMemberLookup-动态成员查询" class="headerlink" title="@dynamicMemberLookup 动态成员查询"></a>@dynamicMemberLookup 动态成员查询</h4><p>@dynamicMemberLookup 指示访问属性时调用一个已实现的处理动态查找的下标方法 subscript(dynamicMemeber:)，通过指定属性字符串名返回值。使用方法如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@dynamicMemberLookup</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">D</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 找字符串</span></span><br><span class="line">    <span class="function"><span class="keyword">subscript</span>(<span class="params">dynamicMember</span> <span class="params">m</span>: <span class="type">String</span>)</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> p <span class="operator">=</span> [<span class="string">&quot;one&quot;</span>: <span class="string">&quot;first&quot;</span>, <span class="string">&quot;two&quot;</span>: <span class="string">&quot;second&quot;</span>]</span><br><span class="line">        <span class="keyword">return</span> p[m, <span class="keyword">default</span>: <span class="string">&quot;&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 找整型</span></span><br><span class="line">    <span class="function"><span class="keyword">subscript</span>(<span class="params">dynamicMember</span> <span class="params">m</span>: <span class="type">String</span>)</span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> p <span class="operator">=</span> [<span class="string">&quot;one&quot;</span>: <span class="number">1</span>, <span class="string">&quot;two&quot;</span>: <span class="number">2</span>]</span><br><span class="line">        <span class="keyword">return</span> p[m, <span class="keyword">default</span>: <span class="number">0</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 找闭包</span></span><br><span class="line">    <span class="function"><span class="keyword">subscript</span>(<span class="params">dynamicMember</span> <span class="params">m</span>: <span class="type">String</span>)</span> -&gt; (<span class="keyword">_</span> s: <span class="type">String</span>) -&gt; <span class="type">Void</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;show <span class="subst">\(<span class="variable">$0</span>)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 静态数组成员</span></span><br><span class="line">    <span class="keyword">var</span> p <span class="operator">=</span> [<span class="string">&quot;This is a member&quot;</span>]</span><br><span class="line">    <span class="comment">// 动态数组成员</span></span><br><span class="line">    <span class="function"><span class="keyword">subscript</span>(<span class="params">dynamicMember</span> <span class="params">m</span>: <span class="type">String</span>)</span> -&gt; [<span class="type">String</span>] &#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&quot;This is a dynamic member&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> d <span class="operator">=</span> <span class="type">D</span>()</span><br><span class="line"><span class="keyword">let</span> s1: <span class="type">String</span> <span class="operator">=</span> d.one</span><br><span class="line"><span class="built_in">print</span>(s1) <span class="comment">// first</span></span><br><span class="line"><span class="keyword">let</span> i1: <span class="type">Int</span> <span class="operator">=</span> d.one</span><br><span class="line"><span class="built_in">print</span>(i1) <span class="comment">// 1</span></span><br><span class="line">d.show(<span class="string">&quot;something&quot;</span>) <span class="comment">// show something</span></span><br><span class="line"><span class="built_in">print</span>(d.p) <span class="comment">// [&quot;This is a member&quot;]</span></span><br><span class="line"><span class="keyword">let</span> dynamicP:[<span class="type">String</span>] <span class="operator">=</span> d.dp</span><br><span class="line"><span class="built_in">print</span>(dynamicP) <span class="comment">// [&quot;This is a dynamic member&quot;]</span></span><br></pre></td></tr></table></figure>
<p>类使用 @dynamicMemberLookup，继承的类也会自动加上 @dynamicMemberLookup。协议上定义 @dynamicMemberLookup，通过扩展可以默认实现 subscript(dynamicMember:) 方法。</p>
<h4 id="dynamicCallable-动态可调用类型"><a href="#dynamicCallable-动态可调用类型" class="headerlink" title="@dynamicCallable 动态可调用类型"></a>@dynamicCallable 动态可调用类型</h4><p>@dynamicCallable 动态可调用类型。通过实现 dynamicallyCall 方法来定义变参的处理。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@dynamicCallable</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">D</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 带参数说明</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">dynamicallyCall</span>(<span class="params">withKeywordArguments</span> <span class="params">args</span>: <span class="type">KeyValuePairs</span>&lt;<span class="type">String</span>, <span class="type">Int</span>&gt;)</span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> firstArg <span class="operator">=</span> args.first<span class="operator">?</span>.value <span class="operator">??</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> firstArg <span class="operator">*</span> <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 无参数说明</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">dynamicallyCall</span>(<span class="params">withArguments</span> <span class="params">args</span>: [<span class="type">String</span>])</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> firstArg <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> args.count <span class="operator">&gt;</span> <span class="number">0</span> &#123;</span><br><span class="line">            firstArg <span class="operator">=</span> args[<span class="number">0</span>]</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;show <span class="subst">\(firstArg)</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> d <span class="operator">=</span> <span class="type">D</span>()</span><br><span class="line"><span class="keyword">let</span> i <span class="operator">=</span> d(numberIs: <span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(i) <span class="comment">// 4</span></span><br><span class="line"><span class="keyword">let</span> s <span class="operator">=</span> d(<span class="string">&quot;hi&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(s) <span class="comment">// show hi</span></span><br></pre></td></tr></table></figure>
<h3 id="自带协议"><a href="#自带协议" class="headerlink" title="自带协议"></a>自带协议</h3><h4 id="Hashable"><a href="#Hashable" class="headerlink" title="Hashable"></a>Hashable</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">H</span>: <span class="title">Hashable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p1: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> p2: <span class="type">Int</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 提供随机 seed</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">hash</span>(<span class="params">into</span> <span class="params">hasher</span>: <span class="keyword">inout</span> <span class="type">Hasher</span>)</span> &#123;</span><br><span class="line">        hasher.combine(p1)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> h1 <span class="operator">=</span> <span class="type">H</span>(p1: <span class="string">&quot;one&quot;</span>, p2: <span class="number">1</span>)</span><br><span class="line"><span class="keyword">let</span> h2 <span class="operator">=</span> <span class="type">H</span>(p1: <span class="string">&quot;two&quot;</span>, p2: <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> hs1 <span class="operator">=</span> <span class="type">Hasher</span>()</span><br><span class="line">hs1.combine(h1)</span><br><span class="line">hs1.combine(h2)</span><br><span class="line"><span class="built_in">print</span>(h1.hashValue) <span class="comment">// 7417088153212460033 随机值</span></span><br><span class="line"><span class="built_in">print</span>(h2.hashValue) <span class="comment">// -6972912482785541972 随机值</span></span><br><span class="line"><span class="built_in">print</span>(hs1.finalize()) <span class="comment">// 7955861102637572758 随机值</span></span><br><span class="line"><span class="built_in">print</span>(h1.hashValue) <span class="comment">// 7417088153212460033 和前面 h1 一样</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> h3 <span class="operator">=</span> <span class="type">H</span>(p1: <span class="string">&quot;one&quot;</span>, p2: <span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(h3.hashValue) <span class="comment">// 7417088153212460033 和前面 h1 一样</span></span><br><span class="line"><span class="keyword">var</span> hs2 <span class="operator">=</span> <span class="type">Hasher</span>()</span><br><span class="line">hs2.combine(h3)</span><br><span class="line">hs2.combine(h2)</span><br><span class="line"><span class="built_in">print</span>(hs2.finalize()) <span class="comment">// 7955861102637572758 和前面 hs1 一样</span></span><br></pre></td></tr></table></figure>
<p>应用生命周期内，调用 combine() 添加相同属性哈希值相同，由于 Hasher 每次都会使用随机的 seed，因此不同应用生命周期，也就是下次启动的哈希值，就会和上次的哈希值不同。</p>
<h3 id="Codable"><a href="#Codable" class="headerlink" title="Codable"></a>Codable</h3><h4 id="JSON-没有-id-字段"><a href="#JSON-没有-id-字段" class="headerlink" title="JSON 没有 id 字段"></a>JSON 没有 id 字段</h4><p>如果SwiftUI要求数据Model都是遵循Identifiable协议的，而有的json没有id这个字段，可以使用扩展struct的方式解决：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CommitModel</span>: <span class="title">Decodable</span>, <span class="title">Hashable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> sha: <span class="type">String</span></span><br><span class="line">  <span class="keyword">var</span> author: <span class="type">AuthorModel</span></span><br><span class="line">  <span class="keyword">var</span> commit: <span class="type">CommitModel</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">CommitModel</span>: <span class="title">Identifiable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> id: <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> sha</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h3><h4 id="网络状态检查"><a href="#网络状态检查" class="headerlink" title="网络状态检查"></a>网络状态检查</h4><p>通过 Network 库的 NWPathMonitor 来检查</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"><span class="keyword">import</span> Network</span><br><span class="line"></span><br><span class="line"><span class="comment">// 网络状态检查 network state check</span></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Nsck</span>: <span class="title">ObservableObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> shared <span class="operator">=</span> <span class="type">Nsck</span>()</span><br><span class="line">    <span class="keyword">private(set)</span> <span class="keyword">lazy</span> <span class="keyword">var</span> pb <span class="operator">=</span> mkpb()</span><br><span class="line">    <span class="meta">@Published</span> <span class="keyword">private(set)</span> <span class="keyword">var</span> pt: <span class="type">NWPath</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> monitor: <span class="type">NWPathMonitor</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">var</span> sj <span class="operator">=</span> <span class="type">CurrentValueSubject</span>&lt;<span class="type">NWPath</span>, <span class="type">Never</span>&gt;(monitor.currentPath)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> sb: <span class="type">AnyCancellable</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">init</span>()</span> &#123;</span><br><span class="line">        monitor <span class="operator">=</span> <span class="type">NWPathMonitor</span>()</span><br><span class="line">        pt <span class="operator">=</span> monitor.currentPath</span><br><span class="line">        monitor.pathUpdateHandler <span class="operator">=</span> &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] path <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span><span class="operator">?</span>.pt <span class="operator">=</span> path</span><br><span class="line">            <span class="keyword">self</span><span class="operator">?</span>.sj.send(path)</span><br><span class="line">        &#125;</span><br><span class="line">        monitor.start(queue: <span class="type">DispatchQueue</span>.global())</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        monitor.cancel()</span><br><span class="line">        sj.send(completion: .finished)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">mkpb</span>()</span> -&gt; <span class="type">AnyPublisher</span>&lt;<span class="type">NWPath</span>, <span class="type">Never</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> sj.eraseToAnyPublisher()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用方法</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sb <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line"><span class="keyword">var</span> alertMsg <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="type">Nsck</span>.shared.pb</span><br><span class="line">    .sink &#123; <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125; receiveValue: &#123; path <span class="keyword">in</span></span><br><span class="line">        alertMsg <span class="operator">=</span> path.debugDescription</span><br><span class="line">        <span class="keyword">switch</span> path.status &#123;</span><br><span class="line">        <span class="keyword">case</span> .satisfied:</span><br><span class="line">            alertMsg <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">case</span> .unsatisfied:</span><br><span class="line">            alertMsg <span class="operator">=</span> <span class="string">&quot;😱&quot;</span></span><br><span class="line">        <span class="keyword">case</span> .requiresConnection:</span><br><span class="line">            alertMsg <span class="operator">=</span> <span class="string">&quot;🥱&quot;</span></span><br><span class="line">        <span class="keyword">@unknown</span> <span class="keyword">default</span>:</span><br><span class="line">            alertMsg <span class="operator">=</span> <span class="string">&quot;🤔&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> path.status <span class="operator">==</span> .unsatisfied &#123;</span><br><span class="line">            <span class="keyword">switch</span> path.unsatisfiedReason &#123;</span><br><span class="line">            <span class="keyword">case</span> .notAvailable:</span><br><span class="line">                alertMsg <span class="operator">+=</span> <span class="string">&quot;网络不可用&quot;</span></span><br><span class="line">            <span class="keyword">case</span> .cellularDenied:</span><br><span class="line">                alertMsg <span class="operator">+=</span> <span class="string">&quot;蜂窝网不可用&quot;</span></span><br><span class="line">            <span class="keyword">case</span> .wifiDenied:</span><br><span class="line">                alertMsg <span class="operator">+=</span> <span class="string">&quot;Wifi不可用&quot;</span></span><br><span class="line">            <span class="keyword">case</span> .localNetworkDenied:</span><br><span class="line">                alertMsg <span class="operator">+=</span> <span class="string">&quot;网线不可用&quot;</span></span><br><span class="line">            <span class="keyword">@unknown</span> <span class="keyword">default</span>:</span><br><span class="line">                alertMsg <span class="operator">+=</span> <span class="string">&quot;网络不可用&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    .store(in: <span class="operator">&amp;</span>sb)</span><br></pre></td></tr></table></figure>
<h3 id="动画"><a href="#动画" class="headerlink" title="动画"></a>动画</h3><h4 id="布局动画"><a href="#布局动画" class="headerlink" title="布局动画"></a>布局动画</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AnimateLayout</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line"> <span class="meta">@State</span> <span class="keyword">var</span> changeLayout: <span class="type">Bool</span> <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line"> <span class="meta">@Namespace</span> <span class="keyword">var</span> namespace</span><br><span class="line"></span><br><span class="line"> <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">  <span class="type">VStack</span>(spacing: <span class="number">30</span>) &#123;</span><br><span class="line">   <span class="keyword">if</span> changeLayout &#123;</span><br><span class="line">    <span class="type">HStack</span> &#123; items &#125;</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="type">VStack</span> &#123; items &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="type">Button</span>(<span class="string">&quot;切换布局&quot;</span>) &#123;</span><br><span class="line">    withAnimation &#123; changeLayout.toggle() &#125;</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  .padding()</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@ViewBuilder</span> <span class="keyword">var</span> items: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">  <span class="type">Text</span>(<span class="string">&quot;one&quot;</span>)</span><br><span class="line">   .matchedGeometryEffect(id: <span class="string">&quot;one&quot;</span>, in: namespace)</span><br><span class="line">  <span class="type">Text</span>(<span class="string">&quot;Two&quot;</span>)</span><br><span class="line">   .matchedGeometryEffect(id: <span class="string">&quot;Two&quot;</span>, in: namespace)</span><br><span class="line">  <span class="type">Text</span>(<span class="string">&quot;Three&quot;</span>)</span><br><span class="line">   .matchedGeometryEffect(id: <span class="string">&quot;Three&quot;</span>, in: namespace)</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h3><h4 id="Keychain"><a href="#Keychain" class="headerlink" title="Keychain"></a>Keychain</h4><p>使用方法：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> d1 <span class="operator">=</span> <span class="type">Data</span>(<span class="string">&quot;keyChain github token&quot;</span>.utf8)</span><br><span class="line"><span class="keyword">let</span> service <span class="operator">=</span> <span class="string">&quot;access-token&quot;</span></span><br><span class="line"><span class="keyword">let</span> account <span class="operator">=</span> <span class="string">&quot;github&quot;</span></span><br><span class="line"><span class="keyword">let</span> q1 <span class="operator">=</span> [</span><br><span class="line">    kSecValueData: d1,</span><br><span class="line">    kSecClass: kSecClassGenericPassword,</span><br><span class="line">    kSecAttrService: service,</span><br><span class="line">    kSecAttrAccount: account</span><br><span class="line">] <span class="keyword">as</span> <span class="type">CFDictionary</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加一个 keychain</span></span><br><span class="line"><span class="keyword">let</span> status <span class="operator">=</span> <span class="type">SecItemAdd</span>(q1, <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果已经添加过会抛出 -25299 错误代码，需要调用 SecItemUpdate 来进行更新</span></span><br><span class="line"><span class="keyword">if</span> status <span class="operator">==</span> errSecDuplicateItem &#123;</span><br><span class="line">    <span class="keyword">let</span> q2 <span class="operator">=</span> [</span><br><span class="line">        kSecClass: kSecClassGenericPassword,</span><br><span class="line">        kSecAttrService: service,</span><br><span class="line">        kSecAttrAccount: account</span><br><span class="line">    ] <span class="keyword">as</span> <span class="type">CFDictionary</span></span><br><span class="line">    <span class="keyword">let</span> q3 <span class="operator">=</span> [</span><br><span class="line">        kSecValueData: d1</span><br><span class="line">    ] <span class="keyword">as</span> <span class="type">CFDictionary</span></span><br><span class="line">    <span class="type">SecItemUpdate</span>(q2, q3)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取</span></span><br><span class="line"><span class="keyword">let</span> q4 <span class="operator">=</span> [</span><br><span class="line">    kSecAttrService: service,</span><br><span class="line">    kSecAttrAccount: account,</span><br><span class="line">    kSecClass: kSecClassGenericPassword,</span><br><span class="line">    kSecReturnData: <span class="literal">true</span></span><br><span class="line">] <span class="keyword">as</span> <span class="type">CFDictionary</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> re: <span class="type">AnyObject</span>?</span><br><span class="line"><span class="type">SecItemCopyMatching</span>(q4, <span class="operator">&amp;</span>re)</span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> reData <span class="operator">=</span> re <span class="keyword">as?</span> <span class="type">Data</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="type">String</span>(decoding: reData, as: <span class="type">UTF8</span>.<span class="keyword">self</span>)) <span class="comment">// keyChain github token</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除</span></span><br><span class="line"><span class="keyword">let</span> q5 <span class="operator">=</span> [</span><br><span class="line">    kSecAttrService: service,</span><br><span class="line">    kSecAttrAccount: account,</span><br><span class="line">    kSecClass: kSecClassGenericPassword,</span><br><span class="line">] <span class="keyword">as</span> <span class="type">CFDictionary</span></span><br><span class="line"></span><br><span class="line"><span class="type">SecItemDelete</span>(q5)</span><br></pre></td></tr></table></figure></p>
<h3 id="工程"><a href="#工程" class="headerlink" title="工程"></a>工程</h3><h4 id="程序入口点"><a href="#程序入口点" class="headerlink" title="程序入口点"></a>程序入口点</h4><p>Swift 允许全局编写 Swift 代码，实际上 clang 会自动将代码包进一个模拟 C 的函数中。Swift 也能够指定入口点，比如 @UIApplicationMain 或 @NSApplicationMain，UIKit 启动后生命周期管理是 AppDelegate 和 SceneDelegate，《 <a target="_blank" rel="noopener" href="https://www.donnywals.com/understanding-the-ios-13-scene-delegate/">Understanding the iOS 13 Scene Delegate</a> 》这篇有详细介绍。</p>
<p>@UIApplicationMain 和 @NSApplicationMain 会自动生成入口点。这些入口点都是平台相关的，Swift 发展来看是多平台的，这样在 Swift 5.3 时引入了 @main，可以方便的指定入口点。代码如下：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@main</span> <span class="comment">// 要定义个静态的 main 函数</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">M</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">main</span>()</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;let&#x27;s begin&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p> <a target="_blank" rel="noopener" href="https://github.com/apple/swift-argument-parser">ArgumentParser</a>  库，Swift 官方开源的一个开发命令行工具的库，也支持 @main。使用方法如下：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ArgumentParser</span><br><span class="line"></span><br><span class="line"><span class="keyword">@main</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">C</span>: <span class="title">ParsableCommand</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Argument</span>(help: <span class="string">&quot;Start&quot;</span>)</span><br><span class="line">  <span class="keyword">var</span> phrase: <span class="type">String</span></span><br><span class="line">   </span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">run</span>()</span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">_</span> <span class="keyword">in</span> <span class="number">1</span><span class="operator">...</span><span class="number">5</span> &#123;</span><br><span class="line">      <span class="built_in">print</span>(phrase)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="专题"><a href="#专题" class="headerlink" title="专题"></a>专题</h2><h3 id="Swift-那些事"><a href="#Swift-那些事" class="headerlink" title="Swift 那些事"></a>Swift 那些事</h3><h4 id="Swift-各版本演进"><a href="#Swift-各版本演进" class="headerlink" title="Swift 各版本演进"></a>Swift 各版本演进</h4><p><em>Swift 1.1</em></p>
<ul>
<li>countElements() 改成了 count()。</li>
<li>@NSApplicationMain 可以在 macOS 上使用。</li>
</ul>
<p><em>Swift 1.2</em></p>
<ul>
<li>引入 Set 类型。</li>
<li>if let 可以放到一起，使用逗号分隔。</li>
<li>新增 zip() 和 flatMap()。</li>
<li>类增加静态方法和静态属性，使用 static 关键字描述。</li>
<li>as! 用于类型强转，失败会崩溃。</li>
<li>@noescape 用于描述作为参数闭包，用来告诉 Swift 闭包将在函数返回前使用。</li>
<li>常量可以延后初始化。</li>
</ul>
<p><em>Swift 2.0</em></p>
<ul>
<li>增加 guard 关键字，用于解可选项值。</li>
<li>defer 关键字用来延迟执行，即使抛出错误了都会在最后执行。</li>
<li>ErrorType 协议，以及 throws、do、try 和 catch 的引入用来处理错误。</li>
<li>characters 加上 count，用来替代 count()。</li>
<li>#available 用来检查系统版本。</li>
</ul>
<p><em>Swift 2.1</em></p>
<ul>
<li>字符串插值可以包含字符串字面符号。</li>
</ul>
<p><em>Swift 2.2</em></p>
<ul>
<li><strong>FILE</strong>, <strong>LINE</strong> 和 <strong>FUNCTION</strong> 换成 #file，#line 和 #function。</li>
<li>废弃 ++ 和 – 操作符。</li>
<li>C 语言风格 for 循环废弃。</li>
<li>废弃变量参数，因为变量参数容易和 inout 搞混。</li>
<li>废弃字符串化的选择器，选择器不再能写成字符串了。</li>
<li>元组可直接比较是否相等。</li>
</ul>
<p><em>Swift 3.0</em></p>
<ul>
<li>规范动词和名词来命名。</li>
<li>去掉 NS 前缀。</li>
<li>方法名描述参数部分变为参数名。</li>
<li>省略没必要的单词，命名做了简化呢。比如 stringByTrimmingCharactersInSet 就换成了 trimmingCharacters。</li>
<li>枚举的属性使用小写开头。</li>
<li>引入 C 函数的属性。</li>
</ul>
<p><em>Swift 3.1</em></p>
<ul>
<li>序列新增 prefix(while:) 和 drop(while:) 方法，顺序遍历执行闭包里的逻辑判断，满足条件就返回，遇到不匹配就会停止遍历。prefix 返回满足条件的元素集合，drop 返回停止遍历之后那些元素集合。</li>
<li>泛型适用于嵌套类型。</li>
<li>类型的扩展可以使用约束条件，比如扩展数组时，加上元素为整数的约束，这样的扩展就只会对元素为整数的数组有效。</li>
</ul>
<p><em>Swift 4.0</em></p>
<ul>
<li>加入 Codable 协议，更 Swifty 的编码和解码。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0167-swift-encoders.md">SE-0167 Swift Encoders</a></li>
<li>字符串加入三个双引号的支持，让多行字符串编写更加直观。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0168-multi-line-string-literals.md">SE-0168 Multi-Line String Literals</a></li>
<li>字符串变成集合，表示可以对字符串进行逐字遍历、map 和反转等操作。</li>
<li>keypaths 语法提升。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0161-key-paths.md">SE-0161 Smart KeyPaths: Better Key-Value Coding for Swift</a></li>
<li>集合加入 ..&lt;10 这样语法的单边切片。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0172-one-sided-ranges.md">SE-0172 One-sided Ranges</a></li>
<li>字典新增 mapValues，可 map 字典的值。通过 grouping 可对字典进行分组生成新字典，键和值都可以。从字典中取值，如果键对应无值，则使用通过 default 指定的默认值。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0165-dict.md">SE-0165 Dictionary &amp; Set Enhancements</a></li>
</ul>
<p><em>Swift 4.1</em></p>
<ul>
<li>Hashable 也不需要返回一个唯一的 hashValue 哈希值属性。</li>
<li>Equatable 和 Hashable 自动合成的提案参见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0185-synthesize-equatable-hashable.md">SE-0185 Synthesizing Equatable and Hashable conformance</a>。</li>
<li>两个自定类型比较是否相等时，不再需要比较每个属性，Swift 会自动生成 == 方法，你只需要声明 Equatable 协议。</li>
<li>引入 KeyDecodingStrategy属性，其中 .convertFromSnakeCase 可以将下划线的命名转化成驼峰的命名。</li>
<li>引入条件符合性，只有满足一定条件才符合协议。比如扩展数组要求当里面元素满足某协议数组才符合这个协议。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0143-conditional-conformances.md">SE-0143 Conditional conformances</a>。</li>
<li>引入 canImport 宏条件关键字，判断是否可以使用某库，以前只能通过判断操作系统平台来判断。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0075-import-test.md">SE-0075 Adding a Build Configuration Import Test</a>。</li>
<li>新增能够去除为零项目的 compactMap()。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0187-introduce-filtermap.md">SE-0187 Introduce Sequence.compactMap(_:)</a></li>
<li>关联类型可以创建递归约束，提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0157-recursive-protocol-constraints.md">SE-0157 Support recursive constraints on associated types</a></li>
<li>targetEnvironment 环境的判断，比如模拟器。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0190-target-environment-platform-condition.md">SE-0190 Target environment platform condition</a> 。</li>
</ul>
<p><em>Swift 4.2</em></p>
<ul>
<li>新增动态成员查询，@dynamicMemberLookup 新属性，指示访问属性时调用一个已实现的处理动态查找的下标方法 subscript(dynamicMemeber:)，通过指定属性字符串名返回值。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0195-dynamic-member-lookup.md">SE-0195 Introduce User-defined “Dynamic Member Lookup” Types</a></li>
<li>集合新加 removeAll(where:) 方法，过滤满足条件所有元素。比 filter 更高效。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0197-remove-where.md">SE-0197 Adding in-place removeAll(where:) to the Standard Library</a></li>
<li>布尔值增加 toggle() 方法，用来切换布尔值。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0199-bool-toggle.md">SE-0199 Adding toggle to Bool</a></li>
<li>引入 CaseIterable 协议，可以将枚举中所有 case 生成 allCases 数组。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0194-derived-collection-of-enum-cases.md">SE-0194 Derived Collection of Enum Cases</a></li>
<li>引入 #warning 和 #error 两个新的编译器指令。#warning 会产生一个警告，#error 会直接让编译出错。比如必须要填写 token 才能编译的话可以在设置 token 的代码前加上 #error 和说明。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0196-diagnostic-directives.md">SE-0196 Compiler Diagnostic Directives</a></li>
<li>新增加密安全的随机 API。直接在数字类型上调用 random() 方法生成随机数。shuffle() 方法可以对数组进行乱序重排。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0202-random-unification.md">SE-0202 Random Unification</a></li>
<li>更简单更安全的哈希协议，引入新的 Hasher 结构，通过 combine() 方法为哈希值添加更多属性，调用 finalize() 方法生成最终哈希值。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0206-hashable-enhancements.md">SE-0206 Hashable Enhancements</a></li>
<li>集合增加 allSatisfy() 用来判断集合中的元素是否都满足了一个条件。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0207-containsOnly.md">SE-0207 Add an allSatisfy algorithm to Sequence</a></li>
</ul>
<p><em>Swift 5.0</em></p>
<ul>
<li>@dynamicCallable 动态可调用类型。通过实现 dynamicallyCall 方法来定义变参的处理。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0216-dynamic-callable.md">SE-0216 Introduce user-defined dynamically “callable” types</a></li>
<li>新加 Result 类型用来处理错误。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0235-add-result.md">SE-0235 Add Result to the Standard Library</a></li>
<li>新增原始字符串能力，在字符串前加上一个或多个#符号。里面的双引号和转义符号将不再起作用了，如果想让转义符起作用，需要在转义符后面加上#符号。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0200-raw-string-escaping.md">SE-0200 Enhancing String Literals Delimiters to Support Raw Text</a></li>
<li>自定义字符串插值。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0228-fix-expressiblebystringinterpolation.md">SE-0228 Fix ExpressibleByStringInterpolation</a></li>
<li>枚举新增 @unknown 用来区分固定的枚举和可能改变的枚举的能力。用于防止未来新增枚举属性会进行提醒提示完善每个 case 的处理。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0192-non-exhaustive-enums.md">SE-0192 Handling Future Enum Cases</a></li>
<li>compactMapValues() 对字典值进行转换和解包。可以解可选类型，并去掉 nil 值。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0218-introduce-compact-map-values.md">SE-0218 Introduce compactMapValues to Dictionary</a></li>
<li>扁平化 try?。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0230-flatten-optional-try.md">SE-0230 Flatten nested optionals resulting from ‘try?’</a></li>
<li>isMultiple(of:) 方法检查一个数字是否是另一个数字的倍数。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0225-binaryinteger-iseven-isodd-ismultiple.md">SE-0225 Adding isMultiple to BinaryInteger</a></li>
</ul>
<p><em>Swift 5.1</em></p>
<ul>
<li>有序集合的 diff，通过 difference(from:) 方法，可以返回要删除哪些和添加哪些项目能够让两个集合相等。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0240-ordered-collection-diffing.md">SE-0240 Ordered Collection Diffing</a></li>
<li>属性包装。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0258-property-wrappers.md">SE-0258 Property Wrappers</a></li>
<li>不透明返回类型。函数调用者决定返回什么类型是泛型，函数自身决定返回什么类型使用不透明返回类型。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0244-opaque-result-types.md">SE-0244 Opaque Result Types</a></li>
<li>初始化有默认值的属性可不设置。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0242-default-values-memberwise.md">SE-0242 Synthesize default values for the memberwise initializer</a></li>
<li>单行表达式函数隐式返回，返回一个单行表达式的函数可以不用 return 关键字。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0255-omit-return.md">SE-0255 Implicit returns from single-expression functions</a></li>
<li>在类、结构体和枚举里使用 Self，Self 可以指代包含的类型。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0068-universal-self.md">SE-0068 Expanding Swift Self to class members and value types</a></li>
<li>静态下标。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0254-static-subscripts.md">SE-0254 Static and class subscripts</a></li>
<li>枚举里有 none 的 case 编译器会提示换成 Optional.none。</li>
<li>引入未初始化数组。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0245-array-uninitialized-initializer.md">SE-0245 Add an Array Initializer with Access to Uninitialized Storage</a></li>
</ul>
<p><em>Swift 5.2</em></p>
<ul>
<li>自定义类型中实现了 callAsFunction() 的话，该类型的值就可以直接调用。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0253-callable.md">SE-0253 Callable values of user-defined nominal types</a></li>
<li>键路径表达式作为函数。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0249-key-path-literal-function-expressions.md">SE-0249 Key Path Expressions as Functions</a></li>
</ul>
<p><em>Swift 5.3</em></p>
<ul>
<li>SPM 包管理资源，SPM 可以包含资源文件，比如多媒体或文本等。通过 Bundle.module 访问这些资源。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0271-package-manager-resources.md">SE-0271 Package Manager Resources</a></li>
<li>SPM 包里资源本地化。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0278-package-manager-localized-resources.md">SE-0278 Package Manager Localized Resources</a></li>
<li>SPM 可以整合二进制包依赖。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0272-swiftpm-binary-dependencies.md">SE-0272 Package Manager Binary Dependencies</a></li>
<li>SPM 可以设置特定平台的依赖。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0273-swiftpm-conditional-target-dependencies.md">SE-0273 Package Manager Conditional Target Dependencies</a></li>
<li>单个 catch 块中捕获多个 Error 的 case。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0276-multi-pattern-catch-clauses.md">SE-0276 Multi-Pattern Catch Clauses</a></li>
<li>支持多个尾部闭包。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0279-multiple-trailing-closures.md">SE-0279 Multiple Trailing Closures</a></li>
<li>符合 Comparable 协议的枚举可以进行比较。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0266-synthesized-comparable-for-enumerations.md">SE-0266 Synthesized Comparable conformance for enum types</a></li>
<li>很多地方可以不用加 self 来指代实例自己了。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0269-implicit-self-explicit-capture.md">SE-0269 Increase availability of implicit self in @escaping closures when reference cycles are unlikely to occur</a></li>
<li>@main 可以方便指定程序入口点。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0281-main-attribute.md">SE-0281 @main: Type-Based Program Entry Points</a></li>
<li>where 子句可以用到泛型和扩展函数中。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0267-where-on-contextually-generic.md">SE-0267 where clauses on contextually generic declarations</a></li>
<li>枚举的 case 也可以符合协议。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0280-enum-cases-as-protocol-witnesses.md">SE-0280 Enum cases as protocol witnesses</a></li>
<li>完善 didSet，性能提升。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0268-didset-semantics.md">SE-0268 Refine didSet Semantics</a></li>
<li>新增 Float16 类型，即半精度浮点类型。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0277-float16.md">SE-0277 Float16</a></li>
</ul>
<p><em>Swift 5.4</em></p>
<ul>
<li>SPM 支持 @main。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0294-package-executable-targets.md">SE-0294 Declaring executable targets in Package Manifests</a></li>
<li>结果生成器（Result builders），通过传递序列创建新值，SwiftUI就是使用的结果生成器将多个视图生成一个视图。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0289-result-builders.md">SE-0289 Result builders</a></li>
<li>增强隐式成员语法，即使用了隐式的成员可以进行链式处理。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0287-implicit-member-chains.md">SE-0287 Extend implicit member syntax to cover chains of member references</a></li>
<li>函数开始有了使用多个变量参数的能力。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0284-multiple-variadic-parameters.md">SE-0284 Allow Multiple Variadic Parameters in Functions, Subscripts, and Initializers</a></li>
<li>嵌套函数可以重载，嵌套函数可以在声明函数之前调用他。</li>
<li>属性包装支持局部变量。</li>
</ul>
<p><em>Swift 5.5</em></p>
<ul>
<li>Async await，用同步写法来处理异步。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0296-async-await.md">SE-0296 Async/await</a></li>
<li>Async sequences，异步序列上的循环能力。符合 AsyncSequence 协议的序列可以通过 for await 来进行异步循环。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0298-asyncsequence.md">SE-0298 Async/Await: Sequences</a> </li>
<li>结构化的并发，使用 Task 和 TaskGroup 执行、取消和监听当前操作的方法。复杂的并发处理可以使用 withTaskGroup() 来创建一组 Task，addTask() 用来添加任务，cancelAll() 可以取消任务，addTask() 在取消任务后可以继续添加任务，如果使用了 addTaskUnlessCancelled() 方法就可以避免取消后会继续添加任务这种情况。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0304-structured-concurrency.md">SE-0304 Structured concurrency</a></li>
<li>只读属性支持 async 和 throws 关键字。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0310-effectful-readonly-properties.md">SE-0310 Effectful Read-only Properties</a></li>
<li>async let，可以创建 await 子任务。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0317-async-let.md">SE-0317 async let bindings</a></li>
<li>以前异步代码的适配。比如 DispatchQueue.main.async，外部库可以通过 withCheckedContinuation() 函数来对以前异步代码进行封装。 提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0300-continuation.md">SE-0300 Continuations for interfacing async tasks with synchronous code</a></li>
<li>Actor，可以确保内部只能被一个线程访问，避免存储属性和方法出现竞争条件。提案在这 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0306-actors.md">SE-0306 Actors</a></li>
<li>全局 actors，通过 actor 将全局状态隔离出来，避免数据竞争。比如主线程 @MainActor 这个属性包装可以将属性和方法标记为只能在主线程上访问。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0316-global-actors.md">SE-0316 Global actors</a></li>
<li>Sendable 协议和 @Sendable 属性包装，目的是支持安全的将数据从一个线程传给另一个线程。Swift 的核心数据类型比如字符、集合等已符合 Sendable 协议。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0302-concurrent-value-and-concurrent-closures.md">SE-0302 Sendable and @Sendable closures</a></li>
<li>局部变量可以使用 lazy。</li>
<li>属性包装可以用到函数和闭包参数上。提案<a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0293-extend-property-wrappers-to-function-and-closure-parameters.md">SE-0293 Extend Property Wrappers to Function and Closure Parameters</a></li>
<li>泛型支持静态成员查找。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0299-extend-generic-static-member-lookup.md">SE-0299 Extending Static Member Lookup in Generic Contexts</a></li>
<li>#if 用于后缀成员表达式。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0308-postfix-if-config-expressions.md">SE-0308 #if for postfix member expressions</a></li>
<li>CGFloat 和 Double 之间可以隐式转换。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0307-allow-interchangeable-use-of-double-cgfloat-types.md">SE-0307 Allow interchangeable use of CGFloat and Double types</a></li>
<li>Codable 支持关联值枚举。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0295-codable-synthesis-for-enums-with-associated-values.md">SE-0295 Codable synthesis for enums with associated values</a></li>
</ul>
<h3 id="规范"><a href="#规范" class="headerlink" title="规范"></a>规范</h3><h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><p>参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://google.github.io/swift/">Swift Style Guide</a></li>
</ul>
<p>多用静态特性。swift 在编译期间所做的优化比 OC 要多，这是由于他的静态派发、泛型特化、写时复制这些静态特性决定的。另外通过 final  和 private 这样的表示可将动态特性转化为静态方式，编译开启 WMO 可以自动推导出哪些动态派发可转化为静态派发。</p>
<p>如何避免崩溃？</p>
<ul>
<li>字典：用结构体替代</li>
<li>Any：可用泛型或关联关联类型替代</li>
<li>as? ：少用 AnyObject，多用泛型或不透明类型</li>
<li>!：要少用</li>
</ul>
<p>好的实践？</p>
<ul>
<li>少用继承，多用 protocol</li>
<li>多用 extension 对自己代码进行管理</li>
</ul>
<h3 id="资料推荐"><a href="#资料推荐" class="headerlink" title="资料推荐"></a>资料推荐</h3><h4 id="书单"><a href="#书单" class="headerlink" title="书单"></a>书单</h4><ul>
<li>《Thinking in SwiftUI》</li>
<li>《Swift 进阶》</li>
<li>《函数式Swift》</li>
<li>《深入解析Mac OS X &amp; iOS操作系统》</li>
<li>《LLVM Techniques, Tips, and Best Practices Clang and Middle-End Libraries》</li>
<li>《Learn LLVM 12》</li>
<li>《Crafting Interpreters》</li>
<li>《TCP/IP Illustrated》</li>
<li>《松本行弘的程序世界》</li>
<li>《现代操作系统》</li>
<li>《深入理解计算机系统》</li>
<li>《程序员的自我修养》</li>
<li>《Head First 设计模式》</li>
</ul>
<h3 id="三方库使用"><a href="#三方库使用" class="headerlink" title="三方库使用"></a>三方库使用</h3><h4 id="SQLite-swift-的使用"><a href="#SQLite-swift-的使用" class="headerlink" title="SQLite.swift 的使用"></a>SQLite.swift 的使用</h4><p>下面是 SQLite.swift 库的使用介绍，包括了数据库创建，表创建，表的添加、更新、删除、查找等处理方法</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SQLite</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">DB</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> shared <span class="operator">=</span> <span class="type">DB</span>()</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> path <span class="operator">=</span> <span class="type">NSSearchPathForDirectoriesInDomains</span>(</span><br><span class="line">        .applicationSupportDirectory, .userDomainMask, <span class="literal">true</span></span><br><span class="line">    ).first<span class="operator">!</span></span><br><span class="line">    <span class="keyword">let</span> <span class="type">BBDB</span>: <span class="type">Connection</span>?</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">init</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="type">DB</span>.path)</span><br><span class="line">            <span class="type">BBDB</span> <span class="operator">=</span> <span class="keyword">try</span> <span class="type">Connection</span>(<span class="string">&quot;<span class="subst">\(DB.path)</span>/github.sqlite3&quot;</span>)</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="type">BBDB</span> <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/// Swift 类型和 SQLite 类型对标如下：</span></span><br><span class="line">        <span class="comment">/// Int64 = INTEGER</span></span><br><span class="line">        <span class="comment">/// Double = REAL</span></span><br><span class="line">        <span class="comment">/// String = TEXT</span></span><br><span class="line">        <span class="comment">/// nil = NULL</span></span><br><span class="line">        <span class="comment">/// SQLite.Blob = BLOB</span></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建表</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">cTbs</span>()</span> <span class="keyword">throws</span> &#123;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> <span class="type">ReposNotiDataHelper</span>.createTable()</span><br><span class="line">            <span class="keyword">try</span> <span class="type">DevsNotiDataHelper</span>.createTable()</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">DBError</span>.connectionErr</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">DBError</span>: <span class="title">Error</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> connectionErr, insertErr, deleteErr, searchErr, updateErr, nilInData</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">DataHelperProtocol</span> </span>&#123;</span><br><span class="line">    <span class="keyword">associatedtype</span> <span class="type">T</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">createTable</span>()</span> <span class="keyword">throws</span> -&gt; <span class="type">Void</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">insert</span>(<span class="params">i</span>: <span class="type">T</span>)</span> <span class="keyword">throws</span> -&gt; <span class="type">Int64</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">delete</span>(<span class="params">i</span>: <span class="type">T</span>)</span> <span class="keyword">throws</span> -&gt; <span class="type">Void</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">findAll</span>()</span> <span class="keyword">throws</span> -&gt; [<span class="type">T</span>]<span class="operator">?</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: 开发者更新提醒</span></span><br><span class="line"><span class="keyword">typealias</span> <span class="type">DBDevNoti</span> <span class="operator">=</span> (</span><br><span class="line">    login: <span class="type">String</span>,</span><br><span class="line">    lastReadId: <span class="type">String</span>,</span><br><span class="line">    unRead: <span class="type">Int</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">DevsNotiDataHelper</span>: <span class="title">DataHelperProtocol</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> table <span class="operator">=</span> <span class="type">Table</span>(<span class="string">&quot;devsNoti&quot;</span>)</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> login <span class="operator">=</span> <span class="type">Expression</span>&lt;<span class="type">String</span>&gt;(<span class="string">&quot;login&quot;</span>)</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> lastReadId <span class="operator">=</span> <span class="type">Expression</span>&lt;<span class="type">String</span>&gt;(<span class="string">&quot;lastReadId&quot;</span>)</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> unRead <span class="operator">=</span> <span class="type">Expression</span>&lt;<span class="type">Int</span>&gt;(<span class="string">&quot;unRead&quot;</span>)</span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">T</span> <span class="operator">=</span> <span class="type">DBDevNoti</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">createTable</span>()</span> <span class="keyword">throws</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> db <span class="operator">=</span> <span class="type">DB</span>.shared.<span class="type">BBDB</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">DBError</span>.connectionErr</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">_</span> <span class="operator">=</span> <span class="keyword">try</span> db.run(table.create(ifNotExists: <span class="literal">true</span>) &#123; t <span class="keyword">in</span></span><br><span class="line">                t.column(login, unique: <span class="literal">true</span>)</span><br><span class="line">                t.column(lastReadId, defaultValue: <span class="string">&quot;&quot;</span>)</span><br><span class="line">                t.column(unRead, defaultValue: <span class="number">0</span>)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125; <span class="keyword">catch</span> <span class="keyword">_</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">DBError</span>.connectionErr</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="comment">// end createTable</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">insert</span>(<span class="params">i</span>: <span class="type">DBDevNoti</span>)</span> <span class="keyword">throws</span> -&gt; <span class="type">Int64</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> db <span class="operator">=</span> <span class="type">DB</span>.shared.<span class="type">BBDB</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">DBError</span>.connectionErr</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> insert <span class="operator">=</span> table.insert(login <span class="operator">&lt;-</span> i.login, lastReadId <span class="operator">&lt;-</span> i.lastReadId, unRead <span class="operator">&lt;-</span> i.unRead)</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> rowId <span class="operator">=</span> <span class="keyword">try</span> db.run(insert)</span><br><span class="line">            <span class="keyword">guard</span> rowId <span class="operator">&gt;</span> <span class="number">0</span> <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="type">DBError</span>.insertErr</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> rowId</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">DBError</span>.insertErr</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="comment">// end insert</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">delete</span>(<span class="params">i</span>: <span class="type">DBDevNoti</span>)</span> <span class="keyword">throws</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> db <span class="operator">=</span> <span class="type">DB</span>.shared.<span class="type">BBDB</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">DBError</span>.connectionErr</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> query <span class="operator">=</span> table.filter(login <span class="operator">==</span> i.login)</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> tmp <span class="operator">=</span> <span class="keyword">try</span> db.run(query.delete())</span><br><span class="line">            <span class="keyword">guard</span> tmp <span class="operator">==</span> <span class="number">1</span> <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="type">DBError</span>.deleteErr</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">DBError</span>.deleteErr</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="comment">// end delete</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">find</span>(<span class="params">sLogin</span>: <span class="type">String</span>)</span> <span class="keyword">throws</span> -&gt; <span class="type">DBDevNoti</span>? &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> db <span class="operator">=</span> <span class="type">DB</span>.shared.<span class="type">BBDB</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">DBError</span>.connectionErr</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> query <span class="operator">=</span> table.filter(login <span class="operator">==</span> sLogin)</span><br><span class="line">        <span class="keyword">let</span> items <span class="operator">=</span> <span class="keyword">try</span> db.prepare(query)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> items &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">DBDevNoti</span>(login: i[login], lastReadId: i[lastReadId], unRead: i[unRead])</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125; <span class="comment">// end find</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">update</span>(<span class="params">i</span>: <span class="type">DBDevNoti</span>)</span> <span class="keyword">throws</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> db <span class="operator">=</span> <span class="type">DB</span>.shared.<span class="type">BBDB</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">DBError</span>.connectionErr</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> query <span class="operator">=</span> table.filter(login <span class="operator">==</span> i.login)</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">try</span> db.run(query.update(lastReadId <span class="operator">&lt;-</span> i.lastReadId, unRead <span class="operator">&lt;-</span> i.unRead)) <span class="operator">&gt;</span> <span class="number">0</span> &#123;</span><br><span class="line">                </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="type">DBError</span>.updateErr</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">DBError</span>.updateErr</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="comment">// end update</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">findAll</span>()</span> <span class="keyword">throws</span> -&gt; [<span class="type">DBDevNoti</span>]<span class="operator">?</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> db <span class="operator">=</span> <span class="type">DB</span>.shared.<span class="type">BBDB</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">DBError</span>.connectionErr</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> arr <span class="operator">=</span> [<span class="type">DBDevNoti</span>]()</span><br><span class="line">        <span class="keyword">let</span> items <span class="operator">=</span> <span class="keyword">try</span> db.prepare(table)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> items &#123;</span><br><span class="line">            arr.append(<span class="type">DBDevNoti</span>(login: i[login], lastReadId: i[lastReadId], unRead: i[unRead]))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> arr</span><br><span class="line">    &#125; <span class="comment">// end find all</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>使用时，可以在初始化时这么做：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK: 初始化数据库</span></span><br><span class="line">et db <span class="operator">=</span> <span class="type">DB</span>.shared</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> db.cTbs() <span class="comment">// 创建表</span></span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>使用的操作示例如下：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> fd <span class="operator">=</span> <span class="keyword">try</span> <span class="type">ReposNotiDataHelper</span>.find(sFullName: r.id) &#123;</span><br><span class="line">        reposDic[fd.fullName] <span class="operator">=</span> fd.unRead</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">_</span> <span class="operator">=</span> <span class="keyword">try</span> <span class="type">ReposNotiDataHelper</span>.insert(i: <span class="type">DBRepoNoti</span>(fullName: r.id, lastReadCommitSha: <span class="string">&quot;&quot;</span>, unRead: <span class="number">0</span>))</span><br><span class="line">            reposDic[r.id] <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> reposDic</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> reposDic</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="macOS"><a href="#macOS" class="headerlink" title="macOS"></a>macOS</h3><h4 id="范例"><a href="#范例" class="headerlink" title="范例"></a>范例</h4><ul>
<li>官方提供的两个例子，<a target="_blank" rel="noopener" href="https://developer.apple.com/tutorials/swiftui/creating-a-macos-app">Creating a macOS App</a>，<a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/swiftui/building_a_great_mac_app_with_swiftui">Building a Great Mac App with SwiftUI</a> （有table和LazyVGrid的用法）。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/adamayoung/Movies">GitHub - adamayoung/Movies: Movies and TV Shows App for iOS, iPadOS, watchOS and macOS</a> 使用了SwiftUI和Combine，电影数据使用的是<a target="_blank" rel="noopener" href="https://www.themoviedb.org/">The Movie Database (TMDB)</a>的API</li>
</ul>
<h4 id="三栏结构"><a href="#三栏结构" class="headerlink" title="三栏结构"></a>三栏结构</h4><p>三栏结构架子搭建，代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SwiftPamphletApp</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">SPSidebar</span>()</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;第二栏&quot;</span>)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;第三栏&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .navigationTitle(<span class="string">&quot;Swift 小册子&quot;</span>)</span><br><span class="line">        .toolbar &#123;</span><br><span class="line">            <span class="type">ToolbarItem</span>(placement: <span class="type">ToolbarItemPlacement</span>.navigation) &#123;</span><br><span class="line">                <span class="type">Button</span> &#123;</span><br><span class="line">                    <span class="type">NSApp</span>.keyWindow<span class="operator">?</span>.firstResponder<span class="operator">?</span>.tryToPerform(#selector(<span class="type">NSSplitViewController</span>.toggleSidebar(<span class="keyword">_</span>:)), with: <span class="literal">nil</span>)</span><br><span class="line">                &#125; label: &#123;</span><br><span class="line">                    <span class="type">Label</span>(<span class="string">&quot;Sidebar&quot;</span>, systemImage: <span class="string">&quot;sidebar.left&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SPSidebar</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">Section</span>(<span class="string">&quot;第一组&quot;</span>) &#123;</span><br><span class="line">                <span class="type">NavigationLink</span>(<span class="string">&quot;第一项&quot;</span>, destination: <span class="type">SPList</span>(title: <span class="string">&quot;列表1&quot;</span>))</span><br><span class="line">                    .badge(<span class="number">3</span>)</span><br><span class="line">                <span class="type">NavigationLink</span>(<span class="string">&quot;第二项&quot;</span>, destination: <span class="type">SPList</span>(title: <span class="string">&quot;列表2&quot;</span>))</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">Section</span>(<span class="string">&quot;第二组&quot;</span>) &#123;</span><br><span class="line">                <span class="type">NavigationLink</span>(<span class="string">&quot;第三项&quot;</span>, destination: <span class="type">SPList</span>(title: <span class="string">&quot;列表3&quot;</span>))</span><br><span class="line">                <span class="type">NavigationLink</span>(<span class="string">&quot;第四项&quot;</span>, destination: <span class="type">SPList</span>(title: <span class="string">&quot;列表4&quot;</span>))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .listStyle(<span class="type">SidebarListStyle</span>())</span><br><span class="line">        .frame(minWidth: <span class="number">160</span>)</span><br><span class="line">        .toolbar &#123;</span><br><span class="line">            <span class="type">ToolbarItem</span> &#123;</span><br><span class="line">                <span class="type">Menu</span> &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">                &#125; label: &#123;</span><br><span class="line">                    <span class="type">Label</span>(<span class="string">&quot;Label&quot;</span>, systemImage: <span class="string">&quot;slider.horizontal.3&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SPList</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> title: <span class="type">String</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> searchText: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span>(<span class="number">0</span><span class="operator">..&lt;</span><span class="number">3</span>) &#123; i <span class="keyword">in</span></span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;内容<span class="subst">\(i)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .toolbar(content: &#123;</span><br><span class="line">            <span class="type">Button</span> &#123;</span><br><span class="line">                <span class="comment">//</span></span><br><span class="line">            &#125; label: &#123;</span><br><span class="line">                <span class="type">Label</span>(<span class="string">&quot;Add&quot;</span>, systemImage: <span class="string">&quot;plus&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .navigationTitle(title)</span><br><span class="line">        .navigationSubtitle(<span class="string">&quot;副标题&quot;</span>)</span><br><span class="line">        .searchable(text: <span class="variable">$searchText</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>显示效果如下：<br><img src="https://user-images.githubusercontent.com/251980/142977421-bed5b5ae-01fe-471f-a951-63dd4338c97a.png" alt=""></p>
<h4 id="共享菜单"><a href="#共享菜单" class="headerlink" title="共享菜单"></a>共享菜单</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ShareView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> s: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Menu</span> &#123;</span><br><span class="line">            <span class="type">Button</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> p <span class="operator">=</span> <span class="type">NSPasteboard</span>.general</span><br><span class="line">                p.declareTypes([.string], owner: <span class="literal">nil</span>)</span><br><span class="line">                p.setString(s, forType: .string)</span><br><span class="line">            &#125; label: &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;拷贝链接&quot;</span>)</span><br><span class="line">                <span class="type">Image</span>(systemName: <span class="string">&quot;doc.on.doc&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">Divider</span>()</span><br><span class="line">            <span class="type">ForEach</span>(<span class="type">NSSharingService</span>.sharingServices(forItems: [<span class="string">&quot;&quot;</span>]), id: \.title) &#123; item <span class="keyword">in</span></span><br><span class="line">                <span class="type">Button</span> &#123;</span><br><span class="line">                    item.perform(withItems: [s])</span><br><span class="line">                &#125; label: &#123;</span><br><span class="line">                    <span class="type">Text</span>(item.title)</span><br><span class="line">                    <span class="type">Image</span>(nsImage: item.image)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; label: &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;分享&quot;</span>)</span><br><span class="line">            <span class="type">Image</span>(systemName: <span class="string">&quot;square.and.arrow.up&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="剪贴板"><a href="#剪贴板" class="headerlink" title="剪贴板"></a>剪贴板</h4><p>添加和读取剪贴板的方法如下：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 读取剪贴板内容</span></span><br><span class="line"><span class="keyword">let</span> s <span class="operator">=</span> <span class="type">NSPasteboard</span>.general.string(forType: .string)</span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> s <span class="operator">=</span> s <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(s)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置剪贴板内容</span></span><br><span class="line"><span class="keyword">let</span> p <span class="operator">=</span> <span class="type">NSPasteboard</span>.general</span><br><span class="line">p.declareTypes([.string], owner: <span class="literal">nil</span>)</span><br><span class="line">p.setString(s, forType: .string)</span><br></pre></td></tr></table></figure></p>
<h2 id="Combine"><a href="#Combine" class="headerlink" title="Combine"></a>Combine</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><h4 id="Combine-是什么？"><a href="#Combine-是什么？" class="headerlink" title="Combine 是什么？"></a>Combine 是什么？</h4><p>WWDC 2019苹果推出Combine，Combine是一种响应式编程范式，采用声明式的Swift API。</p>
<p>Combine 写代码的思路是你写代码不同于以往命令式的描述如何处理数据，Combine 是要去描述好数据会经过哪些逻辑运算处理。这样代码更好维护，可以有效的减少嵌套闭包以及分散的回调等使得代码维护麻烦的苦恼。</p>
<p>声明式和过程时区别可见如下代码：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 所有数相加</span></span><br><span class="line"><span class="comment">// 命令式思维</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum1</span>(<span class="params">arr</span>: [<span class="type">Int</span>])</span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> sum: <span class="type">Int</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> v <span class="keyword">in</span> arr &#123;</span><br><span class="line">    sum <span class="operator">+=</span> v</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明式思维</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum2</span>(<span class="params">arr</span>: [<span class="type">Int</span>])</span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> arr.reduce(<span class="number">0</span>, <span class="operator">+</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Combine 主要用来处理异步的事件和值。苹果 UI 框架都是在主线程上进行 UI 更新，Combine 通过 Publisher 的 receive 设置回主线程更新UI会非常的简单。</p>
<p>已有的 RxSwift 和 ReactiveSwift 框架和 Combine 的思路和用法类似。</p>
<p>Combine 的三个核心概念</p>
<ul>
<li>发布者</li>
<li>订阅者</li>
<li>操作符</li>
</ul>
<p>简单举个发布数据和类属性绑定的例子：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> pA <span class="operator">=</span> <span class="type">Just</span>(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="keyword">_</span> <span class="operator">=</span> pA.sink &#123; v <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;pA is: <span class="subst">\(v)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> pB <span class="operator">=</span> [<span class="number">7</span>,<span class="number">90</span>,<span class="number">16</span>,<span class="number">11</span>].publisher</span><br><span class="line"><span class="keyword">let</span> <span class="keyword">_</span> <span class="operator">=</span> pB</span><br><span class="line">    .sink &#123; v <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;pB: <span class="subst">\(v)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p: <span class="type">Int</span> <span class="operator">=</span> <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;property update to <span class="subst">\(p)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> o <span class="operator">=</span> <span class="type">AClass</span>()</span><br><span class="line"><span class="keyword">let</span> <span class="keyword">_</span> <span class="operator">=</span> pB.assign(to: \.p, on: o)</span><br></pre></td></tr></table></figure>
<h4 id="Combine-资料"><a href="#Combine-资料" class="headerlink" title="Combine 资料"></a>Combine 资料</h4><p>官方文档链接  <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/combine">Combine | Apple Developer Documentation</a> 。还有  <a target="_blank" rel="noopener" href="https://heckj.github.io/swiftui-notes/">Using Combine</a>  这里有大量使用示例，内容较全。官方讨论Combine的论坛  <a target="_blank" rel="noopener" href="https://forums.swift.org/tag/combine">Topics tagged combine</a> 。StackOverflow上相关问题  <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/tagged/combine">Newest ‘combine’ Questions</a> 。</p>
<p>WWDC上关于Combine的Session如下：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2019/722/">Introducing Combine</a> </li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2019/721/">Combine in Practice</a> </li>
</ul>
<p>和Combine相关的Session：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2019/415/">Modern Swift API Design</a> </li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2019/226">Data Flow Through SwiftUI</a> </li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2019/711">Introducing Combine and Advances in Foundation</a> </li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2019/712/">Advances in Networking, Part 1</a> </li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2019/610/">Building Collaborative AR Experiences</a> </li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2019/223/">Expanding the Sensory Experience with Core Haptics</a> </li>
</ul>
<h3 id="使用说明"><a href="#使用说明" class="headerlink" title="使用说明"></a>使用说明</h3><h4 id="publisher"><a href="#publisher" class="headerlink" title="publisher"></a>publisher</h4><p>publisher 是发布者，sink 是订阅者</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cc <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> p1: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> p2: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line">[<span class="type">S</span>(p1: <span class="string">&quot;1&quot;</span>, p2: <span class="string">&quot;one&quot;</span>), <span class="type">S</span>(p1: <span class="string">&quot;2&quot;</span>, p2: <span class="string">&quot;two&quot;</span>)]</span><br><span class="line">    .publisher</span><br><span class="line">    .print(<span class="string">&quot;array&quot;</span>)</span><br><span class="line">    .sink &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .store(in: <span class="operator">&amp;</span>cc)</span><br></pre></td></tr></table></figure>
<p> 输出<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> array: receive subscription: ([戴铭的Swift小册子.AppDelegate.(unknown context at $10ac82d20).(unknown context at $10ac82da4).S(p1: &quot;1&quot;, p2: &quot;one&quot;), 戴铭的Swift小册子.AppDelegate.(unknown context at $10ac82d20).(unknown context at $10ac82da4).S(p1: &quot;2&quot;, p2: &quot;two&quot;)])</span><br><span class="line">array: request unlimited</span><br><span class="line">array: receive value: (S(p1: &quot;1&quot;, p2: &quot;one&quot;))</span><br><span class="line">S(p1: &quot;1&quot;, p2: &quot;one&quot;)</span><br><span class="line">array: receive value: (S(p1: &quot;2&quot;, p2: &quot;two&quot;))</span><br><span class="line">S(p1: &quot;2&quot;, p2: &quot;two&quot;)</span><br><span class="line">array: receive finished</span><br></pre></td></tr></table></figure></p>
<h4 id="Just"><a href="#Just" class="headerlink" title="Just"></a>Just</h4><p>Just 是发布者，发布的数据在初始化时完成</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"><span class="keyword">var</span> cc <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> p1: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> p2: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> pb <span class="operator">=</span> <span class="type">Just</span>(<span class="type">S</span>(p1: <span class="string">&quot;1&quot;</span>, p2: <span class="string">&quot;one&quot;</span>))</span><br><span class="line">pb</span><br><span class="line">    .print(<span class="string">&quot;pb&quot;</span>)</span><br><span class="line">    .sink &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .store(in: <span class="operator">&amp;</span>cc)</span><br></pre></td></tr></table></figure>
<p>输出<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pb: receive subscription: (Just)</span><br><span class="line">pb: request unlimited</span><br><span class="line">pb: receive value: (S(p1: &quot;1&quot;, p2: &quot;one&quot;))</span><br><span class="line">S(p1: &quot;1&quot;, p2: &quot;one&quot;)</span><br><span class="line">pb: receive finished</span><br></pre></td></tr></table></figure></p>
<h4 id="PassthroughSubject"><a href="#PassthroughSubject" class="headerlink" title="PassthroughSubject"></a>PassthroughSubject</h4><p>PassthroughSubject 可以传递多值，订阅者可以是一个也可以是多个，send 指明 completion 后，订阅者就没法接收到新发送的值了。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cc <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> p1: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> p2: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">CError</span>: <span class="title">Error</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> aE, bE</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> ps1 <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">S</span>, <span class="type">CError</span>&gt;()</span><br><span class="line">ps1</span><br><span class="line">    .print(<span class="string">&quot;ps1&quot;</span>)</span><br><span class="line">    .sink &#123; c <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;completion:&quot;</span>, c) <span class="comment">// send 了 .finished 后会执行</span></span><br><span class="line">    &#125; receiveValue: &#123; s <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;receive:&quot;</span>, s)</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    .store(in: <span class="operator">&amp;</span>cc)</span><br><span class="line"></span><br><span class="line">ps1.send(<span class="type">S</span>(p1: <span class="string">&quot;1&quot;</span>, p2: <span class="string">&quot;one&quot;</span>))</span><br><span class="line">ps1.send(completion: .failure(<span class="type">CError</span>.aE)) <span class="comment">// 和 .finished 一样后面就不会发送了</span></span><br><span class="line">ps1.send(<span class="type">S</span>(p1: <span class="string">&quot;2&quot;</span>, p2: <span class="string">&quot;two&quot;</span>))</span><br><span class="line">ps1.send(completion: .finished)</span><br><span class="line">ps1.send(<span class="type">S</span>(p1: <span class="string">&quot;3&quot;</span>, p2: <span class="string">&quot;three&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 多个订阅者</span></span><br><span class="line"><span class="keyword">let</span> ps2 <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">String</span>, <span class="type">Never</span>&gt;()</span><br><span class="line">ps2.send(<span class="string">&quot;one&quot;</span>) <span class="comment">// 订阅之前 send 的数据没有订阅者可以接收</span></span><br><span class="line">ps2.send(<span class="string">&quot;two&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sb1 <span class="operator">=</span> ps2</span><br><span class="line">    .print(<span class="string">&quot;ps2 sb1&quot;</span>)</span><br><span class="line">    .sink &#123; s <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(s)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">ps2.send(<span class="string">&quot;three&quot;</span>) <span class="comment">// 这个 send 的值会被 sb1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sb2 <span class="operator">=</span> ps2</span><br><span class="line">    .print(<span class="string">&quot;ps2 sb2&quot;</span>)</span><br><span class="line">    .sink &#123; s <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(s)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">ps2.send(<span class="string">&quot;four&quot;</span>) <span class="comment">// 这个 send 的值会被 sb1 和 sb2 接受</span></span><br><span class="line"></span><br><span class="line">sb1.store(in: <span class="operator">&amp;</span>cc)</span><br><span class="line">sb2.store(in: <span class="operator">&amp;</span>cc)</span><br><span class="line">ps2.send(completion: .finished)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ps1: receive subscription: (PassthroughSubject)</span><br><span class="line">ps1: request unlimited</span><br><span class="line">ps1: receive value: (S(p1: &quot;1&quot;, p2: &quot;one&quot;))</span><br><span class="line">receive: S(p1: &quot;1&quot;, p2: &quot;one&quot;)</span><br><span class="line">ps1: receive error: (aE)</span><br><span class="line">completion: failure(戴铭的Swift小册子.AppDelegate.(unknown context at $10b15ce10).(unknown context at $10b15cf3c).CError.aE)</span><br><span class="line">ps2 sb1: receive subscription: (PassthroughSubject)</span><br><span class="line">ps2 sb1: request unlimited</span><br><span class="line">ps2 sb1: receive value: (three)</span><br><span class="line">three</span><br><span class="line">ps2 sb2: receive subscription: (PassthroughSubject)</span><br><span class="line">ps2 sb2: request unlimited</span><br><span class="line">ps2 sb1: receive value: (four)</span><br><span class="line">four</span><br><span class="line">ps2 sb2: receive value: (four)</span><br><span class="line">four</span><br><span class="line">ps2 sb1: receive finished</span><br><span class="line">ps2 sb2: receive finished</span><br></pre></td></tr></table></figure></p>
<h4 id="Empty"><a href="#Empty" class="headerlink" title="Empty"></a>Empty</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cc <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> p1: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> p2: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ept <span class="operator">=</span> <span class="type">Empty</span>&lt;<span class="type">S</span>, <span class="type">Never</span>&gt;() <span class="comment">// 加上 completeImmediately: false 后面即使用 replaceEmpty 也不会接受值</span></span><br><span class="line">ept</span><br><span class="line">    .print(<span class="string">&quot;ept&quot;</span>)</span><br><span class="line">    .sink &#123; c <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;completion:&quot;</span>, c)</span><br><span class="line">    &#125; receiveValue: &#123; s <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;receive:&quot;</span>, s)</span><br><span class="line">    &#125;</span><br><span class="line">    .store(in: <span class="operator">&amp;</span>cc)</span><br><span class="line"></span><br><span class="line">ept.replaceEmpty(with: <span class="type">S</span>(p1: <span class="string">&quot;1&quot;</span>, p2: <span class="string">&quot;one&quot;</span>))</span><br><span class="line">    .sink &#123; c <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;completion:&quot;</span>, c)</span><br><span class="line">    &#125; receiveValue: &#123; s <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;receive:&quot;</span>, s)</span><br><span class="line">    &#125;</span><br><span class="line">    .store(in: <span class="operator">&amp;</span>cc)</span><br></pre></td></tr></table></figure>
<p>输出<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ept: receive subscription: (Empty)</span><br><span class="line">ept: request unlimited</span><br><span class="line">ept: receive finished</span><br><span class="line">completion: finished</span><br><span class="line">receive: S(p1: &quot;1&quot;, p2: &quot;one&quot;)</span><br><span class="line">completion: finished</span><br></pre></td></tr></table></figure></p>
<h4 id="CurrentValueSubject"><a href="#CurrentValueSubject" class="headerlink" title="CurrentValueSubject"></a>CurrentValueSubject</h4><p>CurrentValueSubject 的订阅者可以收到订阅时已发出的那条数据</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cc <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> cs <span class="operator">=</span> <span class="type">CurrentValueSubject</span>&lt;<span class="type">String</span>, <span class="type">Never</span>&gt;(<span class="string">&quot;one&quot;</span>)</span><br><span class="line">cs.send(<span class="string">&quot;two&quot;</span>)</span><br><span class="line">cs.send(<span class="string">&quot;three&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> sb1 <span class="operator">=</span> cs</span><br><span class="line">    .print(<span class="string">&quot;cs sb1&quot;</span>)</span><br><span class="line">    .sink &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">cs.send(<span class="string">&quot;four&quot;</span>)</span><br><span class="line">cs.send(<span class="string">&quot;five&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sb2 <span class="operator">=</span> cs</span><br><span class="line">    .print(<span class="string">&quot;cs sb2&quot;</span>)</span><br><span class="line">    .sink &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">cs.send(<span class="string">&quot;six&quot;</span>)</span><br><span class="line"></span><br><span class="line">sb1.store(in: <span class="operator">&amp;</span>cc)</span><br><span class="line">sb2.store(in: <span class="operator">&amp;</span>cc)</span><br></pre></td></tr></table></figure>
<p>输出<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cs sb1: receive subscription: (CurrentValueSubject)</span><br><span class="line">cs sb1: request unlimited</span><br><span class="line">cs sb1: receive value: (three)</span><br><span class="line">three</span><br><span class="line">cs sb1: receive value: (four)</span><br><span class="line">four</span><br><span class="line">cs sb1: receive value: (five)</span><br><span class="line">five</span><br><span class="line">cs sb2: receive subscription: (CurrentValueSubject)</span><br><span class="line">cs sb2: request unlimited</span><br><span class="line">cs sb2: receive value: (five)</span><br><span class="line">five</span><br><span class="line">cs sb1: receive value: (six)</span><br><span class="line">six</span><br><span class="line">cs sb2: receive value: (six)</span><br><span class="line">six</span><br><span class="line">cs sb1: receive cancel</span><br><span class="line">cs sb2: receive cancel</span><br></pre></td></tr></table></figure></p>
<h4 id="removeDuplicates"><a href="#removeDuplicates" class="headerlink" title="removeDuplicates"></a>removeDuplicates</h4><p>使用 removeDuplicates，重复的值就不会发送了。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cc <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> pb <span class="operator">=</span> [<span class="string">&quot;one&quot;</span>,<span class="string">&quot;two&quot;</span>,<span class="string">&quot;three&quot;</span>,<span class="string">&quot;three&quot;</span>,<span class="string">&quot;four&quot;</span>]</span><br><span class="line">    .publisher</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sb <span class="operator">=</span> pb</span><br><span class="line">    .print(<span class="string">&quot;sb&quot;</span>)</span><br><span class="line">    .removeDuplicates()</span><br><span class="line">    .sink &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">sb.store(in: <span class="operator">&amp;</span>cc)</span><br></pre></td></tr></table></figure>
<p>输出<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sb: receive subscription: ([&quot;one&quot;, &quot;two&quot;, &quot;three&quot;, &quot;three&quot;, &quot;four&quot;])</span><br><span class="line">sb: request unlimited</span><br><span class="line">sb: receive value: (one)</span><br><span class="line">one</span><br><span class="line">sb: receive value: (two)</span><br><span class="line">two</span><br><span class="line">sb: receive value: (three)</span><br><span class="line">three</span><br><span class="line">sb: receive value: (three)</span><br><span class="line">sb: request max: (1) (synchronous)</span><br><span class="line">sb: receive value: (four)</span><br><span class="line">four</span><br><span class="line">sb: receive finished</span><br></pre></td></tr></table></figure></p>
<h4 id="flatMap"><a href="#flatMap" class="headerlink" title="flatMap"></a>flatMap</h4><p>flatMap 能将多个发布者的值打平发送给订阅者</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cc <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> p: <span class="type">AnyPublisher</span>&lt;<span class="type">String</span>, <span class="type">Never</span>&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> s1 <span class="operator">=</span> <span class="type">S</span>(p: <span class="type">Just</span>(<span class="string">&quot;one&quot;</span>).eraseToAnyPublisher())</span><br><span class="line"><span class="keyword">let</span> s2 <span class="operator">=</span> <span class="type">S</span>(p: <span class="type">Just</span>(<span class="string">&quot;two&quot;</span>).eraseToAnyPublisher())</span><br><span class="line"><span class="keyword">let</span> s3 <span class="operator">=</span> <span class="type">S</span>(p: <span class="type">Just</span>(<span class="string">&quot;three&quot;</span>).eraseToAnyPublisher())</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> pb <span class="operator">=</span> [s1, s2, s3].publisher</span><br><span class="line">    </span><br><span class="line"><span class="keyword">let</span> sb <span class="operator">=</span> pb</span><br><span class="line">    .print(<span class="string">&quot;sb&quot;</span>)</span><br><span class="line">    .flatMap &#123;</span><br><span class="line">        <span class="variable">$0</span>.p</span><br><span class="line">    &#125;</span><br><span class="line">    .sink &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">sb.store(in: <span class="operator">&amp;</span>cc)</span><br></pre></td></tr></table></figure>
<p>输出<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sb: receive subscription: ([戴铭的Swift小册子.AppDelegate.(unknown context at $101167070).(unknown context at $1011670f4).S(p: AnyPublisher), 戴铭的Swift小册子.AppDelegate.(unknown context at $101167070).(unknown context at $1011670f4).S(p: AnyPublisher), 戴铭的Swift小册子.AppDelegate.(unknown context at $101167070).(unknown context at $1011670f4).S(p: AnyPublisher)])</span><br><span class="line">sb: request unlimited</span><br><span class="line">sb: receive value: (S(p: AnyPublisher))</span><br><span class="line">one</span><br><span class="line">sb: receive value: (S(p: AnyPublisher))</span><br><span class="line">two</span><br><span class="line">sb: receive value: (S(p: AnyPublisher))</span><br><span class="line">three</span><br><span class="line">sb: receive finished</span><br></pre></td></tr></table></figure></p>
<h4 id="append"><a href="#append" class="headerlink" title="append"></a>append</h4><p>append 会在发布者发布结束后追加发送数据，发布者不结束，append 的数据不会发送。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cc <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> pb <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">String</span>, <span class="type">Never</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sb <span class="operator">=</span> pb</span><br><span class="line">    .print(<span class="string">&quot;sb&quot;</span>)</span><br><span class="line">    .append(<span class="string">&quot;five&quot;</span>, <span class="string">&quot;six&quot;</span>)</span><br><span class="line">    .sink &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">sb.store(in: <span class="operator">&amp;</span>cc)</span><br><span class="line"></span><br><span class="line">pb.send(<span class="string">&quot;one&quot;</span>)</span><br><span class="line">pb.send(<span class="string">&quot;two&quot;</span>)</span><br><span class="line">pb.send(<span class="string">&quot;three&quot;</span>)</span><br><span class="line">pb.send(completion: .finished)</span><br></pre></td></tr></table></figure>
<p>输出<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sb: receive subscription: ([戴铭的Swift小册子.AppDelegate.(unknown context at $101167070).(unknown context at $1011670f4).S(p: AnyPublisher), 戴铭的Swift小册子.AppDelegate.(unknown context at $101167070).(unknown context at $1011670f4).S(p: AnyPublisher), 戴铭的Swift小册子.AppDelegate.(unknown context at $101167070).(unknown context at $1011670f4).S(p: AnyPublisher)])</span><br><span class="line">sb: request unlimited</span><br><span class="line">sb: receive value: (S(p: AnyPublisher))</span><br><span class="line">one</span><br><span class="line">sb: receive value: (S(p: AnyPublisher))</span><br><span class="line">two</span><br><span class="line">sb: receive value: (S(p: AnyPublisher))</span><br><span class="line">three</span><br><span class="line">sb: receive finished</span><br></pre></td></tr></table></figure></p>
<h4 id="prepend"><a href="#prepend" class="headerlink" title="prepend"></a>prepend</h4><p>prepend 会在发布者发布前先发送数据，发布者不结束也不会受影响。发布者和集合也可以被打平发布。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cc <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> pb1 <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">String</span>, <span class="type">Never</span>&gt;()</span><br><span class="line"><span class="keyword">let</span> pb2 <span class="operator">=</span> [<span class="string">&quot;nine&quot;</span>, <span class="string">&quot;ten&quot;</span>].publisher</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sb <span class="operator">=</span> pb1</span><br><span class="line">    .print(<span class="string">&quot;sb&quot;</span>)</span><br><span class="line">    .prepend(pb2)</span><br><span class="line">    .prepend([<span class="string">&quot;seven&quot;</span>,<span class="string">&quot;eight&quot;</span>])</span><br><span class="line">    .prepend(<span class="string">&quot;five&quot;</span>, <span class="string">&quot;six&quot;</span>)</span><br><span class="line">    .sink &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">sb.store(in: <span class="operator">&amp;</span>cc)</span><br><span class="line"></span><br><span class="line">pb1.send(<span class="string">&quot;one&quot;</span>)</span><br><span class="line">pb1.send(<span class="string">&quot;two&quot;</span>)</span><br><span class="line">pb1.send(<span class="string">&quot;three&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>输出<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">five</span><br><span class="line">six</span><br><span class="line">seven</span><br><span class="line">eight</span><br><span class="line">nine</span><br><span class="line">ten</span><br><span class="line">sb: receive subscription: (PassthroughSubject)</span><br><span class="line">sb: request unlimited</span><br><span class="line">sb: receive value: (one)</span><br><span class="line">one</span><br><span class="line">sb: receive value: (two)</span><br><span class="line">two</span><br><span class="line">sb: receive value: (three)</span><br><span class="line">three</span><br><span class="line">sb: receive cancel</span><br></pre></td></tr></table></figure></p>
<h4 id="merge"><a href="#merge" class="headerlink" title="merge"></a>merge</h4><p>订阅者可以通过 merge 合并多个发布者发布的数据</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cc <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ps1 <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">String</span>, <span class="type">Never</span>&gt;()</span><br><span class="line"><span class="keyword">let</span> ps2 <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">String</span>, <span class="type">Never</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sb1 <span class="operator">=</span> ps1.merge(with: ps2)</span><br><span class="line">    .sink &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">ps1.send(<span class="string">&quot;one&quot;</span>)</span><br><span class="line">ps1.send(<span class="string">&quot;two&quot;</span>)</span><br><span class="line">ps2.send(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">ps2.send(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">ps1.send(<span class="string">&quot;three&quot;</span>)</span><br><span class="line"></span><br><span class="line">sb1.store(in: <span class="operator">&amp;</span>cc)</span><br></pre></td></tr></table></figure>
<p>输出<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sb1: receive subscription: (Merge)</span><br><span class="line">sb1: request unlimited</span><br><span class="line">sb1: receive value: (one)</span><br><span class="line">one</span><br><span class="line">sb1: receive value: (two)</span><br><span class="line">two</span><br><span class="line">sb1: receive value: (1)</span><br><span class="line">1</span><br><span class="line">sb1: receive value: (2)</span><br><span class="line">2</span><br><span class="line">sb1: receive value: (three)</span><br><span class="line">three</span><br><span class="line">sb1: receive cancel</span><br></pre></td></tr></table></figure></p>
<h4 id="zip"><a href="#zip" class="headerlink" title="zip"></a>zip</h4><p>zip 会合并多个发布者发布的数据，只有当多个发布者都发布了数据后才会组合成一个数据给订阅者。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cc <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ps1 <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">String</span>, <span class="type">Never</span>&gt;()</span><br><span class="line"><span class="keyword">let</span> ps2 <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">String</span>, <span class="type">Never</span>&gt;()</span><br><span class="line"><span class="keyword">let</span> ps3 <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">String</span>, <span class="type">Never</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sb1 <span class="operator">=</span> ps1.zip(ps2, ps3)</span><br><span class="line">    .print(<span class="string">&quot;sb1&quot;</span>)</span><br><span class="line">    .sink &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">ps1.send(<span class="string">&quot;one&quot;</span>)</span><br><span class="line">ps1.send(<span class="string">&quot;two&quot;</span>)</span><br><span class="line">ps1.send(<span class="string">&quot;three&quot;</span>)</span><br><span class="line">ps2.send(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">ps2.send(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">ps1.send(<span class="string">&quot;four&quot;</span>)</span><br><span class="line">ps2.send(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">ps3.send(<span class="string">&quot;一&quot;</span>)</span><br><span class="line"></span><br><span class="line">sb1.store(in: <span class="operator">&amp;</span>cc)</span><br></pre></td></tr></table></figure>
<p>输出<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sb1: receive subscription: (Zip)</span><br><span class="line">sb1: request unlimited</span><br><span class="line">sb1: receive value: ((&quot;one&quot;, &quot;1&quot;, &quot;一&quot;))</span><br><span class="line">(&quot;one&quot;, &quot;1&quot;, &quot;一&quot;)</span><br><span class="line">sb1: receive cancel</span><br></pre></td></tr></table></figure></p>
<h4 id="combineLatest"><a href="#combineLatest" class="headerlink" title="combineLatest"></a>combineLatest</h4><p>combineLatest 会合并多个发布者发布的数据，只有当多个发布者都发布了数据后才会触发合并，合并每个发布者发布的最后一个数据。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cc <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line">        </span><br><span class="line"><span class="keyword">let</span> ps1 <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">String</span>, <span class="type">Never</span>&gt;()</span><br><span class="line"><span class="keyword">let</span> ps2 <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">String</span>, <span class="type">Never</span>&gt;()</span><br><span class="line"><span class="keyword">let</span> ps3 <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">String</span>, <span class="type">Never</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sb1 <span class="operator">=</span> ps1.combineLatest(ps2, ps3)</span><br><span class="line">    .print(<span class="string">&quot;sb1&quot;</span>)</span><br><span class="line">    .sink &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">ps1.send(<span class="string">&quot;one&quot;</span>)</span><br><span class="line">ps1.send(<span class="string">&quot;two&quot;</span>)</span><br><span class="line">ps1.send(<span class="string">&quot;three&quot;</span>)</span><br><span class="line">ps2.send(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">ps2.send(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">ps1.send(<span class="string">&quot;four&quot;</span>)</span><br><span class="line">ps2.send(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">ps3.send(<span class="string">&quot;一&quot;</span>)</span><br><span class="line">ps3.send(<span class="string">&quot;二&quot;</span>)</span><br><span class="line"></span><br><span class="line">sb1.store(in: <span class="operator">&amp;</span>cc)</span><br></pre></td></tr></table></figure>
<p>输出<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sb1: receive subscription: (CombineLatest)</span><br><span class="line">sb1: request unlimited</span><br><span class="line">sb1: receive value: ((&quot;four&quot;, &quot;3&quot;, &quot;一&quot;))</span><br><span class="line">(&quot;four&quot;, &quot;3&quot;, &quot;一&quot;)</span><br><span class="line">sb1: receive value: ((&quot;four&quot;, &quot;3&quot;, &quot;二&quot;))</span><br><span class="line">(&quot;four&quot;, &quot;3&quot;, &quot;二&quot;)</span><br><span class="line">sb1: receive cancel</span><br></pre></td></tr></table></figure></p>
<h4 id="Scheduler"><a href="#Scheduler" class="headerlink" title="Scheduler"></a>Scheduler</h4><p>Scheduler 处理队列。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cc <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line">        </span><br><span class="line"><span class="keyword">let</span> sb1 <span class="operator">=</span> [<span class="string">&quot;one&quot;</span>,<span class="string">&quot;two&quot;</span>,<span class="string">&quot;three&quot;</span>].publisher</span><br><span class="line">    .print(<span class="string">&quot;sb1&quot;</span>)</span><br><span class="line">    .subscribe(on: <span class="type">DispatchQueue</span>.global())</span><br><span class="line">    .handleEvents(receiveOutput: &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;receiveOutput&quot;</span>,<span class="variable">$0</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .receive(on: <span class="type">DispatchQueue</span>.main)</span><br><span class="line">    .sink &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">sb1.store(in: <span class="operator">&amp;</span>cc)</span><br></pre></td></tr></table></figure>
<p>输出<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sb1: receive subscription: ([1, 2, 3])</span><br><span class="line">sb1: request unlimited</span><br><span class="line">sb1: receive value: (1)</span><br><span class="line">receiveOutput 1</span><br><span class="line">sb1: receive value: (2)</span><br><span class="line">receiveOutput 2</span><br><span class="line">sb1: receive value: (3)</span><br><span class="line">receiveOutput 3</span><br><span class="line">sb1: receive finished</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td></tr></table></figure></p>
<h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><h4 id="网络请求"><a href="#网络请求" class="headerlink" title="网络请求"></a>网络请求</h4><p>网络URLSession.dataTaskPublisher使用例子如下：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> req <span class="operator">=</span> <span class="type">URLRequest</span>(url: <span class="type">URL</span>(string: <span class="string">&quot;http://www.starming.com&quot;</span>)<span class="operator">!</span>)</span><br><span class="line"><span class="keyword">let</span> dpPublisher <span class="operator">=</span> <span class="type">URLSession</span>.shared.dataTaskPublisher(for: req)</span><br></pre></td></tr></table></figure></p>
<p>一个请求Github接口并展示结果的例子<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// CombineSearchAPI.swift</span></span><br><span class="line"><span class="comment">// SwiftOnly (iOS)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by Ming Dai on 2021/11/4.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CombineSearchAPI</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">GithubSearchView</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: Github View</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">GithubSearchView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="keyword">var</span> str: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;Swift&quot;</span></span><br><span class="line">  <span class="meta">@StateObject</span> <span class="keyword">var</span> ss: <span class="type">SearchStore</span> <span class="operator">=</span> <span class="type">SearchStore</span>()</span><br><span class="line">  <span class="meta">@State</span> <span class="keyword">var</span> repos: [<span class="type">GithubRepo</span>] <span class="operator">=</span> []</span><br><span class="line">  <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">NavigationView</span> &#123;</span><br><span class="line">      <span class="type">List</span> &#123;</span><br><span class="line">        <span class="type">TextField</span>(<span class="string">&quot;输入：&quot;</span>, text: <span class="variable">$str</span>, onCommit: fetch)</span><br><span class="line">        <span class="type">ForEach</span>(<span class="keyword">self</span>.ss.repos) &#123; repo -&gt; <span class="type">GithubRepoCell</span> <span class="keyword">in</span></span><br><span class="line">          <span class="type">GithubRepoCell</span>(repo: repo)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      .navigationTitle(<span class="string">&quot;搜索&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .onAppear(perform: fetch)</span><br><span class="line">  &#125;</span><br><span class="line">   </span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">fetch</span>()</span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.ss.search(str: <span class="keyword">self</span>.str)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">GithubRepoCell</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> repo: <span class="type">GithubRepo</span></span><br><span class="line">  <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">VStack</span>(alignment: .leading, spacing: <span class="number">20</span>) &#123;</span><br><span class="line">      <span class="type">Text</span>(<span class="keyword">self</span>.repo.name)</span><br><span class="line">      <span class="type">Text</span>(<span class="keyword">self</span>.repo.description)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: Github Service</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">GithubRepo</span>: <span class="title">Decodable</span>, <span class="title">Identifiable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> id: <span class="type">Int</span></span><br><span class="line">  <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">  <span class="keyword">let</span> description: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">GithubResp</span>: <span class="title">Decodable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> items: [<span class="type">GithubRepo</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">GithubSearchManager</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">search</span>(<span class="params">str</span>: <span class="type">String</span>)</span> -&gt; <span class="type">AnyPublisher</span>&lt;<span class="type">GithubResp</span>, <span class="type">Never</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">var</span> urlComponents <span class="operator">=</span> <span class="type">URLComponents</span>(string: <span class="string">&quot;https://api.github.com/search/repositories&quot;</span>) <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">preconditionFailure</span>(<span class="string">&quot;链接无效&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    urlComponents.queryItems <span class="operator">=</span> [<span class="type">URLQueryItem</span>(name: <span class="string">&quot;q&quot;</span>, value: str)]</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> url <span class="operator">=</span> urlComponents.url <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">preconditionFailure</span>(<span class="string">&quot;链接无效&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> sch <span class="operator">=</span> <span class="type">DispatchQueue</span>(label: <span class="string">&quot;API&quot;</span>, qos: .default, attributes: .concurrent)</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">return</span> <span class="type">URLSession</span>.shared</span><br><span class="line">      .dataTaskPublisher(for: url)</span><br><span class="line">      .receive(on: sch)</span><br><span class="line">      .tryMap(&#123; element -&gt; <span class="type">Data</span> <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="type">String</span>(decoding: element.data, as: <span class="type">UTF8</span>.<span class="keyword">self</span>))</span><br><span class="line">        <span class="keyword">return</span> element.data</span><br><span class="line">      &#125;)</span><br><span class="line">      .decode(type: <span class="type">GithubResp</span>.<span class="keyword">self</span>, decoder: <span class="type">JSONDecoder</span>())</span><br><span class="line">      .catch &#123; <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">        <span class="type">Empty</span>().eraseToAnyPublisher()</span><br><span class="line">      &#125;</span><br><span class="line">      .eraseToAnyPublisher()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">SearchStore</span>: <span class="title">ObservableObject</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Published</span> <span class="keyword">var</span> query: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="meta">@Published</span> <span class="keyword">var</span> repos: [<span class="type">GithubRepo</span>] <span class="operator">=</span> []</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> searchManager: <span class="type">GithubSearchManager</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> cancellable <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line">   </span><br><span class="line">  <span class="function"><span class="keyword">init</span>(<span class="params">searchManager</span>: <span class="type">GithubSearchManager</span> <span class="operator">=</span> <span class="type">GithubSearchManager</span>())</span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.searchManager <span class="operator">=</span> searchManager</span><br><span class="line">    <span class="variable">$query</span></span><br><span class="line">      .debounce(for: .milliseconds(<span class="number">500</span>), scheduler: <span class="type">RunLoop</span>.main)</span><br><span class="line">      .flatMap &#123; query -&gt; <span class="type">AnyPublisher</span>&lt;[<span class="type">GithubRepo</span>], <span class="type">Never</span>&gt; <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">return</span> searchManager.search(str: query)</span><br><span class="line">          .map &#123;</span><br><span class="line">            <span class="variable">$0</span>.items</span><br><span class="line">          &#125;</span><br><span class="line">          .eraseToAnyPublisher()</span><br><span class="line">      &#125;</span><br><span class="line">      .receive(on: <span class="type">DispatchQueue</span>.main)</span><br><span class="line">      .assign(to: \.repos, on: <span class="keyword">self</span>)</span><br><span class="line">      .store(in: <span class="operator">&amp;</span>cancellable)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">search</span>(<span class="params">str</span>: <span class="type">String</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.query <span class="operator">=</span> str</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>抽象基础网络能力，方便扩展，代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// CombineAPI.swift</span></span><br><span class="line"><span class="comment">// SwiftOnly (iOS)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by Ming Dai on 2021/11/4.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CombineAPI</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">RepListView</span>(vm: .<span class="keyword">init</span>())</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">RepListView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">  <span class="meta">@ObservedObject</span> <span class="keyword">var</span> vm: <span class="type">RepListVM</span></span><br><span class="line">   </span><br><span class="line">  <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">NavigationView</span> &#123;</span><br><span class="line">      <span class="type">List</span>(vm.repos) &#123; rep <span class="keyword">in</span></span><br><span class="line">        <span class="type">RepListCell</span>(rep: rep)</span><br><span class="line">      &#125;</span><br><span class="line">      .alert(isPresented: <span class="variable">$vm</span>.isErrorShow) &#123; () -&gt; <span class="type">Alert</span> <span class="keyword">in</span></span><br><span class="line">        <span class="type">Alert</span>(title: <span class="type">Text</span>(<span class="string">&quot;出错了&quot;</span>), message: <span class="type">Text</span>(vm.errorMessage))</span><br><span class="line">      &#125;</span><br><span class="line">      .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;仓库&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    .onAppear &#123;</span><br><span class="line">      vm.apply(.onAppear)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">RepListCell</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="keyword">var</span> rep: <span class="type">RepoModel</span></span><br><span class="line">  <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">HStack</span>() &#123;</span><br><span class="line">      <span class="type">VStack</span>() &#123;</span><br><span class="line">        <span class="type">AsyncImage</span>(url: <span class="type">URL</span>(string: rep.owner.avatarUrl <span class="operator">??</span> <span class="string">&quot;&quot;</span>), content: &#123; image <span class="keyword">in</span></span><br><span class="line">          image</span><br><span class="line">            .resizable()</span><br><span class="line">            .aspectRatio(contentMode: .fit)</span><br><span class="line">            .frame(width: <span class="number">100</span>, height: <span class="number">100</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        placeholder: &#123;</span><br><span class="line">          <span class="type">ProgressView</span>()</span><br><span class="line">            .frame(width: <span class="number">100</span>, height: <span class="number">100</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;<span class="subst">\(rep.owner.login)</span>&quot;</span>)</span><br><span class="line">          .font(.system(size: <span class="number">10</span>))</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">VStack</span>(alignment: .leading, spacing: <span class="number">10</span>) &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;<span class="subst">\(rep.name)</span>&quot;</span>)</span><br><span class="line">          .font(.title)</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;<span class="subst">\(rep.stargazersCount)</span>&quot;</span>)</span><br><span class="line">          .font(.title3)</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;<span class="subst">\(String(describing: rep.description <span class="operator">??</span> <span class="string">&quot;&quot;</span>))</span>&quot;</span>)</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;<span class="subst">\(String(describing: rep.language <span class="operator">??</span> <span class="string">&quot;&quot;</span>))</span>&quot;</span>)</span><br><span class="line">          .font(.title3)</span><br><span class="line">      &#125;</span><br><span class="line">      .font(.system(size: <span class="number">14</span>))</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: Repo View Model</span></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">RepListVM</span>: <span class="title">ObservableObject</span>, <span class="title">UnidirectionalDataFlowType</span> </span>&#123;</span><br><span class="line">  <span class="keyword">typealias</span> <span class="type">InputType</span> <span class="operator">=</span> <span class="type">Input</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> cancellables: [<span class="type">AnyCancellable</span>] <span class="operator">=</span> []</span><br><span class="line">   </span><br><span class="line">  <span class="comment">// Input</span></span><br><span class="line">  <span class="class"><span class="keyword">enum</span> <span class="title">Input</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> onAppear</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">apply</span>(<span class="keyword">_</span> <span class="params">input</span>: <span class="type">Input</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> input &#123;</span><br><span class="line">    <span class="keyword">case</span> .onAppear:</span><br><span class="line">      onAppearSubject.send(())</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> onAppearSubject <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">Void</span>, <span class="type">Never</span>&gt;()</span><br><span class="line">   </span><br><span class="line">  <span class="comment">// Output</span></span><br><span class="line">  <span class="meta">@Published</span> <span class="keyword">private(set)</span> <span class="keyword">var</span> repos: [<span class="type">RepoModel</span>] <span class="operator">=</span> []</span><br><span class="line">  <span class="meta">@Published</span> <span class="keyword">var</span> isErrorShow <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">  <span class="meta">@Published</span> <span class="keyword">var</span> errorMessage <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="meta">@Published</span> <span class="keyword">private(set)</span> <span class="keyword">var</span> shouldShowIcon <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">   </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> resSubject <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">SearchRepoModel</span>, <span class="type">Never</span>&gt;()</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> errSubject <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">APISevError</span>, <span class="type">Never</span>&gt;()</span><br><span class="line">   </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> apiSev: <span class="type">APISev</span></span><br><span class="line">   </span><br><span class="line">  <span class="function"><span class="keyword">init</span>(<span class="params">apiSev</span>: <span class="type">APISev</span> <span class="operator">=</span> <span class="type">APISev</span>())</span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.apiSev <span class="operator">=</span> apiSev</span><br><span class="line">    bindInputs()</span><br><span class="line">    bindOutputs()</span><br><span class="line">  &#125;</span><br><span class="line">   </span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">bindInputs</span>()</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> req <span class="operator">=</span> <span class="type">SearchRepoRequest</span>()</span><br><span class="line">    <span class="keyword">let</span> resPublisher <span class="operator">=</span> onAppearSubject</span><br><span class="line">      .flatMap &#123; [apiSev] <span class="keyword">in</span></span><br><span class="line">        apiSev.response(from: req)</span><br><span class="line">          .catch &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] error -&gt; <span class="type">Empty</span>&lt;<span class="type">SearchRepoModel</span>, <span class="type">Never</span>&gt; <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span><span class="operator">?</span>.errSubject.send(error)</span><br><span class="line">            <span class="keyword">return</span> .<span class="keyword">init</span>()</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">let</span> resStream <span class="operator">=</span> resPublisher</span><br><span class="line">      .share()</span><br><span class="line">      .subscribe(resSubject)</span><br><span class="line">     </span><br><span class="line">    <span class="comment">// 其它异步事件，比如日志等操作都可以做成Stream加到下面数组内。</span></span><br><span class="line">    cancellables <span class="operator">+=</span> [resStream]</span><br><span class="line">  &#125;</span><br><span class="line">   </span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">bindOutputs</span>()</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> repStream <span class="operator">=</span> resSubject</span><br><span class="line">      .map &#123;</span><br><span class="line">        <span class="variable">$0</span>.items</span><br><span class="line">      &#125;</span><br><span class="line">      .assign(to: \.repos, on: <span class="keyword">self</span>)</span><br><span class="line">    <span class="keyword">let</span> errMsgStream <span class="operator">=</span> errSubject</span><br><span class="line">      .map &#123; error -&gt; <span class="type">String</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">switch</span> error &#123;</span><br><span class="line">        <span class="keyword">case</span> .resError: <span class="keyword">return</span> <span class="string">&quot;network error&quot;</span></span><br><span class="line">        <span class="keyword">case</span> .parseError: <span class="keyword">return</span> <span class="string">&quot;parse error&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      .assign(to: \.errorMessage, on: <span class="keyword">self</span>)</span><br><span class="line">    <span class="keyword">let</span> errStream <span class="operator">=</span> errSubject</span><br><span class="line">      .map &#123; <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">        <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">      .assign(to: \.isErrorShow, on: <span class="keyword">self</span>)</span><br><span class="line">    cancellables <span class="operator">+=</span> [repStream,errStream,errMsgStream]</span><br><span class="line">  &#125;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">UnidirectionalDataFlowType</span> </span>&#123;</span><br><span class="line">  <span class="keyword">associatedtype</span> <span class="type">InputType</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">apply</span>(<span class="keyword">_</span> <span class="params">input</span>: <span class="type">InputType</span>)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: Repo Request and Models</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SearchRepoRequest</span>: <span class="title">APIReqType</span> </span>&#123;</span><br><span class="line">  <span class="keyword">typealias</span> <span class="type">Res</span> <span class="operator">=</span> <span class="type">SearchRepoModel</span></span><br><span class="line">   </span><br><span class="line">  <span class="keyword">var</span> path: <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;/search/repositories&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> qItems: [<span class="type">URLQueryItem</span>]<span class="operator">?</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">      .<span class="keyword">init</span>(name: <span class="string">&quot;q&quot;</span>, value: <span class="string">&quot;Combine&quot;</span>),</span><br><span class="line">      .<span class="keyword">init</span>(name: <span class="string">&quot;order&quot;</span>, value: <span class="string">&quot;desc&quot;</span>)</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SearchRepoModel</span>: <span class="title">Decodable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> items: [<span class="type">RepoModel</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">RepoModel</span>: <span class="title">Decodable</span>, <span class="title">Hashable</span>, <span class="title">Identifiable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> id: <span class="type">Int64</span></span><br><span class="line">  <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">  <span class="keyword">var</span> fullName: <span class="type">String</span></span><br><span class="line">  <span class="keyword">var</span> description: <span class="type">String</span>?</span><br><span class="line">  <span class="keyword">var</span> stargazersCount: <span class="type">Int</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">  <span class="keyword">var</span> language: <span class="type">String</span>?</span><br><span class="line">  <span class="keyword">var</span> owner: <span class="type">OwnerModel</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">OwnerModel</span>: <span class="title">Decodable</span>, <span class="title">Hashable</span>, <span class="title">Identifiable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> id: <span class="type">Int64</span></span><br><span class="line">  <span class="keyword">var</span> login: <span class="type">String</span></span><br><span class="line">  <span class="keyword">var</span> avatarUrl: <span class="type">String</span>?</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: API Request Fundation</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">APIReqType</span> </span>&#123;</span><br><span class="line">  <span class="keyword">associatedtype</span> <span class="type">Res</span>: <span class="type">Decodable</span></span><br><span class="line">  <span class="keyword">var</span> path: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">  <span class="keyword">var</span> qItems: [<span class="type">URLQueryItem</span>]<span class="operator">?</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">APISevType</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">response</span>&lt;<span class="type">Request</span>&gt;(<span class="params">from</span> <span class="params">req</span>: <span class="type">Request</span>)</span> -&gt; <span class="type">AnyPublisher</span>&lt;<span class="type">Request</span>.<span class="type">Res</span>, <span class="type">APISevError</span>&gt; <span class="keyword">where</span> <span class="type">Request</span>: <span class="type">APIReqType</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">APISev</span>: <span class="title">APISevType</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> rootUrl: <span class="type">URL</span></span><br><span class="line">  <span class="function"><span class="keyword">init</span>(<span class="params">rootUrl</span>: <span class="type">URL</span> <span class="operator">=</span> <span class="type">URL</span>(string: <span class="string">&quot;https://api.github.com&quot;</span>)<span class="operator">!</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.rootUrl <span class="operator">=</span> rootUrl</span><br><span class="line">  &#125;</span><br><span class="line">   </span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">response</span>&lt;<span class="type">Request</span>&gt;(<span class="params">from</span> <span class="params">req</span>: <span class="type">Request</span>)</span> -&gt; <span class="type">AnyPublisher</span>&lt;<span class="type">Request</span>.<span class="type">Res</span>, <span class="type">APISevError</span>&gt; <span class="keyword">where</span> <span class="type">Request</span> : <span class="type">APIReqType</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> path <span class="operator">=</span> <span class="type">URL</span>(string: req.path, relativeTo: rootUrl)<span class="operator">!</span></span><br><span class="line">    <span class="keyword">var</span> comp <span class="operator">=</span> <span class="type">URLComponents</span>(url: path, resolvingAgainstBaseURL: <span class="literal">true</span>)<span class="operator">!</span></span><br><span class="line">    comp.queryItems <span class="operator">=</span> req.qItems</span><br><span class="line">    <span class="built_in">print</span>(comp.url<span class="operator">?</span>.description <span class="operator">??</span> <span class="string">&quot;url wrong&quot;</span>)</span><br><span class="line">    <span class="keyword">var</span> req <span class="operator">=</span> <span class="type">URLRequest</span>(url: comp.url<span class="operator">!</span>)</span><br><span class="line">    req.addValue(<span class="string">&quot;application/json&quot;</span>, forHTTPHeaderField: <span class="string">&quot;Content-Type&quot;</span>)</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">let</span> de <span class="operator">=</span> <span class="type">JSONDecoder</span>()</span><br><span class="line">    de.keyDecodingStrategy <span class="operator">=</span> .convertFromSnakeCase</span><br><span class="line">    <span class="keyword">return</span> <span class="type">URLSession</span>.shared.dataTaskPublisher(for: req)</span><br><span class="line">      .map &#123; data, res <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="type">String</span>(decoding: data, as: <span class="type">UTF8</span>.<span class="keyword">self</span>))</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line">      &#125;</span><br><span class="line">      .mapError &#123; <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">        <span class="type">APISevError</span>.resError</span><br><span class="line">      &#125;</span><br><span class="line">      .decode(type: <span class="type">Request</span>.<span class="type">Res</span>.<span class="keyword">self</span>, decoder: de)</span><br><span class="line">      .mapError(<span class="type">APISevError</span>.parseError)</span><br><span class="line">      .receive(on: <span class="type">RunLoop</span>.main)</span><br><span class="line">      .eraseToAnyPublisher()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">APISevError</span>: <span class="title">Error</span> </span>&#123;</span><br><span class="line">  <span class="keyword">case</span> resError</span><br><span class="line">  <span class="keyword">case</span> parseError(<span class="type">Error</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="KVO"><a href="#KVO" class="headerlink" title="KVO"></a>KVO</h4><p>例子如下：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">KVOObject</span>: <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">  <span class="keyword">@objc</span> <span class="keyword">dynamic</span> <span class="keyword">var</span> intV: <span class="type">Int</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">  <span class="keyword">@objc</span> <span class="keyword">dynamic</span> <span class="keyword">var</span> boolV: <span class="type">Bool</span> <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> o <span class="operator">=</span> <span class="type">KVOObject</span>()</span><br><span class="line"><span class="keyword">let</span> <span class="keyword">_</span> <span class="operator">=</span> o.publisher(for: \.intV)</span><br><span class="line">  .sink &#123; v <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;value : <span class="subst">\(v)</span>&quot;</span>)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="通知"><a href="#通知" class="headerlink" title="通知"></a>通知</h4><p>使用例子如下：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Notification</span>.<span class="title">Name</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> noti <span class="operator">=</span> <span class="type">Notification</span>.<span class="type">Name</span>(<span class="string">&quot;nameofnoti&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> notiPb <span class="operator">=</span> <span class="type">NotificationCenter</span>.default.publisher(for: .noti, object: <span class="literal">nil</span>)</span><br><span class="line">        .sink &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></p>
<p>退到后台接受通知的例子如下：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> storage <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line">   </span><br><span class="line">  <span class="function"><span class="keyword">init</span>()</span> &#123;</span><br><span class="line">    <span class="type">NotificationCenter</span>.default.publisher(for: <span class="type">UIWindowScene</span>.didEnterBackgroundNotification)</span><br><span class="line">      .sink &#123; <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;enter background&quot;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      .store(in: <span class="operator">&amp;</span><span class="keyword">self</span>.storage)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="Timer"><a href="#Timer" class="headerlink" title="Timer"></a>Timer</h4><p>使用方式如下：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> timePb <span class="operator">=</span> <span class="type">Timer</span>.publish(every: <span class="number">1.0</span>, on: <span class="type">RunLoop</span>.main, in: .default)</span><br><span class="line"><span class="keyword">let</span> timeSk <span class="operator">=</span> timePb.sink &#123; r <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;r is <span class="subst">\(r)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> cPb <span class="operator">=</span> timePb.connect()</span><br></pre></td></tr></table></figure></p>
<h2 id="Concurrency"><a href="#Concurrency" class="headerlink" title="Concurrency"></a>Concurrency</h2><h3 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h3><h4 id="Swift-Concurrency-是什么？"><a href="#Swift-Concurrency-是什么？" class="headerlink" title="Swift Concurrency 是什么？"></a>Swift Concurrency 是什么？</h4><p>ABI 稳定后，Swift 的核心团队可以开始关注 Swift 语言一直缺失的原生并发能力了。最初是由 <a target="_blank" rel="noopener" href="https://twitter.com/clattner_llvm">Chris Lattner</a> 在17年发的 <a target="_blank" rel="noopener" href="https://gist.github.com/lattner/31ed37682ef1576b16bca1432ea9f782">Swift并发宣言</a> ，从此开阔了大家的眼界。后来 Swift Evolution 社区讨论了十几个提案，几十个方案，以及几百页的设计文件，做了大量的改进，社区中用户积极的参与反馈，Chris 也一直在 Evolution 中积极的参与设计。</p>
<p>Swift Concurrency 的实现用了 <a target="_blank" rel="noopener" href="https://llvm.org/docs/Coroutines.html">LLVM的协程</a> 把 async/await 函数转换为基于回调的代码，这个过程发生在编译后期，这个阶段你的代码都没法辨识了。异步的函数被实现为 coroutines，在每次异步调用时，函数被分割成可调用的函数部分和后面恢复的部分。coroutine 拆分的过程发生在生成LLVM IR阶段。Swift使用了哪些带有自定义调用约定的函数保证尾部调用，并专门为Swift进行了调整。</p>
<p>Swift Concurrency 不是建立在 GCD 上，而是使用的一个全新的线程池。GCD 中启动队列工作会很快在提起线程，一个队列阻塞了线程，就会生成一个新线程。基于这种机制 GCD 线程数很容易比 CPU 核心数量多，线程多了，线程就会有大量的调度开销，大量的上下文切换，会使 CPU 运行效率降低。而 Swift Concurrency 的线程数量不会超过 CPU 内核，将上下文切换放到同一个线程中去做。为了实现线程不被阻塞，需要通过语言特性来做。做法是，每个线程都有一个堆栈记录函数调用情况，一个函数占一个帧。函数返回后，这个函数所占的帧就会从堆栈弹出。await 的 async 函数被作为异步帧保存在堆上等待恢复，而不阻碍其它函数入栈执行。在 await 后运行的代码叫 continuation，continuation 会在要恢复时放回到线程的堆栈里。异步帧会根据需要放回栈上。在一个异步函数中调用同步代码将添加帧到线程的堆栈中。这样线程就能够一直向前跑，而不用创建更多线程减少调度。</p>
<p>Douglas 在 Swift 论坛里发的 Swift Concurrency 下个版本的规划贴  <a target="_blank" rel="noopener" href="https://forums.swift.org/t/concurrency-in-swift-5-and-6/49337">Concurrency in Swift 5 and 6</a> ，论坛里还有一个帖子是专门用来 <a target="_blank" rel="noopener" href="https://forums.swift.org/t/swift-concurrency-feedback-wanted/49336">征集Swift Concurrency意见</a> 的，帖子本身列出了 Swift Concurrency 相关的所有提案，也提出欢迎有新提案发出来，除了这些提案可以看外，帖子回复目前已经过百，非常热闹，可以看出大家对 Swift Concurrency 的关注度相当的高。</p>
<p>非常多的人参与了 Swift Concurrency 才使其看起来和用起来那么简单。Doug Gregor 在参与 John Sundell 的播客后，发了很多条推聊 Swift Concurrency，可以看到参与的人非常多，可见背后付出的努力有多大。下面我汇总了 Doug Gregor 在推上发的一些信息，你通过这些信息也可以了解 Swift Concurrency 幕后信息，所做的事和负责的人。</p>
<p> <a target="_blank" rel="noopener" href="https://twitter.com/pathofshrines">@pathofshrines</a> 是 Swift Concurrency 整体架构师，包括低级别运行时和编译器相关细节。 <a target="_blank" rel="noopener" href="https://twitter.com/illian">@illian</a> 是 async sequences、stream 和 Fundation 的负责人。 <a target="_blank" rel="noopener" href="https://twitter.com/optshiftk">@optshiftk</a> 对 UI 和并发交互的极好的洞察力带来了很棒的 async 接口， <a target="_blank" rel="noopener" href="https://twitter.com/phausler">@phausler</a> 带来了 async sequences。Arnold Schwaighofer、 <a target="_blank" rel="noopener" href="https://twitter.com/neightchan">@neightchan</a> 、 <a target="_blank" rel="noopener" href="https://twitter.com/typesanitizer">@typesanitizer</a> 还有 Tim Northover 实现了 async calling convention。</p>
<p> <a target="_blank" rel="noopener" href="https://twitter.com/ktosopl">@ktosopl</a> 有很深厚的 actor、分布式计算和 Swift-on-Server 经验，带来了 actor 系统。Erik Eckstein 为 async 函数和actors建立了关键的优化和功能。</p>
<p>SwiftUI是 <a target="_blank" rel="noopener" href="https://twitter.com/ricketson_">@ricketson_</a> 和 <a target="_blank" rel="noopener" href="https://twitter.com/luka_bernardi">@luka_bernardi</a> 完成的async接口。async I/O的接口是 <a target="_blank" rel="noopener" href="https://twitter.com/Catfish_Man">@Catfish_Man</a> 完成的。 <a target="_blank" rel="noopener" href="https://twitter.com/slava_pestov">@slava_pestov</a> 处理了 Swift 泛型问题，还指导其他人编译器实现的细节。async 重构工具是Ben Barham 做的。大量代码移植到 async 是由 <a target="_blank" rel="noopener" href="https://twitter.com/AirspeedSwift">@AirspeedSwift</a> 领导，由 Angela Laar，Clack Cole，Nicole Jacques 和 <a target="_blank" rel="noopener" href="https://twitter.com/mishaldshah">@mishaldshah</a> 共同完成的。</p>
<p> <a target="_blank" rel="noopener" href="https://twitter.com/lorentey">@lorentey</a> 负责 Swift 接口的改进。 <a target="_blank" rel="noopener" href="https://twitter.com/jckarter">@jckarter</a> 有着敏锐的语言设计洞察力，带来了语言设计经验和编译器及运行时实现技能。 <a target="_blank" rel="noopener" href="https://twitter.com/mikeash">@mikeash</a>  也参与了运行时开发中。操作系统的集成是 <a target="_blank" rel="noopener" href="https://twitter.com/rokhinip">@rokhinip</a> 完成的， <a target="_blank" rel="noopener" href="https://twitter.com/chimz">@chimz</a> 提供了关于 Dispatch 和 OS 很好的建议，Pavel Yaskevich 和<br> <a href="https://ming1016.github.io/2021/07/24/my-little-idea-about-writing-technical-article/">@hollyborla</a> 进行了并发所需要关键类型检查器的改进。 <a target="_blank" rel="noopener" href="https://twitter.com/kastiglione">@kastiglione</a> 、Adrian Prantl和 <a target="_blank" rel="noopener" href="https://twitter.com/fred_riss">@fred_riss</a> 实现了调试。 <a target="_blank" rel="noopener" href="https://twitter.com/etcwilde">@etcwilde</a> 和 <a target="_blank" rel="noopener" href="https://twitter.com/call1cc">@call1cc</a> 实现了语义模型中的重要部分。</p>
<p> <a target="_blank" rel="noopener" href="https://twitter.com/evonox">@evonox</a> 负责了服务器Linux 的支持。 <a target="_blank" rel="noopener" href="https://twitter.com/compnerd">@compnerd</a> 将 Swift Concurrency 移植到了 Windows。</p>
<p>Swift Concurrency 模型简单，细节都被隐藏了，比 Kotlin 和 C++的 Coroutine 接口要简洁很多。比如 Task 接口形式就很简洁。Swift Concurrency 大体可分为 async/await、Async Sequences、结构化并发和 Actors。</p>
<h4 id="async-await"><a href="#async-await" class="headerlink" title="async/await"></a>async/await</h4><p>通过类似 throws 语法的 async 来指定函数为异步函数，异步函数才能够使用 await，使用异步函数要用 await。await 修饰在 suspension point 时当前线程可以让给其它任务执行，而不用阻塞当前线程，等 await 后面的函数执行完成再回来继续执行，这里需要注意的是回来执行不一定是在离开时的线程上。async/await 提案是 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0296-async-await.md">SE-0296</a> 。如果想把现有的异步开发带到 async/await 世界，请使用 withCheckedThrowingContinuation。</p>
<p>async/await 还有一个非常明显的好处，就是不会再有[weak self] dance 了。</p>
<h4 id="Async-Sequences"><a href="#Async-Sequences" class="headerlink" title="Async Sequences"></a>Async Sequences</h4><p>AsyncSequence 的使用方式是 for-await-in 和 for-try-await-in，系统提供了一些接口，如下：</p>
<ul>
<li>FileHandle.standardInput.bytes.lines</li>
<li>URL.lines</li>
<li>URLSession.shared.data(from: URL)</li>
<li>let (localURL, _ ) = try await session.download(from: url) 下载和get请求数据区别是需要边请求边存储数据以减少内存占用</li>
<li>let (responseData, response) = try await session.upload(for: request, from: data)</li>
<li>URLSession.shared.bytes(from: URL)</li>
<li>NotificationCenter.default.notifications</li>
</ul>
<h4 id="结构化并发"><a href="#结构化并发" class="headerlink" title="结构化并发"></a>结构化并发</h4><p>使用这些接口可以一边接收数据一边进行显示，AsyncSequence 的提案是 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0298-asyncsequence.md">SE-0298</a> （Swift 5.5可用）。AsyncStream 是创建自己异步序列的最简单的方法，处理迭代、取消和缓冲。AsyncStream 正在路上，提案是 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0314-async-stream.md">SE-0314</a> 。</p>
<p>Task 为一组并发任务创建一个运行环境，async let 可以让任务并发执行，结构化并发（Structured concurrency，提案在路上 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0304-structured-concurrency.md">SE-0304</a> ）withTaskGroup 中 group.async 可以将并发任务进行分组。</p>
<h4 id="Actors"><a href="#Actors" class="headerlink" title="Actors"></a>Actors</h4><p>我们写的程序会在进程中被拆成一个一个小指令，这些指令会在某刻会一个接一个同步的或者并发的执行。系统会用多个线程执行并行的任务，执行顺序是调度器来管理的，现代多核可以同时处理多个线程，当一个资源在多个线程上同时被更改时就会出问题。并发任务对数据资源操作容易造成数据竞争，以前需要手动放到串行队列、使用锁、调度屏障或 Atomics 的方式来避免。以前处理容易导致昂贵的上下文切换，过多线程容易导致线程爆炸，容易意外阻断线程导致后面代码没法执行，多任务相互的等待造成了死锁，block 和内存引用容易出错等等问题。</p>
<p>现在 Swift Concurrency 可以通过 actor 来创建一个区域，在这个区域会自动进行数据安全保护，保证一定时间只有一个线程访问里面数据，防止数据竞争。actor 内部对成员访问是同步的，成员默认是隔离的，actor 外部对 actor 内成员的访问只能是异步的，隐式同步以防止数据竞争。MainActor 继承自能确保全局唯一实例的 GlobalActor，保证任务在主线程执行，这样你就可以抛弃掉在你的 ViewModel 里写 DispatchQueue.main.async 了。</p>
<p>Actors 的概念通常被用于分布式计算，Actor 模型参看 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Actor_model">Wikipedia</a> 里的详细解释，Swift 中的实现效果也非常的理想。Actors 的提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0306-actors.md">SE-0306</a> 已在 Swift 5.5落实。</p>
<p>很多语言都支持 actors 还有 async/await，实现的方式也类似，actor 使用的不是锁，而是用的 async/await 这样能够在一个线程中切换上下文来避免线程空闲的线程模型。actor 还利用编译器，提前做会引起并发问题的检查。</p>
<p>actor 是遵循 Sendable 协议的，只有结构体和 final 类才能够遵循 Sendable，继承于 Sendable 协议的 Excutor 协议表示方法本身，SerialExecutor 表示以串行方式执行。actor 使用 C++写的，源码在 <a target="_blank" rel="noopener" href="https://github.com/apple/swift/blob/main/stdlib/public/Concurrency/Actor.cpp">这里</a> ，可以看到 actor 主要是通过控制各个 job 执行的状态的管理器。job 执行优先级来自 Task 对象，排队时需要确保高优 job 先被执行。全局 Executor 用来为 job 排队，通知 actor 拥有或者放弃线程，实现在 <a target="_blank" rel="noopener" href="https://github.com/apple/swift/blob/main/stdlib/public/Concurrency/GlobalExecutor.cpp">这里</a> 。由于等待而放弃当前线程让其他 actor 执行的 actor，在收到全局 Executor 创建一个新的 job 的通知，使其可以进入一个可能不同线程，这个过程就是并发模型中描述的 Actor Reentrancy。</p>
<h4 id="相关提案"><a href="#相关提案" class="headerlink" title="相关提案"></a>相关提案</h4><p>所有相关提案清单如下：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0296-async-await.md">SE-0296: Async/await</a>   <a target="_blank" rel="noopener" href="https://kemchenj.github.io/2021-03-06/">【译】SE-0296 Async/await</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0317-async-let.md">SE-0317: async let</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0300-continuation.md">SE-0300: Continuations for interfacing async tasks with synchronous code</a>   <a target="_blank" rel="noopener" href="https://kemchenj.github.io/2021-03-31/">【译】SE-0300 Continuation – 执行同步代码的异步任务接口</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0302-concurrent-value-and-concurrent-closures.md">SE-0302: Sendable and @Sendable closures</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0298-asyncsequence.md">SE-0298: Async/Await: Sequences</a>   <a target="_blank" rel="noopener" href="https://kemchenj.github.io/2021-03-10/">【译】SE-0298 Async/Await 序列</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0304-structured-concurrency.md">SE-0304: Structured concurrency</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0306-actors.md">SE-0306: Actors</a>   <a target="_blank" rel="noopener" href="https://kemchenj.github.io/2021-04-25/">【译】SE-0306 Actors</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0313-actor-isolation-control.md">SE-0313: Improved control over actor isolation</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0297-concurrency-objc.md">SE-0297: Concurrency Interoperability with Objective-C</a>   <a target="_blank" rel="noopener" href="https://kemchenj.github.io/2021-03-07/">【译】SE-0297 Concurrency 与 Objective-C 的交互</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0314-async-stream.md">SE-0314: AsyncStream and AsyncThrowingStream</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0316-global-actors.md">SE-0316: Global actors</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0310-effectful-readonly-properties.md">SE-0310: Effectful read-only properties</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0311-task-locals.md">SE-0311: Task Local Values</a> </li>
<li><a target="_blank" rel="noopener" href="https://forums.swift.org/t/support-custom-executors-in-swift-concurrency/44425">Custom Executors</a> </li>
</ul>
<h4 id="学习路径"><a href="#学习路径" class="headerlink" title="学习路径"></a>学习路径</h4><p>如果打算尝试 Swift Concurrency 的话，按照先后顺序，可以先看官方手册介绍文章 <a target="_blank" rel="noopener" href="https://docs.swift.org/swift-book/LanguageGuide/Concurrency.html">Concurrency</a> 。再看 <a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2021/10132/">Meet async/await in Swift</a> 这个Session，了解背后原理看 <a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2021/10134">Explore structured concurrency in Swift</a> 。动手照着试示例代码，看Paul的 <a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/concurrency">Swift Concurrency by Example</a> 这个系列。接着看 <a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2021/10133">Protect mutable state with Swift actors</a> 来了解 actors 怎么防止数据竞争。通过 <a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2021/10019">Discover concurrency in SwiftUI</a> 看 concurrency 如何在 SwiftUI 中使用， <a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2021/10095">Use async/await with URLSession</a> 来看怎么在 URLSession 中使用 async/await。最后听听负责 Swift Concurrency 的 Doug Gregor 参加的一个 <a target="_blank" rel="noopener" href="https://www.swiftbysundell.com/podcast/99/">播客的访谈</a> ，了解下 Swift Concurrency 背后的故事。</p>
<h4 id="Swift-Concurrency-和-Combine"><a href="#Swift-Concurrency-和-Combine" class="headerlink" title="Swift Concurrency 和 Combine"></a>Swift Concurrency 和 Combine</h4><p>由于 Swift Concurrency 的推出和大量的 Session 发布，特别是 <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/swift/asyncsequence/">AsyncSequence</a> 的出现，以及正在路上的 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0314-async-stream.md">AsyncStream、AsyncThrowingStream</a> 和 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0300-continuation.md">continuation</a> 提案（在Xcode 13.0 beta 3 AsyncStream 正式 <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/swift/asyncstream?changes=latest_beta">release</a> ），这些越来越多和 Combine 功能重叠的特性出现在 Swift Concurrency 蓝图里时，大家开始猜测是否 Combine 会被 Swift Concurrency 替代。关于未来是 Swift Concurrency 还是 Combine，我的感觉是，Combine 更侧重在响应式编程上，而响应式编程并不是所有开发人员都会接受的，而 Swift Concurrency 是所有人都愿意接受的开发方式，从 Swift Concurrency 推出后开发者使用的数量和社区反应火热程度来看都比 Combine 要大。在苹果对 Combine 有下一步动作之前，我还是更偏向 Swift Concurrency。</p>
<h2 id="SwiftUI"><a href="#SwiftUI" class="headerlink" title="SwiftUI"></a>SwiftUI</h2><h3 id="介绍-2"><a href="#介绍-2" class="headerlink" title="介绍"></a>介绍</h3><h4 id="SwiftUI-是什么？"><a href="#SwiftUI-是什么？" class="headerlink" title="SwiftUI 是什么？"></a>SwiftUI 是什么？</h4><p>对于一个基于UIKit的项目是没有必要全部用SwiftUI重写的，在UIKit里使用SwiftUI的视图非常容易，UIHostingController是UIViewController的子类，可以直接用在UIKit里，因此直接将SwiftUI视图加到UIHostingController中，就可以在UIKit里使用SwiftUI视图了。</p>
<p>SwiftUI的布局核心是 GeometryReader、View Preferences和Anchor Preferences。如下图所示：</p>
<p><img src="https://user-images.githubusercontent.com/251980/142988837-ab49c202-9779-4c7a-8dc2-5584900c0765.png" alt=""></p>
<p>SwiftUI的数据流更适合Redux结构，如下图所示：</p>
<p><img src="https://user-images.githubusercontent.com/251980/142988879-af591aaf-161f-4f60-9891-d7b8d313f69f.png" alt=""></p>
<p>如上图，Redux结构是真正的单向单数据源结构，易于分割，能充分利用SwiftUI内置的数据流Property Wrapper。UI组件干净、体量小、可复用并且无业务逻辑，因此开发时可以聚焦于UI代码。业务逻辑放在一起，所有业务逻辑和数据Model都在Reducer里。 <a target="_blank" rel="noopener" href="https://github.com/Dimillian/ACHNBrowserUI">ACHNBrowserUI</a>  和  <a target="_blank" rel="noopener" href="https://github.com/Dimillian/MovieSwiftUI">MovieSwiftUI</a>  开源项目都是使用的Redux架构。最近比较瞩目的TCA（The Composable Architecture）也是类Redux/Elm的架构的框架， <a target="_blank" rel="noopener" href="https://github.com/pointfreeco/swift-composable-architecture">项目地址见</a> 。</p>
<p>提到数据流就不得不说下苹果公司新出的Combine，对标的是RxSwift，由于是苹果公司官方的库，所以应该优先选择。不过和SwiftUI一样，这两个新库对APP支持最低的系统版本都要求是iOS13及以上。那么怎么能够提前用上SwiftUI和Combine呢？或者说现在使用什么库可以以相同接口方式暂时替换它们，又能在以后改为SwiftUI和Combine时成本最小化呢？</p>
<p>对于SwiftUI，AcFun自研了声明式UI Ysera，类似SwiftUI的接口，并且重构了AcFun里收藏模块列表视图和交互逻辑，如下图所示：</p>
<p><img src="https://user-images.githubusercontent.com/251980/142988909-e6626954-2c93-4c34-b10e-5345c8015cea.png" alt=""></p>
<p>通过上图可以看到，swift代码量相比较OC减少了65%以上，原先使用Objective-C实现的相同功能代码超过了1000行，而Swift重写只需要350行，对于AcFun的业务研发工程师而言，同样的需求实现代码比之前少了至少30%，面对单周迭代这样的节奏，团队也变得更从容。代码可读性增加了，后期功能迭代和维护更容易了，Swift让AcFun驶入了iOS开发生态的“快车道”。</p>
<p>SwiftUI全部都是基于Swift的各大可提高开发效率特性完成的，比如前面提到的，能够访问只给语言特性级别行为的Property Wrapper，通过Property Wrapper包装代码逻辑，来降低代码复杂度，除了SwiftUI和Combine里@开头的Property Wrapper外，Swift还自带类似 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0195-dynamic-member-lookup.md">@dynamicMemberLookup</a>  和 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0216-dynamic-callable.md">@dynamicCallable</a>  这样重量级的Property Wrapper。还有 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0289-result-builders.md">ResultBuilder</a> 这种能够简化语法的特性，有些如GraphQL、REST和Networking实际使用ResultBuilder的 <a target="_blank" rel="noopener" href="https://github.com/carson-katri/awesome-result-builders">范例可以参考</a> 。这些Swift的特性如果也能得到充分利用，即使不用SwiftUI也能使开发效率得到大幅提升。</p>
<p>网飞（Netflix）App已使用SwiftUI重构了登录界面，网飞增长团队移动负责人故胤道长记录了SwiftUI在网飞的落地过程，详细描述了 <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/oRPRCx78owLe3_gROYapCw">SwiftUI的收益</a> 。网飞能够直接使用SwiftUI得益于他们最低支持iOS 13系统。</p>
<p>不过如最低支持系统低于iOS 13，还有开源项目 <a target="_blank" rel="noopener" href="https://github.com/rakutentech/AltSwiftUI">AltSwiftUI</a> 也实现了SwiftUI的语法和特性，能够向前兼容到iOS 11。</p>
<h3 id="视图组件使用"><a href="#视图组件使用" class="headerlink" title="视图组件使用"></a>视图组件使用</h3><h4 id="SwiftUI-对标的-UIKit-视图"><a href="#SwiftUI-对标的-UIKit-视图" class="headerlink" title="SwiftUI 对标的 UIKit 视图"></a>SwiftUI 对标的 UIKit 视图</h4><p>如下：</p>
<table>
<thead>
<tr>
<th>SwiftUI</th>
<th>UIKit</th>
</tr>
</thead>
<tbody>
<tr>
<td>Text 和 Label</td>
<td>UILabel</td>
</tr>
<tr>
<td>TextField</td>
<td>UITextField</td>
</tr>
<tr>
<td>TextEditor</td>
<td>UITextView</td>
</tr>
<tr>
<td>Button 和 Link</td>
<td>UIButton</td>
</tr>
<tr>
<td>Image</td>
<td>UIImageView</td>
</tr>
<tr>
<td>NavigationView</td>
<td>UINavigationController 和 UISplitViewController</td>
</tr>
<tr>
<td>ToolbarItem</td>
<td>UINavigationItem</td>
</tr>
<tr>
<td>ScrollView</td>
<td>UIScrollView</td>
</tr>
<tr>
<td>List</td>
<td>UITableView</td>
</tr>
<tr>
<td>LazyVGrid 和 LazyHGrid</td>
<td>UICollectionView</td>
</tr>
<tr>
<td>HStack 和 LazyHStack</td>
<td>UIStack</td>
</tr>
<tr>
<td>VStack 和 LazyVStack</td>
<td>UIStack</td>
</tr>
<tr>
<td>TabView</td>
<td>UITabBarController 和 UIPageViewController</td>
</tr>
<tr>
<td>Toggle</td>
<td>UISwitch</td>
</tr>
<tr>
<td>Slider</td>
<td>UISlider</td>
</tr>
<tr>
<td>Stepper</td>
<td>UIStepper</td>
</tr>
<tr>
<td>ProgressView</td>
<td>UIProgressView 和 UIActivityIndicatorView</td>
</tr>
<tr>
<td>Picker</td>
<td>UISegmentedControl</td>
</tr>
<tr>
<td>DatePicker</td>
<td>UIDatePicker</td>
</tr>
<tr>
<td>Alert</td>
<td>UIAlertController</td>
</tr>
<tr>
<td>ActionSheet</td>
<td>UIAlertController</td>
</tr>
<tr>
<td>Map</td>
<td>MapKit</td>
</tr>
</tbody>
</table>
<h4 id="Text"><a href="#Text" class="headerlink" title="Text"></a>Text</h4><p><img src="https://user-images.githubusercontent.com/251980/143826034-977a6d5e-f9f5-4ec3-90d0-f09281d64af6.png" alt=""></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TextView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Group</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;大标题&quot;</span>).font(.largeTitle)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;说点啥呢？&quot;</span>)</span><br><span class="line">                .tracking(<span class="number">30</span>) <span class="comment">// 字间距</span></span><br><span class="line">                .kerning(<span class="number">30</span>) <span class="comment">// 尾部留白</span></span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;划重点&quot;</span>)</span><br><span class="line">                .underline()</span><br><span class="line">                .foregroundColor(.yellow)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;可旋转的文字&quot;</span>)</span><br><span class="line">                .rotationEffect(.degrees(<span class="number">45</span>))</span><br><span class="line">                .fixedSize()</span><br><span class="line">                .frame(width: <span class="number">20</span>, height: <span class="number">80</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Group</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;有阴影&quot;</span>)</span><br><span class="line">                .bold()</span><br><span class="line">                .italic()</span><br><span class="line">                .shadow(color: .primary, radius: <span class="number">1</span>, x: <span class="number">0</span>, y: <span class="number">2</span>)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Gradient Background&quot;</span>)</span><br><span class="line">                .font(.largeTitle)</span><br><span class="line">                .padding()</span><br><span class="line">                .foregroundColor(.white)</span><br><span class="line">                .background(<span class="type">LinearGradient</span>(gradient: <span class="type">Gradient</span>(colors: [.white, .black, .red]), startPoint: .top, endPoint: .bottom))</span><br><span class="line">                .cornerRadius(<span class="number">10</span>)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Gradient Background&quot;</span>)</span><br><span class="line">                .padding(<span class="number">5</span>)</span><br><span class="line">                .foregroundColor(.white)</span><br><span class="line">                .background(<span class="type">LinearGradient</span>(gradient: <span class="type">Gradient</span>(colors: [.white, .black, .purple]), startPoint: .leading, endPoint: .trailing))</span><br><span class="line">                .cornerRadius(<span class="number">10</span>)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Angular Gradient Background&quot;</span>)</span><br><span class="line">                .padding()</span><br><span class="line">                .background(<span class="type">AngularGradient</span>(colors: [.red, .yellow, .green, .blue, .purple, .red], center: .center))</span><br><span class="line">                .cornerRadius(<span class="number">20</span>)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;带背景图片的&quot;</span>)</span><br><span class="line">                .padding()</span><br><span class="line">                .font(.largeTitle)</span><br><span class="line">                .foregroundColor(.white)</span><br><span class="line">                .background &#123;</span><br><span class="line">                    <span class="type">Rectangle</span>()</span><br><span class="line">                        .fill(<span class="type">Color</span>(.black))</span><br><span class="line">                        .cornerRadius(<span class="number">10</span>)</span><br><span class="line">                    <span class="type">Image</span>(<span class="string">&quot;logo&quot;</span>)</span><br><span class="line">                        .resizable()</span><br><span class="line">                        .frame(width: <span class="number">100</span>, height: <span class="number">100</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                .frame(width: <span class="number">200</span>, height: <span class="number">100</span>)</span><br><span class="line">        &#125;</span><br><span class="line">            </span><br><span class="line">        <span class="type">Group</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;这是一段长文。总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么吧。&quot;</span>)</span><br><span class="line">                .lineLimit(<span class="number">3</span>) <span class="comment">// 对行的限制，如果多余设定行数，尾部会显示...</span></span><br><span class="line">                .lineSpacing(<span class="number">10</span>) <span class="comment">// 行间距</span></span><br><span class="line">                .multilineTextAlignment(.leading) <span class="comment">// 对齐</span></span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

    </article>
    <!-- license -->
    
        <div class="license-wrapper">
            <p>原文作者：<a href="http://ming1016.github.io">戴铭</a>
            <p>原文链接：<a href="http://ming1016.github.io/2021/11/23/daiming-swift-pamphlet/">http://ming1016.github.io/2021/11/23/daiming-swift-pamphlet/</a>
            <p>发表日期：<a href="http://ming1016.github.io/2021/11/23/daiming-swift-pamphlet/">November 23rd 2021, 4:28:18 pm</a>
            <p>更新日期：<a href="http://ming1016.github.io/2021/11/23/daiming-swift-pamphlet/">February 10th 2022, 7:03:11 pm</a>
            <p>版权声明：本文采用<a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc/4.0/">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p>
        </div>
    
    <!-- paginator -->
    <ul class="post-paginator">
        <li class="next">
            
                <div class="nextSlogan">Next Post</div>
                <a href="/2022/01/03/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/" title="如何用 SwiftUI + Combine + Swift Concurrency Aysnc/Await Actor 欢畅开发">
                    <div class="nextTitle">如何用 SwiftUI + Combine + Swift Concurrency Aysnc/Await Actor 欢畅开发</div>
                </a>
            
        </li>
        <li class="previous">
            
                <div class="prevSlogan">Previous Post</div>
                <a href="/2021/07/24/my-little-idea-about-writing-technical-article/" title="我写技术文章的一点心得">
                    <div class="prevTitle">我写技术文章的一点心得</div>
                </a>
            
        </li>
    </ul>
    <!-- comment -->
    
        <div class="post-comment">
            <!-- 来必力 City 版安装代码 -->


            

            

            

            <!-- utteranc评论 -->


            <!-- partial('_partial/comment/changyan') -->
            <!--PC版-->


            
            

        </div>
    
    <!-- timeliness note -->
    <!-- idea from: https://hexo.fluid-dev.com/posts/hexo-injector/#%E6%96%87%E7%AB%A0%E6%97%B6%E6%95%88%E6%80%A7%E6%8F%90%E7%A4%BA -->
    
    <!-- Mathjax -->
    
</main>

                <!-- profile -->
                
            </div>
            <footer class="footer footer-unloaded">
    <!-- social  -->
    
        <div class="social">
            
    
        
            
                <a href="mailto:ming1016@foxmail.com" class="iconfont-archer email" title=email ></a>
            
        
    
        
            
                <a href="//github.com/ming1016" class="iconfont-archer github" target="_blank" title=github></a>
            
        
    
        
            
                <span class="iconfont-archer wechat" title=wechat>
                    
                    <img class="profile-qr" src="/assets/wechat-qcode.jpeg" />
                </span>
            
        
    
        
    
        
    
        
            
                <a href="https://weibo.com/allstarming" class="iconfont-archer weibo" target="_blank" title=weibo></a>
            
        
    
        
    
        
    
        
    
        
            
                <a href="https://twitter.com/daiming_cn" class="iconfont-archer twitter" target="_blank" title=twitter></a>
            
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            
                <a href="/atom.xml" class="iconfont-archer rss" target="_blank" title=rss></a>
            
        
    


        </div>
    
    <!-- powered by Hexo  -->
    <div class="copyright">
        <span id="hexo-power">Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></span><span class="iconfont-archer power">&#xe635;</span><span id="theme-info">theme <a href="https://github.com/fi3ework/hexo-theme-archer" target="_blank">Archer</a></span>
    </div>
    <!-- website approve for Chinese user -->
    
        <div class="website-approve">
            
                <span id="icp-approve" class="icp-approve">
                    <a href="https://beian.miit.gov.cn/" target="_blank">鄂ICP备17011999号</a>
                </span>
            
            
                
                <img class="beian-img" src="/assets/beian.png" />
                <span id="beian-approve" class="beian-approve">
                    <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=7011999" target="_blank">京公网安备 7011999号</a>
                </span>
            
        </div>
    
    <!-- 不蒜子  -->
    
        <div class="busuanzi-container">
            
             
                <span id="busuanzi_container_site_pv">PV: <span id="busuanzi_value_site_pv"></span> :)</span>
            
        </div>
    	
</footer>

        </div>
        <!-- toc -->
        
            <div class="toc-wrapper toc-wrapper-loding" style=







    top:50vh;

>
                <div class="toc-catalog">
                    <span class="iconfont-archer catalog-icon">&#xe613;</span><span>CATALOG</span>
                </div>
                <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E8%AF%B4%E6%98%8E"><span class="toc-number">1.</span> <span class="toc-text">背景说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95%E9%80%9F%E6%9F%A5"><span class="toc-number">2.</span> <span class="toc-text">语法速查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80"><span class="toc-number">2.1.</span> <span class="toc-text">基础</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%98%E9%87%8F-let-var"><span class="toc-number">2.1.1.</span> <span class="toc-text">变量 let, var</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%93%E5%8D%B0-print-%E2%80%9C%E2%80%9D"><span class="toc-number">2.1.2.</span> <span class="toc-text">打印 print(“”)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E9%87%8A"><span class="toc-number">2.1.3.</span> <span class="toc-text">注释 &#x2F;&#x2F;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%AF%E9%80%89"><span class="toc-number">2.1.4.</span> <span class="toc-text">可选 ?, !</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AD%E5%8C%85"><span class="toc-number">2.1.5.</span> <span class="toc-text">闭包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0-func"><span class="toc-number">2.1.6.</span> <span class="toc-text">函数 func</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="toc-number">2.1.7.</span> <span class="toc-text">访问控制</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.2.</span> <span class="toc-text">基础类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E5%AD%97-Int-Float"><span class="toc-number">2.2.1.</span> <span class="toc-text">数字 Int, Float</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E6%95%B0-Bool"><span class="toc-number">2.2.2.</span> <span class="toc-text">布尔数 Bool</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%83%E7%BB%84-a-b-c"><span class="toc-number">2.2.3.</span> <span class="toc-text">元组 (a, b, c)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">2.2.4.</span> <span class="toc-text">字符串</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%9A%E4%B8%BE"><span class="toc-number">2.2.5.</span> <span class="toc-text">枚举</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%9B%E5%9E%8B"><span class="toc-number">2.2.6.</span> <span class="toc-text">泛型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8D%E9%80%8F%E6%98%8E%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.2.7.</span> <span class="toc-text">不透明类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Result"><span class="toc-number">2.2.8.</span> <span class="toc-text">Result</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="toc-number">2.2.9.</span> <span class="toc-text">类型转换</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%92%8C%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-number">2.3.</span> <span class="toc-text">类和结构体</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB"><span class="toc-number">2.3.1.</span> <span class="toc-text">类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-number">2.3.2.</span> <span class="toc-text">结构体</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7"><span class="toc-number">2.3.3.</span> <span class="toc-text">属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95"><span class="toc-number">2.3.4.</span> <span class="toc-text">方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF"><span class="toc-number">2.3.5.</span> <span class="toc-text">继承</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%BC%8F"><span class="toc-number">2.4.</span> <span class="toc-text">函数式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#map"><span class="toc-number">2.4.1.</span> <span class="toc-text">map</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#filter"><span class="toc-number">2.4.2.</span> <span class="toc-text">filter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#reduce"><span class="toc-number">2.4.3.</span> <span class="toc-text">reduce</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sorted"><span class="toc-number">2.4.4.</span> <span class="toc-text">sorted</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E6%B5%81"><span class="toc-number">2.5.</span> <span class="toc-text">控制流</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#If-%E2%80%A2-If-let-%E2%80%A2-If-case-let"><span class="toc-number">2.5.1.</span> <span class="toc-text">If • If let • If case let</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Guard-guard-guard-let"><span class="toc-number">2.5.2.</span> <span class="toc-text">Guard guard, guard let</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%81%8D%E5%8E%86-For-in"><span class="toc-number">2.5.3.</span> <span class="toc-text">遍历 For-in</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#While-while-repeat-while"><span class="toc-number">2.5.4.</span> <span class="toc-text">While while, repeat-while</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Switch"><span class="toc-number">2.5.5.</span> <span class="toc-text">Switch</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E5%90%88"><span class="toc-number">2.6.</span> <span class="toc-text">集合</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E7%BB%84-1-2-3"><span class="toc-number">2.6.1.</span> <span class="toc-text">数组 [1, 2, 3]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Sets-Set"><span class="toc-number">2.6.2.</span> <span class="toc-text">Sets Set</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E5%85%B8"><span class="toc-number">2.6.3.</span> <span class="toc-text">字典 [:]</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">2.7.</span> <span class="toc-text">操作符</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B5%8B%E5%80%BC"><span class="toc-number">2.7.1.</span> <span class="toc-text">赋值 &#x3D;, +&#x3D;. -&#x3D;, *&#x3D;, &#x2F;&#x3D;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E7%AC%A6"><span class="toc-number">2.7.2.</span> <span class="toc-text">计算符 +, -, *, &#x2F;, %</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97%E7%AC%A6-gt"><span class="toc-number">2.7.3.</span> <span class="toc-text">比较运算符 &#x3D;&#x3D;, &gt;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E5%85%83"><span class="toc-number">2.7.4.</span> <span class="toc-text">三元  ?  : _</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Nil-coalescing"><span class="toc-number">2.7.5.</span> <span class="toc-text">Nil-coalescing ??</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8C%83%E5%9B%B4-a%E2%80%A6b"><span class="toc-number">2.7.6.</span> <span class="toc-text">范围 a…b</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%BB%E8%BE%91-amp-amp"><span class="toc-number">2.7.7.</span> <span class="toc-text">逻辑 !, &amp;&amp;, ||</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%81%92%E7%AD%89"><span class="toc-number">2.7.8.</span> <span class="toc-text">恒等 &#x3D;&#x3D;&#x3D;, !&#x3D;&#x3D;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">2.7.9.</span> <span class="toc-text">运算符</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E5%BA%93"><span class="toc-number">2.8.</span> <span class="toc-text">基础库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%B6%E9%97%B4"><span class="toc-number">2.8.1.</span> <span class="toc-text">时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%BC%E5%BC%8F%E5%8C%96"><span class="toc-number">2.8.2.</span> <span class="toc-text">格式化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%A6%E9%87%8F%E5%80%BC"><span class="toc-number">2.8.3.</span> <span class="toc-text">度量值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Data"><span class="toc-number">2.8.4.</span> <span class="toc-text">Data</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6"><span class="toc-number">2.8.5.</span> <span class="toc-text">文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Scanner"><span class="toc-number">2.8.6.</span> <span class="toc-text">Scanner</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AttributeString"><span class="toc-number">2.8.7.</span> <span class="toc-text">AttributeString</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9A%8F%E6%9C%BA"><span class="toc-number">2.8.8.</span> <span class="toc-text">随机</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UserDefaults"><span class="toc-number">2.8.9.</span> <span class="toc-text">UserDefaults</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.9.</span> <span class="toc-text">模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E4%BE%8B"><span class="toc-number">2.9.1.</span> <span class="toc-text">单例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%8F%8A%E8%AE%BE%E5%A4%87"><span class="toc-number">2.10.</span> <span class="toc-text">系统及设备</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%88%A4%E6%96%AD"><span class="toc-number">2.10.1.</span> <span class="toc-text">系统判断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%88%E6%9C%AC%E5%85%BC%E5%AE%B9"><span class="toc-number">2.10.2.</span> <span class="toc-text">版本兼容</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#canImport-%E5%88%A4%E6%96%AD%E5%BA%93%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BD%BF%E7%94%A8"><span class="toc-number">2.10.3.</span> <span class="toc-text">canImport 判断库是否可使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#targetEnvironment-%E7%8E%AF%E5%A2%83%E7%9A%84%E5%88%A4%E6%96%AD"><span class="toc-number">2.10.4.</span> <span class="toc-text">targetEnvironment 环境的判断</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%B8%A6%E5%B1%9E%E6%80%A7%E5%8C%85%E8%A3%85"><span class="toc-number">2.11.</span> <span class="toc-text">自带属性包装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#resultBuilder"><span class="toc-number">2.11.1.</span> <span class="toc-text">@resultBuilder</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dynamicMemberLookup-%E5%8A%A8%E6%80%81%E6%88%90%E5%91%98%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.11.2.</span> <span class="toc-text">@dynamicMemberLookup 动态成员查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dynamicCallable-%E5%8A%A8%E6%80%81%E5%8F%AF%E8%B0%83%E7%94%A8%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.11.3.</span> <span class="toc-text">@dynamicCallable 动态可调用类型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%B8%A6%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.12.</span> <span class="toc-text">自带协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Hashable"><span class="toc-number">2.12.1.</span> <span class="toc-text">Hashable</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Codable"><span class="toc-number">2.13.</span> <span class="toc-text">Codable</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#JSON-%E6%B2%A1%E6%9C%89-id-%E5%AD%97%E6%AE%B5"><span class="toc-number">2.13.1.</span> <span class="toc-text">JSON 没有 id 字段</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C"><span class="toc-number">2.14.</span> <span class="toc-text">网络</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E7%8A%B6%E6%80%81%E6%A3%80%E6%9F%A5"><span class="toc-number">2.14.1.</span> <span class="toc-text">网络状态检查</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E7%94%BB"><span class="toc-number">2.15.</span> <span class="toc-text">动画</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%83%E5%B1%80%E5%8A%A8%E7%94%BB"><span class="toc-number">2.15.1.</span> <span class="toc-text">布局动画</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8"><span class="toc-number">2.16.</span> <span class="toc-text">安全</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Keychain"><span class="toc-number">2.16.1.</span> <span class="toc-text">Keychain</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E7%A8%8B"><span class="toc-number">2.17.</span> <span class="toc-text">工程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%85%A5%E5%8F%A3%E7%82%B9"><span class="toc-number">2.17.1.</span> <span class="toc-text">程序入口点</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%93%E9%A2%98"><span class="toc-number">3.</span> <span class="toc-text">专题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Swift-%E9%82%A3%E4%BA%9B%E4%BA%8B"><span class="toc-number">3.1.</span> <span class="toc-text">Swift 那些事</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Swift-%E5%90%84%E7%89%88%E6%9C%AC%E6%BC%94%E8%BF%9B"><span class="toc-number">3.1.1.</span> <span class="toc-text">Swift 各版本演进</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%84%E8%8C%83"><span class="toc-number">3.2.</span> <span class="toc-text">规范</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">3.2.1.</span> <span class="toc-text">注意事项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B5%84%E6%96%99%E6%8E%A8%E8%8D%90"><span class="toc-number">3.3.</span> <span class="toc-text">资料推荐</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B9%A6%E5%8D%95"><span class="toc-number">3.3.1.</span> <span class="toc-text">书单</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E6%96%B9%E5%BA%93%E4%BD%BF%E7%94%A8"><span class="toc-number">3.4.</span> <span class="toc-text">三方库使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SQLite-swift-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">3.4.1.</span> <span class="toc-text">SQLite.swift 的使用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#macOS"><span class="toc-number">3.5.</span> <span class="toc-text">macOS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8C%83%E4%BE%8B"><span class="toc-number">3.5.1.</span> <span class="toc-text">范例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E6%A0%8F%E7%BB%93%E6%9E%84"><span class="toc-number">3.5.2.</span> <span class="toc-text">三栏结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B1%E4%BA%AB%E8%8F%9C%E5%8D%95"><span class="toc-number">3.5.3.</span> <span class="toc-text">共享菜单</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%AA%E8%B4%B4%E6%9D%BF"><span class="toc-number">3.5.4.</span> <span class="toc-text">剪贴板</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Combine"><span class="toc-number">4.</span> <span class="toc-text">Combine</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">4.1.</span> <span class="toc-text">介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Combine-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">4.1.1.</span> <span class="toc-text">Combine 是什么？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Combine-%E8%B5%84%E6%96%99"><span class="toc-number">4.1.2.</span> <span class="toc-text">Combine 资料</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E"><span class="toc-number">4.2.</span> <span class="toc-text">使用说明</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#publisher"><span class="toc-number">4.2.1.</span> <span class="toc-text">publisher</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Just"><span class="toc-number">4.2.2.</span> <span class="toc-text">Just</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PassthroughSubject"><span class="toc-number">4.2.3.</span> <span class="toc-text">PassthroughSubject</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Empty"><span class="toc-number">4.2.4.</span> <span class="toc-text">Empty</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CurrentValueSubject"><span class="toc-number">4.2.5.</span> <span class="toc-text">CurrentValueSubject</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#removeDuplicates"><span class="toc-number">4.2.6.</span> <span class="toc-text">removeDuplicates</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#flatMap"><span class="toc-number">4.2.7.</span> <span class="toc-text">flatMap</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#append"><span class="toc-number">4.2.8.</span> <span class="toc-text">append</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#prepend"><span class="toc-number">4.2.9.</span> <span class="toc-text">prepend</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#merge"><span class="toc-number">4.2.10.</span> <span class="toc-text">merge</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#zip"><span class="toc-number">4.2.11.</span> <span class="toc-text">zip</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#combineLatest"><span class="toc-number">4.2.12.</span> <span class="toc-text">combineLatest</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Scheduler"><span class="toc-number">4.2.13.</span> <span class="toc-text">Scheduler</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">4.3.</span> <span class="toc-text">使用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82"><span class="toc-number">4.3.1.</span> <span class="toc-text">网络请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#KVO"><span class="toc-number">4.3.2.</span> <span class="toc-text">KVO</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E7%9F%A5"><span class="toc-number">4.3.3.</span> <span class="toc-text">通知</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Timer"><span class="toc-number">4.3.4.</span> <span class="toc-text">Timer</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Concurrency"><span class="toc-number">5.</span> <span class="toc-text">Concurrency</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-1"><span class="toc-number">5.1.</span> <span class="toc-text">介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Swift-Concurrency-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">5.1.1.</span> <span class="toc-text">Swift Concurrency 是什么？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#async-await"><span class="toc-number">5.1.2.</span> <span class="toc-text">async&#x2F;await</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Async-Sequences"><span class="toc-number">5.1.3.</span> <span class="toc-text">Async Sequences</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E5%8C%96%E5%B9%B6%E5%8F%91"><span class="toc-number">5.1.4.</span> <span class="toc-text">结构化并发</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Actors"><span class="toc-number">5.1.5.</span> <span class="toc-text">Actors</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%8F%90%E6%A1%88"><span class="toc-number">5.1.6.</span> <span class="toc-text">相关提案</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%A6%E4%B9%A0%E8%B7%AF%E5%BE%84"><span class="toc-number">5.1.7.</span> <span class="toc-text">学习路径</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Swift-Concurrency-%E5%92%8C-Combine"><span class="toc-number">5.1.8.</span> <span class="toc-text">Swift Concurrency 和 Combine</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SwiftUI"><span class="toc-number">6.</span> <span class="toc-text">SwiftUI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-2"><span class="toc-number">6.1.</span> <span class="toc-text">介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SwiftUI-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">6.1.1.</span> <span class="toc-text">SwiftUI 是什么？</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8"><span class="toc-number">6.2.</span> <span class="toc-text">视图组件使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SwiftUI-%E5%AF%B9%E6%A0%87%E7%9A%84-UIKit-%E8%A7%86%E5%9B%BE"><span class="toc-number">6.2.1.</span> <span class="toc-text">SwiftUI 对标的 UIKit 视图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Text"><span class="toc-number">6.2.2.</span> <span class="toc-text">Text</span></a></li></ol></li></ol></li></ol>
            </div>
        
        <!-- sidebar -->
        <div class="sidebar sidebar-hide">
    <ul class="sidebar-tabs sidebar-tabs-active-0">
        <li class="sidebar-tab-archives"><span class="iconfont-archer">&#xe67d;</span><span class="tab-name">Archive</span></li>
        <li class="sidebar-tab-tags"><span class="iconfont-archer">&#xe61b;</span><span class="tab-name">Tag</span></li>
        <li class="sidebar-tab-categories"><span class="iconfont-archer">&#xe666;</span><span class="tab-name">Cate</span></li>
    </ul>
    <div class="sidebar-content sidebar-content-show-archive">
        <div class="sidebar-panel-archives">
    <!-- 在 ejs 中将 archive 按照时间排序 -->
    
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    
    
    
    
    <div class="total-and-search">
        <div class="total-archive">
        Total : 53
        </div>
        <!-- search  -->
        
    </div>
    
    <div class="post-archive">
    
        
            
            
            <div class="archive-year"> 2022 </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">02/10</span>
            <a class="archive-post-title" href="/2022/02/10/swift-evolutionary-path/">Swift 演进之路</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">01/03</span>
            <a class="archive-post-title" href="/2022/01/03/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/">如何用 SwiftUI + Combine + Swift Concurrency Aysnc/Await Actor 欢畅开发</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> 2021 </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">11/23</span>
            <a class="archive-post-title" href="/2021/11/23/daiming-swift-pamphlet/">戴铭的 Swift 小册子 4.0</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">07/24</span>
            <a class="archive-post-title" href="/2021/07/24/my-little-idea-about-writing-technical-article/">我写技术文章的一点心得</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">07/13</span>
            <a class="archive-post-title" href="/2021/07/13/deeply-analyse-autolayout-slides/">深入剖析Auto Layout的幻灯片</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">06/08</span>
            <a class="archive-post-title" href="/2021/06/08/wwdc2021-day1-note/">WWDC 2021 Day1 笔记</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">05/22</span>
            <a class="archive-post-title" href="/2021/05/22/acfun-swift-practice/">A站 的 Swift 实践</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">02/21</span>
            <a class="archive-post-title" href="/2021/02/21/deeply-analyse-quickjs/">深入剖析 JavaScript 编译器/解释器引擎 QuickJS - 多了解些 JavaScript 语言</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> 2020 </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">12/18</span>
            <a class="archive-post-title" href="/2020/12/18/thinking-in-how-to-speed-up-app/">App 启动提速实践和一些想法</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">05/04</span>
            <a class="archive-post-title" href="/2020/05/04/draw-in-2020/">2020年涂图</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">04/12</span>
            <a class="archive-post-title" href="/2020/04/12/why_write_study_ios_programming_with_daiming_book_and_draw_recently/">我为什么写了《跟戴铭学iOS编程》这本书</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">03/29</span>
            <a class="archive-post-title" href="/2020/03/29/apple-system-executable-file-macho/">Apple 操作系统可执行文件 Mach-O</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">01/05</span>
            <a class="archive-post-title" href="/2020/01/05/kuaishou-unused-class-swiftui-note-binary-tree-interview/">在快手做分享、无用类检查、在广州做 SwiftUI 学习笔记分享、InfoQ二叉树视频</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> 2019 </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">12/28</span>
            <a class="archive-post-title" href="/2019/12/28/japan-travel/">日本游玩</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">12/07</span>
            <a class="archive-post-title" href="/2019/12/07/how-to-analyze-startup-time-cost-in-ios/">如何对 iOS 启动阶段耗时进行分析</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">12/06</span>
            <a class="archive-post-title" href="/2019/12/06/draw-in-2019/">2019年涂图</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">07/29</span>
            <a class="archive-post-title" href="/2019/07/29/ios-map/">iOS 开发舆图</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">06/19</span>
            <a class="archive-post-title" href="/2019/06/19/white-dragon-class/">白龙班</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> 2018 </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/17</span>
            <a class="archive-post-title" href="/2018/09/17/produce-slides-of-third-at-swift-conference/">这次swift大会分享准备的幻灯片和 demo</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/14</span>
            <a class="archive-post-title" href="/2018/09/14/draw-with-procreate-in-ipad-during-pre-half-in-20182/">18年上半年procreate的练习图图</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">04/21</span>
            <a class="archive-post-title" href="/2018/04/21/deeply-analyse-javascriptcore/">深入剖析 JavaScriptCore</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">04/07</span>
            <a class="archive-post-title" href="/2018/04/07/read-snapkit-and-masonry-source-code/">读 SnapKit 和 Masonry 自动布局框架源码</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">04/02</span>
            <a class="archive-post-title" href="/2018/04/02/record-and-think-about-swift-project-jsondecoder-networking-and-pop/">Swift 项目中涉及到 JSONDecoder，网络请求，泛型协议式编程的一些记录和想法</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">01/24</span>
            <a class="archive-post-title" href="/2018/01/24/why-swift/">Why Swift? Generics(泛型), Collection(集合类型), POP(协议式编程), Memory Management(内存管理)</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">01/10</span>
            <a class="archive-post-title" href="/2018/01/10/slides-of-giac-how-to-use-swift-transfer-web-to-60-frame-native-code/">GIAC 大会上分享的《Swift 将 Web 代码转成60帧满帧原生应用的方案及实践》的幻灯片</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">01/04</span>
            <a class="archive-post-title" href="/2018/01/04/baimi/">白芈</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">01/04</span>
            <a class="archive-post-title" href="/2018/01/04/huaye/">花野</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> 2017 </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">10/24</span>
            <a class="archive-post-title" href="/2017/10/24/how-do-i-improve-the-development/">在滴滴，我是如何指数级提升开发技术的？</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">10/16</span>
            <a class="archive-post-title" href="/2017/10/16/html-to-native-htn-development-record/">HTML 转原生 HTN 项目开发记录</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">10/11</span>
            <a class="archive-post-title" href="/2017/10/11/deeply-analyse-webkit/">深入剖析 WebKit</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">06/20</span>
            <a class="archive-post-title" href="/2017/06/20/deeply-ios-performance-optimization/">深入剖析 iOS 性能优化</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">06/12</span>
            <a class="archive-post-title" href="/2017/06/12/gmtc-ios-slimming-practice/">GMTC 上分享滴滴出行 iOS 端瘦身实践的 Slides</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">05/27</span>
            <a class="archive-post-title" href="/2017/05/27/slides-of-learn-what-interesting-things-you-can-do-with-iOS-compilation/">atSwift大会上分享《学习iOS编译原理能做哪些有意思的事情》的 Slides</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">04/01</span>
            <a class="archive-post-title" href="/2017/04/01/build-static-analysis-program-smck-use-swift/">用 Swift 编写的工程代码静态分析命令行工具 smck</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">04/01</span>
            <a class="archive-post-title" href="/2017/04/01/slides-of-deeply-analyse-llvm/">深入剖析 iOS 编译 Clang / LLVM 直播的 Slides</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">03/01</span>
            <a class="archive-post-title" href="/2017/03/01/deeply-analyse-llvm/">深入剖析 iOS 编译 Clang / LLVM</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> 2016 </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">11/22</span>
            <a class="archive-post-title" href="/2016/11/22/how-to-preload-web-in-ios/">iOS预加载Web页面方案</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">11/17</span>
            <a class="archive-post-title" href="/2016/11/17/use-swift3-build-macos-program-to-clear-unuse-method/">使用Swift3开发了个macOS的程序可以检测出objc项目中无用方法，然后一键全部清理</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/20</span>
            <a class="archive-post-title" href="/2016/09/20/draw-with-procreate-in-ipad-during-15-to-16/">15，16年iPad上使用Procreate画的</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/02</span>
            <a class="archive-post-title" href="/2016/09/02/develop-rss-reader/">使用ReactiveCocoa开发RSS阅读器</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">08/09</span>
            <a class="archive-post-title" href="/2016/08/09/how-to-use-reactivecocoa/">iOS函数响应式编程以及ReactiveCocoa的使用</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">07/21</span>
            <a class="archive-post-title" href="/2016/07/21/assembleview/">制作一个类似苹果VFL(Visual Format Language)的格式化语言来描述类似UIStackView那种布局思路，并解析生成页面</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">05/30</span>
            <a class="archive-post-title" href="/2016/05/30/what-learn-from-reactivecocoa/">从 ReactiveCocoa 中能学到什么？不用此库也能学以致用</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">05/23</span>
            <a class="archive-post-title" href="/2016/05/23/try-to-decouple-with-demo/">竭尽全力的去解耦的一次实践，封装一个TableView和一些功能组合的控件</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">04/04</span>
            <a class="archive-post-title" href="/2016/04/04/tenth-middle-school/">十中</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">01/13</span>
            <a class="archive-post-title" href="/2016/01/13/how-to-use-gcd/">细说 GCD（Grand Central Dispatch）如何用</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> 2015 </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">11/03</span>
            <a class="archive-post-title" href="/2015/11/03/deeply-analyse-autolayout/">深入剖析Auto Layout，分析iOS各版本新增特性</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">11/02</span>
            <a class="archive-post-title" href="/2015/11/02/draw-with-note-in-ipad-during-15/">15年用iPad上的备忘录画的</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">05/28</span>
            <a class="archive-post-title" href="/2015/05/28/macos-app-i-used/">我用过的 macOS 应用</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">04/02</span>
            <a class="archive-post-title" href="/2015/04/02/draw-game-of-thrones-with-pencil-during-14/">整理了画的权利的游戏里的角色，有龙女，小恶魔等等</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">04/01</span>
            <a class="archive-post-title" href="/2015/04/01/objc-runtime/">Objc Runtime 总结</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">03/12</span>
            <a class="archive-post-title" href="/2015/03/12/draw-practice-with-pencil-during-14-to-15/">14和15年间的铅笔画练习</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> 2014 </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">03/01</span>
            <a class="archive-post-title" href="/2014/03/01/black-star-blue-map/">黑星蓝图</a>
        </li>
    
    </div>
</div>

        <div class="sidebar-panel-tags">
    <div class="sidebar-tags-name">
        
            <span class="sidebar-tag-name" data-tags="AssembleView">
                <span class="iconfont-archer">&#xe606;</span>
                AssembleView
            </span>
        
            <span class="sidebar-tag-name" data-tags="iOS">
                <span class="iconfont-archer">&#xe606;</span>
                iOS
            </span>
        
            <span class="sidebar-tag-name" data-tags="Novel">
                <span class="iconfont-archer">&#xe606;</span>
                Novel
            </span>
        
            <span class="sidebar-tag-name" data-tags="smck">
                <span class="iconfont-archer">&#xe606;</span>
                smck
            </span>
        
            <span class="sidebar-tag-name" data-tags="Swift">
                <span class="iconfont-archer">&#xe606;</span>
                Swift
            </span>
        
            <span class="sidebar-tag-name" data-tags="RSSReader">
                <span class="iconfont-archer">&#xe606;</span>
                RSSReader
            </span>
        
            <span class="sidebar-tag-name" data-tags="Painting">
                <span class="iconfont-archer">&#xe606;</span>
                Painting
            </span>
        
            <span class="sidebar-tag-name" data-tags="iPad">
                <span class="iconfont-archer">&#xe606;</span>
                iPad
            </span>
        
            <span class="sidebar-tag-name" data-tags="Procreate">
                <span class="iconfont-archer">&#xe606;</span>
                Procreate
            </span>
        
            <span class="sidebar-tag-name" data-tags="Pencil">
                <span class="iconfont-archer">&#xe606;</span>
                Pencil
            </span>
        
            <span class="sidebar-tag-name" data-tags="GOT">
                <span class="iconfont-archer">&#xe606;</span>
                GOT
            </span>
        
            <span class="sidebar-tag-name" data-tags="Slides">
                <span class="iconfont-archer">&#xe606;</span>
                Slides
            </span>
        
            <span class="sidebar-tag-name" data-tags="Study">
                <span class="iconfont-archer">&#xe606;</span>
                Study
            </span>
        
            <span class="sidebar-tag-name" data-tags="UIWebView">
                <span class="iconfont-archer">&#xe606;</span>
                UIWebView
            </span>
        
            <span class="sidebar-tag-name" data-tags="NSURLProtocol">
                <span class="iconfont-archer">&#xe606;</span>
                NSURLProtocol
            </span>
        
            <span class="sidebar-tag-name" data-tags="Web">
                <span class="iconfont-archer">&#xe606;</span>
                Web
            </span>
        
            <span class="sidebar-tag-name" data-tags="Japan">
                <span class="iconfont-archer">&#xe606;</span>
                Japan
            </span>
        
            <span class="sidebar-tag-name" data-tags="macOS">
                <span class="iconfont-archer">&#xe606;</span>
                macOS
            </span>
        
            <span class="sidebar-tag-name" data-tags="APP">
                <span class="iconfont-archer">&#xe606;</span>
                APP
            </span>
        
            <span class="sidebar-tag-name" data-tags="swift">
                <span class="iconfont-archer">&#xe606;</span>
                swift
            </span>
        
            <span class="sidebar-tag-name" data-tags="编译">
                <span class="iconfont-archer">&#xe606;</span>
                编译
            </span>
        
            <span class="sidebar-tag-name" data-tags="LLVM">
                <span class="iconfont-archer">&#xe606;</span>
                LLVM
            </span>
        
            <span class="sidebar-tag-name" data-tags="Pattern">
                <span class="iconfont-archer">&#xe606;</span>
                Pattern
            </span>
        
            <span class="sidebar-tag-name" data-tags="ReactiveCocoa">
                <span class="iconfont-archer">&#xe606;</span>
                ReactiveCocoa
            </span>
        
            <span class="sidebar-tag-name" data-tags="book">
                <span class="iconfont-archer">&#xe606;</span>
                book
            </span>
        
            <span class="sidebar-tag-name" data-tags="Autolayout">
                <span class="iconfont-archer">&#xe606;</span>
                Autolayout
            </span>
        
            <span class="sidebar-tag-name" data-tags="SwiftUI">
                <span class="iconfont-archer">&#xe606;</span>
                SwiftUI
            </span>
        
            <span class="sidebar-tag-name" data-tags="Apple">
                <span class="iconfont-archer">&#xe606;</span>
                Apple
            </span>
        
            <span class="sidebar-tag-name" data-tags="Mach-O">
                <span class="iconfont-archer">&#xe606;</span>
                Mach-O
            </span>
        
            <span class="sidebar-tag-name" data-tags="JavaScript">
                <span class="iconfont-archer">&#xe606;</span>
                JavaScript
            </span>
        
            <span class="sidebar-tag-name" data-tags="Performance optimization">
                <span class="iconfont-archer">&#xe606;</span>
                Performance optimization
            </span>
        
            <span class="sidebar-tag-name" data-tags="GCD">
                <span class="iconfont-archer">&#xe606;</span>
                GCD
            </span>
        
            <span class="sidebar-tag-name" data-tags="runtime">
                <span class="iconfont-archer">&#xe606;</span>
                runtime
            </span>
        
            <span class="sidebar-tag-name" data-tags="Clang">
                <span class="iconfont-archer">&#xe606;</span>
                Clang
            </span>
        
            <span class="sidebar-tag-name" data-tags="WebKit">
                <span class="iconfont-archer">&#xe606;</span>
                WebKit
            </span>
        
    </div>
    <div class="iconfont-archer sidebar-tags-empty">&#xe678;</div>
    <div class="tag-load-fail" style="display: none; color: #ccc; font-size: 0.6rem;">
        缺失模块，请参考主题文档进行安装配置：https://github.com/fi3ework/hexo-theme-archer#%E5%AE%89%E8%A3%85%E4%B8%BB%E9%A2%98
    </div> 
    <div class="sidebar-tags-list"></div>
</div>

        <div class="sidebar-panel-categories">
    <div class="sidebar-categories-name">
    
        <span class="sidebar-category-name" data-categories="Programming">
            <span class="iconfont-archer">&#xe60a;</span>
            Programming
        </span>
    
        <span class="sidebar-category-name" data-categories="My-novel">
            <span class="iconfont-archer">&#xe60a;</span>
            My-novel
        </span>
    
        <span class="sidebar-category-name" data-categories="My-painting">
            <span class="iconfont-archer">&#xe60a;</span>
            My-painting
        </span>
    
        <span class="sidebar-category-name" data-categories="travel">
            <span class="iconfont-archer">&#xe60a;</span>
            travel
        </span>
    
        <span class="sidebar-category-name" data-categories="APP">
            <span class="iconfont-archer">&#xe60a;</span>
            APP
        </span>
    
    </div>
    <div class="iconfont-archer sidebar-categories-empty">&#xe678;</div>
    <div class="sidebar-categories-list"></div>
</div>

    </div>
</div>

        <!-- site-meta -->
        <script>
    var siteMeta = {
        url: "http://ming1016.github.io",
        root: "/",
        author: "戴铭"
    }
</script>

        <!-- import experimental options here -->
        <!-- Custom Font -->


        <!-- main func -->
        <script src="/scripts/main.js?v=20210823"></script>
        <!-- dark mode -->
        <script src="/scripts/dark.js?v=20210823"></script>
        <!-- fancybox -->
        <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" defer></script>
        <!-- algolia -->
        
        <!-- busuanzi -->
        
            <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>
        
        <!-- CNZZ -->
        
        <!-- async load share.js -->
        
            <script src="/scripts/share.js?v=20210823" async></script>
        
        <!-- mermaid -->
        
    </body>
</html>
