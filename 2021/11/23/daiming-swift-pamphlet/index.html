<!DOCTYPE html>
<html lang="zh-Hans">
    <!-- title -->


    

<!-- keywords -->



<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="author" content="戴铭">
    <meta name="renderer" content="webkit">
    <meta name="copyright" content="戴铭">
    
        <meta name="keywords" content="戴铭,戴铭的博客,iOS,Swift,移动开发,JavaScript,编译">
    
    <meta name="description" content="前滴滴出行技术专家。极客时间《iOS开发高手课》和纸书《跟戴铭学iOS编程》作者。个人博客：戴铭的博客。微信公共号：starming-weixin。微博：@戴铭">
    <meta name="description" content="update：内容已更新到 4.0 版本。  新dyld源码透出近期苹果出新系统必然，依苹果 taste，势必要用好技术抛落后技术。漫漫长假我完善了Swift手册内容，字数达到十五万字，内容已压缩压缩再压缩，求全存简，more big, so small 。满满诚意，望有用、值得收藏、求转发。 come on and learn (੭*ˊᵕˋ)੭ – 戴·代码之使徒·画终结者·被光选中的人·铭">
<meta property="og:type" content="article">
<meta property="og:title" content="戴铭的 Swift 小册子 4.0">
<meta property="og:url" content="http://ming1016.github.io/2021/11/23/daiming-swift-pamphlet/index.html">
<meta property="og:site_name" content="戴铭的博客 - 星光社">
<meta property="og:description" content="update：内容已更新到 4.0 版本。  新dyld源码透出近期苹果出新系统必然，依苹果 taste，势必要用好技术抛落后技术。漫漫长假我完善了Swift手册内容，字数达到十五万字，内容已压缩压缩再压缩，求全存简，more big, so small 。满满诚意，望有用、值得收藏、求转发。 come on and learn (੭*ˊᵕˋ)੭ – 戴·代码之使徒·画终结者·被光选中的人·铭">
<meta property="og:locale">
<meta property="og:image" content="https://user-images.githubusercontent.com/251980/152918704-9522eb27-9304-4788-b4ed-72ffb170e1bc.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/251980/150132322-20c5c2d4-6452-4d06-9202-4b93cffd8133.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/251980/142977421-bed5b5ae-01fe-471f-a951-63dd4338c97a.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/251980/142988837-ab49c202-9779-4c7a-8dc2-5584900c0765.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/251980/142988879-af591aaf-161f-4f60-9891-d7b8d313f69f.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/251980/142988909-e6626954-2c93-4c34-b10e-5345c8015cea.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/251980/154473546-94ba6f9f-2ce3-44ef-a7c6-60d86df8c90f.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/251980/154474725-d696d50b-9da7-4a0d-808f-07894a9597cb.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/251980/154667163-e906dfd4-074e-4c04-9c80-94af86df4ba6.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/251980/154916174-2e9b1bd8-992a-485e-803a-07da59d0c7e3.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/251980/155062538-108a79b4-3e5c-417b-867a-3f7e58316664.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/251980/155676571-726c15d1-e4a2-4493-8fb0-c37c1c61c88c.jpeg">
<meta property="og:image" content="https://user-images.githubusercontent.com/251980/155683776-0f0acdee-c7c1-44e3-a68b-38f778863821.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/251980/155317172-dc137c38-64d0-415a-8412-e3f479f2bd91.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/251980/155077158-f6efd3bb-4b82-48ac-b5e6-792dd833dfda.jpeg">
<meta property="og:image" content="https://user-images.githubusercontent.com/251980/155517358-4e5d54b8-0284-4fde-bf09-4b5e22e0e9a5.jpeg">
<meta property="og:image" content="https://user-images.githubusercontent.com/251980/155293565-d85080c1-2304-491b-be72-20aa921f7067.jpeg">
<meta property="og:image" content="https://user-images.githubusercontent.com/251980/155708552-35396dcd-f120-4498-a793-a65abd68c0a6.jpeg">
<meta property="og:image" content="https://user-images.githubusercontent.com/251980/156135869-7451bbc9-95b9-445f-8721-66f0aedbed70.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/251980/156289124-bde3c73e-2a81-4043-8682-ae55a820f1aa.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/251980/156298284-2fb37b3e-55f0-4918-ba8e-74f747bf3171.jpeg">
<meta property="og:image" content="https://user-images.githubusercontent.com/251980/156332122-66813e4e-851c-4207-8cb9-b41ea0365008.jpeg">
<meta property="article:published_time" content="2021-11-23T08:28:18.000Z">
<meta property="article:modified_time" content="2022-03-24T08:46:40.086Z">
<meta property="article:author" content="戴铭">
<meta property="article:tag" content="iOS">
<meta property="article:tag" content="Apple">
<meta property="article:tag" content="Swift">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://user-images.githubusercontent.com/251980/152918704-9522eb27-9304-4788-b4ed-72ffb170e1bc.png">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="icon" href="/assets/logo-starming.png">
    
    <title>戴铭的 Swift 小册子 4.0 · 戴铭的博客 - 星光社</title>
    <!-- /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
/* This file is meant as a standalone workflow for
- testing support for link[rel=preload]
- enabling async CSS loading in browsers that do not support rel=preload
- applying rel preload css once loaded, whether supported or not.
*/ -->
<script>
    (function (w) {
        'use strict'
        // rel=preload support test
        if (!w.loadCSS) {
            w.loadCSS = function () {}
        }
        // define on the loadCSS obj
        var rp = (loadCSS.relpreload = {})
        // rel=preload feature support test
        // runs once and returns a function for compat purposes
        rp.support = (function () {
            var ret
            try {
                ret = w.document.createElement('link').relList.supports('preload')
            } catch (e) {
                ret = false
            }
            return function () {
                return ret
            }
        })()

        // if preload isn't supported, get an asynchronous load by using a non-matching media attribute
        // then change that media back to its intended value on load
        rp.bindMediaToggle = function (link) {
            // remember existing media attr for ultimate state, or default to 'all'
            var finalMedia = link.media || 'all'

            function enableStylesheet() {
                link.media = finalMedia
            }

            // bind load handlers to enable media
            if (link.addEventListener) {
                link.addEventListener('load', enableStylesheet)
            } else if (link.attachEvent) {
                link.attachEvent('onload', enableStylesheet)
            }

            // Set rel and non-applicable media type to start an async request
            // note: timeout allows this to happen async to let rendering continue in IE
            setTimeout(function () {
                link.rel = 'stylesheet'
                link.media = 'only x'
            })
            // also enable media after 3 seconds,
            // which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
            setTimeout(enableStylesheet, 3000)
        }

        // loop through link elements in DOM
        rp.poly = function () {
            // double check this to prevent external calls from running
            if (rp.support()) {
                return
            }
            var links = w.document.getElementsByTagName('link')
            for (var i = 0; i < links.length; i++) {
                var link = links[i]
                // qualify links to those with rel=preload and as=style attrs
                if (
                    link.rel === 'preload' &&
                    link.getAttribute('as') === 'style' &&
                    !link.getAttribute('data-loadcss')
                ) {
                    // prevent rerunning on link
                    link.setAttribute('data-loadcss', true)
                    // bind listeners to toggle media back
                    rp.bindMediaToggle(link)
                }
            }
        }

        // if unsupported, run the polyfill
        if (!rp.support()) {
            // run once at least
            rp.poly()

            // rerun poly on an interval until onload
            var run = w.setInterval(rp.poly, 500)
            if (w.addEventListener) {
                w.addEventListener('load', function () {
                    rp.poly()
                    w.clearInterval(run)
                })
            } else if (w.attachEvent) {
                w.attachEvent('onload', function () {
                    rp.poly()
                    w.clearInterval(run)
                })
            }
        }

        // commonjs
        if (typeof exports !== 'undefined') {
            exports.loadCSS = loadCSS
        } else {
            w.loadCSS = loadCSS
        }
    })(typeof global !== 'undefined' ? global : this)
</script>

    <style type="text/css">
    @font-face {
        font-family: 'Oswald-Regular';
        src: url("/font/Oswald-Regular.ttf");
    }

    body {
        margin: 0;
    }

    header,
    footer,
    .back-top,
    .sidebar,
    .container,
    .site-intro-meta,
    .toc-wrapper {
        display: none;
    }

    .site-intro {
        position: relative;
        z-index: 3;
        width: 100%;
        /* height: 50vh; */
        overflow: hidden;
    }

    .site-intro-placeholder {
        position: absolute;
        z-index: -2;
        top: 0;
        left: 0;
        width: calc(100% + 300px);
        height: 100%;
        background: repeating-linear-gradient(-45deg, #444 0, #444 80px, #333 80px, #333 160px);
        background-position: center center;
        transform: translate3d(-226px, 0, 0);
        animation: gradient-move 2.5s ease-out 0s infinite;
    }

    @keyframes gradient-move {
        0% {
            transform: translate3d(-226px, 0, 0);
        }
        100% {
            transform: translate3d(0, 0, 0);
        }
    }
</style>

    <link rel="preload" href="/css/style.css?v=20210823" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="/css/dark.css?v=20210823" as="style">
    <link rel="stylesheet" href="/css/dark.css" media="(prefers-color-scheme: dark)">
    <link rel="stylesheet" href="/css/mobile.css?v=20210823" media="(max-width: 960px)">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" as="script">
    <link rel="preload" href="/scripts/main.js?v=20210823" as="script">
    <link rel="preload" href="/scripts/dark.js?v=20210823" as="script">
    <link rel="preload" href="/font/Oswald-Regular.ttf" as="font" crossorigin>
    <link rel="preload" href="https://at.alicdn.com/t/font_327081_1dta1rlogw17zaor.woff" as="font" crossorigin>
    <!-- algolia -->
    
    <!-- 百度统计  -->
    
    <!-- 谷歌统计  -->
    
<meta name="generator" content="Hexo 5.4.0"></head>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script type="text/javascript">
        if (typeof window.$ == undefined) {
            console.warn('jquery load from jsdelivr failed, will load local script')
            document.write('<script src="/lib/jquery.min.js" />')
        }
    </script>
    
        <body class="post-body">
    
        <!-- header -->
        <header class="header header-mobile">
    <!-- top read progress line -->
    <div class="header-element">
        <div class="read-progress"></div>
    </div>
    <!-- sidebar menu button -->
    <div class="header-element">
        
            <div class="header-sidebar-menu">
        
            
                <div style="padding-left: 1px;">&#xe775;</div>
            
        </div>
    </div>
    <!-- header actions -->
    <div class="header-actions">
        <!-- theme mode switch button -->
        <span class="header-theme-btn header-element">
            <i class="fas fa-adjust"></i>
        </span>
        <!-- back to home page text -->
        <span class="home-link header-element">
            <a href=/>戴铭的博客 - 星光社</a>
        </span>
    </div>
    <!-- toggle banner for post layout -->
    
        
            <div class="banner">
        
            <div class="blog-title header-element">
                <a href="/">戴铭的博客 - 星光社</a>
            </div>
            <div class="post-title header-element">
                <a href="#" class="post-name">戴铭的 Swift 小册子 4.0</a>
            </div>
        </div>
    
</header>

        <!-- fixed footer -->
        <footer class="footer-fixed">
    <!-- back to top button -->
    <div class="footer-fixed-element">
        
            <div class="back-top back-top-hidden">
        
        
            <div>&#xe639;</div>
        
        </div>
    </div>
</footer>

        <!-- wrapper -->
        <div class="wrapper">
            <div class="site-intro" style="







    height:50vh;

">
    
    <!-- 主页  -->
    
        
    <!-- 404页  -->
            
    <div class="site-intro-placeholder"></div>
    <div class="site-intro-img" style="background-image: url(/intro/post-bg-starming.jpg)"></div>
    <div class="site-intro-meta">
        <!-- 标题  -->
        <h1 class="intro-title">
            <!-- 主页  -->
            
                戴铭的 Swift 小册子 4.0
            <!-- 404 -->
            
        </h1>
        <!-- 副标题 -->
        <p class="intro-subtitle">
            <!-- 主页副标题  -->
            
                
            <!-- 404 -->
            
        </p>
        <!-- 文章页 meta -->
        
            <div class="post-intros">
                <!-- 文章页标签  -->
                
                    <div class= post-intro-tags >
    
        
        
            
        
        
        <span class="post-category" data-categories="Programming"">
            <i class="fas fa-folder post-category-icon"></i>
            <span class="post-category-text">
                Programming
            </span>
        </span>
    
    
        <a class="post-tag" href="javascript:void(0);" data-tags="iOS">iOS</a>
    
        <a class="post-tag" href="javascript:void(0);" data-tags="Apple">Apple</a>
    
        <a class="post-tag" href="javascript:void(0);" data-tags="Swift">Swift</a>
    
</div>

                
                
                    <div class="post-intro-read">
                        <span>字数统计: <span class="post-count word-count">40.6k</span>阅读时长: <span class="post-count reading-time">204 min</span></span>
                    </div>
                
                <div class="post-intro-meta">
                    <!-- 撰写日期 -->
                    <span class="iconfont-archer post-intro-calander">&#xe676;</span>
                    <span class="post-intro-time">2021/11/23</span>
                    <!-- busuanzi -->
                    
                        <span id="busuanzi_container_page_pv" class="busuanzi-pv">
                            <span class="iconfont-archer post-intro-busuanzi">&#xe602;</span>
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    
                    <!-- 文章分享 -->
                    <span class="share-wrapper">
                        <span class="iconfont-archer share-icon">&#xe71d;</span>
                        <span class="share-text">Share</span>
                        <ul class="share-list">
                            <li class="iconfont-archer share-qr" data-type="qr">&#xe75b;
                                <div class="share-qrcode"></div>
                            </li>
                            <li class="iconfont-archer" data-type="weibo">&#xe619;</li>
                            <li class="iconfont-archer" data-type="qzone">&#xe62e;</li>
                            <li class="iconfont-archer" data-type="twitter">&#xe634;</li>
                            <li class="iconfont-archer" data-type="facebook">&#xe67a;</li>
                        </ul>
                    </span>
                </div>
            </div>
        
    </div>
</div>

            <script>
  // get user agent
  function getBrowserVersions() {
    var u = window.navigator.userAgent
    return {
      userAgent: u,
      trident: u.indexOf('Trident') > -1, //IE内核
      presto: u.indexOf('Presto') > -1, //opera内核
      webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
      gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
      mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
      ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
      android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
      iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //是否为iPhone或者安卓QQ浏览器
      iPad: u.indexOf('iPad') > -1, //是否为iPad
      webApp: u.indexOf('Safari') == -1, //是否为web应用程序，没有头部与底部
      weixin: u.indexOf('MicroMessenger') == -1, //是否为微信浏览器
      uc: u.indexOf('UCBrowser') > -1, //是否为android下的UC浏览器
    }
  }
  var browser = {
    versions: getBrowserVersions(),
  }
  console.log('userAgent: ' + browser.versions.userAgent)

  // callback
  function fontLoaded() {
    console.log('font loaded')
    if (document.getElementsByClassName('site-intro-meta')) {
      document
        .getElementsByClassName('intro-title')[0]
        .classList.add('intro-fade-in')
      document
        .getElementsByClassName('intro-subtitle')[0]
        .classList.add('intro-fade-in')
      var postIntros = document.getElementsByClassName('post-intros')[0]
      if (postIntros) {
        postIntros.classList.add('post-fade-in')
      }
    }
  }

  // UC不支持跨域，所以直接显示
  function asyncCb() {
    if (browser.versions.uc) {
      console.log('UCBrowser')
      fontLoaded()
    } else {
      WebFont.load({
        custom: {
          families: ['Oswald-Regular'],
        },
        loading: function () {
          // 所有字体开始加载
          // console.log('font loading');
        },
        active: function () {
          // 所有字体已渲染
          fontLoaded()
        },
        inactive: function () {
          // 字体预加载失败，无效字体或浏览器不支持加载
          console.log('inactive: timeout')
          fontLoaded()
        },
        timeout: 5000, // Set the timeout to two seconds
      })
    }
  }

  function asyncErr() {
    console.warn('script load from CDN failed, will load local script')
  }

  // load webfont-loader async, and add callback function
  function async(u, cb, err) {
    var d = document,
      t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0]
    o.src = u
    if (cb) {
      o.addEventListener(
        'load',
        function (e) {
          cb(null, e)
        },
        false
      )
    }
    if (err) {
      o.addEventListener(
        'error',
        function (e) {
          err(null, e)
        },
        false
      )
    }
    s.parentNode.insertBefore(o, s)
  }

  var asyncLoadWithFallBack = function (arr, success, reject) {
    var currReject = function () {
      reject()
      arr.shift()
      if (arr.length) async(arr[0], success, currReject)
    }

    async(arr[0], success, currReject)
  }

  asyncLoadWithFallBack(
    [
      'https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js',
      'https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js',
      "/lib/webfontloader.min.js",
    ],
    asyncCb,
    asyncErr
  )
</script>

            <img class="loading" src="/assets/loading.svg" style="display: block; margin: 6rem auto 0 auto; width: 6rem; height: 6rem;" />
            <div class="container container-unloaded">
                <main class="main post-page">
    <article class="article-entry">
        <p>update：内容已更新到 4.0 版本。</p>
<blockquote>
<p>新dyld源码透出近期苹果出新系统必然，依苹果 taste，势必要用好技术抛落后技术。漫漫长假我完善了Swift手册内容，字数达到十五万字，内容已压缩压缩再压缩，求全存简，more big, so small 。满满诚意，望有用、值得收藏、求转发。</p>
<p>come on and learn (੭*ˊᵕˋ)੭</p>
<p>– 戴·代码之使徒·画终结者·被光选中的人·铭</p>
</blockquote>
<h2 id="背景说明"><a href="#背景说明" class="headerlink" title="背景说明"></a>背景说明</h2><p>越来越多同学打算开始用 Swift 来开发了，可很多人以前都没接触过 Swift。这篇和我以前文章不同的是，本篇只是面向 Swift 零基础的同学，内容主要是一些直接可用的小例子，例子可以直接在工程中用或自己调试着看。</p>
<p>记得以前 PHP 有个 chm 的手册，写的很简单，但很全，每个知识点都有例子，社区版每个知识点下面还有留言互动。因此，我弄了个 Swift 的手册，是个 macOS 程序。建议使用我开发的这个 macOS 程序来浏览。源码地址：<a target="_blank" rel="noopener" href="https://github.com/KwaiAppTeam/SwiftPamphletApp">KwaiAppTeam/SwiftPamphletApp</a>，直接下载 dmg 地址：<a target="_blank" rel="noopener" href="https://github.com/KwaiAppTeam/SwiftPamphletApp/files/8150518/4.4.dmg.zip">戴铭的开发小册子4.4.dmg.zip</a></p>
<p><img src="https://user-images.githubusercontent.com/251980/152918704-9522eb27-9304-4788-b4ed-72ffb170e1bc.png" alt=""></p>
<p>这个程序是Swift写的，按照声明式UI，响应式编程范式开发的，源码也可以看看。与其讲一堆，不如调着试。</p>
<p>下面是文本内容。注：代码中简化变量名是为了能更快速关注到语言用法。</p>
<h2 id="语法速查"><a href="#语法速查" class="headerlink" title="语法速查"></a>语法速查</h2><h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><h4 id="变量-let-var"><a href="#变量-let-var" class="headerlink" title="变量 let, var"></a>变量 let, var</h4><p>变量是可变的，使用 var 修饰，常量是不可变的，使用 let 修饰。类、结构体和枚举里的变量是属性。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> v1:<span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;hi&quot;</span> <span class="comment">// 标注类型</span></span><br><span class="line"><span class="keyword">var</span> v2 <span class="operator">=</span> <span class="string">&quot;类型推导&quot;</span></span><br><span class="line"><span class="keyword">let</span> l1 <span class="operator">=</span> <span class="string">&quot;标题&quot;</span> <span class="comment">// 常量</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">a</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> p1 <span class="operator">=</span> <span class="number">3</span></span><br><span class="line">    <span class="keyword">var</span> p2: <span class="type">Int</span> &#123;</span><br><span class="line">        p1 <span class="operator">*</span> <span class="number">3</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>属性没有 set 可以省略 get，如果有 set 需加 get。变量设置前通过 willSet 访问到，变量设置后通过 didSet 访问。</p>
<h4 id="打印-print-“”"><a href="#打印-print-“”" class="headerlink" title="打印 print(“”)"></a>打印 print(“”)</h4><p>控制台打印值</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;hi&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> i <span class="operator">=</span> <span class="number">14</span></span><br><span class="line"><span class="built_in">print</span>(i)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;9月<span class="subst">\(i)</span>是小柠檬的生日&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span><span class="operator">...</span><span class="number">3</span>&#123;</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// output:</span></span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用terminator使循环打印更整洁</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span><span class="operator">...</span><span class="number">3</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(i)</span> &quot;</span>, terminator: <span class="string">&quot;&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// output:</span></span><br><span class="line"><span class="comment">// 1 2 3</span></span><br></pre></td></tr></table></figure>
<h4 id="注释"><a href="#注释" class="headerlink" title="注释 //"></a>注释 //</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 单行注释</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">多行注释第一行。</span></span><br><span class="line"><span class="comment">多行注释第二行。</span></span><br><span class="line"><span class="comment">*/</span> </span><br><span class="line"><span class="comment">// MARK: 会在 minimap 上展示</span></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 待做</span></span><br><span class="line"><span class="comment">// <span class="doctag">FIXME:</span> 待修复</span></span><br></pre></td></tr></table></figure>
<h4 id="可选"><a href="#可选" class="headerlink" title="可选 ?, !"></a>可选 ?, !</h4><p>可能会是 nil 的变量就是可选变量。当变量为 nil 通过??操作符可以提供一个默认值。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> o: <span class="type">Int</span>? <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"><span class="keyword">let</span> i <span class="operator">=</span> o <span class="operator">??</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>
<h4 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h4><p>闭包也可以叫做 lambda，是匿名函数，对应 OC 的 block。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a1 <span class="operator">=</span> [<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>].sorted(by: &#123; (l: <span class="type">Int</span>, r: <span class="type">Int</span>) -&gt; <span class="type">Bool</span> <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">return</span> l <span class="operator">&lt;</span> r</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 如果闭包是唯一的参数并在表达式最后可以使用结尾闭包语法，写法简化为</span></span><br><span class="line"><span class="keyword">let</span> a2 <span class="operator">=</span> [<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>].sorted &#123; (l: <span class="type">Int</span>, r: <span class="type">Int</span>) -&gt; <span class="type">Bool</span> <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">return</span> l <span class="operator">&lt;</span> r</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 已知类型可以省略</span></span><br><span class="line"><span class="keyword">let</span> a3 <span class="operator">=</span> [<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>].sorted &#123; l, r <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">return</span> l <span class="operator">&lt;</span> r</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 通过位置来使用闭包的参数，最后简化如下：</span></span><br><span class="line"><span class="keyword">let</span> a4 <span class="operator">=</span> [<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>].sorted &#123; <span class="variable">$0</span> <span class="operator">&lt;</span> <span class="variable">$1</span> &#125;</span><br></pre></td></tr></table></figure>
<p>函数也是闭包的一种，函数的参数也可以是闭包。@escaping 表示逃逸闭包，逃逸闭包是可以在函数返回之后继续调用的。@autoclosure 表示自动闭包，可以用来省略花括号。</p>
<h4 id="函数-func"><a href="#函数-func" class="headerlink" title="函数 func"></a>函数 func</h4><p>函数可以作为另一个函数的参数，也可以作为另一个函数的返回。函数是特殊的闭包，在类、结构体和枚举中是方法。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 为参数设置默认值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span>(<span class="params">p</span>: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;p&quot;</span>)</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="string">&quot;p is <span class="subst">\(p)</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数作为参数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f2</span>(<span class="params">fn</span>: (<span class="type">String</span>) -&gt; <span class="type">String</span>, <span class="params">p</span>: <span class="type">String</span>)</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fn(p)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(f2(fn:f1, p: <span class="string">&quot;d&quot;</span>)) <span class="comment">// p is d</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数作为返回值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f3</span>(<span class="params">p</span>: <span class="type">String</span>)</span> -&gt; (<span class="type">String</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> f1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(f3(p: <span class="string">&quot;yes&quot;</span>)(<span class="string">&quot;no&quot;</span>)) <span class="comment">// p is no</span></span><br></pre></td></tr></table></figure>
<p>函数可以返回多个值，函数是可以嵌套的，也就是函数里内可以定义函数，函数内定义的函数可以访问自己作用域外函数内的变量。inout 表示的是输入输出参数，函数可以在函数内改变输入输出参数。defer 标识的代码块会在函数返回之前执行。</p>
<p>函数在 Swift 5.4 时开始有了使用多个变量参数的能力，使用方法如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f4</span>(<span class="params">s</span>: <span class="type">String</span>..., <span class="params">i</span>: <span class="type">Int</span>...)</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(s)</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f4(s: <span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>, <span class="string">&quot;three&quot;</span>, i: <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="comment">/// [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]</span></span><br><span class="line"><span class="comment">/// [1, 2, 3]</span></span><br></pre></td></tr></table></figure>
<p>嵌套函数可以重载，嵌套函数可以在声明函数之前调用他。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f5</span>()</span> &#123;</span><br><span class="line">    nf5()</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">nf5</span>()</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;this is nested function&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">f5() <span class="comment">// this is nested function</span></span><br></pre></td></tr></table></figure>
<h4 id="访问控制"><a href="#访问控制" class="headerlink" title="访问控制"></a>访问控制</h4><p>在 Xcode 里的 target 就是模块，使用 import 可导入模块。模块内包含源文件，每个源文件里可以有多个类、结构体、枚举和函数等多种类型。访问级别可以通过一些关键字描述，分为如下几种：</p>
<ul>
<li>open：在模块外可以调用和继承。</li>
<li>public：在模块外可调用不可继承，open 只适用类和类成员。</li>
<li>internal：默认级别，模块内可跨源文件调用，模块外不可调用。</li>
<li>fileprivate：只能在源文件内访问。</li>
<li>private：只能在所在的作用域内访问。</li>
</ul>
<p>重写继承类的成员，可以设置成员比父类的这个成员更高的访问级别。Setter 的级别可以低于对应的 Getter 的级别，比如设置 Setter 访问级别为 private，可以在属性使用 private(set) 来修饰。</p>
<h3 id="基础类型"><a href="#基础类型" class="headerlink" title="基础类型"></a>基础类型</h3><h4 id="数字-Int-Float"><a href="#数字-Int-Float" class="headerlink" title="数字 Int, Float"></a>数字 Int, Float</h4><p>数字的类型有 Int、Float 和 Double</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Int</span></span><br><span class="line"><span class="keyword">let</span> i1 <span class="operator">=</span> <span class="number">100</span></span><br><span class="line"><span class="keyword">let</span> i2 <span class="operator">=</span> <span class="number">22</span></span><br><span class="line"><span class="built_in">print</span>(i1 <span class="operator">/</span> i2) <span class="comment">// 向下取整得 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Float</span></span><br><span class="line"><span class="keyword">let</span> f1: <span class="type">Float</span> <span class="operator">=</span> <span class="number">100.0</span></span><br><span class="line"><span class="keyword">let</span> f2: <span class="type">Float</span> <span class="operator">=</span> <span class="number">22.0</span></span><br><span class="line"><span class="built_in">print</span>(f1 <span class="operator">/</span> f2) <span class="comment">// 4.5454545</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> f3: <span class="type">Float16</span> <span class="operator">=</span> <span class="number">5.0</span> <span class="comment">// macOS 还不能用</span></span><br><span class="line"><span class="keyword">let</span> f4: <span class="type">Float32</span> <span class="operator">=</span> <span class="number">5.0</span></span><br><span class="line"><span class="keyword">let</span> f5: <span class="type">Float64</span> <span class="operator">=</span> <span class="number">5.0</span></span><br><span class="line"><span class="keyword">let</span> f6: <span class="type">Float80</span> <span class="operator">=</span> <span class="number">5.0</span></span><br><span class="line"><span class="built_in">print</span>(f4, f5, f6) <span class="comment">// 5.0 5.0 5.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Double</span></span><br><span class="line"><span class="keyword">let</span> d1: <span class="type">Double</span> <span class="operator">=</span> <span class="number">100.0</span></span><br><span class="line"><span class="keyword">let</span> d2: <span class="type">Double</span> <span class="operator">=</span> <span class="number">22.0</span></span><br><span class="line"><span class="built_in">print</span>(d1 <span class="operator">/</span> d2) <span class="comment">// 4.545454545454546</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 字面量</span></span><br><span class="line"><span class="built_in">print</span>(<span class="type">Int</span>(<span class="number">0b10101</span>)) <span class="comment">// 0b 开头是二进制 </span></span><br><span class="line"><span class="built_in">print</span>(<span class="type">Int</span>(<span class="number">0x00afff</span>)) <span class="comment">// 0x 开头是十六进制</span></span><br><span class="line"><span class="built_in">print</span>(<span class="number">2.5e4</span>) <span class="comment">// 2.5x10^4 十进制用 e</span></span><br><span class="line"><span class="built_in">print</span>(<span class="number">0xAp2</span>) <span class="comment">// 10*2^2  十六进制用 p</span></span><br><span class="line"><span class="built_in">print</span>(<span class="number">2_000_000</span>) <span class="comment">// 2000000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// isMultiple(of:) 方法检查一个数字是否是另一个数字的倍数</span></span><br><span class="line"><span class="keyword">let</span> i3 <span class="operator">=</span> <span class="number">36</span></span><br><span class="line"><span class="built_in">print</span>(i3.isMultiple(of: <span class="number">9</span>)) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>处理数字有 floor、ceil、round。floor 是向下取整，只取整数部分；cell 是向上取整，只要有不为零的小数，整数就加1;round 是四舍五入。       </p>
<h4 id="布尔数-Bool"><a href="#布尔数-Bool" class="headerlink" title="布尔数 Bool"></a>布尔数 Bool</h4><p>布尔数有 true 和 false 两种值，还有一个能够切换这两个值的 toggle 方法。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> b <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">b.toggle() <span class="comment">// true</span></span><br><span class="line">b.toggle() <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h4 id="元组-a-b-c"><a href="#元组-a-b-c" class="headerlink" title="元组 (a, b, c)"></a>元组 (a, b, c)</h4><p>元组里的值类型可以是不同的。元组可以看成是匿名的结构体。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> t1 <span class="operator">=</span> (p1: <span class="number">1</span>, p2: <span class="string">&quot;two&quot;</span>, p3: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line"><span class="built_in">print</span>(t1.p1)</span><br><span class="line"><span class="built_in">print</span>(t1.p3)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类型推导</span></span><br><span class="line"><span class="keyword">let</span> t2 <span class="operator">=</span> (<span class="number">1</span>, <span class="string">&quot;two&quot;</span>, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过下标访问</span></span><br><span class="line"><span class="built_in">print</span>(t2.<span class="number">1</span>) <span class="comment">// two</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 分解元组</span></span><br><span class="line"><span class="keyword">let</span> (dp1, dp2, <span class="keyword">_</span>) <span class="operator">=</span> t2</span><br><span class="line"><span class="built_in">print</span>(dp1)</span><br><span class="line"><span class="built_in">print</span>(dp2)</span><br></pre></td></tr></table></figure>
<h4 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s1 <span class="operator">=</span> <span class="string">&quot;Hi! This is a string. Cool?&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/// 转义符 \n 表示换行。</span></span><br><span class="line"><span class="comment">/// 其它转义字符有 \0 空字符)、\t 水平制表符 、\n 换行符、\r 回车符</span></span><br><span class="line"><span class="keyword">let</span> s2 <span class="operator">=</span> <span class="string">&quot;Hi!<span class="subst">\n</span>This is a string. Cool?&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 多行</span></span><br><span class="line"><span class="keyword">let</span> s3 <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Hi!</span></span><br><span class="line"><span class="string">This is a string.</span></span><br><span class="line"><span class="string">Cool?</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 长度</span></span><br><span class="line"><span class="built_in">print</span>(s3.count)</span><br><span class="line"><span class="built_in">print</span>(s3.isEmpty)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 拼接</span></span><br><span class="line"><span class="built_in">print</span>(s3 <span class="operator">+</span> <span class="string">&quot;<span class="subst">\n</span>Sure!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 字符串中插入变量</span></span><br><span class="line"><span class="keyword">let</span> i <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Today is good day, double <span class="subst">\(i)</span><span class="subst">\(i)</span>!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 遍历字符串</span></span><br><span class="line"><span class="comment">/// 输出：</span></span><br><span class="line"><span class="comment">/// o</span></span><br><span class="line"><span class="comment">/// n</span></span><br><span class="line"><span class="comment">/// e</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> <span class="string">&quot;one&quot;</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(c)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查找</span></span><br><span class="line"><span class="built_in">print</span>(s3.lowercased().contains(<span class="string">&quot;cool&quot;</span>)) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 替换</span></span><br><span class="line"><span class="keyword">let</span> s4 <span class="operator">=</span> <span class="string">&quot;one is two&quot;</span></span><br><span class="line"><span class="keyword">let</span> newS4 <span class="operator">=</span> s4.replacingOccurrences(of: <span class="string">&quot;two&quot;</span>, with: <span class="string">&quot;one&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(newS4)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除空格和换行</span></span><br><span class="line"><span class="keyword">let</span> s5 <span class="operator">=</span> <span class="string">&quot; Simple line. <span class="subst">\n</span><span class="subst">\n</span>  &quot;</span></span><br><span class="line"><span class="built_in">print</span>(s5.trimmingCharacters(in: .whitespacesAndNewlines))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 切割成数组</span></span><br><span class="line"><span class="keyword">let</span> s6 <span class="operator">=</span> <span class="string">&quot;one/two/three&quot;</span></span><br><span class="line"><span class="keyword">let</span> a1 <span class="operator">=</span> s6.components(separatedBy: <span class="string">&quot;/&quot;</span>) <span class="comment">// 继承自 NSString 的接口</span></span><br><span class="line"><span class="built_in">print</span>(a1) <span class="comment">// [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a2 <span class="operator">=</span> s6.split(separator: <span class="string">&quot;/&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(a2) <span class="comment">// [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;] 属于切片，性能较 components 更好</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断是否是某种类型</span></span><br><span class="line"><span class="keyword">let</span> c1: <span class="type">Character</span> <span class="operator">=</span> <span class="string">&quot;🤔&quot;</span></span><br><span class="line"><span class="built_in">print</span>(c1.isASCII) <span class="comment">// false</span></span><br><span class="line"><span class="built_in">print</span>(c1.isSymbol) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">print</span>(c1.isLetter) <span class="comment">// false</span></span><br><span class="line"><span class="built_in">print</span>(c1.isNumber) <span class="comment">// false</span></span><br><span class="line"><span class="built_in">print</span>(c1.isUppercase) <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 字符串和 Data 互转</span></span><br><span class="line"><span class="keyword">let</span> data <span class="operator">=</span> <span class="type">Data</span>(<span class="string">&quot;hi&quot;</span>.utf8)</span><br><span class="line"><span class="keyword">let</span> s7 <span class="operator">=</span> <span class="type">String</span>(decoding: data, as: <span class="type">UTF8</span>.<span class="keyword">self</span>)</span><br><span class="line"><span class="built_in">print</span>(s7) <span class="comment">// hi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 字符串可以当作集合来用。</span></span><br><span class="line"><span class="keyword">let</span> revered <span class="operator">=</span> s7.reversed()</span><br><span class="line"><span class="built_in">print</span>(<span class="type">String</span>(revered))</span><br></pre></td></tr></table></figure>
<p>Unicode、Character 和 SubString 等内容参见官方字符串文档：<a target="_blank" rel="noopener" href="https://docs.swift.org/swift-book/LanguageGuide/StringsAndCharacters.html">Strings and Characters — The Swift Programming Language (Swift 5.1)</a></p>
<p>字符串字面符号可以参看《<a target="_blank" rel="noopener" href="https://www.swiftbysundell.com/articles/string-literals-in-swift/">String literals in Swift</a>》。</p>
<p>原始字符串<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 原始字符串在字符串前加上一个或多个#符号。里面的双引号和转义符号将不再起作用了，如果想让转义符起作用，需要在转义符后面加上#符号。</span></span><br><span class="line"><span class="keyword">let</span> s8 <span class="operator">=</span> <span class="string">#&quot;\(s7)<span class="subst">\#(s7)</span> &quot;one&quot; and &quot;two&quot;\n. <span class="subst">\#n</span>The second line.&quot;#</span></span><br><span class="line"><span class="built_in">print</span>(s8)</span><br><span class="line"><span class="comment">/// \(s7)hi &quot;one&quot; and &quot;two&quot;\n.</span></span><br><span class="line"><span class="comment">/// The second line.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 原始字符串在正则使用效果更佳，反斜杠更少了。</span></span><br><span class="line"><span class="keyword">let</span> s9 <span class="operator">=</span> <span class="string">&quot;<span class="subst">\\</span><span class="subst">\\</span>[A-Z]+[A-Za-z]+<span class="subst">\\</span>.[a-z]+&quot;</span></span><br><span class="line"><span class="keyword">let</span> s10 <span class="operator">=</span> <span class="string">#&quot;\\[A-Z]+[A-Za-z]+\.[a-z]+&quot;#</span></span><br><span class="line"><span class="built_in">print</span>(s9) <span class="comment">// \\[A-Z]+[A-Za-z]+\.[a-z]+</span></span><br><span class="line"><span class="built_in">print</span>(s10) <span class="comment">// \\[A-Z]+[A-Za-z]+\.[a-z]+</span></span><br></pre></td></tr></table></figure></p>
<h4 id="枚举"><a href="#枚举" class="headerlink" title="枚举"></a>枚举</h4><p>Swift的枚举有类的一些特性，比如计算属性、实例方法、扩展、遵循协议等等。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">E1</span>:<span class="title">String</span>, <span class="title">CaseIterable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> e1, e2 <span class="operator">=</span> <span class="string">&quot;12&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关联值</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">E2</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> e1([<span class="type">String</span>])</span><br><span class="line">    <span class="keyword">case</span> e2(<span class="type">Int</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> e1 <span class="operator">=</span> <span class="type">E2</span>.e1([<span class="string">&quot;one&quot;</span>,<span class="string">&quot;two&quot;</span>])</span><br><span class="line"><span class="keyword">let</span> e2 <span class="operator">=</span> <span class="type">E2</span>.e2(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> e1 &#123;</span><br><span class="line"><span class="keyword">case</span> .e1(<span class="keyword">let</span> array):</span><br><span class="line">    <span class="built_in">print</span>(array)</span><br><span class="line"><span class="keyword">case</span> .e2(<span class="keyword">let</span> int):</span><br><span class="line">    <span class="built_in">print</span>(int)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(e2)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 原始值</span></span><br><span class="line"><span class="built_in">print</span>(<span class="type">E1</span>.e1.rawValue)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遵循 CaseIterable 协议可迭代</span></span><br><span class="line"><span class="keyword">for</span> ie <span class="keyword">in</span> <span class="type">E1</span>.allCases &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;show <span class="subst">\(ie)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 递归枚举</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">RE</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> v(<span class="type">String</span>)</span><br><span class="line">    <span class="keyword">indirect</span> <span class="keyword">case</span> node(l:<span class="type">RE</span>, r:<span class="type">RE</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> lNode <span class="operator">=</span> <span class="type">RE</span>.v(<span class="string">&quot;left&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> rNode <span class="operator">=</span> <span class="type">RE</span>.v(<span class="string">&quot;right&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> pNode <span class="operator">=</span> <span class="type">RE</span>.node(l: lNode, r: rNode)</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> pNode &#123;</span><br><span class="line"><span class="keyword">case</span> .v(<span class="keyword">let</span> string):</span><br><span class="line">    <span class="built_in">print</span>(string)</span><br><span class="line"><span class="keyword">case</span> .node(<span class="keyword">let</span> l, <span class="keyword">let</span> r):</span><br><span class="line">    <span class="built_in">print</span>(l,r)</span><br><span class="line">    <span class="keyword">switch</span> l &#123;</span><br><span class="line">    <span class="keyword">case</span> .v(<span class="keyword">let</span> string):</span><br><span class="line">        <span class="built_in">print</span>(string)</span><br><span class="line">    <span class="keyword">case</span> .node(<span class="keyword">let</span> l, <span class="keyword">let</span> r):</span><br><span class="line">        <span class="built_in">print</span>(l, r)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">switch</span> r &#123;</span><br><span class="line">    <span class="keyword">case</span> .v(<span class="keyword">let</span> string):</span><br><span class="line">        <span class="built_in">print</span>(string)</span><br><span class="line">    <span class="keyword">case</span> .node(<span class="keyword">let</span> l, <span class="keyword">let</span> r):</span><br><span class="line">        <span class="built_in">print</span>(l, r)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>@unknown 用来区分固定的枚举和可能改变的枚举的能力。@unknown 用于防止未来新增枚举属性会进行提醒提示完善每个 case 的处理。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @unknown</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">E3</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> e1, e2, e3</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fe1</span>(<span class="params">e</span>: <span class="type">E3</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> e &#123;</span><br><span class="line">    <span class="keyword">case</span> .e1:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;e1 ok&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> .e2:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;e2 ok&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> .e3:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;e3 ok&quot;</span>)</span><br><span class="line">    <span class="keyword">@unknown</span> <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;not ok&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>符合 Comparable 协议的枚举可以进行比较。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Comparable 枚举比较</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">E4</span>: <span class="title">Comparable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> e1, e2</span><br><span class="line">    <span class="keyword">case</span> e3(i: <span class="type">Int</span>)</span><br><span class="line">    <span class="keyword">case</span> e4</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> e3 <span class="operator">=</span> <span class="type">E4</span>.e4</span><br><span class="line"><span class="keyword">let</span> e4 <span class="operator">=</span> <span class="type">E4</span>.e3(i: <span class="number">3</span>)</span><br><span class="line"><span class="keyword">let</span> e5 <span class="operator">=</span> <span class="type">E4</span>.e3(i: <span class="number">2</span>)</span><br><span class="line"><span class="keyword">let</span> e6 <span class="operator">=</span> <span class="type">E4</span>.e1</span><br><span class="line"><span class="built_in">print</span>(e3 <span class="operator">&gt;</span> e4) <span class="comment">// true</span></span><br><span class="line"><span class="keyword">let</span> a1 <span class="operator">=</span> [e3, e4, e5, e6]</span><br><span class="line"><span class="keyword">let</span> a2 <span class="operator">=</span> a1.sorted()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a2 &#123;</span><br><span class="line">    <span class="built_in">print</span>(i.<span class="keyword">self</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/// e1</span></span><br><span class="line"><span class="comment">/// e3(i: 2)</span></span><br><span class="line"><span class="comment">/// e3(i: 3)</span></span><br><span class="line"><span class="comment">/// e4</span></span><br></pre></td></tr></table></figure>
<h4 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h4><p>泛型可以减少重复代码，是一种抽象的表达方式。where 关键字可以对泛型做约束。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fn</span>&lt;<span class="type">T</span>&gt;(<span class="params">p</span>: <span class="type">T</span>)</span> -&gt; [<span class="type">T</span>] &#123;</span><br><span class="line">    <span class="keyword">var</span> r <span class="operator">=</span> [<span class="type">T</span>]()</span><br><span class="line">    r.append(p)</span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(fn(p: <span class="string">&quot;one&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结构体</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S1</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> arr <span class="operator">=</span> [<span class="type">T</span>]()</span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">add</span>(<span class="keyword">_</span> <span class="params">p</span>: <span class="type">T</span>)</span> &#123;</span><br><span class="line">        arr.append(p)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> s1 <span class="operator">=</span> <span class="type">S1</span>(arr: [<span class="string">&quot;zero&quot;</span>])</span><br><span class="line">s1.add(<span class="string">&quot;one&quot;</span>)</span><br><span class="line">s1.add(<span class="string">&quot;two&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(s1.arr) <span class="comment">// [&quot;zero&quot;, &quot;one&quot;, &quot;two&quot;]</span></span><br></pre></td></tr></table></figure>
<p>关联类型</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">pc</span> </span>&#123;</span><br><span class="line">    <span class="keyword">associatedtype</span> <span class="type">T</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">add</span>(<span class="keyword">_</span> <span class="params">p</span>: <span class="type">T</span>)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S2</span>: <span class="title">pc</span> </span>&#123;</span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">T</span> <span class="operator">=</span> <span class="type">String</span> <span class="comment">// 类型推导，可省略</span></span><br><span class="line">    <span class="keyword">var</span> strs <span class="operator">=</span> [<span class="type">String</span>]()</span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">add</span>(<span class="keyword">_</span> <span class="params">p</span>: <span class="type">String</span>)</span> &#123;</span><br><span class="line">        strs.append(p)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>泛型适用于嵌套类型<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S3</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">S4</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> p: <span class="type">T</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> p1: <span class="type">T</span></span><br><span class="line">    <span class="keyword">var</span> p2: <span class="type">S4</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> s2 <span class="operator">=</span> <span class="type">S3</span>(p1: <span class="number">1</span>, p2: <span class="type">S3</span>.<span class="type">S4</span>(p: <span class="number">3</span>))</span><br><span class="line"><span class="keyword">let</span> s3 <span class="operator">=</span> <span class="type">S3</span>(p1: <span class="string">&quot;one&quot;</span>, p2: <span class="type">S3</span>.<span class="type">S4</span>(p: <span class="string">&quot;three&quot;</span>))</span><br><span class="line"><span class="built_in">print</span>(s2,s3)</span><br></pre></td></tr></table></figure></p>
<h4 id="不透明类型"><a href="#不透明类型" class="headerlink" title="不透明类型"></a>不透明类型</h4><p>不透明类型会隐藏类型，让使用者更关注功能。不透明类型和协议很类似，不同的是不透明比协议限定的要多，协议能够对应更多类型。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">f</span>()</span> -&gt; <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S1</span>: <span class="title">P</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">f</span>()</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;one<span class="subst">\n</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S2</span>&lt;<span class="title">T</span>: <span class="title">P</span>&gt;: <span class="title">P</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p: <span class="type">T</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">f</span>()</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> p.f() <span class="operator">+</span> <span class="string">&quot;two<span class="subst">\n</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S3</span>&lt;<span class="title">T1</span>: <span class="title">P</span>, <span class="title">T2</span>: <span class="title">P</span>&gt;: <span class="title">P</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p1: <span class="type">T1</span></span><br><span class="line">    <span class="keyword">var</span> p2: <span class="type">T2</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">f</span>()</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> p1.f() <span class="operator">+</span> p2.f() <span class="operator">+</span> <span class="string">&quot;three<span class="subst">\n</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">someP</span>()</span> -&gt; <span class="keyword">some</span> <span class="type">P</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">S3</span>(p1: <span class="type">S1</span>(), p2: <span class="type">S2</span>(p: <span class="type">S1</span>()))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> r <span class="operator">=</span> someP()</span><br><span class="line"><span class="built_in">print</span>(r.f())</span><br></pre></td></tr></table></figure>
<p>函数调用者决定返回什么类型是泛型，函数自身决定返回什么类型使用不透明返回类型。</p>
<h4 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h4><p>Result 类型用来处理错误，特别适用异步接口的错误处理。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">URLSession</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">dataTaskWithResult</span>(</span></span><br><span class="line"><span class="function">        <span class="params">with</span> <span class="params">url</span>: <span class="type">URL</span>,</span></span><br><span class="line"><span class="function">        <span class="params">handler</span>: <span class="keyword">@escaping</span> (<span class="type">Result</span>&lt;<span class="type">Data</span>, <span class="type">Error</span>&gt;) -&gt; <span class="type">Void</span></span></span><br><span class="line"><span class="function">    )</span> -&gt; <span class="type">URLSessionDataTask</span> &#123;</span><br><span class="line">        dataTask(with: url) &#123; data, <span class="keyword">_</span>, err <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> err <span class="operator">=</span> err &#123;</span><br><span class="line">                handler(.failure(err))</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                handler(.success(data <span class="operator">??</span> <span class="type">Data</span>()))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> url <span class="operator">=</span> <span class="type">URL</span>(string: <span class="string">&quot;https://ming1016.github.io/&quot;</span>)<span class="operator">!</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 以前网络请求</span></span><br><span class="line"><span class="keyword">let</span> t1 <span class="operator">=</span> <span class="type">URLSession</span>.shared.dataTask(with: url) &#123;</span><br><span class="line">    data, <span class="keyword">_</span>, error <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> err <span class="operator">=</span> error &#123;</span><br><span class="line">        <span class="built_in">print</span>(err)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> data <span class="operator">=</span> data &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="type">String</span>(decoding: data, as: <span class="type">UTF8</span>.<span class="keyword">self</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">t1.resume()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 Result 网络请求</span></span><br><span class="line"><span class="keyword">let</span> t2 <span class="operator">=</span> <span class="type">URLSession</span>.shared.dataTaskWithResult(with: url) &#123; result <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">switch</span> result &#123;</span><br><span class="line">    <span class="keyword">case</span> .success(<span class="keyword">let</span> data):</span><br><span class="line">        <span class="built_in">print</span>(<span class="type">String</span>(decoding: data, as: <span class="type">UTF8</span>.<span class="keyword">self</span>))</span><br><span class="line">    <span class="keyword">case</span> .failure(<span class="keyword">let</span> err):</span><br><span class="line">        <span class="built_in">print</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">t2.resume()</span><br></pre></td></tr></table></figure>
<h4 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h4><p>使用 is 关键字进行类型判断， 使用as 关键字来转换成子类。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">S0</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">S1</span>: <span class="title">S0</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">S2</span>: <span class="title">S0</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a <span class="operator">=</span> [<span class="type">S0</span>]()</span><br><span class="line">a.append(<span class="type">S1</span>())</span><br><span class="line">a.append(<span class="type">S2</span>())</span><br><span class="line"><span class="keyword">for</span> e <span class="keyword">in</span> a &#123;</span><br><span class="line">    <span class="comment">// 类型判断</span></span><br><span class="line">    <span class="keyword">if</span> e <span class="keyword">is</span> <span class="type">S1</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Type is S1&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> e <span class="keyword">is</span> <span class="type">S2</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Type is S2&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 使用 as 关键字转换成子类</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> s1 <span class="operator">=</span> e <span class="keyword">as?</span> <span class="type">S1</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;As S1 <span class="subst">\(s1)</span>&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> s2 <span class="operator">=</span> e <span class="keyword">as?</span> <span class="type">S2</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;As S2 <span class="subst">\(s2)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="类和结构体"><a href="#类和结构体" class="headerlink" title="类和结构体"></a>类和结构体</h3><h4 id="类"><a href="#类" class="headerlink" title="类"></a>类</h4><p>类可以定义属性、方法、构造器、下标操作。类使用扩展来扩展功能，遵循协议。类还以继承，运行时检查实例类型。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p: <span class="type">String</span></span><br><span class="line">    <span class="function"><span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">p</span>: <span class="type">String</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.p <span class="operator">=</span> p</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 下标操作</span></span><br><span class="line">    <span class="function"><span class="keyword">subscript</span>(<span class="params">s</span>: <span class="type">String</span>)</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> p <span class="operator">+</span> s</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            p <span class="operator">=</span> s <span class="operator">+</span> newValue</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> c <span class="operator">=</span> <span class="type">C</span>(<span class="string">&quot;hi&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(c.p)</span><br><span class="line"><span class="built_in">print</span>(c[<span class="string">&quot; ming&quot;</span>])</span><br><span class="line">c[<span class="string">&quot;k&quot;</span>] <span class="operator">=</span> <span class="string">&quot;v&quot;</span></span><br><span class="line"><span class="built_in">print</span>(c.p)</span><br></pre></td></tr></table></figure>
<h4 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h4><p>结构体是值类型，可以定义属性、方法、构造器、下标操作。结构体使用扩展来扩展功能，遵循协议。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p1: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">var</span> p2: <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">S</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">f</span>()</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> p1 <span class="operator">+</span> <span class="type">String</span>(p2)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> s <span class="operator">=</span> <span class="type">S</span>(p2: <span class="number">1</span>)</span><br><span class="line">s.p1 <span class="operator">=</span> <span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="built_in">print</span>(s.f()) <span class="comment">// 11</span></span><br></pre></td></tr></table></figure>
<h4 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h4><p>类、结构体或枚举里的变量常量就是他们的属性。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> sp <span class="operator">=</span> <span class="string">&quot;类型属性&quot;</span> <span class="comment">// 类型属性通过类型本身访问，非实例访问</span></span><br><span class="line">    <span class="keyword">var</span> p1: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">var</span> p2: <span class="type">Int</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">    <span class="comment">// cp 是计算属性</span></span><br><span class="line">    <span class="keyword">var</span> cp: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> p2 <span class="operator">*</span> <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            p2 <span class="operator">=</span> newValue <span class="operator">+</span> <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 只有 getter 的是只读计算属性</span></span><br><span class="line">    <span class="keyword">var</span> rcp: <span class="type">Int</span> &#123;</span><br><span class="line">        p2 <span class="operator">*</span> <span class="number">4</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="type">S</span>.sp)</span><br><span class="line"><span class="built_in">print</span>(<span class="type">S</span>().cp) <span class="comment">// 2</span></span><br><span class="line"><span class="keyword">var</span> s <span class="operator">=</span> <span class="type">S</span>()</span><br><span class="line">s.cp <span class="operator">=</span> <span class="number">3</span></span><br><span class="line"><span class="built_in">print</span>(s.p2) <span class="comment">// 5</span></span><br><span class="line"><span class="built_in">print</span>(<span class="type">S</span>().rcp) <span class="comment">// 4</span></span><br></pre></td></tr></table></figure>
<p>willSet 和 didSet 是属性观察器，可以在属性值设置前后插入自己的逻辑处理。</p>
<p>键路径表达式作为函数</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S2</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> p1: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> p2: <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> s2 <span class="operator">=</span> <span class="type">S2</span>(p1: <span class="string">&quot;one&quot;</span>, p2: <span class="number">1</span>)</span><br><span class="line"><span class="keyword">let</span> s3 <span class="operator">=</span> <span class="type">S2</span>(p1: <span class="string">&quot;two&quot;</span>, p2: <span class="number">2</span>)</span><br><span class="line"><span class="keyword">let</span> a1 <span class="operator">=</span> [s2, s3]</span><br><span class="line"><span class="keyword">let</span> a2 <span class="operator">=</span> a1.map(\.p1)</span><br><span class="line"><span class="built_in">print</span>(a2) <span class="comment">// [&quot;one&quot;, &quot;two&quot;]</span></span><br></pre></td></tr></table></figure>
<h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">E</span>: <span class="title">String</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> one, two, three</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">showRawValue</span>()</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(rawValue)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> e <span class="operator">=</span> <span class="type">E</span>.three</span><br><span class="line">e.showRawValue() <span class="comment">// three</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 可变的实例方法，使用 mutating 标记</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p: <span class="type">String</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">addFullStopForP</span>()</span> &#123;</span><br><span class="line">        p <span class="operator">+=</span> <span class="string">&quot;.&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> s <span class="operator">=</span> <span class="type">S</span>(p: <span class="string">&quot;hi&quot;</span>)</span><br><span class="line">s.addFullStopForP()</span><br><span class="line"><span class="built_in">print</span>(s.p)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类方法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">cf</span>() </span>&#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;类方法&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>static和class关键字修饰的方法类似 OC 的类方法。static 可以修饰存储属性，而 class 不能；class 修饰的方法可以继承，而 static 不能。在协议中需用 static 来修饰。</p>
<p>静态下标方法</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 静态下标</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S2</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> sp <span class="operator">=</span> [<span class="type">String</span>: <span class="type">Int</span>]()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">subscript</span>(<span class="keyword">_</span> <span class="params">s</span>: <span class="type">String</span>, <span class="params">d</span>: <span class="type">Int</span> <span class="operator">=</span> <span class="number">10</span>)</span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> sp[s] <span class="operator">??</span> d</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            sp[s] <span class="operator">=</span> newValue</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">S2</span>[<span class="string">&quot;key1&quot;</span>] <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="type">S2</span>[<span class="string">&quot;key2&quot;</span>] <span class="operator">=</span> <span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(<span class="type">S2</span>[<span class="string">&quot;key2&quot;</span>]) <span class="comment">// 2</span></span><br><span class="line"><span class="built_in">print</span>(<span class="type">S2</span>[<span class="string">&quot;key3&quot;</span>]) <span class="comment">// 10</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>自定义类型中实现了 callAsFunction() 的话，该类型的值就可以直接调用。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// callAsFunction()</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S3</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p1: <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">callAsFunction</span>()</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;show <span class="subst">\(p1)</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> s2 <span class="operator">=</span> <span class="type">S3</span>(p1: <span class="string">&quot;hi&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(s2()) <span class="comment">// show hi</span></span><br></pre></td></tr></table></figure>
<h4 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h4><p>类能继承另一个类，继承它的方法、属性等。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类继承</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C1</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p1: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> cp1: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> p1 <span class="operator">+</span> <span class="string">&quot; like ATM&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            p1 <span class="operator">=</span> p1 <span class="operator">+</span> newValue</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">init</span>(<span class="params">p1</span>: <span class="type">String</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.p1 <span class="operator">=</span> p1</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">sayHi</span>()</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Hi! <span class="subst">\(p1)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C2</span>: <span class="title">C1</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p2: <span class="type">String</span></span><br><span class="line">    <span class="function"><span class="keyword">init</span>(<span class="params">p2</span>: <span class="type">String</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.p2 <span class="operator">=</span> p2</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(p1: p2 <span class="operator">+</span> <span class="string">&quot;&#x27;s father&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">C2</span>(p2: <span class="string">&quot;Lemon&quot;</span>).sayHi() <span class="comment">// Hi! Lemon&#x27;s father</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写父类方法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C3</span>: <span class="title">C2</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">sayHi</span>()</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Hi! <span class="subst">\(p2)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">C3</span>(p2: <span class="string">&quot;Lemon&quot;</span>).sayHi() <span class="comment">// Hi! Lemon</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写计算属性</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C4</span>: <span class="title">C1</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> cp1: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> p1 <span class="operator">+</span> <span class="string">&quot; like Out of the blade&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            p1 <span class="operator">=</span> p1 <span class="operator">+</span> newValue</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="type">C1</span>(p1: <span class="string">&quot;Lemon&quot;</span>).cp1) <span class="comment">// Lemon like ATM</span></span><br><span class="line"><span class="built_in">print</span>(<span class="type">C4</span>(p1: <span class="string">&quot;Lemon&quot;</span>).cp1) <span class="comment">// Lemon like Out of the blade</span></span><br></pre></td></tr></table></figure>
<p>通过 final 关键字可以防止类被继承，final 还可以用于属性和方法。使用 super 关键字指代父类。</p>
<h3 id="函数式"><a href="#函数式" class="headerlink" title="函数式"></a>函数式</h3><h4 id="map"><a href="#map" class="headerlink" title="map"></a>map</h4><p>map 可以依次处理数组中元素，并返回一个处理后的新数组。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a1 <span class="operator">=</span> [<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>]</span><br><span class="line"><span class="keyword">let</span> a2 <span class="operator">=</span> a1.map &#123;</span><br><span class="line">    <span class="string">&quot;<span class="subst">\(<span class="variable">$0</span>)</span>2&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(a2) <span class="comment">// [&quot;a2&quot;, &quot;b2&quot;, &quot;c2&quot;]</span></span><br></pre></td></tr></table></figure>
<p>使用 compactMap 可以过滤 nil 的元素。flatMap 会将多个数组合成一个数组返回。</p>
<h4 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h4><p>根据指定条件返回</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a1 <span class="operator">=</span> [<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;call my name&quot;</span>]</span><br><span class="line"><span class="keyword">let</span> a2 <span class="operator">=</span> a1.filter &#123;</span><br><span class="line">    <span class="variable">$0</span>.prefix(<span class="number">1</span>) <span class="operator">==</span> <span class="string">&quot;c&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(a2) <span class="comment">// [&quot;c&quot;, &quot;call my name&quot;]</span></span><br></pre></td></tr></table></figure>
<h4 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h4><p>reduce 可以将迭代中返回的结果用于下个迭代中，并，还能让你设个初始值。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a1 <span class="operator">=</span> [<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;call my name.&quot;</span>, <span class="string">&quot;get it?&quot;</span>]</span><br><span class="line"><span class="keyword">let</span> a2 <span class="operator">=</span> a1.reduce(<span class="string">&quot;Hey u,&quot;</span>, &#123; partialResult, s <span class="keyword">in</span></span><br><span class="line">    <span class="comment">// partialResult 是前面返回的值，s 是遍历到当前的值</span></span><br><span class="line">    partialResult <span class="operator">+</span> <span class="string">&quot; <span class="subst">\(s)</span>&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(a2) <span class="comment">// Hey u, a b c call my name. get it?</span></span><br></pre></td></tr></table></figure>
<h4 id="sorted"><a href="#sorted" class="headerlink" title="sorted"></a>sorted</h4><p>排序</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类型遵循 Comparable</span></span><br><span class="line"><span class="keyword">let</span> a1 <span class="operator">=</span> [<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;call my name.&quot;</span>, <span class="string">&quot;get it?&quot;</span>]</span><br><span class="line"><span class="keyword">let</span> a2 <span class="operator">=</span> a1.sorted()</span><br><span class="line"><span class="keyword">let</span> a3 <span class="operator">=</span> a1.sorted(by: <span class="operator">&gt;</span>)</span><br><span class="line"><span class="keyword">let</span> a4 <span class="operator">=</span> a1.sorted(by: <span class="operator">&lt;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(a2) <span class="comment">// Hey u, a b c call my name. get it?</span></span><br><span class="line"><span class="built_in">print</span>(a3) <span class="comment">// [&quot;get it?&quot;, &quot;call my name.&quot;, &quot;c&quot;, &quot;b&quot;, &quot;a&quot;]</span></span><br><span class="line"><span class="built_in">print</span>(a4) <span class="comment">// [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;call my name.&quot;, &quot;get it?&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 类型不遵循 Comparable</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> s: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> i: <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a5 <span class="operator">=</span> [<span class="type">S</span>(s: <span class="string">&quot;a&quot;</span>, i: <span class="number">0</span>), <span class="type">S</span>(s: <span class="string">&quot;b&quot;</span>, i: <span class="number">1</span>), <span class="type">S</span>(s: <span class="string">&quot;c&quot;</span>, i: <span class="number">2</span>)]</span><br><span class="line"><span class="keyword">let</span> a6 <span class="operator">=</span> a5</span><br><span class="line">    .sorted &#123; l, r <span class="keyword">in</span></span><br><span class="line">        l.i <span class="operator">&gt;</span> r.i</span><br><span class="line">    &#125;</span><br><span class="line">    .map &#123;</span><br><span class="line">        <span class="variable">$0</span>.i</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(a6) <span class="comment">// [2, 1, 0]</span></span><br></pre></td></tr></table></figure>
<h3 id="控制流"><a href="#控制流" class="headerlink" title="控制流"></a>控制流</h3><h4 id="If-•-If-let-•-If-case-let"><a href="#If-•-If-let-•-If-case-let" class="headerlink" title="If • If let • If case let"></a>If • If let • If case let</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// if</span></span><br><span class="line"><span class="keyword">let</span> s <span class="operator">=</span> <span class="string">&quot;hi&quot;</span></span><br><span class="line"><span class="keyword">if</span> s.isEmpty &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;String is Empty&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;String is <span class="subst">\(s)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 三元条件</span></span><br><span class="line">s.isEmpty <span class="operator">?</span> <span class="built_in">print</span>(<span class="string">&quot;String is Empty again&quot;</span>) : <span class="built_in">print</span>(<span class="string">&quot;String is <span class="subst">\(s)</span> again&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// if let-else</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span>(<span class="params">s</span>: <span class="type">String</span>?)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> s1 <span class="operator">=</span> s &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;s1 is <span class="subst">\(s1)</span>&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;s1 is nothing&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// nil-coalescing</span></span><br><span class="line">    <span class="keyword">let</span> s2 <span class="operator">=</span> s <span class="operator">??</span> <span class="string">&quot;nothing&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;s2 is <span class="subst">\(s2)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">f(s: <span class="string">&quot;something&quot;</span>)</span><br><span class="line">f(s: <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// if case let</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">E</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> c1(<span class="type">String</span>)</span><br><span class="line">    <span class="keyword">case</span> c2([<span class="type">String</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">des</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> .c1(<span class="keyword">let</span> string):</span><br><span class="line">            <span class="built_in">print</span>(string)</span><br><span class="line">        <span class="keyword">case</span> .c2(<span class="keyword">let</span> array):</span><br><span class="line">            <span class="built_in">print</span>(array)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">E</span>.c1(<span class="string">&quot;enum c1&quot;</span>).des()</span><br><span class="line"><span class="type">E</span>.c2([<span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>, <span class="string">&quot;three&quot;</span>]).des()</span><br></pre></td></tr></table></figure>
<h4 id="Guard-guard-guard-let"><a href="#Guard-guard-guard-let" class="headerlink" title="Guard guard, guard let"></a>Guard guard, guard let</h4><p>更好地处理异常情况</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// guard</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span>(<span class="params">p</span>: <span class="type">String</span>)</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> p.isEmpty <span class="operator">!=</span> <span class="literal">true</span> <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Empty string.&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;String <span class="subst">\(p)</span> is not empty.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(f1(p: <span class="string">&quot;&quot;</span>)) <span class="comment">// Empty string.</span></span><br><span class="line"><span class="built_in">print</span>(f1(p: <span class="string">&quot;lemon&quot;</span>)) <span class="comment">// String lemon is not empty.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// guard let</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f2</span>(<span class="params">p1</span>: <span class="type">String</span>?)</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> p2 <span class="operator">=</span> p1 <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Nil.&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;String <span class="subst">\(p2)</span> is not nil.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(f2(p1: <span class="literal">nil</span>)) <span class="comment">// Nil.</span></span><br><span class="line"><span class="built_in">print</span>(f2(p1: <span class="string">&quot;lemon&quot;</span>)) <span class="comment">// String lemon is not nil.</span></span><br></pre></td></tr></table></figure>
<h4 id="遍历-For-in"><a href="#遍历-For-in" class="headerlink" title="遍历 For-in"></a>遍历 For-in</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a <span class="operator">=</span> [<span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>, <span class="string">&quot;three&quot;</span>]</span><br><span class="line"><span class="keyword">for</span> str <span class="keyword">in</span> a &#123;</span><br><span class="line">    <span class="built_in">print</span>(str)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用下标范围</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span><span class="number">10</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 enumerated</span></span><br><span class="line"><span class="keyword">for</span> (i, str) <span class="keyword">in</span> a.enumerated() &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;第<span class="subst">\(i <span class="operator">+</span> <span class="number">1</span>)</span>个是:<span class="subst">\(str)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// for in where</span></span><br><span class="line"><span class="keyword">for</span> str <span class="keyword">in</span> a <span class="keyword">where</span> str.prefix(<span class="number">1</span>) <span class="operator">==</span> <span class="string">&quot;t&quot;</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(str)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 字典 for in，遍历是无序的</span></span><br><span class="line"><span class="keyword">let</span> dic <span class="operator">=</span> [</span><br><span class="line">    <span class="string">&quot;one&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&quot;two&quot;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&quot;three&quot;</span>: <span class="number">3</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (k, v) <span class="keyword">in</span> dic &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;key is <span class="subst">\(k)</span>, value is <span class="subst">\(v)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// stride</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">stride</span>(from: <span class="number">10</span>, through: <span class="number">0</span>, by: <span class="operator">-</span><span class="number">2</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> 10</span></span><br><span class="line"><span class="comment"> 8</span></span><br><span class="line"><span class="comment"> 6</span></span><br><span class="line"><span class="comment"> 4</span></span><br><span class="line"><span class="comment"> 2</span></span><br><span class="line"><span class="comment"> 0</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>
<h4 id="While-while-repeat-while"><a href="#While-while-repeat-while" class="headerlink" title="While while, repeat-while"></a>While while, repeat-while</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// while</span></span><br><span class="line"><span class="keyword">var</span> i1 <span class="operator">=</span> <span class="number">10</span></span><br><span class="line"><span class="keyword">while</span> i1 <span class="operator">&gt;</span> <span class="number">0</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;positive even number <span class="subst">\(i1)</span>&quot;</span>)</span><br><span class="line">    i1 <span class="operator">-=</span> <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// repeat while</span></span><br><span class="line"><span class="keyword">var</span> i2 <span class="operator">=</span> <span class="number">10</span></span><br><span class="line"><span class="keyword">repeat</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;positive even number <span class="subst">\(i2)</span>&quot;</span>)</span><br><span class="line">    i2 <span class="operator">-=</span> <span class="number">2</span></span><br><span class="line">&#125; <span class="keyword">while</span> i2 <span class="operator">&gt;</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>使用 break 结束遍历，使用 continue 跳过当前作用域，继续下个循环</p>
<h4 id="Switch"><a href="#Switch" class="headerlink" title="Switch"></a>Switch</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span>(<span class="params">pa</span>: <span class="type">String</span>, <span class="params">t</span>:(<span class="type">String</span>, <span class="type">Int</span>))</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> p1 <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> p2 <span class="operator">=</span> <span class="number">10</span></span><br><span class="line">    <span class="keyword">switch</span> pa &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;one&quot;</span>:</span><br><span class="line">        p1 <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;two&quot;</span>:</span><br><span class="line">        p1 <span class="operator">=</span> <span class="number">2</span></span><br><span class="line">        <span class="keyword">fallthrough</span> <span class="comment">// 继续到下个 case 中</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        p2 <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;p1 is <span class="subst">\(p1)</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;p2 is <span class="subst">\(p2)</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 元组</span></span><br><span class="line">    <span class="keyword">switch</span> t &#123;</span><br><span class="line">    <span class="keyword">case</span> (<span class="string">&quot;0&quot;</span>, <span class="number">0</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;zero&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> (<span class="string">&quot;1&quot;</span>, <span class="number">1</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;one&quot;</span>)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;no&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f1(pa: <span class="string">&quot;two&quot;</span>, t:(<span class="string">&quot;1&quot;</span>, <span class="number">1</span>))</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> p1 is 2</span></span><br><span class="line"><span class="comment"> p2 is 0</span></span><br><span class="line"><span class="comment"> one</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 枚举</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">E</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> one, two, three, unknown(<span class="type">String</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f2</span>(<span class="params">pa</span>: <span class="type">E</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> p: <span class="type">String</span></span><br><span class="line">    <span class="keyword">switch</span> pa &#123;</span><br><span class="line">    <span class="keyword">case</span> .one:</span><br><span class="line">        p <span class="operator">=</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">    <span class="keyword">case</span> .two:</span><br><span class="line">        p <span class="operator">=</span> <span class="string">&quot;2&quot;</span></span><br><span class="line">    <span class="keyword">case</span> .three:</span><br><span class="line">        p <span class="operator">=</span> <span class="string">&quot;3&quot;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> .unknown(u) <span class="keyword">where</span> <span class="type">Int</span>(u) <span class="operator">??</span> <span class="number">0</span> <span class="operator">&gt;</span> <span class="number">0</span> : <span class="comment">// 枚举关联值，使用 where 增加条件</span></span><br><span class="line">        p <span class="operator">=</span> u</span><br><span class="line">    <span class="keyword">case</span> .unknown(<span class="keyword">_</span>):</span><br><span class="line">        p <span class="operator">=</span> <span class="string">&quot;negative number&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">print</span>(p)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f2(pa: <span class="type">E</span>.one) <span class="comment">// 1</span></span><br><span class="line">f2(pa: <span class="type">E</span>.unknown(<span class="string">&quot;10&quot;</span>)) <span class="comment">// 10</span></span><br><span class="line">f2(pa: <span class="type">E</span>.unknown(<span class="string">&quot;-10&quot;</span>)) <span class="comment">// negative number</span></span><br></pre></td></tr></table></figure>
<h3 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h3><h4 id="数组-1-2-3"><a href="#数组-1-2-3" class="headerlink" title="数组 [1, 2, 3]"></a>数组 [1, 2, 3]</h4><p>数组是有序集合</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a0: [<span class="type">Int</span>] <span class="operator">=</span> [<span class="number">1</span>, <span class="number">10</span>]</span><br><span class="line">a0.append(<span class="number">2</span>)</span><br><span class="line">a0.remove(at: <span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(a0) <span class="comment">// [10, 2]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a1 <span class="operator">=</span> [<span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>, <span class="string">&quot;three&quot;</span>]</span><br><span class="line"><span class="keyword">let</span> a2 <span class="operator">=</span> [<span class="string">&quot;three&quot;</span>, <span class="string">&quot;four&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 找两个集合的不同</span></span><br><span class="line"><span class="keyword">let</span> dif <span class="operator">=</span> a1.difference(from: a2) <span class="comment">// swift的 diffing 算法在这 http://www.xmailserver.org/diff2.pdf swift实现在  swift/stdlib/public/core/Diffing.swift</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> dif &#123;</span><br><span class="line">    <span class="keyword">switch</span> c &#123;</span><br><span class="line">    <span class="keyword">case</span> .remove(<span class="keyword">let</span> o, <span class="keyword">let</span> e, <span class="keyword">let</span> a):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;offset:<span class="subst">\(o)</span>, element:<span class="subst">\(e)</span>, associatedWith:<span class="subst">\(String(describing: a))</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> .insert(<span class="keyword">let</span> o, <span class="keyword">let</span> e, <span class="keyword">let</span> a):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;offset:<span class="subst">\(o)</span>, element:<span class="subst">\(e)</span>, associatedWith:<span class="subst">\(String(describing: a))</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> remove offset:1, element:four, associatedWith:nil</span></span><br><span class="line"><span class="comment"> insert offset:0, element:one, associatedWith:nil</span></span><br><span class="line"><span class="comment"> insert offset:1, element:two, associatedWith:nil</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> a3 <span class="operator">=</span> a2.applying(dif) <span class="operator">??</span> [] <span class="comment">// 可以用于添加删除动画</span></span><br><span class="line"><span class="built_in">print</span>(a3) <span class="comment">// [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]</span></span><br></pre></td></tr></table></figure>
<p>dif 有第三个 case 值 .insert(let offset, let element, let associatedWith) 可以跟踪成对的变化，用于高级动画。</p>
<p>从数组中随机取一个元素<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(a0.randomElement() <span class="operator">??</span> <span class="number">0</span>)</span><br></pre></td></tr></table></figure></p>
<p>数组排序</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 排序</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S1</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> n: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> b <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a4 <span class="operator">=</span> [</span><br><span class="line">    <span class="type">S1</span>(n: <span class="number">1</span>),</span><br><span class="line">    <span class="type">S1</span>(n: <span class="number">10</span>),</span><br><span class="line">    <span class="type">S1</span>(n: <span class="number">3</span>),</span><br><span class="line">    <span class="type">S1</span>(n: <span class="number">2</span>)</span><br><span class="line">]</span><br><span class="line"><span class="keyword">let</span> a5 <span class="operator">=</span> a4.sorted &#123; i1, i2 <span class="keyword">in</span></span><br><span class="line">    i1.n <span class="operator">&lt;</span> i2.n</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> a5 &#123;</span><br><span class="line">    <span class="built_in">print</span>(n)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/// S1(n: 1)</span></span><br><span class="line"><span class="comment">/// S1(n: 2)</span></span><br><span class="line"><span class="comment">/// S1(n: 3)</span></span><br><span class="line"><span class="comment">/// S1(n: 10)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a6 <span class="operator">=</span> [<span class="number">1</span>,<span class="number">10</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">2</span>]</span><br><span class="line"><span class="built_in">print</span>(a6.sorted(by: <span class="operator">&gt;</span>)) <span class="comment">// [10, 7, 4, 2, 1]</span></span><br></pre></td></tr></table></figure>
<p>可以加到数组扩展中，通过扩展约束能够指定特定元素类型的排序，代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Array</span> <span class="title">where</span> <span class="title">Element</span> == <span class="title">Int</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 升序</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">intSortedASC</span>()</span> -&gt; [<span class="type">Int</span>] &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.sorted(by: <span class="operator">&lt;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 降序</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">intSortedDESC</span>()</span> -&gt; [<span class="type">Int</span>] &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.sorted(by: <span class="operator">&lt;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(a6.intSortedASC()) <span class="comment">// 使用扩展增加自定义排序能力</span></span><br></pre></td></tr></table></figure>
<p>在数组中检索满足条件的元素，代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一个满足条件了就返回</span></span><br><span class="line"><span class="keyword">let</span> a7 <span class="operator">=</span> a4.first &#123;</span><br><span class="line">    <span class="variable">$0</span>.n <span class="operator">==</span> <span class="number">10</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(a7<span class="operator">?</span>.n <span class="operator">??</span> <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 是否都满足了条件</span></span><br><span class="line"><span class="built_in">print</span>(a4.allSatisfy &#123; <span class="variable">$0</span>.n <span class="operator">==</span> <span class="number">1</span> &#125;) <span class="comment">// false</span></span><br><span class="line"><span class="built_in">print</span>(a4.allSatisfy(\.b)) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 找出最大的那个</span></span><br><span class="line"><span class="built_in">print</span>(a4.max(by: &#123; e1, e2 <span class="keyword">in</span></span><br><span class="line">    e1.n <span class="operator">&lt;</span> e2.n</span><br><span class="line">&#125;) <span class="operator">??</span> <span class="type">S1</span>(n: <span class="number">0</span>))</span><br><span class="line"><span class="comment">// S1(n: 10, b: true)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 看看是否包含某个元素</span></span><br><span class="line"><span class="built_in">print</span>(a4.contains(where: &#123;</span><br><span class="line">    <span class="variable">$0</span>.n <span class="operator">==</span> <span class="number">7</span></span><br><span class="line">&#125;))</span><br><span class="line"><span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p>一些切割数组的方法。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 切片</span></span><br><span class="line"><span class="comment">// 取前3个，并不是直接复制，对于大的数组有性能优势。</span></span><br><span class="line"><span class="built_in">print</span>(a6[<span class="operator">..&lt;</span><span class="number">3</span>]) <span class="comment">// [1, 10, 4] 需要做越界检查</span></span><br><span class="line"><span class="built_in">print</span>(a6.prefix(<span class="number">30</span>)) <span class="comment">// [1, 10, 4, 7, 2] 不需要做越界检查，也是切片，性能一样</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 去掉前3个</span></span><br><span class="line"><span class="built_in">print</span>(a6.dropFirst(<span class="number">3</span>)) <span class="comment">// [7, 2]</span></span><br></pre></td></tr></table></figure>
<p>prefix(while:) 和 drop(while:) 方法，顺序遍历执行闭包里的逻辑判断，满足条件就返回，遇到不匹配就会停止遍历。prefix 返回满足条件的元素集合，drop 返回停止遍历之后那些元素集合。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a8 <span class="operator">=</span> [<span class="number">8</span>, <span class="number">9</span>, <span class="number">20</span>, <span class="number">1</span>, <span class="number">35</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">let</span> a9 <span class="operator">=</span> a8.prefix &#123;</span><br><span class="line">    <span class="variable">$0</span> <span class="operator">&lt;</span> <span class="number">30</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(a9) <span class="comment">// [8, 9, 20, 1]</span></span><br><span class="line"><span class="keyword">let</span> a10 <span class="operator">=</span> a8.drop &#123;</span><br><span class="line">    <span class="variable">$0</span> <span class="operator">&lt;</span> <span class="number">30</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(a10) <span class="comment">// [35, 3]</span></span><br></pre></td></tr></table></figure>
<p>比 filter 更高效的删除元素的方法 removeAll</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除所有不满足条件的元素</span></span><br><span class="line"><span class="keyword">var</span> a11 <span class="operator">=</span> [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">12</span>, <span class="number">25</span>]</span><br><span class="line">a11.removeAll &#123; <span class="variable">$0</span> <span class="operator">&lt;</span> <span class="number">10</span> &#125;</span><br><span class="line"><span class="built_in">print</span>(a11) <span class="comment">// [4, 3, 1, 3, 3] 随机</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建未初始化的数组</span></span><br><span class="line"><span class="keyword">let</span> a12 <span class="operator">=</span> (<span class="number">0</span><span class="operator">...</span><span class="number">4</span>).map &#123; <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">    <span class="type">Int</span>.random(in: <span class="number">0</span><span class="operator">...</span><span class="number">5</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(a12) <span class="comment">// [0, 3, 3, 2, 5] 随机</span></span><br></pre></td></tr></table></figure>
<p>#if 用于后缀表达式</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// #if 用于后缀表达式</span></span><br><span class="line"><span class="keyword">let</span> a13 <span class="operator">=</span> a11</span><br><span class="line"><span class="keyword">#if</span> os(iOS)</span><br><span class="line">    .count</span><br><span class="line"><span class="keyword">#else</span></span><br><span class="line">    .reduce(<span class="number">0</span>, <span class="operator">+</span>)</span><br><span class="line"><span class="keyword">#endif</span></span><br><span class="line"><span class="built_in">print</span>(a13) <span class="comment">//37</span></span><br></pre></td></tr></table></figure>
<h4 id="Sets-Set"><a href="#Sets-Set" class="headerlink" title="Sets Set"></a>Sets Set<Int></h4><p>Set 是无序集合，元素唯一</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s0: <span class="type">Set</span>&lt;<span class="type">Int</span>&gt; <span class="operator">=</span> [<span class="number">2</span>, <span class="number">4</span>]</span><br><span class="line"><span class="keyword">let</span> s1: <span class="type">Set</span> <span class="operator">=</span> [<span class="number">2</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">8</span>]</span><br><span class="line"><span class="keyword">let</span> s2: <span class="type">Set</span> <span class="operator">=</span> [<span class="number">7</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">10</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> s3 <span class="operator">=</span> s1.union(s2) <span class="comment">// 合集</span></span><br><span class="line"><span class="keyword">let</span> s4 <span class="operator">=</span> s1.intersection(s2) <span class="comment">// 交集</span></span><br><span class="line"><span class="keyword">let</span> s5 <span class="operator">=</span> s1.subtracting(s2) <span class="comment">// 非交集部分</span></span><br><span class="line"><span class="keyword">let</span> s6 <span class="operator">=</span> s1.symmetricDifference(s2) <span class="comment">// 非交集的合集</span></span><br><span class="line"><span class="built_in">print</span>(s3) <span class="comment">// [4, 2, 1, 7, 3, 10, 8, 9, 6, 5]</span></span><br><span class="line"><span class="built_in">print</span>(s4) <span class="comment">// [10]</span></span><br><span class="line"><span class="built_in">print</span>(s5) <span class="comment">// [8, 4, 2, 6]</span></span><br><span class="line"><span class="built_in">print</span>(s6) <span class="comment">// [9, 1, 3, 4, 5, 2, 6, 8, 7]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// s0 是否被 s1 包含</span></span><br><span class="line"><span class="built_in">print</span>(s0.isSubset(of: s1)) <span class="comment">// true</span></span><br><span class="line"><span class="comment">// s1 是否包含了 s0</span></span><br><span class="line"><span class="built_in">print</span>(s1.isSuperset(of: s0)) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> s7: <span class="type">Set</span> <span class="operator">=</span> [<span class="number">3</span>, <span class="number">5</span>]</span><br><span class="line"><span class="comment">// s0 和 s7 是否有交集</span></span><br><span class="line"><span class="built_in">print</span>(s0.isDisjoint(with: s7)) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 可变 Set</span></span><br><span class="line"><span class="keyword">var</span> s8: <span class="type">Set</span> <span class="operator">=</span> [<span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>]</span><br><span class="line">s8.insert(<span class="string">&quot;three&quot;</span>)</span><br><span class="line">s8.remove(<span class="string">&quot;one&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(s8) <span class="comment">// [&quot;two&quot;, &quot;three&quot;]</span></span><br></pre></td></tr></table></figure>
<h4 id="字典"><a href="#字典" class="headerlink" title="字典 [:]"></a>字典 [:]</h4><p>字典是无序集合，键值对应。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> d1 <span class="operator">=</span> [</span><br><span class="line">    <span class="string">&quot;k1&quot;</span>: <span class="string">&quot;v1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;k2&quot;</span>: <span class="string">&quot;v2&quot;</span></span><br><span class="line">]</span><br><span class="line">d1[<span class="string">&quot;k3&quot;</span>] <span class="operator">=</span> <span class="string">&quot;v3&quot;</span></span><br><span class="line">d1[<span class="string">&quot;k4&quot;</span>] <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(d1) <span class="comment">// [&quot;k2&quot;: &quot;v2&quot;, &quot;k3&quot;: &quot;v3&quot;, &quot;k1&quot;: &quot;v1&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (k, v) <span class="keyword">in</span> d1 &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;key is <span class="subst">\(k)</span>, value is <span class="subst">\(v)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> key is k1, value is v1</span></span><br><span class="line"><span class="comment"> key is k2, value is v2</span></span><br><span class="line"><span class="comment"> key is k3, value is v3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> d1.isEmpty <span class="operator">==</span> <span class="literal">false</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(d1.count) <span class="comment">// 3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// mapValues</span></span><br><span class="line"><span class="keyword">let</span> d2 <span class="operator">=</span> d1.mapValues &#123;</span><br><span class="line">    <span class="variable">$0</span> <span class="operator">+</span> <span class="string">&quot;_new&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(d2) <span class="comment">// [&quot;k2&quot;: &quot;v2_new&quot;, &quot;k3&quot;: &quot;v3_new&quot;, &quot;k1&quot;: &quot;v1_new&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 对字典的值或键进行分组</span></span><br><span class="line"><span class="keyword">let</span> d3 <span class="operator">=</span> <span class="type">Dictionary</span>(grouping: d1.values) &#123;</span><br><span class="line">    <span class="variable">$0</span>.count</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(d3) <span class="comment">// [2: [&quot;v1&quot;, &quot;v2&quot;, &quot;v3&quot;]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 从字典中取值，如果键对应无值，则使用通过 default 指定的默认值</span></span><br><span class="line">d1[<span class="string">&quot;k5&quot;</span>, <span class="keyword">default</span>: <span class="string">&quot;whatever&quot;</span>] <span class="operator">+=</span> <span class="string">&quot;.&quot;</span></span><br><span class="line"><span class="built_in">print</span>(d1[<span class="string">&quot;k5&quot;</span>] <span class="operator">??</span> <span class="string">&quot;&quot;</span>) <span class="comment">// whatever.</span></span><br><span class="line"><span class="keyword">let</span> v1 <span class="operator">=</span> d1[<span class="string">&quot;k3&quot;</span>, <span class="keyword">default</span>: <span class="string">&quot;whatever&quot;</span>]</span><br><span class="line"><span class="built_in">print</span>(v1) <span class="comment">// v3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// compactMapValues() 对字典值进行转换和解包。可以解可选类型，并去掉 nil 值</span></span><br><span class="line"><span class="keyword">let</span> d4 <span class="operator">=</span> [</span><br><span class="line">    <span class="string">&quot;k1&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&quot;k2&quot;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&quot;k3&quot;</span>: <span class="literal">nil</span></span><br><span class="line">]</span><br><span class="line"><span class="keyword">let</span> d5 <span class="operator">=</span> d4.mapValues &#123; <span class="variable">$0</span> &#125;</span><br><span class="line"><span class="keyword">let</span> d6 <span class="operator">=</span> d4.compactMapValues&#123; <span class="variable">$0</span> &#125;</span><br><span class="line"><span class="built_in">print</span>(d5)</span><br><span class="line"><span class="comment">// [&quot;k3&quot;: nil, &quot;k1&quot;: Optional(1), &quot;k2&quot;: Optional(2)]</span></span><br><span class="line"><span class="built_in">print</span>(d6)</span><br><span class="line"><span class="comment">// [&quot;k1&quot;: 1, &quot;k2&quot;: 2]</span></span><br></pre></td></tr></table></figure>
<h3 id="操作符"><a href="#操作符" class="headerlink" title="操作符"></a>操作符</h3><h4 id="赋值"><a href="#赋值" class="headerlink" title="赋值 =, +=. -=, *=, /="></a>赋值 =, +=. -=, *=, /=</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> i1 <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">var</span> i2 <span class="operator">=</span> i1</span><br><span class="line">i2 <span class="operator">=</span> <span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(i2) <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">i2 <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(i2) <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line">i2 <span class="operator">-=</span> <span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(i2) <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">i2 <span class="operator">*=</span> <span class="number">10</span></span><br><span class="line"><span class="built_in">print</span>(i2) <span class="comment">// 10</span></span><br><span class="line"></span><br><span class="line">i2 <span class="operator">/=</span> <span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(i2) <span class="comment">// 5</span></span><br></pre></td></tr></table></figure>
<h4 id="计算符"><a href="#计算符" class="headerlink" title="计算符 +, -, *, /, %"></a>计算符 +, -, *, /, %</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> i1 <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> i2 <span class="operator">=</span> i1</span><br><span class="line"><span class="built_in">print</span>((i1 <span class="operator">+</span> i2 <span class="operator">-</span> <span class="number">1</span>) <span class="operator">*</span> <span class="number">10</span> <span class="operator">/</span> <span class="number">2</span> <span class="operator">%</span> <span class="number">3</span>) <span class="comment">// 2</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;i&quot;</span> <span class="operator">+</span> <span class="string">&quot;1&quot;</span>) <span class="comment">// i1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 一元运算符</span></span><br><span class="line"><span class="built_in">print</span>(<span class="operator">-</span>i1) <span class="comment">// -1</span></span><br></pre></td></tr></table></figure>
<h4 id="比较运算符-gt"><a href="#比较运算符-gt" class="headerlink" title="比较运算符 ==, &gt;"></a>比较运算符 ==, &gt;</h4><p>遵循 Equatable 协议可以使用 == 和 != 来判断是否相等</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="number">1</span> <span class="operator">&gt;</span> <span class="number">2</span>) <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span>: <span class="title">Equatable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p1: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> p2: <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> s1 <span class="operator">=</span> <span class="type">S</span>(p1: <span class="string">&quot;one&quot;</span>, p2: <span class="number">1</span>)</span><br><span class="line"><span class="keyword">let</span> s2 <span class="operator">=</span> <span class="type">S</span>(p1: <span class="string">&quot;two&quot;</span>, p2: <span class="number">2</span>)</span><br><span class="line"><span class="keyword">let</span> s3 <span class="operator">=</span> <span class="type">S</span>(p1: <span class="string">&quot;one&quot;</span>, p2: <span class="number">2</span>)</span><br><span class="line"><span class="keyword">let</span> s4 <span class="operator">=</span> <span class="type">S</span>(p1: <span class="string">&quot;one&quot;</span>, p2: <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(s1 <span class="operator">==</span> s2) <span class="comment">// false</span></span><br><span class="line"><span class="built_in">print</span>(s1 <span class="operator">==</span> s3) <span class="comment">// false</span></span><br><span class="line"><span class="built_in">print</span>(s1 <span class="operator">==</span> s4) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>类需要实现 == 函数</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>: <span class="title">Equatable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p1: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> p2: <span class="type">Int</span></span><br><span class="line">    <span class="function"><span class="keyword">init</span>(<span class="params">p1</span>: <span class="type">String</span>, <span class="params">p2</span>: <span class="type">Int</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.p1 <span class="operator">=</span> p1</span><br><span class="line">        <span class="keyword">self</span>.p2 <span class="operator">=</span> p2</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">==</span> (<span class="params">l</span>: <span class="type">C</span>, <span class="params">r</span>: <span class="type">C</span>)</span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> l.p1 <span class="operator">==</span> r.p1 <span class="operator">&amp;&amp;</span> l.p2 <span class="operator">==</span> r.p2</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> c1 <span class="operator">=</span> <span class="type">C</span>(p1: <span class="string">&quot;one&quot;</span>, p2: <span class="number">1</span>)</span><br><span class="line"><span class="keyword">let</span> c2 <span class="operator">=</span> <span class="type">C</span>(p1: <span class="string">&quot;one&quot;</span>, p2: <span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(c1 <span class="operator">==</span> c2)</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 元组比较</span></span><br><span class="line"><span class="comment">// 会先比较第一个数，第一个无法比较才会比较第二个数</span></span><br><span class="line"><span class="comment">// 字符串比较和字母大小还有长度有关。先比较字母大小，在比较长度</span></span><br><span class="line">(<span class="string">&quot;apple&quot;</span>, <span class="number">1</span>) <span class="operator">&lt;</span> (<span class="string">&quot;apple&quot;</span>, <span class="number">2</span>) <span class="comment">// true</span></span><br><span class="line">(<span class="string">&quot;applf&quot;</span>, <span class="number">1</span>) <span class="operator">&lt;</span> (<span class="string">&quot;apple&quot;</span>, <span class="number">2</span>) <span class="comment">// false</span></span><br><span class="line">(<span class="string">&quot;appl&quot;</span>, <span class="number">2</span>) <span class="operator">&lt;</span> (<span class="string">&quot;apple&quot;</span>, <span class="number">1</span>) <span class="comment">// true</span></span><br><span class="line">(<span class="string">&quot;appm&quot;</span>, <span class="number">2</span>) <span class="operator">&lt;</span> (<span class="string">&quot;apple&quot;</span>, <span class="number">1</span>) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h4 id="三元"><a href="#三元" class="headerlink" title="三元  ?  : _"></a>三元 <em> ? </em> : _</h4><p>简化 if else 写法</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// if else</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span>(<span class="params">p</span>: <span class="type">Int</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> p <span class="operator">&gt;</span> <span class="number">0</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;positive number&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;negative number&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 三元</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f2</span>(<span class="params">p</span>: <span class="type">Int</span>)</span> &#123;</span><br><span class="line">    p <span class="operator">&gt;</span> <span class="number">0</span> <span class="operator">?</span> <span class="built_in">print</span>(<span class="string">&quot;positive number&quot;</span>) : <span class="built_in">print</span>(<span class="string">&quot;negative number&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f1(p: <span class="number">1</span>)</span><br><span class="line">f2(p: <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Nil-coalescing"><a href="#Nil-coalescing" class="headerlink" title="Nil-coalescing ??"></a>Nil-coalescing ??</h4><p>简化 if let else 写法</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// if else</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span>(<span class="params">p</span>: <span class="type">Int</span>?)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> i <span class="operator">=</span> p &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;p have value is <span class="subst">\(i)</span>&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;p is nil, use defalut value&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 ??</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f2</span>(<span class="params">p</span>: <span class="type">Int</span>?)</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> i <span class="operator">=</span> p <span class="operator">??</span> <span class="number">0</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;p is <span class="subst">\(i)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="范围-a…b"><a href="#范围-a…b" class="headerlink" title="范围 a…b"></a>范围 a…b</h4><p>简化的值范围表达方式。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 封闭范围</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">...</span><span class="number">10</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 半开范围</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span><span class="number">10</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 单侧区间</span></span><br><span class="line"><span class="keyword">let</span> nums <span class="operator">=</span> [<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>]</span><br><span class="line"><span class="built_in">print</span>(nums[<span class="number">2</span><span class="operator">...</span>]) <span class="comment">// 7 8</span></span><br></pre></td></tr></table></figure>
<h4 id="逻辑-amp-amp"><a href="#逻辑-amp-amp" class="headerlink" title="逻辑 !, &amp;&amp;, ||"></a>逻辑 !, &amp;&amp;, ||</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> i1 <span class="operator">=</span> <span class="operator">-</span><span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> i2 <span class="operator">=</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> i1 <span class="operator">!=</span> i2 <span class="operator">&amp;&amp;</span> (i1 <span class="operator">&lt;</span> <span class="number">0</span> <span class="operator">||</span> i2 <span class="operator">&lt;</span> <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;i1 and i2 not equal, and one of them is negative number.&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="恒等"><a href="#恒等" class="headerlink" title="恒等 ===, !=="></a>恒等 ===, !==</h4><p>恒等返回是否引用了相同实例。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p: <span class="type">String</span></span><br><span class="line">    <span class="function"><span class="keyword">init</span>(<span class="params">p</span>: <span class="type">String</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.p <span class="operator">=</span> p</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> c1 <span class="operator">=</span> <span class="type">C</span>(p: <span class="string">&quot;one&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> c2 <span class="operator">=</span> <span class="type">C</span>(p: <span class="string">&quot;one&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> c3 <span class="operator">=</span> c1</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(c1 <span class="operator">===</span> c2) <span class="comment">// false</span></span><br><span class="line"><span class="built_in">print</span>(c1 <span class="operator">===</span> c3) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">print</span>(c1 <span class="operator">!==</span> c2) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h4 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h4><p>位运算符</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> i1: <span class="type">UInt8</span> <span class="operator">=</span> <span class="number">0b00001111</span></span><br><span class="line"><span class="keyword">let</span> i2 <span class="operator">=</span> <span class="operator">~</span>i1 <span class="comment">// Bitwise NOT Operator（按位取反运算符），取反</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> i3: <span class="type">UInt8</span> <span class="operator">=</span> <span class="number">0b00111111</span></span><br><span class="line"><span class="keyword">let</span> i4 <span class="operator">=</span> i1 <span class="operator">&amp;</span> i3 <span class="comment">// Bitwise AND Operator（按位与运算符），都为1才是1</span></span><br><span class="line"><span class="keyword">let</span> i5 <span class="operator">=</span> i1 <span class="operator">|</span> i3 <span class="comment">// Bitwise OR Operator（按位或运算符），有一个1就是1</span></span><br><span class="line"><span class="keyword">let</span> i6 <span class="operator">=</span> i1 <span class="operator">^</span> i3 <span class="comment">// Bitwise XOR Operator（按位异或运算符），不同为1，相同为0</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(i1,i2,i3,i4,i5,i6)</span><br><span class="line"></span><br><span class="line"><span class="comment">// &lt;&lt; 按位左移，&gt;&gt; 按位右移</span></span><br><span class="line"><span class="keyword">let</span> i7 <span class="operator">=</span> i1 <span class="operator">&lt;&lt;</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> i8 <span class="operator">=</span> i1 <span class="operator">&gt;&gt;</span> <span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(i7,i8)</span><br></pre></td></tr></table></figure>
<p>溢出运算符，有 &amp;+、&amp;- 和 &amp;*</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i1 <span class="operator">=</span> <span class="type">Int</span>.max</span><br><span class="line"><span class="built_in">print</span>(i1) <span class="comment">// 9223372036854775807</span></span><br><span class="line">i1 <span class="operator">=</span> i1 <span class="operator">&amp;+</span> <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(i1) <span class="comment">// -9223372036854775808</span></span><br><span class="line">i1 <span class="operator">=</span> i1 <span class="operator">&amp;+</span> <span class="number">10</span></span><br><span class="line"><span class="built_in">print</span>(i1) <span class="comment">// -9223372036854775798</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> i2 <span class="operator">=</span> <span class="type">UInt</span>.max</span><br><span class="line">i2 <span class="operator">=</span> i2 <span class="operator">&amp;+</span> <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(i2) <span class="comment">// 0</span></span><br></pre></td></tr></table></figure>
<p>运算符函数包括前缀运算符、后缀运算符、复合赋值运算符以及等价运算符。另，还可以自定义运算符，新的运算符要用 operator 关键字进行定义，同时要指定 prefix、infix 或者 postfix 修饰符。</p>
<h3 id="基础库"><a href="#基础库" class="headerlink" title="基础库"></a>基础库</h3><h4 id="时间"><a href="#时间" class="headerlink" title="时间"></a>时间</h4><p>Date 的基本用法如下：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> now <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Date 转 时间戳</span></span><br><span class="line"><span class="keyword">let</span> interval <span class="operator">=</span> now.timeIntervalSince1970 <span class="comment">// 时间戳</span></span><br><span class="line"><span class="keyword">let</span> df <span class="operator">=</span> <span class="type">DateFormatter</span>()</span><br><span class="line">df.dateFormat <span class="operator">=</span> <span class="string">&quot;yyyy 年 MM 月 dd 日 HH:mm:ss&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;时间戳：<span class="subst">\(Int(interval))</span>&quot;</span>) <span class="comment">// 时间戳：1642399901</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;格式化的时间：&quot;</span> <span class="operator">+</span> df.string(from: now)) <span class="comment">// 格式化的时间：2022 年 01 月 17 日 14:11:41</span></span><br><span class="line">df.dateStyle <span class="operator">=</span> .short</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;short 样式时间：&quot;</span> <span class="operator">+</span> df.string(from: now)) <span class="comment">// short 样式时间：2022/1/17</span></span><br><span class="line">df.locale <span class="operator">=</span> <span class="type">Locale</span>(identifier: <span class="string">&quot;zh_Hans_CN&quot;</span>)</span><br><span class="line">df.dateStyle <span class="operator">=</span> .full</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;full 样式时间：&quot;</span> <span class="operator">+</span> df.string(from: now)) <span class="comment">// full 样式时间：2022年1月17日 星期一</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 时间戳转 Date</span></span><br><span class="line"><span class="keyword">let</span> date <span class="operator">=</span> <span class="type">Date</span>(timeIntervalSince1970: interval)</span><br><span class="line"><span class="built_in">print</span>(date) <span class="comment">// 2022-01-17 06:11:41 +0000</span></span><br></pre></td></tr></table></figure></p>
<p>复杂的时间操作，比如说 GitHub 接口使用的是 ISO 标准，RSS 输出的是 RSS 标准字符串，不同标准对应不同时区的时间计算处理，可以使用开源库  <a target="_blank" rel="noopener" href="https://github.com/malcommac/SwiftDate">SwiftDate</a>  来完成。示例代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftDate</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 SwiftDate 库</span></span><br><span class="line"><span class="keyword">let</span> cn <span class="operator">=</span> <span class="type">Region</span>(zone: <span class="type">Zones</span>.asiaShanghai, locale: <span class="type">Locales</span>.chineseChina)</span><br><span class="line"><span class="type">SwiftDate</span>.defaultRegion <span class="operator">=</span> cn</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;2008-02-14 23:12:14&quot;</span>.toDate()<span class="operator">?</span>.year <span class="operator">??</span> <span class="string">&quot;&quot;</span>) <span class="comment">// 2008</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> d1 <span class="operator">=</span> <span class="string">&quot;2022-01-17T23:20:35&quot;</span>.toISODate(region: cn)</span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> d1 <span class="operator">=</span> d1 <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(d1.minute) <span class="comment">// 20</span></span><br><span class="line"><span class="keyword">let</span> d2 <span class="operator">=</span> d1 <span class="operator">+</span> <span class="number">1</span>.minutes</span><br><span class="line"><span class="built_in">print</span>(d2.minute)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 两个 DateInRegion 相差时间 interval</span></span><br><span class="line"><span class="keyword">let</span> i1 <span class="operator">=</span> <span class="type">DateInRegion</span>(<span class="type">Date</span>(), region: cn) <span class="operator">-</span> d1</span><br><span class="line"><span class="keyword">let</span> s1 <span class="operator">=</span> i1.toString &#123;</span><br><span class="line">    <span class="variable">$0</span>.maximumUnitCount <span class="operator">=</span> <span class="number">4</span></span><br><span class="line">    <span class="variable">$0</span>.allowedUnits <span class="operator">=</span> [.day, .hour, .minute]</span><br><span class="line">    <span class="variable">$0</span>.collapsesLargestUnit <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">    <span class="variable">$0</span>.unitsStyle <span class="operator">=</span> .abbreviated</span><br><span class="line">    <span class="variable">$0</span>.locale <span class="operator">=</span> <span class="type">Locales</span>.chineseChina</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(s1) <span class="comment">// 9小时45分钟</span></span><br></pre></td></tr></table></figure>
<h4 id="格式化"><a href="#格式化" class="headerlink" title="格式化"></a>格式化</h4><p>使用标准库的格式来描述不同场景的情况可以不用去考虑由于不同地区的区别，这些在标准库里就可以自动完成了。</p>
<p>描述两个时间之间相差多长时间<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 计算两个时间之间相差多少时间，支持多种语言字符串</span></span><br><span class="line"><span class="keyword">let</span> d1 <span class="operator">=</span> <span class="type">Date</span>().timeIntervalSince1970 <span class="operator">-</span> <span class="number">60</span> <span class="operator">*</span> <span class="number">60</span> <span class="operator">*</span> <span class="number">24</span></span><br><span class="line"><span class="keyword">let</span> f1 <span class="operator">=</span> <span class="type">RelativeDateTimeFormatter</span>()</span><br><span class="line">f1.dateTimeStyle <span class="operator">=</span> .named</span><br><span class="line">f1.formattingContext <span class="operator">=</span> .beginningOfSentence</span><br><span class="line">f1.locale <span class="operator">=</span> <span class="type">Locale</span>(identifier: <span class="string">&quot;zh_Hans_CN&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> str <span class="operator">=</span> f1.localizedString(for: <span class="type">Date</span>(timeIntervalSince1970: d1), relativeTo: <span class="type">Date</span>())</span><br><span class="line"><span class="built_in">print</span>(str) <span class="comment">// 昨天</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 简写</span></span><br><span class="line"><span class="keyword">let</span> str2 <span class="operator">=</span> <span class="type">Date</span>.now.addingTimeInterval(<span class="operator">-</span>(<span class="number">60</span> <span class="operator">*</span> <span class="number">60</span> <span class="operator">*</span> <span class="number">24</span>))</span><br><span class="line">    .formatted(.relative(presentation: .named))</span><br><span class="line"><span class="built_in">print</span>(str2) <span class="comment">// yesterday</span></span><br></pre></td></tr></table></figure></p>
<p>描述多个事物<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 描述多个事物</span></span><br><span class="line"><span class="keyword">let</span> s1 <span class="operator">=</span> <span class="type">ListFormatter</span>.localizedString(byJoining: [<span class="string">&quot;冬天&quot;</span>,<span class="string">&quot;春天&quot;</span>,<span class="string">&quot;夏天&quot;</span>,<span class="string">&quot;秋天&quot;</span>])</span><br><span class="line"><span class="built_in">print</span>(s1)</span><br></pre></td></tr></table></figure></p>
<p>描述名字<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 名字</span></span><br><span class="line"><span class="keyword">let</span> f2 <span class="operator">=</span> <span class="type">PersonNameComponentsFormatter</span>()</span><br><span class="line"><span class="keyword">var</span> nc1 <span class="operator">=</span> <span class="type">PersonNameComponents</span>()</span><br><span class="line">nc1.familyName <span class="operator">=</span> <span class="string">&quot;戴&quot;</span></span><br><span class="line">nc1.givenName <span class="operator">=</span> <span class="string">&quot;铭&quot;</span></span><br><span class="line">nc1.nickname <span class="operator">=</span> <span class="string">&quot;铭哥&quot;</span></span><br><span class="line"><span class="built_in">print</span>(f2.string(from: nc1)) <span class="comment">// 戴铭</span></span><br><span class="line">f2.style <span class="operator">=</span> .short</span><br><span class="line"><span class="built_in">print</span>(f2.string(from: nc1)) <span class="comment">// 铭哥</span></span><br><span class="line">f2.style <span class="operator">=</span> .abbreviated</span><br><span class="line"><span class="built_in">print</span>(f2.string(from: nc1)) <span class="comment">// 戴</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> nc2 <span class="operator">=</span> <span class="type">PersonNameComponents</span>()</span><br><span class="line">nc2.familyName <span class="operator">=</span> <span class="string">&quot;Dai&quot;</span></span><br><span class="line">nc2.givenName <span class="operator">=</span> <span class="string">&quot;Ming&quot;</span></span><br><span class="line">nc2.nickname <span class="operator">=</span> <span class="string">&quot;Starming&quot;</span></span><br><span class="line">f2.style <span class="operator">=</span> .default</span><br><span class="line"><span class="built_in">print</span>(f2.string(from: nc2)) <span class="comment">// Ming Dai</span></span><br><span class="line">f2.style <span class="operator">=</span> .short</span><br><span class="line"><span class="built_in">print</span>(f2.string(from: nc2)) <span class="comment">// Starming</span></span><br><span class="line">f2.style <span class="operator">=</span> .abbreviated</span><br><span class="line"><span class="built_in">print</span>(f2.string(from: nc2)) <span class="comment">// MD</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 取出名</span></span><br><span class="line"><span class="keyword">let</span> componets <span class="operator">=</span> f2.personNameComponents(from: <span class="string">&quot;戴铭&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(componets<span class="operator">?</span>.givenName <span class="operator">??</span> <span class="string">&quot;&quot;</span>) <span class="comment">// 铭</span></span><br></pre></td></tr></table></figure></p>
<p>描述数字<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数字</span></span><br><span class="line"><span class="keyword">let</span> f3 <span class="operator">=</span> <span class="type">NumberFormatter</span>()</span><br><span class="line">f3.locale <span class="operator">=</span> <span class="type">Locale</span>(identifier: <span class="string">&quot;zh_Hans_CN&quot;</span>)</span><br><span class="line">f3.numberStyle <span class="operator">=</span> .currency</span><br><span class="line"><span class="built_in">print</span>(f3.string(from: <span class="number">123456</span>) <span class="operator">??</span> <span class="string">&quot;&quot;</span>) <span class="comment">// ¥123,456.00</span></span><br><span class="line">f3.numberStyle <span class="operator">=</span> .percent</span><br><span class="line"><span class="built_in">print</span>(f3.string(from: <span class="number">123456</span>) <span class="operator">??</span> <span class="string">&quot;&quot;</span>) <span class="comment">// 12,345,600%</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> n1 <span class="operator">=</span> <span class="number">1.23456</span></span><br><span class="line"><span class="keyword">let</span> n1Str <span class="operator">=</span> n1.formatted(.number.precision(.fractionLength(<span class="number">3</span>)).rounded())</span><br><span class="line"><span class="built_in">print</span>(n1Str) <span class="comment">// 1.235</span></span><br></pre></td></tr></table></figure></p>
<p>描述地址<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 地址</span></span><br><span class="line"><span class="keyword">import</span> Contacts</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> f4 <span class="operator">=</span> <span class="type">CNPostalAddressFormatter</span>()</span><br><span class="line"><span class="keyword">let</span> address <span class="operator">=</span> <span class="type">CNMutablePostalAddress</span>()</span><br><span class="line">address.street <span class="operator">=</span> <span class="string">&quot;海淀区王庄路XX号院X号楼X门XXX&quot;</span></span><br><span class="line">address.postalCode <span class="operator">=</span> <span class="string">&quot;100083&quot;</span></span><br><span class="line">address.city <span class="operator">=</span> <span class="string">&quot;北京&quot;</span></span><br><span class="line">address.country <span class="operator">=</span> <span class="string">&quot;中国&quot;</span></span><br><span class="line"><span class="built_in">print</span>(f4.string(from: address))</span><br><span class="line"><span class="comment">/// 海淀区王庄路XX号院X号楼X门XXX</span></span><br><span class="line"><span class="comment">/// 北京 100083</span></span><br><span class="line"><span class="comment">/// 中国</span></span><br></pre></td></tr></table></figure></p>
<h4 id="度量值"><a href="#度量值" class="headerlink" title="度量值"></a>度量值</h4><p>标准库里的物理量，在这个文档里有详细列出，包括角度、平方米等。<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 参考：https://developer.apple.com/documentation/foundation/nsdimension</span></span><br><span class="line"><span class="keyword">let</span> m1 <span class="operator">=</span> <span class="type">Measurement</span>(value: <span class="number">1</span>, unit: <span class="type">UnitLength</span>.kilometers)</span><br><span class="line"><span class="keyword">let</span> m2 <span class="operator">=</span> m1.converted(to: .meters) <span class="comment">// 千米转米</span></span><br><span class="line"><span class="built_in">print</span>(m2) <span class="comment">// 1000.0 m</span></span><br><span class="line"><span class="comment">// 度量值转为本地化的值</span></span><br><span class="line"><span class="keyword">let</span> mf <span class="operator">=</span> <span class="type">MeasurementFormatter</span>()</span><br><span class="line">mf.locale <span class="operator">=</span> <span class="type">Locale</span>(identifier: <span class="string">&quot;zh_Hans_CN&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(mf.string(from: m1)) <span class="comment">// 1公里</span></span><br></pre></td></tr></table></figure></p>
<p>一些物理公式供参考：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">面积 = 长度 × 长度</span><br><span class="line">体积 = 长度 × 长度 × 长度 = 面积 × 长度</span><br><span class="line"></span><br><span class="line">速度=长度/时间</span><br><span class="line">加速度=速度/时间</span><br><span class="line"></span><br><span class="line">力 = 质量 × 加速度</span><br><span class="line">扭矩 = 力 × 长度</span><br><span class="line">压力 = 力 / 面积</span><br><span class="line"></span><br><span class="line">密度=质量 / 体积</span><br><span class="line">能量 = 功率 × 时间</span><br><span class="line">电阻 = 电压 / 电流</span><br></pre></td></tr></table></figure></p>
<h4 id="Data"><a href="#Data" class="headerlink" title="Data"></a>Data</h4><p>数据压缩和解压<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对数据的压缩</span></span><br><span class="line"><span class="keyword">let</span> d1 <span class="operator">=</span> <span class="string">&quot;看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？&quot;</span>.data(using: .utf8)<span class="operator">!</span> <span class="keyword">as</span> <span class="type">NSData</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;ori <span class="subst">\(d1.count)</span> bytes&quot;</span>)</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="comment">/// 压缩算法</span></span><br><span class="line">    <span class="comment">/// * lz4</span></span><br><span class="line">    <span class="comment">/// * lzma</span></span><br><span class="line">    <span class="comment">/// * zlib</span></span><br><span class="line">    <span class="comment">/// * lzfse</span></span><br><span class="line">    <span class="keyword">let</span> compressed <span class="operator">=</span> <span class="keyword">try</span> d1.compressed(using: .zlib)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;comp <span class="subst">\(compressed.count)</span> bytes&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 对数据解压</span></span><br><span class="line">    <span class="keyword">let</span> decomressed <span class="operator">=</span> <span class="keyword">try</span> compressed.decompressed(using: .zlib)</span><br><span class="line">    <span class="keyword">let</span> deStr <span class="operator">=</span> <span class="type">String</span>(data: decomressed <span class="keyword">as</span> <span class="type">Data</span>, encoding: .utf8)</span><br><span class="line">    <span class="built_in">print</span>(deStr <span class="operator">??</span> <span class="string">&quot;&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;&#125;</span><br><span class="line"><span class="comment">/// ori 297 bytes</span></span><br><span class="line"><span class="comment">/// comp 37 bytes</span></span><br></pre></td></tr></table></figure></p>
<h4 id="文件"><a href="#文件" class="headerlink" title="文件"></a>文件</h4><p>文件的一些基本操作的代码如下：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> path1 <span class="operator">=</span> <span class="string">&quot;/Users/mingdai/Downloads/1.html&quot;</span></span><br><span class="line"><span class="keyword">let</span> path2 <span class="operator">=</span> <span class="string">&quot;/Users/mingdai/Documents/GitHub/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> u1 <span class="operator">=</span> <span class="type">URL</span>(string: path1)</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="comment">// 写入</span></span><br><span class="line">    <span class="keyword">let</span> url1 <span class="operator">=</span> <span class="keyword">try</span> <span class="type">FileManager</span>.default.url(for: .itemReplacementDirectory, in: .userDomainMask, appropriateFor: u1, create: <span class="literal">true</span>) <span class="comment">// 保证原子性安全保存</span></span><br><span class="line">    <span class="built_in">print</span>(url1)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取</span></span><br><span class="line">    <span class="keyword">let</span> s1 <span class="operator">=</span> <span class="keyword">try</span> <span class="type">String</span>(contentsOfFile: path1, encoding: .utf8)</span><br><span class="line">    <span class="built_in">print</span>(s1)</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查路径是否可用</span></span><br><span class="line"><span class="keyword">let</span> u2 <span class="operator">=</span> <span class="type">URL</span>(fileURLWithPath:path2)</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> values <span class="operator">=</span> <span class="keyword">try</span> u2.resourceValues(forKeys: [.volumeAvailableCapacityForImportantUsageKey])</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> capacity <span class="operator">=</span> values.volumeAvailableCapacityForImportantUsage &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;可用: <span class="subst">\(capacity)</span>&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;不可用&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;错误: <span class="subst">\(error.localizedDescription)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>怎么遍历多级目录结构中的文件呢？看下面的代码的实现：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 遍历路径下所有目录</span></span><br><span class="line"><span class="keyword">let</span> u3 <span class="operator">=</span> <span class="type">URL</span>(fileURLWithPath: <span class="type">FileManager</span>.default.currentDirectoryPath)</span><br><span class="line"><span class="keyword">let</span> fm <span class="operator">=</span> <span class="type">FileManager</span>.default</span><br><span class="line">fm.enumerator(atPath: u3.path)<span class="operator">?</span>.forEach(&#123; path <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> path <span class="operator">=</span> path <span class="keyword">as?</span> <span class="type">String</span> <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> url <span class="operator">=</span> <span class="type">URL</span>(fileURLWithPath: path, relativeTo: u3)</span><br><span class="line">    <span class="built_in">print</span>(url.lastPathComponent)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>可以使用 FileWrapper 来创建文件夹和文件。举个例子：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// FileWrapper 的使用</span></span><br><span class="line"><span class="comment">// 创建文件</span></span><br><span class="line"><span class="keyword">let</span> f1 <span class="operator">=</span> <span class="type">FileWrapper</span>(regularFileWithContents: <span class="type">Data</span>(<span class="string">&quot;# 第 n 个文件<span class="subst">\n</span> ## 标题&quot;</span>.utf8))</span><br><span class="line">f1.fileAttributes[<span class="type">FileAttributeKey</span>.creationDate.rawValue] <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line">f1.fileAttributes[<span class="type">FileAttributeKey</span>.modificationDate.rawValue] <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line"><span class="comment">// 创建文件夹</span></span><br><span class="line"><span class="keyword">let</span> folder1 <span class="operator">=</span> <span class="type">FileWrapper</span>(directoryWithFileWrappers: [</span><br><span class="line">    <span class="string">&quot;file1.md&quot;</span>: f1</span><br><span class="line">])</span><br><span class="line">folder1.fileAttributes[<span class="type">FileAttributeKey</span>.creationDate.rawValue] <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line">folder1.fileAttributes[<span class="type">FileAttributeKey</span>.modificationDate.rawValue] <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> folder1.write(</span><br><span class="line">        to: <span class="type">URL</span>(fileURLWithPath: <span class="type">FileManager</span>.default.currentDirectoryPath).appendingPathComponent(<span class="string">&quot;NewFolder&quot;</span>),</span><br><span class="line">        options: .atomic,</span><br><span class="line">        originalContentsURL: <span class="literal">nil</span></span><br><span class="line">    )</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="type">FileManager</span>.default.currentDirectoryPath)</span><br></pre></td></tr></table></figure></p>
<p>上面代码写起来比较繁琐，对 FileWrapper 更好的封装可以参考这篇文章《 <a target="_blank" rel="noopener" href="https://heberti.com/posts/filewrapper/">A Type-Safe FileWrapper | Heberti Almeida</a> 》。</p>
<p>文件读写处理完整能力可以参看这个库  <a target="_blank" rel="noopener" href="https://github.com/JohnSundell/Files">GitHub - JohnSundell/Files: A nicer way to handle files &amp; folders in Swift</a> </p>
<p>本地或者网络上，比如网盘和FTP的文件发生变化时，怎样知道能够观察到呢？</p>
<p>通过 HTTPHeader 里的 If-Modified-Since、Last-Modified、If-None-Match 和 Etag 等字段来判断文件的变化，本地则是使用 DispatchSource.makeFileSystemObjectSource 来进行的文件变化监听。可以参考  <a target="_blank" rel="noopener" href="https://github.com/krzysztofzablocki/KZFileWatchers">KZFileWatchers</a>  库的做法。</p>
<h4 id="Scanner"><a href="#Scanner" class="headerlink" title="Scanner"></a>Scanner</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s1 <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">one1,</span></span><br><span class="line"><span class="string">two2,</span></span><br><span class="line"><span class="string">three3.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">let</span> sn1 <span class="operator">=</span> <span class="type">Scanner</span>(string: s1)</span><br><span class="line"><span class="keyword">while</span> <span class="operator">!</span>sn1.isAtEnd &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> r1 <span class="operator">=</span> sn1.scanUpToCharacters(from: .newlines) &#123;</span><br><span class="line">        <span class="built_in">print</span>(r1 <span class="keyword">as</span> <span class="type">String</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/// one1,</span></span><br><span class="line"><span class="comment">/// two2,</span></span><br><span class="line"><span class="comment">/// three3.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 找出数字</span></span><br><span class="line"><span class="keyword">let</span> sn2 <span class="operator">=</span> <span class="type">Scanner</span>(string: s1)</span><br><span class="line">sn2.charactersToBeSkipped <span class="operator">=</span> <span class="type">CharacterSet</span>.decimalDigits.inverted <span class="comment">// 不是数字的就跳过</span></span><br><span class="line"><span class="keyword">var</span> p: <span class="type">Int</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="operator">!</span>sn2.isAtEnd &#123;</span><br><span class="line">    <span class="keyword">if</span> sn2.scanInt(<span class="operator">&amp;</span>p) &#123;</span><br><span class="line">        <span class="built_in">print</span>(p)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/// 1</span></span><br><span class="line"><span class="comment">/// 2</span></span><br><span class="line"><span class="comment">/// 3</span></span><br></pre></td></tr></table></figure>
<p>上面的代码还不是那么 Swifty，可以通过用AnySequence和AnyIterator来包装下，将序列中的元素推迟到实际需要时再来处理，这样性能也会更好些。具体实现可以参看《 <a target="_blank" rel="noopener" href="https://www.swiftbysundell.com/articles/string-parsing-in-swift/">String parsing in Swift</a> 》这篇文章。</p>
<h4 id="AttributeString"><a href="#AttributeString" class="headerlink" title="AttributeString"></a>AttributeString</h4><p>效果如下：</p>
<p><img src="https://user-images.githubusercontent.com/251980/150132322-20c5c2d4-6452-4d06-9202-4b93cffd8133.png" alt=""></p>
<p>代码如下：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> aStrs <span class="operator">=</span> [<span class="type">AttributedString</span>]()</span><br><span class="line"><span class="keyword">var</span> aStr1 <span class="operator">=</span> <span class="type">AttributedString</span>(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">标题</span></span><br><span class="line"><span class="string">正文内容，具体查看链接。</span></span><br><span class="line"><span class="string">这里摘出第一个重点，还要强调的内容。</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>)</span><br><span class="line"><span class="comment">// 标题</span></span><br><span class="line"><span class="keyword">let</span> title <span class="operator">=</span> aStr1.range(of: <span class="string">&quot;标题&quot;</span>)</span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> title <span class="operator">=</span> title <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> aStrs</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c1 <span class="operator">=</span> <span class="type">AttributeContainer</span>() <span class="comment">// 可复用容器</span></span><br><span class="line">c1.inlinePresentationIntent <span class="operator">=</span> .stronglyEmphasized</span><br><span class="line">c1.font <span class="operator">=</span> .largeTitle</span><br><span class="line">aStr1[title].setAttributes(c1)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 链接</span></span><br><span class="line"><span class="keyword">let</span> link <span class="operator">=</span> aStr1.range(of: <span class="string">&quot;链接&quot;</span>)</span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> link <span class="operator">=</span> link <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> aStrs</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c2 <span class="operator">=</span> <span class="type">AttributeContainer</span>() <span class="comment">// 链接</span></span><br><span class="line">c2.strokeColor <span class="operator">=</span> .blue</span><br><span class="line">c2.link <span class="operator">=</span> <span class="type">URL</span>(string: <span class="string">&quot;https://ming1016.github.io/&quot;</span>)</span><br><span class="line">aStr1[link].setAttributes(c2.merging(c1)) <span class="comment">// 合并 AttributeContainer</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Runs</span></span><br><span class="line"><span class="keyword">let</span> i1 <span class="operator">=</span> aStr1.range(of: <span class="string">&quot;重点&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> i2 <span class="operator">=</span> aStr1.range(of: <span class="string">&quot;强调&quot;</span>)</span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> i1 <span class="operator">=</span> i1, <span class="keyword">let</span> i2 <span class="operator">=</span> i2 <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> aStrs</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c3 <span class="operator">=</span> <span class="type">AttributeContainer</span>()</span><br><span class="line">c3.foregroundColor <span class="operator">=</span> .yellow</span><br><span class="line">c3.inlinePresentationIntent <span class="operator">=</span> .stronglyEmphasized</span><br><span class="line">aStr1[i1].setAttributes(c3)</span><br><span class="line">aStr1[i2].setAttributes(c3)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> r <span class="keyword">in</span> aStr1.runs &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;-------------&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(r.attributes)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">aStrs.append(aStr1)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Markdown</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> aStr2 <span class="operator">=</span> <span class="keyword">try</span> <span class="type">AttributedString</span>(markdown: <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    内容[链接](https://ming1016.github.io/)。需要**强调**的内容。</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    aStrs.append(aStr2)</span><br><span class="line">    </span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;&#125;</span><br></pre></td></tr></table></figure></p>
<p>SwiftUI 的 Text 可以直接读取 AttributedString 来进行显示。</p>
<h4 id="随机"><a href="#随机" class="headerlink" title="随机"></a>随机</h4><p>用法：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ri <span class="operator">=</span> <span class="type">Int</span>.random(in: <span class="number">0</span><span class="operator">..&lt;</span><span class="number">10</span>)</span><br><span class="line"><span class="built_in">print</span>(ri) <span class="comment">// 0到10随机数</span></span><br><span class="line"><span class="keyword">let</span> a <span class="operator">=</span> [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="built_in">print</span>(a.randomElement() <span class="operator">??</span> <span class="number">0</span>) <span class="comment">// 数组中随机取个数</span></span><br><span class="line"><span class="built_in">print</span>(a.shuffled()) <span class="comment">// 随机打乱数组顺序</span></span><br></pre></td></tr></table></figure></p>
<h4 id="UserDefaults"><a href="#UserDefaults" class="headerlink" title="UserDefaults"></a>UserDefaults</h4><p>使用方法如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">UDKey</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> k1 <span class="operator">=</span> <span class="string">&quot;token&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> ud <span class="operator">=</span> <span class="type">UserDefaults</span>.standard</span><br><span class="line">ud.set(<span class="string">&quot;xxxxxx&quot;</span>, forKey: <span class="type">UDKey</span>.k1)</span><br><span class="line"><span class="keyword">let</span> tk <span class="operator">=</span> ud.string(forKey: <span class="type">UDKey</span>.k1)</span><br><span class="line"><span class="built_in">print</span>(tk <span class="operator">??</span> <span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="模式"><a href="#模式" class="headerlink" title="模式"></a>模式</h3><h4 id="单例"><a href="#单例" class="headerlink" title="单例"></a>单例</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> shared <span class="operator">=</span> <span class="type">S</span>()</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">init</span>()</span> &#123;</span><br><span class="line">        <span class="comment">// 防止实例初始化</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="系统及设备"><a href="#系统及设备" class="headerlink" title="系统及设备"></a>系统及设备</h3><h4 id="系统判断"><a href="#系统判断" class="headerlink" title="系统判断"></a>系统判断</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">#if</span> os(tvOS)</span><br><span class="line">     <span class="comment">// do something in tvOS</span></span><br><span class="line"><span class="keyword">#elseif</span> os(iOS)</span><br><span class="line">     <span class="comment">// do somthing in iOS</span></span><br><span class="line"><span class="keyword">#elseif</span> os(macOS)</span><br><span class="line">    <span class="comment">// do somthing in macOS</span></span><br><span class="line"><span class="keyword">#endif</span></span><br></pre></td></tr></table></figure>
<h4 id="版本兼容"><a href="#版本兼容" class="headerlink" title="版本兼容"></a>版本兼容</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 版本</span></span><br><span class="line"><span class="keyword">@available</span>(<span class="keyword">iOS</span> <span class="number">15</span>, <span class="operator">*</span>)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span>()</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 版本检查</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">#available</span>(<span class="keyword">iOS</span> <span class="number">15</span>, <span class="keyword">macOS</span> <span class="number">12</span>, <span class="operator">*</span>) &#123;</span><br><span class="line">    f()</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// nothing happen</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="canImport-判断库是否可使用"><a href="#canImport-判断库是否可使用" class="headerlink" title="canImport 判断库是否可使用"></a>canImport 判断库是否可使用</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">#if</span> canImport(<span class="type">SpriteKit</span>)</span><br><span class="line">   <span class="comment">// iOS 等苹果系统执行</span></span><br><span class="line"><span class="keyword">#else</span></span><br><span class="line">   <span class="comment">// 非苹果系统</span></span><br><span class="line"><span class="keyword">#endif</span></span><br></pre></td></tr></table></figure>
<h4 id="targetEnvironment-环境的判断"><a href="#targetEnvironment-环境的判断" class="headerlink" title="targetEnvironment 环境的判断"></a>targetEnvironment 环境的判断</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">#if</span> targetEnvironment(simulator)</span><br><span class="line">   <span class="comment">// 模拟器</span></span><br><span class="line"><span class="keyword">#else</span></span><br><span class="line">   <span class="comment">// 真机</span></span><br><span class="line"><span class="keyword">#endif</span></span><br></pre></td></tr></table></figure>
<h3 id="自带属性包装"><a href="#自带属性包装" class="headerlink" title="自带属性包装"></a>自带属性包装</h3><h4 id="resultBuilder"><a href="#resultBuilder" class="headerlink" title="@resultBuilder"></a>@resultBuilder</h4><p>结果生成器（Result builders），通过传递序列创建新值，SwiftUI就是使用的结果生成器将多个视图生成一个视图</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@resultBuilder</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">RBS</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 基本闭包支持</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">buildBlock</span>(<span class="keyword">_</span> <span class="params">components</span>: <span class="type">Int</span>...)</span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        components.reduce(<span class="number">0</span>) &#123; partialResult, i <span class="keyword">in</span></span><br><span class="line">            partialResult <span class="operator">+</span> i</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 支持条件判断</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">buildEither</span>(<span class="params">first</span> <span class="params">component</span>: <span class="type">Int</span>)</span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        component</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">buildEither</span>(<span class="params">second</span> <span class="params">component</span>: <span class="type">Int</span>)</span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        component</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 支持循环</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">buildArray</span>(<span class="keyword">_</span> <span class="params">components</span>: [<span class="type">Int</span>])</span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        components.reduce(<span class="number">0</span>) &#123; partialResult, i <span class="keyword">in</span></span><br><span class="line">            partialResult <span class="operator">+</span> i</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a <span class="operator">=</span> <span class="type">RBS</span>.buildBlock(</span><br><span class="line">    <span class="number">1</span>,</span><br><span class="line">    <span class="number">2</span>,</span><br><span class="line">    <span class="number">3</span></span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(a) <span class="comment">// 6</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 应用到函数中</span></span><br><span class="line"><span class="meta">@RBS</span> <span class="function"><span class="keyword">func</span> <span class="title">f1</span>()</span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="number">1</span></span><br><span class="line">    <span class="number">2</span></span><br><span class="line">    <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(f1()) <span class="comment">// 6</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置了 buildEither 就可以在闭包中进行条件判断。</span></span><br><span class="line"><span class="meta">@RBS</span> <span class="function"><span class="keyword">func</span> <span class="title">f2</span>(<span class="params">stopAtThree</span>: <span class="type">Bool</span>)</span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="number">1</span></span><br><span class="line">    <span class="number">2</span></span><br><span class="line">    <span class="number">3</span></span><br><span class="line">    <span class="keyword">if</span> stopAtThree <span class="operator">==</span> <span class="literal">true</span> &#123;</span><br><span class="line">        <span class="number">0</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="number">4</span></span><br><span class="line">        <span class="number">5</span></span><br><span class="line">        <span class="number">6</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(f2(stopAtThree: <span class="literal">false</span>)) <span class="comment">// 21</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置了 buildArray 就可以在闭包内使用循环了</span></span><br><span class="line"><span class="meta">@RBS</span> <span class="function"><span class="keyword">func</span> <span class="title">f3</span>()</span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span><span class="operator">...</span><span class="number">3</span> &#123;</span><br><span class="line">        i <span class="operator">*</span> <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(f3()) <span class="comment">// 12</span></span><br></pre></td></tr></table></figure>
<h4 id="dynamicMemberLookup-动态成员查询"><a href="#dynamicMemberLookup-动态成员查询" class="headerlink" title="@dynamicMemberLookup 动态成员查询"></a>@dynamicMemberLookup 动态成员查询</h4><p>@dynamicMemberLookup 指示访问属性时调用一个已实现的处理动态查找的下标方法 subscript(dynamicMemeber:)，通过指定属性字符串名返回值。使用方法如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@dynamicMemberLookup</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">D</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 找字符串</span></span><br><span class="line">    <span class="function"><span class="keyword">subscript</span>(<span class="params">dynamicMember</span> <span class="params">m</span>: <span class="type">String</span>)</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> p <span class="operator">=</span> [<span class="string">&quot;one&quot;</span>: <span class="string">&quot;first&quot;</span>, <span class="string">&quot;two&quot;</span>: <span class="string">&quot;second&quot;</span>]</span><br><span class="line">        <span class="keyword">return</span> p[m, <span class="keyword">default</span>: <span class="string">&quot;&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 找整型</span></span><br><span class="line">    <span class="function"><span class="keyword">subscript</span>(<span class="params">dynamicMember</span> <span class="params">m</span>: <span class="type">String</span>)</span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> p <span class="operator">=</span> [<span class="string">&quot;one&quot;</span>: <span class="number">1</span>, <span class="string">&quot;two&quot;</span>: <span class="number">2</span>]</span><br><span class="line">        <span class="keyword">return</span> p[m, <span class="keyword">default</span>: <span class="number">0</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 找闭包</span></span><br><span class="line">    <span class="function"><span class="keyword">subscript</span>(<span class="params">dynamicMember</span> <span class="params">m</span>: <span class="type">String</span>)</span> -&gt; (<span class="keyword">_</span> s: <span class="type">String</span>) -&gt; <span class="type">Void</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;show <span class="subst">\(<span class="variable">$0</span>)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 静态数组成员</span></span><br><span class="line">    <span class="keyword">var</span> p <span class="operator">=</span> [<span class="string">&quot;This is a member&quot;</span>]</span><br><span class="line">    <span class="comment">// 动态数组成员</span></span><br><span class="line">    <span class="function"><span class="keyword">subscript</span>(<span class="params">dynamicMember</span> <span class="params">m</span>: <span class="type">String</span>)</span> -&gt; [<span class="type">String</span>] &#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&quot;This is a dynamic member&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> d <span class="operator">=</span> <span class="type">D</span>()</span><br><span class="line"><span class="keyword">let</span> s1: <span class="type">String</span> <span class="operator">=</span> d.one</span><br><span class="line"><span class="built_in">print</span>(s1) <span class="comment">// first</span></span><br><span class="line"><span class="keyword">let</span> i1: <span class="type">Int</span> <span class="operator">=</span> d.one</span><br><span class="line"><span class="built_in">print</span>(i1) <span class="comment">// 1</span></span><br><span class="line">d.show(<span class="string">&quot;something&quot;</span>) <span class="comment">// show something</span></span><br><span class="line"><span class="built_in">print</span>(d.p) <span class="comment">// [&quot;This is a member&quot;]</span></span><br><span class="line"><span class="keyword">let</span> dynamicP:[<span class="type">String</span>] <span class="operator">=</span> d.dp</span><br><span class="line"><span class="built_in">print</span>(dynamicP) <span class="comment">// [&quot;This is a dynamic member&quot;]</span></span><br></pre></td></tr></table></figure>
<p>类使用 @dynamicMemberLookup，继承的类也会自动加上 @dynamicMemberLookup。协议上定义 @dynamicMemberLookup，通过扩展可以默认实现 subscript(dynamicMember:) 方法。</p>
<h4 id="dynamicCallable-动态可调用类型"><a href="#dynamicCallable-动态可调用类型" class="headerlink" title="@dynamicCallable 动态可调用类型"></a>@dynamicCallable 动态可调用类型</h4><p>@dynamicCallable 动态可调用类型。通过实现 dynamicallyCall 方法来定义变参的处理。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@dynamicCallable</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">D</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 带参数说明</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">dynamicallyCall</span>(<span class="params">withKeywordArguments</span> <span class="params">args</span>: <span class="type">KeyValuePairs</span>&lt;<span class="type">String</span>, <span class="type">Int</span>&gt;)</span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> firstArg <span class="operator">=</span> args.first<span class="operator">?</span>.value <span class="operator">??</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> firstArg <span class="operator">*</span> <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 无参数说明</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">dynamicallyCall</span>(<span class="params">withArguments</span> <span class="params">args</span>: [<span class="type">String</span>])</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> firstArg <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> args.count <span class="operator">&gt;</span> <span class="number">0</span> &#123;</span><br><span class="line">            firstArg <span class="operator">=</span> args[<span class="number">0</span>]</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;show <span class="subst">\(firstArg)</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> d <span class="operator">=</span> <span class="type">D</span>()</span><br><span class="line"><span class="keyword">let</span> i <span class="operator">=</span> d(numberIs: <span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(i) <span class="comment">// 4</span></span><br><span class="line"><span class="keyword">let</span> s <span class="operator">=</span> d(<span class="string">&quot;hi&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(s) <span class="comment">// show hi</span></span><br></pre></td></tr></table></figure>
<h3 id="自带协议"><a href="#自带协议" class="headerlink" title="自带协议"></a>自带协议</h3><h4 id="Hashable"><a href="#Hashable" class="headerlink" title="Hashable"></a>Hashable</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">H</span>: <span class="title">Hashable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p1: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> p2: <span class="type">Int</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 提供随机 seed</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">hash</span>(<span class="params">into</span> <span class="params">hasher</span>: <span class="keyword">inout</span> <span class="type">Hasher</span>)</span> &#123;</span><br><span class="line">        hasher.combine(p1)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> h1 <span class="operator">=</span> <span class="type">H</span>(p1: <span class="string">&quot;one&quot;</span>, p2: <span class="number">1</span>)</span><br><span class="line"><span class="keyword">let</span> h2 <span class="operator">=</span> <span class="type">H</span>(p1: <span class="string">&quot;two&quot;</span>, p2: <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> hs1 <span class="operator">=</span> <span class="type">Hasher</span>()</span><br><span class="line">hs1.combine(h1)</span><br><span class="line">hs1.combine(h2)</span><br><span class="line"><span class="built_in">print</span>(h1.hashValue) <span class="comment">// 7417088153212460033 随机值</span></span><br><span class="line"><span class="built_in">print</span>(h2.hashValue) <span class="comment">// -6972912482785541972 随机值</span></span><br><span class="line"><span class="built_in">print</span>(hs1.finalize()) <span class="comment">// 7955861102637572758 随机值</span></span><br><span class="line"><span class="built_in">print</span>(h1.hashValue) <span class="comment">// 7417088153212460033 和前面 h1 一样</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> h3 <span class="operator">=</span> <span class="type">H</span>(p1: <span class="string">&quot;one&quot;</span>, p2: <span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(h3.hashValue) <span class="comment">// 7417088153212460033 和前面 h1 一样</span></span><br><span class="line"><span class="keyword">var</span> hs2 <span class="operator">=</span> <span class="type">Hasher</span>()</span><br><span class="line">hs2.combine(h3)</span><br><span class="line">hs2.combine(h2)</span><br><span class="line"><span class="built_in">print</span>(hs2.finalize()) <span class="comment">// 7955861102637572758 和前面 hs1 一样</span></span><br></pre></td></tr></table></figure>
<p>应用生命周期内，调用 combine() 添加相同属性哈希值相同，由于 Hasher 每次都会使用随机的 seed，因此不同应用生命周期，也就是下次启动的哈希值，就会和上次的哈希值不同。</p>
<h3 id="Codable"><a href="#Codable" class="headerlink" title="Codable"></a>Codable</h3><h4 id="JSON-没有-id-字段"><a href="#JSON-没有-id-字段" class="headerlink" title="JSON 没有 id 字段"></a>JSON 没有 id 字段</h4><p>如果SwiftUI要求数据Model都是遵循Identifiable协议的，而有的json没有id这个字段，可以使用扩展struct的方式解决：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CommitModel</span>: <span class="title">Decodable</span>, <span class="title">Hashable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> sha: <span class="type">String</span></span><br><span class="line">  <span class="keyword">var</span> author: <span class="type">AuthorModel</span></span><br><span class="line">  <span class="keyword">var</span> commit: <span class="type">CommitModel</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">CommitModel</span>: <span class="title">Identifiable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> id: <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> sha</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h3><h4 id="网络状态检查"><a href="#网络状态检查" class="headerlink" title="网络状态检查"></a>网络状态检查</h4><p>通过 Network 库的 NWPathMonitor 来检查</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"><span class="keyword">import</span> Network</span><br><span class="line"></span><br><span class="line"><span class="comment">// 网络状态检查 network state check</span></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Nsck</span>: <span class="title">ObservableObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> shared <span class="operator">=</span> <span class="type">Nsck</span>()</span><br><span class="line">    <span class="keyword">private(set)</span> <span class="keyword">lazy</span> <span class="keyword">var</span> pb <span class="operator">=</span> mkpb()</span><br><span class="line">    <span class="meta">@Published</span> <span class="keyword">private(set)</span> <span class="keyword">var</span> pt: <span class="type">NWPath</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> monitor: <span class="type">NWPathMonitor</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">var</span> sj <span class="operator">=</span> <span class="type">CurrentValueSubject</span>&lt;<span class="type">NWPath</span>, <span class="type">Never</span>&gt;(monitor.currentPath)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> sb: <span class="type">AnyCancellable</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">init</span>()</span> &#123;</span><br><span class="line">        monitor <span class="operator">=</span> <span class="type">NWPathMonitor</span>()</span><br><span class="line">        pt <span class="operator">=</span> monitor.currentPath</span><br><span class="line">        monitor.pathUpdateHandler <span class="operator">=</span> &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] path <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span><span class="operator">?</span>.pt <span class="operator">=</span> path</span><br><span class="line">            <span class="keyword">self</span><span class="operator">?</span>.sj.send(path)</span><br><span class="line">        &#125;</span><br><span class="line">        monitor.start(queue: <span class="type">DispatchQueue</span>.global())</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        monitor.cancel()</span><br><span class="line">        sj.send(completion: .finished)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">mkpb</span>()</span> -&gt; <span class="type">AnyPublisher</span>&lt;<span class="type">NWPath</span>, <span class="type">Never</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> sj.eraseToAnyPublisher()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用方法</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sb <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line"><span class="keyword">var</span> alertMsg <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="type">Nsck</span>.shared.pb</span><br><span class="line">    .sink &#123; <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125; receiveValue: &#123; path <span class="keyword">in</span></span><br><span class="line">        alertMsg <span class="operator">=</span> path.debugDescription</span><br><span class="line">        <span class="keyword">switch</span> path.status &#123;</span><br><span class="line">        <span class="keyword">case</span> .satisfied:</span><br><span class="line">            alertMsg <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">case</span> .unsatisfied:</span><br><span class="line">            alertMsg <span class="operator">=</span> <span class="string">&quot;😱&quot;</span></span><br><span class="line">        <span class="keyword">case</span> .requiresConnection:</span><br><span class="line">            alertMsg <span class="operator">=</span> <span class="string">&quot;🥱&quot;</span></span><br><span class="line">        <span class="keyword">@unknown</span> <span class="keyword">default</span>:</span><br><span class="line">            alertMsg <span class="operator">=</span> <span class="string">&quot;🤔&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> path.status <span class="operator">==</span> .unsatisfied &#123;</span><br><span class="line">            <span class="keyword">switch</span> path.unsatisfiedReason &#123;</span><br><span class="line">            <span class="keyword">case</span> .notAvailable:</span><br><span class="line">                alertMsg <span class="operator">+=</span> <span class="string">&quot;网络不可用&quot;</span></span><br><span class="line">            <span class="keyword">case</span> .cellularDenied:</span><br><span class="line">                alertMsg <span class="operator">+=</span> <span class="string">&quot;蜂窝网不可用&quot;</span></span><br><span class="line">            <span class="keyword">case</span> .wifiDenied:</span><br><span class="line">                alertMsg <span class="operator">+=</span> <span class="string">&quot;Wifi不可用&quot;</span></span><br><span class="line">            <span class="keyword">case</span> .localNetworkDenied:</span><br><span class="line">                alertMsg <span class="operator">+=</span> <span class="string">&quot;网线不可用&quot;</span></span><br><span class="line">            <span class="keyword">@unknown</span> <span class="keyword">default</span>:</span><br><span class="line">                alertMsg <span class="operator">+=</span> <span class="string">&quot;网络不可用&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    .store(in: <span class="operator">&amp;</span>sb)</span><br></pre></td></tr></table></figure>
<h3 id="动画"><a href="#动画" class="headerlink" title="动画"></a>动画</h3><h4 id="布局动画"><a href="#布局动画" class="headerlink" title="布局动画"></a>布局动画</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AnimateLayout</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line"> <span class="meta">@State</span> <span class="keyword">var</span> changeLayout: <span class="type">Bool</span> <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line"> <span class="meta">@Namespace</span> <span class="keyword">var</span> namespace</span><br><span class="line"></span><br><span class="line"> <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">  <span class="type">VStack</span>(spacing: <span class="number">30</span>) &#123;</span><br><span class="line">   <span class="keyword">if</span> changeLayout &#123;</span><br><span class="line">    <span class="type">HStack</span> &#123; items &#125;</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="type">VStack</span> &#123; items &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="type">Button</span>(<span class="string">&quot;切换布局&quot;</span>) &#123;</span><br><span class="line">    withAnimation &#123; changeLayout.toggle() &#125;</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  .padding()</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@ViewBuilder</span> <span class="keyword">var</span> items: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">  <span class="type">Text</span>(<span class="string">&quot;one&quot;</span>)</span><br><span class="line">   .matchedGeometryEffect(id: <span class="string">&quot;one&quot;</span>, in: namespace)</span><br><span class="line">  <span class="type">Text</span>(<span class="string">&quot;Two&quot;</span>)</span><br><span class="line">   .matchedGeometryEffect(id: <span class="string">&quot;Two&quot;</span>, in: namespace)</span><br><span class="line">  <span class="type">Text</span>(<span class="string">&quot;Three&quot;</span>)</span><br><span class="line">   .matchedGeometryEffect(id: <span class="string">&quot;Three&quot;</span>, in: namespace)</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h3><h4 id="Keychain"><a href="#Keychain" class="headerlink" title="Keychain"></a>Keychain</h4><p>使用方法：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> d1 <span class="operator">=</span> <span class="type">Data</span>(<span class="string">&quot;keyChain github token&quot;</span>.utf8)</span><br><span class="line"><span class="keyword">let</span> service <span class="operator">=</span> <span class="string">&quot;access-token&quot;</span></span><br><span class="line"><span class="keyword">let</span> account <span class="operator">=</span> <span class="string">&quot;github&quot;</span></span><br><span class="line"><span class="keyword">let</span> q1 <span class="operator">=</span> [</span><br><span class="line">    kSecValueData: d1,</span><br><span class="line">    kSecClass: kSecClassGenericPassword,</span><br><span class="line">    kSecAttrService: service,</span><br><span class="line">    kSecAttrAccount: account</span><br><span class="line">] <span class="keyword">as</span> <span class="type">CFDictionary</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加一个 keychain</span></span><br><span class="line"><span class="keyword">let</span> status <span class="operator">=</span> <span class="type">SecItemAdd</span>(q1, <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果已经添加过会抛出 -25299 错误代码，需要调用 SecItemUpdate 来进行更新</span></span><br><span class="line"><span class="keyword">if</span> status <span class="operator">==</span> errSecDuplicateItem &#123;</span><br><span class="line">    <span class="keyword">let</span> q2 <span class="operator">=</span> [</span><br><span class="line">        kSecClass: kSecClassGenericPassword,</span><br><span class="line">        kSecAttrService: service,</span><br><span class="line">        kSecAttrAccount: account</span><br><span class="line">    ] <span class="keyword">as</span> <span class="type">CFDictionary</span></span><br><span class="line">    <span class="keyword">let</span> q3 <span class="operator">=</span> [</span><br><span class="line">        kSecValueData: d1</span><br><span class="line">    ] <span class="keyword">as</span> <span class="type">CFDictionary</span></span><br><span class="line">    <span class="type">SecItemUpdate</span>(q2, q3)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取</span></span><br><span class="line"><span class="keyword">let</span> q4 <span class="operator">=</span> [</span><br><span class="line">    kSecAttrService: service,</span><br><span class="line">    kSecAttrAccount: account,</span><br><span class="line">    kSecClass: kSecClassGenericPassword,</span><br><span class="line">    kSecReturnData: <span class="literal">true</span></span><br><span class="line">] <span class="keyword">as</span> <span class="type">CFDictionary</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> re: <span class="type">AnyObject</span>?</span><br><span class="line"><span class="type">SecItemCopyMatching</span>(q4, <span class="operator">&amp;</span>re)</span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> reData <span class="operator">=</span> re <span class="keyword">as?</span> <span class="type">Data</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="type">String</span>(decoding: reData, as: <span class="type">UTF8</span>.<span class="keyword">self</span>)) <span class="comment">// keyChain github token</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除</span></span><br><span class="line"><span class="keyword">let</span> q5 <span class="operator">=</span> [</span><br><span class="line">    kSecAttrService: service,</span><br><span class="line">    kSecAttrAccount: account,</span><br><span class="line">    kSecClass: kSecClassGenericPassword,</span><br><span class="line">] <span class="keyword">as</span> <span class="type">CFDictionary</span></span><br><span class="line"></span><br><span class="line"><span class="type">SecItemDelete</span>(q5)</span><br></pre></td></tr></table></figure></p>
<h3 id="工程"><a href="#工程" class="headerlink" title="工程"></a>工程</h3><h4 id="程序入口点"><a href="#程序入口点" class="headerlink" title="程序入口点"></a>程序入口点</h4><p>Swift 允许全局编写 Swift 代码，实际上 clang 会自动将代码包进一个模拟 C 的函数中。Swift 也能够指定入口点，比如 @UIApplicationMain 或 @NSApplicationMain，UIKit 启动后生命周期管理是 AppDelegate 和 SceneDelegate，《 <a target="_blank" rel="noopener" href="https://www.donnywals.com/understanding-the-ios-13-scene-delegate/">Understanding the iOS 13 Scene Delegate</a> 》这篇有详细介绍。</p>
<p>@UIApplicationMain 和 @NSApplicationMain 会自动生成入口点。这些入口点都是平台相关的，Swift 发展来看是多平台的，这样在 Swift 5.3 时引入了 @main，可以方便的指定入口点。代码如下：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@main</span> <span class="comment">// 要定义个静态的 main 函数</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">M</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">main</span>()</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;let&#x27;s begin&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p> <a target="_blank" rel="noopener" href="https://github.com/apple/swift-argument-parser">ArgumentParser</a>  库，Swift 官方开源的一个开发命令行工具的库，也支持 @main。使用方法如下：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ArgumentParser</span><br><span class="line"></span><br><span class="line"><span class="keyword">@main</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">C</span>: <span class="title">ParsableCommand</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Argument</span>(help: <span class="string">&quot;Start&quot;</span>)</span><br><span class="line">  <span class="keyword">var</span> phrase: <span class="type">String</span></span><br><span class="line">   </span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">run</span>()</span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">_</span> <span class="keyword">in</span> <span class="number">1</span><span class="operator">...</span><span class="number">5</span> &#123;</span><br><span class="line">      <span class="built_in">print</span>(phrase)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="专题"><a href="#专题" class="headerlink" title="专题"></a>专题</h2><h3 id="Swift-那些事"><a href="#Swift-那些事" class="headerlink" title="Swift 那些事"></a>Swift 那些事</h3><h4 id="Swift-各版本演进"><a href="#Swift-各版本演进" class="headerlink" title="Swift 各版本演进"></a>Swift 各版本演进</h4><p><em>Swift 1.1</em></p>
<ul>
<li>countElements() 改成了 count()。</li>
<li>@NSApplicationMain 可以在 macOS 上使用。</li>
</ul>
<p><em>Swift 1.2</em></p>
<ul>
<li>引入 Set 类型。</li>
<li>if let 可以放到一起，使用逗号分隔。</li>
<li>新增 zip() 和 flatMap()。</li>
<li>类增加静态方法和静态属性，使用 static 关键字描述。</li>
<li>as! 用于类型强转，失败会崩溃。</li>
<li>@noescape 用于描述作为参数闭包，用来告诉 Swift 闭包将在函数返回前使用。</li>
<li>常量可以延后初始化。</li>
</ul>
<p><em>Swift 2.0</em></p>
<ul>
<li>增加 guard 关键字，用于解可选项值。</li>
<li>defer 关键字用来延迟执行，即使抛出错误了都会在最后执行。</li>
<li>ErrorType 协议，以及 throws、do、try 和 catch 的引入用来处理错误。</li>
<li>characters 加上 count，用来替代 count()。</li>
<li>#available 用来检查系统版本。</li>
</ul>
<p><em>Swift 2.1</em></p>
<ul>
<li>字符串插值可以包含字符串字面符号。</li>
</ul>
<p><em>Swift 2.2</em></p>
<p>官方博客介绍：<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-2.2-released/">Swift 2.2 Released!</a>、<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-2.2-new-features/">New Features in Swift 2.2</a>、<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-2.2-release-process/">Swift 2.2 Release Process</a></p>
<ul>
<li><strong>FILE</strong>, <strong>LINE</strong> 和 <strong>FUNCTION</strong> 换成 #file，#line 和 #function。</li>
<li>废弃 ++ 和 – 操作符。</li>
<li>C 语言风格 for 循环废弃。</li>
<li>废弃变量参数，因为变量参数容易和 inout 搞混。</li>
<li>废弃字符串化的选择器，选择器不再能写成字符串了。</li>
<li>元组可直接比较是否相等。</li>
</ul>
<p><em>Swift 3.0</em></p>
<p>官方博客介绍：<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-3.0-released/">Swift 3.0 Released!</a>、<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-3.0-preview-1-released/">Swift 3.0 Preview 1 Released!</a>、<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-3.0-release-process/">Swift 3.0 Release Process</a></p>
<ul>
<li>规范动词和名词来命名。</li>
<li>去掉 NS 前缀。</li>
<li>方法名描述参数部分变为参数名。</li>
<li>省略没必要的单词，命名做了简化呢。比如 stringByTrimmingCharactersInSet 就换成了 trimmingCharacters。</li>
<li>枚举的属性使用小写开头。</li>
<li>引入 C 函数的属性。</li>
</ul>
<p><em>Swift 3.1</em></p>
<p>官方博客介绍：<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-3.1-released/">Swift 3.1 Released!</a>、<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-3.1-release-process/">Swift 3.1 Release Process</a></p>
<ul>
<li>序列新增 prefix(while:) 和 drop(while:) 方法，顺序遍历执行闭包里的逻辑判断，满足条件就返回，遇到不匹配就会停止遍历。prefix 返回满足条件的元素集合，drop 返回停止遍历之后那些元素集合。</li>
<li>泛型适用于嵌套类型。</li>
<li>类型的扩展可以使用约束条件，比如扩展数组时，加上元素为整数的约束，这样的扩展就只会对元素为整数的数组有效。</li>
</ul>
<p><em>Swift 4.0</em></p>
<p>官方博客介绍：<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-4.0-released/">Swift 4.0 Released!</a>、<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-4.0-release-process/">Swift 4 Release Process</a></p>
<ul>
<li>加入 Codable 协议，更 Swifty 的编码和解码。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0167-swift-encoders.md">SE-0167 Swift Encoders</a></li>
<li>字符串加入三个双引号的支持，让多行字符串编写更加直观。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0168-multi-line-string-literals.md">SE-0168 Multi-Line String Literals</a></li>
<li>字符串变成集合，表示可以对字符串进行逐字遍历、map 和反转等操作。</li>
<li>keypaths 语法提升。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0161-key-paths.md">SE-0161 Smart KeyPaths: Better Key-Value Coding for Swift</a></li>
<li>集合加入 ..&lt;10 这样语法的单边切片。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0172-one-sided-ranges.md">SE-0172 One-sided Ranges</a></li>
<li>字典新增 mapValues，可 map 字典的值。通过 grouping 可对字典进行分组生成新字典，键和值都可以。从字典中取值，如果键对应无值，则使用通过 default 指定的默认值。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0165-dict.md">SE-0165 Dictionary &amp; Set Enhancements</a></li>
</ul>
<p><em>Swift 4.1</em></p>
<p>官方博客介绍：<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-4.1-released/">Swift 4.1 Released!</a>、<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-4.1-release-process/">Swift 4.1 Release Process</a></p>
<ul>
<li>Hashable 也不需要返回一个唯一的 hashValue 哈希值属性。</li>
<li>Equatable 和 Hashable 自动合成的提案参见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0185-synthesize-equatable-hashable.md">SE-0185 Synthesizing Equatable and Hashable conformance</a>。</li>
<li>两个自定类型比较是否相等时，不再需要比较每个属性，Swift 会自动生成 == 方法，你只需要声明 Equatable 协议。</li>
<li>引入 KeyDecodingStrategy属性，其中 .convertFromSnakeCase 可以将下划线的命名转化成驼峰的命名。</li>
<li>引入条件符合性，只有满足一定条件才符合协议。比如扩展数组要求当里面元素满足某协议数组才符合这个协议。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0143-conditional-conformances.md">SE-0143 Conditional conformances</a>。</li>
<li>引入 canImport 宏条件关键字，判断是否可以使用某库，以前只能通过判断操作系统平台来判断。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0075-import-test.md">SE-0075 Adding a Build Configuration Import Test</a>。</li>
<li>新增能够去除为零项目的 compactMap()。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0187-introduce-filtermap.md">SE-0187 Introduce Sequence.compactMap(_:)</a></li>
<li>关联类型可以创建递归约束，提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0157-recursive-protocol-constraints.md">SE-0157 Support recursive constraints on associated types</a></li>
<li>targetEnvironment 环境的判断，比如模拟器。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0190-target-environment-platform-condition.md">SE-0190 Target environment platform condition</a> 。</li>
</ul>
<p><em>Swift 4.2</em></p>
<p>官方博客介绍：<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-4.2-released/">Swift 4.2 Released!</a>、<a target="_blank" rel="noopener" href="https://swift.org/blog/4.2-release-process/">Swift 4.2 Release Process</a></p>
<ul>
<li>新增动态成员查询，@dynamicMemberLookup 新属性，指示访问属性时调用一个已实现的处理动态查找的下标方法 subscript(dynamicMemeber:)，通过指定属性字符串名返回值。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0195-dynamic-member-lookup.md">SE-0195 Introduce User-defined “Dynamic Member Lookup” Types</a></li>
<li>集合新加 removeAll(where:) 方法，过滤满足条件所有元素。比 filter 更高效。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0197-remove-where.md">SE-0197 Adding in-place removeAll(where:) to the Standard Library</a></li>
<li>布尔值增加 toggle() 方法，用来切换布尔值。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0199-bool-toggle.md">SE-0199 Adding toggle to Bool</a></li>
<li>引入 CaseIterable 协议，可以将枚举中所有 case 生成 allCases 数组。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0194-derived-collection-of-enum-cases.md">SE-0194 Derived Collection of Enum Cases</a></li>
<li>引入 #warning 和 #error 两个新的编译器指令。#warning 会产生一个警告，#error 会直接让编译出错。比如必须要填写 token 才能编译的话可以在设置 token 的代码前加上 #error 和说明。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0196-diagnostic-directives.md">SE-0196 Compiler Diagnostic Directives</a></li>
<li>新增加密安全的随机 API。直接在数字类型上调用 random() 方法生成随机数。shuffle() 方法可以对数组进行乱序重排。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0202-random-unification.md">SE-0202 Random Unification</a></li>
<li>更简单更安全的哈希协议，引入新的 Hasher 结构，通过 combine() 方法为哈希值添加更多属性，调用 finalize() 方法生成最终哈希值。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0206-hashable-enhancements.md">SE-0206 Hashable Enhancements</a></li>
<li>集合增加 allSatisfy() 用来判断集合中的元素是否都满足了一个条件。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0207-containsOnly.md">SE-0207 Add an allSatisfy algorithm to Sequence</a></li>
</ul>
<p><em>Swift 5.0</em></p>
<p>官方博客介绍：<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-5-released/">Swift 5 Released!</a>、<a target="_blank" rel="noopener" href="https://swift.org/blog/5.0-release-process/">Swift 5.0 Release Process</a></p>
<ul>
<li>@dynamicCallable 动态可调用类型。通过实现 dynamicallyCall 方法来定义变参的处理。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0216-dynamic-callable.md">SE-0216 Introduce user-defined dynamically “callable” types</a></li>
<li>新加 Result 类型用来处理错误。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0235-add-result.md">SE-0235 Add Result to the Standard Library</a></li>
<li>新增原始字符串能力，在字符串前加上一个或多个#符号。里面的双引号和转义符号将不再起作用了，如果想让转义符起作用，需要在转义符后面加上#符号。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0200-raw-string-escaping.md">SE-0200 Enhancing String Literals Delimiters to Support Raw Text</a></li>
<li>自定义字符串插值。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0228-fix-expressiblebystringinterpolation.md">SE-0228 Fix ExpressibleByStringInterpolation</a></li>
<li>枚举新增 @unknown 用来区分固定的枚举和可能改变的枚举的能力。用于防止未来新增枚举属性会进行提醒提示完善每个 case 的处理。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0192-non-exhaustive-enums.md">SE-0192 Handling Future Enum Cases</a></li>
<li>compactMapValues() 对字典值进行转换和解包。可以解可选类型，并去掉 nil 值。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0218-introduce-compact-map-values.md">SE-0218 Introduce compactMapValues to Dictionary</a></li>
<li>扁平化 try?。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0230-flatten-optional-try.md">SE-0230 Flatten nested optionals resulting from ‘try?’</a></li>
<li>isMultiple(of:) 方法检查一个数字是否是另一个数字的倍数。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0225-binaryinteger-iseven-isodd-ismultiple.md">SE-0225 Adding isMultiple to BinaryInteger</a></li>
</ul>
<p><em>Swift 5.1</em></p>
<p>官方博客介绍：<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-5.1-released/">Swift 5.1 Released!</a>、<a target="_blank" rel="noopener" href="https://swift.org/blog/5.1-release-process/">Swift 5.1 Release Process</a></p>
<ul>
<li>有序集合的 diff，通过 difference(from:) 方法，可以返回要删除哪些和添加哪些项目能够让两个集合相等。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0240-ordered-collection-diffing.md">SE-0240 Ordered Collection Diffing</a></li>
<li>属性包装。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0258-property-wrappers.md">SE-0258 Property Wrappers</a></li>
<li>不透明返回类型。函数调用者决定返回什么类型是泛型，函数自身决定返回什么类型使用不透明返回类型。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0244-opaque-result-types.md">SE-0244 Opaque Result Types</a></li>
<li>初始化有默认值的属性可不设置。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0242-default-values-memberwise.md">SE-0242 Synthesize default values for the memberwise initializer</a></li>
<li>单行表达式函数隐式返回，返回一个单行表达式的函数可以不用 return 关键字。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0255-omit-return.md">SE-0255 Implicit returns from single-expression functions</a></li>
<li>在类、结构体和枚举里使用 Self，Self 可以指代包含的类型。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0068-universal-self.md">SE-0068 Expanding Swift Self to class members and value types</a></li>
<li>静态下标。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0254-static-subscripts.md">SE-0254 Static and class subscripts</a></li>
<li>枚举里有 none 的 case 编译器会提示换成 Optional.none。</li>
<li>引入未初始化数组。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0245-array-uninitialized-initializer.md">SE-0245 Add an Array Initializer with Access to Uninitialized Storage</a></li>
</ul>
<p><em>Swift 5.2</em></p>
<p>官方博客介绍：<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-5.2-released/">Swift 5.2 Released!</a>、<a target="_blank" rel="noopener" href="https://swift.org/blog/5.2-release-process/">Swift 5.2 Release Process</a></p>
<ul>
<li>自定义类型中实现了 callAsFunction() 的话，该类型的值就可以直接调用。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0253-callable.md">SE-0253 Callable values of user-defined nominal types</a></li>
<li>键路径表达式作为函数。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0249-key-path-literal-function-expressions.md">SE-0249 Key Path Expressions as Functions</a></li>
</ul>
<p><em>Swift 5.3</em></p>
<p>官方博客介绍：<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-5.3-released/">Swift 5.3 released!</a>、<a target="_blank" rel="noopener" href="https://swift.org/blog/5.3-release-process/">Swift 5.3 Release Process</a></p>
<ul>
<li>SPM 包管理资源，SPM 可以包含资源文件，比如多媒体或文本等。通过 Bundle.module 访问这些资源。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0271-package-manager-resources.md">SE-0271 Package Manager Resources</a></li>
<li>SPM 包里资源本地化。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0278-package-manager-localized-resources.md">SE-0278 Package Manager Localized Resources</a></li>
<li>SPM 可以整合二进制包依赖。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0272-swiftpm-binary-dependencies.md">SE-0272 Package Manager Binary Dependencies</a></li>
<li>SPM 可以设置特定平台的依赖。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0273-swiftpm-conditional-target-dependencies.md">SE-0273 Package Manager Conditional Target Dependencies</a></li>
<li>单个 catch 块中捕获多个 Error 的 case。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0276-multi-pattern-catch-clauses.md">SE-0276 Multi-Pattern Catch Clauses</a></li>
<li>支持多个尾部闭包。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0279-multiple-trailing-closures.md">SE-0279 Multiple Trailing Closures</a></li>
<li>符合 Comparable 协议的枚举可以进行比较。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0266-synthesized-comparable-for-enumerations.md">SE-0266 Synthesized Comparable conformance for enum types</a></li>
<li>很多地方可以不用加 self 来指代实例自己了。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0269-implicit-self-explicit-capture.md">SE-0269 Increase availability of implicit self in @escaping closures when reference cycles are unlikely to occur</a></li>
<li>@main 可以方便指定程序入口点。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0281-main-attribute.md">SE-0281 @main: Type-Based Program Entry Points</a></li>
<li>where 子句可以用到泛型和扩展函数中。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0267-where-on-contextually-generic.md">SE-0267 where clauses on contextually generic declarations</a></li>
<li>枚举的 case 也可以符合协议。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0280-enum-cases-as-protocol-witnesses.md">SE-0280 Enum cases as protocol witnesses</a></li>
<li>完善 didSet，性能提升。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0268-didset-semantics.md">SE-0268 Refine didSet Semantics</a></li>
<li>新增 Float16 类型，即半精度浮点类型。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0277-float16.md">SE-0277 Float16</a></li>
</ul>
<p><em>Swift 5.4</em></p>
<p>官方博客介绍：<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-5.4-released/">Swift 5.4 Released!</a></p>
<ul>
<li>SPM 支持 @main。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0294-package-executable-targets.md">SE-0294 Declaring executable targets in Package Manifests</a></li>
<li>结果生成器（Result builders），通过传递序列创建新值，SwiftUI就是使用的结果生成器将多个视图生成一个视图。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0289-result-builders.md">SE-0289 Result builders</a></li>
<li>增强隐式成员语法，即使用了隐式的成员可以进行链式处理。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0287-implicit-member-chains.md">SE-0287 Extend implicit member syntax to cover chains of member references</a></li>
<li>函数开始有了使用多个变量参数的能力。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0284-multiple-variadic-parameters.md">SE-0284 Allow Multiple Variadic Parameters in Functions, Subscripts, and Initializers</a></li>
<li>嵌套函数可以重载，嵌套函数可以在声明函数之前调用他。</li>
<li>属性包装支持局部变量。</li>
</ul>
<p><em>Swift 5.5</em></p>
<p>官方博客介绍：<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-5.5-released/">Swift 5.5 Released!</a></p>
<ul>
<li>Async await，用同步写法来处理异步。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0296-async-await.md">SE-0296 Async/await</a></li>
<li>Async sequences，异步序列上的循环能力。符合 AsyncSequence 协议的序列可以通过 for await 来进行异步循环。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0298-asyncsequence.md">SE-0298 Async/Await: Sequences</a> </li>
<li>结构化的并发，使用 Task 和 TaskGroup 执行、取消和监听当前操作的方法。复杂的并发处理可以使用 withTaskGroup() 来创建一组 Task，addTask() 用来添加任务，cancelAll() 可以取消任务，addTask() 在取消任务后可以继续添加任务，如果使用了 addTaskUnlessCancelled() 方法就可以避免取消后会继续添加任务这种情况。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0304-structured-concurrency.md">SE-0304 Structured concurrency</a></li>
<li>只读属性支持 async 和 throws 关键字。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0310-effectful-readonly-properties.md">SE-0310 Effectful Read-only Properties</a></li>
<li>async let，可以创建 await 子任务。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0317-async-let.md">SE-0317 async let bindings</a></li>
<li>以前异步代码的适配。比如 DispatchQueue.main.async，外部库可以通过 withCheckedContinuation() 函数来对以前异步代码进行封装。 提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0300-continuation.md">SE-0300 Continuations for interfacing async tasks with synchronous code</a></li>
<li>Actor，可以确保内部只能被一个线程访问，避免存储属性和方法出现竞争条件。提案在这 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0306-actors.md">SE-0306 Actors</a></li>
<li>全局 actors，通过 actor 将全局状态隔离出来，避免数据竞争。比如主线程 @MainActor 这个属性包装可以将属性和方法标记为只能在主线程上访问。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0316-global-actors.md">SE-0316 Global actors</a></li>
<li>Sendable 协议和 @Sendable 属性包装，目的是支持安全的将数据从一个线程传给另一个线程。Swift 的核心数据类型比如字符、集合等已符合 Sendable 协议。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0302-concurrent-value-and-concurrent-closures.md">SE-0302 Sendable and @Sendable closures</a></li>
<li>局部变量可以使用 lazy。</li>
<li>属性包装可以用到函数和闭包参数上。提案<a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0293-extend-property-wrappers-to-function-and-closure-parameters.md">SE-0293 Extend Property Wrappers to Function and Closure Parameters</a></li>
<li>泛型支持静态成员查找。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0299-extend-generic-static-member-lookup.md">SE-0299 Extending Static Member Lookup in Generic Contexts</a></li>
<li>#if 用于后缀成员表达式。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0308-postfix-if-config-expressions.md">SE-0308 #if for postfix member expressions</a></li>
<li>CGFloat 和 Double 之间可以隐式转换。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0307-allow-interchangeable-use-of-double-cgfloat-types.md">SE-0307 Allow interchangeable use of CGFloat and Double types</a></li>
<li>Codable 支持关联值枚举。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0295-codable-synthesis-for-enums-with-associated-values.md">SE-0295 Codable synthesis for enums with associated values</a></li>
</ul>
<h3 id="规范"><a href="#规范" class="headerlink" title="规范"></a>规范</h3><h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><p>参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://google.github.io/swift/">Swift Style Guide</a></li>
</ul>
<p>多用静态特性。swift 在编译期间所做的优化比 OC 要多，这是由于他的静态派发、泛型特化、写时复制这些静态特性决定的。另外通过 final  和 private 这样的表示可将动态特性转化为静态方式，编译开启 WMO 可以自动推导出哪些动态派发可转化为静态派发。</p>
<p>如何避免崩溃？</p>
<ul>
<li>字典：用结构体替代</li>
<li>Any：可用泛型或关联关联类型替代</li>
<li>as? ：少用 AnyObject，多用泛型或不透明类型</li>
<li>!：要少用</li>
</ul>
<p>好的实践？</p>
<ul>
<li>少用继承，多用 protocol</li>
<li>多用 extension 对自己代码进行管理</li>
</ul>
<h3 id="资料推荐"><a href="#资料推荐" class="headerlink" title="资料推荐"></a>资料推荐</h3><h4 id="书单"><a href="#书单" class="headerlink" title="书单"></a>书单</h4><ul>
<li>《Thinking in SwiftUI》</li>
<li>《Swift 进阶》</li>
<li>《函数式Swift》</li>
<li>《深入解析Mac OS X &amp; iOS操作系统》</li>
<li>《LLVM Techniques, Tips, and Best Practices Clang and Middle-End Libraries》</li>
<li>《Learn LLVM 12》</li>
<li>《Crafting Interpreters》</li>
<li>《TCP/IP Illustrated》</li>
<li>《松本行弘的程序世界》</li>
<li>《现代操作系统》</li>
<li>《深入理解计算机系统》</li>
<li>《程序员的自我修养》</li>
<li>《Head First 设计模式》</li>
</ul>
<h3 id="三方库使用"><a href="#三方库使用" class="headerlink" title="三方库使用"></a>三方库使用</h3><h4 id="SQLite-swift-的使用"><a href="#SQLite-swift-的使用" class="headerlink" title="SQLite.swift 的使用"></a>SQLite.swift 的使用</h4><p>下面是 SQLite.swift 库的使用介绍，包括了数据库创建，表创建，表的添加、更新、删除、查找等处理方法</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SQLite</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">DB</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> shared <span class="operator">=</span> <span class="type">DB</span>()</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> path <span class="operator">=</span> <span class="type">NSSearchPathForDirectoriesInDomains</span>(</span><br><span class="line">        .applicationSupportDirectory, .userDomainMask, <span class="literal">true</span></span><br><span class="line">    ).first<span class="operator">!</span></span><br><span class="line">    <span class="keyword">let</span> <span class="type">BBDB</span>: <span class="type">Connection</span>?</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">init</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="type">DB</span>.path)</span><br><span class="line">            <span class="type">BBDB</span> <span class="operator">=</span> <span class="keyword">try</span> <span class="type">Connection</span>(<span class="string">&quot;<span class="subst">\(DB.path)</span>/github.sqlite3&quot;</span>)</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="type">BBDB</span> <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/// Swift 类型和 SQLite 类型对标如下：</span></span><br><span class="line">        <span class="comment">/// Int64 = INTEGER</span></span><br><span class="line">        <span class="comment">/// Double = REAL</span></span><br><span class="line">        <span class="comment">/// String = TEXT</span></span><br><span class="line">        <span class="comment">/// nil = NULL</span></span><br><span class="line">        <span class="comment">/// SQLite.Blob = BLOB</span></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建表</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">cTbs</span>()</span> <span class="keyword">throws</span> &#123;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> <span class="type">ReposNotiDataHelper</span>.createTable()</span><br><span class="line">            <span class="keyword">try</span> <span class="type">DevsNotiDataHelper</span>.createTable()</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">DBError</span>.connectionErr</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">DBError</span>: <span class="title">Error</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> connectionErr, insertErr, deleteErr, searchErr, updateErr, nilInData</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">DataHelperProtocol</span> </span>&#123;</span><br><span class="line">    <span class="keyword">associatedtype</span> <span class="type">T</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">createTable</span>()</span> <span class="keyword">throws</span> -&gt; <span class="type">Void</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">insert</span>(<span class="params">i</span>: <span class="type">T</span>)</span> <span class="keyword">throws</span> -&gt; <span class="type">Int64</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">delete</span>(<span class="params">i</span>: <span class="type">T</span>)</span> <span class="keyword">throws</span> -&gt; <span class="type">Void</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">findAll</span>()</span> <span class="keyword">throws</span> -&gt; [<span class="type">T</span>]<span class="operator">?</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: 开发者更新提醒</span></span><br><span class="line"><span class="keyword">typealias</span> <span class="type">DBDevNoti</span> <span class="operator">=</span> (</span><br><span class="line">    login: <span class="type">String</span>,</span><br><span class="line">    lastReadId: <span class="type">String</span>,</span><br><span class="line">    unRead: <span class="type">Int</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">DevsNotiDataHelper</span>: <span class="title">DataHelperProtocol</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> table <span class="operator">=</span> <span class="type">Table</span>(<span class="string">&quot;devsNoti&quot;</span>)</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> login <span class="operator">=</span> <span class="type">Expression</span>&lt;<span class="type">String</span>&gt;(<span class="string">&quot;login&quot;</span>)</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> lastReadId <span class="operator">=</span> <span class="type">Expression</span>&lt;<span class="type">String</span>&gt;(<span class="string">&quot;lastReadId&quot;</span>)</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> unRead <span class="operator">=</span> <span class="type">Expression</span>&lt;<span class="type">Int</span>&gt;(<span class="string">&quot;unRead&quot;</span>)</span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">T</span> <span class="operator">=</span> <span class="type">DBDevNoti</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">createTable</span>()</span> <span class="keyword">throws</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> db <span class="operator">=</span> <span class="type">DB</span>.shared.<span class="type">BBDB</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">DBError</span>.connectionErr</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">_</span> <span class="operator">=</span> <span class="keyword">try</span> db.run(table.create(ifNotExists: <span class="literal">true</span>) &#123; t <span class="keyword">in</span></span><br><span class="line">                t.column(login, unique: <span class="literal">true</span>)</span><br><span class="line">                t.column(lastReadId, defaultValue: <span class="string">&quot;&quot;</span>)</span><br><span class="line">                t.column(unRead, defaultValue: <span class="number">0</span>)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125; <span class="keyword">catch</span> <span class="keyword">_</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">DBError</span>.connectionErr</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="comment">// end createTable</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">insert</span>(<span class="params">i</span>: <span class="type">DBDevNoti</span>)</span> <span class="keyword">throws</span> -&gt; <span class="type">Int64</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> db <span class="operator">=</span> <span class="type">DB</span>.shared.<span class="type">BBDB</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">DBError</span>.connectionErr</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> insert <span class="operator">=</span> table.insert(login <span class="operator">&lt;-</span> i.login, lastReadId <span class="operator">&lt;-</span> i.lastReadId, unRead <span class="operator">&lt;-</span> i.unRead)</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> rowId <span class="operator">=</span> <span class="keyword">try</span> db.run(insert)</span><br><span class="line">            <span class="keyword">guard</span> rowId <span class="operator">&gt;</span> <span class="number">0</span> <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="type">DBError</span>.insertErr</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> rowId</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">DBError</span>.insertErr</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="comment">// end insert</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">delete</span>(<span class="params">i</span>: <span class="type">DBDevNoti</span>)</span> <span class="keyword">throws</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> db <span class="operator">=</span> <span class="type">DB</span>.shared.<span class="type">BBDB</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">DBError</span>.connectionErr</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> query <span class="operator">=</span> table.filter(login <span class="operator">==</span> i.login)</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> tmp <span class="operator">=</span> <span class="keyword">try</span> db.run(query.delete())</span><br><span class="line">            <span class="keyword">guard</span> tmp <span class="operator">==</span> <span class="number">1</span> <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="type">DBError</span>.deleteErr</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">DBError</span>.deleteErr</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="comment">// end delete</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">find</span>(<span class="params">sLogin</span>: <span class="type">String</span>)</span> <span class="keyword">throws</span> -&gt; <span class="type">DBDevNoti</span>? &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> db <span class="operator">=</span> <span class="type">DB</span>.shared.<span class="type">BBDB</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">DBError</span>.connectionErr</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> query <span class="operator">=</span> table.filter(login <span class="operator">==</span> sLogin)</span><br><span class="line">        <span class="keyword">let</span> items <span class="operator">=</span> <span class="keyword">try</span> db.prepare(query)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> items &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">DBDevNoti</span>(login: i[login], lastReadId: i[lastReadId], unRead: i[unRead])</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125; <span class="comment">// end find</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">update</span>(<span class="params">i</span>: <span class="type">DBDevNoti</span>)</span> <span class="keyword">throws</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> db <span class="operator">=</span> <span class="type">DB</span>.shared.<span class="type">BBDB</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">DBError</span>.connectionErr</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> query <span class="operator">=</span> table.filter(login <span class="operator">==</span> i.login)</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">try</span> db.run(query.update(lastReadId <span class="operator">&lt;-</span> i.lastReadId, unRead <span class="operator">&lt;-</span> i.unRead)) <span class="operator">&gt;</span> <span class="number">0</span> &#123;</span><br><span class="line">                </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="type">DBError</span>.updateErr</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">DBError</span>.updateErr</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="comment">// end update</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">findAll</span>()</span> <span class="keyword">throws</span> -&gt; [<span class="type">DBDevNoti</span>]<span class="operator">?</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> db <span class="operator">=</span> <span class="type">DB</span>.shared.<span class="type">BBDB</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">DBError</span>.connectionErr</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> arr <span class="operator">=</span> [<span class="type">DBDevNoti</span>]()</span><br><span class="line">        <span class="keyword">let</span> items <span class="operator">=</span> <span class="keyword">try</span> db.prepare(table)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> items &#123;</span><br><span class="line">            arr.append(<span class="type">DBDevNoti</span>(login: i[login], lastReadId: i[lastReadId], unRead: i[unRead]))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> arr</span><br><span class="line">    &#125; <span class="comment">// end find all</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>使用时，可以在初始化时这么做：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK: 初始化数据库</span></span><br><span class="line">et db <span class="operator">=</span> <span class="type">DB</span>.shared</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> db.cTbs() <span class="comment">// 创建表</span></span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>使用的操作示例如下：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> fd <span class="operator">=</span> <span class="keyword">try</span> <span class="type">ReposNotiDataHelper</span>.find(sFullName: r.id) &#123;</span><br><span class="line">        reposDic[fd.fullName] <span class="operator">=</span> fd.unRead</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">_</span> <span class="operator">=</span> <span class="keyword">try</span> <span class="type">ReposNotiDataHelper</span>.insert(i: <span class="type">DBRepoNoti</span>(fullName: r.id, lastReadCommitSha: <span class="string">&quot;&quot;</span>, unRead: <span class="number">0</span>))</span><br><span class="line">            reposDic[r.id] <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> reposDic</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> reposDic</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="macOS"><a href="#macOS" class="headerlink" title="macOS"></a>macOS</h3><h4 id="范例"><a href="#范例" class="headerlink" title="范例"></a>范例</h4><ul>
<li>官方提供的两个例子，<a target="_blank" rel="noopener" href="https://developer.apple.com/tutorials/swiftui/creating-a-macos-app">Creating a macOS App</a>，<a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/swiftui/building_a_great_mac_app_with_swiftui">Building a Great Mac App with SwiftUI</a> （有table和LazyVGrid的用法）。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/adamayoung/Movies">GitHub - adamayoung/Movies: Movies and TV Shows App for iOS, iPadOS, watchOS and macOS</a> 使用了SwiftUI和Combine，电影数据使用的是<a target="_blank" rel="noopener" href="https://www.themoviedb.org/">The Movie Database (TMDB)</a>的API</li>
</ul>
<h4 id="三栏结构"><a href="#三栏结构" class="headerlink" title="三栏结构"></a>三栏结构</h4><p>三栏结构架子搭建，代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SwiftPamphletApp</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">SPSidebar</span>()</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;第二栏&quot;</span>)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;第三栏&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .navigationTitle(<span class="string">&quot;Swift 小册子&quot;</span>)</span><br><span class="line">        .toolbar &#123;</span><br><span class="line">            <span class="type">ToolbarItem</span>(placement: <span class="type">ToolbarItemPlacement</span>.navigation) &#123;</span><br><span class="line">                <span class="type">Button</span> &#123;</span><br><span class="line">                    <span class="type">NSApp</span>.keyWindow<span class="operator">?</span>.firstResponder<span class="operator">?</span>.tryToPerform(#selector(<span class="type">NSSplitViewController</span>.toggleSidebar(<span class="keyword">_</span>:)), with: <span class="literal">nil</span>)</span><br><span class="line">                &#125; label: &#123;</span><br><span class="line">                    <span class="type">Label</span>(<span class="string">&quot;Sidebar&quot;</span>, systemImage: <span class="string">&quot;sidebar.left&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SPSidebar</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">Section</span>(<span class="string">&quot;第一组&quot;</span>) &#123;</span><br><span class="line">                <span class="type">NavigationLink</span>(<span class="string">&quot;第一项&quot;</span>, destination: <span class="type">SPList</span>(title: <span class="string">&quot;列表1&quot;</span>))</span><br><span class="line">                    .badge(<span class="number">3</span>)</span><br><span class="line">                <span class="type">NavigationLink</span>(<span class="string">&quot;第二项&quot;</span>, destination: <span class="type">SPList</span>(title: <span class="string">&quot;列表2&quot;</span>))</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">Section</span>(<span class="string">&quot;第二组&quot;</span>) &#123;</span><br><span class="line">                <span class="type">NavigationLink</span>(<span class="string">&quot;第三项&quot;</span>, destination: <span class="type">SPList</span>(title: <span class="string">&quot;列表3&quot;</span>))</span><br><span class="line">                <span class="type">NavigationLink</span>(<span class="string">&quot;第四项&quot;</span>, destination: <span class="type">SPList</span>(title: <span class="string">&quot;列表4&quot;</span>))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .listStyle(<span class="type">SidebarListStyle</span>())</span><br><span class="line">        .frame(minWidth: <span class="number">160</span>)</span><br><span class="line">        .toolbar &#123;</span><br><span class="line">            <span class="type">ToolbarItem</span> &#123;</span><br><span class="line">                <span class="type">Menu</span> &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">                &#125; label: &#123;</span><br><span class="line">                    <span class="type">Label</span>(<span class="string">&quot;Label&quot;</span>, systemImage: <span class="string">&quot;slider.horizontal.3&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SPList</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> title: <span class="type">String</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> searchText: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span>(<span class="number">0</span><span class="operator">..&lt;</span><span class="number">3</span>) &#123; i <span class="keyword">in</span></span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;内容<span class="subst">\(i)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .toolbar(content: &#123;</span><br><span class="line">            <span class="type">Button</span> &#123;</span><br><span class="line">                <span class="comment">//</span></span><br><span class="line">            &#125; label: &#123;</span><br><span class="line">                <span class="type">Label</span>(<span class="string">&quot;Add&quot;</span>, systemImage: <span class="string">&quot;plus&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .navigationTitle(title)</span><br><span class="line">        .navigationSubtitle(<span class="string">&quot;副标题&quot;</span>)</span><br><span class="line">        .searchable(text: <span class="variable">$searchText</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>显示效果如下：<br><img src="https://user-images.githubusercontent.com/251980/142977421-bed5b5ae-01fe-471f-a951-63dd4338c97a.png" alt=""></p>
<h4 id="全屏模式"><a href="#全屏模式" class="headerlink" title="全屏模式"></a>全屏模式</h4><p>将 NSSplitView 里的其中一个 NSView 设置为全屏和退出全屏的函数如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK: - 获取 NSSplitViewController</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">splitVC</span>()</span> -&gt; <span class="type">NSSplitViewController</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ((<span class="type">NSApp</span>.keyWindow<span class="operator">?</span>.contentView<span class="operator">?</span>.subviews.first<span class="operator">?</span>.subviews.first<span class="operator">?</span>.subviews.first <span class="keyword">as?</span> <span class="type">NSSplitView</span>)<span class="operator">?</span>.delegate <span class="keyword">as?</span> <span class="type">NSSplitViewController</span>)<span class="operator">!</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - 全屏</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fullScreen</span>(<span class="params">isEnter</span>: <span class="type">Bool</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> isEnter <span class="operator">==</span> <span class="literal">true</span> &#123;</span><br><span class="line">        <span class="comment">// 进入全屏</span></span><br><span class="line">        <span class="keyword">let</span> presOptions:</span><br><span class="line">        <span class="type">NSApplication</span>.<span class="type">PresentationOptions</span> <span class="operator">=</span> ([.autoHideDock,.autoHideMenuBar])</span><br><span class="line">        <span class="keyword">let</span> optionsDictionary <span class="operator">=</span> [<span class="type">NSView</span>.<span class="type">FullScreenModeOptionKey</span>.fullScreenModeApplicationPresentationOptions : <span class="type">NSNumber</span>(value: presOptions.rawValue)]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> v <span class="operator">=</span> splitVC().splitViewItems[<span class="number">2</span>].viewController.view</span><br><span class="line">        v.enterFullScreenMode(<span class="type">NSScreen</span>.main<span class="operator">!</span>, withOptions: optionsDictionary)</span><br><span class="line">        v.wantsLayer <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 退出全屏</span></span><br><span class="line">        <span class="type">NSApp</span>.keyWindow<span class="operator">?</span>.contentView<span class="operator">?</span>.exitFullScreenMode()</span><br><span class="line">    &#125; <span class="comment">// end if</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用方法</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">V</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="meta">@StateObject</span> <span class="keyword">var</span> appVM <span class="operator">=</span> <span class="type">AppVM</span>()</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> isEnterFullScreen: <span class="type">Bool</span> <span class="operator">=</span> <span class="literal">false</span> <span class="comment">// 全屏控制</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Button</span> &#123;</span><br><span class="line">            isEnterFullScreen.toggle()</span><br><span class="line">            appVM.fullScreen(isEnter: isEnterFullScreen)</span><br><span class="line">        &#125; label: &#123;</span><br><span class="line">            <span class="type">Image</span>(systemName: isEnterFullScreen <span class="operator">==</span> <span class="literal">true</span> <span class="operator">?</span> <span class="string">&quot;arrow.down.right.and.arrow.up.left&quot;</span> : <span class="string">&quot;arrow.up.left.and.arrow.down.right&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="共享菜单"><a href="#共享菜单" class="headerlink" title="共享菜单"></a>共享菜单</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ShareView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> s: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Menu</span> &#123;</span><br><span class="line">            <span class="type">Button</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> p <span class="operator">=</span> <span class="type">NSPasteboard</span>.general</span><br><span class="line">                p.declareTypes([.string], owner: <span class="literal">nil</span>)</span><br><span class="line">                p.setString(s, forType: .string)</span><br><span class="line">            &#125; label: &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;拷贝链接&quot;</span>)</span><br><span class="line">                <span class="type">Image</span>(systemName: <span class="string">&quot;doc.on.doc&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">Divider</span>()</span><br><span class="line">            <span class="type">ForEach</span>(<span class="type">NSSharingService</span>.sharingServices(forItems: [<span class="string">&quot;&quot;</span>]), id: \.title) &#123; item <span class="keyword">in</span></span><br><span class="line">                <span class="type">Button</span> &#123;</span><br><span class="line">                    item.perform(withItems: [s])</span><br><span class="line">                &#125; label: &#123;</span><br><span class="line">                    <span class="type">Text</span>(item.title)</span><br><span class="line">                    <span class="type">Image</span>(nsImage: item.image)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; label: &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;分享&quot;</span>)</span><br><span class="line">            <span class="type">Image</span>(systemName: <span class="string">&quot;square.and.arrow.up&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="剪贴板"><a href="#剪贴板" class="headerlink" title="剪贴板"></a>剪贴板</h4><p>添加和读取剪贴板的方法如下：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 读取剪贴板内容</span></span><br><span class="line"><span class="keyword">let</span> s <span class="operator">=</span> <span class="type">NSPasteboard</span>.general.string(forType: .string)</span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> s <span class="operator">=</span> s <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(s)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置剪贴板内容</span></span><br><span class="line"><span class="keyword">let</span> p <span class="operator">=</span> <span class="type">NSPasteboard</span>.general</span><br><span class="line">p.declareTypes([.string], owner: <span class="literal">nil</span>)</span><br><span class="line">p.setString(s, forType: .string)</span><br></pre></td></tr></table></figure></p>
<h2 id="Combine"><a href="#Combine" class="headerlink" title="Combine"></a>Combine</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><h4 id="Combine-是什么？"><a href="#Combine-是什么？" class="headerlink" title="Combine 是什么？"></a>Combine 是什么？</h4><p>WWDC 2019苹果推出Combine，Combine是一种响应式编程范式，采用声明式的Swift API。</p>
<p>Combine 写代码的思路是你写代码不同于以往命令式的描述如何处理数据，Combine 是要去描述好数据会经过哪些逻辑运算处理。这样代码更好维护，可以有效的减少嵌套闭包以及分散的回调等使得代码维护麻烦的苦恼。</p>
<p>声明式和过程时区别可见如下代码：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 所有数相加</span></span><br><span class="line"><span class="comment">// 命令式思维</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum1</span>(<span class="params">arr</span>: [<span class="type">Int</span>])</span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> sum: <span class="type">Int</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> v <span class="keyword">in</span> arr &#123;</span><br><span class="line">    sum <span class="operator">+=</span> v</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明式思维</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum2</span>(<span class="params">arr</span>: [<span class="type">Int</span>])</span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> arr.reduce(<span class="number">0</span>, <span class="operator">+</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Combine 主要用来处理异步的事件和值。苹果 UI 框架都是在主线程上进行 UI 更新，Combine 通过 Publisher 的 receive 设置回主线程更新UI会非常的简单。</p>
<p>已有的 RxSwift 和 ReactiveSwift 框架和 Combine 的思路和用法类似。</p>
<p>Combine 的三个核心概念</p>
<ul>
<li>发布者</li>
<li>订阅者</li>
<li>操作符</li>
</ul>
<p>简单举个发布数据和类属性绑定的例子：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> pA <span class="operator">=</span> <span class="type">Just</span>(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="keyword">_</span> <span class="operator">=</span> pA.sink &#123; v <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;pA is: <span class="subst">\(v)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> pB <span class="operator">=</span> [<span class="number">7</span>,<span class="number">90</span>,<span class="number">16</span>,<span class="number">11</span>].publisher</span><br><span class="line"><span class="keyword">let</span> <span class="keyword">_</span> <span class="operator">=</span> pB</span><br><span class="line">    .sink &#123; v <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;pB: <span class="subst">\(v)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p: <span class="type">Int</span> <span class="operator">=</span> <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;property update to <span class="subst">\(p)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> o <span class="operator">=</span> <span class="type">AClass</span>()</span><br><span class="line"><span class="keyword">let</span> <span class="keyword">_</span> <span class="operator">=</span> pB.assign(to: \.p, on: o)</span><br></pre></td></tr></table></figure>
<h4 id="Combine-资料"><a href="#Combine-资料" class="headerlink" title="Combine 资料"></a>Combine 资料</h4><p>官方文档链接  <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/combine">Combine | Apple Developer Documentation</a> 。还有  <a target="_blank" rel="noopener" href="https://heckj.github.io/swiftui-notes/">Using Combine</a>  这里有大量使用示例，内容较全。官方讨论Combine的论坛  <a target="_blank" rel="noopener" href="https://forums.swift.org/tag/combine">Topics tagged combine</a> 。StackOverflow上相关问题  <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/tagged/combine">Newest ‘combine’ Questions</a> 。</p>
<p>WWDC上关于Combine的Session如下：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2019/722/">Introducing Combine</a> </li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2019/721/">Combine in Practice</a> </li>
</ul>
<p>和Combine相关的Session：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2019/415/">Modern Swift API Design</a> </li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2019/226">Data Flow Through SwiftUI</a> </li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2019/711">Introducing Combine and Advances in Foundation</a> </li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2019/712/">Advances in Networking, Part 1</a> </li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2019/610/">Building Collaborative AR Experiences</a> </li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2019/223/">Expanding the Sensory Experience with Core Haptics</a> </li>
</ul>
<h3 id="使用说明"><a href="#使用说明" class="headerlink" title="使用说明"></a>使用说明</h3><h4 id="publisher"><a href="#publisher" class="headerlink" title="publisher"></a>publisher</h4><p>publisher 是发布者，sink 是订阅者</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cc <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> p1: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> p2: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line">[<span class="type">S</span>(p1: <span class="string">&quot;1&quot;</span>, p2: <span class="string">&quot;one&quot;</span>), <span class="type">S</span>(p1: <span class="string">&quot;2&quot;</span>, p2: <span class="string">&quot;two&quot;</span>)]</span><br><span class="line">    .publisher</span><br><span class="line">    .print(<span class="string">&quot;array&quot;</span>)</span><br><span class="line">    .sink &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .store(in: <span class="operator">&amp;</span>cc)</span><br></pre></td></tr></table></figure>
<p> 输出<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> array: receive subscription: ([戴铭的开发小册子.AppDelegate.(unknown context at $10ac82d20).(unknown context at $10ac82da4).S(p1: &quot;1&quot;, p2: &quot;one&quot;), 戴铭的开发小册子.AppDelegate.(unknown context at $10ac82d20).(unknown context at $10ac82da4).S(p1: &quot;2&quot;, p2: &quot;two&quot;)])</span><br><span class="line">array: request unlimited</span><br><span class="line">array: receive value: (S(p1: &quot;1&quot;, p2: &quot;one&quot;))</span><br><span class="line">S(p1: &quot;1&quot;, p2: &quot;one&quot;)</span><br><span class="line">array: receive value: (S(p1: &quot;2&quot;, p2: &quot;two&quot;))</span><br><span class="line">S(p1: &quot;2&quot;, p2: &quot;two&quot;)</span><br><span class="line">array: receive finished</span><br></pre></td></tr></table></figure></p>
<h4 id="Just"><a href="#Just" class="headerlink" title="Just"></a>Just</h4><p>Just 是发布者，发布的数据在初始化时完成</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"><span class="keyword">var</span> cc <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> p1: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> p2: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> pb <span class="operator">=</span> <span class="type">Just</span>(<span class="type">S</span>(p1: <span class="string">&quot;1&quot;</span>, p2: <span class="string">&quot;one&quot;</span>))</span><br><span class="line">pb</span><br><span class="line">    .print(<span class="string">&quot;pb&quot;</span>)</span><br><span class="line">    .sink &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .store(in: <span class="operator">&amp;</span>cc)</span><br></pre></td></tr></table></figure>
<p>输出<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pb: receive subscription: (Just)</span><br><span class="line">pb: request unlimited</span><br><span class="line">pb: receive value: (S(p1: &quot;1&quot;, p2: &quot;one&quot;))</span><br><span class="line">S(p1: &quot;1&quot;, p2: &quot;one&quot;)</span><br><span class="line">pb: receive finished</span><br></pre></td></tr></table></figure></p>
<h4 id="PassthroughSubject"><a href="#PassthroughSubject" class="headerlink" title="PassthroughSubject"></a>PassthroughSubject</h4><p>PassthroughSubject 可以传递多值，订阅者可以是一个也可以是多个，send 指明 completion 后，订阅者就没法接收到新发送的值了。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cc <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> p1: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> p2: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">CError</span>: <span class="title">Error</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> aE, bE</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> ps1 <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">S</span>, <span class="type">CError</span>&gt;()</span><br><span class="line">ps1</span><br><span class="line">    .print(<span class="string">&quot;ps1&quot;</span>)</span><br><span class="line">    .sink &#123; c <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;completion:&quot;</span>, c) <span class="comment">// send 了 .finished 后会执行</span></span><br><span class="line">    &#125; receiveValue: &#123; s <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;receive:&quot;</span>, s)</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    .store(in: <span class="operator">&amp;</span>cc)</span><br><span class="line"></span><br><span class="line">ps1.send(<span class="type">S</span>(p1: <span class="string">&quot;1&quot;</span>, p2: <span class="string">&quot;one&quot;</span>))</span><br><span class="line">ps1.send(completion: .failure(<span class="type">CError</span>.aE)) <span class="comment">// 和 .finished 一样后面就不会发送了</span></span><br><span class="line">ps1.send(<span class="type">S</span>(p1: <span class="string">&quot;2&quot;</span>, p2: <span class="string">&quot;two&quot;</span>))</span><br><span class="line">ps1.send(completion: .finished)</span><br><span class="line">ps1.send(<span class="type">S</span>(p1: <span class="string">&quot;3&quot;</span>, p2: <span class="string">&quot;three&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 多个订阅者</span></span><br><span class="line"><span class="keyword">let</span> ps2 <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">String</span>, <span class="type">Never</span>&gt;()</span><br><span class="line">ps2.send(<span class="string">&quot;one&quot;</span>) <span class="comment">// 订阅之前 send 的数据没有订阅者可以接收</span></span><br><span class="line">ps2.send(<span class="string">&quot;two&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sb1 <span class="operator">=</span> ps2</span><br><span class="line">    .print(<span class="string">&quot;ps2 sb1&quot;</span>)</span><br><span class="line">    .sink &#123; s <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(s)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">ps2.send(<span class="string">&quot;three&quot;</span>) <span class="comment">// 这个 send 的值会被 sb1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sb2 <span class="operator">=</span> ps2</span><br><span class="line">    .print(<span class="string">&quot;ps2 sb2&quot;</span>)</span><br><span class="line">    .sink &#123; s <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(s)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">ps2.send(<span class="string">&quot;four&quot;</span>) <span class="comment">// 这个 send 的值会被 sb1 和 sb2 接受</span></span><br><span class="line"></span><br><span class="line">sb1.store(in: <span class="operator">&amp;</span>cc)</span><br><span class="line">sb2.store(in: <span class="operator">&amp;</span>cc)</span><br><span class="line">ps2.send(completion: .finished)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ps1: receive subscription: (PassthroughSubject)</span><br><span class="line">ps1: request unlimited</span><br><span class="line">ps1: receive value: (S(p1: &quot;1&quot;, p2: &quot;one&quot;))</span><br><span class="line">receive: S(p1: &quot;1&quot;, p2: &quot;one&quot;)</span><br><span class="line">ps1: receive error: (aE)</span><br><span class="line">completion: failure(戴铭的开发小册子.AppDelegate.(unknown context at $10b15ce10).(unknown context at $10b15cf3c).CError.aE)</span><br><span class="line">ps2 sb1: receive subscription: (PassthroughSubject)</span><br><span class="line">ps2 sb1: request unlimited</span><br><span class="line">ps2 sb1: receive value: (three)</span><br><span class="line">three</span><br><span class="line">ps2 sb2: receive subscription: (PassthroughSubject)</span><br><span class="line">ps2 sb2: request unlimited</span><br><span class="line">ps2 sb1: receive value: (four)</span><br><span class="line">four</span><br><span class="line">ps2 sb2: receive value: (four)</span><br><span class="line">four</span><br><span class="line">ps2 sb1: receive finished</span><br><span class="line">ps2 sb2: receive finished</span><br></pre></td></tr></table></figure></p>
<h4 id="Empty"><a href="#Empty" class="headerlink" title="Empty"></a>Empty</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cc <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> p1: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> p2: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ept <span class="operator">=</span> <span class="type">Empty</span>&lt;<span class="type">S</span>, <span class="type">Never</span>&gt;() <span class="comment">// 加上 completeImmediately: false 后面即使用 replaceEmpty 也不会接受值</span></span><br><span class="line">ept</span><br><span class="line">    .print(<span class="string">&quot;ept&quot;</span>)</span><br><span class="line">    .sink &#123; c <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;completion:&quot;</span>, c)</span><br><span class="line">    &#125; receiveValue: &#123; s <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;receive:&quot;</span>, s)</span><br><span class="line">    &#125;</span><br><span class="line">    .store(in: <span class="operator">&amp;</span>cc)</span><br><span class="line"></span><br><span class="line">ept.replaceEmpty(with: <span class="type">S</span>(p1: <span class="string">&quot;1&quot;</span>, p2: <span class="string">&quot;one&quot;</span>))</span><br><span class="line">    .sink &#123; c <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;completion:&quot;</span>, c)</span><br><span class="line">    &#125; receiveValue: &#123; s <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;receive:&quot;</span>, s)</span><br><span class="line">    &#125;</span><br><span class="line">    .store(in: <span class="operator">&amp;</span>cc)</span><br></pre></td></tr></table></figure>
<p>输出<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ept: receive subscription: (Empty)</span><br><span class="line">ept: request unlimited</span><br><span class="line">ept: receive finished</span><br><span class="line">completion: finished</span><br><span class="line">receive: S(p1: &quot;1&quot;, p2: &quot;one&quot;)</span><br><span class="line">completion: finished</span><br></pre></td></tr></table></figure></p>
<h4 id="CurrentValueSubject"><a href="#CurrentValueSubject" class="headerlink" title="CurrentValueSubject"></a>CurrentValueSubject</h4><p>CurrentValueSubject 的订阅者可以收到订阅时已发出的那条数据</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cc <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> cs <span class="operator">=</span> <span class="type">CurrentValueSubject</span>&lt;<span class="type">String</span>, <span class="type">Never</span>&gt;(<span class="string">&quot;one&quot;</span>)</span><br><span class="line">cs.send(<span class="string">&quot;two&quot;</span>)</span><br><span class="line">cs.send(<span class="string">&quot;three&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> sb1 <span class="operator">=</span> cs</span><br><span class="line">    .print(<span class="string">&quot;cs sb1&quot;</span>)</span><br><span class="line">    .sink &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">cs.send(<span class="string">&quot;four&quot;</span>)</span><br><span class="line">cs.send(<span class="string">&quot;five&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sb2 <span class="operator">=</span> cs</span><br><span class="line">    .print(<span class="string">&quot;cs sb2&quot;</span>)</span><br><span class="line">    .sink &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">cs.send(<span class="string">&quot;six&quot;</span>)</span><br><span class="line"></span><br><span class="line">sb1.store(in: <span class="operator">&amp;</span>cc)</span><br><span class="line">sb2.store(in: <span class="operator">&amp;</span>cc)</span><br></pre></td></tr></table></figure>
<p>输出<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cs sb1: receive subscription: (CurrentValueSubject)</span><br><span class="line">cs sb1: request unlimited</span><br><span class="line">cs sb1: receive value: (three)</span><br><span class="line">three</span><br><span class="line">cs sb1: receive value: (four)</span><br><span class="line">four</span><br><span class="line">cs sb1: receive value: (five)</span><br><span class="line">five</span><br><span class="line">cs sb2: receive subscription: (CurrentValueSubject)</span><br><span class="line">cs sb2: request unlimited</span><br><span class="line">cs sb2: receive value: (five)</span><br><span class="line">five</span><br><span class="line">cs sb1: receive value: (six)</span><br><span class="line">six</span><br><span class="line">cs sb2: receive value: (six)</span><br><span class="line">six</span><br><span class="line">cs sb1: receive cancel</span><br><span class="line">cs sb2: receive cancel</span><br></pre></td></tr></table></figure></p>
<h4 id="removeDuplicates"><a href="#removeDuplicates" class="headerlink" title="removeDuplicates"></a>removeDuplicates</h4><p>使用 removeDuplicates，重复的值就不会发送了。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cc <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> pb <span class="operator">=</span> [<span class="string">&quot;one&quot;</span>,<span class="string">&quot;two&quot;</span>,<span class="string">&quot;three&quot;</span>,<span class="string">&quot;three&quot;</span>,<span class="string">&quot;four&quot;</span>]</span><br><span class="line">    .publisher</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sb <span class="operator">=</span> pb</span><br><span class="line">    .print(<span class="string">&quot;sb&quot;</span>)</span><br><span class="line">    .removeDuplicates()</span><br><span class="line">    .sink &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">sb.store(in: <span class="operator">&amp;</span>cc)</span><br></pre></td></tr></table></figure>
<p>输出<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sb: receive subscription: ([&quot;one&quot;, &quot;two&quot;, &quot;three&quot;, &quot;three&quot;, &quot;four&quot;])</span><br><span class="line">sb: request unlimited</span><br><span class="line">sb: receive value: (one)</span><br><span class="line">one</span><br><span class="line">sb: receive value: (two)</span><br><span class="line">two</span><br><span class="line">sb: receive value: (three)</span><br><span class="line">three</span><br><span class="line">sb: receive value: (three)</span><br><span class="line">sb: request max: (1) (synchronous)</span><br><span class="line">sb: receive value: (four)</span><br><span class="line">four</span><br><span class="line">sb: receive finished</span><br></pre></td></tr></table></figure></p>
<h4 id="flatMap"><a href="#flatMap" class="headerlink" title="flatMap"></a>flatMap</h4><p>flatMap 能将多个发布者的值打平发送给订阅者</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cc <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> p: <span class="type">AnyPublisher</span>&lt;<span class="type">String</span>, <span class="type">Never</span>&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> s1 <span class="operator">=</span> <span class="type">S</span>(p: <span class="type">Just</span>(<span class="string">&quot;one&quot;</span>).eraseToAnyPublisher())</span><br><span class="line"><span class="keyword">let</span> s2 <span class="operator">=</span> <span class="type">S</span>(p: <span class="type">Just</span>(<span class="string">&quot;two&quot;</span>).eraseToAnyPublisher())</span><br><span class="line"><span class="keyword">let</span> s3 <span class="operator">=</span> <span class="type">S</span>(p: <span class="type">Just</span>(<span class="string">&quot;three&quot;</span>).eraseToAnyPublisher())</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> pb <span class="operator">=</span> [s1, s2, s3].publisher</span><br><span class="line">    </span><br><span class="line"><span class="keyword">let</span> sb <span class="operator">=</span> pb</span><br><span class="line">    .print(<span class="string">&quot;sb&quot;</span>)</span><br><span class="line">    .flatMap &#123;</span><br><span class="line">        <span class="variable">$0</span>.p</span><br><span class="line">    &#125;</span><br><span class="line">    .sink &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">sb.store(in: <span class="operator">&amp;</span>cc)</span><br></pre></td></tr></table></figure>
<p>输出<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sb: receive subscription: ([戴铭的开发小册子.AppDelegate.(unknown context at $101167070).(unknown context at $1011670f4).S(p: AnyPublisher), 戴铭的开发小册子.AppDelegate.(unknown context at $101167070).(unknown context at $1011670f4).S(p: AnyPublisher), 戴铭的开发小册子.AppDelegate.(unknown context at $101167070).(unknown context at $1011670f4).S(p: AnyPublisher)])</span><br><span class="line">sb: request unlimited</span><br><span class="line">sb: receive value: (S(p: AnyPublisher))</span><br><span class="line">one</span><br><span class="line">sb: receive value: (S(p: AnyPublisher))</span><br><span class="line">two</span><br><span class="line">sb: receive value: (S(p: AnyPublisher))</span><br><span class="line">three</span><br><span class="line">sb: receive finished</span><br></pre></td></tr></table></figure></p>
<h4 id="append"><a href="#append" class="headerlink" title="append"></a>append</h4><p>append 会在发布者发布结束后追加发送数据，发布者不结束，append 的数据不会发送。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cc <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> pb <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">String</span>, <span class="type">Never</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sb <span class="operator">=</span> pb</span><br><span class="line">    .print(<span class="string">&quot;sb&quot;</span>)</span><br><span class="line">    .append(<span class="string">&quot;five&quot;</span>, <span class="string">&quot;six&quot;</span>)</span><br><span class="line">    .sink &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">sb.store(in: <span class="operator">&amp;</span>cc)</span><br><span class="line"></span><br><span class="line">pb.send(<span class="string">&quot;one&quot;</span>)</span><br><span class="line">pb.send(<span class="string">&quot;two&quot;</span>)</span><br><span class="line">pb.send(<span class="string">&quot;three&quot;</span>)</span><br><span class="line">pb.send(completion: .finished)</span><br></pre></td></tr></table></figure>
<p>输出<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sb: receive subscription: ([戴铭的开发小册子.AppDelegate.(unknown context at $101167070).(unknown context at $1011670f4).S(p: AnyPublisher), 戴铭的开发小册子.AppDelegate.(unknown context at $101167070).(unknown context at $1011670f4).S(p: AnyPublisher), 戴铭的开发小册子.AppDelegate.(unknown context at $101167070).(unknown context at $1011670f4).S(p: AnyPublisher)])</span><br><span class="line">sb: request unlimited</span><br><span class="line">sb: receive value: (S(p: AnyPublisher))</span><br><span class="line">one</span><br><span class="line">sb: receive value: (S(p: AnyPublisher))</span><br><span class="line">two</span><br><span class="line">sb: receive value: (S(p: AnyPublisher))</span><br><span class="line">three</span><br><span class="line">sb: receive finished</span><br></pre></td></tr></table></figure></p>
<h4 id="prepend"><a href="#prepend" class="headerlink" title="prepend"></a>prepend</h4><p>prepend 会在发布者发布前先发送数据，发布者不结束也不会受影响。发布者和集合也可以被打平发布。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cc <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> pb1 <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">String</span>, <span class="type">Never</span>&gt;()</span><br><span class="line"><span class="keyword">let</span> pb2 <span class="operator">=</span> [<span class="string">&quot;nine&quot;</span>, <span class="string">&quot;ten&quot;</span>].publisher</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sb <span class="operator">=</span> pb1</span><br><span class="line">    .print(<span class="string">&quot;sb&quot;</span>)</span><br><span class="line">    .prepend(pb2)</span><br><span class="line">    .prepend([<span class="string">&quot;seven&quot;</span>,<span class="string">&quot;eight&quot;</span>])</span><br><span class="line">    .prepend(<span class="string">&quot;five&quot;</span>, <span class="string">&quot;six&quot;</span>)</span><br><span class="line">    .sink &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">sb.store(in: <span class="operator">&amp;</span>cc)</span><br><span class="line"></span><br><span class="line">pb1.send(<span class="string">&quot;one&quot;</span>)</span><br><span class="line">pb1.send(<span class="string">&quot;two&quot;</span>)</span><br><span class="line">pb1.send(<span class="string">&quot;three&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>输出<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">five</span><br><span class="line">six</span><br><span class="line">seven</span><br><span class="line">eight</span><br><span class="line">nine</span><br><span class="line">ten</span><br><span class="line">sb: receive subscription: (PassthroughSubject)</span><br><span class="line">sb: request unlimited</span><br><span class="line">sb: receive value: (one)</span><br><span class="line">one</span><br><span class="line">sb: receive value: (two)</span><br><span class="line">two</span><br><span class="line">sb: receive value: (three)</span><br><span class="line">three</span><br><span class="line">sb: receive cancel</span><br></pre></td></tr></table></figure></p>
<h4 id="merge"><a href="#merge" class="headerlink" title="merge"></a>merge</h4><p>订阅者可以通过 merge 合并多个发布者发布的数据</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cc <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ps1 <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">String</span>, <span class="type">Never</span>&gt;()</span><br><span class="line"><span class="keyword">let</span> ps2 <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">String</span>, <span class="type">Never</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sb1 <span class="operator">=</span> ps1.merge(with: ps2)</span><br><span class="line">    .sink &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">ps1.send(<span class="string">&quot;one&quot;</span>)</span><br><span class="line">ps1.send(<span class="string">&quot;two&quot;</span>)</span><br><span class="line">ps2.send(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">ps2.send(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">ps1.send(<span class="string">&quot;three&quot;</span>)</span><br><span class="line"></span><br><span class="line">sb1.store(in: <span class="operator">&amp;</span>cc)</span><br></pre></td></tr></table></figure>
<p>输出<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sb1: receive subscription: (Merge)</span><br><span class="line">sb1: request unlimited</span><br><span class="line">sb1: receive value: (one)</span><br><span class="line">one</span><br><span class="line">sb1: receive value: (two)</span><br><span class="line">two</span><br><span class="line">sb1: receive value: (1)</span><br><span class="line">1</span><br><span class="line">sb1: receive value: (2)</span><br><span class="line">2</span><br><span class="line">sb1: receive value: (three)</span><br><span class="line">three</span><br><span class="line">sb1: receive cancel</span><br></pre></td></tr></table></figure></p>
<h4 id="zip"><a href="#zip" class="headerlink" title="zip"></a>zip</h4><p>zip 会合并多个发布者发布的数据，只有当多个发布者都发布了数据后才会组合成一个数据给订阅者。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cc <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ps1 <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">String</span>, <span class="type">Never</span>&gt;()</span><br><span class="line"><span class="keyword">let</span> ps2 <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">String</span>, <span class="type">Never</span>&gt;()</span><br><span class="line"><span class="keyword">let</span> ps3 <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">String</span>, <span class="type">Never</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sb1 <span class="operator">=</span> ps1.zip(ps2, ps3)</span><br><span class="line">    .print(<span class="string">&quot;sb1&quot;</span>)</span><br><span class="line">    .sink &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">ps1.send(<span class="string">&quot;one&quot;</span>)</span><br><span class="line">ps1.send(<span class="string">&quot;two&quot;</span>)</span><br><span class="line">ps1.send(<span class="string">&quot;three&quot;</span>)</span><br><span class="line">ps2.send(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">ps2.send(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">ps1.send(<span class="string">&quot;four&quot;</span>)</span><br><span class="line">ps2.send(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">ps3.send(<span class="string">&quot;一&quot;</span>)</span><br><span class="line"></span><br><span class="line">sb1.store(in: <span class="operator">&amp;</span>cc)</span><br></pre></td></tr></table></figure>
<p>输出<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sb1: receive subscription: (Zip)</span><br><span class="line">sb1: request unlimited</span><br><span class="line">sb1: receive value: ((&quot;one&quot;, &quot;1&quot;, &quot;一&quot;))</span><br><span class="line">(&quot;one&quot;, &quot;1&quot;, &quot;一&quot;)</span><br><span class="line">sb1: receive cancel</span><br></pre></td></tr></table></figure></p>
<h4 id="combineLatest"><a href="#combineLatest" class="headerlink" title="combineLatest"></a>combineLatest</h4><p>combineLatest 会合并多个发布者发布的数据，只有当多个发布者都发布了数据后才会触发合并，合并每个发布者发布的最后一个数据。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cc <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line">        </span><br><span class="line"><span class="keyword">let</span> ps1 <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">String</span>, <span class="type">Never</span>&gt;()</span><br><span class="line"><span class="keyword">let</span> ps2 <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">String</span>, <span class="type">Never</span>&gt;()</span><br><span class="line"><span class="keyword">let</span> ps3 <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">String</span>, <span class="type">Never</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sb1 <span class="operator">=</span> ps1.combineLatest(ps2, ps3)</span><br><span class="line">    .print(<span class="string">&quot;sb1&quot;</span>)</span><br><span class="line">    .sink &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">ps1.send(<span class="string">&quot;one&quot;</span>)</span><br><span class="line">ps1.send(<span class="string">&quot;two&quot;</span>)</span><br><span class="line">ps1.send(<span class="string">&quot;three&quot;</span>)</span><br><span class="line">ps2.send(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">ps2.send(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">ps1.send(<span class="string">&quot;four&quot;</span>)</span><br><span class="line">ps2.send(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">ps3.send(<span class="string">&quot;一&quot;</span>)</span><br><span class="line">ps3.send(<span class="string">&quot;二&quot;</span>)</span><br><span class="line"></span><br><span class="line">sb1.store(in: <span class="operator">&amp;</span>cc)</span><br></pre></td></tr></table></figure>
<p>输出<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sb1: receive subscription: (CombineLatest)</span><br><span class="line">sb1: request unlimited</span><br><span class="line">sb1: receive value: ((&quot;four&quot;, &quot;3&quot;, &quot;一&quot;))</span><br><span class="line">(&quot;four&quot;, &quot;3&quot;, &quot;一&quot;)</span><br><span class="line">sb1: receive value: ((&quot;four&quot;, &quot;3&quot;, &quot;二&quot;))</span><br><span class="line">(&quot;four&quot;, &quot;3&quot;, &quot;二&quot;)</span><br><span class="line">sb1: receive cancel</span><br></pre></td></tr></table></figure></p>
<h4 id="Scheduler"><a href="#Scheduler" class="headerlink" title="Scheduler"></a>Scheduler</h4><p>Scheduler 处理队列。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cc <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line">        </span><br><span class="line"><span class="keyword">let</span> sb1 <span class="operator">=</span> [<span class="string">&quot;one&quot;</span>,<span class="string">&quot;two&quot;</span>,<span class="string">&quot;three&quot;</span>].publisher</span><br><span class="line">    .print(<span class="string">&quot;sb1&quot;</span>)</span><br><span class="line">    .subscribe(on: <span class="type">DispatchQueue</span>.global())</span><br><span class="line">    .handleEvents(receiveOutput: &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;receiveOutput&quot;</span>,<span class="variable">$0</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .receive(on: <span class="type">DispatchQueue</span>.main)</span><br><span class="line">    .sink &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">sb1.store(in: <span class="operator">&amp;</span>cc)</span><br></pre></td></tr></table></figure>
<p>输出<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sb1: receive subscription: ([1, 2, 3])</span><br><span class="line">sb1: request unlimited</span><br><span class="line">sb1: receive value: (1)</span><br><span class="line">receiveOutput 1</span><br><span class="line">sb1: receive value: (2)</span><br><span class="line">receiveOutput 2</span><br><span class="line">sb1: receive value: (3)</span><br><span class="line">receiveOutput 3</span><br><span class="line">sb1: receive finished</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td></tr></table></figure></p>
<h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><h4 id="网络请求"><a href="#网络请求" class="headerlink" title="网络请求"></a>网络请求</h4><p>网络URLSession.dataTaskPublisher使用例子如下：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> req <span class="operator">=</span> <span class="type">URLRequest</span>(url: <span class="type">URL</span>(string: <span class="string">&quot;http://www.starming.com&quot;</span>)<span class="operator">!</span>)</span><br><span class="line"><span class="keyword">let</span> dpPublisher <span class="operator">=</span> <span class="type">URLSession</span>.shared.dataTaskPublisher(for: req)</span><br></pre></td></tr></table></figure></p>
<p>一个请求Github接口并展示结果的例子<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// CombineSearchAPI.swift</span></span><br><span class="line"><span class="comment">// SwiftOnly (iOS)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by Ming Dai on 2021/11/4.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CombineSearchAPI</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">GithubSearchView</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: Github View</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">GithubSearchView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="keyword">var</span> str: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;Swift&quot;</span></span><br><span class="line">  <span class="meta">@StateObject</span> <span class="keyword">var</span> ss: <span class="type">SearchStore</span> <span class="operator">=</span> <span class="type">SearchStore</span>()</span><br><span class="line">  <span class="meta">@State</span> <span class="keyword">var</span> repos: [<span class="type">GithubRepo</span>] <span class="operator">=</span> []</span><br><span class="line">  <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">NavigationView</span> &#123;</span><br><span class="line">      <span class="type">List</span> &#123;</span><br><span class="line">        <span class="type">TextField</span>(<span class="string">&quot;输入：&quot;</span>, text: <span class="variable">$str</span>, onCommit: fetch)</span><br><span class="line">        <span class="type">ForEach</span>(<span class="keyword">self</span>.ss.repos) &#123; repo -&gt; <span class="type">GithubRepoCell</span> <span class="keyword">in</span></span><br><span class="line">          <span class="type">GithubRepoCell</span>(repo: repo)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      .navigationTitle(<span class="string">&quot;搜索&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .onAppear(perform: fetch)</span><br><span class="line">  &#125;</span><br><span class="line">   </span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">fetch</span>()</span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.ss.search(str: <span class="keyword">self</span>.str)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">GithubRepoCell</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> repo: <span class="type">GithubRepo</span></span><br><span class="line">  <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">VStack</span>(alignment: .leading, spacing: <span class="number">20</span>) &#123;</span><br><span class="line">      <span class="type">Text</span>(<span class="keyword">self</span>.repo.name)</span><br><span class="line">      <span class="type">Text</span>(<span class="keyword">self</span>.repo.description)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: Github Service</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">GithubRepo</span>: <span class="title">Decodable</span>, <span class="title">Identifiable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> id: <span class="type">Int</span></span><br><span class="line">  <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">  <span class="keyword">let</span> description: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">GithubResp</span>: <span class="title">Decodable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> items: [<span class="type">GithubRepo</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">GithubSearchManager</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">search</span>(<span class="params">str</span>: <span class="type">String</span>)</span> -&gt; <span class="type">AnyPublisher</span>&lt;<span class="type">GithubResp</span>, <span class="type">Never</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">var</span> urlComponents <span class="operator">=</span> <span class="type">URLComponents</span>(string: <span class="string">&quot;https://api.github.com/search/repositories&quot;</span>) <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">preconditionFailure</span>(<span class="string">&quot;链接无效&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    urlComponents.queryItems <span class="operator">=</span> [<span class="type">URLQueryItem</span>(name: <span class="string">&quot;q&quot;</span>, value: str)]</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> url <span class="operator">=</span> urlComponents.url <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">preconditionFailure</span>(<span class="string">&quot;链接无效&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> sch <span class="operator">=</span> <span class="type">DispatchQueue</span>(label: <span class="string">&quot;API&quot;</span>, qos: .default, attributes: .concurrent)</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">return</span> <span class="type">URLSession</span>.shared</span><br><span class="line">      .dataTaskPublisher(for: url)</span><br><span class="line">      .receive(on: sch)</span><br><span class="line">      .tryMap(&#123; element -&gt; <span class="type">Data</span> <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="type">String</span>(decoding: element.data, as: <span class="type">UTF8</span>.<span class="keyword">self</span>))</span><br><span class="line">        <span class="keyword">return</span> element.data</span><br><span class="line">      &#125;)</span><br><span class="line">      .decode(type: <span class="type">GithubResp</span>.<span class="keyword">self</span>, decoder: <span class="type">JSONDecoder</span>())</span><br><span class="line">      .catch &#123; <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">        <span class="type">Empty</span>().eraseToAnyPublisher()</span><br><span class="line">      &#125;</span><br><span class="line">      .eraseToAnyPublisher()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">SearchStore</span>: <span class="title">ObservableObject</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Published</span> <span class="keyword">var</span> query: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="meta">@Published</span> <span class="keyword">var</span> repos: [<span class="type">GithubRepo</span>] <span class="operator">=</span> []</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> searchManager: <span class="type">GithubSearchManager</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> cancellable <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line">   </span><br><span class="line">  <span class="function"><span class="keyword">init</span>(<span class="params">searchManager</span>: <span class="type">GithubSearchManager</span> <span class="operator">=</span> <span class="type">GithubSearchManager</span>())</span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.searchManager <span class="operator">=</span> searchManager</span><br><span class="line">    <span class="variable">$query</span></span><br><span class="line">      .debounce(for: .milliseconds(<span class="number">500</span>), scheduler: <span class="type">RunLoop</span>.main)</span><br><span class="line">      .flatMap &#123; query -&gt; <span class="type">AnyPublisher</span>&lt;[<span class="type">GithubRepo</span>], <span class="type">Never</span>&gt; <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">return</span> searchManager.search(str: query)</span><br><span class="line">          .map &#123;</span><br><span class="line">            <span class="variable">$0</span>.items</span><br><span class="line">          &#125;</span><br><span class="line">          .eraseToAnyPublisher()</span><br><span class="line">      &#125;</span><br><span class="line">      .receive(on: <span class="type">DispatchQueue</span>.main)</span><br><span class="line">      .assign(to: \.repos, on: <span class="keyword">self</span>)</span><br><span class="line">      .store(in: <span class="operator">&amp;</span>cancellable)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">search</span>(<span class="params">str</span>: <span class="type">String</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.query <span class="operator">=</span> str</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>抽象基础网络能力，方便扩展，代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// CombineAPI.swift</span></span><br><span class="line"><span class="comment">// SwiftOnly (iOS)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by Ming Dai on 2021/11/4.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CombineAPI</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">RepListView</span>(vm: .<span class="keyword">init</span>())</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">RepListView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">  <span class="meta">@ObservedObject</span> <span class="keyword">var</span> vm: <span class="type">RepListVM</span></span><br><span class="line">   </span><br><span class="line">  <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">NavigationView</span> &#123;</span><br><span class="line">      <span class="type">List</span>(vm.repos) &#123; rep <span class="keyword">in</span></span><br><span class="line">        <span class="type">RepListCell</span>(rep: rep)</span><br><span class="line">      &#125;</span><br><span class="line">      .alert(isPresented: <span class="variable">$vm</span>.isErrorShow) &#123; () -&gt; <span class="type">Alert</span> <span class="keyword">in</span></span><br><span class="line">        <span class="type">Alert</span>(title: <span class="type">Text</span>(<span class="string">&quot;出错了&quot;</span>), message: <span class="type">Text</span>(vm.errorMessage))</span><br><span class="line">      &#125;</span><br><span class="line">      .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;仓库&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    .onAppear &#123;</span><br><span class="line">      vm.apply(.onAppear)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">RepListCell</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="keyword">var</span> rep: <span class="type">RepoModel</span></span><br><span class="line">  <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">HStack</span>() &#123;</span><br><span class="line">      <span class="type">VStack</span>() &#123;</span><br><span class="line">        <span class="type">AsyncImage</span>(url: <span class="type">URL</span>(string: rep.owner.avatarUrl <span class="operator">??</span> <span class="string">&quot;&quot;</span>), content: &#123; image <span class="keyword">in</span></span><br><span class="line">          image</span><br><span class="line">            .resizable()</span><br><span class="line">            .aspectRatio(contentMode: .fit)</span><br><span class="line">            .frame(width: <span class="number">100</span>, height: <span class="number">100</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        placeholder: &#123;</span><br><span class="line">          <span class="type">ProgressView</span>()</span><br><span class="line">            .frame(width: <span class="number">100</span>, height: <span class="number">100</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;<span class="subst">\(rep.owner.login)</span>&quot;</span>)</span><br><span class="line">          .font(.system(size: <span class="number">10</span>))</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">VStack</span>(alignment: .leading, spacing: <span class="number">10</span>) &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;<span class="subst">\(rep.name)</span>&quot;</span>)</span><br><span class="line">          .font(.title)</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;<span class="subst">\(rep.stargazersCount)</span>&quot;</span>)</span><br><span class="line">          .font(.title3)</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;<span class="subst">\(String(describing: rep.description <span class="operator">??</span> <span class="string">&quot;&quot;</span>))</span>&quot;</span>)</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;<span class="subst">\(String(describing: rep.language <span class="operator">??</span> <span class="string">&quot;&quot;</span>))</span>&quot;</span>)</span><br><span class="line">          .font(.title3)</span><br><span class="line">      &#125;</span><br><span class="line">      .font(.system(size: <span class="number">14</span>))</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: Repo View Model</span></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">RepListVM</span>: <span class="title">ObservableObject</span>, <span class="title">UnidirectionalDataFlowType</span> </span>&#123;</span><br><span class="line">  <span class="keyword">typealias</span> <span class="type">InputType</span> <span class="operator">=</span> <span class="type">Input</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> cancellables: [<span class="type">AnyCancellable</span>] <span class="operator">=</span> []</span><br><span class="line">   </span><br><span class="line">  <span class="comment">// Input</span></span><br><span class="line">  <span class="class"><span class="keyword">enum</span> <span class="title">Input</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> onAppear</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">apply</span>(<span class="keyword">_</span> <span class="params">input</span>: <span class="type">Input</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> input &#123;</span><br><span class="line">    <span class="keyword">case</span> .onAppear:</span><br><span class="line">      onAppearSubject.send(())</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> onAppearSubject <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">Void</span>, <span class="type">Never</span>&gt;()</span><br><span class="line">   </span><br><span class="line">  <span class="comment">// Output</span></span><br><span class="line">  <span class="meta">@Published</span> <span class="keyword">private(set)</span> <span class="keyword">var</span> repos: [<span class="type">RepoModel</span>] <span class="operator">=</span> []</span><br><span class="line">  <span class="meta">@Published</span> <span class="keyword">var</span> isErrorShow <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">  <span class="meta">@Published</span> <span class="keyword">var</span> errorMessage <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="meta">@Published</span> <span class="keyword">private(set)</span> <span class="keyword">var</span> shouldShowIcon <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">   </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> resSubject <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">SearchRepoModel</span>, <span class="type">Never</span>&gt;()</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> errSubject <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">APISevError</span>, <span class="type">Never</span>&gt;()</span><br><span class="line">   </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> apiSev: <span class="type">APISev</span></span><br><span class="line">   </span><br><span class="line">  <span class="function"><span class="keyword">init</span>(<span class="params">apiSev</span>: <span class="type">APISev</span> <span class="operator">=</span> <span class="type">APISev</span>())</span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.apiSev <span class="operator">=</span> apiSev</span><br><span class="line">    bindInputs()</span><br><span class="line">    bindOutputs()</span><br><span class="line">  &#125;</span><br><span class="line">   </span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">bindInputs</span>()</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> req <span class="operator">=</span> <span class="type">SearchRepoRequest</span>()</span><br><span class="line">    <span class="keyword">let</span> resPublisher <span class="operator">=</span> onAppearSubject</span><br><span class="line">      .flatMap &#123; [apiSev] <span class="keyword">in</span></span><br><span class="line">        apiSev.response(from: req)</span><br><span class="line">          .catch &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] error -&gt; <span class="type">Empty</span>&lt;<span class="type">SearchRepoModel</span>, <span class="type">Never</span>&gt; <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span><span class="operator">?</span>.errSubject.send(error)</span><br><span class="line">            <span class="keyword">return</span> .<span class="keyword">init</span>()</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">let</span> resStream <span class="operator">=</span> resPublisher</span><br><span class="line">      .share()</span><br><span class="line">      .subscribe(resSubject)</span><br><span class="line">     </span><br><span class="line">    <span class="comment">// 其它异步事件，比如日志等操作都可以做成Stream加到下面数组内。</span></span><br><span class="line">    cancellables <span class="operator">+=</span> [resStream]</span><br><span class="line">  &#125;</span><br><span class="line">   </span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">bindOutputs</span>()</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> repStream <span class="operator">=</span> resSubject</span><br><span class="line">      .map &#123;</span><br><span class="line">        <span class="variable">$0</span>.items</span><br><span class="line">      &#125;</span><br><span class="line">      .assign(to: \.repos, on: <span class="keyword">self</span>)</span><br><span class="line">    <span class="keyword">let</span> errMsgStream <span class="operator">=</span> errSubject</span><br><span class="line">      .map &#123; error -&gt; <span class="type">String</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">switch</span> error &#123;</span><br><span class="line">        <span class="keyword">case</span> .resError: <span class="keyword">return</span> <span class="string">&quot;network error&quot;</span></span><br><span class="line">        <span class="keyword">case</span> .parseError: <span class="keyword">return</span> <span class="string">&quot;parse error&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      .assign(to: \.errorMessage, on: <span class="keyword">self</span>)</span><br><span class="line">    <span class="keyword">let</span> errStream <span class="operator">=</span> errSubject</span><br><span class="line">      .map &#123; <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">        <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">      .assign(to: \.isErrorShow, on: <span class="keyword">self</span>)</span><br><span class="line">    cancellables <span class="operator">+=</span> [repStream,errStream,errMsgStream]</span><br><span class="line">  &#125;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">UnidirectionalDataFlowType</span> </span>&#123;</span><br><span class="line">  <span class="keyword">associatedtype</span> <span class="type">InputType</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">apply</span>(<span class="keyword">_</span> <span class="params">input</span>: <span class="type">InputType</span>)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: Repo Request and Models</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SearchRepoRequest</span>: <span class="title">APIReqType</span> </span>&#123;</span><br><span class="line">  <span class="keyword">typealias</span> <span class="type">Res</span> <span class="operator">=</span> <span class="type">SearchRepoModel</span></span><br><span class="line">   </span><br><span class="line">  <span class="keyword">var</span> path: <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;/search/repositories&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> qItems: [<span class="type">URLQueryItem</span>]<span class="operator">?</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">      .<span class="keyword">init</span>(name: <span class="string">&quot;q&quot;</span>, value: <span class="string">&quot;Combine&quot;</span>),</span><br><span class="line">      .<span class="keyword">init</span>(name: <span class="string">&quot;order&quot;</span>, value: <span class="string">&quot;desc&quot;</span>)</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SearchRepoModel</span>: <span class="title">Decodable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> items: [<span class="type">RepoModel</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">RepoModel</span>: <span class="title">Decodable</span>, <span class="title">Hashable</span>, <span class="title">Identifiable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> id: <span class="type">Int64</span></span><br><span class="line">  <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">  <span class="keyword">var</span> fullName: <span class="type">String</span></span><br><span class="line">  <span class="keyword">var</span> description: <span class="type">String</span>?</span><br><span class="line">  <span class="keyword">var</span> stargazersCount: <span class="type">Int</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">  <span class="keyword">var</span> language: <span class="type">String</span>?</span><br><span class="line">  <span class="keyword">var</span> owner: <span class="type">OwnerModel</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">OwnerModel</span>: <span class="title">Decodable</span>, <span class="title">Hashable</span>, <span class="title">Identifiable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> id: <span class="type">Int64</span></span><br><span class="line">  <span class="keyword">var</span> login: <span class="type">String</span></span><br><span class="line">  <span class="keyword">var</span> avatarUrl: <span class="type">String</span>?</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: API Request Fundation</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">APIReqType</span> </span>&#123;</span><br><span class="line">  <span class="keyword">associatedtype</span> <span class="type">Res</span>: <span class="type">Decodable</span></span><br><span class="line">  <span class="keyword">var</span> path: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">  <span class="keyword">var</span> qItems: [<span class="type">URLQueryItem</span>]<span class="operator">?</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">APISevType</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">response</span>&lt;<span class="type">Request</span>&gt;(<span class="params">from</span> <span class="params">req</span>: <span class="type">Request</span>)</span> -&gt; <span class="type">AnyPublisher</span>&lt;<span class="type">Request</span>.<span class="type">Res</span>, <span class="type">APISevError</span>&gt; <span class="keyword">where</span> <span class="type">Request</span>: <span class="type">APIReqType</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">APISev</span>: <span class="title">APISevType</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> rootUrl: <span class="type">URL</span></span><br><span class="line">  <span class="function"><span class="keyword">init</span>(<span class="params">rootUrl</span>: <span class="type">URL</span> <span class="operator">=</span> <span class="type">URL</span>(string: <span class="string">&quot;https://api.github.com&quot;</span>)<span class="operator">!</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.rootUrl <span class="operator">=</span> rootUrl</span><br><span class="line">  &#125;</span><br><span class="line">   </span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">response</span>&lt;<span class="type">Request</span>&gt;(<span class="params">from</span> <span class="params">req</span>: <span class="type">Request</span>)</span> -&gt; <span class="type">AnyPublisher</span>&lt;<span class="type">Request</span>.<span class="type">Res</span>, <span class="type">APISevError</span>&gt; <span class="keyword">where</span> <span class="type">Request</span> : <span class="type">APIReqType</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> path <span class="operator">=</span> <span class="type">URL</span>(string: req.path, relativeTo: rootUrl)<span class="operator">!</span></span><br><span class="line">    <span class="keyword">var</span> comp <span class="operator">=</span> <span class="type">URLComponents</span>(url: path, resolvingAgainstBaseURL: <span class="literal">true</span>)<span class="operator">!</span></span><br><span class="line">    comp.queryItems <span class="operator">=</span> req.qItems</span><br><span class="line">    <span class="built_in">print</span>(comp.url<span class="operator">?</span>.description <span class="operator">??</span> <span class="string">&quot;url wrong&quot;</span>)</span><br><span class="line">    <span class="keyword">var</span> req <span class="operator">=</span> <span class="type">URLRequest</span>(url: comp.url<span class="operator">!</span>)</span><br><span class="line">    req.addValue(<span class="string">&quot;application/json&quot;</span>, forHTTPHeaderField: <span class="string">&quot;Content-Type&quot;</span>)</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">let</span> de <span class="operator">=</span> <span class="type">JSONDecoder</span>()</span><br><span class="line">    de.keyDecodingStrategy <span class="operator">=</span> .convertFromSnakeCase</span><br><span class="line">    <span class="keyword">return</span> <span class="type">URLSession</span>.shared.dataTaskPublisher(for: req)</span><br><span class="line">      .map &#123; data, res <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="type">String</span>(decoding: data, as: <span class="type">UTF8</span>.<span class="keyword">self</span>))</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line">      &#125;</span><br><span class="line">      .mapError &#123; <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">        <span class="type">APISevError</span>.resError</span><br><span class="line">      &#125;</span><br><span class="line">      .decode(type: <span class="type">Request</span>.<span class="type">Res</span>.<span class="keyword">self</span>, decoder: de)</span><br><span class="line">      .mapError(<span class="type">APISevError</span>.parseError)</span><br><span class="line">      .receive(on: <span class="type">RunLoop</span>.main)</span><br><span class="line">      .eraseToAnyPublisher()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">APISevError</span>: <span class="title">Error</span> </span>&#123;</span><br><span class="line">  <span class="keyword">case</span> resError</span><br><span class="line">  <span class="keyword">case</span> parseError(<span class="type">Error</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="KVO"><a href="#KVO" class="headerlink" title="KVO"></a>KVO</h4><p>例子如下：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">KVOObject</span>: <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">  <span class="keyword">@objc</span> <span class="keyword">dynamic</span> <span class="keyword">var</span> intV: <span class="type">Int</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">  <span class="keyword">@objc</span> <span class="keyword">dynamic</span> <span class="keyword">var</span> boolV: <span class="type">Bool</span> <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> o <span class="operator">=</span> <span class="type">KVOObject</span>()</span><br><span class="line"><span class="keyword">let</span> <span class="keyword">_</span> <span class="operator">=</span> o.publisher(for: \.intV)</span><br><span class="line">  .sink &#123; v <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;value : <span class="subst">\(v)</span>&quot;</span>)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="通知"><a href="#通知" class="headerlink" title="通知"></a>通知</h4><p>使用例子如下：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Notification</span>.<span class="title">Name</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> noti <span class="operator">=</span> <span class="type">Notification</span>.<span class="type">Name</span>(<span class="string">&quot;nameofnoti&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> notiPb <span class="operator">=</span> <span class="type">NotificationCenter</span>.default.publisher(for: .noti, object: <span class="literal">nil</span>)</span><br><span class="line">        .sink &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></p>
<p>退到后台接受通知的例子如下：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> storage <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line">   </span><br><span class="line">  <span class="function"><span class="keyword">init</span>()</span> &#123;</span><br><span class="line">    <span class="type">NotificationCenter</span>.default.publisher(for: <span class="type">UIWindowScene</span>.didEnterBackgroundNotification)</span><br><span class="line">      .sink &#123; <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;enter background&quot;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      .store(in: <span class="operator">&amp;</span><span class="keyword">self</span>.storage)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="Timer"><a href="#Timer" class="headerlink" title="Timer"></a>Timer</h4><p>使用方式如下：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> timePb <span class="operator">=</span> <span class="type">Timer</span>.publish(every: <span class="number">1.0</span>, on: <span class="type">RunLoop</span>.main, in: .default)</span><br><span class="line"><span class="keyword">let</span> timeSk <span class="operator">=</span> timePb.sink &#123; r <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;r is <span class="subst">\(r)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> cPb <span class="operator">=</span> timePb.connect()</span><br></pre></td></tr></table></figure></p>
<h2 id="Concurrency"><a href="#Concurrency" class="headerlink" title="Concurrency"></a>Concurrency</h2><h3 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h3><h4 id="Swift-Concurrency-是什么？"><a href="#Swift-Concurrency-是什么？" class="headerlink" title="Swift Concurrency 是什么？"></a>Swift Concurrency 是什么？</h4><p>ABI 稳定后，Swift 的核心团队可以开始关注 Swift 语言一直缺失的原生并发能力了。最初是由 <a target="_blank" rel="noopener" href="https://twitter.com/clattner_llvm">Chris Lattner</a> 在17年发的 <a target="_blank" rel="noopener" href="https://gist.github.com/lattner/31ed37682ef1576b16bca1432ea9f782">Swift并发宣言</a> ，从此开阔了大家的眼界。后来 Swift Evolution 社区讨论了十几个提案，几十个方案，以及几百页的设计文件，做了大量的改进，社区中用户积极的参与反馈，Chris 也一直在 Evolution 中积极的参与设计。</p>
<p>Swift Concurrency 的实现用了 <a target="_blank" rel="noopener" href="https://llvm.org/docs/Coroutines.html">LLVM的协程</a> 把 async/await 函数转换为基于回调的代码，这个过程发生在编译后期，这个阶段你的代码都没法辨识了。异步的函数被实现为 coroutines，在每次异步调用时，函数被分割成可调用的函数部分和后面恢复的部分。coroutine 拆分的过程发生在生成LLVM IR阶段。Swift使用了哪些带有自定义调用约定的函数保证尾部调用，并专门为Swift进行了调整。</p>
<p>Swift Concurrency 不是建立在 GCD 上，而是使用的一个全新的线程池。GCD 中启动队列工作会很快在提起线程，一个队列阻塞了线程，就会生成一个新线程。基于这种机制 GCD 线程数很容易比 CPU 核心数量多，线程多了，线程就会有大量的调度开销，大量的上下文切换，会使 CPU 运行效率降低。而 Swift Concurrency 的线程数量不会超过 CPU 内核，将上下文切换放到同一个线程中去做。为了实现线程不被阻塞，需要通过语言特性来做。做法是，每个线程都有一个堆栈记录函数调用情况，一个函数占一个帧。函数返回后，这个函数所占的帧就会从堆栈弹出。await 的 async 函数被作为异步帧保存在堆上等待恢复，而不阻碍其它函数入栈执行。在 await 后运行的代码叫 continuation，continuation 会在要恢复时放回到线程的堆栈里。异步帧会根据需要放回栈上。在一个异步函数中调用同步代码将添加帧到线程的堆栈中。这样线程就能够一直向前跑，而不用创建更多线程减少调度。</p>
<p>Douglas 在 Swift 论坛里发的 Swift Concurrency 下个版本的规划贴  <a target="_blank" rel="noopener" href="https://forums.swift.org/t/concurrency-in-swift-5-and-6/49337">Concurrency in Swift 5 and 6</a> ，论坛里还有一个帖子是专门用来 <a target="_blank" rel="noopener" href="https://forums.swift.org/t/swift-concurrency-feedback-wanted/49336">征集Swift Concurrency意见</a> 的，帖子本身列出了 Swift Concurrency 相关的所有提案，也提出欢迎有新提案发出来，除了这些提案可以看外，帖子回复目前已经过百，非常热闹，可以看出大家对 Swift Concurrency 的关注度相当的高。</p>
<p>非常多的人参与了 Swift Concurrency 才使其看起来和用起来那么简单。Doug Gregor 在参与 John Sundell 的播客后，发了很多条推聊 Swift Concurrency，可以看到参与的人非常多，可见背后付出的努力有多大。下面我汇总了 Doug Gregor 在推上发的一些信息，你通过这些信息也可以了解 Swift Concurrency 幕后信息，所做的事和负责的人。</p>
<p> <a target="_blank" rel="noopener" href="https://twitter.com/pathofshrines">@pathofshrines</a> 是 Swift Concurrency 整体架构师，包括低级别运行时和编译器相关细节。 <a target="_blank" rel="noopener" href="https://twitter.com/illian">@illian</a> 是 async sequences、stream 和 Fundation 的负责人。 <a target="_blank" rel="noopener" href="https://twitter.com/optshiftk">@optshiftk</a> 对 UI 和并发交互的极好的洞察力带来了很棒的 async 接口， <a target="_blank" rel="noopener" href="https://twitter.com/phausler">@phausler</a> 带来了 async sequences。Arnold Schwaighofer、 <a target="_blank" rel="noopener" href="https://twitter.com/neightchan">@neightchan</a> 、 <a target="_blank" rel="noopener" href="https://twitter.com/typesanitizer">@typesanitizer</a> 还有 Tim Northover 实现了 async calling convention。</p>
<p> <a target="_blank" rel="noopener" href="https://twitter.com/ktosopl">@ktosopl</a> 有很深厚的 actor、分布式计算和 Swift-on-Server 经验，带来了 actor 系统。Erik Eckstein 为 async 函数和actors建立了关键的优化和功能。</p>
<p>SwiftUI是 <a target="_blank" rel="noopener" href="https://twitter.com/ricketson_">@ricketson_</a> 和 <a target="_blank" rel="noopener" href="https://twitter.com/luka_bernardi">@luka_bernardi</a> 完成的async接口。async I/O的接口是 <a target="_blank" rel="noopener" href="https://twitter.com/Catfish_Man">@Catfish_Man</a> 完成的。 <a target="_blank" rel="noopener" href="https://twitter.com/slava_pestov">@slava_pestov</a> 处理了 Swift 泛型问题，还指导其他人编译器实现的细节。async 重构工具是Ben Barham 做的。大量代码移植到 async 是由 <a target="_blank" rel="noopener" href="https://twitter.com/AirspeedSwift">@AirspeedSwift</a> 领导，由 Angela Laar，Clack Cole，Nicole Jacques 和 <a target="_blank" rel="noopener" href="https://twitter.com/mishaldshah">@mishaldshah</a> 共同完成的。</p>
<p> <a target="_blank" rel="noopener" href="https://twitter.com/lorentey">@lorentey</a> 负责 Swift 接口的改进。 <a target="_blank" rel="noopener" href="https://twitter.com/jckarter">@jckarter</a> 有着敏锐的语言设计洞察力，带来了语言设计经验和编译器及运行时实现技能。 <a target="_blank" rel="noopener" href="https://twitter.com/mikeash">@mikeash</a>  也参与了运行时开发中。操作系统的集成是 <a target="_blank" rel="noopener" href="https://twitter.com/rokhinip">@rokhinip</a> 完成的， <a target="_blank" rel="noopener" href="https://twitter.com/chimz">@chimz</a> 提供了关于 Dispatch 和 OS 很好的建议，Pavel Yaskevich 和<br> <a href="https://ming1016.github.io/2021/07/24/my-little-idea-about-writing-technical-article/">@hollyborla</a> 进行了并发所需要关键类型检查器的改进。 <a target="_blank" rel="noopener" href="https://twitter.com/kastiglione">@kastiglione</a> 、Adrian Prantl和 <a target="_blank" rel="noopener" href="https://twitter.com/fred_riss">@fred_riss</a> 实现了调试。 <a target="_blank" rel="noopener" href="https://twitter.com/etcwilde">@etcwilde</a> 和 <a target="_blank" rel="noopener" href="https://twitter.com/call1cc">@call1cc</a> 实现了语义模型中的重要部分。</p>
<p> <a target="_blank" rel="noopener" href="https://twitter.com/evonox">@evonox</a> 负责了服务器Linux 的支持。 <a target="_blank" rel="noopener" href="https://twitter.com/compnerd">@compnerd</a> 将 Swift Concurrency 移植到了 Windows。</p>
<p>Swift Concurrency 模型简单，细节都被隐藏了，比 Kotlin 和 C++的 Coroutine 接口要简洁很多。比如 Task 接口形式就很简洁。Swift Concurrency 大体可分为 async/await、Async Sequences、结构化并发和 Actors。</p>
<h4 id="async-await"><a href="#async-await" class="headerlink" title="async/await"></a>async/await</h4><p>通过类似 throws 语法的 async 来指定函数为异步函数，异步函数才能够使用 await，使用异步函数要用 await。await 修饰在 suspension point 时当前线程可以让给其它任务执行，而不用阻塞当前线程，等 await 后面的函数执行完成再回来继续执行，这里需要注意的是回来执行不一定是在离开时的线程上。async/await 提案是 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0296-async-await.md">SE-0296</a> 。如果想把现有的异步开发带到 async/await 世界，请使用 withCheckedThrowingContinuation。</p>
<p>async/await 还有一个非常明显的好处，就是不会再有[weak self] dance 了。</p>
<h4 id="Async-Sequences"><a href="#Async-Sequences" class="headerlink" title="Async Sequences"></a>Async Sequences</h4><p>AsyncSequence 的使用方式是 for-await-in 和 for-try-await-in，系统提供了一些接口，如下：</p>
<ul>
<li>FileHandle.standardInput.bytes.lines</li>
<li>URL.lines</li>
<li>URLSession.shared.data(from: URL)</li>
<li>let (localURL, _ ) = try await session.download(from: url) 下载和get请求数据区别是需要边请求边存储数据以减少内存占用</li>
<li>let (responseData, response) = try await session.upload(for: request, from: data)</li>
<li>URLSession.shared.bytes(from: URL)</li>
<li>NotificationCenter.default.notifications</li>
</ul>
<h4 id="结构化并发"><a href="#结构化并发" class="headerlink" title="结构化并发"></a>结构化并发</h4><p>使用这些接口可以一边接收数据一边进行显示，AsyncSequence 的提案是 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0298-asyncsequence.md">SE-0298</a> （Swift 5.5可用）。AsyncStream 是创建自己异步序列的最简单的方法，处理迭代、取消和缓冲。AsyncStream 正在路上，提案是 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0314-async-stream.md">SE-0314</a> 。</p>
<p>Task 为一组并发任务创建一个运行环境，async let 可以让任务并发执行，结构化并发（Structured concurrency，提案在路上 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0304-structured-concurrency.md">SE-0304</a> ）withTaskGroup 中 group.async 可以将并发任务进行分组。</p>
<h4 id="Actors"><a href="#Actors" class="headerlink" title="Actors"></a>Actors</h4><p>我们写的程序会在进程中被拆成一个一个小指令，这些指令会在某刻会一个接一个同步的或者并发的执行。系统会用多个线程执行并行的任务，执行顺序是调度器来管理的，现代多核可以同时处理多个线程，当一个资源在多个线程上同时被更改时就会出问题。并发任务对数据资源操作容易造成数据竞争，以前需要手动放到串行队列、使用锁、调度屏障或 Atomics 的方式来避免。以前处理容易导致昂贵的上下文切换，过多线程容易导致线程爆炸，容易意外阻断线程导致后面代码没法执行，多任务相互的等待造成了死锁，block 和内存引用容易出错等等问题。</p>
<p>现在 Swift Concurrency 可以通过 actor 来创建一个区域，在这个区域会自动进行数据安全保护，保证一定时间只有一个线程访问里面数据，防止数据竞争。actor 内部对成员访问是同步的，成员默认是隔离的，actor 外部对 actor 内成员的访问只能是异步的，隐式同步以防止数据竞争。MainActor 继承自能确保全局唯一实例的 GlobalActor，保证任务在主线程执行，这样你就可以抛弃掉在你的 ViewModel 里写 DispatchQueue.main.async 了。</p>
<p>Actors 的概念通常被用于分布式计算，Actor 模型参看 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Actor_model">Wikipedia</a> 里的详细解释，Swift 中的实现效果也非常的理想。Actors 的提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0306-actors.md">SE-0306</a> 已在 Swift 5.5落实。</p>
<p>很多语言都支持 actors 还有 async/await，实现的方式也类似，actor 使用的不是锁，而是用的 async/await 这样能够在一个线程中切换上下文来避免线程空闲的线程模型。actor 还利用编译器，提前做会引起并发问题的检查。</p>
<p>actor 是遵循 Sendable 协议的，只有结构体和 final 类才能够遵循 Sendable，继承于 Sendable 协议的 Excutor 协议表示方法本身，SerialExecutor 表示以串行方式执行。actor 使用 C++写的，源码在 <a target="_blank" rel="noopener" href="https://github.com/apple/swift/blob/main/stdlib/public/Concurrency/Actor.cpp">这里</a> ，可以看到 actor 主要是通过控制各个 job 执行的状态的管理器。job 执行优先级来自 Task 对象，排队时需要确保高优 job 先被执行。全局 Executor 用来为 job 排队，通知 actor 拥有或者放弃线程，实现在 <a target="_blank" rel="noopener" href="https://github.com/apple/swift/blob/main/stdlib/public/Concurrency/GlobalExecutor.cpp">这里</a> 。由于等待而放弃当前线程让其他 actor 执行的 actor，在收到全局 Executor 创建一个新的 job 的通知，使其可以进入一个可能不同线程，这个过程就是并发模型中描述的 Actor Reentrancy。</p>
<h4 id="相关提案"><a href="#相关提案" class="headerlink" title="相关提案"></a>相关提案</h4><p>所有相关提案清单如下：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0296-async-await.md">SE-0296: Async/await</a>   <a target="_blank" rel="noopener" href="https://kemchenj.github.io/2021-03-06/">【译】SE-0296 Async/await</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0317-async-let.md">SE-0317: async let</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0300-continuation.md">SE-0300: Continuations for interfacing async tasks with synchronous code</a>   <a target="_blank" rel="noopener" href="https://kemchenj.github.io/2021-03-31/">【译】SE-0300 Continuation – 执行同步代码的异步任务接口</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0302-concurrent-value-and-concurrent-closures.md">SE-0302: Sendable and @Sendable closures</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0298-asyncsequence.md">SE-0298: Async/Await: Sequences</a>   <a target="_blank" rel="noopener" href="https://kemchenj.github.io/2021-03-10/">【译】SE-0298 Async/Await 序列</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0304-structured-concurrency.md">SE-0304: Structured concurrency</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0306-actors.md">SE-0306: Actors</a>   <a target="_blank" rel="noopener" href="https://kemchenj.github.io/2021-04-25/">【译】SE-0306 Actors</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0313-actor-isolation-control.md">SE-0313: Improved control over actor isolation</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0297-concurrency-objc.md">SE-0297: Concurrency Interoperability with Objective-C</a>   <a target="_blank" rel="noopener" href="https://kemchenj.github.io/2021-03-07/">【译】SE-0297 Concurrency 与 Objective-C 的交互</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0314-async-stream.md">SE-0314: AsyncStream and AsyncThrowingStream</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0316-global-actors.md">SE-0316: Global actors</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0310-effectful-readonly-properties.md">SE-0310: Effectful read-only properties</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0311-task-locals.md">SE-0311: Task Local Values</a> </li>
<li><a target="_blank" rel="noopener" href="https://forums.swift.org/t/support-custom-executors-in-swift-concurrency/44425">Custom Executors</a> </li>
</ul>
<h4 id="学习路径"><a href="#学习路径" class="headerlink" title="学习路径"></a>学习路径</h4><p>如果打算尝试 Swift Concurrency 的话，按照先后顺序，可以先看官方手册介绍文章 <a target="_blank" rel="noopener" href="https://docs.swift.org/swift-book/LanguageGuide/Concurrency.html">Concurrency</a> 。再看 <a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2021/10132/">Meet async/await in Swift</a> 这个Session，了解背后原理看 <a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2021/10134">Explore structured concurrency in Swift</a> 。动手照着试示例代码，看Paul的 <a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/concurrency">Swift Concurrency by Example</a> 这个系列。接着看 <a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2021/10133">Protect mutable state with Swift actors</a> 来了解 actors 怎么防止数据竞争。通过 <a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2021/10019">Discover concurrency in SwiftUI</a> 看 concurrency 如何在 SwiftUI 中使用， <a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2021/10095">Use async/await with URLSession</a> 来看怎么在 URLSession 中使用 async/await。最后听听负责 Swift Concurrency 的 Doug Gregor 参加的一个 <a target="_blank" rel="noopener" href="https://www.swiftbysundell.com/podcast/99/">播客的访谈</a> ，了解下 Swift Concurrency 背后的故事。</p>
<h4 id="Swift-Concurrency-和-Combine"><a href="#Swift-Concurrency-和-Combine" class="headerlink" title="Swift Concurrency 和 Combine"></a>Swift Concurrency 和 Combine</h4><p>由于 Swift Concurrency 的推出和大量的 Session 发布，特别是 <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/swift/asyncsequence/">AsyncSequence</a> 的出现，以及正在路上的 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0314-async-stream.md">AsyncStream、AsyncThrowingStream</a> 和 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0300-continuation.md">continuation</a> 提案（在Xcode 13.0 beta 3 AsyncStream 正式 <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/swift/asyncstream?changes=latest_beta">release</a> ），这些越来越多和 Combine 功能重叠的特性出现在 Swift Concurrency 蓝图里时，大家开始猜测是否 Combine 会被 Swift Concurrency 替代。关于未来是 Swift Concurrency 还是 Combine，我的感觉是，Combine 更侧重在响应式编程上，而响应式编程并不是所有开发人员都会接受的，而 Swift Concurrency 是所有人都愿意接受的开发方式，从 Swift Concurrency 推出后开发者使用的数量和社区反应火热程度来看都比 Combine 要大。在苹果对 Combine 有下一步动作之前，我还是更偏向 Swift Concurrency。</p>
<h2 id="SwiftUI"><a href="#SwiftUI" class="headerlink" title="SwiftUI"></a>SwiftUI</h2><h3 id="介绍-2"><a href="#介绍-2" class="headerlink" title="介绍"></a>介绍</h3><h4 id="SwiftUI-是什么？"><a href="#SwiftUI-是什么？" class="headerlink" title="SwiftUI 是什么？"></a>SwiftUI 是什么？</h4><p>对于一个基于UIKit的项目是没有必要全部用SwiftUI重写的，在UIKit里使用SwiftUI的视图非常容易，UIHostingController是UIViewController的子类，可以直接用在UIKit里，因此直接将SwiftUI视图加到UIHostingController中，就可以在UIKit里使用SwiftUI视图了。</p>
<p>SwiftUI的布局核心是 GeometryReader、View Preferences和Anchor Preferences。如下图所示：</p>
<p><img src="https://user-images.githubusercontent.com/251980/142988837-ab49c202-9779-4c7a-8dc2-5584900c0765.png" alt=""></p>
<p>SwiftUI的数据流更适合Redux结构，如下图所示：</p>
<p><img src="https://user-images.githubusercontent.com/251980/142988879-af591aaf-161f-4f60-9891-d7b8d313f69f.png" alt=""></p>
<p>如上图，Redux结构是真正的单向单数据源结构，易于分割，能充分利用SwiftUI内置的数据流Property Wrapper。UI组件干净、体量小、可复用并且无业务逻辑，因此开发时可以聚焦于UI代码。业务逻辑放在一起，所有业务逻辑和数据Model都在Reducer里。 <a target="_blank" rel="noopener" href="https://github.com/Dimillian/ACHNBrowserUI">ACHNBrowserUI</a>  和  <a target="_blank" rel="noopener" href="https://github.com/Dimillian/MovieSwiftUI">MovieSwiftUI</a>  开源项目都是使用的Redux架构。最近比较瞩目的TCA（The Composable Architecture）也是类Redux/Elm的架构的框架， <a target="_blank" rel="noopener" href="https://github.com/pointfreeco/swift-composable-architecture">项目地址见</a> 。</p>
<p>提到数据流就不得不说下苹果公司新出的Combine，对标的是RxSwift，由于是苹果公司官方的库，所以应该优先选择。不过和SwiftUI一样，这两个新库对APP支持最低的系统版本都要求是iOS13及以上。那么怎么能够提前用上SwiftUI和Combine呢？或者说现在使用什么库可以以相同接口方式暂时替换它们，又能在以后改为SwiftUI和Combine时成本最小化呢？</p>
<p>对于SwiftUI，AcFun自研了声明式UI Ysera，类似SwiftUI的接口，并且重构了AcFun里收藏模块列表视图和交互逻辑，如下图所示：</p>
<p><img src="https://user-images.githubusercontent.com/251980/142988909-e6626954-2c93-4c34-b10e-5345c8015cea.png" alt=""></p>
<p>通过上图可以看到，swift代码量相比较OC减少了65%以上，原先使用Objective-C实现的相同功能代码超过了1000行，而Swift重写只需要350行，对于AcFun的业务研发工程师而言，同样的需求实现代码比之前少了至少30%，面对单周迭代这样的节奏，团队也变得更从容。代码可读性增加了，后期功能迭代和维护更容易了，Swift让AcFun驶入了iOS开发生态的“快车道”。</p>
<p>SwiftUI全部都是基于Swift的各大可提高开发效率特性完成的，比如前面提到的，能够访问只给语言特性级别行为的Property Wrapper，通过Property Wrapper包装代码逻辑，来降低代码复杂度，除了SwiftUI和Combine里@开头的Property Wrapper外，Swift还自带类似 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0195-dynamic-member-lookup.md">@dynamicMemberLookup</a>  和 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0216-dynamic-callable.md">@dynamicCallable</a>  这样重量级的Property Wrapper。还有 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0289-result-builders.md">ResultBuilder</a> 这种能够简化语法的特性，有些如GraphQL、REST和Networking实际使用ResultBuilder的 <a target="_blank" rel="noopener" href="https://github.com/carson-katri/awesome-result-builders">范例可以参考</a> 。这些Swift的特性如果也能得到充分利用，即使不用SwiftUI也能使开发效率得到大幅提升。</p>
<p>网飞（Netflix）App已使用SwiftUI重构了登录界面，网飞增长团队移动负责人故胤道长记录了SwiftUI在网飞的落地过程，详细描述了 <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/oRPRCx78owLe3_gROYapCw">SwiftUI的收益</a> 。网飞能够直接使用SwiftUI得益于他们最低支持iOS 13系统。</p>
<p>不过如最低支持系统低于iOS 13，还有开源项目 <a target="_blank" rel="noopener" href="https://github.com/rakutentech/AltSwiftUI">AltSwiftUI</a> 也实现了SwiftUI的语法和特性，能够向前兼容到iOS 11。</p>
<h3 id="视图组件使用"><a href="#视图组件使用" class="headerlink" title="视图组件使用"></a>视图组件使用</h3><h4 id="SwiftUI-对标的-UIKit-视图"><a href="#SwiftUI-对标的-UIKit-视图" class="headerlink" title="SwiftUI 对标的 UIKit 视图"></a>SwiftUI 对标的 UIKit 视图</h4><p>如下：</p>
<table>
<thead>
<tr>
<th>SwiftUI</th>
<th>UIKit</th>
</tr>
</thead>
<tbody>
<tr>
<td>Text 和 Label</td>
<td>UILabel</td>
</tr>
<tr>
<td>TextField</td>
<td>UITextField</td>
</tr>
<tr>
<td>TextEditor</td>
<td>UITextView</td>
</tr>
<tr>
<td>Button 和 Link</td>
<td>UIButton</td>
</tr>
<tr>
<td>Image</td>
<td>UIImageView</td>
</tr>
<tr>
<td>NavigationView</td>
<td>UINavigationController 和 UISplitViewController</td>
</tr>
<tr>
<td>ToolbarItem</td>
<td>UINavigationItem</td>
</tr>
<tr>
<td>ScrollView</td>
<td>UIScrollView</td>
</tr>
<tr>
<td>List</td>
<td>UITableView</td>
</tr>
<tr>
<td>LazyVGrid 和 LazyHGrid</td>
<td>UICollectionView</td>
</tr>
<tr>
<td>HStack 和 LazyHStack</td>
<td>UIStack</td>
</tr>
<tr>
<td>VStack 和 LazyVStack</td>
<td>UIStack</td>
</tr>
<tr>
<td>TabView</td>
<td>UITabBarController 和 UIPageViewController</td>
</tr>
<tr>
<td>Toggle</td>
<td>UISwitch</td>
</tr>
<tr>
<td>Slider</td>
<td>UISlider</td>
</tr>
<tr>
<td>Stepper</td>
<td>UIStepper</td>
</tr>
<tr>
<td>ProgressView</td>
<td>UIProgressView 和 UIActivityIndicatorView</td>
</tr>
<tr>
<td>Picker</td>
<td>UISegmentedControl</td>
</tr>
<tr>
<td>DatePicker</td>
<td>UIDatePicker</td>
</tr>
<tr>
<td>Alert</td>
<td>UIAlertController</td>
</tr>
<tr>
<td>ActionSheet</td>
<td>UIAlertController</td>
</tr>
<tr>
<td>Map</td>
<td>MapKit</td>
</tr>
</tbody>
</table>
<h4 id="Text"><a href="#Text" class="headerlink" title="Text"></a>Text</h4><p>基本用法</p>
<p><img src="https://user-images.githubusercontent.com/251980/154473546-94ba6f9f-2ce3-44ef-a7c6-60d86df8c90f.png" alt=""></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK: - Text</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PlayTextView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> manyString <span class="operator">=</span> <span class="string">&quot;这是一段长文。总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么吧。&quot;</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ScrollView</span> &#123;</span><br><span class="line">            <span class="type">Group</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;大标题&quot;</span>).font(.largeTitle)</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;说点啥呢？&quot;</span>)</span><br><span class="line">                    .tracking(<span class="number">30</span>) <span class="comment">// 字间距</span></span><br><span class="line">                    .kerning(<span class="number">30</span>) <span class="comment">// 尾部留白</span></span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;划重点&quot;</span>)</span><br><span class="line">                    .underline()</span><br><span class="line">                    .foregroundColor(.yellow)</span><br><span class="line">                    .fontWeight(.heavy)</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;可旋转的文字&quot;</span>)</span><br><span class="line">                    .rotationEffect(.degrees(<span class="number">45</span>))</span><br><span class="line">                    .fixedSize()</span><br><span class="line">                    .frame(width: <span class="number">20</span>, height: <span class="number">80</span>)</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;自定义系统字体大小&quot;</span>)</span><br><span class="line">                    .font(.system(size: <span class="number">30</span>))</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;使用指定的字体&quot;</span>)</span><br><span class="line">                    .font(.custom(<span class="string">&quot;Georgia&quot;</span>, size: <span class="number">24</span>))</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">Group</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;有阴影&quot;</span>)</span><br><span class="line">                    .font(.largeTitle)</span><br><span class="line">                    .foregroundColor(.orange)</span><br><span class="line">                    .bold()</span><br><span class="line">                    .italic()</span><br><span class="line">                    .shadow(color: .black, radius: <span class="number">1</span>, x: <span class="number">0</span>, y: <span class="number">2</span>)</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Gradient Background&quot;</span>)</span><br><span class="line">                    .font(.largeTitle)</span><br><span class="line">                    .padding()</span><br><span class="line">                    .foregroundColor(.white)</span><br><span class="line">                    .background(<span class="type">LinearGradient</span>(gradient: <span class="type">Gradient</span>(colors: [.white, .black, .red]), startPoint: .top, endPoint: .bottom))</span><br><span class="line">                    .cornerRadius(<span class="number">10</span>)</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Gradient Background&quot;</span>)</span><br><span class="line">                    .padding(<span class="number">5</span>)</span><br><span class="line">                    .foregroundColor(.white)</span><br><span class="line">                    .background(<span class="type">LinearGradient</span>(gradient: <span class="type">Gradient</span>(colors: [.white, .black, .purple]), startPoint: .leading, endPoint: .trailing))</span><br><span class="line">                    .cornerRadius(<span class="number">10</span>)</span><br><span class="line">                <span class="type">ZStack</span> &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;渐变透明材质风格&quot;</span>)</span><br><span class="line">                        .padding()</span><br><span class="line">                        .background(</span><br><span class="line">                            .regularMaterial,</span><br><span class="line">                            in: <span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">10</span>, style: .continuous)</span><br><span class="line">                        )</span><br><span class="line">                        .shadow(radius: <span class="number">10</span>)</span><br><span class="line">                        .padding()</span><br><span class="line">                        .font(.largeTitle.weight(.black))</span><br><span class="line">                &#125;</span><br><span class="line">                .frame(width: <span class="number">300</span>, height: <span class="number">200</span>)</span><br><span class="line">                .background(</span><br><span class="line">                    <span class="type">LinearGradient</span>(colors: [.yellow, .pink], startPoint: .topLeading, endPoint: .bottomTrailing)</span><br><span class="line">                )</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Angular Gradient Background&quot;</span>)</span><br><span class="line">                    .padding()</span><br><span class="line">                    .background(<span class="type">AngularGradient</span>(colors: [.red, .yellow, .green, .blue, .purple, .red], center: .center))</span><br><span class="line">                    .cornerRadius(<span class="number">20</span>)</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;带背景图片的&quot;</span>)</span><br><span class="line">                    .padding()</span><br><span class="line">                    .font(.largeTitle)</span><br><span class="line">                    .foregroundColor(.white)</span><br><span class="line">                    .background &#123;</span><br><span class="line">                        <span class="type">Rectangle</span>()</span><br><span class="line">                            .fill(<span class="type">Color</span>(.black))</span><br><span class="line">                            .cornerRadius(<span class="number">10</span>)</span><br><span class="line">                        <span class="type">Image</span>(<span class="string">&quot;logo&quot;</span>)</span><br><span class="line">                            .resizable()</span><br><span class="line">                            .frame(width: <span class="number">100</span>, height: <span class="number">100</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                    .frame(width: <span class="number">200</span>, height: <span class="number">100</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">Group</span> &#123;</span><br><span class="line">                <span class="comment">// 设置 lineLimit 表示最多支持行数，依据情况依然有会被减少显示行数</span></span><br><span class="line">                <span class="type">Text</span>(manyString)</span><br><span class="line">                    .lineLimit(<span class="number">3</span>) <span class="comment">// 对行的限制，如果多余设定行数，尾部会显示...</span></span><br><span class="line">                    .lineSpacing(<span class="number">10</span>) <span class="comment">// 行间距</span></span><br><span class="line">                    .multilineTextAlignment(.leading) <span class="comment">// 对齐</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 使用 fixedSize 就可以在任何时候完整显示</span></span><br><span class="line">                <span class="type">Text</span>(manyString)</span><br><span class="line">                    .fixedSize(horizontal: <span class="literal">false</span>, vertical: <span class="literal">true</span>)</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 使用 AttributeString</span></span><br><span class="line">            <span class="type">PTextViewAttribute</span>()</span><br><span class="line">                .padding()</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 使用 Markdown</span></span><br><span class="line">            <span class="type">PTextViewMarkdown</span>()</span><br><span class="line">                .padding()</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 时间</span></span><br><span class="line">            <span class="type">PTextViewDate</span>()</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 插值</span></span><br><span class="line">            <span class="type">PTextViewInterpolation</span>()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>font 字体设置的样式对应 weight 和 size 可以在官方交互文档中查看 <a target="_blank" rel="noopener" href="https://developer.apple.com/design/human-interface-guidelines/ios/visual-design/typography/#dynamic-type-sizes">Typography</a></p>
<p>markdown 使用<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK: - Markdown</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PTextViewMarkdown</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> mdaStr: <span class="type">AttributedString</span> <span class="operator">=</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> mda <span class="operator">=</span> <span class="type">AttributedString</span>(localized: <span class="string">&quot;这是一个 **Attribute** ~string~&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/// 自定义的属性语法是^[string](key：value)</span></span><br><span class="line">        mda <span class="operator">=</span> <span class="type">AttributedString</span>(localized: <span class="string">&quot;^[这是](p2:&#x27;one&#x27;)^[一](p3:&#123;k1:1,k2:2&#125;)个 **Attribute** ~string~&quot;</span>, including: \.newScope)</span><br><span class="line">        <span class="built_in">print</span>(mda)</span><br><span class="line">        <span class="comment">/// 这是 &#123;</span></span><br><span class="line">        <span class="comment">///     NSLanguage = en</span></span><br><span class="line">        <span class="comment">///     p2 = one</span></span><br><span class="line">        <span class="comment">/// &#125;</span></span><br><span class="line">        <span class="comment">/// 一 &#123;</span></span><br><span class="line">        <span class="comment">///     NSLanguage = en</span></span><br><span class="line">        <span class="comment">///     p3 = P3(k1: 1, k2: 2)</span></span><br><span class="line">        <span class="comment">/// &#125;</span></span><br><span class="line">        <span class="comment">/// 个  &#123;</span></span><br><span class="line">        <span class="comment">///     NSLanguage = en</span></span><br><span class="line">        <span class="comment">/// &#125;</span></span><br><span class="line">        <span class="comment">/// Attribute &#123;</span></span><br><span class="line">        <span class="comment">///     NSLanguage = en</span></span><br><span class="line">        <span class="comment">///     NSInlinePresentationIntent = NSInlinePresentationIntent(rawValue: 2)</span></span><br><span class="line">        <span class="comment">/// &#125;</span></span><br><span class="line">        <span class="comment">///   &#123;</span></span><br><span class="line">        <span class="comment">///     NSLanguage = en</span></span><br><span class="line">        <span class="comment">/// &#125;</span></span><br><span class="line">        <span class="comment">/// string &#123;</span></span><br><span class="line">        <span class="comment">///     NSInlinePresentationIntent = NSInlinePresentationIntent(rawValue: 32)</span></span><br><span class="line">        <span class="comment">///     NSLanguage = en</span></span><br><span class="line">        <span class="comment">/// &#125;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 从文件中读取 Markdown 内容</span></span><br><span class="line">        <span class="keyword">let</span> mdUrl <span class="operator">=</span> <span class="type">Bundle</span>.main.url(forResource: <span class="string">&quot;1&quot;</span>, withExtension: <span class="string">&quot;md&quot;</span>)<span class="operator">!</span></span><br><span class="line">        mda <span class="operator">=</span> <span class="keyword">try!</span> <span class="type">AttributedString</span>(contentsOf: mdUrl,options: <span class="type">AttributedString</span>.<span class="type">MarkdownParsingOptions</span>(interpretedSyntax: .inlineOnlyPreservingWhitespace), baseURL: <span class="literal">nil</span>) <span class="comment">// .inlineOnlyPreservingWhitespace 支持 markdown 文件的换行</span></span><br><span class="line">                </span><br><span class="line">        <span class="comment">// Markdown 已转换成 AtrributedString 结构。</span></span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> mda.runs &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> ipi <span class="operator">=</span> r.inlinePresentationIntent &#123;</span><br><span class="line">                <span class="keyword">switch</span> ipi &#123;</span><br><span class="line">                <span class="keyword">case</span> .lineBreak:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;paragrahp&quot;</span>)</span><br><span class="line">                <span class="keyword">case</span> .code:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;this is code&quot;</span>)</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> pi <span class="operator">=</span> r.presentationIntent &#123;</span><br><span class="line">                <span class="keyword">for</span> c <span class="keyword">in</span> pi.components &#123;</span><br><span class="line">                    <span class="keyword">switch</span> c.kind &#123;</span><br><span class="line">                    <span class="keyword">case</span> .paragraph:</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">&quot;this is paragraph&quot;</span>)</span><br><span class="line">                    <span class="keyword">case</span> .codeBlock(<span class="keyword">let</span> lang):</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">&quot;this is <span class="subst">\(lang <span class="operator">??</span> <span class="string">&quot;&quot;</span>)</span> code&quot;</span>)</span><br><span class="line">                    <span class="keyword">case</span> .header(<span class="keyword">let</span> level):</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">&quot;this is <span class="subst">\(level)</span> level&quot;</span>)</span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> mda</span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(mdaStr)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>AttributedString 的使用<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK: - AttributedString</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PTextViewAttribute</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> aStr: <span class="type">AttributedString</span> <span class="operator">=</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> a1 <span class="operator">=</span> <span class="type">AttributedString</span>(<span class="string">&quot;这是一个 &quot;</span>)</span><br><span class="line">        <span class="keyword">var</span> c1 <span class="operator">=</span> <span class="type">AttributeContainer</span>()</span><br><span class="line">        c1.font <span class="operator">=</span> .footnote</span><br><span class="line">        c1.foregroundColor <span class="operator">=</span> .secondary</span><br><span class="line">        a1.setAttributes(c1)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> a2 <span class="operator">=</span> <span class="type">AttributedString</span>(<span class="string">&quot;Attribute &quot;</span>)</span><br><span class="line">        <span class="keyword">var</span> c2 <span class="operator">=</span> <span class="type">AttributeContainer</span>()</span><br><span class="line">        c2.font <span class="operator">=</span> .title</span><br><span class="line">        a2.setAttributes(c2)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> a3 <span class="operator">=</span> <span class="type">AttributedString</span>(<span class="string">&quot;String &quot;</span>)</span><br><span class="line">        <span class="keyword">var</span> c3 <span class="operator">=</span> <span class="type">AttributeContainer</span>()</span><br><span class="line">        c3.baselineOffset <span class="operator">=</span> <span class="number">10</span></span><br><span class="line">        c3.appKit.foregroundColor <span class="operator">=</span> .yellow <span class="comment">// 仅在 macOS 里显示的颜色</span></span><br><span class="line">        c3.swiftUI.foregroundColor <span class="operator">=</span> .secondary</span><br><span class="line">        c3.font <span class="operator">=</span> .footnote</span><br><span class="line">        a3.setAttributes(c3)</span><br><span class="line">        <span class="comment">// a3 使用自定义属性</span></span><br><span class="line">        a3.p1 <span class="operator">=</span> <span class="string">&quot;This is a custom property.&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// formatter 的支持</span></span><br><span class="line">        <span class="keyword">var</span> a4 <span class="operator">=</span> <span class="type">Date</span>.now.formatted(.dateTime</span><br><span class="line">                                        .hour()</span><br><span class="line">                                        .minute()</span><br><span class="line">                                        .weekday()</span><br><span class="line">                                        .attributed</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> c4AMPM <span class="operator">=</span> <span class="type">AttributeContainer</span>().dateField(.amPM)</span><br><span class="line">        <span class="keyword">let</span> c4AMPMColor <span class="operator">=</span> <span class="type">AttributeContainer</span>().foregroundColor(.green)</span><br><span class="line">        </span><br><span class="line">        a4.replaceAttributes(c4AMPM, with: c4AMPMColor)</span><br><span class="line">        <span class="keyword">let</span> c4Week <span class="operator">=</span> <span class="type">AttributeContainer</span>().dateField(.weekday)</span><br><span class="line">        <span class="keyword">let</span> c4WeekColor <span class="operator">=</span> <span class="type">AttributeContainer</span>().foregroundColor(.purple)</span><br><span class="line">        a4.replaceAttributes(c4Week, with: c4WeekColor)</span><br><span class="line">        </span><br><span class="line">        a1.append(a2)</span><br><span class="line">        a1.append(a3)</span><br><span class="line">        a1.append(a4)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Runs 视图</span></span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> a1.runs &#123;</span><br><span class="line">            <span class="built_in">print</span>(r)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/// 这是一个  &#123;</span></span><br><span class="line">        <span class="comment">///     SwiftUI.Font = Font(provider: SwiftUI.(unknown context at $7ff91d4a5e90).FontBox&lt;SwiftUI.Font.(unknown context at $7ff91d4ad5d8).TextStyleProvider&gt;)</span></span><br><span class="line">        <span class="comment">///     SwiftUI.ForegroundColor = secondary</span></span><br><span class="line">        <span class="comment">/// &#125;</span></span><br><span class="line">        <span class="comment">/// Attribute  &#123;</span></span><br><span class="line">        <span class="comment">///     SwiftUI.Font = Font(provider: SwiftUI.(unknown context at $7ff91d4a5e90).FontBox&lt;SwiftUI.Font.(unknown context at $7ff91d4ad5d8).TextStyleProvider&gt;)</span></span><br><span class="line">        <span class="comment">/// &#125;</span></span><br><span class="line">        <span class="comment">/// String  &#123;</span></span><br><span class="line">        <span class="comment">///     SwiftUI.ForegroundColor = secondary</span></span><br><span class="line">        <span class="comment">///     SwiftUI.BaselineOffset = 10.0</span></span><br><span class="line">        <span class="comment">///     NSColor = sRGB IEC61966-2.1 colorspace 1 1 0 1</span></span><br><span class="line">        <span class="comment">///     SwiftUI.Font = Font(provider: SwiftUI.(unknown context at $7ff91d4a5e90).FontBox&lt;SwiftUI.Font.(unknown context at $7ff91d4ad5d8).TextStyleProvider&gt;)</span></span><br><span class="line">        <span class="comment">///     p1 = This is a custom property.</span></span><br><span class="line">        <span class="comment">/// &#125;</span></span><br><span class="line">        <span class="comment">/// Tue &#123;</span></span><br><span class="line">        <span class="comment">///     SwiftUI.ForegroundColor = purple</span></span><br><span class="line">        <span class="comment">/// &#125;</span></span><br><span class="line">        <span class="comment">///   &#123;</span></span><br><span class="line">        <span class="comment">/// &#125;</span></span><br><span class="line">        <span class="comment">/// 5 &#123;</span></span><br><span class="line">        <span class="comment">///     Foundation.DateFormatField = hour</span></span><br><span class="line">        <span class="comment">/// &#125;</span></span><br><span class="line">        <span class="comment">/// : &#123;</span></span><br><span class="line">        <span class="comment">/// &#125;</span></span><br><span class="line">        <span class="comment">/// 16 &#123;</span></span><br><span class="line">        <span class="comment">///     Foundation.DateFormatField = minute</span></span><br><span class="line">        <span class="comment">/// &#125;</span></span><br><span class="line">        <span class="comment">///   &#123;</span></span><br><span class="line">        <span class="comment">/// &#125;</span></span><br><span class="line">        <span class="comment">/// PM &#123;</span></span><br><span class="line">        <span class="comment">///     SwiftUI.ForegroundColor = green</span></span><br><span class="line">        <span class="comment">/// &#125;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> a1</span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(aStr)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - 自定 AttributedString 属性</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PAKP1</span>: <span class="title">AttributedStringKey</span> </span>&#123;</span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">Value</span> <span class="operator">=</span> <span class="type">String</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> name: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;p1&quot;</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PAKP2</span>: <span class="title">CodableAttributedStringKey</span>, <span class="title">MarkdownDecodableAttributedStringKey</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">P2</span>: <span class="title">String</span>, <span class="title">Codable</span> </span>&#123;</span><br><span class="line">        <span class="keyword">case</span> one, two, three</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> name: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;p2&quot;</span></span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">Value</span> <span class="operator">=</span> <span class="type">P2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PAKP3</span>: <span class="title">CodableAttributedStringKey</span>, <span class="title">MarkdownDecodableAttributedStringKey</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">P3</span>: <span class="title">Codable</span>, <span class="title">Hashable</span> </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> k1: <span class="type">Int</span></span><br><span class="line">        <span class="keyword">let</span> k2: <span class="type">Int</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">Value</span> <span class="operator">=</span> <span class="type">P3</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> name: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;p3&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">AttributeScopes</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">NewScope</span>: <span class="title">AttributeScope</span> </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> p1: <span class="type">PAKP1</span></span><br><span class="line">        <span class="keyword">let</span> p2: <span class="type">PAKP2</span></span><br><span class="line">        <span class="keyword">let</span> p3: <span class="type">PAKP3</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> newScope: <span class="type">NewScope</span>.<span class="keyword">Type</span> &#123;</span><br><span class="line">        <span class="type">NewScope</span>.<span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">AttributeDynamicLookup</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">subscript</span>&lt;<span class="type">T</span>&gt;(<span class="params">dynamicMember</span> <span class="params">keyPath</span>:<span class="type">KeyPath</span>&lt;<span class="type">AttributeScopes</span>.<span class="type">NewScope</span>,<span class="type">T</span>&gt;)</span> -&gt; <span class="type">T</span> <span class="keyword">where</span> <span class="type">T</span>:<span class="type">AttributedStringKey</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>[<span class="type">T</span>.<span class="keyword">self</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>时间的显示</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK: - 时间</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PDateTextView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> date: <span class="type">Date</span> <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line">    <span class="keyword">let</span> df: <span class="type">DateFormatter</span> <span class="operator">=</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> df <span class="operator">=</span> <span class="type">DateFormatter</span>()</span><br><span class="line">        df.dateStyle <span class="operator">=</span> .long</span><br><span class="line">        df.timeStyle <span class="operator">=</span> .short</span><br><span class="line">        <span class="keyword">return</span> df</span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="keyword">var</span> dv: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> df.string(from: date)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(dv)</span><br><span class="line">        &#125;</span><br><span class="line">        .environment(\.locale, <span class="type">Locale</span>(identifier: <span class="string">&quot;zh_cn&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>插值使用</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK: - 插值</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PTextViewInterpolation</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> nf: <span class="type">NumberFormatter</span> <span class="operator">=</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> f <span class="operator">=</span> <span class="type">NumberFormatter</span>()</span><br><span class="line">        f.numberStyle <span class="operator">=</span> .currencyPlural</span><br><span class="line">        <span class="keyword">return</span> f</span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;图文 <span class="subst">\(Image(systemName: <span class="string">&quot;sun.min&quot;</span>))</span>&quot;</span>)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;💰 <span class="subst">\(<span class="number">999</span> <span class="keyword">as</span> NSNumber, formatter: nf)</span>&quot;</span>)</span><br><span class="line">                .environment(\.locale, <span class="type">Locale</span>(identifier: <span class="string">&quot;zh_cn&quot;</span>))</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;数组： <span class="subst">\([<span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>])</span>&quot;</span>)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;红字：<span class="subst">\(red: <span class="string">&quot;变红了&quot;</span>)</span>，带图标的字：<span class="subst">\(sun: <span class="string">&quot;天晴&quot;</span>)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 扩展 LocalizedStringKey.StringInterpolation 自定义插值</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">LocalizedStringKey</span>.<span class="title">StringInterpolation</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 特定类型处理</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">appendInterpolation</span>(<span class="keyword">_</span> <span class="params">value</span>: [<span class="type">String</span>])</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> s <span class="keyword">in</span> value &#123;</span><br><span class="line">            appendLiteral(s <span class="operator">+</span> <span class="string">&quot;&quot;</span>)</span><br><span class="line">            appendInterpolation(<span class="type">Text</span>(s <span class="operator">+</span> <span class="string">&quot; &quot;</span>).bold().foregroundColor(.secondary))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 实现不同情况处理，可以简化设置修改器设置</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">appendInterpolation</span>(<span class="params">red</span> <span class="params">value</span>: <span class="type">LocalizedStringKey</span>)</span> &#123;</span><br><span class="line">        appendInterpolation(<span class="type">Text</span>(value).bold().foregroundColor(.red))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">appendInterpolation</span>(<span class="params">sun</span> <span class="params">value</span>: <span class="type">String</span>)</span> &#123;</span><br><span class="line">        appendInterpolation(<span class="type">Image</span>(systemName: <span class="string">&quot;sun.max.fill&quot;</span>))</span><br><span class="line">        appendLiteral(value)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Link"><a href="#Link" class="headerlink" title="Link"></a>Link</h4><p>使用方法如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PlayLinkView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Environment</span>(\.openURL) <span class="keyword">var</span> openURL</span><br><span class="line">    <span class="keyword">var</span> aStr: <span class="type">AttributedString</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> a <span class="operator">=</span> <span class="type">AttributedString</span>(<span class="string">&quot;戴铭的博客&quot;</span>)</span><br><span class="line">        a.link <span class="operator">=</span> <span class="type">URL</span>(string: <span class="string">&quot;https://ming1016.github.io/&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> a</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="comment">// 普通</span></span><br><span class="line">            <span class="type">Link</span>(<span class="string">&quot;前往 www.starming.com&quot;</span>, destination: <span class="type">URL</span>(string: <span class="string">&quot;http://www.starming.com&quot;</span>)<span class="operator">!</span>)</span><br><span class="line">                .buttonStyle(.borderedProminent)</span><br><span class="line">            <span class="type">Link</span>(destination: <span class="type">URL</span>(string: <span class="string">&quot;https://twitter.com/daiming_cn&quot;</span>)<span class="operator">!</span>) &#123;</span><br><span class="line">                <span class="type">Label</span>(<span class="string">&quot;My Twitter&quot;</span>, systemImage: <span class="string">&quot;message.circle.fill&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// AttributedString 链接</span></span><br><span class="line">            <span class="type">Text</span>(aStr)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// markdown 链接</span></span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;[Go Ming&#x27;s GitHub](https://github.com/ming1016)&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 控件使用 OpenURL</span></span><br><span class="line">            <span class="type">Link</span>(<span class="string">&quot;小册子源码&quot;</span>, destination: <span class="type">URL</span>(string: <span class="string">&quot;https://github.com/KwaiAppTeam/SwiftPamphletApp&quot;</span>)<span class="operator">!</span>)</span><br><span class="line">                .environment(\.openURL, <span class="type">OpenURLAction</span> &#123; url <span class="keyword">in</span></span><br><span class="line">                    <span class="keyword">return</span> .systemAction</span><br><span class="line">                    <span class="comment">/// return .handled 不会返回系统打开浏览器动作，只会处理 return 前的事件。</span></span><br><span class="line">                    <span class="comment">/// .discard 和 .handled 类似。</span></span><br><span class="line">                    <span class="comment">/// .systemAction(URL(string: &quot;https://www.anotherurl.com&quot;)) 可以返回另外一个 url 来替代指定的url</span></span><br><span class="line">                &#125;)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 扩展 View 后更简洁的使用 OpenURL</span></span><br><span class="line">            <span class="type">Link</span>(<span class="string">&quot;戴铭的微博&quot;</span>, destination: <span class="type">URL</span>(string: <span class="string">&quot;https://weibo.com/allstarming&quot;</span>)<span class="operator">!</span>)</span><br><span class="line">                .goOpenURL &#123; url <span class="keyword">in</span></span><br><span class="line">                    <span class="built_in">print</span>(url.absoluteString)</span><br><span class="line">                    <span class="keyword">return</span> .systemAction</span><br><span class="line">                &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 根据内容返回不同链接</span></span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;戴铭博客有好几个，存在[GitHub Page](github)、[自建服务器](starming)和[知乎](zhihu)上&quot;</span>)</span><br><span class="line">                .environment(\.openURL, <span class="type">OpenURLAction</span> &#123; url <span class="keyword">in</span></span><br><span class="line">                    <span class="keyword">switch</span> url.absoluteString &#123;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&quot;github&quot;</span>:</span><br><span class="line">                        <span class="keyword">return</span> .systemAction(<span class="type">URL</span>(string: <span class="string">&quot;https://ming1016.github.io/&quot;</span>)<span class="operator">!</span>)</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&quot;starming&quot;</span>:</span><br><span class="line">                        <span class="keyword">return</span> .systemAction(<span class="type">URL</span>(string: <span class="string">&quot;http://www.starming.com&quot;</span>)<span class="operator">!</span>)</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&quot;zhihu&quot;</span>:</span><br><span class="line">                        <span class="keyword">return</span> .systemAction(<span class="type">URL</span>(string: <span class="string">&quot;https://www.zhihu.com/people/starming/posts&quot;</span>)<span class="operator">!</span>)</span><br><span class="line">                    default:</span><br><span class="line">                        <span class="keyword">return</span> .handled</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">        &#125; <span class="comment">// end VStack</span></span><br><span class="line">        .padding()</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// View 支持 openURL 的能力</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">goUrl</span>(<span class="keyword">_</span> <span class="params">url</span>: <span class="type">URL</span>, <span class="params">done</span>: <span class="keyword">@escaping</span> (<span class="keyword">_</span> accepted: <span class="type">Bool</span>) -&gt; <span class="type">Void</span>)</span> &#123;</span><br><span class="line">        openURL(url, completion: done)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为 View 扩展一个 OpenURL 方法</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">goOpenURL</span>(<span class="params">done</span>: <span class="keyword">@escaping</span> (<span class="type">URL</span>) -&gt; <span class="type">OpenURLAction</span>.<span class="type">Result</span>)</span> -&gt; <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        environment(\.openURL, <span class="type">OpenURLAction</span>(handler: done))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>View 的 onOpenURL 方法可以处理 Universal Links。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">V</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;hi&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .onOpenURL &#123; url <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(url.absoluteString)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Label"><a href="#Label" class="headerlink" title="Label"></a>Label</h4><p><img src="https://user-images.githubusercontent.com/251980/154474725-d696d50b-9da7-4a0d-808f-07894a9597cb.png" alt=""></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PlayLabelView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(spacing: <span class="number">10</span>) &#123;</span><br><span class="line">            <span class="type">Label</span>(<span class="string">&quot;一个 Label&quot;</span>, systemImage: <span class="string">&quot;bolt.circle&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">Label</span>(<span class="string">&quot;只显示 icon&quot;</span>, systemImage: <span class="string">&quot;heart.fill&quot;</span>)</span><br><span class="line">                .labelStyle(.iconOnly)</span><br><span class="line">                .foregroundColor(.red)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 自建 Label</span></span><br><span class="line">            <span class="type">Label</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;自建 Label&quot;</span>)</span><br><span class="line">                    .foregroundColor(.orange)</span><br><span class="line">                    .bold()</span><br><span class="line">                    .font(.largeTitle)</span><br><span class="line">                    .shadow(color: .black, radius: <span class="number">1</span>, x: <span class="number">0</span>, y: <span class="number">2</span>)</span><br><span class="line">            &#125; icon: &#123;</span><br><span class="line">                <span class="type">Image</span>(<span class="string">&quot;p3&quot;</span>)</span><br><span class="line">                    .resizable()</span><br><span class="line">                    .aspectRatio(contentMode: .fit)</span><br><span class="line">                    .frame(width: <span class="number">30</span>)</span><br><span class="line">                    .shadow(color: .black, radius: <span class="number">1</span>, x: <span class="number">0</span>, y: <span class="number">2</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 自定义 LabelStyle</span></span><br><span class="line">            <span class="type">Label</span>(<span class="string">&quot;有边框的 Label&quot;</span>, systemImage: <span class="string">&quot;b.square.fill&quot;</span>)</span><br><span class="line">                .labelStyle(.border)</span><br><span class="line">            </span><br><span class="line">            <span class="type">Label</span>(<span class="string">&quot;仅标题有边框&quot;</span>, systemImage: <span class="string">&quot;text.bubble&quot;</span>)</span><br><span class="line">                .labelStyle(.borderOnlyTitle)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 扩展的 Label</span></span><br><span class="line">            <span class="type">Label</span>(<span class="string">&quot;扩展的 Label&quot;</span>, originalSystemImage: <span class="string">&quot;cloud.sun.bolt.fill&quot;</span>)</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="comment">// end VStack</span></span><br><span class="line">    &#125; <span class="comment">// end body</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对 Label 做扩展</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Label</span> <span class="title">where</span> <span class="title">Title</span> == <span class="title">Text</span>, <span class="title">Icon</span> == <span class="title">Image</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">title</span>: <span class="type">LocalizedStringKey</span>, <span class="params">originalSystemImage</span> <span class="params">systemImageString</span>: <span class="type">String</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.<span class="keyword">init</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(title)</span><br><span class="line">        &#125; icon: &#123;</span><br><span class="line">            <span class="type">Image</span>(systemName: systemImageString)</span><br><span class="line">                .renderingMode(.original) <span class="comment">// 让 SFSymbol 显示本身的颜色</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加自定义 LabelStyle，用来加上边框</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BorderLabelStyle</span>: <span class="title">LabelStyle</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeBody</span>(<span class="params">configuration</span>: <span class="type">Configuration</span>)</span> -&gt; <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Label</span>(configuration)</span><br><span class="line">            .padding()</span><br><span class="line">            .overlay(<span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">20</span>)</span><br><span class="line">                        .stroke(.purple, lineWidth: <span class="number">4</span>))</span><br><span class="line">            .shadow(color: .black, radius: <span class="number">4</span>, x: <span class="number">0</span>, y: <span class="number">5</span>)</span><br><span class="line">            .labelStyle(.automatic) <span class="comment">// 样式擦除器，防止样式被 .iconOnly、.titleOnly 这样的 LabelStyle 擦除了样式。</span></span><br><span class="line">                        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">LabelStyle</span> <span class="title">where</span> <span class="title">Self</span> == <span class="title">BorderLabelStyle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">static</span> <span class="keyword">var</span> border: <span class="type">BorderLabelStyle</span> &#123;</span><br><span class="line">        <span class="type">BorderLabelStyle</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 只给标题加边框</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BorderOnlyTitleLabelStyle</span>: <span class="title">LabelStyle</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeBody</span>(<span class="params">configuration</span>: <span class="type">Configuration</span>)</span> -&gt; <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            configuration.icon</span><br><span class="line">            configuration.title</span><br><span class="line">                .padding()</span><br><span class="line">                .overlay(<span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">20</span>)</span><br><span class="line">                            .stroke(.pink, lineWidth: <span class="number">4</span>))</span><br><span class="line">                .shadow(color: .black, radius: <span class="number">1</span>, x: <span class="number">0</span>, y: <span class="number">1</span>)</span><br><span class="line">                .labelStyle(.automatic)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">LabelStyle</span> <span class="title">where</span> <span class="title">Self</span> == <span class="title">BorderOnlyTitleLabelStyle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">static</span> <span class="keyword">var</span> borderOnlyTitle: <span class="type">BorderOnlyTitleLabelStyle</span> &#123;</span><br><span class="line">        <span class="type">BorderOnlyTitleLabelStyle</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="TextEditor"><a href="#TextEditor" class="headerlink" title="TextEditor"></a>TextEditor</h4><p><img src="https://user-images.githubusercontent.com/251980/154667163-e906dfd4-074e-4c04-9c80-94af86df4ba6.png" alt=""></p>
<p>对应的代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> CodeEditorView</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PlayTextEditorView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="comment">// for TextEditor</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> txt: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;一段可编辑文字...<span class="subst">\n</span>&quot;</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> count: <span class="type">Int</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// for CodeEditorView</span></span><br><span class="line">    <span class="meta">@Environment</span>(\.colorScheme) <span class="keyword">private</span> <span class="keyword">var</span> colorScheme: <span class="type">ColorScheme</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> codeMessages: <span class="type">Set</span>&lt;<span class="type">Located</span>&lt;<span class="type">Message</span>&gt;&gt; <span class="operator">=</span> <span class="type">Set</span> ()</span><br><span class="line">    <span class="meta">@SceneStorage</span>(<span class="string">&quot;editLocation&quot;</span>) <span class="keyword">private</span> <span class="keyword">var</span> editLocation: <span class="type">CodeEditor</span>.<span class="type">Location</span> <span class="operator">=</span> <span class="type">CodeEditor</span>.<span class="type">Location</span>()</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用 SwiftUI 自带 TextEditor</span></span><br><span class="line">        <span class="type">TextEditor</span>(text: <span class="variable">$txt</span>)</span><br><span class="line">            .font(.title)</span><br><span class="line">            .lineSpacing(<span class="number">10</span>)</span><br><span class="line">            .disableAutocorrection(<span class="literal">true</span>)</span><br><span class="line">            .padding()</span><br><span class="line">            .onChange(of: txt) &#123; newValue <span class="keyword">in</span></span><br><span class="line">                count <span class="operator">=</span> txt.count</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;字数：<span class="subst">\(count)</span>&quot;</span>)</span><br><span class="line">            .foregroundColor(.secondary)</span><br><span class="line">            .font(.footnote)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用的 CodeEditorView 显示和编辑代码高亮的代码，还有 minimap</span></span><br><span class="line">        <span class="type">CodeEditor</span>(text: .constant(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">static func number() &#123;</span></span><br><span class="line"><span class="string">    // Int</span></span><br><span class="line"><span class="string">    let i1 = 100</span></span><br><span class="line"><span class="string">    let i2 = 22</span></span><br><span class="line"><span class="string">    print(i1 / i2) // 向下取整得 4</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    // Float</span></span><br><span class="line"><span class="string">    let f1: Float = 100.0</span></span><br><span class="line"><span class="string">    let f2: Float = 22.0</span></span><br><span class="line"><span class="string">    print(f1 / f2) // 4.5454545</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    let f4: Float32 = 5.0</span></span><br><span class="line"><span class="string">    let f5: Float64 = 5.0</span></span><br><span class="line"><span class="string">    print(f4, f5) // 5.0 5.0 5.0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    // Double</span></span><br><span class="line"><span class="string">    let d1: Double = 100.0</span></span><br><span class="line"><span class="string">    let d2: Double = 22.0</span></span><br><span class="line"><span class="string">    print(d1 / d2) // 4.545454545454546</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    // 字面量</span></span><br><span class="line"><span class="string">    print(Int(0b10101)) // 0b 开头是二进制</span></span><br><span class="line"><span class="string">    print(Int(0x00afff)) // 0x 开头是十六进制</span></span><br><span class="line"><span class="string">    print(2.5e4) // 2.5x10^4 十进制用 e</span></span><br><span class="line"><span class="string">    print(0xAp2) // 10*2^2  十六进制用 p</span></span><br><span class="line"><span class="string">    print(2_000_000) // 2000000</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    // isMultiple(of:) 方法检查一个数字是否是另一个数字的倍数</span></span><br><span class="line"><span class="string">    let i3 = 36</span></span><br><span class="line"><span class="string">    print(i3.isMultiple(of: 9)) // true</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>),</span><br><span class="line">                   messages: <span class="variable">$codeMessages</span>,</span><br><span class="line">                   language: .swift,</span><br><span class="line">                   layout: <span class="type">CodeEditor</span>.<span class="type">LayoutConfiguration</span>(showMinimap: <span class="literal">true</span>)</span><br><span class="line">        )</span><br><span class="line">            .environment(\.codeEditorTheme, colorScheme <span class="operator">==</span> .dark <span class="operator">?</span> <span class="type">Theme</span>.defaultDark : <span class="type">Theme</span>.defaultLight)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 包装的 NSTextView</span></span><br><span class="line">        <span class="type">HSplitView</span> &#123;</span><br><span class="line">            <span class="type">PNSTextView</span>(text: .constant(<span class="string">&quot;左边写...<span class="subst">\n</span>&quot;</span>), onDidChange: &#123; (s, i) <span class="keyword">in</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Typing <span class="subst">\(i)</span> times.&quot;</span>)</span><br><span class="line">            &#125;)</span><br><span class="line">                .padding()</span><br><span class="line">            <span class="type">PNSTextView</span>(text: .constant(<span class="string">&quot;右边写...<span class="subst">\n</span>&quot;</span>))</span><br><span class="line">                .padding()</span><br><span class="line">        &#125; <span class="comment">// end HSplitView</span></span><br><span class="line">    &#125; <span class="comment">// end body</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - 自己包装 NSTextView</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PNSTextView</span>: <span class="title">NSViewRepresentable</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Binding</span> <span class="keyword">var</span> text: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> onBeginEditing: () -&gt; <span class="type">Void</span> <span class="operator">=</span> &#123;&#125;</span><br><span class="line">    <span class="keyword">var</span> onCommit: () -&gt; <span class="type">Void</span> <span class="operator">=</span> &#123;&#125;</span><br><span class="line">    <span class="keyword">var</span> onDidChange: (<span class="type">String</span>, <span class="type">Int</span>) -&gt; <span class="type">Void</span> <span class="operator">=</span> &#123; <span class="keyword">_</span>,<span class="keyword">_</span>  <span class="keyword">in</span> &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 返回要包装的 NSView</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeNSView</span>(<span class="params">context</span>: <span class="type">Context</span>)</span> -&gt; <span class="type">PNSTextConfiguredView</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> t <span class="operator">=</span> <span class="type">PNSTextConfiguredView</span>(text: text)</span><br><span class="line">        t.delegate <span class="operator">=</span> context.coordinator</span><br><span class="line">        <span class="keyword">return</span> t</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">updateNSView</span>(<span class="keyword">_</span> <span class="params">view</span>: <span class="type">PNSTextConfiguredView</span>, <span class="params">context</span>: <span class="type">Context</span>)</span> &#123;</span><br><span class="line">        view.text <span class="operator">=</span> text</span><br><span class="line">        view.selectedRanges <span class="operator">=</span> context.coordinator.sRanges</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 回调</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeCoordinator</span>()</span> -&gt; <span class="type">TextViewDelegate</span> &#123;</span><br><span class="line">        <span class="type">TextViewDelegate</span>(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理 delegate 回调</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">PNSTextView</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">TextViewDelegate</span>: <span class="title">NSObject</span>, <span class="title">NSTextViewDelegate</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> tView: <span class="type">PNSTextView</span></span><br><span class="line">        <span class="keyword">var</span> sRanges: [<span class="type">NSValue</span>] <span class="operator">=</span> []</span><br><span class="line">        <span class="keyword">var</span> typeCount: <span class="type">Int</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">v</span>: <span class="type">PNSTextView</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">self</span>.tView <span class="operator">=</span> v</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 开始编辑</span></span><br><span class="line">        <span class="function"><span class="keyword">func</span> <span class="title">textDidBeginEditing</span>(<span class="keyword">_</span> <span class="params">notification</span>: <span class="type">Notification</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> textView <span class="operator">=</span> notification.object <span class="keyword">as?</span> <span class="type">NSTextView</span> <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">self</span>.tView.text <span class="operator">=</span> textView.string</span><br><span class="line">            <span class="keyword">self</span>.tView.onBeginEditing()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 每次敲字</span></span><br><span class="line">        <span class="function"><span class="keyword">func</span> <span class="title">textDidChange</span>(<span class="keyword">_</span> <span class="params">notification</span>: <span class="type">Notification</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> textView <span class="operator">=</span> notification.object <span class="keyword">as?</span> <span class="type">NSTextView</span> <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            typeCount <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">            <span class="keyword">self</span>.tView.text <span class="operator">=</span> textView.string</span><br><span class="line">            <span class="keyword">self</span>.sRanges <span class="operator">=</span> textView.selectedRanges</span><br><span class="line">            <span class="keyword">self</span>.tView.onDidChange(textView.string, typeCount)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 提交</span></span><br><span class="line">        <span class="function"><span class="keyword">func</span> <span class="title">textDidEndEditing</span>(<span class="keyword">_</span> <span class="params">notification</span>: <span class="type">Notification</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> textView <span class="operator">=</span> notification.object <span class="keyword">as?</span> <span class="type">NSTextView</span> <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">self</span>.tView.text <span class="operator">=</span> textView.string</span><br><span class="line">            <span class="keyword">self</span>.tView.onCommit()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置 NSTextView</span></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">PNSTextConfiguredView</span>: <span class="title">NSView</span> </span>&#123;</span><br><span class="line">    <span class="keyword">weak</span> <span class="keyword">var</span> delegate: <span class="type">NSTextViewDelegate</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">var</span> tv: <span class="type">NSTextView</span> <span class="operator">=</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> contentSize <span class="operator">=</span> sv.contentSize</span><br><span class="line">        <span class="keyword">let</span> textStorage <span class="operator">=</span> <span class="type">NSTextStorage</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> layoutManager <span class="operator">=</span> <span class="type">NSLayoutManager</span>()</span><br><span class="line">        textStorage.addLayoutManager(layoutManager)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> textContainer <span class="operator">=</span> <span class="type">NSTextContainer</span>(containerSize: sv.frame.size)</span><br><span class="line">        textContainer.widthTracksTextView <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">        textContainer.containerSize <span class="operator">=</span> <span class="type">NSSize</span>(</span><br><span class="line">            width: contentSize.width,</span><br><span class="line">            height: <span class="type">CGFloat</span>.greatestFiniteMagnitude</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        layoutManager.addTextContainer(textContainer)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> t <span class="operator">=</span> <span class="type">NSTextView</span>(frame: .zero, textContainer: textContainer)</span><br><span class="line">        t.delegate <span class="operator">=</span> <span class="keyword">self</span>.delegate</span><br><span class="line">        t.isEditable <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">        t.allowsUndo <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">        </span><br><span class="line">        t.font <span class="operator">=</span> .systemFont(ofSize: <span class="number">24</span>)</span><br><span class="line">        t.textColor <span class="operator">=</span> <span class="type">NSColor</span>.labelColor</span><br><span class="line">        t.drawsBackground <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">        t.backgroundColor <span class="operator">=</span> <span class="type">NSColor</span>.textBackgroundColor</span><br><span class="line">        </span><br><span class="line">        t.maxSize <span class="operator">=</span> <span class="type">NSSize</span>(width: <span class="type">CGFloat</span>.greatestFiniteMagnitude, height: <span class="type">CGFloat</span>.greatestFiniteMagnitude)</span><br><span class="line">        t.minSize <span class="operator">=</span> <span class="type">NSSize</span>(width: <span class="number">0</span>, height: contentSize.height)</span><br><span class="line">        t.autoresizingMask <span class="operator">=</span> .width</span><br><span class="line"></span><br><span class="line">        t.isHorizontallyResizable <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">        t.isVerticallyResizable   <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> t</span><br><span class="line">    &#125;()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">var</span> sv: <span class="type">NSScrollView</span> <span class="operator">=</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> s <span class="operator">=</span> <span class="type">NSScrollView</span>()</span><br><span class="line">        s.drawsBackground <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">        s.borderType <span class="operator">=</span> .noBorder</span><br><span class="line">        s.hasVerticalScroller <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">        s.hasHorizontalRuler <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">        s.translatesAutoresizingMaskIntoConstraints <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">        s.autoresizingMask <span class="operator">=</span> [.width, .height]</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line">    &#125;()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> text: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            tv.string <span class="operator">=</span> text</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> selectedRanges: [<span class="type">NSValue</span>] <span class="operator">=</span> [] &#123;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            <span class="keyword">guard</span> selectedRanges.count <span class="operator">&gt;</span> <span class="number">0</span> <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            tv.selectedRanges <span class="operator">=</span> selectedRanges</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">required</span> <span class="function"><span class="keyword">init?</span>(<span class="params">coder</span>: <span class="type">NSCoder</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">fatalError</span>(<span class="string">&quot;Error coder&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">init</span>(<span class="params">text</span>: <span class="type">String</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.text <span class="operator">=</span> text</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(frame: .zero)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillDraw</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewWillDraw()</span><br><span class="line">        sv.translatesAutoresizingMaskIntoConstraints <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">        addSubview(sv)</span><br><span class="line">        <span class="type">NSLayoutConstraint</span>.activate([</span><br><span class="line">            sv.topAnchor.constraint(equalTo: topAnchor),</span><br><span class="line">            sv.trailingAnchor.constraint(equalTo: trailingAnchor),</span><br><span class="line">            sv.bottomAnchor.constraint(equalTo: bottomAnchor),</span><br><span class="line">            sv.leadingAnchor.constraint(equalTo: leadingAnchor)</span><br><span class="line">        ])</span><br><span class="line">        sv.documentView <span class="operator">=</span> tv</span><br><span class="line">    &#125; <span class="comment">// end viewWillDraw</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>SwiftUI 中用 NSView，可以通过 NSViewRepresentable 来包装视图，这个协议主要是实现 makeNSView、updateNSView 和 makeCoordinator 三个方法。makeNSView 要求返回需要包装的 NSView。每当 SwiftUI 的状态变化时触发 updateNSView 方法的调用。为了实现 NSView 里的 delegate 和 SwiftUI 通信，就要用 makeCoordinator 返回一个用于处理 delegate 的实例。</p>
<h4 id="TextField"><a href="#TextField" class="headerlink" title="TextField"></a>TextField</h4><p><img src="https://user-images.githubusercontent.com/251980/154916174-2e9b1bd8-992a-485e-803a-07da59d0c7e3.png" alt=""></p>
<p>使用方法如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PlayTextFieldView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> t <span class="operator">=</span> <span class="string">&quot;Starming&quot;</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> showT <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> isEditing <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    <span class="keyword">var</span> placeholder <span class="operator">=</span> <span class="string">&quot;输入些文字...&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@FocusState</span> <span class="keyword">private</span> <span class="keyword">var</span> isFocus: <span class="type">Bool</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">TextField</span>(placeholder, text: <span class="variable">$t</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 样式设置</span></span><br><span class="line">            <span class="type">TextField</span>(placeholder, text: <span class="variable">$t</span>)</span><br><span class="line">                .padding(<span class="number">10</span>)</span><br><span class="line">                .textFieldStyle(.roundedBorder) <span class="comment">// textFieldStyle 有三个预置值 automatic、plain 和 roundedBorder。</span></span><br><span class="line">                .multilineTextAlignment(.leading) <span class="comment">// 对齐方式</span></span><br><span class="line">                .font(.system(size: <span class="number">14</span>, weight: .heavy, design: .rounded))</span><br><span class="line">                .border(.teal, width: <span class="number">4</span>)</span><br><span class="line">                .background(.white)</span><br><span class="line">                .foregroundColor(.brown)</span><br><span class="line">                .textCase(.uppercase)</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 多视图组合</span></span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Image</span>(systemName: <span class="string">&quot;lock.circle&quot;</span>)</span><br><span class="line">                    .foregroundColor(.gray).font(.headline)</span><br><span class="line">                <span class="type">TextField</span>(placeholder, text: <span class="variable">$t</span>)</span><br><span class="line">                    .textFieldStyle(.plain)</span><br><span class="line">                    .submitLabel(.done)</span><br><span class="line">                    .onSubmit &#123;</span><br><span class="line">                        showT <span class="operator">=</span> t</span><br><span class="line">                        isFocus <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    .onChange(of: t) &#123; newValue <span class="keyword">in</span></span><br><span class="line">                        t <span class="operator">=</span> <span class="type">String</span>(newValue.prefix(<span class="number">20</span>)) <span class="comment">// 限制字数</span></span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="type">Image</span>(systemName: <span class="string">&quot;eye.slash&quot;</span>)</span><br><span class="line">                    .foregroundColor(.gray)</span><br><span class="line">                    .font(.headline)</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line">            .overlay(</span><br><span class="line">                <span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">8</span>)</span><br><span class="line">                    .stroke(.gray, lineWidth: <span class="number">1</span>)</span><br><span class="line">            )</span><br><span class="line">            .padding(.horizontal)</span><br><span class="line"></span><br><span class="line">            <span class="type">Text</span>(showT)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 自定义 textFieldStyle 样式</span></span><br><span class="line">            <span class="type">TextField</span>(placeholder, text: <span class="variable">$t</span>)</span><br><span class="line">                .textFieldStyle(<span class="type">PClearTextStyle</span>())</span><br><span class="line">                .focused(<span class="variable">$isFocus</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">    &#125; <span class="comment">// end body</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PClearTextStyle</span>: <span class="title">TextFieldStyle</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ViewBuilder</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">_body</span>(<span class="params">configuration</span>: <span class="type">TextField</span>&lt;_Label&gt;)</span> -&gt; <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> mirror <span class="operator">=</span> <span class="type">Mirror</span>(reflecting: configuration)</span><br><span class="line">        <span class="keyword">let</span> bindingText: <span class="type">Binding</span>&lt;<span class="type">String</span>&gt; <span class="operator">=</span> mirror.descendant(<span class="string">&quot;_text&quot;</span>) <span class="keyword">as!</span> <span class="type">Binding</span>&lt;<span class="type">String</span>&gt;</span><br><span class="line">        configuration</span><br><span class="line">            .overlay(alignment: .trailing) &#123;</span><br><span class="line">                <span class="type">Button</span>(action: &#123;</span><br><span class="line">                    bindingText.wrappedValue <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">                &#125;, label: &#123;</span><br><span class="line">                    <span class="type">Image</span>(systemName: <span class="string">&quot;clear&quot;</span>)</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> text: <span class="type">String</span> <span class="operator">=</span> mirror.descendant(<span class="string">&quot;_text&quot;</span>, <span class="string">&quot;_value&quot;</span>) <span class="keyword">as!</span> <span class="type">String</span></span><br><span class="line">        configuration</span><br><span class="line">            .padding()</span><br><span class="line">            .background(</span><br><span class="line">                <span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">16</span>)</span><br><span class="line">                    .strokeBorder(text.count <span class="operator">&gt;</span> <span class="number">10</span> <span class="operator">?</span> .pink : .gray, lineWidth: <span class="number">4</span>)</span><br><span class="line">            )</span><br><span class="line">    &#125; <span class="comment">// end func</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>目前iOS 和 iPadOS上支持的键盘有：</p>
<ul>
<li>asciiCapable：能显示标准 ASCII 字符的键盘</li>
<li>asciiCapableNumberPad：只输出 ASCII 数字的数字键盘</li>
<li>numberPad：用于输入 PIN 码的数字键盘</li>
<li>numbersAndPunctuation：数字和标点符号的键盘</li>
<li>decimalPad：带有数字和小数点的键盘</li>
<li>phonePad：电话中使用的键盘</li>
<li>namePhonePad：用于输入人名或电话号码的小键盘</li>
<li>URL：用于输入URL的键盘</li>
<li>emailAddress：用于输入电子邮件地址的键盘</li>
<li>twitter：用于Twitter文本输入的键盘，支持@和#字符简便输入</li>
<li>webSearch：用于网络搜索词和URL输入的键盘</li>
</ul>
<p>可以通过 keyboardType 修改器来指定。</p>
<h4 id="Button"><a href="#Button" class="headerlink" title="Button"></a>Button</h4><p><img src="https://user-images.githubusercontent.com/251980/155062538-108a79b4-3e5c-417b-867a-3f7e58316664.png" alt=""></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PlayButtonView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> asyncAction: () <span class="keyword">async</span> -&gt; <span class="type">Void</span> <span class="operator">=</span> &#123;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> <span class="keyword">await</span> <span class="type">Task</span>.sleep(nanoseconds: <span class="number">300_000_000</span>)</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> isFollowed: <span class="type">Bool</span> <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="comment">// 常用方式</span></span><br><span class="line">            <span class="type">Button</span> &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Clicked&quot;</span>)</span><br><span class="line">            &#125; label: &#123;</span><br><span class="line">                <span class="type">Image</span>(systemName: <span class="string">&quot;ladybug.fill&quot;</span>)</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Report Bug&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 图标</span></span><br><span class="line">            <span class="type">Button</span>(systemIconName: <span class="string">&quot;ladybug.fill&quot;</span>) &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;bug&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            .buttonStyle(.plain) <span class="comment">// 无背景</span></span><br><span class="line">            .simultaneousGesture(<span class="type">LongPressGesture</span>().onEnded(&#123; <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;长按&quot;</span>) <span class="comment">// macOS 暂不支持</span></span><br><span class="line">            &#125;))</span><br><span class="line">            .simultaneousGesture(<span class="type">TapGesture</span>().onEnded(&#123; <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;短按&quot;</span>) <span class="comment">// macOS 暂不支持</span></span><br><span class="line">            &#125;))</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">            <span class="comment">// iOS 15 修改器的使用。role 在 macOS 上暂不支持</span></span><br><span class="line">            <span class="type">Button</span>(<span class="string">&quot;要删除了&quot;</span>, role: .destructive) &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;删除&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            .tint(.purple)</span><br><span class="line">            .controlSize(.large) <span class="comment">// .regular 是默认大小</span></span><br><span class="line">            .buttonStyle(.borderedProminent) <span class="comment">// borderedProminent 可显示 tint 的设置。还有 bordered、plain 和 borderless 可选。</span></span><br><span class="line">            .clipShape(<span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">5</span>))</span><br><span class="line">            .accentColor(.pink)</span><br><span class="line">            .buttonBorderShape(.automatic) <span class="comment">// 会依据 controlSize 调整边框样式</span></span><br><span class="line">            .background(.ultraThinMaterial, in: <span class="type">Capsule</span>()) <span class="comment">// 添加材质就像在视图和背景间加了个透明层达到模糊的效果。效果由高到底分别是.ultraThinMaterial、.thinMaterial、.regularMaterial、.thickMaterial、.ultraThickMaterial。</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 风格化</span></span><br><span class="line">            <span class="type">Button</span>(action: &#123;</span><br><span class="line">                <span class="comment">//</span></span><br><span class="line">            &#125;, label: &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;风格化&quot;</span>).font(.largeTitle)</span><br><span class="line">            &#125;)</span><br><span class="line">            .buttonStyle(<span class="type">PStarmingButtonStyle</span>())</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 自定义 Button</span></span><br><span class="line">            <span class="type">PCustomButton</span>(<span class="string">&quot;点一下触发&quot;</span>) &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Clicked!&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 自定义 ButtonStyle</span></span><br><span class="line">            <span class="type">Button</span> &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Double Clicked!&quot;</span>)</span><br><span class="line">            &#125; label: &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;点两下触发&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            .buttonStyle(<span class="type">PCustomPrimitiveButtonStyle</span>())</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将 Text 视图加上另一个 Text 视图中，类型仍还是 Text。</span></span><br><span class="line">            <span class="type">PCustomButton</span>(<span class="type">Text</span>(<span class="string">&quot;点我 &quot;</span>).underline() <span class="operator">+</span> <span class="type">Text</span>(<span class="string">&quot;别犹豫&quot;</span>).font(.title) <span class="operator">+</span> <span class="type">Text</span>(<span class="string">&quot;🤫悄悄说声，有惊喜&quot;</span>).font(.footnote).foregroundColor(.secondary)) &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;多 Text 组合标题按钮点击！&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 异步按钮</span></span><br><span class="line">            <span class="type">ButtonAsync</span> &#123;</span><br><span class="line">                <span class="keyword">await</span> asyncAction()</span><br><span class="line">                isFollowed <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">            &#125; label: &#123;</span><br><span class="line">                <span class="keyword">if</span> isFollowed <span class="operator">==</span> <span class="literal">true</span> &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;已关注&quot;</span>)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;关注&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .font(.largeTitle)</span><br><span class="line">            .disabled(isFollowed)</span><br><span class="line">            .buttonStyle(<span class="type">PCustomButtonStyle</span>(backgroundColor: isFollowed <span class="operator">==</span> <span class="literal">true</span> <span class="operator">?</span> .gray : .pink))</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">        .background(<span class="type">Color</span>.skeumorphismBG)</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - 异步操作的按钮</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ButtonAsync</span>&lt;<span class="title">Label</span>: <span class="title">View</span>&gt;: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> doAsync: () <span class="keyword">async</span> -&gt; <span class="type">Void</span></span><br><span class="line">    <span class="meta">@ViewBuilder</span> <span class="keyword">var</span> label: () -&gt; <span class="type">Label</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> isRunning <span class="operator">=</span> <span class="literal">false</span> <span class="comment">// 避免连续点击造成重复执行事件</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Button</span> &#123;</span><br><span class="line">            isRunning <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">            <span class="type">Task</span> &#123;</span><br><span class="line">                <span class="keyword">await</span> doAsync()</span><br><span class="line">                isRunning <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; label: &#123;</span><br><span class="line">            label().opacity(isRunning <span class="operator">==</span> <span class="literal">true</span> <span class="operator">?</span> <span class="number">0</span> : <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> isRunning <span class="operator">==</span> <span class="literal">true</span> &#123;</span><br><span class="line">                <span class="type">ProgressView</span>()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .disabled(isRunning)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - 扩展 Button</span></span><br><span class="line"><span class="comment">// 使用 SFSymbol 做图标</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Button</span> <span class="title">where</span> <span class="title">Label</span> == <span class="title">Image</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">init</span>(<span class="params">systemIconName</span>: <span class="type">String</span>, <span class="params">done</span>: <span class="keyword">@escaping</span> () -&gt; <span class="type">Void</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.<span class="keyword">init</span>(action: done) &#123;</span><br><span class="line">            <span class="type">Image</span>(systemName: systemIconName)</span><br><span class="line">                .renderingMode(.original)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - 自定义 Button</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PCustomButton</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> desTextView: <span class="type">Text</span></span><br><span class="line">    <span class="keyword">let</span> act: () -&gt; <span class="type">Void</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">des</span>: <span class="type">LocalizedStringKey</span>, <span class="params">act</span>: <span class="keyword">@escaping</span> () -&gt; <span class="type">Void</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.desTextView <span class="operator">=</span> <span class="type">Text</span>(des)</span><br><span class="line">        <span class="keyword">self</span>.act <span class="operator">=</span> act</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Button</span> &#123;</span><br><span class="line">            act()</span><br><span class="line">        &#125; label: &#123;</span><br><span class="line">            desTextView.bold()</span><br><span class="line">        &#125;</span><br><span class="line">        .buttonStyle(.starming)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">PCustomButton</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">desTextView</span>: <span class="type">Text</span>, <span class="params">act</span>: <span class="keyword">@escaping</span> () -&gt; <span class="type">Void</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.desTextView <span class="operator">=</span> desTextView</span><br><span class="line">        <span class="keyword">self</span>.act <span class="operator">=</span> act</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 点语法使用自定义样式</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ButtonStyle</span> <span class="title">where</span> <span class="title">Self</span> == <span class="title">PCustomButtonStyle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> starming: <span class="type">PCustomButtonStyle</span> &#123;</span><br><span class="line">        <span class="type">PCustomButtonStyle</span>(cornerRadius: <span class="number">15</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - ButtonStyle</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PCustomButtonStyle</span>: <span class="title">ButtonStyle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> cornerRadius:<span class="type">Double</span> <span class="operator">=</span> <span class="number">10</span></span><br><span class="line">    <span class="keyword">var</span> backgroundColor: <span class="type">Color</span> <span class="operator">=</span> .pink</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeBody</span>(<span class="params">configuration</span>: <span class="type">Configuration</span>)</span> -&gt; <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">            configuration.label</span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">        .background(</span><br><span class="line">            <span class="type">RoundedRectangle</span>(cornerRadius: cornerRadius, style: .continuous)</span><br><span class="line">                .fill(backgroundColor)</span><br><span class="line">                .shadow(color: configuration.isPressed <span class="operator">?</span> .white : .black, radius: <span class="number">1</span>, x: <span class="number">0</span>, y: <span class="number">1</span>)</span><br><span class="line">        )</span><br><span class="line">        .opacity(configuration.isPressed <span class="operator">?</span> <span class="number">0.5</span> : <span class="number">1</span>)</span><br><span class="line">        .scaleEffect(configuration.isPressed <span class="operator">?</span> <span class="number">0.99</span> : <span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - PrimitiveButtonStyle</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PCustomPrimitiveButtonStyle</span>: <span class="title">PrimitiveButtonStyle</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeBody</span>(<span class="params">configuration</span>: <span class="type">Configuration</span>)</span> -&gt; <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="comment">// 双击触发</span></span><br><span class="line">        configuration.label</span><br><span class="line">            .onTapGesture(count: <span class="number">2</span>) &#123;</span><br><span class="line">                configuration.trigger()</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="comment">// 手势识别</span></span><br><span class="line">        <span class="type">Button</span>(configuration)</span><br><span class="line">            .gesture(</span><br><span class="line">                <span class="type">LongPressGesture</span>()</span><br><span class="line">                    .onEnded(&#123; <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">                        configuration.trigger()</span><br><span class="line">                    &#125;)</span><br><span class="line">            )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - 风格化</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PStarmingButtonStyle</span>: <span class="title">ButtonStyle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> backgroundColor <span class="operator">=</span> <span class="type">Color</span>.skeumorphismBG</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeBody</span>(<span class="params">configuration</span>: <span class="type">Configuration</span>)</span> -&gt; <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">            configuration.label</span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        .padding(<span class="number">20</span>)</span><br><span class="line">        .background(</span><br><span class="line">            <span class="type">ZStack</span> &#123;</span><br><span class="line">                <span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">10</span>, style: .continuous)</span><br><span class="line">                    .shadow(color: .white, radius: configuration.isPressed <span class="operator">?</span> <span class="number">7</span> : <span class="number">10</span>, x: configuration.isPressed <span class="operator">?</span> <span class="operator">-</span><span class="number">5</span> : <span class="operator">-</span><span class="number">10</span>, y: configuration.isPressed <span class="operator">?</span> <span class="operator">-</span><span class="number">5</span> : <span class="operator">-</span><span class="number">10</span>)</span><br><span class="line">                    .shadow(color: .black, radius: configuration.isPressed <span class="operator">?</span> <span class="number">7</span> : <span class="number">10</span>, x: configuration.isPressed <span class="operator">?</span> <span class="number">5</span> : <span class="number">10</span>, y: configuration.isPressed <span class="operator">?</span> <span class="number">5</span> : <span class="number">10</span>)</span><br><span class="line">                    .blendMode(.overlay)</span><br><span class="line">                <span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">10</span>, style: .continuous)</span><br><span class="line">                    .fill(backgroundColor)</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">        .scaleEffect(configuration.isPressed <span class="operator">?</span> <span class="number">0.98</span> : <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Color</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> skeumorphismBG <span class="operator">=</span> <span class="type">Color</span>(hex: <span class="string">&quot;f0f0f3&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Color</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">init</span>(<span class="params">hex</span>: <span class="type">String</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> rgbValue: <span class="type">UInt64</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">        <span class="type">Scanner</span>(string: hex).scanHexInt64(<span class="operator">&amp;</span>rgbValue)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> r <span class="operator">=</span> (rgbValue <span class="operator">&amp;</span> <span class="number">0xff0000</span>) <span class="operator">&gt;&gt;</span> <span class="number">16</span></span><br><span class="line">        <span class="keyword">let</span> g <span class="operator">=</span> (rgbValue <span class="operator">&amp;</span> <span class="number">0xff00</span>) <span class="operator">&gt;&gt;</span> <span class="number">8</span></span><br><span class="line">        <span class="keyword">let</span> b <span class="operator">=</span> rgbValue <span class="operator">&amp;</span> <span class="number">0xff</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">self</span>.<span class="keyword">init</span>(red: <span class="type">Double</span>(r) <span class="operator">/</span> <span class="number">0xff</span>, green: <span class="type">Double</span>(g) <span class="operator">/</span> <span class="number">0xff</span>, blue: <span class="type">Double</span>(b) <span class="operator">/</span> <span class="number">0xff</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ProgressView"><a href="#ProgressView" class="headerlink" title="ProgressView"></a>ProgressView</h4><p><img src="https://user-images.githubusercontent.com/251980/155676571-726c15d1-e4a2-4493-8fb0-c37c1c61c88c.jpeg" alt=""></p>
<p>用 ProgressViewStyle 协议，可以创建自定义的进度条视图。在 WatchOS 上会多一个 Guage 视图。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PlayProgressView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> v: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="number">0.0</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="comment">// 默认旋转</span></span><br><span class="line">            <span class="type">ProgressView</span>()</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 有进度条</span></span><br><span class="line">            <span class="type">ProgressView</span>(value: v <span class="operator">/</span> <span class="number">100</span>)</span><br><span class="line">                .tint(.yellow)</span><br><span class="line">            </span><br><span class="line">            <span class="type">ProgressView</span>(value: v <span class="operator">/</span> <span class="number">100</span>) &#123;</span><br><span class="line">                <span class="type">Image</span>(systemName: <span class="string">&quot;music.note.tv&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            .progressViewStyle(<span class="type">CircularProgressViewStyle</span>(tint: .pink))</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 自定义样式</span></span><br><span class="line">            <span class="type">ProgressView</span>(value: v <span class="operator">/</span> <span class="number">100</span>)</span><br><span class="line">                .padding(.vertical)</span><br><span class="line">                .progressViewStyle(<span class="type">PCProgressStyle1</span>(borderWidth: <span class="number">3</span>))</span><br><span class="line">            </span><br><span class="line">            <span class="type">ProgressView</span>(value: v <span class="operator">/</span> <span class="number">100</span>)</span><br><span class="line">                .progressViewStyle(<span class="type">PCProgressStyle2</span>())</span><br><span class="line">                .frame(height:<span class="number">200</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">Slider</span>(value: <span class="variable">$v</span>, in: <span class="number">0</span><span class="operator">...</span><span class="number">100</span>, step: <span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .padding(<span class="number">20</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义 Progress 样式</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PCProgressStyle1</span>: <span class="title">ProgressViewStyle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> lg <span class="operator">=</span> <span class="type">LinearGradient</span>(colors: [.purple, .black, .blue], startPoint: .topLeading, endPoint: .bottomTrailing)</span><br><span class="line">    <span class="keyword">var</span> borderWidth: <span class="type">Double</span> <span class="operator">=</span> <span class="number">2</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeBody</span>(<span class="params">configuration</span>: <span class="type">Configuration</span>)</span> -&gt; <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> fc <span class="operator">=</span> configuration.fractionCompleted <span class="operator">??</span> <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">ZStack</span>(alignment: .topLeading) &#123;</span><br><span class="line">                <span class="type">GeometryReader</span> &#123; g <span class="keyword">in</span></span><br><span class="line">                    <span class="type">Rectangle</span>()</span><br><span class="line">                        .fill(lg)</span><br><span class="line">                        .frame(maxWidth: g.size.width <span class="operator">*</span> <span class="type">CGFloat</span>(fc))</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .frame(height: <span class="number">20</span>)</span><br><span class="line">            .cornerRadius(<span class="number">10</span>)</span><br><span class="line">            .overlay(</span><br><span class="line">                <span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">10</span>)</span><br><span class="line">                    .stroke(lg, lineWidth: borderWidth)</span><br><span class="line">            )</span><br><span class="line">            <span class="comment">// end ZStack</span></span><br><span class="line">        &#125; <span class="comment">// end VStack</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PCProgressStyle2</span>: <span class="title">ProgressViewStyle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> lg <span class="operator">=</span> <span class="type">LinearGradient</span>(colors: [.orange, .yellow, .green, .blue, .purple], startPoint: .topLeading, endPoint: .bottomTrailing)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> borderWidth: <span class="type">Double</span> <span class="operator">=</span> <span class="number">20</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeBody</span>(<span class="params">configuration</span>: <span class="type">Configuration</span>)</span> -&gt; <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> fc <span class="operator">=</span> configuration.fractionCompleted <span class="operator">??</span> <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">func</span> <span class="title">strokeStyle</span>(<span class="keyword">_</span> <span class="params">g</span>: <span class="type">GeometryProxy</span>)</span> -&gt; <span class="type">StrokeStyle</span> &#123;</span><br><span class="line">            <span class="type">StrokeStyle</span>(lineWidth: <span class="number">0.1</span> <span class="operator">*</span> <span class="built_in">min</span>(g.size.width, g.size.height), lineCap: .round)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">GeometryReader</span> &#123; g <span class="keyword">in</span></span><br><span class="line">                <span class="type">ZStack</span> &#123;</span><br><span class="line">                    <span class="type">Group</span> &#123;</span><br><span class="line">                        <span class="type">Circle</span>()</span><br><span class="line">                            .trim(from: <span class="number">0</span>, to: <span class="number">1</span>)</span><br><span class="line">                            .stroke(lg, style: strokeStyle(g))</span><br><span class="line">                            .padding(borderWidth)</span><br><span class="line">                            .opacity(<span class="number">0.2</span>)</span><br><span class="line">                        <span class="type">Circle</span>()</span><br><span class="line">                            .trim(from: <span class="number">0</span>, to: fc)</span><br><span class="line">                            .stroke(lg, style: strokeStyle(g))</span><br><span class="line">                            .padding(borderWidth)</span><br><span class="line">                    &#125;</span><br><span class="line">                    .rotationEffect(.degrees(<span class="number">90</span> <span class="operator">+</span> <span class="number">360</span> <span class="operator">*</span> <span class="number">0.5</span>), anchor: .center)</span><br><span class="line">                    .offset(x: <span class="number">0</span>, y: <span class="number">0.1</span> <span class="operator">*</span> <span class="built_in">min</span>(g.size.width, g.size.height))</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;读取 <span class="subst">\(Int(fc <span class="operator">*</span> <span class="number">100</span>))</span> %&quot;</span>)</span><br><span class="line">                    .bold()</span><br><span class="line">                    .font(.headline)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// end ZStack</span></span><br><span class="line">        &#125; <span class="comment">// end VStack</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Image"><a href="#Image" class="headerlink" title="Image"></a>Image</h4><p><img src="https://user-images.githubusercontent.com/251980/155683776-0f0acdee-c7c1-44e3-a68b-38f778863821.png" alt=""></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PlayImageView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Image</span>(<span class="string">&quot;logo&quot;</span>)</span><br><span class="line">            .resizable()</span><br><span class="line">            .frame(width: <span class="number">100</span>, height: <span class="number">100</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="type">Image</span>(<span class="string">&quot;logo&quot;</span>)</span><br><span class="line">            .resizable()</span><br><span class="line">            .aspectRatio(contentMode: .fit)</span><br><span class="line">            .frame(width: <span class="number">50</span>, height: <span class="number">50</span>)</span><br><span class="line">            .clipShape(<span class="type">Circle</span>())</span><br><span class="line">            .overlay(</span><br><span class="line">                <span class="type">Circle</span>().stroke(.cyan, lineWidth: <span class="number">4</span>)</span><br><span class="line">            )</span><br><span class="line">            .shadow(radius: <span class="number">10</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// SF Symbols</span></span><br><span class="line">        <span class="type">Image</span>(systemName: <span class="string">&quot;scissors&quot;</span>)</span><br><span class="line">            .imageScale(.large)</span><br><span class="line">            .foregroundColor(.pink)</span><br><span class="line">            .frame(width: <span class="number">40</span>, height: <span class="number">40</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// SF Symbols 多色时使用原色</span></span><br><span class="line">        <span class="type">Image</span>(systemName: <span class="string">&quot;thermometer.sun.fill&quot;</span>)</span><br><span class="line">            .renderingMode(.original)</span><br><span class="line">            .imageScale(.large)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ControlGroup"><a href="#ControlGroup" class="headerlink" title="ControlGroup"></a>ControlGroup</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PlayControlGroupView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ControlGroup</span> &#123;</span><br><span class="line">            <span class="type">Button</span> &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;plus&quot;</span>)</span><br><span class="line">            &#125; label: &#123;</span><br><span class="line">                <span class="type">Image</span>(systemName: <span class="string">&quot;plus&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">Button</span> &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;minus&quot;</span>)</span><br><span class="line">            &#125; label: &#123;</span><br><span class="line">                <span class="type">Image</span>(systemName: <span class="string">&quot;minus&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">        .controlGroupStyle(.automatic) <span class="comment">// .automatic 是默认样式，还有 .navigation</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="GroupBox"><a href="#GroupBox" class="headerlink" title="GroupBox"></a>GroupBox</h4><p><img src="https://user-images.githubusercontent.com/251980/155317172-dc137c38-64d0-415a-8412-e3f479f2bd91.png" alt=""></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PlayGroupBoxView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">GroupBox</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;这是 GroupBox 的内容&quot;</span>)</span><br><span class="line">        &#125; label: &#123;</span><br><span class="line">            <span class="type">Label</span>(<span class="string">&quot;标题一&quot;</span>, systemImage: <span class="string">&quot;t.square.fill&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">        </span><br><span class="line">        <span class="type">GroupBox</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;还是 GroupBox 的内容&quot;</span>)</span><br><span class="line">        &#125; label: &#123;</span><br><span class="line">            <span class="type">Label</span>(<span class="string">&quot;标题二&quot;</span>, systemImage: <span class="string">&quot;t.square.fill&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">        .groupBoxStyle(<span class="type">PCGroupBoxStyle</span>())</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PCGroupBoxStyle</span>: <span class="title">GroupBoxStyle</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeBody</span>(<span class="params">configuration</span>: <span class="type">Configuration</span>)</span> -&gt; <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">            configuration.label</span><br><span class="line">                .font(.title)</span><br><span class="line">            configuration.content</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">        .background(.pink)</span><br><span class="line">        .clipShape(<span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">8</span>, style: .continuous))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Stack"><a href="#Stack" class="headerlink" title="Stack"></a>Stack</h4><p>Stack View 有 VStack、HStack 和 ZStack</p>
<p><img src="https://user-images.githubusercontent.com/251980/155077158-f6efd3bb-4b82-48ac-b5e6-792dd833dfda.jpeg" alt=""></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PlayStackView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="comment">// 默认是 VStack 竖排</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 横排</span></span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;左&quot;</span>)</span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;右&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Z 轴排</span></span><br><span class="line">        <span class="type">ZStack</span>(alignment: .top) &#123;</span><br><span class="line">            <span class="type">Image</span>(<span class="string">&quot;logo&quot;</span>)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;戴铭的开发小册子&quot;</span>)</span><br><span class="line">                .font(.title)</span><br><span class="line">                .bold()</span><br><span class="line">                .foregroundColor(.white)</span><br><span class="line">                .shadow(color: .black, radius: <span class="number">1</span>, x: <span class="number">0</span>, y: <span class="number">2</span>)</span><br><span class="line">                .padding()</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">Color</span>.cyan</span><br><span class="line">            .cornerRadius(<span class="number">10</span>)</span><br><span class="line">            .frame(width: <span class="number">100</span>, height: <span class="number">100</span>)</span><br><span class="line">            .overlay(</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;一段文字&quot;</span>)</span><br><span class="line">            )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="NavigationView"><a href="#NavigationView" class="headerlink" title="NavigationView"></a>NavigationView</h4><p><img src="https://user-images.githubusercontent.com/251980/155517358-4e5d54b8-0284-4fde-bf09-4b5e22e0e9a5.jpeg" alt=""></p>
<p>对应代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PlayNavigationView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> lData <span class="operator">=</span> <span class="number">1</span><span class="operator">...</span><span class="number">10</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">ZStack</span> &#123;</span><br><span class="line">                <span class="type">LinearGradient</span>(colors: [.pink, .orange], startPoint: .topLeading, endPoint: .bottomTrailing)</span><br><span class="line">                    .ignoresSafeArea()</span><br><span class="line">                </span><br><span class="line">                <span class="type">List</span>(lData, id: \.<span class="keyword">self</span>) &#123; i <span class="keyword">in</span></span><br><span class="line">                    <span class="type">NavigationLink</span> &#123;</span><br><span class="line">                        <span class="type">PNavDetailView</span>(contentStr: <span class="string">&quot;<span class="subst">\(i)</span>&quot;</span>)</span><br><span class="line">                    &#125; label: &#123;</span><br><span class="line">                        <span class="type">Text</span>(<span class="string">&quot;<span class="subst">\(i)</span>&quot;</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">ZStack</span> &#123;</span><br><span class="line">                <span class="type">LinearGradient</span>(colors: [.mint, .yellow], startPoint: .topLeading, endPoint: .bottomTrailing)</span><br><span class="line">                    .ignoresSafeArea()</span><br><span class="line">                </span><br><span class="line">                <span class="type">VStack</span> &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;一个 NavigationView 的示例&quot;</span>)</span><br><span class="line">                        .bold()</span><br><span class="line">                        .font(.largeTitle)</span><br><span class="line">                        .shadow(color: .white, radius: <span class="number">9</span>, x: <span class="number">0</span>, y: <span class="number">0</span>)</span><br><span class="line">                        .scaleEffect(<span class="number">2</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .safeAreaInset(edge: .bottom) &#123;</span><br><span class="line">                <span class="type">HStack</span> &#123;</span><br><span class="line">                    <span class="type">Button</span>(<span class="string">&quot;bottom1&quot;</span>) &#123;&#125;</span><br><span class="line">                    .font(.headline)</span><br><span class="line">                    <span class="type">Button</span>(<span class="string">&quot;bottom2&quot;</span>) &#123;&#125;</span><br><span class="line">                    <span class="type">Button</span>(<span class="string">&quot;bottom3&quot;</span>) &#123;&#125;</span><br><span class="line">                    <span class="type">Spacer</span>()</span><br><span class="line">                &#125;</span><br><span class="line">                .padding(<span class="number">5</span>)</span><br><span class="line">                .background(<span class="type">LinearGradient</span>(colors: [.purple, .blue], startPoint: .topLeading, endPoint: .bottomTrailing))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .foregroundColor(.white)</span><br><span class="line">        .navigationTitle(<span class="string">&quot;数字列表&quot;</span>)</span><br><span class="line">        .toolbar &#123;</span><br><span class="line">            <span class="comment">// placement 共有 keyboard、destructiveAction、cancellationAction、confirmationAction、status、primaryAction、navigation、principal、automatic 这些</span></span><br><span class="line">            <span class="type">ToolbarItem</span>(placement: .primaryAction) &#123;</span><br><span class="line">                <span class="type">Button</span>(<span class="string">&quot;primaryAction&quot;</span>) &#123;&#125;</span><br><span class="line">                .background(.ultraThinMaterial)</span><br><span class="line">                .font(.headline)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 通过 ToolbarItemGroup 可以简化相同位置 ToolbarItem 的编写。</span></span><br><span class="line">            <span class="type">ToolbarItemGroup</span>(placement: .navigation) &#123;</span><br><span class="line">                <span class="type">Button</span>(<span class="string">&quot;返回&quot;</span>) &#123;&#125;</span><br><span class="line">                <span class="type">Button</span>(<span class="string">&quot;前进&quot;</span>) &#123;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">PCToolbar</span>(doDestruct: &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;删除了&quot;</span>)</span><br><span class="line">            &#125;, doCancel: &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;取消了&quot;</span>)</span><br><span class="line">            &#125;, doConfirm: &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;确认了&quot;</span>)</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="type">ToolbarItem</span>(placement: .status) &#123;</span><br><span class="line">                <span class="type">Button</span>(<span class="string">&quot;status&quot;</span>) &#123;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">ToolbarItem</span>(placement: .principal) &#123;</span><br><span class="line">                <span class="type">Button</span>(<span class="string">&quot;principal&quot;</span>) &#123;</span><br><span class="line">                    </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">ToolbarItem</span>(placement: .keyboard) &#123;</span><br><span class="line">                <span class="type">Button</span>(<span class="string">&quot;Touch Bar Button&quot;</span>) &#123;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="comment">// end toolbar</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - NavigationView 的目的页面</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PNavDetailView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Environment</span>(\.presentationMode) <span class="keyword">var</span> pMode: <span class="type">Binding</span>&lt;<span class="type">PresentationMode</span>&gt;</span><br><span class="line">    <span class="keyword">var</span> contentStr: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ZStack</span> &#123;</span><br><span class="line">            <span class="type">LinearGradient</span>(colors: [.purple, .blue], startPoint: .topLeading, endPoint: .bottomTrailing)</span><br><span class="line">                .ignoresSafeArea()</span><br><span class="line">            <span class="type">VStack</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(contentStr)</span><br><span class="line">                <span class="type">Button</span>(<span class="string">&quot;返回&quot;</span>) &#123;</span><br><span class="line">                    pMode.wrappedValue.dismiss()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="comment">// end ZStack</span></span><br><span class="line">    &#125; <span class="comment">// end body</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - 自定义 toolbar</span></span><br><span class="line"><span class="comment">// 通过 ToolbarContent 创建可重复使用的 toolbar 组</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PCToolbar</span>: <span class="title">ToolbarContent</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> doDestruct: () -&gt; <span class="type">Void</span></span><br><span class="line">    <span class="keyword">let</span> doCancel: () -&gt; <span class="type">Void</span></span><br><span class="line">    <span class="keyword">let</span> doConfirm: () -&gt; <span class="type">Void</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">ToolbarContent</span> &#123;</span><br><span class="line">        <span class="type">ToolbarItem</span>(placement: .destructiveAction) &#123;</span><br><span class="line">            <span class="type">Button</span>(<span class="string">&quot;删除&quot;</span>, action: doDestruct)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">ToolbarItem</span>(placement: .cancellationAction) &#123;</span><br><span class="line">            <span class="type">Button</span>(<span class="string">&quot;取消&quot;</span>, action: doCancel)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">ToolbarItem</span>(placement: .confirmationAction) &#123;</span><br><span class="line">            <span class="type">Button</span>(<span class="string">&quot;确定&quot;</span>, action: doConfirm)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>toolbar 的位置设置可选项如下：</p>
<ul>
<li>primaryAction：放置到最主要位置，macOS 就是放在 toolbar 的最左边</li>
<li>automatic：根据平台不同放到默认位置</li>
<li>confirmationAction：一些确定的动作</li>
<li>cancellationAction：取消动作</li>
<li>destructiveAction：删除的动作</li>
<li>status：状态变化，比如检查更新等动作</li>
<li>navigation：导航动作，比如浏览器的前进后退</li>
<li>principal：突出的位置，iOS 和 macOS 会出现在中间的位置</li>
<li>keyboard：macOS 会出现在 Touch Bar 里。iOS 会出现在弹出的虚拟键盘上。</li>
</ul>
<h4 id="List"><a href="#List" class="headerlink" title="List"></a>List</h4><p><img src="https://user-images.githubusercontent.com/251980/155293565-d85080c1-2304-491b-be72-20aa921f7067.jpeg" alt=""></p>
<p>List 除了能够展示数据外，还有下拉刷新、过滤搜索和侧滑 Swipe 动作提供更多 Cell 操作的能力。</p>
<p>通过 List 的可选子项参数提供数据模型的关键路径来制定子项路劲，还可以实现大纲视图，使用 DisclosureGroup 和 OutlineGroup  可以进一步定制大纲视图。</p>
<p>下面是 List 使用，包括了 DisclosureGroup 和 OutlineGroup 的演示代码：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PlayListView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="meta">@StateObject</span> <span class="keyword">var</span> l: <span class="type">PLVM</span> <span class="operator">=</span> <span class="type">PLVM</span>()</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> s: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> outlineModel <span class="operator">=</span> [</span><br><span class="line">        <span class="type">POutlineModel</span>(title: <span class="string">&quot;文件夹一&quot;</span>, iconName: <span class="string">&quot;folder.fill&quot;</span>, children: [</span><br><span class="line">            <span class="type">POutlineModel</span>(title: <span class="string">&quot;个人&quot;</span>, iconName: <span class="string">&quot;person.crop.circle.fill&quot;</span>),</span><br><span class="line">            <span class="type">POutlineModel</span>(title: <span class="string">&quot;群组&quot;</span>, iconName: <span class="string">&quot;person.2.circle.fill&quot;</span>),</span><br><span class="line">            <span class="type">POutlineModel</span>(title: <span class="string">&quot;加好友&quot;</span>, iconName: <span class="string">&quot;person.badge.plus&quot;</span>)</span><br><span class="line">        ]),</span><br><span class="line">        <span class="type">POutlineModel</span>(title: <span class="string">&quot;文件夹二&quot;</span>, iconName: <span class="string">&quot;folder.fill&quot;</span>, children: [</span><br><span class="line">            <span class="type">POutlineModel</span>(title: <span class="string">&quot;晴天&quot;</span>, iconName: <span class="string">&quot;sun.max.fill&quot;</span>),</span><br><span class="line">            <span class="type">POutlineModel</span>(title: <span class="string">&quot;夜间&quot;</span>, iconName: <span class="string">&quot;moon.fill&quot;</span>),</span><br><span class="line">            <span class="type">POutlineModel</span>(title: <span class="string">&quot;雨天&quot;</span>, iconName: <span class="string">&quot;cloud.rain.fill&quot;</span>, children: [</span><br><span class="line">                <span class="type">POutlineModel</span>(title: <span class="string">&quot;雷加雨&quot;</span>, iconName: <span class="string">&quot;cloud.bolt.rain.fill&quot;</span>),</span><br><span class="line">                <span class="type">POutlineModel</span>(title: <span class="string">&quot;太阳雨&quot;</span>, iconName: <span class="string">&quot;cloud.sun.rain.fill&quot;</span>)</span><br><span class="line">            ])</span><br><span class="line">        ]),</span><br><span class="line">        <span class="type">POutlineModel</span>(title: <span class="string">&quot;文件夹三&quot;</span>, iconName: <span class="string">&quot;folder.fill&quot;</span>, children: [</span><br><span class="line">            <span class="type">POutlineModel</span>(title: <span class="string">&quot;电话&quot;</span>, iconName: <span class="string">&quot;phone&quot;</span>),</span><br><span class="line">            <span class="type">POutlineModel</span>(title: <span class="string">&quot;拍照&quot;</span>, iconName: <span class="string">&quot;camera.circle.fill&quot;</span>),</span><br><span class="line">            <span class="type">POutlineModel</span>(title: <span class="string">&quot;提醒&quot;</span>, iconName: <span class="string">&quot;bell&quot;</span>)</span><br><span class="line">        ])</span><br><span class="line">    ]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            <span class="comment">// List 通过$语法可以将集合的元素转换成可绑定的值</span></span><br><span class="line">            <span class="type">List</span> &#123;</span><br><span class="line">                <span class="type">ForEach</span>(<span class="variable">$l</span>.ls) &#123; <span class="variable">$d</span> <span class="keyword">in</span></span><br><span class="line">                    <span class="type">PRowView</span>(s: d.s, i: d.i)</span><br><span class="line">                        .listRowInsets(<span class="type">EdgeInsets</span>(top: <span class="number">5</span>, leading: <span class="number">15</span>, bottom: <span class="number">5</span>, trailing: <span class="number">15</span>))</span><br><span class="line">                        .listRowBackground(<span class="type">Color</span>.black.opacity(<span class="number">0.2</span>))</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .refreshable &#123;</span><br><span class="line">                <span class="comment">// 下拉刷新</span></span><br><span class="line">            &#125;</span><br><span class="line">            .searchable(text: <span class="variable">$s</span>) <span class="comment">// 搜索</span></span><br><span class="line">            .onChange(of: s) &#123; newValue <span class="keyword">in</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;搜索关键字：<span class="subst">\(s)</span>&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">Divider</span>()</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 自定义 List</span></span><br><span class="line">            <span class="type">VStack</span> &#123;</span><br><span class="line">                <span class="type">PCustomListView</span>(<span class="variable">$l</span>.ls) &#123; <span class="variable">$d</span> <span class="keyword">in</span></span><br><span class="line">                    <span class="type">PRowView</span>(s: d.s, i: d.i)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 添加数据</span></span><br><span class="line">                <span class="type">Button</span> &#123;</span><br><span class="line">                    l.ls.append(<span class="type">PLModel</span>(s: <span class="string">&quot;More&quot;</span>, i: <span class="number">0</span>))</span><br><span class="line">                &#125; label: &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;添加&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line">            </span><br><span class="line">            <span class="type">Divider</span>()</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 使用大纲</span></span><br><span class="line">            <span class="type">List</span>(outlineModel, children: \.children) &#123; i <span class="keyword">in</span></span><br><span class="line">                <span class="type">Label</span>(i.title, systemImage: i.iconName)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">Divider</span>()</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 自定义大纲视图</span></span><br><span class="line">            <span class="type">VStack</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;可点击标题展开&quot;</span>)</span><br><span class="line">                    .font(.headline)</span><br><span class="line">                <span class="type">PCOutlineListView</span>(d: outlineModel, c: \.children) &#123; i <span class="keyword">in</span></span><br><span class="line">                    <span class="type">Label</span>(i.title, systemImage: i.iconName)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line">            </span><br><span class="line">            <span class="type">Divider</span>()</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 使用 OutlineGroup 实现大纲视图</span></span><br><span class="line">            <span class="type">VStack</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;OutlineGroup 实现大纲&quot;</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="type">OutlineGroup</span>(outlineModel, children: \.children) &#123; i <span class="keyword">in</span></span><br><span class="line">                    <span class="type">Label</span>(i.title, systemImage: i.iconName)</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// OutlineGroup 和 List 结合</span></span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;OutlineGroup 和 List 结合&quot;</span>)</span><br><span class="line">                <span class="type">List</span> &#123;</span><br><span class="line">                    <span class="type">ForEach</span>(outlineModel) &#123; s <span class="keyword">in</span></span><br><span class="line">                        <span class="type">Section</span> &#123;</span><br><span class="line">                            <span class="type">OutlineGroup</span>(s.children <span class="operator">??</span> [], children: \.children) &#123; i <span class="keyword">in</span></span><br><span class="line">                                <span class="type">Label</span>(i.title, systemImage: i.iconName)</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125; header: &#123;</span><br><span class="line">                            <span class="type">Label</span>(s.title, systemImage: s.iconName)</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                    &#125; <span class="comment">// end ForEach</span></span><br><span class="line">                &#125; <span class="comment">// end List</span></span><br><span class="line">            &#125; <span class="comment">// end VStack</span></span><br><span class="line">        &#125; <span class="comment">// end HStack</span></span><br><span class="line">    &#125; <span class="comment">// end body</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - 自定义大纲视图</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PCOutlineListView</span>&lt;<span class="title">D</span>, <span class="title">Content</span>&gt;: <span class="title">View</span> <span class="title">where</span> <span class="title">D</span>: <span class="title">RandomAccessCollection</span>, <span class="title">D</span>.<span class="title">Element</span>: <span class="title">Identifiable</span>, <span class="title">Content</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> v: <span class="type">PCOutlineView</span>&lt;<span class="type">D</span>, <span class="type">Content</span>&gt;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">init</span>(<span class="params">d</span>: <span class="type">D</span>, <span class="params">c</span>: <span class="type">KeyPath</span>&lt;<span class="type">D</span>.<span class="type">Element</span>, <span class="type">D</span>?&gt;, <span class="params">content</span>: <span class="keyword">@escaping</span> (<span class="type">D</span>.<span class="type">Element</span>) -&gt; <span class="type">Content</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.v <span class="operator">=</span> <span class="type">PCOutlineView</span>(d: d, c: c, content: content)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            v</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PCOutlineView</span>&lt;<span class="title">D</span>, <span class="title">Content</span>&gt;: <span class="title">View</span> <span class="title">where</span> <span class="title">D</span>: <span class="title">RandomAccessCollection</span>, <span class="title">D</span>.<span class="title">Element</span>: <span class="title">Identifiable</span>, <span class="title">Content</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> d: <span class="type">D</span></span><br><span class="line">    <span class="keyword">let</span> c: <span class="type">KeyPath</span>&lt;<span class="type">D</span>.<span class="type">Element</span>, <span class="type">D</span>?&gt;</span><br><span class="line">    <span class="keyword">let</span> content: (<span class="type">D</span>.<span class="type">Element</span>) -&gt; <span class="type">Content</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> isExpanded <span class="operator">=</span> <span class="literal">true</span> <span class="comment">// 控制初始是否展开的状态</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ForEach</span>(d) &#123; i <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> sub <span class="operator">=</span> i[keyPath: c] &#123;</span><br><span class="line">                <span class="type">PCDisclosureGroup</span>(content: <span class="type">PCOutlineView</span>(d: sub, c: c, content: content), label: content(i))</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                content(i)</span><br><span class="line">            &#125; <span class="comment">// end if</span></span><br><span class="line">        &#125; <span class="comment">// end ForEach</span></span><br><span class="line">    &#125; <span class="comment">// end body</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PCDisclosureGroup</span>&lt;<span class="title">C</span>, <span class="title">L</span>&gt;: <span class="title">View</span> <span class="title">where</span> <span class="title">C</span>: <span class="title">View</span>, <span class="title">L</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> isExpanded <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    <span class="keyword">var</span> content: <span class="type">C</span></span><br><span class="line">    <span class="keyword">var</span> label: <span class="type">L</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">DisclosureGroup</span>(isExpanded: <span class="variable">$isExpanded</span>) &#123;</span><br><span class="line">            content</span><br><span class="line">        &#125; label: &#123;</span><br><span class="line">            <span class="type">Button</span> &#123;</span><br><span class="line">                isExpanded.toggle()</span><br><span class="line">            &#125; label: &#123;</span><br><span class="line">                label</span><br><span class="line">            &#125;</span><br><span class="line">            .buttonStyle(.plain)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - 大纲模式数据模型</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">POutlineModel</span>: <span class="title">Hashable</span>, <span class="title">Identifiable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> id <span class="operator">=</span> <span class="type">UUID</span>()</span><br><span class="line">    <span class="keyword">var</span> title: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> iconName: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> children: [<span class="type">POutlineModel</span>]<span class="operator">?</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - List 的抽象，数据兼容任何集合类型</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PCustomListView</span>&lt;<span class="title">D</span>: <span class="title">RandomAccessCollection</span> &amp; <span class="title">MutableCollection</span> &amp; <span class="title">RangeReplaceableCollection</span>, <span class="title">Content</span>: <span class="title">View</span>&gt;: <span class="title">View</span> <span class="title">where</span> <span class="title">D</span>.<span class="title">Element</span>: <span class="title">Identifiable</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Binding</span> <span class="keyword">var</span> data: <span class="type">D</span></span><br><span class="line">    <span class="keyword">var</span> content: (<span class="type">Binding</span>&lt;<span class="type">D</span>.<span class="type">Element</span>&gt;) -&gt; <span class="type">Content</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">data</span>: <span class="type">Binding</span>&lt;<span class="type">D</span>&gt;, <span class="params">content</span>: <span class="keyword">@escaping</span> (<span class="type">Binding</span>&lt;<span class="type">D</span>.<span class="type">Element</span>&gt;) -&gt; <span class="type">Content</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>._data <span class="operator">=</span> data</span><br><span class="line">        <span class="keyword">self</span>.content <span class="operator">=</span> content</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">Section</span> &#123;</span><br><span class="line">                <span class="type">ForEach</span>(<span class="variable">$data</span>, content: content)</span><br><span class="line">                    .onMove &#123; indexSet, offset <span class="keyword">in</span></span><br><span class="line">                        data.move(fromOffsets: indexSet, toOffset: offset)</span><br><span class="line">                    &#125;</span><br><span class="line">                    .onDelete &#123; indexSet <span class="keyword">in</span></span><br><span class="line">                        data.remove(atOffsets: indexSet) <span class="comment">// macOS 暂不支持</span></span><br><span class="line">                    &#125;</span><br><span class="line">            &#125; header: &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;第一栏，共 <span class="subst">\(data.count)</span> 项&quot;</span>)</span><br><span class="line">            &#125; footer: &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;The End&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .listStyle(.plain) <span class="comment">// 有.automatic、.inset、.plain、sidebar，macOS 暂不支持的有.grouped 和 .insetGrouped</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - Cell 视图</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PRowView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> s: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> i: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;<span class="subst">\(i)</span>：&quot;</span>)</span><br><span class="line">            <span class="type">Text</span>(s)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - 数据模型设计</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PLModel</span>: <span class="title">Hashable</span>, <span class="title">Identifiable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> id <span class="operator">=</span> <span class="type">UUID</span>()</span><br><span class="line">    <span class="keyword">var</span> s: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> i: <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">PLVM</span>: <span class="title">ObservableObject</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Published</span> <span class="keyword">var</span> ls: [<span class="type">PLModel</span>]</span><br><span class="line">    <span class="function"><span class="keyword">init</span>()</span> &#123;</span><br><span class="line">        ls <span class="operator">=</span> [<span class="type">PLModel</span>]()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">...</span><span class="number">20</span> &#123;</span><br><span class="line">            ls.append(<span class="type">PLModel</span>(s: <span class="string">&quot;<span class="subst">\(i)</span>&quot;</span>, i: i))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="LazyVStack-和-LazyHStack"><a href="#LazyVStack-和-LazyHStack" class="headerlink" title="LazyVStack 和 LazyHStack"></a>LazyVStack 和 LazyHStack</h4><p>LazyVStack 和 LazyHStack 里的视图只有在滚到时才会被创建。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PlayLazyVStackAndLazyHStackView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ScrollView</span> &#123;</span><br><span class="line">            <span class="type">LazyVStack</span> &#123;</span><br><span class="line">                <span class="type">ForEach</span>(<span class="number">1</span><span class="operator">...</span><span class="number">300</span>, id: \.<span class="keyword">self</span>) &#123; i <span class="keyword">in</span></span><br><span class="line">                    <span class="type">PLHSRowView</span>(i: i)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PLHSRowView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> i: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;第 <span class="subst">\(i)</span> 个&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">init</span>(<span class="params">i</span>: <span class="type">Int</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;第 <span class="subst">\(i)</span> 个初始化了&quot;</span>) <span class="comment">// 用来查看什么时候创建的。</span></span><br><span class="line">        <span class="keyword">self</span>.i <span class="operator">=</span> i</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="LazyVGrid-和-LazyHGrid"><a href="#LazyVGrid-和-LazyHGrid" class="headerlink" title="LazyVGrid 和 LazyHGrid"></a>LazyVGrid 和 LazyHGrid</h4><p><img src="https://user-images.githubusercontent.com/251980/155708552-35396dcd-f120-4498-a793-a65abd68c0a6.jpeg" alt=""></p>
<p>列的设置有三种，这三种也可以组合用。</p>
<ul>
<li>GridItem(.fixed(10)) 会固定设置有多少列。</li>
<li>GridItem(.flexible()) 会充满没有使用的空间。</li>
<li>GridItem(.adaptive(minimum: 10)) 表示会根据设置大小自动设置有多少列展示。</li>
</ul>
<p>示例：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PlayLazyVGridAndLazyHGridView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> colors: [<span class="type">String</span>:<span class="type">Color</span>] <span class="operator">=</span> [</span><br><span class="line">        <span class="string">&quot;red&quot;</span> : .red,</span><br><span class="line">        <span class="string">&quot;orange&quot;</span> : .orange,</span><br><span class="line">        <span class="string">&quot;yellow&quot;</span> : .yellow,</span><br><span class="line">        <span class="string">&quot;green&quot;</span> : .green,</span><br><span class="line">        <span class="string">&quot;mint&quot;</span> : .mint,</span><br><span class="line">        <span class="string">&quot;teal&quot;</span> : .teal,</span><br><span class="line">        <span class="string">&quot;cyan&quot;</span> : .cyan,</span><br><span class="line">        <span class="string">&quot;blue&quot;</span> : .blue,</span><br><span class="line">        <span class="string">&quot;indigo&quot;</span> : .indigo,</span><br><span class="line">        <span class="string">&quot;purple&quot;</span> : .purple,</span><br><span class="line">        <span class="string">&quot;pink&quot;</span> : .pink,</span><br><span class="line">        <span class="string">&quot;brown&quot;</span> : .brown,</span><br><span class="line">        <span class="string">&quot;gray&quot;</span> : .gray,</span><br><span class="line">        <span class="string">&quot;black&quot;</span> : .black</span><br><span class="line">    ]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ScrollView</span> &#123;</span><br><span class="line">            <span class="type">LazyVGrid</span>(columns: [</span><br><span class="line">                <span class="type">GridItem</span>(.adaptive(minimum: <span class="number">50</span>), spacing: <span class="number">10</span>)</span><br><span class="line">            ], pinnedViews: [.sectionHeaders]) &#123;</span><br><span class="line">                <span class="type">Section</span>(header:</span><br><span class="line">                            <span class="type">Text</span>(<span class="string">&quot;🎨调色板&quot;</span>)</span><br><span class="line">                            .font(.title)</span><br><span class="line">                            .frame(maxWidth: .infinity, maxHeight: .infinity)</span><br><span class="line">                                .background(<span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">0</span>)</span><br><span class="line">                                                .fill(.black.opacity(<span class="number">0.1</span>)))</span><br><span class="line">                ) &#123;</span><br><span class="line">                    <span class="type">ForEach</span>(<span class="type">Array</span>(colors.keys), id: \.<span class="keyword">self</span>) &#123; k <span class="keyword">in</span></span><br><span class="line">                        colors[k].frame(height:<span class="type">Double</span>(<span class="type">Int</span>.random(in: <span class="number">50</span><span class="operator">...</span><span class="number">150</span>)))</span><br><span class="line">                            .overlay(</span><br><span class="line">                                <span class="type">Text</span>(k)</span><br><span class="line">                            )</span><br><span class="line">                            .shadow(color: .black, radius: <span class="number">2</span>, x: <span class="number">0</span>, y: <span class="number">2</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line">            </span><br><span class="line">            <span class="type">LazyVGrid</span>(columns: [</span><br><span class="line">                <span class="type">GridItem</span>(.adaptive(minimum: <span class="number">20</span>), spacing: <span class="number">10</span>)</span><br><span class="line">            ]) &#123;</span><br><span class="line">                <span class="type">Section</span>(header: <span class="type">Text</span>(<span class="string">&quot;图标集&quot;</span>).font(.title)) &#123;</span><br><span class="line">                    <span class="type">ForEach</span>(<span class="number">1</span><span class="operator">...</span><span class="number">30</span>, id: \.<span class="keyword">self</span>) &#123; i <span class="keyword">in</span></span><br><span class="line">                        <span class="type">Image</span>(<span class="string">&quot;p<span class="subst">\(i)</span>&quot;</span>)</span><br><span class="line">                            .resizable()</span><br><span class="line">                            .aspectRatio(contentMode: .fit)</span><br><span class="line">                            .shadow(color: .black, radius: <span class="number">2</span>, x: <span class="number">0</span>, y: <span class="number">2</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ScrollView"><a href="#ScrollView" class="headerlink" title="ScrollView"></a>ScrollView</h4><p>ScrollView 使用 scrollTo 可以直接滚动到指定的位置。ScrollView 还可以透出偏移量，利用偏移量可以定义自己的动态视图，比如向下向上滚动视图时有不同效果，到顶部显示标题视图等。</p>
<p>示例代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PlayScrollView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> scrollOffset: <span class="type">CGFloat</span> <span class="operator">=</span> .zero</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> infoView: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">GeometryReader</span> &#123; g <span class="keyword">in</span></span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;移动了 <span class="subst">\(Double(scrollOffset).formatted(.number.precision(.fractionLength(<span class="number">1</span>)).rounded()))</span>&quot;</span>)</span><br><span class="line">                .padding()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="comment">// 标准用法</span></span><br><span class="line">        <span class="type">ScrollViewReader</span> &#123; s <span class="keyword">in</span></span><br><span class="line">            <span class="type">ScrollView</span> &#123;</span><br><span class="line">                <span class="type">ForEach</span>(<span class="number">0</span><span class="operator">..&lt;</span><span class="number">300</span>) &#123; i <span class="keyword">in</span></span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;<span class="subst">\(i)</span>&quot;</span>)</span><br><span class="line">                        .id(i)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">Button</span>(<span class="string">&quot;跳到150&quot;</span>) &#123;</span><br><span class="line">                withAnimation &#123;</span><br><span class="line">                    s.scrollTo(<span class="number">150</span>, anchor: .top)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="comment">// end Button</span></span><br><span class="line">        &#125; <span class="comment">// end ScrollViewReader</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 自定义的 ScrollView 透出 offset 供使用</span></span><br><span class="line">        <span class="type">ZStack</span> &#123;</span><br><span class="line">            <span class="type">PCScrollView</span> &#123;</span><br><span class="line">                <span class="type">ForEach</span>(<span class="number">0</span><span class="operator">..&lt;</span><span class="number">100</span>) &#123; i <span class="keyword">in</span></span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;<span class="subst">\(i)</span>&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; whenMoved: &#123; d <span class="keyword">in</span></span><br><span class="line">                scrollOffset <span class="operator">=</span> d</span><br><span class="line">            &#125;</span><br><span class="line">            infoView</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="comment">// end ZStack</span></span><br><span class="line">    &#125; <span class="comment">// end body</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - 自定义 ScrollView</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PCScrollView</span>&lt;<span class="title">C</span>: <span class="title">View</span>&gt;: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> c: () -&gt; <span class="type">C</span></span><br><span class="line">    <span class="keyword">let</span> whenMoved: (<span class="type">CGFloat</span>) -&gt; <span class="type">Void</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">init</span>(<span class="meta">@ViewBuilder</span> <span class="params">c</span>: <span class="keyword">@escaping</span> () -&gt; <span class="type">C</span>, <span class="params">whenMoved</span>: <span class="keyword">@escaping</span> (<span class="type">CGFloat</span>) -&gt; <span class="type">Void</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.c <span class="operator">=</span> c</span><br><span class="line">        <span class="keyword">self</span>.whenMoved <span class="operator">=</span> whenMoved</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> offsetReader: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">GeometryReader</span> &#123; g <span class="keyword">in</span></span><br><span class="line">            <span class="type">Color</span>.clear</span><br><span class="line">                .preference(key: <span class="type">OffsetPreferenceKey</span>.<span class="keyword">self</span>, value: g.frame(in: .named(<span class="string">&quot;frameLayer&quot;</span>)).minY)</span><br><span class="line">        &#125;</span><br><span class="line">        .frame(height:<span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ScrollView</span> &#123;</span><br><span class="line">            offsetReader</span><br><span class="line">            c()</span><br><span class="line">                .padding(.top, <span class="operator">-</span><span class="number">8</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .coordinateSpace(name: <span class="string">&quot;frameLayer&quot;</span>)</span><br><span class="line">        .onPreferenceChange(<span class="type">OffsetPreferenceKey</span>.<span class="keyword">self</span>, perform: whenMoved)</span><br><span class="line">    &#125; <span class="comment">// end body</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">struct</span> <span class="title">OffsetPreferenceKey</span>: <span class="title">PreferenceKey</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">var</span> defaultValue: <span class="type">CGFloat</span> <span class="operator">=</span> .zero</span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">reduce</span>(<span class="params">value</span>: <span class="keyword">inout</span> <span class="type">CGFloat</span>, <span class="params">nextValue</span>: () -&gt; <span class="type">CGFloat</span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="浮层"><a href="#浮层" class="headerlink" title="浮层"></a>浮层</h4><p><img src="https://user-images.githubusercontent.com/251980/156135869-7451bbc9-95b9-445f-8721-66f0aedbed70.png" alt=""></p>
<p>浮层有 HUD、ContextMenu、Sheet、Alert、ConfirmationDialog、Popover、ActionSheet 等几种方式。这些方式实现代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PlaySuperposedLayerView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="meta">@StateObject</span> <span class="keyword">var</span> hudVM <span class="operator">=</span> <span class="type">PHUDVM</span>()</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> isShow <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> isShowAlert <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> isShowConfirmationDialog <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> isShowPopover <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">            <span class="type">List</span> &#123;</span><br><span class="line">                <span class="type">ForEach</span>(<span class="number">0</span><span class="operator">..&lt;</span><span class="number">100</span>) &#123; i <span class="keyword">in</span></span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;<span class="subst">\(i)</span>&quot;</span>)</span><br><span class="line">                        .contextMenu &#123;</span><br><span class="line">                            <span class="comment">// 在 macOS 上右键会出现的菜单</span></span><br><span class="line">                            <span class="type">Button</span> &#123;</span><br><span class="line">                                <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(i)</span> is clicked&quot;</span>)</span><br><span class="line">                            &#125; label: &#123;</span><br><span class="line">                                <span class="type">Text</span>(<span class="string">&quot;Click <span class="subst">\(i)</span>&quot;</span>)</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationTitle(<span class="string">&quot;列表&quot;</span>)</span><br><span class="line">            .toolbar &#123;</span><br><span class="line">                <span class="type">ToolbarItemGroup</span>(placement: .automatic) &#123;</span><br><span class="line">                    <span class="type">Button</span>(<span class="string">&quot;查看 Sheet&quot;</span>) &#123;</span><br><span class="line">                        isShow <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    </span><br><span class="line">                    <span class="type">Button</span>(<span class="string">&quot;查看 Alert&quot;</span>) &#123;</span><br><span class="line">                        isShowAlert <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    </span><br><span class="line">                    <span class="type">Button</span>(<span class="string">&quot;查看 confirmationDialog&quot;</span>, role: .destructive) &#123;</span><br><span class="line">                        isShowConfirmationDialog <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">// Popover 样式默认是弹出窗口置于按钮上方，指向底部。</span></span><br><span class="line">                    <span class="type">Button</span>(<span class="string">&quot;查看 Popover&quot;</span>) &#123;</span><br><span class="line">                        isShowPopover <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    .popover(isPresented: <span class="variable">$isShowPopover</span>, attachmentAnchor: .point(.trailing), arrowEdge: .trailing) &#123;</span><br><span class="line">                        <span class="type">Text</span>(<span class="string">&quot;Popover 的内容&quot;</span>)</span><br><span class="line">                            .padding()</span><br><span class="line">                    &#125;</span><br><span class="line">                    </span><br><span class="line">                &#125; <span class="comment">// end ToolbarItemGroup</span></span><br><span class="line">            &#125; <span class="comment">// end toolbar</span></span><br><span class="line">            .alert(isPresented: <span class="variable">$isShowAlert</span>) &#123;</span><br><span class="line">                <span class="type">Alert</span>(title: <span class="type">Text</span>(<span class="string">&quot;弹框标题&quot;</span>), message: <span class="type">Text</span>(<span class="string">&quot;弹框内容&quot;</span>))</span><br><span class="line">            &#125;</span><br><span class="line">            .sheet(isPresented: <span class="variable">$isShow</span>) &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;dismiss&quot;</span>)</span><br><span class="line">            &#125; content: &#123;</span><br><span class="line">                <span class="type">VStack</span> &#123;</span><br><span class="line">                    <span class="type">Label</span>(<span class="string">&quot;Sheet&quot;</span>, systemImage: <span class="string">&quot;brain.head.profile&quot;</span>)</span><br><span class="line">                    <span class="type">Button</span>(<span class="string">&quot;关闭&quot;</span>) &#123;</span><br><span class="line">                        isShow <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                .padding(<span class="number">20</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            .confirmationDialog(<span class="string">&quot;确定删除？&quot;</span>, isPresented: <span class="variable">$isShowConfirmationDialog</span>, titleVisibility: .hidden) &#123;</span><br><span class="line">                <span class="type">Button</span>(<span class="string">&quot;确定&quot;</span>) &#123;</span><br><span class="line">                    <span class="comment">// do good thing</span></span><br><span class="line">                &#125;</span><br><span class="line">                .keyboardShortcut(.defaultAction) <span class="comment">// 使用 keyboardShortcut 可以设置成为默认选项样式</span></span><br><span class="line">                </span><br><span class="line">                <span class="type">Button</span>(<span class="string">&quot;不不&quot;</span>, role: .cancel) &#123;</span><br><span class="line">                    <span class="comment">// good choice</span></span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">            &#125; message: &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;这个东西还有点重要哦&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">Button</span> &#123;</span><br><span class="line">                hudVM.show(title: <span class="string">&quot;您有一条新的短消息&quot;</span>, systemImage: <span class="string">&quot;ellipsis.bubble&quot;</span>)</span><br><span class="line">            &#125; label: &#123;</span><br><span class="line">                <span class="type">Label</span>(<span class="string">&quot;查看 HUD&quot;</span>, systemImage: <span class="string">&quot;switch.2&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line">        &#125;</span><br><span class="line">        .environmentObject(hudVM)</span><br><span class="line">        .hud(isShow: <span class="variable">$hudVM</span>.isShow) &#123;</span><br><span class="line">            <span class="type">Label</span>(hudVM.title, systemImage: hudVM.systemImage)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - 供全局使用的 HUD</span></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">PHUDVM</span>: <span class="title">ObservableObject</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Published</span> <span class="keyword">var</span> isShow: <span class="type">Bool</span> <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    <span class="keyword">var</span> title: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">var</span> systemImage: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">show</span>(<span class="params">title</span>: <span class="type">String</span>, <span class="params">systemImage</span>: <span class="type">String</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.title <span class="operator">=</span> title</span><br><span class="line">        <span class="keyword">self</span>.systemImage <span class="operator">=</span> systemImage</span><br><span class="line">        withAnimation &#123;</span><br><span class="line">            isShow <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - 扩展 View 使其能够有 HUD 的能力</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">hud</span>&lt;<span class="type">V</span>: <span class="type">View</span>&gt;(</span></span><br><span class="line"><span class="function">        <span class="params">isShow</span>: <span class="type">Binding</span>&lt;<span class="type">Bool</span>&gt;,</span></span><br><span class="line"><span class="function">        <span class="meta">@ViewBuilder</span> <span class="params">v</span>: () -&gt; <span class="type">V</span></span></span><br><span class="line"><span class="function">    )</span> -&gt; <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ZStack</span>(alignment: .top) &#123;</span><br><span class="line">            <span class="keyword">self</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> isShow.wrappedValue <span class="operator">==</span> <span class="literal">true</span> &#123;</span><br><span class="line">                <span class="type">PHUD</span>(v: v)</span><br><span class="line">                    .transition(<span class="type">AnyTransition</span>.move(edge: .top).combined(with: .opacity))</span><br><span class="line">                    .onAppear &#123;</span><br><span class="line">                        <span class="type">DispatchQueue</span>.main.asyncAfter(deadline: .now() <span class="operator">+</span> <span class="number">2</span>) &#123;</span><br><span class="line">                            withAnimation &#123;</span><br><span class="line">                                isShow.wrappedValue <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    .zIndex(<span class="number">1</span>)</span><br><span class="line">                    .padding()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - 自定义 HUD</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PHUD</span>&lt;<span class="title">V</span>: <span class="title">View</span>&gt;: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ViewBuilder</span> <span class="keyword">let</span> v: <span class="type">V</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        v</span><br><span class="line">            .padding()</span><br><span class="line">            .foregroundColor(.black)</span><br><span class="line">            .background(</span><br><span class="line">                <span class="type">Capsule</span>()</span><br><span class="line">                    .foregroundColor(.white)</span><br><span class="line">                    .shadow(color: .black.opacity(<span class="number">0.2</span>), radius: <span class="number">12</span>, x: <span class="number">0</span>, y: <span class="number">5</span>)</span><br><span class="line">            )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="TabView"><a href="#TabView" class="headerlink" title="TabView"></a>TabView</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PlayTabView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> selection <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ZStack</span>(alignment: .bottom) &#123;</span><br><span class="line">            <span class="type">TabView</span>(selection: <span class="variable">$selection</span>) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;one&quot;</span>)</span><br><span class="line">                    .tabItem &#123;</span><br><span class="line">                        <span class="type">Text</span>(<span class="string">&quot;首页&quot;</span>)</span><br><span class="line">                            .hidden()</span><br><span class="line">                    &#125;</span><br><span class="line">                    .tag(<span class="number">0</span>)</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;two&quot;</span>)</span><br><span class="line">                    .tabItem &#123;</span><br><span class="line">                        <span class="type">Text</span>(<span class="string">&quot;二栏&quot;</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                    .tag(<span class="number">1</span>)</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;three&quot;</span>)</span><br><span class="line">                    .tabItem &#123;</span><br><span class="line">                        <span class="type">Text</span>(<span class="string">&quot;三栏&quot;</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                    .tag(<span class="number">2</span>)</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;four&quot;</span>)</span><br><span class="line">                    .tag(<span class="number">3</span>)</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;five&quot;</span>)</span><br><span class="line">                    .tag(<span class="number">4</span>)</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;six&quot;</span>)</span><br><span class="line">                    .tag(<span class="number">5</span>)</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;seven&quot;</span>)</span><br><span class="line">                    .tag(<span class="number">6</span>)</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;eight&quot;</span>)</span><br><span class="line">                    .tag(<span class="number">7</span>)</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;nine&quot;</span>)</span><br><span class="line">                    .tag(<span class="number">8</span>)</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;ten&quot;</span>)</span><br><span class="line">                    .tag(<span class="number">9</span>)</span><br><span class="line">            &#125; <span class="comment">// end TabView</span></span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Button</span>(<span class="string">&quot;上一页&quot;</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> selection <span class="operator">&gt;</span> <span class="number">0</span> &#123;</span><br><span class="line">                        selection <span class="operator">-=</span> <span class="number">1</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                .keyboardShortcut(.cancelAction)</span><br><span class="line">                <span class="type">Button</span>(<span class="string">&quot;下一页&quot;</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> selection <span class="operator">&lt;</span> <span class="number">9</span> &#123;</span><br><span class="line">                        selection <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                .keyboardShortcut(.defaultAction)</span><br><span class="line">            &#125; <span class="comment">// end HStack</span></span><br><span class="line">            .padding()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>.tabViewStyle(PageTabViewStyle(indexDisplayMode: .never)) 可以实现 UIPageViewController 的效果，如果要给小白点加上背景，可以多添加一个 .indexViewStyle(PageIndexViewStyle(backgroundDisplayMode: .always)) 修改器。</p>
<h4 id="Toggle"><a href="#Toggle" class="headerlink" title="Toggle"></a>Toggle</h4><p><img src="https://user-images.githubusercontent.com/251980/156289124-bde3c73e-2a81-4043-8682-ae55a820f1aa.png" alt=""></p>
<p>Toggle 可以设置 toggleStyle，可以自定义样式。使用示例如下</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PlayToggleView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> isEnable <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="comment">// 普通样式</span></span><br><span class="line">        <span class="type">Toggle</span>(isOn: <span class="variable">$isEnable</span>) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;<span class="subst">\(isEnable <span class="operator">?</span> <span class="string">&quot;开了&quot;</span> : <span class="string">&quot;关了&quot;</span>)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 按钮样式</span></span><br><span class="line">        <span class="type">Toggle</span>(isOn: <span class="variable">$isEnable</span>) &#123;</span><br><span class="line">            <span class="type">Label</span>(<span class="string">&quot;<span class="subst">\(isEnable <span class="operator">?</span> <span class="string">&quot;打开了&quot;</span> : <span class="string">&quot;关闭了&quot;</span>)</span>&quot;</span>, systemImage: <span class="string">&quot;cloud.moon&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">        .tint(.pink)</span><br><span class="line">        .controlSize(.large)</span><br><span class="line">        .toggleStyle(.button)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Switch 样式</span></span><br><span class="line">        <span class="type">Toggle</span>(isOn: <span class="variable">$isEnable</span>) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;<span class="subst">\(isEnable <span class="operator">?</span> <span class="string">&quot;开了&quot;</span> : <span class="string">&quot;关了&quot;</span>)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .toggleStyle(<span class="type">SwitchToggleStyle</span>(tint: .orange))</span><br><span class="line">        .padding()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 自定义样式</span></span><br><span class="line">        <span class="type">Toggle</span>(isOn: <span class="variable">$isEnable</span>) &#123;</span><br><span class="line">            <span class="type">Text</span>(isEnable <span class="operator">?</span> <span class="string">&quot;录音中&quot;</span> : <span class="string">&quot;已静音&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .toggleStyle(<span class="type">PCToggleStyle</span>())</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - 自定义样式</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PCToggleStyle</span>: <span class="title">ToggleStyle</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeBody</span>(<span class="params">configuration</span>: <span class="type">Configuration</span>)</span> -&gt; <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">HStack</span> &#123;</span><br><span class="line">            configuration.label</span><br><span class="line">            <span class="type">Image</span>(systemName: configuration.isOn <span class="operator">?</span> <span class="string">&quot;mic.square.fill&quot;</span> : <span class="string">&quot;mic.slash.circle.fill&quot;</span>)</span><br><span class="line">                .renderingMode(.original)</span><br><span class="line">                .resizable()</span><br><span class="line">                .frame(width: <span class="number">30</span>, height: <span class="number">30</span>)</span><br><span class="line">                .onTapGesture &#123;</span><br><span class="line">                    configuration.isOn.toggle()</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Picker"><a href="#Picker" class="headerlink" title="Picker"></a>Picker</h4><p><img src="https://user-images.githubusercontent.com/251980/156298284-2fb37b3e-55f0-4918-ba8e-74f747bf3171.jpeg" alt=""></p>
<p>有 Picker 视图，还有颜色和时间选择的 ColorPicker 和 DatePicker。</p>
<p>示例代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PlayPickerView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> select <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> color <span class="operator">=</span> <span class="type">Color</span>.red.opacity(<span class="number">0.3</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> dateFt: <span class="type">DateFormatter</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> ft <span class="operator">=</span> <span class="type">DateFormatter</span>()</span><br><span class="line">        ft.dateStyle <span class="operator">=</span> .long</span><br><span class="line">        <span class="keyword">return</span> ft</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> date <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 默认是下拉的风格</span></span><br><span class="line">        <span class="type">Form</span> &#123;</span><br><span class="line">            <span class="type">Section</span>(<span class="string">&quot;选区&quot;</span>) &#123;</span><br><span class="line">                <span class="type">Picker</span>(<span class="string">&quot;选一个&quot;</span>, selection: <span class="variable">$select</span>) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">                        .tag(<span class="number">1</span>)</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">                        .tag(<span class="number">2</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Segment 风格，</span></span><br><span class="line">        <span class="type">Picker</span>(<span class="string">&quot;选一个&quot;</span>, selection: <span class="variable">$select</span>) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;one&quot;</span>)</span><br><span class="line">                .tag(<span class="number">1</span>)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;two&quot;</span>)</span><br><span class="line">                .tag(<span class="number">2</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .pickerStyle(<span class="type">SegmentedPickerStyle</span>())</span><br><span class="line">        .padding()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 颜色选择器</span></span><br><span class="line">        <span class="type">ColorPicker</span>(<span class="string">&quot;选一个颜色&quot;</span>, selection: <span class="variable">$color</span>, supportsOpacity: <span class="literal">false</span>)</span><br><span class="line">            .padding()</span><br><span class="line">        </span><br><span class="line">        <span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">8</span>)</span><br><span class="line">            .fill(color)</span><br><span class="line">            .frame(width: <span class="number">50</span>, height: <span class="number">50</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 时间选择器</span></span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">DatePicker</span>(selection: <span class="variable">$date</span>, in: <span class="operator">...</span><span class="type">Date</span>(), displayedComponents: .date) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;选时间&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">DatePicker</span>(<span class="string">&quot;选时间&quot;</span>, selection: <span class="variable">$date</span>)</span><br><span class="line">                .datePickerStyle(<span class="type">GraphicalDatePickerStyle</span>())</span><br><span class="line">                .frame(maxHeight: <span class="number">400</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;时间：<span class="subst">\(date, formatter: dateFt)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Slider"><a href="#Slider" class="headerlink" title="Slider"></a>Slider</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PlaySliderView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> count: <span class="type">Double</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Slider</span>(value: <span class="variable">$count</span>, in: <span class="number">0</span><span class="operator">...</span><span class="number">100</span>)</span><br><span class="line">            .padding()</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;<span class="subst">\(Int(count))</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Stepper"><a href="#Stepper" class="headerlink" title="Stepper"></a>Stepper</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PlayStepperView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> count: <span class="type">Int</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Stepper</span>(value: <span class="variable">$count</span>, step: <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;共<span class="subst">\(count)</span>&quot;</span>)</span><br><span class="line">        &#125; onEditingChanged: &#123; b <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(b)</span><br><span class="line">        &#125; <span class="comment">// end Stepper</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Keyboard"><a href="#Keyboard" class="headerlink" title="Keyboard"></a>Keyboard</h4><p>键盘快捷键的使用方法如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PlayKeyboard</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Button</span>(systemIconName: <span class="string">&quot;camera.shutter.button&quot;</span>) &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;按了回车键&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .keyboardShortcut(.defaultAction) <span class="comment">// 回车</span></span><br><span class="line">        </span><br><span class="line">        <span class="type">Button</span>(<span class="string">&quot;ESC&quot;</span>, action: &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;按了 ESC&quot;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        .keyboardShortcut(.cancelAction) <span class="comment">// ESC 键</span></span><br><span class="line">        </span><br><span class="line">        <span class="type">Button</span>(<span class="string">&quot;CMD + p&quot;</span>) &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;按了 CMD + p&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .keyboardShortcut(<span class="string">&quot;p&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="type">Button</span>(<span class="string">&quot;SHIFT + p&quot;</span>) &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;按了 SHIFT + p&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .keyboardShortcut(<span class="string">&quot;p&quot;</span>, modifiers: [.shift])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="视觉"><a href="#视觉" class="headerlink" title="视觉"></a>视觉</h3><h4 id="Color"><a href="#Color" class="headerlink" title="Color"></a>Color</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PlayColor</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ZStack</span> &#123;</span><br><span class="line">            <span class="type">Color</span>.black.edgesIgnoringSafeArea(.all) <span class="comment">// Color 也是一个 View</span></span><br><span class="line">            </span><br><span class="line">            <span class="type">VStack</span>(spacing: <span class="number">10</span>) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;这是一个适配了暗黑的文字颜色&quot;</span>)</span><br><span class="line">                    .foregroundColor(light: .purple, dark: .pink)</span><br><span class="line">                    .background(<span class="type">Color</span>(nsColor: .quaternaryLabelColor)) <span class="comment">// 使用以前 NSColor</span></span><br><span class="line">                </span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;自定义颜色&quot;</span>)</span><br><span class="line">                    .foregroundColor(<span class="type">Color</span>(red: <span class="number">0</span>, green: <span class="number">0</span>, blue: <span class="number">100</span>))</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - 暗黑适配颜色</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PCColorModifier</span>: <span class="title">ViewModifier</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Environment</span>(\.colorScheme) <span class="keyword">private</span> <span class="keyword">var</span> colorScheme</span><br><span class="line">    <span class="keyword">var</span> light: <span class="type">Color</span></span><br><span class="line">    <span class="keyword">var</span> dark: <span class="type">Color</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> adaptColor: <span class="type">Color</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> colorScheme &#123;</span><br><span class="line">        <span class="keyword">case</span> .light:</span><br><span class="line">            <span class="keyword">return</span> light</span><br><span class="line">        <span class="keyword">case</span> .dark:</span><br><span class="line">            <span class="keyword">return</span> dark</span><br><span class="line">        <span class="keyword">@unknown</span> <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> light</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">body</span>(<span class="params">content</span>: <span class="type">Content</span>)</span> -&gt; <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        content.foregroundColor(adaptColor)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">foregroundColor</span>(<span class="params">light</span>: <span class="type">Color</span>, <span class="params">dark</span>: <span class="type">Color</span>)</span> -&gt; <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        modifier(<span class="type">PCColorModifier</span>(light: light, dark: dark))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Effect"><a href="#Effect" class="headerlink" title="Effect"></a>Effect</h4><p><img src="https://user-images.githubusercontent.com/251980/156332122-66813e4e-851c-4207-8cb9-b41ea0365008.jpeg" alt=""></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PlayEffect</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> isHover <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ZStack</span> &#123;</span><br><span class="line">            <span class="type">LinearGradient</span>(colors: [.purple, .black, .pink], startPoint: .top, endPoint: .bottom).ignoresSafeArea()</span><br><span class="line">            </span><br><span class="line">            <span class="type">VStack</span>(spacing: <span class="number">20</span>) &#123;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 材质</span></span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;材质效果&quot;</span>)</span><br><span class="line">                    .font(.system(size:<span class="number">30</span>))</span><br><span class="line">                    .padding(isHover <span class="operator">?</span> <span class="number">40</span> : <span class="number">30</span>)</span><br><span class="line">                    .background(.regularMaterial, in: <span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">8</span>, style: .continuous))</span><br><span class="line">                    .onHover &#123; b <span class="keyword">in</span></span><br><span class="line">                        withAnimation &#123;</span><br><span class="line">                            isHover <span class="operator">=</span> b</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 模糊</span></span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;模糊效果&quot;</span>)</span><br><span class="line">                    .font(.system(size: <span class="number">30</span>))</span><br><span class="line">                    .padding(<span class="number">30</span>)</span><br><span class="line">                    .background &#123;</span><br><span class="line">                        <span class="type">Color</span>.black.blur(radius: <span class="number">8</span>, opaque: <span class="literal">false</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 选择</span></span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;3D 旋转&quot;</span>)</span><br><span class="line">                    .font(.largeTitle)</span><br><span class="line">                    .rotation3DEffect(<span class="type">Angle</span>(degrees: <span class="number">45</span>), axis: (x: <span class="number">0</span>, y: <span class="number">20</span>, z: <span class="number">0</span>))</span><br><span class="line">                    .scaleEffect(<span class="number">1.5</span>)</span><br><span class="line">                    .blendMode(.hardLight)</span><br><span class="line">                    .blur(radius: <span class="number">3</span>)</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">                </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>材质厚度从低到高有：</p>
<ul>
<li>.regularMaterial</li>
<li>.thinMaterial</li>
<li>.ultraThinMaterial</li>
<li>.thickMaterial</li>
<li>.ultraThickMaterial</li>
</ul>
<h4 id="Animation"><a href="#Animation" class="headerlink" title="Animation"></a>Animation</h4><p>SwiftUI 里实现动画的方式包括有 .animation 隐式动画、withAnimation 和 withTransaction 显示动画、matchedGeometryEffect Hero 动画和 TimelineView 等。</p>
<p>示例代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PlayAnimation</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> isChange <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> anis:[<span class="type">String</span>: <span class="type">Animation</span>] <span class="operator">=</span> [</span><br><span class="line">        <span class="string">&quot;p1&quot;</span>: .default,</span><br><span class="line">        <span class="string">&quot;p2&quot;</span>: .linear(duration: <span class="number">1</span>),</span><br><span class="line">        <span class="string">&quot;p3&quot;</span>: .interpolatingSpring(stiffness: <span class="number">5</span>, damping: <span class="number">3</span>),</span><br><span class="line">        <span class="string">&quot;p4&quot;</span>: .easeInOut(duration: <span class="number">1</span>),</span><br><span class="line">        <span class="string">&quot;p5&quot;</span>: .easeIn(duration: <span class="number">1</span>),</span><br><span class="line">        <span class="string">&quot;p6&quot;</span>: .easeOut(duration: <span class="number">1</span>),</span><br><span class="line">        <span class="string">&quot;p7&quot;</span>: .interactiveSpring(response: <span class="number">3</span>, dampingFraction: <span class="number">2</span>, blendDuration: <span class="number">1</span>),</span><br><span class="line">        <span class="string">&quot;p8&quot;</span>: .spring(),</span><br><span class="line">        <span class="string">&quot;p9&quot;</span>: .default.repeatCount(<span class="number">3</span>)</span><br><span class="line">    ]</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> selection <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="comment">// animation 隐式动画和 withAnimation 显示动画</span></span><br><span class="line">        <span class="type">Text</span>(isChange <span class="operator">?</span> <span class="string">&quot;另一种状态&quot;</span> : <span class="string">&quot;一种状态&quot;</span>)</span><br><span class="line">            .font(.headline)</span><br><span class="line">            .padding()</span><br><span class="line">            .animation(.easeInOut, value: isChange) <span class="comment">// 受限的隐式动画，只绑定某个值。</span></span><br><span class="line">            .onTapGesture &#123;</span><br><span class="line">                <span class="comment">// 使用 withAnimation 就是显式动画，效果等同 withTransaction(Transaction(animation: .default))</span></span><br><span class="line">                withAnimation &#123;</span><br><span class="line">                    isChange.toggle()</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 设置 Transaction。和隐式动画共存时，优先执行 withAnimation 或 Transaction。</span></span><br><span class="line">                <span class="keyword">var</span> t <span class="operator">=</span> <span class="type">Transaction</span>(animation: .linear(duration: <span class="number">2</span>))</span><br><span class="line">                t.disablesAnimations <span class="operator">=</span> <span class="literal">true</span> <span class="comment">// 用来禁用隐式动画</span></span><br><span class="line">                withTransaction(t) &#123;</span><br><span class="line">                    isChange.toggle()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="comment">// end onHover</span></span><br><span class="line">        </span><br><span class="line">        <span class="type">LazyVGrid</span>(columns: [<span class="type">GridItem</span>(.adaptive(minimum: isChange <span class="operator">?</span> <span class="number">60</span> : <span class="number">30</span>), spacing: <span class="number">60</span>)]) &#123;</span><br><span class="line">            <span class="type">ForEach</span>(<span class="type">Array</span>(anis.keys), id: \.<span class="keyword">self</span>) &#123; s <span class="keyword">in</span></span><br><span class="line">                <span class="type">Image</span>(s)</span><br><span class="line">                    .resizable()</span><br><span class="line">                    .scaledToFit()</span><br><span class="line">                    .animation(anis[s], value: isChange)</span><br><span class="line">                    .scaleEffect()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">        <span class="type">Button</span> &#123;</span><br><span class="line">            isChange.toggle()</span><br><span class="line">        &#125; label: &#123;</span><br><span class="line">            <span class="type">Image</span>(systemName: isChange <span class="operator">?</span> <span class="string">&quot;pause.fill&quot;</span> : <span class="string">&quot;play.fill&quot;</span>)</span><br><span class="line">                .renderingMode(.original)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// matchedGeometryEffect 的使用</span></span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;后台&quot;</span>)</span><br><span class="line">                .font(.headline)</span><br><span class="line">            placeStayView</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;前台&quot;</span>)</span><br><span class="line">                .font(.headline)</span><br><span class="line">            placeShowView</span><br><span class="line">        &#125;</span><br><span class="line">        .padding(<span class="number">50</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 通过使用相同 matchedGeometryEffect 的 id，绑定两个元素变化。</span></span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> isChange &#123;</span><br><span class="line">                <span class="type">Rectangle</span>()</span><br><span class="line">                    .fill(.pink)</span><br><span class="line">                    .matchedGeometryEffect(id: <span class="string">&quot;g1&quot;</span>, in: mgeStore)</span><br><span class="line">                    .frame(width: <span class="number">100</span>, height: <span class="number">100</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">            <span class="type">Button</span>(<span class="string">&quot;转换&quot;</span>) &#123;</span><br><span class="line">                withAnimation(.linear(duration: <span class="number">2.0</span>)) &#123;</span><br><span class="line">                    isChange.toggle()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">            <span class="keyword">if</span> <span class="operator">!</span>isChange &#123;</span><br><span class="line">                <span class="type">Circle</span>()</span><br><span class="line">                    .fill(.orange)</span><br><span class="line">                    .matchedGeometryEffect(id: <span class="string">&quot;g1&quot;</span>, in: mgeStore)</span><br><span class="line">                    .frame(width: <span class="number">70</span>, height: <span class="number">70</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Image</span>(<span class="string">&quot;p1&quot;</span>)</span><br><span class="line">                    .resizable()</span><br><span class="line">                    .scaledToFit()</span><br><span class="line">                    .frame(width: <span class="number">50</span>, height: <span class="number">50</span>)</span><br><span class="line">                <span class="keyword">if</span> <span class="operator">!</span>isChange &#123;</span><br><span class="line">                    <span class="type">Image</span>(<span class="string">&quot;p19&quot;</span>)</span><br><span class="line">                        .resizable()</span><br><span class="line">                        .scaledToFit()</span><br><span class="line">                        .frame(width: <span class="number">50</span>, height: <span class="number">50</span>)</span><br><span class="line">                        .matchedGeometryEffect(id: <span class="string">&quot;g1&quot;</span>, in: mgeStore)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">Image</span>(<span class="string">&quot;p1&quot;</span>)</span><br><span class="line">                    .resizable()</span><br><span class="line">                    .scaledToFit()</span><br><span class="line">                    .frame(width: <span class="number">50</span>, height: <span class="number">50</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用 isSource，作为移动到相同 matchedGeometryEffect id 的方法。</span></span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            <span class="type">Image</span>(<span class="string">&quot;p19&quot;</span>)</span><br><span class="line">                .resizable()</span><br><span class="line">                .scaledToFit()</span><br><span class="line">                .frame(width: isChange <span class="operator">?</span> <span class="number">100</span> : <span class="number">50</span>, height: isChange <span class="operator">?</span> <span class="number">100</span> : <span class="number">50</span>)</span><br><span class="line">                .matchedGeometryEffect(id: isChange <span class="operator">?</span> <span class="string">&quot;g2&quot;</span> : <span class="string">&quot;&quot;</span>, in: mgeStore, isSource: <span class="literal">false</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">Image</span>(<span class="string">&quot;p19&quot;</span>)</span><br><span class="line">                .resizable()</span><br><span class="line">                .scaledToFit()</span><br><span class="line">                .frame(width: <span class="number">100</span>, height: <span class="number">100</span>)</span><br><span class="line">                .matchedGeometryEffect(id: <span class="string">&quot;g2&quot;</span>, in: mgeStore)</span><br><span class="line">                .opacity(<span class="number">0</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 点击跟随的效果</span></span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            <span class="type">ForEach</span>(<span class="type">Array</span>(<span class="number">1</span><span class="operator">...</span><span class="number">4</span>), id: \.<span class="keyword">self</span>) &#123; i <span class="keyword">in</span></span><br><span class="line">                <span class="type">Image</span>(<span class="string">&quot;p<span class="subst">\(i)</span>&quot;</span>)</span><br><span class="line">                    .resizable()</span><br><span class="line">                    .scaledToFit()</span><br><span class="line">                    .frame(width: i <span class="operator">==</span> selection <span class="operator">?</span> <span class="number">200</span> : <span class="number">50</span>)</span><br><span class="line">                    .matchedGeometryEffect(id: <span class="string">&quot;h<span class="subst">\(i)</span>&quot;</span>, in: mgeStore)</span><br><span class="line">                    .onTapGesture &#123;</span><br><span class="line">                        withAnimation &#123;</span><br><span class="line">                            selection <span class="operator">=</span> i</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    .shadow(color: .black, radius: <span class="number">3</span>, x: <span class="number">2</span>, y: <span class="number">3</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .background(</span><br><span class="line">            <span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">8</span>).fill(.pink)</span><br><span class="line">                .matchedGeometryEffect(id: <span class="string">&quot;h<span class="subst">\(selection)</span>&quot;</span>, in: mgeStore, isSource: <span class="literal">false</span>)</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// matchedGeometryEffect 还可以应用到 List 中，通过 Array enumerated 获得 index 作为 matchedGeometryEffect 的 id。右侧固定按钮可以直接让对应 id 的视图滚动到固定按钮的位置</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">// TimelineView</span></span><br><span class="line">        <span class="type">TimelineView</span>(.periodic(from: .now, by: <span class="number">1</span>)) &#123; t <span class="keyword">in</span></span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;<span class="subst">\(t.date)</span>&quot;</span>)</span><br><span class="line">            <span class="type">HStack</span>(spacing: <span class="number">20</span>) &#123;</span><br><span class="line">                <span class="keyword">let</span> e <span class="operator">=</span> <span class="string">&quot;p<span class="subst">\(Int.random(in: <span class="number">1</span><span class="operator">...</span><span class="number">30</span>))</span>&quot;</span></span><br><span class="line">                <span class="type">Image</span>(e)</span><br><span class="line">                    .resizable()</span><br><span class="line">                    .scaledToFit()</span><br><span class="line">                    .frame(height: <span class="number">40</span>)</span><br><span class="line">                    .animation(.default.repeatCount(<span class="number">3</span>), value: e)</span><br><span class="line">                </span><br><span class="line">                <span class="type">TimelineSubView</span>(date: t.date) <span class="comment">// 需要传入 timeline 的时间给子视图才能够起作用。</span></span><br><span class="line">                    </span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// matchedGeometryEffect</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/// TimelineScheduler 的使用，TimelineScheduler 有以下类型</span></span><br><span class="line">        <span class="comment">/// .animation：制定更新的频率，可以控制暂停</span></span><br><span class="line">        <span class="comment">/// .everyMinute：每分钟更新一次</span></span><br><span class="line">        <span class="comment">/// .explicit：所有要更新的放到一个数组里</span></span><br><span class="line">        <span class="comment">/// .periodic：设置开始时间和更新频率</span></span><br><span class="line">        <span class="comment">/// 也可以自定义 TimelineScheduler</span></span><br><span class="line">        <span class="type">TimelineView</span>(.everySecond) &#123; t <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">let</span> e <span class="operator">=</span> <span class="string">&quot;p<span class="subst">\(Int.random(in: <span class="number">1</span><span class="operator">...</span><span class="number">30</span>))</span>&quot;</span></span><br><span class="line">            <span class="type">Image</span>(e)</span><br><span class="line">                .resizable()</span><br><span class="line">                .scaledToFit()</span><br><span class="line">                .frame(height: <span class="number">40</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 自定义的 TimelineScheduler</span></span><br><span class="line">        <span class="type">TimelineView</span>(.everyLoop(timeOffsets: [<span class="number">0.2</span>, <span class="number">0.7</span>, <span class="number">1</span>, <span class="number">0.5</span>, <span class="number">2</span>])) &#123; t <span class="keyword">in</span></span><br><span class="line">            <span class="type">TimelineSubView</span>(date: t.date)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - TimelineSubView</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">TimelineSubView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> date : <span class="type">Date</span></span><br><span class="line">        <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> s <span class="operator">=</span> <span class="string">&quot;let&#x27;s go&quot;</span></span><br><span class="line">        <span class="comment">// 顺序从数组中取值，取完再重头开始</span></span><br><span class="line">        <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> idx: <span class="type">Int</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">        <span class="function"><span class="keyword">func</span> <span class="title">advanceIndex</span>(<span class="params">count</span>: <span class="type">Int</span>)</span> &#123;</span><br><span class="line">            idx <span class="operator">=</span> (idx <span class="operator">+</span> <span class="number">1</span>) <span class="operator">%</span> count</span><br><span class="line">            <span class="keyword">if</span> idx <span class="operator">==</span> <span class="number">0</span> &#123; idx <span class="operator">=</span> <span class="number">1</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">            <span class="type">HStack</span>(spacing: <span class="number">20</span>) &#123;</span><br><span class="line">                <span class="type">Image</span>(<span class="string">&quot;p<span class="subst">\(idx)</span>&quot;</span>)</span><br><span class="line">                    .resizable()</span><br><span class="line">                    .scaledToFit()</span><br><span class="line">                    .frame(height: <span class="number">40</span>)</span><br><span class="line">                    .animation(.easeIn(duration: <span class="number">1</span>), value: date)</span><br><span class="line">                    .onChange(of: date) &#123; newValue <span class="keyword">in</span></span><br><span class="line">                        advanceIndex(count: <span class="number">30</span>)</span><br><span class="line">                        s <span class="operator">=</span> <span class="string">&quot;<span class="subst">\(date.hour)</span>:<span class="subst">\(date.minute)</span>:<span class="subst">\(date.second)</span>&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    .onAppear &#123;</span><br><span class="line">                        advanceIndex(count: <span class="number">30</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                    </span><br><span class="line">                <span class="type">Text</span>(s)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - 用 matchedGeometryEffect 做动画</span></span><br><span class="line">    <span class="comment">/// matchedGeometryEffect 可以无缝的将一个图像变成另外一个图像。</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> placeStayItems <span class="operator">=</span> [<span class="string">&quot;p1&quot;</span>, <span class="string">&quot;p2&quot;</span>, <span class="string">&quot;p3&quot;</span>, <span class="string">&quot;p4&quot;</span>]</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> placeShowItems: [<span class="type">String</span>] <span class="operator">=</span> []</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Namespace</span> <span class="keyword">private</span> <span class="keyword">var</span> mgeStore</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> placeStayView: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LazyVGrid</span>(columns: [<span class="type">GridItem</span>(.adaptive(minimum: <span class="number">30</span>), spacing: <span class="number">10</span>)]) &#123;</span><br><span class="line">            <span class="type">ForEach</span>(placeStayItems, id: \.<span class="keyword">self</span>) &#123; s <span class="keyword">in</span></span><br><span class="line">                <span class="type">Image</span>(s)</span><br><span class="line">                    .resizable()</span><br><span class="line">                    .scaledToFit()</span><br><span class="line">                    .matchedGeometryEffect(id: s, in: mgeStore)</span><br><span class="line">                    .onTapGesture &#123;</span><br><span class="line">                        withAnimation &#123;</span><br><span class="line">                            placeStayItems.removeAll &#123; <span class="variable">$0</span> <span class="operator">==</span> s &#125;</span><br><span class="line">                            placeShowItems.append(s)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    .shadow(color: .black, radius: <span class="number">2</span>, x: <span class="number">2</span>, y: <span class="number">4</span>)</span><br><span class="line">            &#125; <span class="comment">// end ForEach</span></span><br><span class="line">        &#125; <span class="comment">// end LazyVGrid</span></span><br><span class="line">    &#125; <span class="comment">// private var placeStayView</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> placeShowView: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LazyVGrid</span>(columns: [<span class="type">GridItem</span>(.adaptive(minimum: <span class="number">150</span>), spacing: <span class="number">10</span>)]) &#123;</span><br><span class="line">            <span class="type">ForEach</span>(placeShowItems, id: \.<span class="keyword">self</span>) &#123; s <span class="keyword">in</span></span><br><span class="line">                <span class="type">Image</span>(s)</span><br><span class="line">                    .resizable()</span><br><span class="line">                    .scaledToFit()</span><br><span class="line">                    .matchedGeometryEffect(id: s, in: mgeStore)</span><br><span class="line">                    .onTapGesture &#123;</span><br><span class="line">                        withAnimation &#123;</span><br><span class="line">                            placeShowItems.removeAll &#123; <span class="variable">$0</span> <span class="operator">==</span> s &#125;</span><br><span class="line">                            placeStayItems.append(s)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    .shadow(color: .black, radius: <span class="number">2</span>, x: <span class="number">0</span>, y: <span class="number">2</span>)</span><br><span class="line">                    .shadow(color: .white, radius: <span class="number">5</span>, x: <span class="number">0</span>, y: <span class="number">2</span>)</span><br><span class="line">            &#125; <span class="comment">// end ForEach</span></span><br><span class="line">        &#125; <span class="comment">// end LazyVGrid</span></span><br><span class="line">    &#125; <span class="comment">// end private var placeShowView</span></span><br><span class="line">    </span><br><span class="line">&#125; <span class="comment">// end struct PlayAnimation</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - 扩展 TimelineSchedule</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">TimelineSchedule</span> <span class="title">where</span> <span class="title">Self</span> == <span class="title">PeriodicTimelineSchedule</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> everySecond: <span class="type">PeriodicTimelineSchedule</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            .<span class="keyword">init</span>(from: .now, by: <span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - 自定义一个 TimelineSchedule</span></span><br><span class="line"><span class="comment">// timeOffsets 用完，就会再重头重新再来一遍</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PCLoopTimelineSchedule</span>: <span class="title">TimelineSchedule</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> timeOffsets: [<span class="type">TimeInterval</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">entries</span>(<span class="params">from</span> <span class="params">startDate</span>: <span class="type">Date</span>, <span class="params">mode</span>: <span class="type">TimelineScheduleMode</span>)</span> -&gt; <span class="type">Entries</span> &#123;</span><br><span class="line">        <span class="type">Entries</span>(last: startDate, offsets: timeOffsets)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Entries</span>: <span class="title">Sequence</span>, <span class="title">IteratorProtocol</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> last: <span class="type">Date</span></span><br><span class="line">        <span class="keyword">let</span> offsets: [<span class="type">TimeInterval</span>]</span><br><span class="line">        <span class="keyword">var</span> idx: <span class="type">Int</span> <span class="operator">=</span> <span class="operator">-</span><span class="number">1</span></span><br><span class="line">        <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">next</span>()</span> -&gt; <span class="type">Date</span>? &#123;</span><br><span class="line">            idx <span class="operator">=</span> (idx <span class="operator">+</span> <span class="number">1</span>) <span class="operator">%</span> offsets.count</span><br><span class="line">            last <span class="operator">=</span> last.addingTimeInterval(offsets[idx])</span><br><span class="line">            <span class="keyword">return</span> last</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="comment">// end Struct Entries</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为自定义的 PCLoopTimelineSchedule 做一个 TimelineSchedule 的扩展函数，方便使用</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">TimelineSchedule</span> <span class="title">where</span> <span class="title">Self</span> == <span class="title">PCLoopTimelineSchedule</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">everyLoop</span>(<span class="params">timeOffsets</span>: [<span class="type">TimeInterval</span>])</span> -&gt; <span class="type">PCLoopTimelineSchedule</span> &#123;</span><br><span class="line">        .<span class="keyword">init</span>(timeOffsets: timeOffsets)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Canvas"><a href="#Canvas" class="headerlink" title="Canvas"></a>Canvas</h4><p>Canvas 可以画路径、图片和文字、Symbols、可变的图形上下文、使用 CoreGraphics 代码和做动画。</p>
<p>图形上下文可以被 addFilter、clip、clipToLayer、concatenate、rotate、scaleBy、translateBy 这些方法来进行改变。</p>
<p>示例代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PlayCanvas</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> colors: [<span class="type">Color</span>] <span class="operator">=</span> [.purple, .blue, .yellow, .pink]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 画路径</span></span><br><span class="line">        <span class="type">PCCanvasPathView</span>(t: .rounded)</span><br><span class="line">        <span class="type">PCCanvasPathView</span>(t: .ellipse)</span><br><span class="line">        <span class="type">PCCanvasPathView</span>(t: .circle)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 图片和文字</span></span><br><span class="line">        <span class="type">PCCanvasImageAndText</span>(text: <span class="string">&quot;Starming&quot;</span>, colors: [.purple, .pink])</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Symbol，在 Canvas 里引用 SwiftUI 视图</span></span><br><span class="line">        <span class="type">Canvas</span> &#123; c, s <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">let</span> c0 <span class="operator">=</span> c.resolveSymbol(id: <span class="number">0</span>)<span class="operator">!</span></span><br><span class="line">            <span class="keyword">let</span> c1 <span class="operator">=</span> c.resolveSymbol(id: <span class="number">1</span>)<span class="operator">!</span></span><br><span class="line">            <span class="keyword">let</span> c2 <span class="operator">=</span> c.resolveSymbol(id: <span class="number">2</span>)<span class="operator">!</span></span><br><span class="line">            <span class="keyword">let</span> c3 <span class="operator">=</span> c.resolveSymbol(id: <span class="number">3</span>)<span class="operator">!</span></span><br><span class="line"></span><br><span class="line">            c.draw(c0, at: .<span class="keyword">init</span>(x: <span class="number">10</span>, y: <span class="number">10</span>), anchor: .topLeading)</span><br><span class="line">            c.draw(c1, at: .<span class="keyword">init</span>(x: <span class="number">30</span>, y: <span class="number">20</span>), anchor: .topLeading)</span><br><span class="line">            c.draw(c2, at: .<span class="keyword">init</span>(x: <span class="number">50</span>, y: <span class="number">30</span>), anchor: .topLeading)</span><br><span class="line">            c.draw(c3, at: .<span class="keyword">init</span>(x: <span class="number">70</span>, y: <span class="number">40</span>), anchor: .topLeading)</span><br><span class="line"></span><br><span class="line">        &#125; symbols: &#123;</span><br><span class="line">            <span class="type">ForEach</span>(<span class="type">Array</span>(colors.enumerated()), id: \.<span class="number">0</span>) &#123; i, c <span class="keyword">in</span></span><br><span class="line">                <span class="type">Circle</span>()</span><br><span class="line">                    .fill(c)</span><br><span class="line">                    .frame(width: <span class="number">100</span>, height: <span class="number">100</span>)</span><br><span class="line">                    .tag(i)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Symbol 动画和 SwiftUI 视图一样，不会受影响</span></span><br><span class="line">        <span class="type">Canvas</span> &#123; c, s <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">let</span> sb <span class="operator">=</span> c.resolveSymbol(id: <span class="number">0</span>)<span class="operator">!</span></span><br><span class="line">            c.draw(sb, at: <span class="type">CGPoint</span>(x: s.width <span class="operator">/</span> <span class="number">2</span>, y: s.height <span class="operator">/</span>  <span class="number">2</span>), anchor: .center)</span><br><span class="line"></span><br><span class="line">        &#125; symbols: &#123;</span><br><span class="line">            <span class="type">PCForSymbolView</span>()</span><br><span class="line">                .tag(<span class="number">0</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="comment">// end var body</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - 给 Symbol 用的视图</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PCForSymbolView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> change <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Image</span>(systemName: <span class="string">&quot;star.fill&quot;</span>)</span><br><span class="line">            .renderingMode(.original)</span><br><span class="line">            .font(.largeTitle)</span><br><span class="line">            .rotationEffect(.degrees(change <span class="operator">?</span> <span class="number">0</span> : <span class="number">72</span>))</span><br><span class="line">            .onAppear &#123;</span><br><span class="line">                withAnimation(.linear(duration: <span class="number">1.0</span>).repeatForever(autoreverses: <span class="literal">false</span>)) &#123;</span><br><span class="line">                    change.toggle()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - 图片和文字</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PCCanvasImageAndText</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> text: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> colors: [<span class="type">Color</span>]</span><br><span class="line">    <span class="keyword">var</span> fontSize: <span class="type">Double</span> <span class="operator">=</span> <span class="number">42</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Canvas</span> &#123; context, size <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">let</span> midPoint <span class="operator">=</span> <span class="type">CGPoint</span>(x: size.width <span class="operator">/</span> <span class="number">2</span>, y: size.height <span class="operator">/</span> <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">let</span> font <span class="operator">=</span> <span class="type">Font</span>.system(size: fontSize)</span><br><span class="line">            <span class="keyword">var</span> resolved <span class="operator">=</span> context.resolve(<span class="type">Text</span>(text).font(font))</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">let</span> start <span class="operator">=</span> <span class="type">CGPoint</span>(x: (size.width <span class="operator">-</span> resolved.measure(in: size).width) <span class="operator">/</span> <span class="number">2.0</span>, y: <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">let</span> end <span class="operator">=</span> <span class="type">CGPoint</span>(x: size.width <span class="operator">-</span> start.x, y: <span class="number">0</span>)</span><br><span class="line">            </span><br><span class="line">            resolved.shading <span class="operator">=</span> .linearGradient(<span class="type">Gradient</span>(colors: colors), startPoint: start, endPoint: end)</span><br><span class="line">            context.draw(resolved, at: midPoint, anchor: .center)</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - Path</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PCCanvasPathView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">PathType</span> </span>&#123;</span><br><span class="line">        <span class="keyword">case</span> rounded, ellipse, casual, circle</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> t: <span class="type">PathType</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Canvas</span> &#123; context, size <span class="keyword">in</span></span><br><span class="line">            </span><br><span class="line">            conf(context: <span class="operator">&amp;</span>context, size: size, type: t)</span><br><span class="line">        &#125; <span class="comment">// end Canvas</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">conf</span>( <span class="params">context</span>: <span class="keyword">inout</span> <span class="type">GraphicsContext</span>, <span class="params">size</span>: <span class="type">CGSize</span>, <span class="params">type</span>: <span class="type">PathType</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> rect <span class="operator">=</span> <span class="type">CGRect</span>(origin: .zero, size: size).insetBy(dx: <span class="number">25</span>, dy: <span class="number">25</span>)</span><br><span class="line">        <span class="keyword">var</span> path <span class="operator">=</span> <span class="type">Path</span>()</span><br><span class="line">        <span class="keyword">switch</span> type &#123;</span><br><span class="line">        <span class="keyword">case</span> .rounded:</span><br><span class="line">            path <span class="operator">=</span> <span class="type">Path</span>(roundedRect: rect, cornerRadius: <span class="number">35.0</span>)</span><br><span class="line">        <span class="keyword">case</span> .ellipse:</span><br><span class="line">            <span class="keyword">let</span> cgPath <span class="operator">=</span> <span class="type">CGPath</span>(ellipseIn: rect, transform: <span class="literal">nil</span>)</span><br><span class="line">            path <span class="operator">=</span> <span class="type">Path</span>(cgPath)</span><br><span class="line">        <span class="keyword">case</span> .casual:</span><br><span class="line">            path <span class="operator">=</span> <span class="type">Path</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> points: [<span class="type">CGPoint</span>] <span class="operator">=</span> [</span><br><span class="line">                    .<span class="keyword">init</span>(x: <span class="number">10</span>, y: <span class="number">10</span>),</span><br><span class="line">                    .<span class="keyword">init</span>(x: <span class="number">0</span>, y: <span class="number">50</span>),</span><br><span class="line">                    .<span class="keyword">init</span>(x: <span class="number">100</span>, y: <span class="number">100</span>),</span><br><span class="line">                    .<span class="keyword">init</span>(x: <span class="number">100</span>, y: <span class="number">0</span>),</span><br><span class="line">                ]</span><br><span class="line">                <span class="variable">$0</span>.move(to: .zero)</span><br><span class="line">                <span class="variable">$0</span>.addLines(points)</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">case</span> .circle:</span><br><span class="line">            path <span class="operator">=</span> <span class="type">Circle</span>().path(in: rect)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> gradient <span class="operator">=</span> <span class="type">Gradient</span>(colors: [.purple, .pink])</span><br><span class="line">        <span class="keyword">let</span> from <span class="operator">=</span> rect.origin</span><br><span class="line">        <span class="keyword">let</span> to <span class="operator">=</span> <span class="type">CGPoint</span>(x: rect.width, y: rect.height <span class="operator">+</span> from.y)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Stroke path</span></span><br><span class="line">        context.stroke(path, with: .color(.blue), lineWidth: <span class="number">25</span>)</span><br><span class="line">        context.fill(path, with: .linearGradient(gradient, startPoint: from, endPoint: to))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="开发者"><a href="#开发者" class="headerlink" title="开发者"></a>开发者</h2><h3 id="Swift官方"><a href="#Swift官方" class="headerlink" title="Swift官方"></a>Swift官方</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/tkremenek">tkremenek</a>：Swift director</li>
<li><a target="_blank" rel="noopener" href="https://github.com/DougGregor">DougGregor</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/mikeash">mikeash</a>：Friday Q&amp;A</li>
</ul>
<h3 id="社区"><a href="#社区" class="headerlink" title="社区"></a>社区</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/onevcat">onevcat</a>：喵神</li>
<li><a target="_blank" rel="noopener" href="https://github.com/DianQK">DianQK</a>：靛青 - SwiftGG翻译组</li>
<li><a target="_blank" rel="noopener" href="https://github.com/kean">kean</a>：Nuke、Pulse</li>
<li><a target="_blank" rel="noopener" href="https://github.com/stephencelis">stephencelis</a>：Point-Free &amp; SQLite.swift</li>
<li><a target="_blank" rel="noopener" href="https://github.com/ibireme">ibireme</a>：YYDS</li>
<li><a target="_blank" rel="noopener" href="https://github.com/mattt">mattt</a>：NSHipster</li>
<li><a target="_blank" rel="noopener" href="https://github.com/ethanhuang13">ethanhuang13</a>：13 - [weak self]播客</li>
<li><a target="_blank" rel="noopener" href="https://github.com/Kyle-Ye">Kyle-Ye</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/ming1016">ming1016</a>：戴铭</li>
<li><a target="_blank" rel="noopener" href="https://github.com/mxcl">mxcl</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/lkzhao">lkzhao</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/insidegui">insidegui</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/johnno1962">johnno1962</a>：InjectionIII</li>
<li><a target="_blank" rel="noopener" href="https://github.com/wigging">wigging</a>：Back to the Mac</li>
<li><a target="_blank" rel="noopener" href="https://github.com/Dimillian">Dimillian</a>：MovieSwiftUI</li>
<li><a target="_blank" rel="noopener" href="https://github.com/krzysztofzablocki">krzysztofzablocki</a>：元编程 Sourcery</li>
<li><a target="_blank" rel="noopener" href="https://github.com/onmyway133">onmyway133</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/pofat">pofat</a>：Pofat - [weak self]播客</li>
<li><a target="_blank" rel="noopener" href="https://github.com/mecid">mecid</a>：Swift with Majid</li>
<li><a target="_blank" rel="noopener" href="https://github.com/hebertialmeida">hebertialmeida</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/kylef">kylef</a>：Commander</li>
<li><a target="_blank" rel="noopener" href="https://github.com/joshaber">joshaber</a>：at GitHub</li>
<li><a target="_blank" rel="noopener" href="https://github.com/ashfurrow">ashfurrow</a>：Moya</li>
<li><a target="_blank" rel="noopener" href="https://github.com/jessesquires">jessesquires</a></li>
</ul>
<h2 id="探索库"><a href="#探索库" class="headerlink" title="探索库"></a>探索库</h2><h3 id="新鲜事"><a href="#新鲜事" class="headerlink" title="新鲜事"></a>新鲜事</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/SwiftOldDriver/iOS-Weekly">SwiftOldDriver/iOS-Weekly</a></em><br>老司机 iOS 周报<br>Star：4115 Issue：11 开发语言：<br>🇨🇳 老司机 iOS 周报</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/matteocrippa/awesome-swift">matteocrippa/awesome-swift</a></em><br>Star：21759 Issue：0 开发语言：Swift<br>A collaborative list of awesome Swift libraries and resources. Feel free to contribute!</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/ruanyf/weekly">ruanyf/weekly</a></em><br>科技爱好者周刊<br>Star：21785 Issue：1758 开发语言：<br>科技爱好者周刊，每周五发布</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/KwaiAppTeam/SwiftPamphletApp">KwaiAppTeam/SwiftPamphletApp</a></em><br>戴铭的开发小册子<br>Star：1545 Issue：150 开发语言：Swift<br>戴铭的开发小册子，一本活的开发手册。使用 SwiftUI + Combine + Swift Concurrency Aysnc/Await Actor + GitHub API 开发的 macOS 应用</p>
<h3 id="封装易用功能"><a href="#封装易用功能" class="headerlink" title="封装易用功能"></a>封装易用功能</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/SwifterSwift/SwifterSwift">SwifterSwift/SwifterSwift</a></em><br>Handy Swift extensions<br>Star：11010 Issue：22 开发语言：Swift<br>A handy collection of more than 500 native Swift extensions to boost your productivity.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/JoanKing/JKSwiftExtension">JoanKing/JKSwiftExtension</a></em><br>Swift常用扩展、组件、协议<br>Star：278 Issue：0 开发语言：Swift<br>Swift常用扩展、组件、协议，方便项目快速搭建，提供完整清晰的Demo示例，不断的完善中…… </p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/infinum/iOS-Nuts-And-Bolts">infinum/iOS-Nuts-And-Bolts</a></em><br>Star：174 Issue：0 开发语言：Swift<br>iOS bits and pieces that you can include in your project to make your life a bit easier.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/gtokman/ExtensionKit">gtokman/ExtensionKit</a></em><br>Star：92 Issue：0 开发语言：Swift<br>Helpful extensions for iOS app development 🚀 </p>
<h3 id="SwiftUI-扩展"><a href="#SwiftUI-扩展" class="headerlink" title="SwiftUI 扩展"></a>SwiftUI 扩展</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/SwiftUIX/SwiftUIX">SwiftUIX/SwiftUIX</a></em><br>扩展 SwiftUI<br>Star：4455 Issue：6 开发语言：Swift<br>Extensions and additions to the standard SwiftUI library.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/SDWebImage/SDWebImageSwiftUI">SDWebImage/SDWebImageSwiftUI</a></em><br>Star：1314 Issue：43 开发语言：Swift<br>SwiftUI Image loading and Animation framework powered by SDWebImage</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/apptekstudios/ASCollectionView">apptekstudios/ASCollectionView</a></em><br>SwiftUI collection<br>Star：1151 Issue：30 开发语言：Swift<br>A SwiftUI collection view with support for custom layouts, preloading, and more.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/siteline/SwiftUI-Introspect">siteline/SwiftUI-Introspect</a></em><br>SwiftUI 引入 UIKit<br>Star：2890 Issue：48 开发语言：Swift<br>Introspect underlying UIKit components from SwiftUI</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/AvdLee/SwiftUIKitView">AvdLee/SwiftUIKitView</a></em><br>在 SwiftUI 中 使用 UIKit<br>Star：498 Issue：3 开发语言：Swift<br>Easily use UIKit views in your SwiftUI applications. Create Xcode Previews for UIView elements</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/danielsaidi/SwiftUIKit">danielsaidi/SwiftUIKit</a></em><br>给 SwiftUI 添加更多功能<br>Star：565 Issue：0 开发语言：Swift<br>SwiftUIKit contains additional functionality for SwiftUI.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Toni77777/awesome-swiftui-libraries">Toni77777/awesome-swiftui-libraries</a></em><br>SwiftUI 可使用的库<br>Star：161 Issue：0 开发语言：Swift<br>:rocket: Awesome SwiftUI Libraries </p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/rakutentech/AltSwiftUI">rakutentech/AltSwiftUI</a></em><br>类 SwiftUI<br>Star：254 Issue：6 开发语言：Swift<br>Open Source UI framework based on SwiftUI syntax and features, adding backwards compatibility.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/gymshark/ios-stack-kit">gymshark/ios-stack-kit</a></em><br>类 SwiftUI<br>Star：114 Issue：1 开发语言：Swift<br>The power of SwiftUI with UIKit</p>
<h3 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/onevcat/Kingfisher">onevcat/Kingfisher</a></em><br>Star：19940 Issue：73 开发语言：Swift<br>A lightweight, pure-Swift library for downloading and caching images from the web.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/kean/Nuke">kean/Nuke</a></em><br>Star：6557 Issue：9 开发语言：Swift<br>Image loading system</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/suzuki-0000/SKPhotoBrowser">suzuki-0000/SKPhotoBrowser</a></em><br>图片浏览<br>Star：2325 Issue：90 开发语言：Swift<br>Simple PhotoBrowser/Viewer inspired by facebook, twitter photo browsers written by swift</p>
<h3 id="文字处理"><a href="#文字处理" class="headerlink" title="文字处理"></a>文字处理</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/gonzalezreal/MarkdownUI">gonzalezreal/MarkdownUI</a></em><br>Star：680 Issue：6 开发语言：Swift<br>Render Markdown text in SwiftUI</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/tophat/RichTextView">tophat/RichTextView</a></em><br>Star：1059 Issue：27 开发语言：Swift<br>iOS Text View (UIView) that Properly Displays LaTeX, HTML, Markdown, and YouTube/Vimeo Links</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/keitaoouchi/MarkdownView">keitaoouchi/MarkdownView</a></em><br>Star：1752 Issue：28 开发语言：Swift<br>Markdown View for iOS.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/johnxnguyen/Down">johnxnguyen/Down</a></em><br>fast Markdown<br>Star：1934 Issue：17 开发语言：C<br>Blazing fast Markdown / CommonMark rendering in Swift, built upon cmark.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/qeude/SwiftDown">qeude/SwiftDown</a></em><br>Swift 写的可换主题的 Markdown 编辑器组件<br>Star：81 Issue：0 开发语言：Swift<br>📦 A themable markdown editor component for your SwiftUI apps.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/JohnSundell/Ink">JohnSundell/Ink</a></em><br>Markdown 解析器<br>Star：2090 Issue：23 开发语言：Swift<br>A fast and flexible Markdown parser written in Swift.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/tnantoka/edhita">tnantoka/edhita</a></em><br>Star：1186 Issue：16 开发语言：Swift<br>Fully open source text editor for iOS written in Swift.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/glushchenko/fsnotes">glushchenko/fsnotes</a></em><br>Star：4799 Issue：230 开发语言：Swift<br>Notes manager for macOS/iOS</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/coteditor/CotEditor">coteditor/CotEditor</a></em><br>Star：4336 Issue：118 开发语言：Swift<br>Lightweight Plain-Text Editor for macOS</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/mchakravarty/CodeEditorView">mchakravarty/CodeEditorView</a></em><br>SwiftUI 写的代码编辑器<br>Star：366 Issue：30 开发语言：Swift<br>SwiftUI code editor view for iOS and macOS</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/CodeEditApp/CodeEdit">CodeEditApp/CodeEdit</a></em><br>原生，性能好的代码编辑器<br>Star：0 Issue：0 开发语言：</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/ZeeZide/CodeEditor">ZeeZide/CodeEditor</a></em><br>使用 Highlight.js 的来做语法高亮的 SwiftUI 编辑器<br>Star：0 Issue：0 开发语言：</p>
<h3 id="动画-1"><a href="#动画-1" class="headerlink" title="动画"></a>动画</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/recherst/kavsoft-swiftui-animations">recherst/kavsoft-swiftui-animations</a></em><br>Star：107 Issue：0 开发语言：Swift<br>SwiftUI animation tutorials, all of demos are consisted of youtube videos at website of kavsoft. 🔗 <a target="_blank" rel="noopener" href="https://kavsoft.dev">https://kavsoft.dev</a></p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/timdonnelly/Advance">timdonnelly/Advance</a></em><br>Physics-based animations<br>Star：4448 Issue：4 开发语言：Swift<br>Physics-based animations for iOS, tvOS, and macOS.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/MengTo/Spring">MengTo/Spring</a></em><br>动画<br>Star：13978 Issue：167 开发语言：Swift<br>A library to simplify iOS animations in Swift.</p>
<h3 id="持久化存储"><a href="#持久化存储" class="headerlink" title="持久化存储"></a>持久化存储</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/stephencelis/SQLite.swift">stephencelis/SQLite.swift</a></em><br>Star：8144 Issue：87 开发语言：Swift<br>A type-safe, Swift-language layer over SQLite3.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/groue/GRDB.swift">groue/GRDB.swift</a></em><br>Star：4932 Issue：3 开发语言：Swift<br>A toolkit for SQLite databases, with a focus on application development</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/caiyue1993/IceCream">caiyue1993/IceCream</a></em><br>CloudKit 同步 Realm 数据库<br>Star：1689 Issue：47 开发语言：Swift<br>Sync Realm Database with CloudKit</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/realm/realm-cocoa">realm/realm-cocoa</a></em><br>Star：14980 Issue：361 开发语言：Objective-C<br>Realm is a mobile database: a replacement for Core Data &amp; SQLite</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/PostgresApp/PostgresApp">PostgresApp/PostgresApp</a></em><br>PostgreSQL macOS 应用<br>Star：6239 Issue：121 开发语言：Makefile<br>The easiest way to get started with PostgreSQL on the Mac</p>
<h3 id="编程范式"><a href="#编程范式" class="headerlink" title="编程范式"></a>编程范式</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/ReactiveX/RxSwift">ReactiveX/RxSwift</a></em><br>函数响应式编程<br>Star：21990 Issue：16 开发语言：Swift<br>Reactive Programming in Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/pointfreeco/swift-composable-architecture">pointfreeco/swift-composable-architecture</a></em><br>Star：5790 Issue：13 开发语言：Swift<br>A library for building applications in a consistent and understandable way, with composition, testing, and ergonomics in mind.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/onmyway133/awesome-ios-architecture">onmyway133/awesome-ios-architecture</a></em><br>Star：4547 Issue：0 开发语言：<br>:japanese_castle: Better ways to structure iOS apps</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/ReSwift/ReSwift">ReSwift/ReSwift</a></em><br>单页面状态和数据管理<br>Star：7147 Issue：38 开发语言：Swift<br>Unidirectional Data Flow in Swift - Inspired by Redux</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/gre4ixin/ReduxUI">gre4ixin/ReduxUI</a></em><br>SwiftUI Redux 架构<br>Star：27 Issue：0 开发语言：Swift<br>💎 Redux like architecture for SwiftUI</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/BohdanOrlov/iOS-Developer-Roadmap">BohdanOrlov/iOS-Developer-Roadmap</a></em><br>Star：5670 Issue：7 开发语言：Swift<br>Roadmap to becoming an iOS developer in 2018.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/ReactiveCocoa/ReactiveCocoa">ReactiveCocoa/ReactiveCocoa</a></em><br>Star：19987 Issue：3 开发语言：Swift<br>Cocoa framework and Obj-C dynamism bindings for ReactiveSwift.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/mehdihadeli/awesome-software-architecture">mehdihadeli/awesome-software-architecture</a></em><br>软件架构<br>Star：7415 Issue：2 开发语言：<br>A curated list of awesome articles, videos, and other resources to learn and practice about software architecture, patterns, and principles.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/nalexn/clean-architecture-swiftui">nalexn/clean-architecture-swiftui</a></em><br>干净完整的SwiftUI+Combine例子，包含网络和单元测试等<br>Star：3275 Issue：17 开发语言：Swift<br>SwiftUI sample app using Clean Architecture. Examples of working with CoreData persistence, networking, dependency injection, unit testing, and more.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/krzysztofzablocki/Sourcery">krzysztofzablocki/Sourcery</a></em><br>Swift 元编程<br>Star：6434 Issue：52 开发语言：Swift<br>Meta-programming for Swift, stop writing boilerplate code.</p>
<h3 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/pointfreeco/swiftui-navigation">pointfreeco/swiftui-navigation</a></em><br>Star：775 Issue：1 开发语言：Swift<br>Tools for making SwiftUI navigation simpler, more ergonomic and more precise.</p>
<h3 id="静态检查"><a href="#静态检查" class="headerlink" title="静态检查"></a>静态检查</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/realm/SwiftLint">realm/SwiftLint</a></em><br>Star：15867 Issue：300 开发语言：Swift<br>A tool to enforce Swift style and conventions.</p>
<h3 id="系统能力"><a href="#系统能力" class="headerlink" title="系统能力"></a>系统能力</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/devicekit/DeviceKit">devicekit/DeviceKit</a></em><br>UIDevice 易用封装<br>Star：3628 Issue：43 开发语言：Swift<br>DeviceKit is a value-type replacement of UIDevice.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/kishikawakatsumi/KeychainAccess">kishikawakatsumi/KeychainAccess</a></em><br>Star：6791 Issue：38 开发语言：Swift<br>Simple Swift wrapper for Keychain that works on iOS, watchOS, tvOS and macOS.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/nvzqz/FileKit">nvzqz/FileKit</a></em><br>文件操作<br>Star：2203 Issue：11 开发语言：Swift<br>Simple and expressive file management in Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/JohnSundell/Files">JohnSundell/Files</a></em><br>文件操作<br>Star：2255 Issue：23 开发语言：Swift<br>A nicer way to handle files &amp; folders in Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/kylef/PathKit">kylef/PathKit</a></em><br>文件操作<br>Star：1333 Issue：12 开发语言：Swift<br>Effortless path operations in Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/rushisangani/BiometricAuthentication">rushisangani/BiometricAuthentication</a></em><br>FaceID or TouchID authentication<br>Star：787 Issue：13 开发语言：Swift<br>Use Apple FaceID or TouchID authentication in your app using BiometricAuthentication.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/sunshinejr/SwiftyUserDefaults">sunshinejr/SwiftyUserDefaults</a></em><br>Star：4626 Issue：46 开发语言：Swift<br>Modern Swift API for NSUserDefaults</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/MonitorControl/MonitorControl">MonitorControl/MonitorControl</a></em><br>亮度和声音控制<br>Star：14730 Issue：49 开发语言：Swift<br>🖥 Control your display’s brightness &amp; volume on your Mac as if it was a native Apple Display. Use Apple Keyboard keys or custom shortcuts. Shows the native macOS OSDs.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/carekit-apple/CareKit">carekit-apple/CareKit</a></em><br>使用 SwiftUI 开发健康相关的库<br>Star：2177 Issue：66 开发语言：Swift<br>CareKit is an open source software framework for creating apps that help people better understand and manage their health.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Cay-Zhang/SwiftSpeech">Cay-Zhang/SwiftSpeech</a></em><br>苹果语言识别封装库，已适配 SwiftUI<br>Star：258 Issue：2 开发语言：Swift<br>A speech recognition framework designed for SwiftUI.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/malcommac/SwiftDate">malcommac/SwiftDate</a></em><br>Swift编写的时间时区，时间比较等复杂处理的包装<br>Star：6815 Issue：67 开发语言：Swift<br>🐔 Toolkit to parse, validate, manipulate, compare and display dates, time &amp; timezones in Swift.</p>
<h3 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/OAuthSwift/OAuthSwift">OAuthSwift/OAuthSwift</a></em><br>Star：2979 Issue：39 开发语言：Swift<br>Swift based OAuth library for iOS</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/p2/OAuth2">p2/OAuth2</a></em><br>Star：1057 Issue：68 开发语言：Swift<br>OAuth2 framework for macOS and iOS, written in Swift.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/public-apis/public-apis">public-apis/public-apis</a></em><br>Star：186561 Issue：1 开发语言：Python<br>A collective list of free APIs</p>
<h3 id="接口应用"><a href="#接口应用" class="headerlink" title="接口应用"></a>接口应用</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/bpisano/Weather">bpisano/Weather</a></em><br>天气应用<br>Star：275 Issue：2 开发语言：Swift<br>A Weather app in SwiftUI.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Dimillian/MovieSwiftUI">Dimillian/MovieSwiftUI</a></em><br>电影 MovieDB 应用<br>Star：5950 Issue：8 开发语言：Swift<br>SwiftUI &amp; Combine app using MovieDB API. With a custom Flux (Redux) implementation.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/chojnac/NotionSwift">chojnac/NotionSwift</a></em><br>Star：22 Issue：3 开发语言：Swift<br>Unofficial Notion API SDK for iOS &amp; macOS</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Dimillian/RedditOS">Dimillian/RedditOS</a></em><br>SwiftUI 写的 Reddit客户端<br>Star：3538 Issue：11 开发语言：Swift<br>The product name is Curiosity, a SwiftUI Reddit client for macOS Big Sur</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/carson-katri/reddit-swiftui">carson-katri/reddit-swiftui</a></em><br>SwiftUI 写的 Reddit客户端<br>Star：1105 Issue：7 开发语言：Swift<br>A cross-platform Reddit client built in SwiftUI</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Dimillian/SwiftHN">Dimillian/SwiftHN</a></em><br>Hacker News 阅读<br>Star：1689 Issue：20 开发语言：Swift<br>A Hacker News reader in Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/tatsuz0u/EhPanda">tatsuz0u/EhPanda</a></em><br>Star：1132 Issue：11 开发语言：Swift<br>An unofficial E-Hentai App for iOS built with SwiftUI &amp; TCA.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Dimillian/MortyUI">Dimillian/MortyUI</a></em><br>GraphQL + SwiftUI 开发的瑞克和莫蒂应用<br>Star：424 Issue：4 开发语言：Swift<br>A very simple Rick &amp; Morty app to demo GraphQL + SwiftUI</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Finb/V2ex-Swift">Finb/V2ex-Swift</a></em><br>V2EX 客户端<br>Star：1505 Issue：10 开发语言：Swift<br>An iOS client written in Swift for V2EX</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/v2er-app/iOS">v2er-app/iOS</a></em><br>V2EX 客户端<br>Star：194 Issue：4 开发语言：Swift<br>The source of V2er.iOS</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/sinaweibosdk/weibo_ios_sdk">sinaweibosdk/weibo_ios_sdk</a></em><br>Star：1423 Issue：63 开发语言：Objective-C<br>新浪微博 IOS SDK</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/miniLV/MNWeibo">miniLV/MNWeibo</a></em><br>Swift5 + MVVM 微博客户端<br>Star：244 Issue：4 开发语言：Swift<br>Swift5 + MVVM + 文艺复兴微博(纯代码 + 纯Swift)，可作为第一个上手的Swift项目.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/nerdishbynature/octokit.swift">nerdishbynature/octokit.swift</a></em><br>Swift API Client for GitHub<br>Star：391 Issue：9 开发语言：Swift<br>A Swift API Client for GitHub and GitHub Enterprise</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/GitHawkApp/GitHawk">GitHawkApp/GitHawk</a></em><br>iOS app for GitHub<br>Star：2822 Issue：455 开发语言：Swift<br>The (second) best iOS app for GitHub.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/fangzesheng/free-api">fangzesheng/free-api</a></em><br>Star：11998 Issue：26 开发语言：<br>收集免费的接口服务,做一个api的搬运工</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/nerdsupremacist/Graphaello">nerdsupremacist/Graphaello</a></em><br>SwiftUI 中使用 GraphQL 的工具<br>Star：436 Issue：21 开发语言：Swift<br>A Tool for Writing Declarative, Type-Safe and Data-Driven Applications in SwiftUI using GraphQL</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/nerdsupremacist/tmdb">nerdsupremacist/tmdb</a></em><br>GraphQL 包装电影数据接口<br>Star：14 Issue：1 开发语言：Swift<br>A GraphQL Wrapper for The Movie Database</p>
<h3 id="macOS-1"><a href="#macOS-1" class="headerlink" title="macOS"></a>macOS</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/serhii-londar/open-source-mac-os-apps">serhii-londar/open-source-mac-os-apps</a></em><br>开源 macOS 程序合集<br>Star：29820 Issue：52 开发语言：Swift<br>🚀 Awesome list of open source applications for macOS. <a target="_blank" rel="noopener" href="https://t.me/s/opensourcemacosapps">https://t.me/s/opensourcemacosapps</a></p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Ranchero-Software/NetNewsWire">Ranchero-Software/NetNewsWire</a></em><br>Star：5374 Issue：535 开发语言：Swift<br>RSS reader for macOS and iOS.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/overtake/TelegramSwift">overtake/TelegramSwift</a></em><br>Star：3729 Issue：452 开发语言：Swift<br>Source code of Telegram for macos on Swift 5.0</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/eonist/FileWatcher">eonist/FileWatcher</a></em><br>macOS 上监听文件变化<br>Star：157 Issue：5 开发语言：Swift<br>Monitoring file system changes in macOS</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/waylybaye/XcodeCleaner-SwiftUI">waylybaye/XcodeCleaner-SwiftUI</a></em><br>清理 Xcode<br>Star：1178 Issue：3 开发语言：Swift<br>Make Xcode Clean Again</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/gao-sun/eul">gao-sun/eul</a></em><br>SwiftUI 写的 macOS 状态监控工具<br>Star：7123 Issue：51 开发语言：Swift<br>🖥️ macOS status monitoring app written in SwiftUI.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Dimillian/ACHNBrowserUI">Dimillian/ACHNBrowserUI</a></em><br>SwiftUI 写的动物之森小助手程序<br>Star：1507 Issue：32 开发语言：Swift<br>Animal Crossing New Horizon companion app in SwiftUI</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/lexrus/RegExPlus">lexrus/RegExPlus</a></em><br>正则表达式<br>Star：185 Issue：0 开发语言：Swift<br>A nifty RegEx test tool built with SwiftUI</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/v2ex/launcher">v2ex/launcher</a></em><br>用来启动那些本地开发时需要的各种进程，及查看其输出<br>Star：167 Issue：3 开发语言：Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/lukakerr/Pine">lukakerr/Pine</a></em><br>Markdown 编辑器<br>Star：2910 Issue：45 开发语言：Swift<br>A modern, native macOS markdown editor</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/root3nl/SupportApp">root3nl/SupportApp</a></em><br>企业支持 macOS 软件<br>Star：242 Issue：17 开发语言：Swift<br>The Support App is developed by Root3, specialized in managing Apple devices. Root3 offers consultancy and support for organizations to get the most out of their Apple devices and is based in The Netherlands (Haarlem).</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/jaywcjlove/awesome-mac">jaywcjlove/awesome-mac</a></em><br>macOS 软件大全<br>Star：48349 Issue：126 开发语言：JavaScript<br> Now we have become very big, Different from the original idea. Collect premium software in various categories.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/insidegui/WWDC">insidegui/WWDC</a></em><br>Star：8163 Issue：33 开发语言：Swift<br>The unofficial WWDC app for macOS</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/sindresorhus/Actions">sindresorhus/Actions</a></em><br>Star：682 Issue：4 开发语言：Swift<br>⚙️ Supercharge your shortcuts</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/ObuchiYuki/DevToysMac">ObuchiYuki/DevToysMac</a></em><br>开发者工具合集<br>Star：5065 Issue：33 开发语言：Swift<br>DevToys For mac</p>
<h3 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/vinhnx/Clendar">vinhnx/Clendar</a></em><br>SwiftUI 写的日历应用<br>Star：328 Issue：52 开发语言：Swift<br>Clendar - universal calendar app. Written in SwiftUI. Available on App Store. MIT License.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/SvenTiigi/WhatsNewKit">SvenTiigi/WhatsNewKit</a></em><br>欢迎屏<br>Star：2464 Issue：0 开发语言：Swift<br>Showcase your awesome new app features 📱</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/kickstarter/ios-oss">kickstarter/ios-oss</a></em><br>Kickstarter 的 iOS 版本<br>Star：7923 Issue：1 开发语言：Swift<br>Kickstarter for iOS. Bring new ideas to life, anywhere.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/CoreOffice/CryptoOffice">CoreOffice/CryptoOffice</a></em><br>Swift 解析 Office Open XML（OOXML）包括 xlsx, docx, pptx<br>Star：21 Issue：0 开发语言：Swift<br>Office Open XML (OOXML) formats (.xlsx, .docx, .pptx) decryption for Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/CoreOffice/CoreXLSX">CoreOffice/CoreXLSX</a></em><br>Swift编写的Excel电子表格（XLSX）格式解析器<br>Star：619 Issue：11 开发语言：Swift<br>Excel spreadsheet (XLSX) format parser written in pure Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/analogcode/Swift-Radio-Pro">analogcode/Swift-Radio-Pro</a></em><br>电台应用<br>Star：2663 Issue：13 开发语言：Swift<br>Professional Radio Station App for iOS!</p>
<h3 id="游戏"><a href="#游戏" class="headerlink" title="游戏"></a>游戏</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/pointfreeco/isowords">pointfreeco/isowords</a></em><br>单词搜索游戏<br>Star：1674 Issue：4 开发语言：Swift<br>Open source game built in SwiftUI and the Composable Architecture.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/michelpereira/awesome-games-of-coding">michelpereira/awesome-games-of-coding</a></em><br>教你学编程的游戏收集<br>Star：1395 Issue：1 开发语言：<br>A curated list of games that can teach you how to learn a programming language.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/OpenEmu/OpenEmu">OpenEmu/OpenEmu</a></em><br>视频游戏模拟器<br>Star：13679 Issue：193 开发语言：Swift<br>🕹 Retro video game emulation for macOS</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/jVirus/swiftui-2048">jVirus/swiftui-2048</a></em><br>Star：141 Issue：0 开发语言：Swift<br>🎲 100% SwiftUI 3.0, classic 2048 game [iOS 15.0+, iPadOS 15.0+, macOS 12.0+, Swift 5.5].</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/schellingb/dosbox-pure">schellingb/dosbox-pure</a></em><br>DOS 游戏模拟器<br>Star：420 Issue：114 开发语言：C++<br>DOSBox Pure is a new fork of DOSBox built for RetroArch/Libretro aiming for simplicity and ease of use.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/chrismaltby/gb-studio">chrismaltby/gb-studio</a></em><br>拖放式复古游戏创建器<br>Star：5981 Issue：484 开发语言：C<br>A quick and easy to use drag and drop retro game creator for your favourite handheld video game system</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/darrellroot/Netrek-SwiftUI">darrellroot/Netrek-SwiftUI</a></em><br>SwiftUI 开发的1989年的 Netrek 游戏<br>Star：10 Issue：0 开发语言：Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/jynew/jynew">jynew/jynew</a></em><br>Unity 引擎重制 DOS 金庸群侠传<br>Star：4382 Issue：30 开发语言：C#<br>金庸群侠传3D重制版</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/CleverRaven/Cataclysm-DDA">CleverRaven/Cataclysm-DDA</a></em><br>以世界末日为背景的生存游戏<br>Star：6672 Issue：2667 开发语言：C++<br>Cataclysm - Dark Days Ahead. A turn-based survival game set in a post-apocalyptic world.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/freeCodeCamp/LearnToCodeRPG">freeCodeCamp/LearnToCodeRPG</a></em><br>学习编码的游戏<br>Star：784 Issue：11 开发语言：Ren’Py<br>A visual novel video game where you learn to code and get a dev job 🎯</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/pmgl/microstudio">pmgl/microstudio</a></em><br>游戏开发平台集搜索、开发、学习、体验、交流等功能于一身<br>Star：500 Issue：32 开发语言：JavaScript<br>Free, open source game engine online</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/diasurgical/devilutionX">diasurgical/devilutionX</a></em><br>可以运行在 macOS 上的 Diablo 1<br>Star：5191 Issue：342 开发语言：C++<br>Diablo build for modern operating systems</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/InvadingOctopus/octopuskit">InvadingOctopus/octopuskit</a></em><br>2D游戏引擎，用的 GameplayKit + SpriteKit + SwiftUI<br>Star：302 Issue：0 开发语言：Swift<br>2D ECS game engine in 100% Swift + SwiftUI for iOS, macOS, tvOS</p>
<h3 id="新技术展示"><a href="#新技术展示" class="headerlink" title="新技术展示"></a>新技术展示</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/JakeLin/Moments-SwiftUI">JakeLin/Moments-SwiftUI</a></em><br>SwiftUI、Async、Actor<br>Star：37 Issue：0 开发语言：Swift<br>WeChat-like Moments App implemented using Swift 5.5 and SwiftUI</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/twostraws/HackingWithSwift">twostraws/HackingWithSwift</a></em><br>示例代码<br>Star：4345 Issue：11 开发语言：Swift<br>The project source code for hackingwithswift.com</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/carson-katri/awesome-result-builders">carson-katri/awesome-result-builders</a></em><br>Result Builders awesome<br>Star：754 Issue：1 开发语言：<br>A list of cool DSLs made with Swift 5.4’s @resultBuilder</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/pointfreeco/episode-code-samples">pointfreeco/episode-code-samples</a></em><br>Star：655 Issue：2 开发语言：Swift<br>💾 Point-Free episode code.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/SwiftGGTeam/the-swift-programming-language-in-chinese">SwiftGGTeam/the-swift-programming-language-in-chinese</a></em><br>中文版 Apple 官方 Swift 教程<br>Star：20436 Issue：4 开发语言：CSS<br>中文版 Apple 官方 Swift 教程《The Swift Programming Language》</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/jessesquires/TIL">jessesquires/TIL</a></em><br>学习笔记<br>Star：252 Issue：0 开发语言：<br>Things I’ve learned and/or things I want to remember. Notes, links, advice, example code, etc.</p>
<h3 id="Combine-扩展"><a href="#Combine-扩展" class="headerlink" title="Combine 扩展"></a>Combine 扩展</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/OpenCombine/OpenCombine">OpenCombine/OpenCombine</a></em><br>Combine 的开源实现<br>Star：2122 Issue：11 开发语言：Swift<br>Open source implementation of Apple’s Combine framework for processing values over time.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/CombineCommunity/CombineExt">CombineCommunity/CombineExt</a></em><br>对 Combine 的补充<br>Star：1089 Issue：22 开发语言：Swift<br>CombineExt provides a collection of operators, publishers and utilities for Combine, that are not provided by Apple themselves, but are common in other Reactive Frameworks and standards.</p>
<h3 id="聚合"><a href="#聚合" class="headerlink" title="聚合"></a>聚合</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/dkhamsing/open-source-ios-apps">dkhamsing/open-source-ios-apps</a></em><br>开源的完整 App 例子<br>Star：29703 Issue：0 开发语言：Swift<br>:iphone: Collaborative List of Open-Source iOS Apps</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/timqian/chinese-independent-blogs">timqian/chinese-independent-blogs</a></em><br>Star：8655 Issue：18 开发语言：JavaScript<br>中文独立博客列表</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/vlondon/awesome-swiftui">vlondon/awesome-swiftui</a></em><br>Star：1184 Issue：5 开发语言：<br>A collaborative list of awesome articles, talks, books, videos and code examples about SwiftUI.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/ivanvorobei/SwiftUI">ivanvorobei/SwiftUI</a></em><br>Star：3726 Issue：5 开发语言：Swift<br>Examples projects using SwiftUI released by WWDC2019. Include Layout, UI, Animations, Gestures, Draw and Data.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/kon9chunkit/GitHub-Chinese-Top-Charts">kon9chunkit/GitHub-Chinese-Top-Charts</a></em><br>GitHub中文排行榜<br>Star：45272 Issue：83 开发语言：Java<br>:cn: GitHub中文排行榜，各语言分设「软件 | 资料」榜单，精准定位中文好项目。各取所需，高效学习。</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/onmyway133/awesome-swiftui">onmyway133/awesome-swiftui</a></em><br>Star：361 Issue：3 开发语言：<br>🌮 Awesome resources, articles, libraries about SwiftUI</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Juanpe/About-SwiftUI">Juanpe/About-SwiftUI</a></em><br>汇总 SwiftUI 的资料<br>Star：6096 Issue：0 开发语言：Swift<br>Gathering all info published, both by Apple and by others, about new framework SwiftUI. </p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/sindresorhus/awesome">sindresorhus/awesome</a></em><br>内容广<br>Star：194524 Issue：42 开发语言：<br>😎 Awesome lists about all kinds of interesting topics</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/SwiftPackageIndex/PackageList">SwiftPackageIndex/PackageList</a></em><br>Swift 开源库索引<br>Star：605 Issue：1 开发语言：Swift<br>The master list of repositories for the Swift Package Index.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/matteocrippa/awesome-swift">matteocrippa/awesome-swift</a></em><br>Star：21759 Issue：0 开发语言：Swift<br>A collaborative list of awesome Swift libraries and resources. Feel free to contribute!</p>
<h3 id="性能、工程构建及自动化"><a href="#性能、工程构建及自动化" class="headerlink" title="性能、工程构建及自动化"></a>性能、工程构建及自动化</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/tuist/tuist">tuist/tuist</a></em><br>创建和维护 Xcode projects 文件<br>Star：2474 Issue：148 开发语言：Swift<br>🚀 Create, maintain, and interact with Xcode projects at scale</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/swift-server/vscode-swift">swift-server/vscode-swift</a></em><br>VSCode 的 Swift 扩展<br>Star：262 Issue：30 开发语言：TypeScript<br>Visual Studio Code Extension for Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/peripheryapp/periphery">peripheryapp/periphery</a></em><br>检测 Swift 无用代码<br>Star：3231 Issue：24 开发语言：Swift<br>A tool to identify unused code in Swift projects.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/nalexn/ViewInspector">nalexn/ViewInspector</a></em><br>SwiftUI Runtime introspection 和 单元测试<br>Star：1115 Issue：17 开发语言：Swift<br>Runtime introspection and unit testing of SwiftUI views</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/shibapm/Komondor">shibapm/Komondor</a></em><br>Git Hooks for Swift projects<br>Star：503 Issue：20 开发语言：Swift<br>Git Hooks for Swift projects 🐩</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/SwiftGen/SwiftGen">SwiftGen/SwiftGen</a></em><br>代码生成<br>Star：7781 Issue：75 开发语言：Swift<br>The Swift code generator for your assets, storyboards, Localizable.strings, … — Get rid of all String-based APIs!</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/hyperoslo/Cache">hyperoslo/Cache</a></em><br>Star：2541 Issue：20 开发语言：Swift<br>:package: Nothing but Cache.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/kylef/Commander">kylef/Commander</a></em><br>命令行<br>Star：1482 Issue：4 开发语言：Swift<br>Compose beautiful command line interfaces in Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Carthage/Carthage">Carthage/Carthage</a></em><br>Star：14546 Issue：232 开发语言：Swift<br>A simple, decentralized dependency manager for Cocoa</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/NARKOZ/hacker-scripts">NARKOZ/hacker-scripts</a></em><br>程序员的活都让机器干的脚本（真实故事）<br>Star：43582 Issue：66 开发语言：JavaScript<br>Based on a true story</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/RobotsAndPencils/XcodesApp">RobotsAndPencils/XcodesApp</a></em><br>Xcode 多版本安装<br>Star：2589 Issue：39 开发语言：Swift<br>The easiest way to install and switch between multiple versions of Xcode - with a mouse click. </p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/ZeeZide/5GUIs">ZeeZide/5GUIs</a></em><br>可以分析程序用了哪些库，用了LLVM objdump<br>Star：180 Issue：8 开发语言：Swift<br>A tiny macOS app that can detect the GUI technologies used in other apps.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/faisalmemon/ios-crash-dump-analysis-book">faisalmemon/ios-crash-dump-analysis-book</a></em><br>iOS Crash Dump Analysis Book<br>Star：461 Issue：1 开发语言：Objective-C<br>iOS Crash Dump Analysis Book</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/majd/ipatool">majd/ipatool</a></em><br>下载 ipa<br>Star：1897 Issue：4 开发语言：Swift<br>Command-line tool that allows searching and downloading app packages (known as ipa files) from the iOS App Store</p>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/Quick/Quick">Quick/Quick</a></em><br>测试框架<br>Star：9375 Issue：54 开发语言：Swift<br>The Swift (and Objective-C) testing framework.</p>
<h3 id="网络-1"><a href="#网络-1" class="headerlink" title="网络"></a>网络</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/Alamofire/Alamofire">Alamofire/Alamofire</a></em><br>Star：37285 Issue：33 开发语言：Swift<br>Elegant HTTP Networking in Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/socketio/socket.io-client-swift">socketio/socket.io-client-swift</a></em><br>Star：4740 Issue：184 开发语言：Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Lojii/Knot">Lojii/Knot</a></em><br>使用 SwiftNIO 实现 HTTPS 抓包<br>Star：1169 Issue：3 开发语言：C<br>一款iOS端基于MITM(中间人攻击技术)实现的HTTPS抓包工具，完整的App，核心代码使用SwiftNIO实现</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/swift-server/async-http-client">swift-server/async-http-client</a></em><br>使用 SwiftNIO 开发的 HTTP 客户端<br>Star：569 Issue：79 开发语言：Swift<br>HTTP client library built on SwiftNIO</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/kean/Get">kean/Get</a></em><br>Star：344 Issue：4 开发语言：Swift<br>Web API client built using async/await</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/awesome-selfhosted/awesome-selfhosted">awesome-selfhosted/awesome-selfhosted</a></em><br>网络服务及上面的应用<br>Star：81497 Issue：173 开发语言：JavaScript<br>A list of Free Software network services and web applications which can be hosted on your own servers</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/daltoniam/Starscream">daltoniam/Starscream</a></em><br>WebSocket<br>Star：7249 Issue：144 开发语言：Swift<br>Websockets in swift for iOS and OSX</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/shadowsocks/ShadowsocksX-NG">shadowsocks/ShadowsocksX-NG</a></em><br>Star：30240 Issue：252 开发语言：Swift<br>Next Generation of ShadowsocksX</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/carson-katri/swift-request">carson-katri/swift-request</a></em><br>声明式的网络请求<br>Star：627 Issue：6 开发语言：Swift<br>Declarative HTTP networking, designed for SwiftUI</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/cloudreve/Cloudreve">cloudreve/Cloudreve</a></em><br>云存储部署<br>Star：13529 Issue：337 开发语言：Go<br>🌩支持多家云存储的云盘系统 (Self-hosted file management and sharing system, supports multiple storage providers)</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/alibaba/xquic">alibaba/xquic</a></em><br>阿里巴巴发布的 XQUIC 库<br>Star：987 Issue：8 开发语言：C<br>XQUIC Library released by Alibaba is a cross-platform implementation of QUIC and HTTP/3 protocol.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/kasketis/netfox">kasketis/netfox</a></em><br>获取所有网络请求<br>Star：3227 Issue：14 开发语言：Swift<br>A lightweight, one line setup, iOS / OSX network debugging library! 🦊</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Moya/Moya">Moya/Moya</a></em><br>Swift 编写的网络抽象层<br>Star：13842 Issue：119 开发语言：Swift<br>Network abstraction layer written in Swift.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Kitura/BlueSocket">Kitura/BlueSocket</a></em><br>Star：1296 Issue：28 开发语言：Swift<br>Socket framework for Swift using the Swift Package Manager. Works on iOS, macOS, and Linux.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/rhummelmose/BluetoothKit">rhummelmose/BluetoothKit</a></em><br>蓝牙<br>Star：2063 Issue：33 开发语言：Swift<br>Easily communicate between iOS/OSX devices using BLE</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/WeTransfer/Mocker">WeTransfer/Mocker</a></em><br>Mock Alamofire and URLSession<br>Star：770 Issue：1 开发语言：Swift<br>Mock Alamofire and URLSession requests without touching your code implementation</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/bagder/everything-curl">bagder/everything-curl</a></em><br>记录了 curl 的一切<br>Star：1410 Issue：2 开发语言：Perl<br>The book documenting the curl project, the curl tool, libcurl and more. Simply put: everything curl.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/LANDrop/LANDrop">LANDrop/LANDrop</a></em><br>全平台局域网文件传输<br>Star：2370 Issue：75 开发语言：C++<br>Drop any files to any devices on your LAN.</p>
<h3 id="图形"><a href="#图形" class="headerlink" title="图形"></a>图形</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/willdale/SwiftUICharts">willdale/SwiftUICharts</a></em><br>用于SwiftUI的图表绘图库<br>Star：445 Issue：28 开发语言：Swift<br>A charts / plotting library for SwiftUI. Works on macOS, iOS, watchOS, and tvOS and has accessibility features built in.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/lludo/SwiftSunburstDiagram">lludo/SwiftSunburstDiagram</a></em><br>SwiftUI 图表<br>Star：464 Issue：12 开发语言：Swift<br>SwiftUI library to easily render diagrams given a tree of objects. Similar to ring chart, sunburst chart, multilevel pie chart.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/ivanschuetz/SwiftCharts">ivanschuetz/SwiftCharts</a></em><br>Star：2363 Issue：48 开发语言：Swift<br>Easy to use and highly customizable charts library for iOS</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/danielgindi/Charts">danielgindi/Charts</a></em><br>Star：25114 Issue：818 开发语言：Swift<br>Beautiful charts for iOS/tvOS/OSX! The Apple side of the crossplatform MPAndroidChart.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/imxieyi/waifu2x-ios">imxieyi/waifu2x-ios</a></em><br>waifu2x Core ML 动漫风格图片的高清渲染<br>Star：415 Issue：1 开发语言：Swift<br>iOS Core ML implementation of waifu2x</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/mecid/SwiftUICharts">mecid/SwiftUICharts</a></em><br>支持 SwiftUI 的简单的线图和柱状图库<br>Star：1201 Issue：2 开发语言：Swift<br>A simple line and bar charting library that supports accessibility written using SwiftUI. </p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Tencent/libpag">Tencent/libpag</a></em><br>PAG（Portable Animated Graphics）实时渲染库，多个平台渲染AE动画。<br>Star：1543 Issue：2 开发语言：C++<br>The official rendering library for PAG (Portable Animated Graphics) files that renders After Effects animations natively across multiple platforms.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/jathu/UIImageColors">jathu/UIImageColors</a></em><br>获取图片主次颜色<br>Star：3068 Issue：10 开发语言：Swift<br>Fetches the most dominant and prominent colors from an image.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/BradLarson/GPUImage3">BradLarson/GPUImage3</a></em><br>Metal 实现<br>Star：2327 Issue：73 开发语言：Swift<br>GPUImage 3 is a BSD-licensed Swift framework for GPU-accelerated video and image processing using Metal.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/exyte/Macaw">exyte/Macaw</a></em><br>SVG<br>Star：5810 Issue：126 开发语言：Swift<br>Powerful and easy-to-use vector graphics Swift library with SVG support</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/exyte/SVGView">exyte/SVGView</a></em><br>支持 SwiftUI 的 SVG 解析渲染视图<br>Star：141 Issue：2 开发语言：Swift<br>SVG parser and renderer written in SwiftUI</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/efremidze/Magnetic">efremidze/Magnetic</a></em><br>SpriteKit气泡支持SwiftUI<br>Star：1359 Issue：23 开发语言：Swift<br>SpriteKit Floating Bubble Picker (inspired by Apple Music) 🧲</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/NextLevel/NextLevel">NextLevel/NextLevel</a></em><br>相机<br>Star：1970 Issue：70 开发语言：Swift<br>⬆️ Rad Media Capture in Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Harley-xk/MaLiang">Harley-xk/MaLiang</a></em><br>基于 Metal 的涂鸦绘图库<br>Star：1242 Issue：40 开发语言：Swift<br>iOS painting and drawing library based on Metal. 神笔马良有一支神笔（基于 Metal 的涂鸦绘图库）</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/frzi/Model3DView">frzi/Model3DView</a></em><br>毫不费力的使用 SwiftUI 渲染 3d models<br>Star：27 Issue：0 开发语言：Swift<br>Render 3d models with SwiftUI effortlessly</p>
<h3 id="音视频"><a href="#音视频" class="headerlink" title="音视频"></a>音视频</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/iina/iina">iina/iina</a></em><br>Star：29520 Issue：1319 开发语言：Swift<br>The modern video player for macOS.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/shogo4405/HaishinKit.swift">shogo4405/HaishinKit.swift</a></em><br>RTMP, HLS<br>Star：2279 Issue：12 开发语言：Swift<br>Camera and Microphone streaming library via RTMP, HLS for iOS, macOS, tvOS.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/AudioKit/AudioKit">AudioKit/AudioKit</a></em><br>Star：9028 Issue：13 开发语言：Swift<br>Swift audio synthesis, processing, &amp; analysis platform for iOS, macOS and tvOS</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/josejuanqm/VersaPlayer">josejuanqm/VersaPlayer</a></em><br>Star：685 Issue：4 开发语言：Swift<br>Versatile Video Player implementation for iOS, macOS, and tvOS</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/bilibili/ijkplayer">bilibili/ijkplayer</a></em><br>bilibili 播放器<br>Star：30123 Issue：2720 开发语言：C<br>Android/iOS video player based on FFmpeg n3.4, with MediaCodec, VideoToolbox support.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/mpv-player/mpv">mpv-player/mpv</a></em><br>命令行视频播放器<br>Star：18145 Issue：800 开发语言：C<br>🎥 Command line video player</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/analogcode/Swift-Radio-Pro">analogcode/Swift-Radio-Pro</a></em><br>广播电台<br>Star：2663 Issue：13 开发语言：Swift<br>Professional Radio Station App for iOS!</p>
<h3 id="安全-1"><a href="#安全-1" class="headerlink" title="安全"></a>安全</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/krzyzanowskim/CryptoSwift">krzyzanowskim/CryptoSwift</a></em><br>Star：8966 Issue：40 开发语言：Swift<br>CryptoSwift is a growing collection of standard and secure cryptographic algorithms implemented in Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/rockbruno/SwiftInfo">rockbruno/SwiftInfo</a></em><br>提取和分析一个iOS应用<br>Star：1068 Issue：17 开发语言：Swift<br>📊 Extract and analyze the evolution of an iOS app’s code.</p>
<h3 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/Kitura/swift-html-entities">Kitura/swift-html-entities</a></em><br>HTML5 规范字符编码/解码器<br>Star：138 Issue：5 开发语言：Swift<br>HTML5 spec-compliant character encoder/decoder for Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/TokamakUI/Tokamak">TokamakUI/Tokamak</a></em><br>SwiftUI 兼容，WebAssembly 构建 HTML<br>Star：1587 Issue：98 开发语言：Swift<br>SwiftUI-compatible framework for building browser apps with WebAssembly and native apps for other platforms</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/johnsundell/publish">johnsundell/publish</a></em><br>用 swift 来写网站<br>Star：3851 Issue：28 开发语言：Swift<br>A static site generator for Swift developers</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/highlightjs/highlight.js">highlightjs/highlight.js</a></em><br>语法高亮<br>Star：19693 Issue：53 开发语言：JavaScript<br>JavaScript syntax highlighter with language auto-detection and zero dependencies.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/sivan/heti">sivan/heti</a></em><br>赫蹏（hètí）中文排版<br>Star：4391 Issue：17 开发语言：SCSS<br>赫蹏（hètí）是专为中文内容展示设计的排版样式增强。它基于通行的中文排版规范而来，可以为网站的读者带来更好的文章阅读体验。</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/kevquirk/simple.css">kevquirk/simple.css</a></em><br>简单大方基础 CSS 样式<br>Star：2053 Issue：2 开发语言：CSS<br>Simple.css is a classless CSS template that allows you to make a good looking website really quickly.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/mozilla-mobile/firefox-ios">mozilla-mobile/firefox-ios</a></em><br>Star：10772 Issue：1002 开发语言：Swift<br>Firefox for iOS</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/liviuschera/noctis">liviuschera/noctis</a></em><br>好看的代码编辑器配色主题<br>Star：0 Issue：0 开发语言：</p>
<h3 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/vapor/vapor">vapor/vapor</a></em><br>Star：21499 Issue：93 开发语言：Swift<br>💧 A server-side Swift HTTP web framework.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Lakr233/Rayon">Lakr233/Rayon</a></em><br>SSH 机器管理，Swift 编写<br>Star：1884 Issue：18 开发语言：Swift<br>yet another SSH machine manager</p>
<h3 id="系统"><a href="#系统" class="headerlink" title="系统"></a>系统</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/spevans/swift-project1">spevans/swift-project1</a></em><br>Swift编写内核，可在 Mac 和 PC 启动<br>Star：239 Issue：1 开发语言：Swift<br>A minimal bare metal kernel in Swift</p>
<h3 id="Web-3-0"><a href="#Web-3-0" class="headerlink" title="Web 3.0"></a>Web 3.0</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/chaozh/awesome-blockchain-cn">chaozh/awesome-blockchain-cn</a></em><br>区块链 awesome<br>Star：16249 Issue：14 开发语言：JavaScript<br>收集所有区块链(BlockChain)技术开发相关资料，包括Fabric和Ethereum开发资料</p>
<h3 id="Apple"><a href="#Apple" class="headerlink" title="Apple"></a>Apple</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/apple/swift">apple/swift</a></em><br>Star：59091 Issue：527 开发语言：C++<br>The Swift Programming Language</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution">apple/swift-evolution</a></em><br>提案<br>Star：13171 Issue：38 开发语言：Markdown<br>This maintains proposals for changes and user-visible enhancements to the Swift Programming Language.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/apple/swift-corelibs-foundation">apple/swift-corelibs-foundation</a></em><br>Star：4554 Issue：37 开发语言：Swift<br>The Foundation Project, providing core utilities, internationalization, and OS independence</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/apple/swift-package-manager">apple/swift-package-manager</a></em><br>Star：8705 Issue：31 开发语言：Swift<br>The Package Manager for the Swift Programming Language</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/apple/swift-markdown">apple/swift-markdown</a></em><br>Star：1682 Issue：6 开发语言：Swift<br>A Swift package for parsing, building, editing, and analyzing Markdown documents.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/apple/sourcekit-lsp">apple/sourcekit-lsp</a></em><br>Star：2520 Issue：6 开发语言：Swift<br>Language Server Protocol implementation for Swift and C-based languages</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/apple/swift-nio">apple/swift-nio</a></em><br>Star：6901 Issue：152 开发语言：Swift<br>Event-driven network application framework for high performance protocol servers &amp; clients, non-blocking.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/apple/swift-syntax">apple/swift-syntax</a></em><br>解析、生成、转换 Swift 代码<br>Star：1783 Issue：3 开发语言：Swift<br>SwiftPM package for SwiftSyntax library.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/apple/swift-crypto">apple/swift-crypto</a></em><br>CryptoKit 的开源实现<br>Star：1182 Issue：10 开发语言：C<br>Open-source implementation of a substantial portion of the API of Apple CryptoKit suitable for use on Linux platforms.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/apple/swift-driver">apple/swift-driver</a></em><br>用 Swift 语言重新实现的编译器的驱动程序库<br>Star：612 Issue：14 开发语言：Swift<br>Swift compiler driver reimplementation in Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/apple/swift-numerics">apple/swift-numerics</a></em><br>用简单的方式用浮点型进行数值计算<br>Star：1362 Issue：45 开发语言：Swift<br>Advanced mathematical types and functions for Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/apple/swift-atomics">apple/swift-atomics</a></em><br>Swift 的低级原子操作<br>Star：727 Issue：11 开发语言：Swift<br>Low-level atomic operations for Swift</p>
<h3 id="计算机科学"><a href="#计算机科学" class="headerlink" title="计算机科学"></a>计算机科学</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/raywenderlich/swift-algorithm-club">raywenderlich/swift-algorithm-club</a></em><br>Star：26101 Issue：51 开发语言：Swift<br>Algorithms and data structures in Swift, with explanations!</p>
<h3 id="扩展知识"><a href="#扩展知识" class="headerlink" title="扩展知识"></a>扩展知识</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/trimstray/the-book-of-secret-knowledge">trimstray/the-book-of-secret-knowledge</a></em><br>Star：63110 Issue：10 开发语言：<br>A collection of inspiring lists, manuals, cheatsheets, blogs, hacks, one-liners, cli/web tools and more.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/rossant/awesome-math">rossant/awesome-math</a></em><br>Star：5782 Issue：6 开发语言：Python<br>A curated list of awesome mathematics resources</p>
<h3 id="待分类"><a href="#待分类" class="headerlink" title="待分类"></a>待分类</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/krzysztofzablocki/KZFileWatchers">krzysztofzablocki/KZFileWatchers</a></em><br>Swift编写的观察本地或者网络上，比如网盘和FTP的文件变化<br>Star：1011 Issue：2 开发语言：Swift<br>A micro-framework for observing file changes, both local and remote. Helpful in building developer tools.</p>
<h2 id="博客和资讯"><a href="#博客和资讯" class="headerlink" title="博客和资讯"></a>博客和资讯</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.swift.org/">Swift.org</a>：Swift 官方博客</li>
<li><a target="_blank" rel="noopener" href="https://github.com/SwiftOldDriver/iOS-Weekly/releases">Release notes from iOS-Weekly</a>：老司机 iOS 周报</li>
<li><a target="_blank" rel="noopener" href="https://zhangferry.com/">iOS摸鱼周报</a>：iOS 摸鱼周报</li>
<li><a target="_blank" rel="noopener" href="https://mjtsai.com/blog">Michael Tsai</a>：一名 macOS 开发者的博客</li>
<li><a target="_blank" rel="noopener" href="https://sspai.com/">少数派</a>：少数派致力于更好地运用数字产品或科学方法，帮助用户提升工作效率和生活品质</li>
<li><a target="_blank" rel="noopener" href="https://onevcat.com">OneV’s Den</a>：上善若水，人淡如菊。这里是王巍 (onevcat) 的博客，用来记录一些技术和想法，主要专注于 Swift 和 iOS 开发。</li>
<li><a target="_blank" rel="noopener" href="https://www.avanderlee.com">SwiftLee</a>：A weekly blog about Swift, iOS and Xcode Tips and Tricks</li>
<li><a target="_blank" rel="noopener" href="https://swiftwithmajid.com">Swift with Majid</a>：Majid’s blog about Swift development</li>
<li><a target="_blank" rel="noopener" href="https://www.fatbobman.com">肘子的Swift记事本</a></li>
<li><a href="https://ming1016.github.io">戴铭的博客 - 星光社</a>：一个人走得快，一群人走的远</li>
<li><a target="_blank" rel="noopener" href="https://www.swiftbysundell.com">Swift by Sundell</a>：Weekly Swift articles, podcasts and tips by John Sundell</li>
<li><a target="_blank" rel="noopener" href="https://www.fivestars.blog">FIVE STARS</a>：Exploring iOS, SwiftUI &amp; much more.</li>
<li><a target="_blank" rel="noopener" href="http://weekly.swiftwithmajid.com/">SwiftUI Weekly</a>：The curated collection of links about SwiftUI. Delivered every Monday.</li>
<li><a target="_blank" rel="noopener" href="https://www.getrevue.co/profile/peterfriese">Not Only Swift Weekly</a>：Xcode tips &amp; tricks, Swift, SwiftUI, Combine, Firebase, computing and internet history, and - of course - some fun stuff.</li>
<li><a target="_blank" rel="noopener" href="https://swiftlyrush.curated.co/issues">SwiftlyRush Weekly</a>：SwiftlyRush Weekly is a weekly curated publication full of interesting, relevant links, alongside industry news and updates. Subscribe now and never miss an issue.</li>
<li><a target="_blank" rel="noopener" href="https://iosdevweekly.com/issues">iOS Dev Weekly</a>：Subscribe to a hand-picked round-up of the best iOS development links every week. Curated by Dave Verwer and published every Friday. Free.</li>
<li><a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/">阮一峰的网络日志</a>：Ruan YiFeng’s Blog 科技爱好者周刊</li>
<li><a target="_blank" rel="noopener" href="https://theswiftdev.com">The.Swift.Dev.</a>：Weekly Swift articles</li>
<li><a target="_blank" rel="noopener" href="https://www.ifanr.com">爱范儿</a>：让未来触手可及</li>
<li><a target="_blank" rel="noopener" href="https://www.gcores.com">机核</a>：不止是游戏</li>
</ul>
<h2 id="小册子动态"><a href="#小册子动态" class="headerlink" title="小册子动态"></a>小册子动态</h2><p>欢迎你的内容分享和留言，请发到 <a target="_blank" rel="noopener" href="https://github.com/KwaiAppTeam/SwiftPamphletApp/issues">议题里</a>，也欢迎你的 PR :) 。</p>
<ul>
<li>22.02.10 发布<a target="_blank" rel="noopener" href="https://github.com/KwaiAppTeam/SwiftPamphletApp/releases/tag/4.1">4.1</a>：完善内容，补齐基础语法</li>
<li>22.02.08 发布<a target="_blank" rel="noopener" href="https://github.com/KwaiAppTeam/SwiftPamphletApp/releases/tag/4.0">4.0</a>：视觉更新。更新了小册子的icon。排版用了赫蹏（hètí），字体是霞鹜文楷，更新了代码高亮风格。</li>
<li>22.01.24 发布<a target="_blank" rel="noopener" href="https://github.com/KwaiAppTeam/SwiftPamphletApp/releases/tag/3.1">3.1</a>：可不设置 Github access token，生成 dmg</li>
<li>22.01.03 发布2.0：新动态支持提醒，包括博客RSS、开发者、好库和探索库</li>
<li>21.11.16 发布1.0：Swift 指南语法速查完成</li>
</ul>

    </article>
    <!-- license -->
    
        <div class="license-wrapper">
            <p>原文作者：<a href="http://ming1016.github.io">戴铭</a>
            <p>原文链接：<a href="http://ming1016.github.io/2021/11/23/daiming-swift-pamphlet/">http://ming1016.github.io/2021/11/23/daiming-swift-pamphlet/</a>
            <p>发表日期：<a href="http://ming1016.github.io/2021/11/23/daiming-swift-pamphlet/">November 23rd 2021, 4:28:18 pm</a>
            <p>更新日期：<a href="http://ming1016.github.io/2021/11/23/daiming-swift-pamphlet/">March 24th 2022, 4:46:40 pm</a>
            <p>版权声明：本文采用<a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc/4.0/">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p>
        </div>
    
    <!-- paginator -->
    <ul class="post-paginator">
        <li class="next">
            
                <div class="nextSlogan">Next Post</div>
                <a href="/2022/01/03/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/" title="如何用 SwiftUI + Combine + Swift Concurrency Aysnc/Await Actor 欢畅开发">
                    <div class="nextTitle">如何用 SwiftUI + Combine + Swift Concurrency Aysnc/Await Actor 欢畅开发</div>
                </a>
            
        </li>
        <li class="previous">
            
                <div class="prevSlogan">Previous Post</div>
                <a href="/2021/07/24/my-little-idea-about-writing-technical-article/" title="我写技术文章的一点心得">
                    <div class="prevTitle">我写技术文章的一点心得</div>
                </a>
            
        </li>
    </ul>
    <!-- comment -->
    
        <div class="post-comment">
            <!-- 来必力 City 版安装代码 -->


            

            

            

            <!-- utteranc评论 -->


            <!-- partial('_partial/comment/changyan') -->
            <!--PC版-->


            
            

        </div>
    
    <!-- timeliness note -->
    <!-- idea from: https://hexo.fluid-dev.com/posts/hexo-injector/#%E6%96%87%E7%AB%A0%E6%97%B6%E6%95%88%E6%80%A7%E6%8F%90%E7%A4%BA -->
    
    <!-- Mathjax -->
    
</main>

                <!-- profile -->
                
            </div>
            <footer class="footer footer-unloaded">
    <!-- social  -->
    
        <div class="social">
            
    
        
            
                <a href="mailto:ming1016@foxmail.com" class="iconfont-archer email" title=email ></a>
            
        
    
        
            
                <a href="//github.com/ming1016" class="iconfont-archer github" target="_blank" title=github></a>
            
        
    
        
            
                <span class="iconfont-archer wechat" title=wechat>
                    
                    <img class="profile-qr" src="/assets/wechat-qcode.jpeg" />
                </span>
            
        
    
        
    
        
    
        
            
                <a href="https://weibo.com/allstarming" class="iconfont-archer weibo" target="_blank" title=weibo></a>
            
        
    
        
    
        
    
        
    
        
            
                <a href="https://twitter.com/daiming_cn" class="iconfont-archer twitter" target="_blank" title=twitter></a>
            
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            
                <a href="/atom.xml" class="iconfont-archer rss" target="_blank" title=rss></a>
            
        
    


        </div>
    
    <!-- powered by Hexo  -->
    <div class="copyright">
        <span id="hexo-power">Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></span><span class="iconfont-archer power">&#xe635;</span><span id="theme-info">theme <a href="https://github.com/fi3ework/hexo-theme-archer" target="_blank">Archer</a></span>
    </div>
    <!-- website approve for Chinese user -->
    
        <div class="website-approve">
            
                <span id="icp-approve" class="icp-approve">
                    <a href="https://beian.miit.gov.cn/" target="_blank">鄂ICP备17011999号</a>
                </span>
            
            
                
                <img class="beian-img" src="/assets/beian.png" />
                <span id="beian-approve" class="beian-approve">
                    <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=7011999" target="_blank">京公网安备 7011999号</a>
                </span>
            
        </div>
    
    <!-- 不蒜子  -->
    
        <div class="busuanzi-container">
            
             
                <span id="busuanzi_container_site_pv">PV: <span id="busuanzi_value_site_pv"></span> :)</span>
            
        </div>
    	
</footer>

        </div>
        <!-- toc -->
        
            <div class="toc-wrapper toc-wrapper-loding" style=







    top:50vh;

>
                <div class="toc-catalog">
                    <span class="iconfont-archer catalog-icon">&#xe613;</span><span>CATALOG</span>
                </div>
                <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E8%AF%B4%E6%98%8E"><span class="toc-number">1.</span> <span class="toc-text">背景说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95%E9%80%9F%E6%9F%A5"><span class="toc-number">2.</span> <span class="toc-text">语法速查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80"><span class="toc-number">2.1.</span> <span class="toc-text">基础</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%98%E9%87%8F-let-var"><span class="toc-number">2.1.1.</span> <span class="toc-text">变量 let, var</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%93%E5%8D%B0-print-%E2%80%9C%E2%80%9D"><span class="toc-number">2.1.2.</span> <span class="toc-text">打印 print(“”)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E9%87%8A"><span class="toc-number">2.1.3.</span> <span class="toc-text">注释 &#x2F;&#x2F;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%AF%E9%80%89"><span class="toc-number">2.1.4.</span> <span class="toc-text">可选 ?, !</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AD%E5%8C%85"><span class="toc-number">2.1.5.</span> <span class="toc-text">闭包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0-func"><span class="toc-number">2.1.6.</span> <span class="toc-text">函数 func</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="toc-number">2.1.7.</span> <span class="toc-text">访问控制</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.2.</span> <span class="toc-text">基础类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E5%AD%97-Int-Float"><span class="toc-number">2.2.1.</span> <span class="toc-text">数字 Int, Float</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E6%95%B0-Bool"><span class="toc-number">2.2.2.</span> <span class="toc-text">布尔数 Bool</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%83%E7%BB%84-a-b-c"><span class="toc-number">2.2.3.</span> <span class="toc-text">元组 (a, b, c)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">2.2.4.</span> <span class="toc-text">字符串</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%9A%E4%B8%BE"><span class="toc-number">2.2.5.</span> <span class="toc-text">枚举</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%9B%E5%9E%8B"><span class="toc-number">2.2.6.</span> <span class="toc-text">泛型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8D%E9%80%8F%E6%98%8E%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.2.7.</span> <span class="toc-text">不透明类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Result"><span class="toc-number">2.2.8.</span> <span class="toc-text">Result</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="toc-number">2.2.9.</span> <span class="toc-text">类型转换</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%92%8C%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-number">2.3.</span> <span class="toc-text">类和结构体</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB"><span class="toc-number">2.3.1.</span> <span class="toc-text">类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-number">2.3.2.</span> <span class="toc-text">结构体</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7"><span class="toc-number">2.3.3.</span> <span class="toc-text">属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95"><span class="toc-number">2.3.4.</span> <span class="toc-text">方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF"><span class="toc-number">2.3.5.</span> <span class="toc-text">继承</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%BC%8F"><span class="toc-number">2.4.</span> <span class="toc-text">函数式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#map"><span class="toc-number">2.4.1.</span> <span class="toc-text">map</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#filter"><span class="toc-number">2.4.2.</span> <span class="toc-text">filter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#reduce"><span class="toc-number">2.4.3.</span> <span class="toc-text">reduce</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sorted"><span class="toc-number">2.4.4.</span> <span class="toc-text">sorted</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E6%B5%81"><span class="toc-number">2.5.</span> <span class="toc-text">控制流</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#If-%E2%80%A2-If-let-%E2%80%A2-If-case-let"><span class="toc-number">2.5.1.</span> <span class="toc-text">If • If let • If case let</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Guard-guard-guard-let"><span class="toc-number">2.5.2.</span> <span class="toc-text">Guard guard, guard let</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%81%8D%E5%8E%86-For-in"><span class="toc-number">2.5.3.</span> <span class="toc-text">遍历 For-in</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#While-while-repeat-while"><span class="toc-number">2.5.4.</span> <span class="toc-text">While while, repeat-while</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Switch"><span class="toc-number">2.5.5.</span> <span class="toc-text">Switch</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E5%90%88"><span class="toc-number">2.6.</span> <span class="toc-text">集合</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E7%BB%84-1-2-3"><span class="toc-number">2.6.1.</span> <span class="toc-text">数组 [1, 2, 3]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Sets-Set"><span class="toc-number">2.6.2.</span> <span class="toc-text">Sets Set</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E5%85%B8"><span class="toc-number">2.6.3.</span> <span class="toc-text">字典 [:]</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">2.7.</span> <span class="toc-text">操作符</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B5%8B%E5%80%BC"><span class="toc-number">2.7.1.</span> <span class="toc-text">赋值 &#x3D;, +&#x3D;. -&#x3D;, *&#x3D;, &#x2F;&#x3D;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E7%AC%A6"><span class="toc-number">2.7.2.</span> <span class="toc-text">计算符 +, -, *, &#x2F;, %</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97%E7%AC%A6-gt"><span class="toc-number">2.7.3.</span> <span class="toc-text">比较运算符 &#x3D;&#x3D;, &gt;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E5%85%83"><span class="toc-number">2.7.4.</span> <span class="toc-text">三元  ?  : _</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Nil-coalescing"><span class="toc-number">2.7.5.</span> <span class="toc-text">Nil-coalescing ??</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8C%83%E5%9B%B4-a%E2%80%A6b"><span class="toc-number">2.7.6.</span> <span class="toc-text">范围 a…b</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%BB%E8%BE%91-amp-amp"><span class="toc-number">2.7.7.</span> <span class="toc-text">逻辑 !, &amp;&amp;, ||</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%81%92%E7%AD%89"><span class="toc-number">2.7.8.</span> <span class="toc-text">恒等 &#x3D;&#x3D;&#x3D;, !&#x3D;&#x3D;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">2.7.9.</span> <span class="toc-text">运算符</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E5%BA%93"><span class="toc-number">2.8.</span> <span class="toc-text">基础库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%B6%E9%97%B4"><span class="toc-number">2.8.1.</span> <span class="toc-text">时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%BC%E5%BC%8F%E5%8C%96"><span class="toc-number">2.8.2.</span> <span class="toc-text">格式化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%A6%E9%87%8F%E5%80%BC"><span class="toc-number">2.8.3.</span> <span class="toc-text">度量值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Data"><span class="toc-number">2.8.4.</span> <span class="toc-text">Data</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6"><span class="toc-number">2.8.5.</span> <span class="toc-text">文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Scanner"><span class="toc-number">2.8.6.</span> <span class="toc-text">Scanner</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AttributeString"><span class="toc-number">2.8.7.</span> <span class="toc-text">AttributeString</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9A%8F%E6%9C%BA"><span class="toc-number">2.8.8.</span> <span class="toc-text">随机</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UserDefaults"><span class="toc-number">2.8.9.</span> <span class="toc-text">UserDefaults</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.9.</span> <span class="toc-text">模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E4%BE%8B"><span class="toc-number">2.9.1.</span> <span class="toc-text">单例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%8F%8A%E8%AE%BE%E5%A4%87"><span class="toc-number">2.10.</span> <span class="toc-text">系统及设备</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%88%A4%E6%96%AD"><span class="toc-number">2.10.1.</span> <span class="toc-text">系统判断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%88%E6%9C%AC%E5%85%BC%E5%AE%B9"><span class="toc-number">2.10.2.</span> <span class="toc-text">版本兼容</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#canImport-%E5%88%A4%E6%96%AD%E5%BA%93%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BD%BF%E7%94%A8"><span class="toc-number">2.10.3.</span> <span class="toc-text">canImport 判断库是否可使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#targetEnvironment-%E7%8E%AF%E5%A2%83%E7%9A%84%E5%88%A4%E6%96%AD"><span class="toc-number">2.10.4.</span> <span class="toc-text">targetEnvironment 环境的判断</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%B8%A6%E5%B1%9E%E6%80%A7%E5%8C%85%E8%A3%85"><span class="toc-number">2.11.</span> <span class="toc-text">自带属性包装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#resultBuilder"><span class="toc-number">2.11.1.</span> <span class="toc-text">@resultBuilder</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dynamicMemberLookup-%E5%8A%A8%E6%80%81%E6%88%90%E5%91%98%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.11.2.</span> <span class="toc-text">@dynamicMemberLookup 动态成员查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dynamicCallable-%E5%8A%A8%E6%80%81%E5%8F%AF%E8%B0%83%E7%94%A8%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.11.3.</span> <span class="toc-text">@dynamicCallable 动态可调用类型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%B8%A6%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.12.</span> <span class="toc-text">自带协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Hashable"><span class="toc-number">2.12.1.</span> <span class="toc-text">Hashable</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Codable"><span class="toc-number">2.13.</span> <span class="toc-text">Codable</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#JSON-%E6%B2%A1%E6%9C%89-id-%E5%AD%97%E6%AE%B5"><span class="toc-number">2.13.1.</span> <span class="toc-text">JSON 没有 id 字段</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C"><span class="toc-number">2.14.</span> <span class="toc-text">网络</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E7%8A%B6%E6%80%81%E6%A3%80%E6%9F%A5"><span class="toc-number">2.14.1.</span> <span class="toc-text">网络状态检查</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E7%94%BB"><span class="toc-number">2.15.</span> <span class="toc-text">动画</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%83%E5%B1%80%E5%8A%A8%E7%94%BB"><span class="toc-number">2.15.1.</span> <span class="toc-text">布局动画</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8"><span class="toc-number">2.16.</span> <span class="toc-text">安全</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Keychain"><span class="toc-number">2.16.1.</span> <span class="toc-text">Keychain</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E7%A8%8B"><span class="toc-number">2.17.</span> <span class="toc-text">工程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%85%A5%E5%8F%A3%E7%82%B9"><span class="toc-number">2.17.1.</span> <span class="toc-text">程序入口点</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%93%E9%A2%98"><span class="toc-number">3.</span> <span class="toc-text">专题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Swift-%E9%82%A3%E4%BA%9B%E4%BA%8B"><span class="toc-number">3.1.</span> <span class="toc-text">Swift 那些事</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Swift-%E5%90%84%E7%89%88%E6%9C%AC%E6%BC%94%E8%BF%9B"><span class="toc-number">3.1.1.</span> <span class="toc-text">Swift 各版本演进</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%84%E8%8C%83"><span class="toc-number">3.2.</span> <span class="toc-text">规范</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">3.2.1.</span> <span class="toc-text">注意事项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B5%84%E6%96%99%E6%8E%A8%E8%8D%90"><span class="toc-number">3.3.</span> <span class="toc-text">资料推荐</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B9%A6%E5%8D%95"><span class="toc-number">3.3.1.</span> <span class="toc-text">书单</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E6%96%B9%E5%BA%93%E4%BD%BF%E7%94%A8"><span class="toc-number">3.4.</span> <span class="toc-text">三方库使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SQLite-swift-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">3.4.1.</span> <span class="toc-text">SQLite.swift 的使用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#macOS"><span class="toc-number">3.5.</span> <span class="toc-text">macOS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8C%83%E4%BE%8B"><span class="toc-number">3.5.1.</span> <span class="toc-text">范例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E6%A0%8F%E7%BB%93%E6%9E%84"><span class="toc-number">3.5.2.</span> <span class="toc-text">三栏结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A8%E5%B1%8F%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.5.3.</span> <span class="toc-text">全屏模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B1%E4%BA%AB%E8%8F%9C%E5%8D%95"><span class="toc-number">3.5.4.</span> <span class="toc-text">共享菜单</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%AA%E8%B4%B4%E6%9D%BF"><span class="toc-number">3.5.5.</span> <span class="toc-text">剪贴板</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Combine"><span class="toc-number">4.</span> <span class="toc-text">Combine</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">4.1.</span> <span class="toc-text">介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Combine-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">4.1.1.</span> <span class="toc-text">Combine 是什么？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Combine-%E8%B5%84%E6%96%99"><span class="toc-number">4.1.2.</span> <span class="toc-text">Combine 资料</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E"><span class="toc-number">4.2.</span> <span class="toc-text">使用说明</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#publisher"><span class="toc-number">4.2.1.</span> <span class="toc-text">publisher</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Just"><span class="toc-number">4.2.2.</span> <span class="toc-text">Just</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PassthroughSubject"><span class="toc-number">4.2.3.</span> <span class="toc-text">PassthroughSubject</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Empty"><span class="toc-number">4.2.4.</span> <span class="toc-text">Empty</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CurrentValueSubject"><span class="toc-number">4.2.5.</span> <span class="toc-text">CurrentValueSubject</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#removeDuplicates"><span class="toc-number">4.2.6.</span> <span class="toc-text">removeDuplicates</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#flatMap"><span class="toc-number">4.2.7.</span> <span class="toc-text">flatMap</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#append"><span class="toc-number">4.2.8.</span> <span class="toc-text">append</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#prepend"><span class="toc-number">4.2.9.</span> <span class="toc-text">prepend</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#merge"><span class="toc-number">4.2.10.</span> <span class="toc-text">merge</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#zip"><span class="toc-number">4.2.11.</span> <span class="toc-text">zip</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#combineLatest"><span class="toc-number">4.2.12.</span> <span class="toc-text">combineLatest</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Scheduler"><span class="toc-number">4.2.13.</span> <span class="toc-text">Scheduler</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">4.3.</span> <span class="toc-text">使用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82"><span class="toc-number">4.3.1.</span> <span class="toc-text">网络请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#KVO"><span class="toc-number">4.3.2.</span> <span class="toc-text">KVO</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E7%9F%A5"><span class="toc-number">4.3.3.</span> <span class="toc-text">通知</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Timer"><span class="toc-number">4.3.4.</span> <span class="toc-text">Timer</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Concurrency"><span class="toc-number">5.</span> <span class="toc-text">Concurrency</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-1"><span class="toc-number">5.1.</span> <span class="toc-text">介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Swift-Concurrency-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">5.1.1.</span> <span class="toc-text">Swift Concurrency 是什么？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#async-await"><span class="toc-number">5.1.2.</span> <span class="toc-text">async&#x2F;await</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Async-Sequences"><span class="toc-number">5.1.3.</span> <span class="toc-text">Async Sequences</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E5%8C%96%E5%B9%B6%E5%8F%91"><span class="toc-number">5.1.4.</span> <span class="toc-text">结构化并发</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Actors"><span class="toc-number">5.1.5.</span> <span class="toc-text">Actors</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%8F%90%E6%A1%88"><span class="toc-number">5.1.6.</span> <span class="toc-text">相关提案</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%A6%E4%B9%A0%E8%B7%AF%E5%BE%84"><span class="toc-number">5.1.7.</span> <span class="toc-text">学习路径</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Swift-Concurrency-%E5%92%8C-Combine"><span class="toc-number">5.1.8.</span> <span class="toc-text">Swift Concurrency 和 Combine</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SwiftUI"><span class="toc-number">6.</span> <span class="toc-text">SwiftUI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-2"><span class="toc-number">6.1.</span> <span class="toc-text">介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SwiftUI-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">6.1.1.</span> <span class="toc-text">SwiftUI 是什么？</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8"><span class="toc-number">6.2.</span> <span class="toc-text">视图组件使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SwiftUI-%E5%AF%B9%E6%A0%87%E7%9A%84-UIKit-%E8%A7%86%E5%9B%BE"><span class="toc-number">6.2.1.</span> <span class="toc-text">SwiftUI 对标的 UIKit 视图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Text"><span class="toc-number">6.2.2.</span> <span class="toc-text">Text</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Link"><span class="toc-number">6.2.3.</span> <span class="toc-text">Link</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Label"><span class="toc-number">6.2.4.</span> <span class="toc-text">Label</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TextEditor"><span class="toc-number">6.2.5.</span> <span class="toc-text">TextEditor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TextField"><span class="toc-number">6.2.6.</span> <span class="toc-text">TextField</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Button"><span class="toc-number">6.2.7.</span> <span class="toc-text">Button</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ProgressView"><span class="toc-number">6.2.8.</span> <span class="toc-text">ProgressView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Image"><span class="toc-number">6.2.9.</span> <span class="toc-text">Image</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ControlGroup"><span class="toc-number">6.2.10.</span> <span class="toc-text">ControlGroup</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GroupBox"><span class="toc-number">6.2.11.</span> <span class="toc-text">GroupBox</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Stack"><span class="toc-number">6.2.12.</span> <span class="toc-text">Stack</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NavigationView"><span class="toc-number">6.2.13.</span> <span class="toc-text">NavigationView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#List"><span class="toc-number">6.2.14.</span> <span class="toc-text">List</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LazyVStack-%E5%92%8C-LazyHStack"><span class="toc-number">6.2.15.</span> <span class="toc-text">LazyVStack 和 LazyHStack</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LazyVGrid-%E5%92%8C-LazyHGrid"><span class="toc-number">6.2.16.</span> <span class="toc-text">LazyVGrid 和 LazyHGrid</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ScrollView"><span class="toc-number">6.2.17.</span> <span class="toc-text">ScrollView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%AE%E5%B1%82"><span class="toc-number">6.2.18.</span> <span class="toc-text">浮层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TabView"><span class="toc-number">6.2.19.</span> <span class="toc-text">TabView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Toggle"><span class="toc-number">6.2.20.</span> <span class="toc-text">Toggle</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Picker"><span class="toc-number">6.2.21.</span> <span class="toc-text">Picker</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Slider"><span class="toc-number">6.2.22.</span> <span class="toc-text">Slider</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Stepper"><span class="toc-number">6.2.23.</span> <span class="toc-text">Stepper</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Keyboard"><span class="toc-number">6.2.24.</span> <span class="toc-text">Keyboard</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E8%A7%89"><span class="toc-number">6.3.</span> <span class="toc-text">视觉</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Color"><span class="toc-number">6.3.1.</span> <span class="toc-text">Color</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Effect"><span class="toc-number">6.3.2.</span> <span class="toc-text">Effect</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Animation"><span class="toc-number">6.3.3.</span> <span class="toc-text">Animation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Canvas"><span class="toc-number">6.3.4.</span> <span class="toc-text">Canvas</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E8%80%85"><span class="toc-number">7.</span> <span class="toc-text">开发者</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Swift%E5%AE%98%E6%96%B9"><span class="toc-number">7.1.</span> <span class="toc-text">Swift官方</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BE%E5%8C%BA"><span class="toc-number">7.2.</span> <span class="toc-text">社区</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A2%E7%B4%A2%E5%BA%93"><span class="toc-number">8.</span> <span class="toc-text">探索库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E9%B2%9C%E4%BA%8B"><span class="toc-number">8.1.</span> <span class="toc-text">新鲜事</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E6%98%93%E7%94%A8%E5%8A%9F%E8%83%BD"><span class="toc-number">8.2.</span> <span class="toc-text">封装易用功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SwiftUI-%E6%89%A9%E5%B1%95"><span class="toc-number">8.3.</span> <span class="toc-text">SwiftUI 扩展</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E7%89%87"><span class="toc-number">8.4.</span> <span class="toc-text">图片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E5%AD%97%E5%A4%84%E7%90%86"><span class="toc-number">8.5.</span> <span class="toc-text">文字处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E7%94%BB-1"><span class="toc-number">8.6.</span> <span class="toc-text">动画</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8"><span class="toc-number">8.7.</span> <span class="toc-text">持久化存储</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E8%8C%83%E5%BC%8F"><span class="toc-number">8.8.</span> <span class="toc-text">编程范式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1"><span class="toc-number">8.9.</span> <span class="toc-text">路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E6%A3%80%E6%9F%A5"><span class="toc-number">8.10.</span> <span class="toc-text">静态检查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E8%83%BD%E5%8A%9B"><span class="toc-number">8.11.</span> <span class="toc-text">系统能力</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3"><span class="toc-number">8.12.</span> <span class="toc-text">接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%BA%94%E7%94%A8"><span class="toc-number">8.13.</span> <span class="toc-text">接口应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#macOS-1"><span class="toc-number">8.14.</span> <span class="toc-text">macOS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8"><span class="toc-number">8.15.</span> <span class="toc-text">应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%B8%E6%88%8F"><span class="toc-number">8.16.</span> <span class="toc-text">游戏</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E6%8A%80%E6%9C%AF%E5%B1%95%E7%A4%BA"><span class="toc-number">8.17.</span> <span class="toc-text">新技术展示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Combine-%E6%89%A9%E5%B1%95"><span class="toc-number">8.18.</span> <span class="toc-text">Combine 扩展</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%9A%E5%90%88"><span class="toc-number">8.19.</span> <span class="toc-text">聚合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E3%80%81%E5%B7%A5%E7%A8%8B%E6%9E%84%E5%BB%BA%E5%8F%8A%E8%87%AA%E5%8A%A8%E5%8C%96"><span class="toc-number">8.20.</span> <span class="toc-text">性能、工程构建及自动化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">8.21.</span> <span class="toc-text">测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C-1"><span class="toc-number">8.22.</span> <span class="toc-text">网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E5%BD%A2"><span class="toc-number">8.23.</span> <span class="toc-text">图形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9F%B3%E8%A7%86%E9%A2%91"><span class="toc-number">8.24.</span> <span class="toc-text">音视频</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8-1"><span class="toc-number">8.25.</span> <span class="toc-text">安全</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Web"><span class="toc-number">8.26.</span> <span class="toc-text">Web</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">8.27.</span> <span class="toc-text">服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F"><span class="toc-number">8.28.</span> <span class="toc-text">系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Web-3-0"><span class="toc-number">8.29.</span> <span class="toc-text">Web 3.0</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Apple"><span class="toc-number">8.30.</span> <span class="toc-text">Apple</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6"><span class="toc-number">8.31.</span> <span class="toc-text">计算机科学</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E7%9F%A5%E8%AF%86"><span class="toc-number">8.32.</span> <span class="toc-text">扩展知识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%85%E5%88%86%E7%B1%BB"><span class="toc-number">8.33.</span> <span class="toc-text">待分类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%9A%E5%AE%A2%E5%92%8C%E8%B5%84%E8%AE%AF"><span class="toc-number">9.</span> <span class="toc-text">博客和资讯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E5%86%8C%E5%AD%90%E5%8A%A8%E6%80%81"><span class="toc-number">10.</span> <span class="toc-text">小册子动态</span></a></li></ol>
            </div>
        
        <!-- sidebar -->
        <div class="sidebar sidebar-hide">
    <ul class="sidebar-tabs sidebar-tabs-active-0">
        <li class="sidebar-tab-archives"><span class="iconfont-archer">&#xe67d;</span><span class="tab-name">Archive</span></li>
        <li class="sidebar-tab-tags"><span class="iconfont-archer">&#xe61b;</span><span class="tab-name">Tag</span></li>
        <li class="sidebar-tab-categories"><span class="iconfont-archer">&#xe666;</span><span class="tab-name">Cate</span></li>
    </ul>
    <div class="sidebar-content sidebar-content-show-archive">
        <div class="sidebar-panel-archives">
    <!-- 在 ejs 中将 archive 按照时间排序 -->
    
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    
    
    
    
    <div class="total-and-search">
        <div class="total-archive">
        Total : 55
        </div>
        <!-- search  -->
        
    </div>
    
    <div class="post-archive">
    
        
            
            
            <div class="archive-year"> 2022 </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">03/25</span>
            <a class="archive-post-title" href="/2022/03/25/develop-with-swiftui/">在苹果加速器活动做的 SwiftUI 开发分享</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">02/26</span>
            <a class="archive-post-title" href="/2022/02/26/draw-in-2021/">2021年画的</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">02/10</span>
            <a class="archive-post-title" href="/2022/02/10/swift-evolutionary-path/">Swift 演进之路</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">01/03</span>
            <a class="archive-post-title" href="/2022/01/03/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/">如何用 SwiftUI + Combine + Swift Concurrency Aysnc/Await Actor 欢畅开发</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> 2021 </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">11/23</span>
            <a class="archive-post-title" href="/2021/11/23/daiming-swift-pamphlet/">戴铭的 Swift 小册子 4.0</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">07/24</span>
            <a class="archive-post-title" href="/2021/07/24/my-little-idea-about-writing-technical-article/">我写技术文章的一点心得</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">07/13</span>
            <a class="archive-post-title" href="/2021/07/13/deeply-analyse-autolayout-slides/">深入剖析Auto Layout的幻灯片</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">06/08</span>
            <a class="archive-post-title" href="/2021/06/08/wwdc2021-day1-note/">WWDC 2021 Day1 笔记</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">05/22</span>
            <a class="archive-post-title" href="/2021/05/22/acfun-swift-practice/">A站 的 Swift 实践</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">02/21</span>
            <a class="archive-post-title" href="/2021/02/21/deeply-analyse-quickjs/">深入剖析 JavaScript 编译器/解释器引擎 QuickJS - 多了解些 JavaScript 语言</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> 2020 </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">12/18</span>
            <a class="archive-post-title" href="/2020/12/18/thinking-in-how-to-speed-up-app/">App 启动提速实践和一些想法</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">05/04</span>
            <a class="archive-post-title" href="/2020/05/04/draw-in-2020/">2020年涂图</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">04/12</span>
            <a class="archive-post-title" href="/2020/04/12/why_write_study_ios_programming_with_daiming_book_and_draw_recently/">我为什么写了《跟戴铭学iOS编程》这本书</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">03/29</span>
            <a class="archive-post-title" href="/2020/03/29/apple-system-executable-file-macho/">Apple 操作系统可执行文件 Mach-O</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">01/05</span>
            <a class="archive-post-title" href="/2020/01/05/kuaishou-unused-class-swiftui-note-binary-tree-interview/">在快手做分享、无用类检查、在广州做 SwiftUI 学习笔记分享、InfoQ二叉树视频</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> 2019 </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">12/28</span>
            <a class="archive-post-title" href="/2019/12/28/japan-travel/">日本游玩</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">12/07</span>
            <a class="archive-post-title" href="/2019/12/07/how-to-analyze-startup-time-cost-in-ios/">如何对 iOS 启动阶段耗时进行分析</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">12/06</span>
            <a class="archive-post-title" href="/2019/12/06/draw-in-2019/">2019年涂图</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">07/29</span>
            <a class="archive-post-title" href="/2019/07/29/ios-map/">iOS 开发舆图</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">06/19</span>
            <a class="archive-post-title" href="/2019/06/19/white-dragon-class/">白龙班</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> 2018 </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/17</span>
            <a class="archive-post-title" href="/2018/09/17/produce-slides-of-third-at-swift-conference/">这次swift大会分享准备的幻灯片和 demo</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/14</span>
            <a class="archive-post-title" href="/2018/09/14/draw-with-procreate-in-ipad-during-pre-half-in-20182/">18年上半年procreate的练习图图</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">04/21</span>
            <a class="archive-post-title" href="/2018/04/21/deeply-analyse-javascriptcore/">深入剖析 JavaScriptCore</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">04/07</span>
            <a class="archive-post-title" href="/2018/04/07/read-snapkit-and-masonry-source-code/">读 SnapKit 和 Masonry 自动布局框架源码</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">04/02</span>
            <a class="archive-post-title" href="/2018/04/02/record-and-think-about-swift-project-jsondecoder-networking-and-pop/">Swift 项目中涉及到 JSONDecoder，网络请求，泛型协议式编程的一些记录和想法</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">01/24</span>
            <a class="archive-post-title" href="/2018/01/24/why-swift/">Why Swift? Generics(泛型), Collection(集合类型), POP(协议式编程), Memory Management(内存管理)</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">01/10</span>
            <a class="archive-post-title" href="/2018/01/10/slides-of-giac-how-to-use-swift-transfer-web-to-60-frame-native-code/">GIAC 大会上分享的《Swift 将 Web 代码转成60帧满帧原生应用的方案及实践》的幻灯片</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">01/04</span>
            <a class="archive-post-title" href="/2018/01/04/baimi/">白芈</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">01/04</span>
            <a class="archive-post-title" href="/2018/01/04/huaye/">花野</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> 2017 </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">10/24</span>
            <a class="archive-post-title" href="/2017/10/24/how-do-i-improve-the-development/">在滴滴，我是如何指数级提升开发技术的？</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">10/16</span>
            <a class="archive-post-title" href="/2017/10/16/html-to-native-htn-development-record/">HTML 转原生 HTN 项目开发记录</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">10/11</span>
            <a class="archive-post-title" href="/2017/10/11/deeply-analyse-webkit/">深入剖析 WebKit</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">06/20</span>
            <a class="archive-post-title" href="/2017/06/20/deeply-ios-performance-optimization/">深入剖析 iOS 性能优化</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">06/12</span>
            <a class="archive-post-title" href="/2017/06/12/gmtc-ios-slimming-practice/">GMTC 上分享滴滴出行 iOS 端瘦身实践的 Slides</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">05/27</span>
            <a class="archive-post-title" href="/2017/05/27/slides-of-learn-what-interesting-things-you-can-do-with-iOS-compilation/">atSwift大会上分享《学习iOS编译原理能做哪些有意思的事情》的 Slides</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">04/01</span>
            <a class="archive-post-title" href="/2017/04/01/build-static-analysis-program-smck-use-swift/">用 Swift 编写的工程代码静态分析命令行工具 smck</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">04/01</span>
            <a class="archive-post-title" href="/2017/04/01/slides-of-deeply-analyse-llvm/">深入剖析 iOS 编译 Clang / LLVM 直播的 Slides</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">03/01</span>
            <a class="archive-post-title" href="/2017/03/01/deeply-analyse-llvm/">深入剖析 iOS 编译 Clang / LLVM</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> 2016 </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">11/22</span>
            <a class="archive-post-title" href="/2016/11/22/how-to-preload-web-in-ios/">iOS预加载Web页面方案</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">11/17</span>
            <a class="archive-post-title" href="/2016/11/17/use-swift3-build-macos-program-to-clear-unuse-method/">使用Swift3开发了个macOS的程序可以检测出objc项目中无用方法，然后一键全部清理</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/20</span>
            <a class="archive-post-title" href="/2016/09/20/draw-with-procreate-in-ipad-during-15-to-16/">15，16年iPad上使用Procreate画的</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/02</span>
            <a class="archive-post-title" href="/2016/09/02/develop-rss-reader/">使用ReactiveCocoa开发RSS阅读器</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">08/09</span>
            <a class="archive-post-title" href="/2016/08/09/how-to-use-reactivecocoa/">iOS函数响应式编程以及ReactiveCocoa的使用</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">07/21</span>
            <a class="archive-post-title" href="/2016/07/21/assembleview/">制作一个类似苹果VFL(Visual Format Language)的格式化语言来描述类似UIStackView那种布局思路，并解析生成页面</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">05/30</span>
            <a class="archive-post-title" href="/2016/05/30/what-learn-from-reactivecocoa/">从 ReactiveCocoa 中能学到什么？不用此库也能学以致用</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">05/23</span>
            <a class="archive-post-title" href="/2016/05/23/try-to-decouple-with-demo/">竭尽全力的去解耦的一次实践，封装一个TableView和一些功能组合的控件</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">04/04</span>
            <a class="archive-post-title" href="/2016/04/04/tenth-middle-school/">十中</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">01/13</span>
            <a class="archive-post-title" href="/2016/01/13/how-to-use-gcd/">细说 GCD（Grand Central Dispatch）如何用</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> 2015 </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">11/03</span>
            <a class="archive-post-title" href="/2015/11/03/deeply-analyse-autolayout/">深入剖析Auto Layout，分析iOS各版本新增特性</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">11/02</span>
            <a class="archive-post-title" href="/2015/11/02/draw-with-note-in-ipad-during-15/">15年用iPad上的备忘录画的</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">05/28</span>
            <a class="archive-post-title" href="/2015/05/28/macos-app-i-used/">我用过的 macOS 应用</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">04/02</span>
            <a class="archive-post-title" href="/2015/04/02/draw-game-of-thrones-with-pencil-during-14/">整理了画的权利的游戏里的角色，有龙女，小恶魔等等</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">04/01</span>
            <a class="archive-post-title" href="/2015/04/01/objc-runtime/">Objc Runtime 总结</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">03/12</span>
            <a class="archive-post-title" href="/2015/03/12/draw-practice-with-pencil-during-14-to-15/">14和15年间的铅笔画练习</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> 2014 </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">03/01</span>
            <a class="archive-post-title" href="/2014/03/01/black-star-blue-map/">黑星蓝图</a>
        </li>
    
    </div>
</div>

        <div class="sidebar-panel-tags">
    <div class="sidebar-tags-name">
        
            <span class="sidebar-tag-name" data-tags="iOS">
                <span class="iconfont-archer">&#xe606;</span>
                iOS
            </span>
        
            <span class="sidebar-tag-name" data-tags="Apple">
                <span class="iconfont-archer">&#xe606;</span>
                Apple
            </span>
        
            <span class="sidebar-tag-name" data-tags="Swift">
                <span class="iconfont-archer">&#xe606;</span>
                Swift
            </span>
        
            <span class="sidebar-tag-name" data-tags="AssembleView">
                <span class="iconfont-archer">&#xe606;</span>
                AssembleView
            </span>
        
            <span class="sidebar-tag-name" data-tags="Novel">
                <span class="iconfont-archer">&#xe606;</span>
                Novel
            </span>
        
            <span class="sidebar-tag-name" data-tags="Mach-O">
                <span class="iconfont-archer">&#xe606;</span>
                Mach-O
            </span>
        
            <span class="sidebar-tag-name" data-tags="smck">
                <span class="iconfont-archer">&#xe606;</span>
                smck
            </span>
        
            <span class="sidebar-tag-name" data-tags="Autolayout">
                <span class="iconfont-archer">&#xe606;</span>
                Autolayout
            </span>
        
            <span class="sidebar-tag-name" data-tags="JavaScript">
                <span class="iconfont-archer">&#xe606;</span>
                JavaScript
            </span>
        
            <span class="sidebar-tag-name" data-tags="Web">
                <span class="iconfont-archer">&#xe606;</span>
                Web
            </span>
        
            <span class="sidebar-tag-name" data-tags="编译">
                <span class="iconfont-archer">&#xe606;</span>
                编译
            </span>
        
            <span class="sidebar-tag-name" data-tags="RSSReader">
                <span class="iconfont-archer">&#xe606;</span>
                RSSReader
            </span>
        
            <span class="sidebar-tag-name" data-tags="macOS">
                <span class="iconfont-archer">&#xe606;</span>
                macOS
            </span>
        
            <span class="sidebar-tag-name" data-tags="Combine">
                <span class="iconfont-archer">&#xe606;</span>
                Combine
            </span>
        
            <span class="sidebar-tag-name" data-tags="SwiftUI">
                <span class="iconfont-archer">&#xe606;</span>
                SwiftUI
            </span>
        
            <span class="sidebar-tag-name" data-tags="Concurrency">
                <span class="iconfont-archer">&#xe606;</span>
                Concurrency
            </span>
        
            <span class="sidebar-tag-name" data-tags="LLVM">
                <span class="iconfont-archer">&#xe606;</span>
                LLVM
            </span>
        
            <span class="sidebar-tag-name" data-tags="Clang">
                <span class="iconfont-archer">&#xe606;</span>
                Clang
            </span>
        
            <span class="sidebar-tag-name" data-tags="Performance optimization">
                <span class="iconfont-archer">&#xe606;</span>
                Performance optimization
            </span>
        
            <span class="sidebar-tag-name" data-tags="Painting">
                <span class="iconfont-archer">&#xe606;</span>
                Painting
            </span>
        
            <span class="sidebar-tag-name" data-tags="Pencil">
                <span class="iconfont-archer">&#xe606;</span>
                Pencil
            </span>
        
            <span class="sidebar-tag-name" data-tags="GOT">
                <span class="iconfont-archer">&#xe606;</span>
                GOT
            </span>
        
            <span class="sidebar-tag-name" data-tags="iPad">
                <span class="iconfont-archer">&#xe606;</span>
                iPad
            </span>
        
            <span class="sidebar-tag-name" data-tags="Procreate">
                <span class="iconfont-archer">&#xe606;</span>
                Procreate
            </span>
        
            <span class="sidebar-tag-name" data-tags="WebKit">
                <span class="iconfont-archer">&#xe606;</span>
                WebKit
            </span>
        
            <span class="sidebar-tag-name" data-tags="Slides">
                <span class="iconfont-archer">&#xe606;</span>
                Slides
            </span>
        
            <span class="sidebar-tag-name" data-tags="Study">
                <span class="iconfont-archer">&#xe606;</span>
                Study
            </span>
        
            <span class="sidebar-tag-name" data-tags="GCD">
                <span class="iconfont-archer">&#xe606;</span>
                GCD
            </span>
        
            <span class="sidebar-tag-name" data-tags="UIWebView">
                <span class="iconfont-archer">&#xe606;</span>
                UIWebView
            </span>
        
            <span class="sidebar-tag-name" data-tags="NSURLProtocol">
                <span class="iconfont-archer">&#xe606;</span>
                NSURLProtocol
            </span>
        
            <span class="sidebar-tag-name" data-tags="ReactiveCocoa">
                <span class="iconfont-archer">&#xe606;</span>
                ReactiveCocoa
            </span>
        
            <span class="sidebar-tag-name" data-tags="Japan">
                <span class="iconfont-archer">&#xe606;</span>
                Japan
            </span>
        
            <span class="sidebar-tag-name" data-tags="APP">
                <span class="iconfont-archer">&#xe606;</span>
                APP
            </span>
        
            <span class="sidebar-tag-name" data-tags="runtime">
                <span class="iconfont-archer">&#xe606;</span>
                runtime
            </span>
        
            <span class="sidebar-tag-name" data-tags="swift">
                <span class="iconfont-archer">&#xe606;</span>
                swift
            </span>
        
            <span class="sidebar-tag-name" data-tags="Pattern">
                <span class="iconfont-archer">&#xe606;</span>
                Pattern
            </span>
        
            <span class="sidebar-tag-name" data-tags="book">
                <span class="iconfont-archer">&#xe606;</span>
                book
            </span>
        
    </div>
    <div class="iconfont-archer sidebar-tags-empty">&#xe678;</div>
    <div class="tag-load-fail" style="display: none; color: #ccc; font-size: 0.6rem;">
        缺失模块，请参考主题文档进行安装配置：https://github.com/fi3ework/hexo-theme-archer#%E5%AE%89%E8%A3%85%E4%B8%BB%E9%A2%98
    </div> 
    <div class="sidebar-tags-list"></div>
</div>

        <div class="sidebar-panel-categories">
    <div class="sidebar-categories-name">
    
        <span class="sidebar-category-name" data-categories="Programming">
            <span class="iconfont-archer">&#xe60a;</span>
            Programming
        </span>
    
        <span class="sidebar-category-name" data-categories="My-novel">
            <span class="iconfont-archer">&#xe60a;</span>
            My-novel
        </span>
    
        <span class="sidebar-category-name" data-categories="My-painting">
            <span class="iconfont-archer">&#xe60a;</span>
            My-painting
        </span>
    
        <span class="sidebar-category-name" data-categories="travel">
            <span class="iconfont-archer">&#xe60a;</span>
            travel
        </span>
    
        <span class="sidebar-category-name" data-categories="APP">
            <span class="iconfont-archer">&#xe60a;</span>
            APP
        </span>
    
    </div>
    <div class="iconfont-archer sidebar-categories-empty">&#xe678;</div>
    <div class="sidebar-categories-list"></div>
</div>

    </div>
</div>

        <!-- site-meta -->
        <script>
    var siteMeta = {
        url: "http://ming1016.github.io",
        root: "/",
        author: "戴铭"
    }
</script>

        <!-- import experimental options here -->
        <!-- Custom Font -->


        <!-- main func -->
        <script src="/scripts/main.js?v=20210823"></script>
        <!-- dark mode -->
        <script src="/scripts/dark.js?v=20210823"></script>
        <!-- fancybox -->
        <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" defer></script>
        <!-- algolia -->
        
        <!-- busuanzi -->
        
            <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>
        
        <!-- CNZZ -->
        
        <!-- async load share.js -->
        
            <script src="/scripts/share.js?v=20210823" async></script>
        
        <!-- mermaid -->
        
    </body>
</html>
