<!DOCTYPE html>
<html lang="zh-Hans">
  <head>
  <meta charset="UTF-8">
  <meta 
    name="viewport"
    content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <meta 
    http-equiv="X-UA-Compatible" 
    content="ie=edge">
  <meta 
    name="theme-color" 
    content="#fff" 
    id="theme-color">
  <meta 
    name="description" 
    content="前滴滴出行技术专家。极客时间《iOS开发高手课》和纸书《跟戴铭学iOS编程》作者。个人博客：戴铭的博客。微信公共号：starming-weixin。微博：@戴铭">
  <link 
    rel="icon" 
    href="/img/logo-starming.png">
  <title>戴铭的 Swift 小册子 5.0</title>
  
    
      <meta 
        property="og:title" 
        content="戴铭的 Swift 小册子 5.0">
    
    
      <meta 
        property="og:url" 
        content="http://ming1016.github.io/2021/11/23/daiming-swift-pamphlet/index.html">
    
    
      <meta 
        property="og:img" 
        content="https://user-images.githubusercontent.com/251980/152918704-9522eb27-9304-4788-b4ed-72ffb170e1bc.png">
    
    
      <meta 
        property="og:img" 
        content="前滴滴出行技术专家。极客时间《iOS开发高手课》和纸书《跟戴铭学iOS编程》作者。个人博客：戴铭的博客。微信公共号：starming-weixin。微博：@戴铭">
    
    
      <meta 
        property="og:type" 
        content="article">
      <meta 
        property="og:article:published_time" 
        content="2021-11-23">
      <meta 
        property="og:article:modified_time" 
        content="2022-09-01">
      <meta 
        property="og:article:author" 
        content="戴铭">
      
        
          <meta 
            property="og:article:tag" 
            content="iOS">
        
          <meta 
            property="og:article:tag" 
            content="Apple">
        
          <meta 
            property="og:article:tag" 
            content="Swift">
        
      
    
  
  
  <link rel="preload" href="//at.alicdn.com/t/font_1946621_i1kgafibvw.css" as="style" >
  <link rel="preload" href="//at.alicdn.com/t/font_1952792_89b4ac4k4up.css" as="style" >
  <link rel="preload" href="/css/main.css" as="style" >
  
  <link rel="modulepreload" href="//instant.page/5.1.0">
  
  <link rel="stylesheet" href="/css/main.css">
  
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1946621_i1kgafibvw.css">
  
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1952792_89b4ac4k4up.css">
  
  
  
    <link rel="stylesheet" href="/js/lib/lightbox/baguetteBox.min.css">
  
  <script>
    function loadScript(url, cb) {
      var script = document.createElement('script');
      script.src = url;
      if (cb) script.onload = cb;
      script.async = true;
      document.body.appendChild(script);
    }
    function loadCSS(href, data, attr) {
      var sheet = document.createElement('link');
      sheet.ref = 'stylesheet';
      sheet.href = href;
      sheet.dataset[data] = attr;
      document.head.appendChild(sheet);
    }
    function changeCSS(cssFile, data, attr) {
      var oldlink = document.querySelector(data);
      var newlink = document.createElement("link");
      newlink.setAttribute("rel", "stylesheet");
      newlink.setAttribute("href", cssFile);
      newlink.dataset.prism = attr;
      document.head.replaceChild(newlink, oldlink);
    }
  </script>
  
    
      
      
      
      
        
        
        
        <script>
          function prismThemeChange() {
            if(document.getElementById('theme-color').dataset.mode === 'dark') {
              if(document.querySelector('[data-prism]')) {
                changeCSS('/js/lib/prism/prism-tomorrow.min.css', '[data-prism]', 'prism-tomorrow');
              } else {
                loadCSS('/js/lib/prism/prism-tomorrow.min.css', 'prism', 'prism-tomorrow');
              }
            } else {
              if(document.querySelector('[data-prism]')) {
                changeCSS('/js/lib/prism/prism.min.css', '[data-prism]', 'prism');
              } else {
                loadCSS('/js/lib/prism/prism.min.css', 'prism', 'prism');
              }
            }
          }
          prismThemeChange()
        </script>
      
      
        
        <link rel="stylesheet" href="/js/lib/prism/prism-line-numbers.min.css">
      
    
  
  <script>
    // control reverse button
    var reverseDarkList = {
      dark: 'light',
      light: 'dark'
    };
    var themeColor = {
      dark: '#1c1c1e',
      light: '#fff'
    }
    // get the data of css prefers-color-scheme
    var getCssMediaQuery = function() {
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    };
    // reverse current darkmode setting function
    var reverseDarkModeSetting = function() {
      var setting = localStorage.getItem('user-color-scheme');
      if(reverseDarkList[setting]) {
        setting = reverseDarkList[setting];
      } else if(setting === null) {
        setting = reverseDarkList[getCssMediaQuery()];
      } else {
        return;
      }
      localStorage.setItem('user-color-scheme', setting);
      return setting;
    };
    // apply current darkmode setting
  </script>
  
    <script>
      var setDarkmode = function(mode) {
      var setting = mode || localStorage.getItem('user-color-scheme');
      if(setting === getCssMediaQuery()) {
        document.documentElement.removeAttribute('data-user-color-scheme');
        localStorage.removeItem('user-color-scheme');
        document.getElementById('theme-color').content = themeColor[setting];
        document.getElementById('theme-color').dataset.mode = setting;
        prismThemeChange();
      } else if(reverseDarkList[setting]) {
        document.documentElement.setAttribute('data-user-color-scheme', setting);
        document.getElementById('theme-color').content = themeColor[setting];
        document.getElementById('theme-color').dataset.mode = setting;
        prismThemeChange();
      } else {
        document.documentElement.removeAttribute('data-user-color-scheme');
        localStorage.removeItem('user-color-scheme');
        document.getElementById('theme-color').content = themeColor[getCssMediaQuery()];
        document.getElementById('theme-color').dataset.mode = getCssMediaQuery();
        prismThemeChange();
      }
    };
    setDarkmode();
    </script>
  
  
  
    <link rel="preload" href="/js/lib/lightbox/baguetteBox.min.js" as="script">
    <link rel="preload" href="/js/lib/lightbox/baguetteBox.min.css" as="style" >
  
  
    <link rel="preload" href="/js/lib/lozad.min.js" as="script">
  
  
  
  
  
  
<meta name="generator" content="Hexo 5.4.2"></head>

  <body>
    <div class="wrapper">
       
      <nav class="navbar">
  <div class="navbar-logo">
    <a class="navbar-logo-main" href="/">
      
        <img 
          class="navbar-logo-img"
          width="32"
          height="32"
          src="/img/logo-starming.png" 
          alt="blog logo">
      
      <span class="navbar-logo-dsc">戴铭的博客</span>
      </a>
  </div>
  <div class="navbar-menu">
    
      <a 
        href="/" 
        class="navbar-menu-item">
        
          Home
        
      </a>
    
      <a 
        href="/archives" 
        class="navbar-menu-item">
        
          Archive
        
      </a>
    
      <a 
        href="/tags" 
        class="navbar-menu-item">
        
          Tags
        
      </a>
    
      <a 
        href="/categories" 
        class="navbar-menu-item">
        
          Categories
        
      </a>
    
      <a 
        href="/about" 
        class="navbar-menu-item">
        
          About
        
      </a>
    
      <a 
        href="/null" 
        class="navbar-menu-item">
        
          Friends
        
      </a>
    
    <button 
      class="navbar-menu-item darknavbar navbar-menu-btn" 
      aria-label="Toggle dark mode"
      id="dark">
      <i class="iconfont icon-weather"></i>
    </button>
    <button 
      class="navbar-menu-item searchnavbar navbar-menu-btn" 
      aria-label="Toggle search"
      id="search">
      <!-- <i 
        class="iconfont icon-search" 
        style="font-size: 1.2rem; font-weight: 400;">
      </i> -->
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img"
        class="iconify iconify--ion" width="28" height="28" preserveAspectRatio="xMidYMid meet" viewBox="0 0 512 512">
        <path fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="28"
          d="M256 80a176 176 0 1 0 176 176A176 176 0 0 0 256 80Z"></path>
        <path fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="28"
          d="M232 160a72 72 0 1 0 72 72a72 72 0 0 0-72-72Z"></path>
        <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="28"
          d="M283.64 283.64L336 336"></path>
      </svg>
    </button>
  </div>
</nav> 
      
      <div 
        id="local-search" 
        style="display: none">
        <input
          class="navbar-menu-item"
          id="search-input"
          placeholder="请输入搜索内容..." />
        <div id="search-content"></div>
      </div>
      
      <div class="section-wrap">
        <div class="container">
          <div class="columns">
            <aside class="left-column">
              
              <div class="card card-author">
                
  <img 
    src="/img/ming.jpeg" 
    class="author-img"
    width="88"
    height="88"
    alt="author avatar">

<p class="author-name">戴铭</p>
<p class="author-description">极客时间《iOS开发高手课》和纸书《跟戴铭学iOS编程》作者</p>
<div class="author-message">
  <a 
    class="author-posts-count" 
    href="/archives">
    <span>58</span>
    <span>Posts</span>
  </a>
  <a 
    class="author-categories-count" 
    href="/categories">
    <span>5</span>
    <span>Categories</span>
  </a>
  <a 
    class="author-tags-count" 
    href="/tags">
    <span>38</span>
    <span>Tags</span>
  </a>
</div>

  <div class="author-card-society">
    
      <div class="author-card-society-icon">
        <a target="_blank" rel="noopener" href="https://weibo.com/allstarming">
          <i class="iconfont icon-sina society-icon"></i>
        </a>
      </div>
    
      <div class="author-card-society-icon">
        <a target="_blank" rel="noopener" href="https://github.com/ming1016">
          <i class="iconfont icon-github society-icon"></i>
        </a>
      </div>
    
      <div class="author-card-society-icon">
        <a href="mailto:ming1016@foxmail.com">
          <i class="iconfont icon-mail society-icon"></i>
        </a>
      </div>
    
      <div class="author-card-society-icon">
        <a href="/atom.xml">
          <i class="iconfont icon-chrome society-icon"></i>
        </a>
      </div>
    
  </div>

              </div>
               <div class="sticky-tablet">
  
  
    <article class="display-when-two-columns spacer">
      <div class="card card-content toc-card">
        <div class="toc-header">
  <i 
    class="iconfont icon-menu" 
    style="padding-right: 2px;">
  </i>TOC
</div>
<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E8%AF%B4%E6%98%8E"><span class="toc-number">1.</span> <span class="toc-text">背景说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95%E9%80%9F%E6%9F%A5"><span class="toc-number">2.</span> <span class="toc-text">语法速查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80"><span class="toc-number">2.1.</span> <span class="toc-text">基础</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%98%E9%87%8F-let-var"><span class="toc-number">2.1.1.</span> <span class="toc-text">变量 let, var</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%93%E5%8D%B0-print-%E2%80%9C%E2%80%9D"><span class="toc-number">2.1.2.</span> <span class="toc-text">打印 print(“”)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E9%87%8A-x2F-x2F"><span class="toc-number">2.1.3.</span> <span class="toc-text">注释 &#x2F;&#x2F;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%AF%E9%80%89"><span class="toc-number">2.1.4.</span> <span class="toc-text">可选 ?, !</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AD%E5%8C%85"><span class="toc-number">2.1.5.</span> <span class="toc-text">闭包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0-func"><span class="toc-number">2.1.6.</span> <span class="toc-text">函数 func</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="toc-number">2.1.7.</span> <span class="toc-text">访问控制</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.2.</span> <span class="toc-text">基础类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E5%AD%97-Int-Float"><span class="toc-number">2.2.1.</span> <span class="toc-text">数字 Int, Float</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E6%95%B0-Bool"><span class="toc-number">2.2.2.</span> <span class="toc-text">布尔数 Bool</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%83%E7%BB%84-a-b-c"><span class="toc-number">2.2.3.</span> <span class="toc-text">元组 (a, b, c)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">2.2.4.</span> <span class="toc-text">字符串</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%9A%E4%B8%BE"><span class="toc-number">2.2.5.</span> <span class="toc-text">枚举</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%9B%E5%9E%8B"><span class="toc-number">2.2.6.</span> <span class="toc-text">泛型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8D%E9%80%8F%E6%98%8E%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.2.7.</span> <span class="toc-text">不透明类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Result"><span class="toc-number">2.2.8.</span> <span class="toc-text">Result</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="toc-number">2.2.9.</span> <span class="toc-text">类型转换</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%92%8C%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-number">2.3.</span> <span class="toc-text">类和结构体</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB"><span class="toc-number">2.3.1.</span> <span class="toc-text">类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-number">2.3.2.</span> <span class="toc-text">结构体</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7"><span class="toc-number">2.3.3.</span> <span class="toc-text">属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95"><span class="toc-number">2.3.4.</span> <span class="toc-text">方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF"><span class="toc-number">2.3.5.</span> <span class="toc-text">继承</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%BC%8F"><span class="toc-number">2.4.</span> <span class="toc-text">函数式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#map"><span class="toc-number">2.4.1.</span> <span class="toc-text">map</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#filter"><span class="toc-number">2.4.2.</span> <span class="toc-text">filter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#reduce"><span class="toc-number">2.4.3.</span> <span class="toc-text">reduce</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sorted"><span class="toc-number">2.4.4.</span> <span class="toc-text">sorted</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E6%B5%81"><span class="toc-number">2.5.</span> <span class="toc-text">控制流</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#If-%E2%80%A2-If-let-%E2%80%A2-If-case-let"><span class="toc-number">2.5.1.</span> <span class="toc-text">If • If let • If case let</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Guard-guard-guard-let"><span class="toc-number">2.5.2.</span> <span class="toc-text">Guard guard, guard let</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%81%8D%E5%8E%86-For-in"><span class="toc-number">2.5.3.</span> <span class="toc-text">遍历 For-in</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#While-while-repeat-while"><span class="toc-number">2.5.4.</span> <span class="toc-text">While while, repeat-while</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Switch"><span class="toc-number">2.5.5.</span> <span class="toc-text">Switch</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E5%90%88"><span class="toc-number">2.6.</span> <span class="toc-text">集合</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E7%BB%84-1-2-3"><span class="toc-number">2.6.1.</span> <span class="toc-text">数组 [1, 2, 3]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Sets-Set-lt-Int-gt"><span class="toc-number">2.6.2.</span> <span class="toc-text">Sets Set&lt;Int&gt;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E5%85%B8"><span class="toc-number">2.6.3.</span> <span class="toc-text">字典 [:]</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">2.7.</span> <span class="toc-text">操作符</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B5%8B%E5%80%BC-x3D-x3D-x3D-x3D-x2F-x3D"><span class="toc-number">2.7.1.</span> <span class="toc-text">赋值 &#x3D;, +&#x3D;. -&#x3D;, *&#x3D;, &#x2F;&#x3D;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E7%AC%A6-x2F"><span class="toc-number">2.7.2.</span> <span class="toc-text">计算符 +, -, *, &#x2F;, %</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97%E7%AC%A6-x3D-x3D-gt"><span class="toc-number">2.7.3.</span> <span class="toc-text">比较运算符 &#x3D;&#x3D;, &gt;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E5%85%83"><span class="toc-number">2.7.4.</span> <span class="toc-text">三元 _ ? _ : _</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Nil-coalescing"><span class="toc-number">2.7.5.</span> <span class="toc-text">Nil-coalescing ??</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8C%83%E5%9B%B4-a%E2%80%A6b"><span class="toc-number">2.7.6.</span> <span class="toc-text">范围 a…b</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%BB%E8%BE%91-amp-amp"><span class="toc-number">2.7.7.</span> <span class="toc-text">逻辑 !, &amp;&amp;, ||</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%81%92%E7%AD%89-x3D-x3D-x3D-x3D-x3D"><span class="toc-number">2.7.8.</span> <span class="toc-text">恒等 &#x3D;&#x3D;&#x3D;, !&#x3D;&#x3D;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">2.7.9.</span> <span class="toc-text">运算符</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E5%BA%93"><span class="toc-number">2.8.</span> <span class="toc-text">基础库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%B6%E9%97%B4"><span class="toc-number">2.8.1.</span> <span class="toc-text">时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%BC%E5%BC%8F%E5%8C%96"><span class="toc-number">2.8.2.</span> <span class="toc-text">格式化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%A6%E9%87%8F%E5%80%BC"><span class="toc-number">2.8.3.</span> <span class="toc-text">度量值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Data"><span class="toc-number">2.8.4.</span> <span class="toc-text">Data</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6"><span class="toc-number">2.8.5.</span> <span class="toc-text">文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Scanner"><span class="toc-number">2.8.6.</span> <span class="toc-text">Scanner</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AttributeString"><span class="toc-number">2.8.7.</span> <span class="toc-text">AttributeString</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9A%8F%E6%9C%BA"><span class="toc-number">2.8.8.</span> <span class="toc-text">随机</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UserDefaults"><span class="toc-number">2.8.9.</span> <span class="toc-text">UserDefaults</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.9.</span> <span class="toc-text">模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E4%BE%8B"><span class="toc-number">2.9.1.</span> <span class="toc-text">单例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%8F%8A%E8%AE%BE%E5%A4%87"><span class="toc-number">2.10.</span> <span class="toc-text">系统及设备</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%88%A4%E6%96%AD"><span class="toc-number">2.10.1.</span> <span class="toc-text">系统判断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%88%E6%9C%AC%E5%85%BC%E5%AE%B9"><span class="toc-number">2.10.2.</span> <span class="toc-text">版本兼容</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#canImport-%E5%88%A4%E6%96%AD%E5%BA%93%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BD%BF%E7%94%A8"><span class="toc-number">2.10.3.</span> <span class="toc-text">canImport 判断库是否可使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#targetEnvironment-%E7%8E%AF%E5%A2%83%E7%9A%84%E5%88%A4%E6%96%AD"><span class="toc-number">2.10.4.</span> <span class="toc-text">targetEnvironment 环境的判断</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%B8%A6%E5%B1%9E%E6%80%A7%E5%8C%85%E8%A3%85"><span class="toc-number">2.11.</span> <span class="toc-text">自带属性包装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#resultBuilder"><span class="toc-number">2.11.1.</span> <span class="toc-text">@resultBuilder</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dynamicMemberLookup-%E5%8A%A8%E6%80%81%E6%88%90%E5%91%98%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.11.2.</span> <span class="toc-text">@dynamicMemberLookup 动态成员查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dynamicCallable-%E5%8A%A8%E6%80%81%E5%8F%AF%E8%B0%83%E7%94%A8%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.11.3.</span> <span class="toc-text">@dynamicCallable 动态可调用类型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%B8%A6%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.12.</span> <span class="toc-text">自带协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Hashable"><span class="toc-number">2.12.1.</span> <span class="toc-text">Hashable</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Codable"><span class="toc-number">2.13.</span> <span class="toc-text">Codable</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#JSON-%E6%B2%A1%E6%9C%89-id-%E5%AD%97%E6%AE%B5"><span class="toc-number">2.13.1.</span> <span class="toc-text">JSON 没有 id 字段</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C"><span class="toc-number">2.14.</span> <span class="toc-text">网络</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E7%8A%B6%E6%80%81%E6%A3%80%E6%9F%A5"><span class="toc-number">2.14.1.</span> <span class="toc-text">网络状态检查</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E7%94%BB"><span class="toc-number">2.15.</span> <span class="toc-text">动画</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%83%E5%B1%80%E5%8A%A8%E7%94%BB"><span class="toc-number">2.15.1.</span> <span class="toc-text">布局动画</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8"><span class="toc-number">2.16.</span> <span class="toc-text">安全</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Keychain"><span class="toc-number">2.16.1.</span> <span class="toc-text">Keychain</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E7%A8%8B"><span class="toc-number">2.17.</span> <span class="toc-text">工程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%85%A5%E5%8F%A3%E7%82%B9"><span class="toc-number">2.17.1.</span> <span class="toc-text">程序入口点</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%93%E9%A2%98"><span class="toc-number">3.</span> <span class="toc-text">专题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Swift-%E9%82%A3%E4%BA%9B%E4%BA%8B"><span class="toc-number">3.1.</span> <span class="toc-text">Swift 那些事</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95%E9%80%9F%E6%9F%A5-1"><span class="toc-number">4.</span> <span class="toc-text">语法速查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80-1"><span class="toc-number">4.1.</span> <span class="toc-text">基础</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%98%E9%87%8F-let-var-1"><span class="toc-number">4.1.1.</span> <span class="toc-text">变量 let, var</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%93%E5%8D%B0-print-%E2%80%9C%E2%80%9D-1"><span class="toc-number">4.1.2.</span> <span class="toc-text">打印 print(“”)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E9%87%8A-x2F-x2F-1"><span class="toc-number">4.1.3.</span> <span class="toc-text">注释 &#x2F;&#x2F;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%AF%E9%80%89-1"><span class="toc-number">4.1.4.</span> <span class="toc-text">可选 ?, !</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AD%E5%8C%85-1"><span class="toc-number">4.1.5.</span> <span class="toc-text">闭包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0-func-1"><span class="toc-number">4.1.6.</span> <span class="toc-text">函数 func</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6-1"><span class="toc-number">4.1.7.</span> <span class="toc-text">访问控制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Regex"><span class="toc-number">4.1.8.</span> <span class="toc-text">Regex</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%B1%BB%E5%9E%8B-1"><span class="toc-number">4.2.</span> <span class="toc-text">基础类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E5%AD%97-Int-Float-1"><span class="toc-number">4.2.1.</span> <span class="toc-text">数字 Int, Float</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E6%95%B0-Bool-1"><span class="toc-number">4.2.2.</span> <span class="toc-text">布尔数 Bool</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%83%E7%BB%84-a-b-c-1"><span class="toc-number">4.2.3.</span> <span class="toc-text">元组 (a, b, c)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2-1"><span class="toc-number">4.2.4.</span> <span class="toc-text">字符串</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%9A%E4%B8%BE-1"><span class="toc-number">4.2.5.</span> <span class="toc-text">枚举</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%9B%E5%9E%8B%E5%92%8C%E5%8D%8F%E8%AE%AE"><span class="toc-number">4.2.6.</span> <span class="toc-text">泛型和协议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8D%E9%80%8F%E6%98%8E%E7%B1%BB%E5%9E%8B-1"><span class="toc-number">4.2.7.</span> <span class="toc-text">不透明类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Result-1"><span class="toc-number">4.2.8.</span> <span class="toc-text">Result</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2-1"><span class="toc-number">4.2.9.</span> <span class="toc-text">类型转换</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%92%8C%E7%BB%93%E6%9E%84%E4%BD%93-1"><span class="toc-number">4.3.</span> <span class="toc-text">类和结构体</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB-1"><span class="toc-number">4.3.1.</span> <span class="toc-text">类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E4%BD%93-1"><span class="toc-number">4.3.2.</span> <span class="toc-text">结构体</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7-1"><span class="toc-number">4.3.3.</span> <span class="toc-text">属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95-1"><span class="toc-number">4.3.4.</span> <span class="toc-text">方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF-1"><span class="toc-number">4.3.5.</span> <span class="toc-text">继承</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%BC%8F-1"><span class="toc-number">4.4.</span> <span class="toc-text">函数式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#map-1"><span class="toc-number">4.4.1.</span> <span class="toc-text">map</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#filter-1"><span class="toc-number">4.4.2.</span> <span class="toc-text">filter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#reduce-1"><span class="toc-number">4.4.3.</span> <span class="toc-text">reduce</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sorted-1"><span class="toc-number">4.4.4.</span> <span class="toc-text">sorted</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E6%B5%81-1"><span class="toc-number">4.5.</span> <span class="toc-text">控制流</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#If-%E2%80%A2-If-let-%E2%80%A2-If-case-let-1"><span class="toc-number">4.5.1.</span> <span class="toc-text">If • If let • If case let</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Guard-guard-guard-let-1"><span class="toc-number">4.5.2.</span> <span class="toc-text">Guard guard, guard let</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%81%8D%E5%8E%86-For-in-1"><span class="toc-number">4.5.3.</span> <span class="toc-text">遍历 For-in</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#While-while-repeat-while-1"><span class="toc-number">4.5.4.</span> <span class="toc-text">While while, repeat-while</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Switch-1"><span class="toc-number">4.5.5.</span> <span class="toc-text">Switch</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E5%90%88-1"><span class="toc-number">4.6.</span> <span class="toc-text">集合</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E7%BB%84-1-2-3-1"><span class="toc-number">4.6.1.</span> <span class="toc-text">数组 [1, 2, 3]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Sets-Set"><span class="toc-number">4.6.2.</span> <span class="toc-text">Sets Set</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E5%85%B8-1"><span class="toc-number">4.6.3.</span> <span class="toc-text">字典 [:]</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E7%AC%A6-1"><span class="toc-number">4.7.</span> <span class="toc-text">操作符</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B5%8B%E5%80%BC-x3D-x3D-x3D-x3D-x2F-x3D-1"><span class="toc-number">4.7.1.</span> <span class="toc-text">赋值 &#x3D;, +&#x3D;. -&#x3D;, *&#x3D;, &#x2F;&#x3D;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E7%AC%A6-x2F-1"><span class="toc-number">4.7.2.</span> <span class="toc-text">计算符 +, -, *, &#x2F;, %</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97%E7%AC%A6-x3D-x3D-gt-1"><span class="toc-number">4.7.3.</span> <span class="toc-text">比较运算符 &#x3D;&#x3D;, &gt;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E5%85%83-1"><span class="toc-number">4.7.4.</span> <span class="toc-text">三元 _ ? _ : _</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Nil-coalescing-1"><span class="toc-number">4.7.5.</span> <span class="toc-text">Nil-coalescing ??</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8C%83%E5%9B%B4-a%E2%80%A6b-1"><span class="toc-number">4.7.6.</span> <span class="toc-text">范围 a…b</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%BB%E8%BE%91-amp-amp-1"><span class="toc-number">4.7.7.</span> <span class="toc-text">逻辑 !, &amp;&amp;, ||</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%81%92%E7%AD%89-x3D-x3D-x3D-x3D-x3D-1"><span class="toc-number">4.7.8.</span> <span class="toc-text">恒等 &#x3D;&#x3D;&#x3D;, !&#x3D;&#x3D;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%90%E7%AE%97%E7%AC%A6-1"><span class="toc-number">4.7.9.</span> <span class="toc-text">运算符</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E5%BA%93-1"><span class="toc-number">4.8.</span> <span class="toc-text">基础库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%B6%E9%97%B4-1"><span class="toc-number">4.8.1.</span> <span class="toc-text">时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%BC%E5%BC%8F%E5%8C%96-1"><span class="toc-number">4.8.2.</span> <span class="toc-text">格式化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%A6%E9%87%8F%E5%80%BC-1"><span class="toc-number">4.8.3.</span> <span class="toc-text">度量值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Data-1"><span class="toc-number">4.8.4.</span> <span class="toc-text">Data</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6-1"><span class="toc-number">4.8.5.</span> <span class="toc-text">文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Scanner-1"><span class="toc-number">4.8.6.</span> <span class="toc-text">Scanner</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AttributeString-1"><span class="toc-number">4.8.7.</span> <span class="toc-text">AttributeString</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9A%8F%E6%9C%BA-1"><span class="toc-number">4.8.8.</span> <span class="toc-text">随机</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UserDefaults-1"><span class="toc-number">4.8.9.</span> <span class="toc-text">UserDefaults</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F-1"><span class="toc-number">4.9.</span> <span class="toc-text">模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E4%BE%8B-1"><span class="toc-number">4.9.1.</span> <span class="toc-text">单例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%8F%8A%E8%AE%BE%E5%A4%87-1"><span class="toc-number">4.10.</span> <span class="toc-text">系统及设备</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%88%A4%E6%96%AD-1"><span class="toc-number">4.10.1.</span> <span class="toc-text">系统判断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%88%E6%9C%AC%E5%85%BC%E5%AE%B9-1"><span class="toc-number">4.10.2.</span> <span class="toc-text">版本兼容</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#canImport-%E5%88%A4%E6%96%AD%E5%BA%93%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BD%BF%E7%94%A8-1"><span class="toc-number">4.10.3.</span> <span class="toc-text">canImport 判断库是否可使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#targetEnvironment-%E7%8E%AF%E5%A2%83%E7%9A%84%E5%88%A4%E6%96%AD-1"><span class="toc-number">4.10.4.</span> <span class="toc-text">targetEnvironment 环境的判断</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%B8%A6%E5%B1%9E%E6%80%A7%E5%8C%85%E8%A3%85-1"><span class="toc-number">4.11.</span> <span class="toc-text">自带属性包装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#resultBuilder-1"><span class="toc-number">4.11.1.</span> <span class="toc-text">@resultBuilder</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dynamicMemberLookup-%E5%8A%A8%E6%80%81%E6%88%90%E5%91%98%E6%9F%A5%E8%AF%A2-1"><span class="toc-number">4.11.2.</span> <span class="toc-text">@dynamicMemberLookup 动态成员查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dynamicCallable-%E5%8A%A8%E6%80%81%E5%8F%AF%E8%B0%83%E7%94%A8%E7%B1%BB%E5%9E%8B-1"><span class="toc-number">4.11.3.</span> <span class="toc-text">@dynamicCallable 动态可调用类型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%B8%A6%E5%8D%8F%E8%AE%AE-1"><span class="toc-number">4.12.</span> <span class="toc-text">自带协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Hashable-1"><span class="toc-number">4.12.1.</span> <span class="toc-text">Hashable</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Codable-1"><span class="toc-number">4.13.</span> <span class="toc-text">Codable</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#JSON-%E6%B2%A1%E6%9C%89-id-%E5%AD%97%E6%AE%B5-1"><span class="toc-number">4.13.1.</span> <span class="toc-text">JSON 没有 id 字段</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C-1"><span class="toc-number">4.14.</span> <span class="toc-text">网络</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E7%8A%B6%E6%80%81%E6%A3%80%E6%9F%A5-1"><span class="toc-number">4.14.1.</span> <span class="toc-text">网络状态检查</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E7%94%BB-1"><span class="toc-number">4.15.</span> <span class="toc-text">动画</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%83%E5%B1%80%E5%8A%A8%E7%94%BB-1"><span class="toc-number">4.15.1.</span> <span class="toc-text">布局动画</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8-1"><span class="toc-number">4.16.</span> <span class="toc-text">安全</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Keychain-1"><span class="toc-number">4.16.1.</span> <span class="toc-text">Keychain</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E7%A8%8B-1"><span class="toc-number">4.17.</span> <span class="toc-text">工程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%85%A5%E5%8F%A3%E7%82%B9-1"><span class="toc-number">4.17.1.</span> <span class="toc-text">程序入口点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7"><span class="toc-number">4.18.</span> <span class="toc-text">工具</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Swift-DocC"><span class="toc-number">4.18.1.</span> <span class="toc-text">Swift-DocC</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%93%E9%A2%98-1"><span class="toc-number">5.</span> <span class="toc-text">专题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Swift-%E9%82%A3%E4%BA%9B%E4%BA%8B-1"><span class="toc-number">5.1.</span> <span class="toc-text">Swift 那些事</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Swift-%E5%90%84%E7%89%88%E6%9C%AC%E6%BC%94%E8%BF%9B"><span class="toc-number">5.1.1.</span> <span class="toc-text">Swift 各版本演进</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-1-1"><span class="toc-number">5.1.1.1.</span> <span class="toc-text">Swift 1.1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-1-2"><span class="toc-number">5.1.1.2.</span> <span class="toc-text">Swift 1.2</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-2-0"><span class="toc-number">5.1.1.3.</span> <span class="toc-text">Swift 2.0</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-2-1"><span class="toc-number">5.1.1.4.</span> <span class="toc-text">Swift 2.1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-3-0"><span class="toc-number">5.1.1.5.</span> <span class="toc-text">Swift 3.0</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-3-1"><span class="toc-number">5.1.1.6.</span> <span class="toc-text">Swift 3.1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-4-0"><span class="toc-number">5.1.1.7.</span> <span class="toc-text">Swift 4.0</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-4-1"><span class="toc-number">5.1.1.8.</span> <span class="toc-text">Swift 4.1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-4-2"><span class="toc-number">5.1.1.9.</span> <span class="toc-text">Swift 4.2</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-5-0"><span class="toc-number">5.1.1.10.</span> <span class="toc-text">Swift 5.0</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-5-1"><span class="toc-number">5.1.1.11.</span> <span class="toc-text">Swift 5.1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-5-2"><span class="toc-number">5.1.1.12.</span> <span class="toc-text">Swift 5.2</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-5-3"><span class="toc-number">5.1.1.13.</span> <span class="toc-text">Swift 5.3</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-5-4"><span class="toc-number">5.1.1.14.</span> <span class="toc-text">Swift 5.4</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-5-5"><span class="toc-number">5.1.1.15.</span> <span class="toc-text">Swift 5.5</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-5-6"><span class="toc-number">5.1.1.16.</span> <span class="toc-text">Swift 5.6</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-5-7"><span class="toc-number">5.1.1.17.</span> <span class="toc-text">Swift 5.7</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%84%E8%8C%83"><span class="toc-number">5.2.</span> <span class="toc-text">规范</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">5.2.1.</span> <span class="toc-text">注意事项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B5%84%E6%96%99%E6%8E%A8%E8%8D%90"><span class="toc-number">5.3.</span> <span class="toc-text">资料推荐</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B9%A6%E5%8D%95"><span class="toc-number">5.3.1.</span> <span class="toc-text">书单</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E6%96%B9%E5%BA%93%E4%BD%BF%E7%94%A8"><span class="toc-number">5.4.</span> <span class="toc-text">三方库使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SQLite-swift-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">5.4.1.</span> <span class="toc-text">SQLite.swift 的使用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#macOS"><span class="toc-number">5.5.</span> <span class="toc-text">macOS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8C%83%E4%BE%8B"><span class="toc-number">5.5.1.</span> <span class="toc-text">范例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E6%A0%8F%E7%BB%93%E6%9E%84"><span class="toc-number">5.5.2.</span> <span class="toc-text">三栏结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A8%E5%B1%8F%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.5.3.</span> <span class="toc-text">全屏模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B1%E4%BA%AB%E8%8F%9C%E5%8D%95"><span class="toc-number">5.5.4.</span> <span class="toc-text">共享菜单</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%AA%E8%B4%B4%E6%9D%BF"><span class="toc-number">5.5.5.</span> <span class="toc-text">剪贴板</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E5%92%8C%E6%9E%84%E5%BB%BA"><span class="toc-number">5.6.</span> <span class="toc-text">性能和构建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E8%AF%95"><span class="toc-number">5.6.1.</span> <span class="toc-text">调试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"><span class="toc-number">5.6.2.</span> <span class="toc-text">内存管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%93%BE%E6%8E%A5%E5%99%A8"><span class="toc-number">5.6.3.</span> <span class="toc-text">链接器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2022%E5%B9%B4-Apple-%E6%80%A7%E8%83%BD%E6%9B%B4%E6%96%B0"><span class="toc-number">5.6.4.</span> <span class="toc-text">2022年 Apple 性能更新</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Combine"><span class="toc-number">6.</span> <span class="toc-text">Combine</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">6.1.</span> <span class="toc-text">介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Combine-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">6.1.1.</span> <span class="toc-text">Combine 是什么？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Combine-%E8%B5%84%E6%96%99"><span class="toc-number">6.1.2.</span> <span class="toc-text">Combine 资料</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E"><span class="toc-number">6.2.</span> <span class="toc-text">使用说明</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#publisher"><span class="toc-number">6.2.1.</span> <span class="toc-text">publisher</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Just"><span class="toc-number">6.2.2.</span> <span class="toc-text">Just</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PassthroughSubject"><span class="toc-number">6.2.3.</span> <span class="toc-text">PassthroughSubject</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Empty"><span class="toc-number">6.2.4.</span> <span class="toc-text">Empty</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CurrentValueSubject"><span class="toc-number">6.2.5.</span> <span class="toc-text">CurrentValueSubject</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#removeDuplicates"><span class="toc-number">6.2.6.</span> <span class="toc-text">removeDuplicates</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#flatMap"><span class="toc-number">6.2.7.</span> <span class="toc-text">flatMap</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#append"><span class="toc-number">6.2.8.</span> <span class="toc-text">append</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#prepend"><span class="toc-number">6.2.9.</span> <span class="toc-text">prepend</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#merge"><span class="toc-number">6.2.10.</span> <span class="toc-text">merge</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#zip"><span class="toc-number">6.2.11.</span> <span class="toc-text">zip</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#combineLatest"><span class="toc-number">6.2.12.</span> <span class="toc-text">combineLatest</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Scheduler"><span class="toc-number">6.2.13.</span> <span class="toc-text">Scheduler</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">6.3.</span> <span class="toc-text">使用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82"><span class="toc-number">6.3.1.</span> <span class="toc-text">网络请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#KVO"><span class="toc-number">6.3.2.</span> <span class="toc-text">KVO</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E7%9F%A5"><span class="toc-number">6.3.3.</span> <span class="toc-text">通知</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Timer"><span class="toc-number">6.3.4.</span> <span class="toc-text">Timer</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Concurrency"><span class="toc-number">7.</span> <span class="toc-text">Concurrency</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-1"><span class="toc-number">7.1.</span> <span class="toc-text">介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Swift-Concurrency-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">7.1.1.</span> <span class="toc-text">Swift Concurrency 是什么？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#async-x2F-await"><span class="toc-number">7.1.2.</span> <span class="toc-text">async&#x2F;await</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Async-Sequences"><span class="toc-number">7.1.3.</span> <span class="toc-text">Async Sequences</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E5%8C%96%E5%B9%B6%E5%8F%91"><span class="toc-number">7.1.4.</span> <span class="toc-text">结构化并发</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Actors"><span class="toc-number">7.1.5.</span> <span class="toc-text">Actors</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Distributed-Actors"><span class="toc-number">7.1.6.</span> <span class="toc-text">Distributed Actors</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%8F%90%E6%A1%88"><span class="toc-number">7.1.7.</span> <span class="toc-text">相关提案</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%A6%E4%B9%A0%E8%B7%AF%E5%BE%84"><span class="toc-number">7.1.8.</span> <span class="toc-text">学习路径</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Swift-Concurrency-%E5%92%8C-Combine"><span class="toc-number">7.1.9.</span> <span class="toc-text">Swift Concurrency 和 Combine</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Concurrency-5-7-%E7%89%88%E6%9C%AC%E6%9B%B4%E6%96%B0"><span class="toc-number">7.1.10.</span> <span class="toc-text">Concurrency 5.7 版本更新</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SwiftUI"><span class="toc-number">8.</span> <span class="toc-text">SwiftUI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-2"><span class="toc-number">8.1.</span> <span class="toc-text">介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SwiftUI-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">8.1.1.</span> <span class="toc-text">SwiftUI 是什么？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SwiftUI-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">8.1.2.</span> <span class="toc-text">SwiftUI 参考资料</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8"><span class="toc-number">8.2.</span> <span class="toc-text">视图组件使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SwiftUI-%E5%AF%B9%E6%A0%87%E7%9A%84-UIKit-%E8%A7%86%E5%9B%BE"><span class="toc-number">8.2.1.</span> <span class="toc-text">SwiftUI 对标的 UIKit 视图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Text"><span class="toc-number">8.2.2.</span> <span class="toc-text">Text</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Link"><span class="toc-number">8.2.3.</span> <span class="toc-text">Link</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Label"><span class="toc-number">8.2.4.</span> <span class="toc-text">Label</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TextEditor"><span class="toc-number">8.2.5.</span> <span class="toc-text">TextEditor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TextField"><span class="toc-number">8.2.6.</span> <span class="toc-text">TextField</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Button"><span class="toc-number">8.2.7.</span> <span class="toc-text">Button</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9B%E5%BA%A6"><span class="toc-number">8.2.8.</span> <span class="toc-text">进度</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Image"><span class="toc-number">8.2.9.</span> <span class="toc-text">Image</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ControlGroup"><span class="toc-number">8.2.10.</span> <span class="toc-text">ControlGroup</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GroupBox"><span class="toc-number">8.2.11.</span> <span class="toc-text">GroupBox</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Stack"><span class="toc-number">8.2.12.</span> <span class="toc-text">Stack</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Advanced-layout-control"><span class="toc-number">8.2.13.</span> <span class="toc-text">Advanced layout control</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Navigation"><span class="toc-number">8.2.14.</span> <span class="toc-text">Navigation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#List"><span class="toc-number">8.2.15.</span> <span class="toc-text">List</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LazyVStack-%E5%92%8C-LazyHStack"><span class="toc-number">8.2.16.</span> <span class="toc-text">LazyVStack 和 LazyHStack</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LazyVGrid-%E5%92%8C-LazyHGrid"><span class="toc-number">8.2.17.</span> <span class="toc-text">LazyVGrid 和 LazyHGrid</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#table"><span class="toc-number">8.2.18.</span> <span class="toc-text">table</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ScrollView"><span class="toc-number">8.2.19.</span> <span class="toc-text">ScrollView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%AE%E5%B1%82"><span class="toc-number">8.2.20.</span> <span class="toc-text">浮层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TabView"><span class="toc-number">8.2.21.</span> <span class="toc-text">TabView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Swift-Charts"><span class="toc-number">8.2.22.</span> <span class="toc-text">Swift Charts</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Toggle"><span class="toc-number">8.2.23.</span> <span class="toc-text">Toggle</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Picker"><span class="toc-number">8.2.24.</span> <span class="toc-text">Picker</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Slider"><span class="toc-number">8.2.25.</span> <span class="toc-text">Slider</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Stepper"><span class="toc-number">8.2.26.</span> <span class="toc-text">Stepper</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Form"><span class="toc-number">8.2.27.</span> <span class="toc-text">Form</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Keyboard"><span class="toc-number">8.2.28.</span> <span class="toc-text">Keyboard</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Transferable"><span class="toc-number">8.2.29.</span> <span class="toc-text">Transferable</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ShareLink"><span class="toc-number">8.2.30.</span> <span class="toc-text">ShareLink</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E8%A7%89"><span class="toc-number">8.3.</span> <span class="toc-text">视觉</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Color"><span class="toc-number">8.3.1.</span> <span class="toc-text">Color</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Effect"><span class="toc-number">8.3.2.</span> <span class="toc-text">Effect</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Animation"><span class="toc-number">8.3.3.</span> <span class="toc-text">Animation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Canvas"><span class="toc-number">8.3.4.</span> <span class="toc-text">Canvas</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SF-Symbol"><span class="toc-number">8.3.5.</span> <span class="toc-text">SF Symbol</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E8%80%85"><span class="toc-number">9.</span> <span class="toc-text">开发者</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Swift%E5%AE%98%E6%96%B9"><span class="toc-number">9.1.</span> <span class="toc-text">Swift官方</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BE%E5%8C%BA"><span class="toc-number">9.2.</span> <span class="toc-text">社区</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A2%E7%B4%A2%E5%BA%93"><span class="toc-number">10.</span> <span class="toc-text">探索库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E9%B2%9C%E4%BA%8B"><span class="toc-number">10.1.</span> <span class="toc-text">新鲜事</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E6%98%93%E7%94%A8%E5%8A%9F%E8%83%BD"><span class="toc-number">10.2.</span> <span class="toc-text">封装易用功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SwiftUI-%E6%89%A9%E5%B1%95"><span class="toc-number">10.3.</span> <span class="toc-text">SwiftUI 扩展</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E7%89%87"><span class="toc-number">10.4.</span> <span class="toc-text">图片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E5%AD%97%E5%A4%84%E7%90%86"><span class="toc-number">10.5.</span> <span class="toc-text">文字处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E7%94%BB-2"><span class="toc-number">10.6.</span> <span class="toc-text">动画</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8"><span class="toc-number">10.7.</span> <span class="toc-text">持久化存储</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E8%8C%83%E5%BC%8F"><span class="toc-number">10.8.</span> <span class="toc-text">编程范式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1"><span class="toc-number">10.9.</span> <span class="toc-text">路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E6%A3%80%E6%9F%A5"><span class="toc-number">10.10.</span> <span class="toc-text">静态检查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E8%83%BD%E5%8A%9B"><span class="toc-number">10.11.</span> <span class="toc-text">系统能力</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3"><span class="toc-number">10.12.</span> <span class="toc-text">接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%BA%94%E7%94%A8"><span class="toc-number">10.13.</span> <span class="toc-text">接口应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#macOS-1"><span class="toc-number">10.14.</span> <span class="toc-text">macOS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8"><span class="toc-number">10.15.</span> <span class="toc-text">应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%B8%E6%88%8F"><span class="toc-number">10.16.</span> <span class="toc-text">游戏</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E6%8A%80%E6%9C%AF%E5%B1%95%E7%A4%BA"><span class="toc-number">10.17.</span> <span class="toc-text">新技术展示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Combine-%E6%89%A9%E5%B1%95"><span class="toc-number">10.18.</span> <span class="toc-text">Combine 扩展</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%9A%E5%90%88"><span class="toc-number">10.19.</span> <span class="toc-text">聚合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E3%80%81%E5%B7%A5%E7%A8%8B%E6%9E%84%E5%BB%BA%E5%8F%8A%E8%87%AA%E5%8A%A8%E5%8C%96"><span class="toc-number">10.20.</span> <span class="toc-text">性能、工程构建及自动化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">10.21.</span> <span class="toc-text">测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C-2"><span class="toc-number">10.22.</span> <span class="toc-text">网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E5%BD%A2"><span class="toc-number">10.23.</span> <span class="toc-text">图形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9F%B3%E8%A7%86%E9%A2%91"><span class="toc-number">10.24.</span> <span class="toc-text">音视频</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8-2"><span class="toc-number">10.25.</span> <span class="toc-text">安全</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Web"><span class="toc-number">10.26.</span> <span class="toc-text">Web</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">10.27.</span> <span class="toc-text">服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F"><span class="toc-number">10.28.</span> <span class="toc-text">系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Web-3-0"><span class="toc-number">10.29.</span> <span class="toc-text">Web 3.0</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Apple"><span class="toc-number">10.30.</span> <span class="toc-text">Apple</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6"><span class="toc-number">10.31.</span> <span class="toc-text">计算机科学</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E7%9F%A5%E8%AF%86"><span class="toc-number">10.32.</span> <span class="toc-text">扩展知识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%85%E5%88%86%E7%B1%BB"><span class="toc-number">10.33.</span> <span class="toc-text">待分类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%9A%E5%AE%A2%E5%92%8C%E8%B5%84%E8%AE%AF"><span class="toc-number">11.</span> <span class="toc-text">博客和资讯</span></a></li></ol>
      </div>
    </article>
  
  
  <article class="card card-content categories-widget">
    <div class="categories-card">
  <div class="categories-header">
    <i 
      class="iconfont icon-fenlei" 
      style="padding-right: 2px;">
    </i>Categories
  </div>
  <div class="categories-list">
    
      <a href="/categories/Programming/">
        <div class="categories-list-item">
          Programming
          <span class="categories-list-item-badge">44</span>
        </div>
      </a>
    
      <a href="/categories/My-novel/">
        <div class="categories-list-item">
          My-novel
          <span class="categories-list-item-badge">4</span>
        </div>
      </a>
    
      <a href="/categories/My-painting/">
        <div class="categories-list-item">
          My-painting
          <span class="categories-list-item-badge">8</span>
        </div>
      </a>
    
      <a href="/categories/travel/">
        <div class="categories-list-item">
          travel
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/categories/APP/">
        <div class="categories-list-item">
          APP
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
  </div>
</div>
  </article>
  
  <article class="card card-content tags-widget">
    <div class="tags-card">
  <div class="tags-header">
    <i 
      class="iconfont icon-biaoqian" 
      style="padding-right: 2px;">
    </i>hot tags
  </div>
  <div class="tags-list">
    
      <a 
        href="/tags/iOS/" 
        title="iOS">
        <div class="tags-list-item">iOS</div>
      </a>
    
      <a 
        href="/tags/Swift/" 
        title="Swift">
        <div class="tags-list-item">Swift</div>
      </a>
    
      <a 
        href="/tags/Painting/" 
        title="Painting">
        <div class="tags-list-item">Painting</div>
      </a>
    
      <a 
        href="/tags/Apple/" 
        title="Apple">
        <div class="tags-list-item">Apple</div>
      </a>
    
      <a 
        href="/tags/Slides/" 
        title="Slides">
        <div class="tags-list-item">Slides</div>
      </a>
    
      <a 
        href="/tags/iPad/" 
        title="iPad">
        <div class="tags-list-item">iPad</div>
      </a>
    
      <a 
        href="/tags/Procreate/" 
        title="Procreate">
        <div class="tags-list-item">Procreate</div>
      </a>
    
      <a 
        href="/tags/LLVM/" 
        title="LLVM">
        <div class="tags-list-item">LLVM</div>
      </a>
    
      <a 
        href="/tags/Web/" 
        title="Web">
        <div class="tags-list-item">Web</div>
      </a>
    
      <a 
        href="/tags/Novel/" 
        title="Novel">
        <div class="tags-list-item">Novel</div>
      </a>
    
      <a 
        href="/tags/SwiftUI/" 
        title="SwiftUI">
        <div class="tags-list-item">SwiftUI</div>
      </a>
    
      <a 
        href="/tags/macOS/" 
        title="macOS">
        <div class="tags-list-item">macOS</div>
      </a>
    
      <a 
        href="/tags/%E7%BC%96%E8%AF%91/" 
        title="编译">
        <div class="tags-list-item">编译</div>
      </a>
    
      <a 
        href="/tags/WWDC/" 
        title="WWDC">
        <div class="tags-list-item">WWDC</div>
      </a>
    
      <a 
        href="/tags/ReactiveCocoa/" 
        title="ReactiveCocoa">
        <div class="tags-list-item">ReactiveCocoa</div>
      </a>
    
      <a 
        href="/tags/GOT/" 
        title="GOT">
        <div class="tags-list-item">GOT</div>
      </a>
    
  </div>
</div>
  </article>
  
  
</div>
            </aside>
            <main class="main-column">
              
  <div class="image-wrapper">
    <img 
      src="https://user-images.githubusercontent.com/251980/152918704-9522eb27-9304-4788-b4ed-72ffb170e1bc.png" 
      data-src="https://user-images.githubusercontent.com/251980/152918704-9522eb27-9304-4788-b4ed-72ffb170e1bc.png"
      srcset="data:image/svg+xml,%3Csvg%20xmlns=&#39;http://www.w3.org/2000/svg&#39;%20viewBox=&#39;0%200%20300%20300&#39;%3E%3C/svg%3E"
      class="image lozad"
      alt="戴铭的 Swift 小册子 5.0 thumbnail">
  </div>

<article class="card card-content">
  <header>
    <h1 class="post-title">
      戴铭的 Swift 小册子 5.0
    </h1>
  </header>
  <div class="post-meta post-show-meta">
    <time datetime="2021-11-23T08:28:18.000Z">
      <i 
        class="iconfont icon-calendar" 
        style="margin-right: 2px;">
      </i>
      <span>2021-11-23</span>
    </time>
    
      <span class="dot"></span>
      
        <a 
          href="/categories/Programming/" 
          class="post-meta-link">
          Programming
        </a>
      
    
    
      <span class="dot"></span>
      <span>59.6k words</span>
    
  </div>
  
    <div 
      class="post-meta post-show-meta" 
      style="margin-top: -10px;">
      <div style="display: flex; align-items: center;">
        <i 
          class="iconfont icon-biaoqian" 
          style="margin-right: 2px; font-size: 1.15rem;">
        </i>
        
          
          <a 
            href="/tags/iOS/" 
            class="post-meta-link">
            iOS
          </a>
        
          
            <span class="dot"></span>
          
          <a 
            href="/tags/Apple/" 
            class="post-meta-link">
            Apple
          </a>
        
          
            <span class="dot"></span>
          
          <a 
            href="/tags/Swift/" 
            class="post-meta-link">
            Swift
          </a>
        
      </div>
    </div>
  
  </header>
  <div 
    id="section" 
    class="post-content">
    <p>update：内容已更新到 5.0 版本。新增 WWDC22 内容。</p>
<blockquote>
<p>新dyld源码透出近期苹果出新系统必然，依苹果 taste，势必要用好技术抛落后技术。漫漫长假我完善了Swift手册内容，字数达到十五万字，内容已压缩压缩再压缩，求全存简，more big, so small 。满满诚意，望有用、值得收藏、求转发。</p>
<p>come on and learn (੭*ˊᵕˋ)੭</p>
<p>– 戴·代码之使徒·画终结者·被光选中的人·铭</p>
</blockquote>
<h2 id="背景说明"><a href="#背景说明" class="headerlink" title="背景说明"></a>背景说明</h2><p>越来越多同学打算开始用 Swift 来开发了，可很多人以前都没接触过 Swift。这篇和我以前文章不同的是，本篇只是面向 Swift 零基础的同学，内容主要是一些直接可用的小例子，例子可以直接在工程中用或自己调试着看。</p>
<p>记得以前 PHP 有个 chm 的手册，写的很简单，但很全，每个知识点都有例子，社区版每个知识点下面还有留言互动。因此，我弄了个 Swift 的手册，是个 macOS 程序。建议使用我开发的这个 macOS 程序来浏览。源码地址：<a target="_blank" rel="noopener" href="https://github.com/ming1016/Brochure">ming1016&#x2F;Brochure</a>，直接下载 dmg 地址：<a target="_blank" rel="noopener" href="https://github.com/KwaiAppTeam/SwiftPamphletApp/files/9052632/5.0.dmg.zip">戴铭的小册子5.0.dmg.zip</a></p>
<p><img  srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://user-images.githubusercontent.com/251980/152918704-9522eb27-9304-4788-b4ed-72ffb170e1bc.png" class="lozad post-image"src="https://user-images.githubusercontent.com/251980/152918704-9522eb27-9304-4788-b4ed-72ffb170e1bc.png"></p>
<p>这个程序是Swift写的，按照声明式UI，响应式编程范式开发的，源码也可以看看。与其讲一堆，不如调着试。</p>
<p>下面是文本内容。注：代码中简化变量名是为了能更快速关注到语言用法。</p>
<h2 id="语法速查"><a href="#语法速查" class="headerlink" title="语法速查"></a>语法速查</h2><h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><h4 id="变量-let-var"><a href="#变量-let-var" class="headerlink" title="变量 let, var"></a>变量 let, var</h4><p>变量是可变的，使用 var 修饰，常量是不可变的，使用 let 修饰。类、结构体和枚举里的变量是属性。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">var</span> v1<span class="token punctuation">:</span><span class="token class-name">String</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"hi"</span></span> <span class="token comment">// 标注类型</span>
<span class="token keyword">var</span> v2 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"类型推导"</span></span>
<span class="token keyword">let</span> l1 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"标题"</span></span> <span class="token comment">// 常量</span>

<span class="token keyword">class</span> a <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token number">3</span>
    <span class="token keyword">var</span> p2<span class="token punctuation">:</span> <span class="token class-name">Int</span> <span class="token punctuation">&#123;</span>
        p1 <span class="token operator">*</span> <span class="token number">3</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>属性没有 set 可以省略 get，如果有 set 需加 get。变量设置前通过 willSet 访问到，变量设置后通过 didSet 访问。</p>
<h4 id="打印-print-“”"><a href="#打印-print-“”" class="headerlink" title="打印 print(“”)"></a>打印 print(“”)</h4><p>控制台打印值</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"hi"</span></span><span class="token punctuation">)</span>
<span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">14</span>
<span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"9月</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">是小柠檬的生日"</span></span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">...</span><span class="token number">3</span><span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// output:</span>
<span class="token comment">// 1</span>
<span class="token comment">// 2</span>
<span class="token comment">// 3</span>

<span class="token comment">// 使用terminator使循环打印更整洁</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">...</span><span class="token number">3</span> <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> "</span></span><span class="token punctuation">,</span> terminator<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// output:</span>
<span class="token comment">// 1 2 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="注释-x2F-x2F"><a href="#注释-x2F-x2F" class="headerlink" title="注释 &#x2F;&#x2F;"></a>注释 &#x2F;&#x2F;</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 单行注释</span>
<span class="token comment">/*
多行注释第一行。
多行注释第二行。
*/</span> 
<span class="token comment">// MARK: 会在 minimap 上展示</span>
<span class="token comment">// TODO: 待做</span>
<span class="token comment">// FIXME: 待修复</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="可选"><a href="#可选" class="headerlink" title="可选 ?, !"></a>可选 ?, !</h4><p>可能会是 nil 的变量就是可选变量。当变量为 nil 通过??操作符可以提供一个默认值。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">var</span> o<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token operator">?</span> <span class="token operator">=</span> <span class="token nil constant">nil</span>
<span class="token keyword">let</span> i <span class="token operator">=</span> o <span class="token operator">??</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<h4 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h4><p>闭包也可以叫做 lambda，是匿名函数，对应 OC 的 block。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> a1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span>by<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">(</span>l<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">,</span> r<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Bool</span> <span class="token keyword">in</span>
    <span class="token keyword">return</span> l <span class="token operator">&lt;</span> r
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token comment">// 如果闭包是唯一的参数并在表达式最后可以使用结尾闭包语法，写法简化为</span>
<span class="token keyword">let</span> a2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>sorted <span class="token punctuation">&#123;</span> <span class="token punctuation">(</span>l<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">,</span> r<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Bool</span> <span class="token keyword">in</span>
    <span class="token keyword">return</span> l <span class="token operator">&lt;</span> r
<span class="token punctuation">&#125;</span>
<span class="token comment">// 已知类型可以省略</span>
<span class="token keyword">let</span> a3 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>sorted <span class="token punctuation">&#123;</span> l<span class="token punctuation">,</span> r <span class="token keyword">in</span>
    <span class="token keyword">return</span> l <span class="token operator">&lt;</span> r
<span class="token punctuation">&#125;</span>
<span class="token comment">// 通过位置来使用闭包的参数，最后简化如下：</span>
<span class="token keyword">let</span> a4 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>sorted <span class="token punctuation">&#123;</span> <span class="token short-argument">$0</span> <span class="token operator">&lt;</span> <span class="token short-argument">$1</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>函数也是闭包的一种，函数的参数也可以是闭包。@escaping 表示逃逸闭包，逃逸闭包是可以在函数返回之后继续调用的。@autoclosure 表示自动闭包，可以用来省略花括号。</p>
<h4 id="函数-func"><a href="#函数-func" class="headerlink" title="函数 func"></a>函数 func</h4><p>函数可以作为另一个函数的参数，也可以作为另一个函数的返回。函数是特殊的闭包，在类、结构体和枚举中是方法。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 为参数设置默认值</span>
<span class="token keyword">func</span> <span class="token function-definition function">f1</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"p"</span></span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
    <span class="token string-literal"><span class="token string">"p is </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">p</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 函数作为参数</span>
<span class="token keyword">func</span> <span class="token function-definition function">f2</span><span class="token punctuation">(</span>fn<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span><span class="token punctuation">,</span> p<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">f2</span><span class="token punctuation">(</span>fn<span class="token punctuation">:</span>f1<span class="token punctuation">,</span> p<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"d"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// p is d</span>

<span class="token comment">// 函数作为返回值</span>
<span class="token keyword">func</span> <span class="token function-definition function">f3</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> f1
<span class="token punctuation">&#125;</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">f3</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"yes"</span></span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"no"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// p is no</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>函数可以返回多个值，函数是可以嵌套的，也就是函数里内可以定义函数，函数内定义的函数可以访问自己作用域外函数内的变量。inout 表示的是输入输出参数，函数可以在函数内改变输入输出参数。defer 标识的代码块会在函数返回之前执行。</p>
<p>函数在 Swift 5.4 时开始有了使用多个变量参数的能力，使用方法如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">func</span> <span class="token function-definition function">f4</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token operator">...</span><span class="token punctuation">,</span> i<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token operator">...</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token function">f4</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"three"</span></span><span class="token punctuation">,</span> i<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token comment">/// ["one", "two", "three"]</span>
<span class="token comment">/// [1, 2, 3]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>嵌套函数可以重载，嵌套函数可以在声明函数之前调用他。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">func</span> <span class="token function-definition function">f5</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">nf5</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">func</span> <span class="token function-definition function">nf5</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"this is nested function"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">f5</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// this is nested function</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="访问控制"><a href="#访问控制" class="headerlink" title="访问控制"></a>访问控制</h4><p>在 Xcode 里的 target 就是模块，使用 import 可导入模块。模块内包含源文件，每个源文件里可以有多个类、结构体、枚举和函数等多种类型。访问级别可以通过一些关键字描述，分为如下几种：</p>
<ul>
<li>open：在模块外可以调用和继承。</li>
<li>public：在模块外可调用不可继承，open 只适用类和类成员。</li>
<li>internal：默认级别，模块内可跨源文件调用，模块外不可调用。</li>
<li>fileprivate：只能在源文件内访问。</li>
<li>private：只能在所在的作用域内访问。</li>
</ul>
<p>重写继承类的成员，可以设置成员比父类的这个成员更高的访问级别。Setter 的级别可以低于对应的 Getter 的级别，比如设置 Setter 访问级别为 private，可以在属性使用 private(set) 来修饰。</p>
<h3 id="基础类型"><a href="#基础类型" class="headerlink" title="基础类型"></a>基础类型</h3><h4 id="数字-Int-Float"><a href="#数字-Int-Float" class="headerlink" title="数字 Int, Float"></a>数字 Int, Float</h4><p>数字的类型有 Int、Float 和 Double</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// Int</span>
<span class="token keyword">let</span> i1 <span class="token operator">=</span> <span class="token number">100</span>
<span class="token keyword">let</span> i2 <span class="token operator">=</span> <span class="token number">22</span>
<span class="token function">print</span><span class="token punctuation">(</span>i1 <span class="token operator">/</span> i2<span class="token punctuation">)</span> <span class="token comment">// 向下取整得 4</span>

<span class="token comment">// Float</span>
<span class="token keyword">let</span> f1<span class="token punctuation">:</span> <span class="token class-name">Float</span> <span class="token operator">=</span> <span class="token number">100.0</span>
<span class="token keyword">let</span> f2<span class="token punctuation">:</span> <span class="token class-name">Float</span> <span class="token operator">=</span> <span class="token number">22.0</span>
<span class="token function">print</span><span class="token punctuation">(</span>f1 <span class="token operator">/</span> f2<span class="token punctuation">)</span> <span class="token comment">// 4.5454545</span>

<span class="token keyword">let</span> f3<span class="token punctuation">:</span> <span class="token class-name">Float16</span> <span class="token operator">=</span> <span class="token number">5.0</span> <span class="token comment">// macOS 还不能用</span>
<span class="token keyword">let</span> f4<span class="token punctuation">:</span> <span class="token class-name">Float32</span> <span class="token operator">=</span> <span class="token number">5.0</span>
<span class="token keyword">let</span> f5<span class="token punctuation">:</span> <span class="token class-name">Float64</span> <span class="token operator">=</span> <span class="token number">5.0</span>
<span class="token keyword">let</span> f6<span class="token punctuation">:</span> <span class="token class-name">Float80</span> <span class="token operator">=</span> <span class="token number">5.0</span>
<span class="token function">print</span><span class="token punctuation">(</span>f4<span class="token punctuation">,</span> f5<span class="token punctuation">,</span> f6<span class="token punctuation">)</span> <span class="token comment">// 5.0 5.0 5.0</span>

<span class="token comment">// Double</span>
<span class="token keyword">let</span> d1<span class="token punctuation">:</span> <span class="token class-name">Double</span> <span class="token operator">=</span> <span class="token number">100.0</span>
<span class="token keyword">let</span> d2<span class="token punctuation">:</span> <span class="token class-name">Double</span> <span class="token operator">=</span> <span class="token number">22.0</span>
<span class="token function">print</span><span class="token punctuation">(</span>d1 <span class="token operator">/</span> d2<span class="token punctuation">)</span> <span class="token comment">// 4.545454545454546</span>

<span class="token comment">// 字面量</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Int</span><span class="token punctuation">(</span><span class="token number">0b10101</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 0b 开头是二进制 </span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Int</span><span class="token punctuation">(</span><span class="token number">0x00afff</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 0x 开头是十六进制</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token number">2.5e4</span><span class="token punctuation">)</span> <span class="token comment">// 2.5x10^4 十进制用 e</span>
<span class="token function">print</span><span class="token punctuation">(</span>0xAp2<span class="token punctuation">)</span> <span class="token comment">// 10*2^2  十六进制用 p</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token number">2_000_000</span><span class="token punctuation">)</span> <span class="token comment">// 2000000</span>

<span class="token comment">// isMultiple(of:) 方法检查一个数字是否是另一个数字的倍数</span>
<span class="token keyword">let</span> i3 <span class="token operator">=</span> <span class="token number">36</span>
<span class="token function">print</span><span class="token punctuation">(</span>i3<span class="token punctuation">.</span><span class="token function">isMultiple</span><span class="token punctuation">(</span>of<span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>处理数字有 floor、ceil、round。floor 是向下取整，只取整数部分；cell 是向上取整，只要有不为零的小数，整数就加1;round 是四舍五入。       </p>
<h4 id="布尔数-Bool"><a href="#布尔数-Bool" class="headerlink" title="布尔数 Bool"></a>布尔数 Bool</h4><p>布尔数有 true 和 false 两种值，还有一个能够切换这两个值的 toggle 方法。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token boolean">false</span>
b<span class="token punctuation">.</span><span class="token function">toggle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
b<span class="token punctuation">.</span><span class="token function">toggle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<h4 id="元组-a-b-c"><a href="#元组-a-b-c" class="headerlink" title="元组 (a, b, c)"></a>元组 (a, b, c)</h4><p>元组里的值类型可以是不同的。元组可以看成是匿名的结构体。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> t1 <span class="token operator">=</span> <span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">,</span> p3<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>t1<span class="token punctuation">.</span>p1<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>t1<span class="token punctuation">.</span>p3<span class="token punctuation">)</span>

<span class="token comment">// 类型推导</span>
<span class="token keyword">let</span> t2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// 通过下标访问</span>
<span class="token function">print</span><span class="token punctuation">(</span>t2<span class="token punctuation">.</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// two</span>

<span class="token comment">// 分解元组</span>
<span class="token keyword">let</span> <span class="token punctuation">(</span>dp1<span class="token punctuation">,</span> dp2<span class="token punctuation">,</span> <span class="token omit keyword">_</span><span class="token punctuation">)</span> <span class="token operator">=</span> t2
<span class="token function">print</span><span class="token punctuation">(</span>dp1<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>dp2<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"Hi! This is a string. Cool?"</span></span>

<span class="token comment">/// 转义符 \n 表示换行。</span>
<span class="token comment">/// 其它转义字符有 \0 空字符)、\t 水平制表符 、\n 换行符、\r 回车符</span>
<span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"Hi!\nThis is a string. Cool?"</span></span>

<span class="token comment">// 多行</span>
<span class="token keyword">let</span> s3 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"""
Hi!
This is a string.
Cool?
"""</span></span>

<span class="token comment">// 长度</span>
<span class="token function">print</span><span class="token punctuation">(</span>s3<span class="token punctuation">.</span>count<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>s3<span class="token punctuation">.</span>isEmpty<span class="token punctuation">)</span>

<span class="token comment">// 拼接</span>
<span class="token function">print</span><span class="token punctuation">(</span>s3 <span class="token operator">+</span> <span class="token string-literal"><span class="token string">"\nSure!"</span></span><span class="token punctuation">)</span>

<span class="token comment">// 字符串中插入变量</span>
<span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Today is good day, double </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">!"</span></span><span class="token punctuation">)</span>

<span class="token comment">/// 遍历字符串</span>
<span class="token comment">/// 输出：</span>
<span class="token comment">/// o</span>
<span class="token comment">/// n</span>
<span class="token comment">/// e</span>
<span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token string-literal"><span class="token string">"one"</span></span> <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 查找</span>
<span class="token function">print</span><span class="token punctuation">(</span>s3<span class="token punctuation">.</span><span class="token function">lowercased</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"cool"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>

<span class="token comment">// 替换</span>
<span class="token keyword">let</span> s4 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"one is two"</span></span>
<span class="token keyword">let</span> newS4 <span class="token operator">=</span> s4<span class="token punctuation">.</span><span class="token function">replacingOccurrences</span><span class="token punctuation">(</span>of<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">,</span> with<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>newS4<span class="token punctuation">)</span>

<span class="token comment">// 删除空格和换行</span>
<span class="token keyword">let</span> s5 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">" Simple line. \n\n  "</span></span>
<span class="token function">print</span><span class="token punctuation">(</span>s5<span class="token punctuation">.</span><span class="token function">trimmingCharacters</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>whitespacesAndNewlines<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 切割成数组</span>
<span class="token keyword">let</span> s6 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"one/two/three"</span></span>
<span class="token keyword">let</span> a1 <span class="token operator">=</span> s6<span class="token punctuation">.</span><span class="token function">components</span><span class="token punctuation">(</span>separatedBy<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"/"</span></span><span class="token punctuation">)</span> <span class="token comment">// 继承自 NSString 的接口</span>
<span class="token function">print</span><span class="token punctuation">(</span>a1<span class="token punctuation">)</span> <span class="token comment">// ["one", "two", "three"]</span>

<span class="token keyword">let</span> a2 <span class="token operator">=</span> s6<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span>separator<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"/"</span></span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>a2<span class="token punctuation">)</span> <span class="token comment">// ["one", "two", "three"] 属于切片，性能较 components 更好</span>

<span class="token comment">// 判断是否是某种类型</span>
<span class="token keyword">let</span> c1<span class="token punctuation">:</span> <span class="token class-name">Character</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"🤔"</span></span>
<span class="token function">print</span><span class="token punctuation">(</span>c1<span class="token punctuation">.</span>isASCII<span class="token punctuation">)</span> <span class="token comment">// false</span>
<span class="token function">print</span><span class="token punctuation">(</span>c1<span class="token punctuation">.</span>isSymbol<span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token function">print</span><span class="token punctuation">(</span>c1<span class="token punctuation">.</span>isLetter<span class="token punctuation">)</span> <span class="token comment">// false</span>
<span class="token function">print</span><span class="token punctuation">(</span>c1<span class="token punctuation">.</span>isNumber<span class="token punctuation">)</span> <span class="token comment">// false</span>
<span class="token function">print</span><span class="token punctuation">(</span>c1<span class="token punctuation">.</span>isUppercase<span class="token punctuation">)</span> <span class="token comment">// false</span>

<span class="token comment">// 字符串和 Data 互转</span>
<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token class-name">Data</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"hi"</span></span><span class="token punctuation">.</span>utf8<span class="token punctuation">)</span>
<span class="token keyword">let</span> s7 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">(</span>decoding<span class="token punctuation">:</span> data<span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token punctuation">:</span> UTF8<span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>s7<span class="token punctuation">)</span> <span class="token comment">// hi</span>

<span class="token comment">// 字符串可以当作集合来用。</span>
<span class="token keyword">let</span> revered <span class="token operator">=</span> s7<span class="token punctuation">.</span><span class="token function">reversed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">(</span>revered<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Unicode、Character 和 SubString 等内容参见官方字符串文档：<a target="_blank" rel="noopener" href="https://docs.swift.org/swift-book/LanguageGuide/StringsAndCharacters.html">Strings and Characters — The Swift Programming Language (Swift 5.1)</a></p>
<p>字符串字面符号可以参看《<a target="_blank" rel="noopener" href="https://www.swiftbysundell.com/articles/string-literals-in-swift/">String literals in Swift</a>》。</p>
<p>原始字符串</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 原始字符串在字符串前加上一个或多个#符号。里面的双引号和转义符号将不再起作用了，如果想让转义符起作用，需要在转义符后面加上#符号。</span>
<span class="token keyword">let</span> s8 <span class="token operator">=</span> #"<span class="token punctuation">\</span><span class="token punctuation">(</span>s7<span class="token punctuation">)</span><span class="token punctuation">\</span>#<span class="token punctuation">(</span>s7<span class="token punctuation">)</span> <span class="token string-literal"><span class="token string">"one"</span></span> and <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">\</span>n<span class="token punctuation">.</span> <span class="token punctuation">\</span><span class="token other-directive property">#nThe</span> second line<span class="token punctuation">.</span>"#
<span class="token function">print</span><span class="token punctuation">(</span>s8<span class="token punctuation">)</span>
<span class="token comment">/// \(s7)hi "one" and "two"\n.</span>
<span class="token comment">/// The second line.</span>

<span class="token comment">// 原始字符串在正则使用效果更佳，反斜杠更少了。</span>
<span class="token keyword">let</span> s9 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"\\\\[A-Z]+[A-Za-z]+\\.[a-z]+"</span></span>
<span class="token keyword">let</span> s10 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">#"\\[A-Z]+[A-Za-z]+\.[a-z]+"#</span></span>
<span class="token function">print</span><span class="token punctuation">(</span>s9<span class="token punctuation">)</span> <span class="token comment">// \\[A-Z]+[A-Za-z]+\.[a-z]+</span>
<span class="token function">print</span><span class="token punctuation">(</span>s10<span class="token punctuation">)</span> <span class="token comment">// \\[A-Z]+[A-Za-z]+\.[a-z]+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="枚举"><a href="#枚举" class="headerlink" title="枚举"></a>枚举</h4><p>Swift的枚举有类的一些特性，比如计算属性、实例方法、扩展、遵循协议等等。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">enum</span> E1<span class="token punctuation">:</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">CaseIterable</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> e1<span class="token punctuation">,</span> e2 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"12"</span></span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 关联值</span>
<span class="token keyword">enum</span> E2 <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token function">e1</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">case</span> <span class="token function">e2</span><span class="token punctuation">(</span><span class="token class-name">Int</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> e1 <span class="token operator">=</span> E2<span class="token punctuation">.</span><span class="token function">e1</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span><span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> e2 <span class="token operator">=</span> E2<span class="token punctuation">.</span><span class="token function">e2</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>

<span class="token keyword">switch</span> e1 <span class="token punctuation">&#123;</span>
<span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">e1</span><span class="token punctuation">(</span><span class="token keyword">let</span> array<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token function">print</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span>
<span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">e2</span><span class="token punctuation">(</span><span class="token keyword">let</span> int<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token function">print</span><span class="token punctuation">(</span>int<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span>e2<span class="token punctuation">)</span>

<span class="token comment">// 原始值</span>
<span class="token function">print</span><span class="token punctuation">(</span>E1<span class="token punctuation">.</span>e1<span class="token punctuation">.</span>rawValue<span class="token punctuation">)</span>

<span class="token comment">// 遵循 CaseIterable 协议可迭代</span>
<span class="token keyword">for</span> ie <span class="token keyword">in</span> E1<span class="token punctuation">.</span>allCases <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"show </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">ie</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 递归枚举</span>
<span class="token keyword">enum</span> <span class="token constant">RE</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token function">v</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>
    <span class="token keyword">indirect</span> <span class="token keyword">case</span> <span class="token function">node</span><span class="token punctuation">(</span>l<span class="token punctuation">:</span><span class="token constant">RE</span><span class="token punctuation">,</span> r<span class="token punctuation">:</span><span class="token constant">RE</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> lNode <span class="token operator">=</span> <span class="token constant">RE</span><span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"left"</span></span><span class="token punctuation">)</span>
<span class="token keyword">let</span> rNode <span class="token operator">=</span> <span class="token constant">RE</span><span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"right"</span></span><span class="token punctuation">)</span>
<span class="token keyword">let</span> pNode <span class="token operator">=</span> <span class="token constant">RE</span><span class="token punctuation">.</span><span class="token function">node</span><span class="token punctuation">(</span>l<span class="token punctuation">:</span> lNode<span class="token punctuation">,</span> r<span class="token punctuation">:</span> rNode<span class="token punctuation">)</span>

<span class="token keyword">switch</span> pNode <span class="token punctuation">&#123;</span>
<span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span><span class="token keyword">let</span> string<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token function">print</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>
<span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">node</span><span class="token punctuation">(</span><span class="token keyword">let</span> l<span class="token punctuation">,</span> <span class="token keyword">let</span> r<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token function">print</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span>r<span class="token punctuation">)</span>
    <span class="token keyword">switch</span> l <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span><span class="token keyword">let</span> string<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">node</span><span class="token punctuation">(</span><span class="token keyword">let</span> l<span class="token punctuation">,</span> <span class="token keyword">let</span> r<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">switch</span> r <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span><span class="token keyword">let</span> string<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">node</span><span class="token punctuation">(</span><span class="token keyword">let</span> l<span class="token punctuation">,</span> <span class="token keyword">let</span> r<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>@unknown 用来区分固定的枚举和可能改变的枚举的能力。@unknown 用于防止未来新增枚举属性会进行提醒提示完善每个 case 的处理。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// @unknown</span>
<span class="token keyword">enum</span> E3 <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> e1<span class="token punctuation">,</span> e2<span class="token punctuation">,</span> e3
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function-definition function">fe1</span><span class="token punctuation">(</span>e<span class="token punctuation">:</span> E3<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">switch</span> e <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span>e1<span class="token punctuation">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"e1 ok"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span>e2<span class="token punctuation">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"e2 ok"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span>e3<span class="token punctuation">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"e3 ok"</span></span><span class="token punctuation">)</span>
    <span class="token attribute atrule">@unknown</span> <span class="token keyword">default</span><span class="token punctuation">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"not ok"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>符合 Comparable 协议的枚举可以进行比较。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// Comparable 枚举比较</span>
<span class="token keyword">enum</span> E4<span class="token punctuation">:</span> <span class="token class-name">Comparable</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> e1<span class="token punctuation">,</span> e2
    <span class="token keyword">case</span> <span class="token function">e3</span><span class="token punctuation">(</span>i<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span>
    <span class="token keyword">case</span> e4
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> e3 <span class="token operator">=</span> E4<span class="token punctuation">.</span>e4
<span class="token keyword">let</span> e4 <span class="token operator">=</span> E4<span class="token punctuation">.</span><span class="token function">e3</span><span class="token punctuation">(</span>i<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> e5 <span class="token operator">=</span> E4<span class="token punctuation">.</span><span class="token function">e3</span><span class="token punctuation">(</span>i<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> e6 <span class="token operator">=</span> E4<span class="token punctuation">.</span>e1
<span class="token function">print</span><span class="token punctuation">(</span>e3 <span class="token operator">></span> e4<span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token keyword">let</span> a1 <span class="token operator">=</span> <span class="token punctuation">[</span>e3<span class="token punctuation">,</span> e4<span class="token punctuation">,</span> e5<span class="token punctuation">,</span> e6<span class="token punctuation">]</span>
<span class="token keyword">let</span> a2 <span class="token operator">=</span> a1<span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> a2 <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/// e1</span>
<span class="token comment">/// e3(i: 2)</span>
<span class="token comment">/// e3(i: 3)</span>
<span class="token comment">/// e4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h4><p>泛型可以减少重复代码，是一种抽象的表达方式。where 关键字可以对泛型做约束。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">func</span> <span class="token function-definition function">fn</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> r <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    r<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
    <span class="token keyword">return</span> r
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 结构体</span>
<span class="token keyword">struct</span> S1<span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">mutating</span> <span class="token keyword">func</span> <span class="token function-definition function">add</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> p<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        arr<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">var</span> s1 <span class="token operator">=</span> <span class="token function">S1</span><span class="token punctuation">(</span>arr<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"zero"</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span>
s1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">)</span>
s1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span>arr<span class="token punctuation">)</span> <span class="token comment">// ["zero", "one", "two"]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>关联类型</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">protocol</span> pc <span class="token punctuation">&#123;</span>
    <span class="token keyword">associatedtype</span> <span class="token class-name">T</span>
    <span class="token keyword">mutating</span> <span class="token keyword">func</span> <span class="token function-definition function">add</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> p<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">struct</span> S2<span class="token punctuation">:</span> pc <span class="token punctuation">&#123;</span>
    <span class="token keyword">typealias</span> <span class="token class-name">T</span> <span class="token operator">=</span> <span class="token class-name">String</span> <span class="token comment">// 类型推导，可省略</span>
    <span class="token keyword">var</span> strs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">mutating</span> <span class="token keyword">func</span> <span class="token function-definition function">add</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> p<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        strs<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>泛型适用于嵌套类型</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> S3<span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">struct</span> S4 <span class="token punctuation">&#123;</span>
        <span class="token keyword">var</span> p<span class="token punctuation">:</span> <span class="token class-name">T</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">var</span> p1<span class="token punctuation">:</span> <span class="token class-name">T</span>
    <span class="token keyword">var</span> p2<span class="token punctuation">:</span> S4
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token function">S3</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> S3<span class="token punctuation">.</span><span class="token function">S4</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> s3 <span class="token operator">=</span> <span class="token function">S3</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> S3<span class="token punctuation">.</span><span class="token function">S4</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"three"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>s2<span class="token punctuation">,</span>s3<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="不透明类型"><a href="#不透明类型" class="headerlink" title="不透明类型"></a>不透明类型</h4><p>不透明类型会隐藏类型，让使用者更关注功能。不透明类型和协议很类似，不同的是不透明比协议限定的要多，协议能够对应更多类型。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">protocol</span> <span class="token class-name">P</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">func</span> <span class="token function-definition function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">struct</span> S1<span class="token punctuation">:</span> <span class="token class-name">P</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">func</span> <span class="token function-definition function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">"one\n"</span></span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">struct</span> S2<span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">P</span><span class="token operator">></span><span class="token punctuation">:</span> <span class="token class-name">P</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> p<span class="token punctuation">:</span> <span class="token class-name">T</span>
    <span class="token keyword">func</span> <span class="token function-definition function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> p<span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string-literal"><span class="token string">"two\n"</span></span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">struct</span> S3<span class="token operator">&lt;</span>T1<span class="token punctuation">:</span> <span class="token class-name">P</span><span class="token punctuation">,</span> T2<span class="token punctuation">:</span> <span class="token class-name">P</span><span class="token operator">></span><span class="token punctuation">:</span> <span class="token class-name">P</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> p1<span class="token punctuation">:</span> T1
    <span class="token keyword">var</span> p2<span class="token punctuation">:</span> T2
    <span class="token keyword">func</span> <span class="token function-definition function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> p1<span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> p2<span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string-literal"><span class="token string">"three\n"</span></span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">func</span> <span class="token function-definition function">someP</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token keyword">some</span> <span class="token class-name">P</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">S3</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token function">S1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token function">S2</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token function">S1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token function">someP</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>函数调用者决定返回什么类型是泛型，函数自身决定返回什么类型使用不透明返回类型。</p>
<h4 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h4><p>Result 类型用来处理错误，特别适用异步接口的错误处理。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">extension</span> <span class="token class-name">URLSession</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">func</span> <span class="token function-definition function">dataTaskWithResult</span><span class="token punctuation">(</span>
        with url<span class="token punctuation">:</span> <span class="token constant">URL</span><span class="token punctuation">,</span>
        handler<span class="token punctuation">:</span> <span class="token attribute atrule">@escaping</span> <span class="token punctuation">(</span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Data</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Void</span>
    <span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">URLSessionDataTask</span> <span class="token punctuation">&#123;</span>
        <span class="token function">dataTask</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> url<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> <span class="token omit keyword">_</span><span class="token punctuation">,</span> err <span class="token keyword">in</span>
            <span class="token keyword">if</span> <span class="token keyword">let</span> err <span class="token operator">=</span> err <span class="token punctuation">&#123;</span>
                <span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">failure</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>data <span class="token operator">??</span> <span class="token class-name">Data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token function">URL</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"https://ming1016.github.io/"</span></span><span class="token punctuation">)</span><span class="token operator">!</span>

<span class="token comment">// 以前网络请求</span>
<span class="token keyword">let</span> t1 <span class="token operator">=</span> <span class="token class-name">URLSession</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token function">dataTask</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> url<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    data<span class="token punctuation">,</span> <span class="token omit keyword">_</span><span class="token punctuation">,</span> error <span class="token keyword">in</span>
    <span class="token keyword">if</span> <span class="token keyword">let</span> err <span class="token operator">=</span> error <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token keyword">let</span> data <span class="token operator">=</span> data <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">(</span>decoding<span class="token punctuation">:</span> data<span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token punctuation">:</span> UTF8<span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
t1<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 使用 Result 网络请求</span>
<span class="token keyword">let</span> t2 <span class="token operator">=</span> <span class="token class-name">URLSession</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token function">dataTaskWithResult</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> url<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> result <span class="token keyword">in</span>
    <span class="token keyword">switch</span> result <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token keyword">let</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">(</span>decoding<span class="token punctuation">:</span> data<span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token punctuation">:</span> UTF8<span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">failure</span><span class="token punctuation">(</span><span class="token keyword">let</span> err<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
t2<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h4><p>使用 is 关键字进行类型判断， 使用as 关键字来转换成子类。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">class</span> S0 <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token keyword">class</span> S1<span class="token punctuation">:</span> S0 <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token keyword">class</span> S2<span class="token punctuation">:</span> S0 <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span>S0<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
a<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token function">S1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
a<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token function">S2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> e <span class="token keyword">in</span> a <span class="token punctuation">&#123;</span>
    <span class="token comment">// 类型判断</span>
    <span class="token keyword">if</span> e <span class="token keyword">is</span> S1 <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Type is S1"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> e <span class="token keyword">is</span> S2 <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Type is S2"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// 使用 as 关键字转换成子类</span>
    <span class="token keyword">if</span> <span class="token keyword">let</span> s1 <span class="token operator">=</span> e <span class="token keyword">as</span><span class="token operator">?</span> S1 <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"As S1 </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">s1</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token keyword">let</span> s2 <span class="token operator">=</span> e <span class="token keyword">as</span><span class="token operator">?</span> S2 <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"As S2 </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">s2</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="类和结构体"><a href="#类和结构体" class="headerlink" title="类和结构体"></a>类和结构体</h3><h4 id="类"><a href="#类" class="headerlink" title="类"></a>类</h4><p>类可以定义属性、方法、构造器、下标操作。类使用扩展来扩展功能，遵循协议。类还以继承，运行时检查实例类型。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">class</span> <span class="token class-name">C</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> p<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> p<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>p <span class="token operator">=</span> p
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">// 下标操作</span>
    <span class="token keyword">subscript</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">get</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> p <span class="token operator">+</span> s
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">set</span> <span class="token punctuation">&#123;</span>
            p <span class="token operator">=</span> s <span class="token operator">+</span> newValue
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token class-name">C</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"hi"</span></span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>p<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">" ming"</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span>
c<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"k"</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"v"</span></span>
<span class="token function">print</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>p<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h4><p>结构体是值类型，可以定义属性、方法、构造器、下标操作。结构体使用扩展来扩展功能，遵循协议。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">S</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> p1<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span>
    <span class="token keyword">var</span> p2<span class="token punctuation">:</span> <span class="token class-name">Int</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">extension</span> <span class="token class-name">S</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">func</span> <span class="token function-definition function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> p1 <span class="token operator">+</span> <span class="token class-name">String</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token class-name">S</span><span class="token punctuation">(</span>p2<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>p1 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"1"</span></span>
<span class="token function">print</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 11</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h4><p>类、结构体或枚举里的变量常量就是他们的属性。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">S</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">let</span> sp <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"类型属性"</span></span> <span class="token comment">// 类型属性通过类型本身访问，非实例访问</span>
    <span class="token keyword">var</span> p1<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span>
    <span class="token keyword">var</span> p2<span class="token punctuation">:</span> <span class="token class-name">Int</span> <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token comment">// cp 是计算属性</span>
    <span class="token keyword">var</span> cp<span class="token punctuation">:</span> <span class="token class-name">Int</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">get</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> p2 <span class="token operator">*</span> <span class="token number">2</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">set</span> <span class="token punctuation">&#123;</span>
            p2 <span class="token operator">=</span> newValue <span class="token operator">+</span> <span class="token number">2</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// 只有 getter 的是只读计算属性</span>
    <span class="token keyword">var</span> rcp<span class="token punctuation">:</span> <span class="token class-name">Int</span> <span class="token punctuation">&#123;</span>
        p2 <span class="token operator">*</span> <span class="token number">4</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">S</span><span class="token punctuation">.</span>sp<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">S</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cp<span class="token punctuation">)</span> <span class="token comment">// 2</span>
<span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token class-name">S</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>cp <span class="token operator">=</span> <span class="token number">3</span>
<span class="token function">print</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>p2<span class="token punctuation">)</span> <span class="token comment">// 5</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">S</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rcp<span class="token punctuation">)</span> <span class="token comment">// 4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>willSet 和 didSet 是属性观察器，可以在属性值设置前后插入自己的逻辑处理。</p>
<p>键路径表达式作为函数</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> S2 <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> p1<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">let</span> p2<span class="token punctuation">:</span> <span class="token class-name">Int</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token function">S2</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> s3 <span class="token operator">=</span> <span class="token function">S2</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> a1 <span class="token operator">=</span> <span class="token punctuation">[</span>s2<span class="token punctuation">,</span> s3<span class="token punctuation">]</span>
<span class="token keyword">let</span> a2 <span class="token operator">=</span> a1<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">\</span><span class="token punctuation">.</span>p1<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>a2<span class="token punctuation">)</span> <span class="token comment">// ["one", "two"]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">enum</span> <span class="token class-name">E</span><span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> one<span class="token punctuation">,</span> two<span class="token punctuation">,</span> three
    <span class="token keyword">func</span> <span class="token function-definition function">showRawValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span>rawValue<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> e <span class="token operator">=</span> <span class="token class-name">E</span><span class="token punctuation">.</span>three
e<span class="token punctuation">.</span><span class="token function">showRawValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// three</span>

<span class="token comment">// 可变的实例方法，使用 mutating 标记</span>
<span class="token keyword">struct</span> <span class="token class-name">S</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> p<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">mutating</span> <span class="token keyword">func</span> <span class="token function-definition function">addFullStopForP</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        p <span class="token operator">+=</span> <span class="token string-literal"><span class="token string">"."</span></span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token class-name">S</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"hi"</span></span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span><span class="token function">addFullStopForP</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>p<span class="token punctuation">)</span>

<span class="token comment">// 类方法</span>
<span class="token keyword">class</span> <span class="token class-name">C</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">class</span> <span class="token keyword">func</span> <span class="token function-definition function">cf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"类方法"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>static和class关键字修饰的方法类似 OC 的类方法。static 可以修饰存储属性，而 class 不能；class 修饰的方法可以继承，而 static 不能。在协议中需用 static 来修饰。</p>
<p>静态下标方法</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 静态下标</span>
<span class="token keyword">struct</span> S2 <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">var</span> sp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">static</span> <span class="token keyword">subscript</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> s<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> d<span class="token punctuation">:</span> <span class="token class-name">Int</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Int</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">get</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> sp<span class="token punctuation">[</span>s<span class="token punctuation">]</span> <span class="token operator">??</span> d
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">set</span> <span class="token punctuation">&#123;</span>
            sp<span class="token punctuation">[</span>s<span class="token punctuation">]</span> <span class="token operator">=</span> newValue
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

S2<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"key1"</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
S2<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"key2"</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span>
<span class="token function">print</span><span class="token punctuation">(</span>S2<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"key2"</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>
<span class="token function">print</span><span class="token punctuation">(</span>S2<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"key3"</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 10</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>自定义类型中实现了 callAsFunction() 的话，该类型的值就可以直接调用。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// callAsFunction()</span>
<span class="token keyword">struct</span> S3 <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> p1<span class="token punctuation">:</span> <span class="token class-name">String</span>
    
    <span class="token keyword">func</span> <span class="token function-definition function">callAsFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">"show </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">p1</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token function">S3</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"hi"</span></span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">s2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// show hi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h4><p>类能继承另一个类，继承它的方法、属性等。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 类继承</span>
<span class="token keyword">class</span> C1 <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> p1<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">var</span> cp1<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">get</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> p1 <span class="token operator">+</span> <span class="token string-literal"><span class="token string">" like ATM"</span></span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">set</span> <span class="token punctuation">&#123;</span>
            p1 <span class="token operator">=</span> p1 <span class="token operator">+</span> newValue
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>p1 <span class="token operator">=</span> p1
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">func</span> <span class="token function-definition function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Hi! </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">p1</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> C2<span class="token punctuation">:</span> C1 <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> p2<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span>p2<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>p2 <span class="token operator">=</span> p2
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> p2 <span class="token operator">+</span> <span class="token string-literal"><span class="token string">"'s father"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">C2</span><span class="token punctuation">(</span>p2<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Lemon"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Hi! Lemon's father</span>

<span class="token comment">// 重写父类方法</span>
<span class="token keyword">class</span> C3<span class="token punctuation">:</span> C2 <span class="token punctuation">&#123;</span>
    <span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function-definition function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Hi! </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">p2</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">C3</span><span class="token punctuation">(</span>p2<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Lemon"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Hi! Lemon</span>

<span class="token comment">// 重写计算属性</span>
<span class="token keyword">class</span> C4<span class="token punctuation">:</span> C1 <span class="token punctuation">&#123;</span>
    <span class="token keyword">override</span> <span class="token keyword">var</span> cp1<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">get</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> p1 <span class="token operator">+</span> <span class="token string-literal"><span class="token string">" like Out of the blade"</span></span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">set</span> <span class="token punctuation">&#123;</span>
            p1 <span class="token operator">=</span> p1 <span class="token operator">+</span> newValue
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">C1</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Lemon"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span>cp1<span class="token punctuation">)</span> <span class="token comment">// Lemon like ATM</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">C4</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Lemon"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span>cp1<span class="token punctuation">)</span> <span class="token comment">// Lemon like Out of the blade</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>通过 final 关键字可以防止类被继承，final 还可以用于属性和方法。使用 super 关键字指代父类。</p>
<h3 id="函数式"><a href="#函数式" class="headerlink" title="函数式"></a>函数式</h3><h4 id="map"><a href="#map" class="headerlink" title="map"></a>map</h4><p>map 可以依次处理数组中元素，并返回一个处理后的新数组。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> a1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"a"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"b"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"c"</span></span><span class="token punctuation">]</span>
<span class="token keyword">let</span> a2 <span class="token operator">=</span> a1<span class="token punctuation">.</span>map <span class="token punctuation">&#123;</span>
    <span class="token string-literal"><span class="token string">"</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation"><span class="token short-argument">$0</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">2"</span></span>
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span>a2<span class="token punctuation">)</span> <span class="token comment">// ["a2", "b2", "c2"]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用 compactMap 可以过滤 nil 的元素。flatMap 会将多个数组合成一个数组返回。</p>
<h4 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h4><p>根据指定条件返回</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> a1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"a"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"b"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"c"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"call my name"</span></span><span class="token punctuation">]</span>
<span class="token keyword">let</span> a2 <span class="token operator">=</span> a1<span class="token punctuation">.</span>filter <span class="token punctuation">&#123;</span>
    <span class="token short-argument">$0</span><span class="token punctuation">.</span><span class="token keyword">prefix</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string-literal"><span class="token string">"c"</span></span>
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span>a2<span class="token punctuation">)</span> <span class="token comment">// ["c", "call my name"]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h4><p>reduce 可以将迭代中返回的结果用于下个迭代中，并，还能让你设个初始值。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> a1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"a"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"b"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"c"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"call my name."</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"get it?"</span></span><span class="token punctuation">]</span>
<span class="token keyword">let</span> a2 <span class="token operator">=</span> a1<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Hey u,"</span></span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> partialResult<span class="token punctuation">,</span> s <span class="token keyword">in</span>
    <span class="token comment">// partialResult 是前面返回的值，s 是遍历到当前的值</span>
    partialResult <span class="token operator">+</span> <span class="token string-literal"><span class="token string">" </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">s</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token function">print</span><span class="token punctuation">(</span>a2<span class="token punctuation">)</span> <span class="token comment">// Hey u, a b c call my name. get it?</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="sorted"><a href="#sorted" class="headerlink" title="sorted"></a>sorted</h4><p>排序</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 类型遵循 Comparable</span>
<span class="token keyword">let</span> a1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"a"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"b"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"c"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"call my name."</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"get it?"</span></span><span class="token punctuation">]</span>
<span class="token keyword">let</span> a2 <span class="token operator">=</span> a1<span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> a3 <span class="token operator">=</span> a1<span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span>by<span class="token punctuation">:</span> <span class="token operator">></span><span class="token punctuation">)</span>
<span class="token keyword">let</span> a4 <span class="token operator">=</span> a1<span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span>by<span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token punctuation">)</span>

<span class="token function">print</span><span class="token punctuation">(</span>a2<span class="token punctuation">)</span> <span class="token comment">// Hey u, a b c call my name. get it?</span>
<span class="token function">print</span><span class="token punctuation">(</span>a3<span class="token punctuation">)</span> <span class="token comment">// ["get it?", "call my name.", "c", "b", "a"]</span>
<span class="token function">print</span><span class="token punctuation">(</span>a4<span class="token punctuation">)</span> <span class="token comment">// ["a", "b", "c", "call my name.", "get it?"]</span>

<span class="token comment">// 类型不遵循 Comparable</span>
<span class="token keyword">struct</span> <span class="token class-name">S</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> s<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">var</span> i<span class="token punctuation">:</span> <span class="token class-name">Int</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> a5 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">S</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"a"</span></span><span class="token punctuation">,</span> i<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">S</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"b"</span></span><span class="token punctuation">,</span> i<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">S</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"c"</span></span><span class="token punctuation">,</span> i<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> a6 <span class="token operator">=</span> a5
    <span class="token punctuation">.</span>sorted <span class="token punctuation">&#123;</span> l<span class="token punctuation">,</span> r <span class="token keyword">in</span>
        l<span class="token punctuation">.</span>i <span class="token operator">></span> r<span class="token punctuation">.</span>i
    <span class="token punctuation">&#125;</span>
    <span class="token punctuation">.</span>map <span class="token punctuation">&#123;</span>
        <span class="token short-argument">$0</span><span class="token punctuation">.</span>i
    <span class="token punctuation">&#125;</span>

<span class="token function">print</span><span class="token punctuation">(</span>a6<span class="token punctuation">)</span> <span class="token comment">// [2, 1, 0]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="控制流"><a href="#控制流" class="headerlink" title="控制流"></a>控制流</h3><h4 id="If-•-If-let-•-If-case-let"><a href="#If-•-If-let-•-If-case-let" class="headerlink" title="If • If let • If case let"></a>If • If let • If case let</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// if</span>
<span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"hi"</span></span>
<span class="token keyword">if</span> s<span class="token punctuation">.</span>isEmpty <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"String is Empty"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"String is </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">s</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 三元条件</span>
s<span class="token punctuation">.</span>isEmpty <span class="token operator">?</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"String is Empty again"</span></span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"String is </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">s</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> again"</span></span><span class="token punctuation">)</span>

<span class="token comment">// if let-else</span>
<span class="token keyword">func</span> <span class="token function-definition function">f</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token keyword">let</span> s1 <span class="token operator">=</span> s <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"s1 is </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">s1</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"s1 is nothing"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// nil-coalescing</span>
    <span class="token keyword">let</span> s2 <span class="token operator">=</span> s <span class="token operator">??</span> <span class="token string-literal"><span class="token string">"nothing"</span></span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"s2 is </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">s2</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token function">f</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"something"</span></span><span class="token punctuation">)</span>
<span class="token function">f</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span>

<span class="token comment">// if case let</span>
<span class="token keyword">enum</span> <span class="token class-name">E</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token function">c1</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>
    <span class="token keyword">case</span> <span class="token function">c2</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    
    <span class="token keyword">func</span> <span class="token function-definition function">des</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">switch</span> <span class="token keyword">self</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">c1</span><span class="token punctuation">(</span><span class="token keyword">let</span> string<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token function">print</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">c2</span><span class="token punctuation">(</span><span class="token keyword">let</span> array<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token function">print</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token class-name">E</span><span class="token punctuation">.</span><span class="token function">c1</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"enum c1"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">des</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token class-name">E</span><span class="token punctuation">.</span><span class="token function">c2</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"three"</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">des</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="Guard-guard-guard-let"><a href="#Guard-guard-guard-let" class="headerlink" title="Guard guard, guard let"></a>Guard guard, guard let</h4><p>更好地处理异常情况</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// guard</span>
<span class="token keyword">func</span> <span class="token function-definition function">f1</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">guard</span> p<span class="token punctuation">.</span>isEmpty <span class="token operator">!=</span> <span class="token boolean">true</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">"Empty string."</span></span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">"String </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">p</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> is not empty."</span></span>
<span class="token punctuation">&#125;</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">f1</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Empty string.</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">f1</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"lemon"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// String lemon is not empty.</span>

<span class="token comment">// guard let</span>
<span class="token keyword">func</span> <span class="token function-definition function">f2</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">guard</span> <span class="token keyword">let</span> p2 <span class="token operator">=</span> p1 <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">"Nil."</span></span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">"String </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">p2</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> is not nil."</span></span>
<span class="token punctuation">&#125;</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">f2</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Nil.</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">f2</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"lemon"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// String lemon is not nil.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="遍历-For-in"><a href="#遍历-For-in" class="headerlink" title="遍历 For-in"></a>遍历 For-in</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"three"</span></span><span class="token punctuation">]</span>
<span class="token keyword">for</span> str <span class="token keyword">in</span> a <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用下标范围</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token operator">..&lt;</span><span class="token number">10</span> <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用 enumerated</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> str<span class="token punctuation">)</span> <span class="token keyword">in</span> a<span class="token punctuation">.</span><span class="token function">enumerated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"第</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i <span class="token operator">+</span> <span class="token number">1</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">个是:</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">str</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// for in where</span>
<span class="token keyword">for</span> str <span class="token keyword">in</span> a <span class="token keyword">where</span> str<span class="token punctuation">.</span><span class="token keyword">prefix</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string-literal"><span class="token string">"t"</span></span> <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 字典 for in，遍历是无序的</span>
<span class="token keyword">let</span> dic <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">"three"</span></span><span class="token punctuation">:</span> <span class="token number">3</span>
<span class="token punctuation">]</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> dic <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"key is </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">k</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">, value is </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">v</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// stride</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">stride</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> through<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> by<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/*
 10
 8
 6
 4
 2
 0
 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="While-while-repeat-while"><a href="#While-while-repeat-while" class="headerlink" title="While while, repeat-while"></a>While while, repeat-while</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// while</span>
<span class="token keyword">var</span> i1 <span class="token operator">=</span> <span class="token number">10</span>
<span class="token keyword">while</span> i1 <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"positive even number </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i1</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
    i1 <span class="token operator">-=</span> <span class="token number">2</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// repeat while</span>
<span class="token keyword">var</span> i2 <span class="token operator">=</span> <span class="token number">10</span>
<span class="token keyword">repeat</span> <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"positive even number </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i2</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
    i2 <span class="token operator">-=</span> <span class="token number">2</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">while</span> i2 <span class="token operator">></span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用 break 结束遍历，使用 continue 跳过当前作用域，继续下个循环</p>
<h4 id="Switch"><a href="#Switch" class="headerlink" title="Switch"></a>Switch</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">func</span> <span class="token function-definition function">f1</span><span class="token punctuation">(</span>pa<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> t<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Int</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> p1 <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">var</span> p2 <span class="token operator">=</span> <span class="token number">10</span>
    <span class="token keyword">switch</span> pa <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">:</span>
        p1 <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">case</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">:</span>
        p1 <span class="token operator">=</span> <span class="token number">2</span>
        <span class="token keyword">fallthrough</span> <span class="token comment">// 继续到下个 case 中</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
        p2 <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"p1 is </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">p1</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"p2 is </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">p2</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment">// 元组</span>
    <span class="token keyword">switch</span> t <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"0"</span></span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"zero"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">case</span> <span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"1"</span></span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"no"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">f1</span><span class="token punctuation">(</span>pa<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">,</span> t<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"1"</span></span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">/*
 p1 is 2
 p2 is 0
 one
 */</span>

<span class="token comment">// 枚举</span>
<span class="token keyword">enum</span> <span class="token class-name">E</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> one<span class="token punctuation">,</span> two<span class="token punctuation">,</span> three<span class="token punctuation">,</span> <span class="token function">unknown</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function-definition function">f2</span><span class="token punctuation">(</span>pa<span class="token punctuation">:</span> <span class="token class-name">E</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> p<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">switch</span> pa <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span>one<span class="token punctuation">:</span>
        p <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"1"</span></span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span>two<span class="token punctuation">:</span>
        p <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"2"</span></span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span>three<span class="token punctuation">:</span>
        p <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"3"</span></span>
    <span class="token keyword">case</span> <span class="token keyword">let</span> <span class="token punctuation">.</span><span class="token function">unknown</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span> <span class="token keyword">where</span> <span class="token class-name">Int</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token number">0</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">:</span> <span class="token comment">// 枚举关联值，使用 where 增加条件</span>
        p <span class="token operator">=</span> u
    <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">unknown</span><span class="token punctuation">(</span><span class="token omit keyword">_</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        p <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"negative number"</span></span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token function">f2</span><span class="token punctuation">(</span>pa<span class="token punctuation">:</span> <span class="token class-name">E</span><span class="token punctuation">.</span>one<span class="token punctuation">)</span> <span class="token comment">// 1</span>
<span class="token function">f2</span><span class="token punctuation">(</span>pa<span class="token punctuation">:</span> <span class="token class-name">E</span><span class="token punctuation">.</span><span class="token function">unknown</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"10"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 10</span>
<span class="token function">f2</span><span class="token punctuation">(</span>pa<span class="token punctuation">:</span> <span class="token class-name">E</span><span class="token punctuation">.</span><span class="token function">unknown</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"-10"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// negative number</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h3><h4 id="数组-1-2-3"><a href="#数组-1-2-3" class="headerlink" title="数组 [1, 2, 3]"></a>数组 [1, 2, 3]</h4><p>数组是有序集合</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">var</span> a0<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span>
a0<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
a0<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>at<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>a0<span class="token punctuation">)</span> <span class="token comment">// [10, 2]</span>

<span class="token keyword">let</span> a1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"three"</span></span><span class="token punctuation">]</span>
<span class="token keyword">let</span> a2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"three"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"four"</span></span><span class="token punctuation">]</span>

<span class="token comment">// 找两个集合的不同</span>
<span class="token keyword">let</span> dif <span class="token operator">=</span> a1<span class="token punctuation">.</span><span class="token function">difference</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> a2<span class="token punctuation">)</span> <span class="token comment">// swift的 diffing 算法在这 http://www.xmailserver.org/diff2.pdf swift实现在  swift/stdlib/public/core/Diffing.swift</span>
<span class="token keyword">for</span> c <span class="token keyword">in</span> dif <span class="token punctuation">&#123;</span>
    <span class="token keyword">switch</span> c <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">let</span> o<span class="token punctuation">,</span> <span class="token keyword">let</span> e<span class="token punctuation">,</span> <span class="token keyword">let</span> a<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"offset:</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">o</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">, element:</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">e</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">, associatedWith:</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation"><span class="token class-name">String</span><span class="token punctuation">(</span>describing<span class="token punctuation">:</span> a<span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">let</span> o<span class="token punctuation">,</span> <span class="token keyword">let</span> e<span class="token punctuation">,</span> <span class="token keyword">let</span> a<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"offset:</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">o</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">, element:</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">e</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">, associatedWith:</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation"><span class="token class-name">String</span><span class="token punctuation">(</span>describing<span class="token punctuation">:</span> a<span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/*
 remove offset:1, element:four, associatedWith:nil
 insert offset:0, element:one, associatedWith:nil
 insert offset:1, element:two, associatedWith:nil
 */</span>
<span class="token keyword">let</span> a3 <span class="token operator">=</span> a2<span class="token punctuation">.</span><span class="token function">applying</span><span class="token punctuation">(</span>dif<span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 可以用于添加删除动画</span>
<span class="token function">print</span><span class="token punctuation">(</span>a3<span class="token punctuation">)</span> <span class="token comment">// ["one", "two", "three"]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>dif 有第三个 case 值 .insert(let offset, let element, let associatedWith) 可以跟踪成对的变化，用于高级动画。</p>
<p>从数组中随机取一个元素</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token function">print</span><span class="token punctuation">(</span>a0<span class="token punctuation">.</span><span class="token function">randomElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token number">0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>数组排序</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 排序</span>
<span class="token keyword">struct</span> S1 <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> n<span class="token punctuation">:</span> <span class="token class-name">Int</span>
    <span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> a4 <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token function">S1</span><span class="token punctuation">(</span>n<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">S1</span><span class="token punctuation">(</span>n<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">S1</span><span class="token punctuation">(</span>n<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">S1</span><span class="token punctuation">(</span>n<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
<span class="token keyword">let</span> a5 <span class="token operator">=</span> a4<span class="token punctuation">.</span>sorted <span class="token punctuation">&#123;</span> i1<span class="token punctuation">,</span> i2 <span class="token keyword">in</span>
    i1<span class="token punctuation">.</span>n <span class="token operator">&lt;</span> i2<span class="token punctuation">.</span>n
<span class="token punctuation">&#125;</span>
<span class="token keyword">for</span> n <span class="token keyword">in</span> a5 <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/// S1(n: 1)</span>
<span class="token comment">/// S1(n: 2)</span>
<span class="token comment">/// S1(n: 3)</span>
<span class="token comment">/// S1(n: 10)</span>

<span class="token keyword">let</span> a6 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span>
<span class="token function">print</span><span class="token punctuation">(</span>a6<span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span>by<span class="token punctuation">:</span> <span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [10, 7, 4, 2, 1]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以加到数组扩展中，通过扩展约束能够指定特定元素类型的排序，代码如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">extension</span> <span class="token class-name">Array</span> <span class="token keyword">where</span> <span class="token class-name">Element</span> <span class="token operator">==</span> <span class="token class-name">Int</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 升序</span>
    <span class="token keyword">func</span> <span class="token function-definition function">intSortedASC</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">[</span><span class="token class-name">Int</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span>by<span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// 降序</span>
    <span class="token keyword">func</span> <span class="token function-definition function">intSortedDESC</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">[</span><span class="token class-name">Int</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span>by<span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">print</span><span class="token punctuation">(</span>a6<span class="token punctuation">.</span><span class="token function">intSortedASC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 使用扩展增加自定义排序能力</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在数组中检索满足条件的元素，代码如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 第一个满足条件了就返回</span>
<span class="token keyword">let</span> a7 <span class="token operator">=</span> a4<span class="token punctuation">.</span>first <span class="token punctuation">&#123;</span>
    <span class="token short-argument">$0</span><span class="token punctuation">.</span>n <span class="token operator">==</span> <span class="token number">10</span>
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span>a7<span class="token operator">?</span><span class="token punctuation">.</span>n <span class="token operator">??</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment">// 是否都满足了条件</span>
<span class="token function">print</span><span class="token punctuation">(</span>a4<span class="token punctuation">.</span>allSatisfy <span class="token punctuation">&#123;</span> <span class="token short-argument">$0</span><span class="token punctuation">.</span>n <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
<span class="token function">print</span><span class="token punctuation">(</span>a4<span class="token punctuation">.</span><span class="token function">allSatisfy</span><span class="token punctuation">(</span><span class="token punctuation">\</span><span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>

<span class="token comment">// 找出最大的那个</span>
<span class="token function">print</span><span class="token punctuation">(</span>a4<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>by<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span> e1<span class="token punctuation">,</span> e2 <span class="token keyword">in</span>
    e1<span class="token punctuation">.</span>n <span class="token operator">&lt;</span> e2<span class="token punctuation">.</span>n
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token function">S1</span><span class="token punctuation">(</span>n<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// S1(n: 10, b: true)</span>

<span class="token comment">// 看看是否包含某个元素</span>
<span class="token function">print</span><span class="token punctuation">(</span>a4<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token keyword">where</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
    <span class="token short-argument">$0</span><span class="token punctuation">.</span>n <span class="token operator">==</span> <span class="token number">7</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>一些切割数组的方法。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 切片</span>
<span class="token comment">// 取前3个，并不是直接复制，对于大的数组有性能优势。</span>
<span class="token function">print</span><span class="token punctuation">(</span>a6<span class="token punctuation">[</span><span class="token operator">..&lt;</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// [1, 10, 4] 需要做越界检查</span>
<span class="token function">print</span><span class="token punctuation">(</span>a6<span class="token punctuation">.</span><span class="token keyword">prefix</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [1, 10, 4, 7, 2] 不需要做越界检查，也是切片，性能一样</span>

<span class="token comment">// 去掉前3个</span>
<span class="token function">print</span><span class="token punctuation">(</span>a6<span class="token punctuation">.</span><span class="token function">dropFirst</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [7, 2]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>prefix(while:) 和 drop(while:) 方法，顺序遍历执行闭包里的逻辑判断，满足条件就返回，遇到不匹配就会停止遍历。prefix 返回满足条件的元素集合，drop 返回停止遍历之后那些元素集合。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> a8 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> a9 <span class="token operator">=</span> a8<span class="token punctuation">.</span><span class="token keyword">prefix</span> <span class="token punctuation">&#123;</span>
    <span class="token short-argument">$0</span> <span class="token operator">&lt;</span> <span class="token number">30</span>
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span>a9<span class="token punctuation">)</span> <span class="token comment">// [8, 9, 20, 1]</span>
<span class="token keyword">let</span> a10 <span class="token operator">=</span> a8<span class="token punctuation">.</span>drop <span class="token punctuation">&#123;</span>
    <span class="token short-argument">$0</span> <span class="token operator">&lt;</span> <span class="token number">30</span>
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span>a10<span class="token punctuation">)</span> <span class="token comment">// [35, 3]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>比 filter 更高效的删除元素的方法 removeAll</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 删除所有不满足条件的元素</span>
<span class="token keyword">var</span> a11 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">]</span>
a11<span class="token punctuation">.</span>removeAll <span class="token punctuation">&#123;</span> <span class="token short-argument">$0</span> <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span>a11<span class="token punctuation">)</span> <span class="token comment">// [4, 3, 1, 3, 3] 随机</span>

<span class="token comment">// 创建未初始化的数组</span>
<span class="token keyword">let</span> a12 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">...</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span>map <span class="token punctuation">&#123;</span> <span class="token omit keyword">_</span> <span class="token keyword">in</span>
    <span class="token class-name">Int</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token operator">...</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span>a12<span class="token punctuation">)</span> <span class="token comment">// [0, 3, 3, 2, 5] 随机</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>#if 用于后缀表达式</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// #if 用于后缀表达式</span>
<span class="token keyword">let</span> a13 <span class="token operator">=</span> a11
<span class="token directive property"><span class="token directive-name">#if</span> os<span class="token punctuation">(</span>iOS<span class="token punctuation">)</span></span>
    <span class="token punctuation">.</span>count
<span class="token directive property"><span class="token directive-name">#else</span></span>
    <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">+</span><span class="token punctuation">)</span>
<span class="token directive property"><span class="token directive-name">#endif</span></span>
<span class="token function">print</span><span class="token punctuation">(</span>a13<span class="token punctuation">)</span> <span class="token comment">//37</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="Sets-Set-lt-Int-gt"><a href="#Sets-Set-lt-Int-gt" class="headerlink" title="Sets Set&lt;Int&gt;"></a><code>Sets Set&lt;Int&gt;</code></h4><p>Set 是无序集合，元素唯一</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> s0<span class="token punctuation">:</span> <span class="token class-name">Set</span><span class="token operator">&lt;</span><span class="token class-name">Int</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> s1<span class="token punctuation">:</span> <span class="token class-name">Set</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> s2<span class="token punctuation">:</span> <span class="token class-name">Set</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span>

<span class="token keyword">let</span> s3 <span class="token operator">=</span> s1<span class="token punctuation">.</span><span class="token function">union</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span> <span class="token comment">// 合集</span>
<span class="token keyword">let</span> s4 <span class="token operator">=</span> s1<span class="token punctuation">.</span><span class="token function">intersection</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span> <span class="token comment">// 交集</span>
<span class="token keyword">let</span> s5 <span class="token operator">=</span> s1<span class="token punctuation">.</span><span class="token function">subtracting</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span> <span class="token comment">// 非交集部分</span>
<span class="token keyword">let</span> s6 <span class="token operator">=</span> s1<span class="token punctuation">.</span><span class="token function">symmetricDifference</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span> <span class="token comment">// 非交集的合集</span>
<span class="token function">print</span><span class="token punctuation">(</span>s3<span class="token punctuation">)</span> <span class="token comment">// [4, 2, 1, 7, 3, 10, 8, 9, 6, 5]</span>
<span class="token function">print</span><span class="token punctuation">(</span>s4<span class="token punctuation">)</span> <span class="token comment">// [10]</span>
<span class="token function">print</span><span class="token punctuation">(</span>s5<span class="token punctuation">)</span> <span class="token comment">// [8, 4, 2, 6]</span>
<span class="token function">print</span><span class="token punctuation">(</span>s6<span class="token punctuation">)</span> <span class="token comment">// [9, 1, 3, 4, 5, 2, 6, 8, 7]</span>

<span class="token comment">// s0 是否被 s1 包含</span>
<span class="token function">print</span><span class="token punctuation">(</span>s0<span class="token punctuation">.</span><span class="token function">isSubset</span><span class="token punctuation">(</span>of<span class="token punctuation">:</span> s1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token comment">// s1 是否包含了 s0</span>
<span class="token function">print</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span><span class="token function">isSuperset</span><span class="token punctuation">(</span>of<span class="token punctuation">:</span> s0<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>

<span class="token keyword">let</span> s7<span class="token punctuation">:</span> <span class="token class-name">Set</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
<span class="token comment">// s0 和 s7 是否有交集</span>
<span class="token function">print</span><span class="token punctuation">(</span>s0<span class="token punctuation">.</span><span class="token function">isDisjoint</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> s7<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>

<span class="token comment">// 可变 Set</span>
<span class="token keyword">var</span> s8<span class="token punctuation">:</span> <span class="token class-name">Set</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">]</span>
s8<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"three"</span></span><span class="token punctuation">)</span>
s8<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>s8<span class="token punctuation">)</span> <span class="token comment">// ["two", "three"]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="字典"><a href="#字典" class="headerlink" title="字典 [:]"></a>字典 [:]</h4><p>字典是无序集合，键值对应。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">var</span> d1 <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string-literal"><span class="token string">"k1"</span></span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"v1"</span></span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">"k2"</span></span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"v2"</span></span>
<span class="token punctuation">]</span>
d1<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"k3"</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"v3"</span></span>
d1<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"k4"</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token nil constant">nil</span>

<span class="token function">print</span><span class="token punctuation">(</span>d1<span class="token punctuation">)</span> <span class="token comment">// ["k2": "v2", "k3": "v3", "k1": "v1"]</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> d1 <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"key is </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">k</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">, value is </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">v</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/*
 key is k1, value is v1
 key is k2, value is v2
 key is k3, value is v3
 */</span>
 
<span class="token keyword">if</span> d1<span class="token punctuation">.</span>isEmpty <span class="token operator">==</span> <span class="token boolean">false</span> <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>d1<span class="token punctuation">.</span>count<span class="token punctuation">)</span> <span class="token comment">// 3</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// mapValues</span>
<span class="token keyword">let</span> d2 <span class="token operator">=</span> d1<span class="token punctuation">.</span>mapValues <span class="token punctuation">&#123;</span>
    <span class="token short-argument">$0</span> <span class="token operator">+</span> <span class="token string-literal"><span class="token string">"_new"</span></span>
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span>d2<span class="token punctuation">)</span> <span class="token comment">// ["k2": "v2_new", "k3": "v3_new", "k1": "v1_new"]</span>

<span class="token comment">// 对字典的值或键进行分组</span>
<span class="token keyword">let</span> d3 <span class="token operator">=</span> <span class="token class-name">Dictionary</span><span class="token punctuation">(</span>grouping<span class="token punctuation">:</span> d1<span class="token punctuation">.</span>values<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token short-argument">$0</span><span class="token punctuation">.</span>count
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span>d3<span class="token punctuation">)</span> <span class="token comment">// [2: ["v1", "v2", "v3"]]</span>

<span class="token comment">// 从字典中取值，如果键对应无值，则使用通过 default 指定的默认值</span>
d1<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"k5"</span></span><span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"whatever"</span></span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token string-literal"><span class="token string">"."</span></span>
<span class="token function">print</span><span class="token punctuation">(</span>d1<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"k5"</span></span><span class="token punctuation">]</span> <span class="token operator">??</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span> <span class="token comment">// whatever.</span>
<span class="token keyword">let</span> v1 <span class="token operator">=</span> d1<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"k3"</span></span><span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"whatever"</span></span><span class="token punctuation">]</span>
<span class="token function">print</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span> <span class="token comment">// v3</span>

<span class="token comment">// compactMapValues() 对字典值进行转换和解包。可以解可选类型，并去掉 nil 值</span>
<span class="token keyword">let</span> d4 <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string-literal"><span class="token string">"k1"</span></span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">"k2"</span></span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">"k3"</span></span><span class="token punctuation">:</span> <span class="token nil constant">nil</span>
<span class="token punctuation">]</span>
<span class="token keyword">let</span> d5 <span class="token operator">=</span> d4<span class="token punctuation">.</span>mapValues <span class="token punctuation">&#123;</span> <span class="token short-argument">$0</span> <span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> d6 <span class="token operator">=</span> d4<span class="token punctuation">.</span>compactMapValues<span class="token punctuation">&#123;</span> <span class="token short-argument">$0</span> <span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span>d5<span class="token punctuation">)</span>
<span class="token comment">// ["k3": nil, "k1": Optional(1), "k2": Optional(2)]</span>
<span class="token function">print</span><span class="token punctuation">(</span>d6<span class="token punctuation">)</span>
<span class="token comment">// ["k1": 1, "k2": 2]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="操作符"><a href="#操作符" class="headerlink" title="操作符"></a>操作符</h3><h4 id="赋值-x3D-x3D-x3D-x3D-x2F-x3D"><a href="#赋值-x3D-x3D-x3D-x3D-x2F-x3D" class="headerlink" title="赋值 &#x3D;, +&#x3D;. -&#x3D;, *&#x3D;, &#x2F;&#x3D;"></a>赋值 &#x3D;, +&#x3D;. -&#x3D;, *&#x3D;, &#x2F;&#x3D;</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> i1 <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">var</span> i2 <span class="token operator">=</span> i1
i2 <span class="token operator">=</span> <span class="token number">2</span>
<span class="token function">print</span><span class="token punctuation">(</span>i2<span class="token punctuation">)</span> <span class="token comment">// 2</span>

i2 <span class="token operator">+=</span> <span class="token number">1</span>
<span class="token function">print</span><span class="token punctuation">(</span>i2<span class="token punctuation">)</span> <span class="token comment">// 3</span>

i2 <span class="token operator">-=</span> <span class="token number">2</span>
<span class="token function">print</span><span class="token punctuation">(</span>i2<span class="token punctuation">)</span> <span class="token comment">// 1</span>

i2 <span class="token operator">*=</span> <span class="token number">10</span>
<span class="token function">print</span><span class="token punctuation">(</span>i2<span class="token punctuation">)</span> <span class="token comment">// 10</span>

i2 <span class="token operator">/=</span> <span class="token number">2</span>
<span class="token function">print</span><span class="token punctuation">(</span>i2<span class="token punctuation">)</span> <span class="token comment">// 5</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="计算符-x2F"><a href="#计算符-x2F" class="headerlink" title="计算符 +, -, *, &#x2F;, %"></a>计算符 +, -, *, &#x2F;, %</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> i1 <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">let</span> i2 <span class="token operator">=</span> i1
<span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i1 <span class="token operator">+</span> i2 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"i"</span></span> <span class="token operator">+</span> <span class="token string-literal"><span class="token string">"1"</span></span><span class="token punctuation">)</span> <span class="token comment">// i1</span>

<span class="token comment">// 一元运算符</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token operator">-</span>i1<span class="token punctuation">)</span> <span class="token comment">// -1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="比较运算符-x3D-x3D-gt"><a href="#比较运算符-x3D-x3D-gt" class="headerlink" title="比较运算符 &#x3D;&#x3D;, &gt;"></a>比较运算符 &#x3D;&#x3D;, &gt;</h4><p>遵循 Equatable 协议可以使用 &#x3D;&#x3D; 和 !&#x3D; 来判断是否相等</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token function">print</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">></span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// false</span>

<span class="token keyword">struct</span> <span class="token class-name">S</span><span class="token punctuation">:</span> <span class="token class-name">Equatable</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> p1<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">var</span> p2<span class="token punctuation">:</span> <span class="token class-name">Int</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token class-name">S</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token class-name">S</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> s3 <span class="token operator">=</span> <span class="token class-name">S</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> s4 <span class="token operator">=</span> <span class="token class-name">S</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>

<span class="token function">print</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s2<span class="token punctuation">)</span> <span class="token comment">// false</span>
<span class="token function">print</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s3<span class="token punctuation">)</span> <span class="token comment">// false</span>
<span class="token function">print</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s4<span class="token punctuation">)</span> <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>类需要实现 &#x3D;&#x3D; 函数</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">:</span> <span class="token class-name">Equatable</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> p1<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">var</span> p2<span class="token punctuation">:</span> <span class="token class-name">Int</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>p1 <span class="token operator">=</span> p1
        <span class="token keyword">self</span><span class="token punctuation">.</span>p2 <span class="token operator">=</span> p2
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token operator">==</span> <span class="token punctuation">(</span>l<span class="token punctuation">:</span> <span class="token class-name">C</span><span class="token punctuation">,</span> r<span class="token punctuation">:</span> <span class="token class-name">C</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Bool</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> l<span class="token punctuation">.</span>p1 <span class="token operator">==</span> r<span class="token punctuation">.</span>p1 <span class="token operator">&amp;&amp;</span> l<span class="token punctuation">.</span>p2 <span class="token operator">==</span> r<span class="token punctuation">.</span>p2
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> c1 <span class="token operator">=</span> <span class="token class-name">C</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> c2 <span class="token operator">=</span> <span class="token class-name">C</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>c1 <span class="token operator">==</span> c2<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 元组比较</span>
<span class="token comment">// 会先比较第一个数，第一个无法比较才会比较第二个数</span>
<span class="token comment">// 字符串比较和字母大小还有长度有关。先比较字母大小，在比较长度</span>
<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"apple"</span></span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"apple"</span></span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"applf"</span></span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"apple"</span></span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"appl"</span></span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"apple"</span></span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"appm"</span></span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"apple"</span></span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="三元"><a href="#三元" class="headerlink" title="三元 _ ? _ : _"></a>三元 _ ? _ : _</h4><p>简化 if else 写法</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// if else</span>
<span class="token keyword">func</span> <span class="token function-definition function">f1</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> p <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"positive number"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"negative number"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 三元</span>
<span class="token keyword">func</span> <span class="token function-definition function">f2</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    p <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"positive number"</span></span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"negative number"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token function">f1</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token function">f2</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="Nil-coalescing"><a href="#Nil-coalescing" class="headerlink" title="Nil-coalescing ??"></a>Nil-coalescing ??</h4><p>简化 if let else 写法</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// if else</span>
<span class="token keyword">func</span> <span class="token function-definition function">f1</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token keyword">let</span> i <span class="token operator">=</span> p <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"p have value is </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"p is nil, use defalut value"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用 ??</span>
<span class="token keyword">func</span> <span class="token function-definition function">f2</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> i <span class="token operator">=</span> p <span class="token operator">??</span> <span class="token number">0</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"p is </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="范围-a…b"><a href="#范围-a…b" class="headerlink" title="范围 a…b"></a>范围 a…b</h4><p>简化的值范围表达方式。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 封闭范围</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token operator">...</span><span class="token number">10</span> <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 半开范围</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token operator">..&lt;</span><span class="token number">10</span> <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 单侧区间</span>
<span class="token keyword">let</span> nums <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span>
<span class="token function">print</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 7 8</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<h4 id="逻辑-amp-amp"><a href="#逻辑-amp-amp" class="headerlink" title="逻辑 !, &amp;&amp;, ||"></a>逻辑 !, &amp;&amp;, ||</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> i1 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token keyword">let</span> i2 <span class="token operator">=</span> <span class="token number">2</span>

<span class="token keyword">if</span> i1 <span class="token operator">!=</span> i2 <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>i1 <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> i2 <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"i1 and i2 not equal, and one of them is negative number."</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="恒等-x3D-x3D-x3D-x3D-x3D"><a href="#恒等-x3D-x3D-x3D-x3D-x3D" class="headerlink" title="恒等 &#x3D;&#x3D;&#x3D;, !&#x3D;&#x3D;"></a>恒等 &#x3D;&#x3D;&#x3D;, !&#x3D;&#x3D;</h4><p>恒等返回是否引用了相同实例。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">class</span> <span class="token class-name">C</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> p<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>p <span class="token operator">=</span> p
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> c1 <span class="token operator">=</span> <span class="token class-name">C</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">)</span>
<span class="token keyword">let</span> c2 <span class="token operator">=</span> <span class="token class-name">C</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">)</span>
<span class="token keyword">let</span> c3 <span class="token operator">=</span> c1

<span class="token function">print</span><span class="token punctuation">(</span>c1 <span class="token operator">===</span> c2<span class="token punctuation">)</span> <span class="token comment">// false</span>
<span class="token function">print</span><span class="token punctuation">(</span>c1 <span class="token operator">===</span> c3<span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token function">print</span><span class="token punctuation">(</span>c1 <span class="token operator">!==</span> c2<span class="token punctuation">)</span> <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h4><p>位运算符</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> i1<span class="token punctuation">:</span> <span class="token class-name">UInt8</span> <span class="token operator">=</span> <span class="token number">0b00001111</span>
<span class="token keyword">let</span> i2 <span class="token operator">=</span> <span class="token operator">~</span>i1 <span class="token comment">// Bitwise NOT Operator（按位取反运算符），取反</span>

<span class="token keyword">let</span> i3<span class="token punctuation">:</span> <span class="token class-name">UInt8</span> <span class="token operator">=</span> <span class="token number">0b00111111</span>
<span class="token keyword">let</span> i4 <span class="token operator">=</span> i1 <span class="token operator">&amp;</span> i3 <span class="token comment">// Bitwise AND Operator（按位与运算符），都为1才是1</span>
<span class="token keyword">let</span> i5 <span class="token operator">=</span> i1 <span class="token operator">|</span> i3 <span class="token comment">// Bitwise OR Operator（按位或运算符），有一个1就是1</span>
<span class="token keyword">let</span> i6 <span class="token operator">=</span> i1 <span class="token operator">^</span> i3 <span class="token comment">// Bitwise XOR Operator（按位异或运算符），不同为1，相同为0</span>

<span class="token function">print</span><span class="token punctuation">(</span>i1<span class="token punctuation">,</span>i2<span class="token punctuation">,</span>i3<span class="token punctuation">,</span>i4<span class="token punctuation">,</span>i5<span class="token punctuation">,</span>i6<span class="token punctuation">)</span>

<span class="token comment">// &lt;&lt; 按位左移，>> 按位右移</span>
<span class="token keyword">let</span> i7 <span class="token operator">=</span> i1 <span class="token operator">&lt;&lt;</span> <span class="token number">1</span>
<span class="token keyword">let</span> i8 <span class="token operator">=</span> i1 <span class="token operator">>></span> <span class="token number">2</span>
<span class="token function">print</span><span class="token punctuation">(</span>i7<span class="token punctuation">,</span>i8<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>溢出运算符，有 &amp;+、&amp;- 和 &amp;*</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">var</span> i1 <span class="token operator">=</span> <span class="token class-name">Int</span><span class="token punctuation">.</span>max
<span class="token function">print</span><span class="token punctuation">(</span>i1<span class="token punctuation">)</span> <span class="token comment">// 9223372036854775807</span>
i1 <span class="token operator">=</span> i1 <span class="token operator">&amp;+</span> <span class="token number">1</span>
<span class="token function">print</span><span class="token punctuation">(</span>i1<span class="token punctuation">)</span> <span class="token comment">// -9223372036854775808</span>
i1 <span class="token operator">=</span> i1 <span class="token operator">&amp;+</span> <span class="token number">10</span>
<span class="token function">print</span><span class="token punctuation">(</span>i1<span class="token punctuation">)</span> <span class="token comment">// -9223372036854775798</span>

<span class="token keyword">var</span> i2 <span class="token operator">=</span> <span class="token class-name">UInt</span><span class="token punctuation">.</span>max
i2 <span class="token operator">=</span> i2 <span class="token operator">&amp;+</span> <span class="token number">1</span>
<span class="token function">print</span><span class="token punctuation">(</span>i2<span class="token punctuation">)</span> <span class="token comment">// 0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>运算符函数包括前缀运算符、后缀运算符、复合赋值运算符以及等价运算符。另，还可以自定义运算符，新的运算符要用 operator 关键字进行定义，同时要指定 prefix、infix 或者 postfix 修饰符。</p>
<h3 id="基础库"><a href="#基础库" class="headerlink" title="基础库"></a>基础库</h3><h4 id="时间"><a href="#时间" class="headerlink" title="时间"></a>时间</h4><p>Date 的基本用法如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> now <span class="token operator">=</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// Date 转 时间戳</span>
<span class="token keyword">let</span> interval <span class="token operator">=</span> now<span class="token punctuation">.</span>timeIntervalSince1970 <span class="token comment">// 时间戳</span>
<span class="token keyword">let</span> df <span class="token operator">=</span> <span class="token class-name">DateFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>dateFormat <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"yyyy 年 MM 月 dd 日 HH:mm:ss"</span></span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"时间戳：</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation"><span class="token class-name">Int</span><span class="token punctuation">(</span>interval<span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span> <span class="token comment">// 时间戳：1642399901</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"格式化的时间："</span></span> <span class="token operator">+</span> df<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> now<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 格式化的时间：2022 年 01 月 17 日 14:11:41</span>
df<span class="token punctuation">.</span>dateStyle <span class="token operator">=</span> <span class="token punctuation">.</span>short
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"short 样式时间："</span></span> <span class="token operator">+</span> df<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> now<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// short 样式时间：2022/1/17</span>
df<span class="token punctuation">.</span>locale <span class="token operator">=</span> <span class="token class-name">Locale</span><span class="token punctuation">(</span>identifier<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"zh_Hans_CN"</span></span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>dateStyle <span class="token operator">=</span> <span class="token punctuation">.</span>full
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"full 样式时间："</span></span> <span class="token operator">+</span> df<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> now<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// full 样式时间：2022年1月17日 星期一</span>

<span class="token comment">// 时间戳转 Date</span>
<span class="token keyword">let</span> date <span class="token operator">=</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>timeIntervalSince1970<span class="token punctuation">:</span> interval<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span> <span class="token comment">// 2022-01-17 06:11:41 +0000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>复杂的时间操作，比如说 GitHub 接口使用的是 ISO 标准，RSS 输出的是 RSS 标准字符串，不同标准对应不同时区的时间计算处理，可以使用开源库  <a target="_blank" rel="noopener" href="https://github.com/malcommac/SwiftDate">SwiftDate</a>  来完成。示例代码如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">SwiftDate</span>

<span class="token comment">// 使用 SwiftDate 库</span>
<span class="token keyword">let</span> cn <span class="token operator">=</span> <span class="token class-name">Region</span><span class="token punctuation">(</span>zone<span class="token punctuation">:</span> <span class="token class-name">Zones</span><span class="token punctuation">.</span>asiaShanghai<span class="token punctuation">,</span> locale<span class="token punctuation">:</span> <span class="token class-name">Locales</span><span class="token punctuation">.</span>chineseChina<span class="token punctuation">)</span>
<span class="token class-name">SwiftDate</span><span class="token punctuation">.</span>defaultRegion <span class="token operator">=</span> cn
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"2008-02-14 23:12:14"</span></span><span class="token punctuation">.</span><span class="token function">toDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span>year <span class="token operator">??</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span> <span class="token comment">// 2008</span>

<span class="token keyword">let</span> d1 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"2022-01-17T23:20:35"</span></span><span class="token punctuation">.</span><span class="token function">toISODate</span><span class="token punctuation">(</span>region<span class="token punctuation">:</span> cn<span class="token punctuation">)</span>
<span class="token keyword">guard</span> <span class="token keyword">let</span> d1 <span class="token operator">=</span> d1 <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span>
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span>d1<span class="token punctuation">.</span>minute<span class="token punctuation">)</span> <span class="token comment">// 20</span>
<span class="token keyword">let</span> d2 <span class="token operator">=</span> d1 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">.</span>minutes
<span class="token function">print</span><span class="token punctuation">(</span>d2<span class="token punctuation">.</span>minute<span class="token punctuation">)</span>

<span class="token comment">// 两个 DateInRegion 相差时间 interval</span>
<span class="token keyword">let</span> i1 <span class="token operator">=</span> <span class="token class-name">DateInRegion</span><span class="token punctuation">(</span><span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> region<span class="token punctuation">:</span> cn<span class="token punctuation">)</span> <span class="token operator">-</span> d1
<span class="token keyword">let</span> s1 <span class="token operator">=</span> i1<span class="token punctuation">.</span>toString <span class="token punctuation">&#123;</span>
    <span class="token short-argument">$0</span><span class="token punctuation">.</span>maximumUnitCount <span class="token operator">=</span> <span class="token number">4</span>
    <span class="token short-argument">$0</span><span class="token punctuation">.</span>allowedUnits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">.</span>day<span class="token punctuation">,</span> <span class="token punctuation">.</span>hour<span class="token punctuation">,</span> <span class="token punctuation">.</span>minute<span class="token punctuation">]</span>
    <span class="token short-argument">$0</span><span class="token punctuation">.</span>collapsesLargestUnit <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token short-argument">$0</span><span class="token punctuation">.</span>unitsStyle <span class="token operator">=</span> <span class="token punctuation">.</span>abbreviated
    <span class="token short-argument">$0</span><span class="token punctuation">.</span>locale <span class="token operator">=</span> <span class="token class-name">Locales</span><span class="token punctuation">.</span>chineseChina
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token comment">// 9小时45分钟</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="格式化"><a href="#格式化" class="headerlink" title="格式化"></a>格式化</h4><p>使用标准库的格式来描述不同场景的情况可以不用去考虑由于不同地区的区别，这些在标准库里就可以自动完成了。</p>
<p>描述两个时间之间相差多长时间</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 计算两个时间之间相差多少时间，支持多种语言字符串</span>
<span class="token keyword">let</span> d1 <span class="token operator">=</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>timeIntervalSince1970 <span class="token operator">-</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span>
<span class="token keyword">let</span> f1 <span class="token operator">=</span> <span class="token class-name">RelativeDateTimeFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
f1<span class="token punctuation">.</span>dateTimeStyle <span class="token operator">=</span> <span class="token punctuation">.</span>named
f1<span class="token punctuation">.</span>formattingContext <span class="token operator">=</span> <span class="token punctuation">.</span>beginningOfSentence
f1<span class="token punctuation">.</span>locale <span class="token operator">=</span> <span class="token class-name">Locale</span><span class="token punctuation">(</span>identifier<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"zh_Hans_CN"</span></span><span class="token punctuation">)</span>
<span class="token keyword">let</span> str <span class="token operator">=</span> f1<span class="token punctuation">.</span><span class="token function">localizedString</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>timeIntervalSince1970<span class="token punctuation">:</span> d1<span class="token punctuation">)</span><span class="token punctuation">,</span> relativeTo<span class="token punctuation">:</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token comment">// 昨天</span>

<span class="token comment">// 简写</span>
<span class="token keyword">let</span> str2 <span class="token operator">=</span> <span class="token class-name">Date</span><span class="token punctuation">.</span>now<span class="token punctuation">.</span><span class="token function">addingTimeInterval</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">formatted</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">relative</span><span class="token punctuation">(</span>presentation<span class="token punctuation">:</span> <span class="token punctuation">.</span>named<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>str2<span class="token punctuation">)</span> <span class="token comment">// yesterday</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>描述多个事物</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 描述多个事物</span>
<span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token class-name">ListFormatter</span><span class="token punctuation">.</span><span class="token function">localizedString</span><span class="token punctuation">(</span>byJoining<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"冬天"</span></span><span class="token punctuation">,</span><span class="token string-literal"><span class="token string">"春天"</span></span><span class="token punctuation">,</span><span class="token string-literal"><span class="token string">"夏天"</span></span><span class="token punctuation">,</span><span class="token string-literal"><span class="token string">"秋天"</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<p>描述名字</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 名字</span>
<span class="token keyword">let</span> f2 <span class="token operator">=</span> <span class="token class-name">PersonNameComponentsFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> nc1 <span class="token operator">=</span> <span class="token class-name">PersonNameComponents</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
nc1<span class="token punctuation">.</span>familyName <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"戴"</span></span>
nc1<span class="token punctuation">.</span>givenName <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"铭"</span></span>
nc1<span class="token punctuation">.</span>nickname <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"铭哥"</span></span>
<span class="token function">print</span><span class="token punctuation">(</span>f2<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> nc1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 戴铭</span>
f2<span class="token punctuation">.</span>style <span class="token operator">=</span> <span class="token punctuation">.</span>short
<span class="token function">print</span><span class="token punctuation">(</span>f2<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> nc1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 铭哥</span>
f2<span class="token punctuation">.</span>style <span class="token operator">=</span> <span class="token punctuation">.</span>abbreviated
<span class="token function">print</span><span class="token punctuation">(</span>f2<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> nc1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 戴</span>

<span class="token keyword">var</span> nc2 <span class="token operator">=</span> <span class="token class-name">PersonNameComponents</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
nc2<span class="token punctuation">.</span>familyName <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"Dai"</span></span>
nc2<span class="token punctuation">.</span>givenName <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"Ming"</span></span>
nc2<span class="token punctuation">.</span>nickname <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"Starming"</span></span>
f2<span class="token punctuation">.</span>style <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token keyword">default</span>
<span class="token function">print</span><span class="token punctuation">(</span>f2<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> nc2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Ming Dai</span>
f2<span class="token punctuation">.</span>style <span class="token operator">=</span> <span class="token punctuation">.</span>short
<span class="token function">print</span><span class="token punctuation">(</span>f2<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> nc2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Starming</span>
f2<span class="token punctuation">.</span>style <span class="token operator">=</span> <span class="token punctuation">.</span>abbreviated
<span class="token function">print</span><span class="token punctuation">(</span>f2<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> nc2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// MD</span>

<span class="token comment">// 取出名</span>
<span class="token keyword">let</span> componets <span class="token operator">=</span> f2<span class="token punctuation">.</span><span class="token function">personNameComponents</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"戴铭"</span></span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>componets<span class="token operator">?</span><span class="token punctuation">.</span>givenName <span class="token operator">??</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span> <span class="token comment">// 铭</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>描述数字</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 数字</span>
<span class="token keyword">let</span> f3 <span class="token operator">=</span> <span class="token class-name">NumberFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
f3<span class="token punctuation">.</span>locale <span class="token operator">=</span> <span class="token class-name">Locale</span><span class="token punctuation">(</span>identifier<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"zh_Hans_CN"</span></span><span class="token punctuation">)</span>
f3<span class="token punctuation">.</span>numberStyle <span class="token operator">=</span> <span class="token punctuation">.</span>currency
<span class="token function">print</span><span class="token punctuation">(</span>f3<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> <span class="token number">123456</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span> <span class="token comment">// ¥123,456.00</span>
f3<span class="token punctuation">.</span>numberStyle <span class="token operator">=</span> <span class="token punctuation">.</span>percent
<span class="token function">print</span><span class="token punctuation">(</span>f3<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> <span class="token number">123456</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span> <span class="token comment">// 12,345,600%</span>

<span class="token keyword">let</span> n1 <span class="token operator">=</span> <span class="token number">1.23456</span>
<span class="token keyword">let</span> n1Str <span class="token operator">=</span> n1<span class="token punctuation">.</span><span class="token function">formatted</span><span class="token punctuation">(</span><span class="token punctuation">.</span>number<span class="token punctuation">.</span><span class="token function">precision</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">fractionLength</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rounded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>n1Str<span class="token punctuation">)</span> <span class="token comment">// 1.235</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>描述地址</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 地址</span>
<span class="token keyword">import</span> <span class="token class-name">Contacts</span>

<span class="token keyword">let</span> f4 <span class="token operator">=</span> <span class="token class-name">CNPostalAddressFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> address <span class="token operator">=</span> <span class="token class-name">CNMutablePostalAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
address<span class="token punctuation">.</span>street <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"海淀区王庄路XX号院X号楼X门XXX"</span></span>
address<span class="token punctuation">.</span>postalCode <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"100083"</span></span>
address<span class="token punctuation">.</span>city <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"北京"</span></span>
address<span class="token punctuation">.</span>country <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"中国"</span></span>
<span class="token function">print</span><span class="token punctuation">(</span>f4<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> address<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">/// 海淀区王庄路XX号院X号楼X门XXX</span>
<span class="token comment">/// 北京 100083</span>
<span class="token comment">/// 中国</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="度量值"><a href="#度量值" class="headerlink" title="度量值"></a>度量值</h4><p>标准库里的物理量，在这个文档里有详细列出，包括角度、平方米等。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 参考：https://developer.apple.com/documentation/foundation/nsdimension</span>
<span class="token keyword">let</span> m1 <span class="token operator">=</span> <span class="token class-name">Measurement</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> unit<span class="token punctuation">:</span> <span class="token class-name">UnitLength</span><span class="token punctuation">.</span>kilometers<span class="token punctuation">)</span>
<span class="token keyword">let</span> m2 <span class="token operator">=</span> m1<span class="token punctuation">.</span><span class="token function">converted</span><span class="token punctuation">(</span>to<span class="token punctuation">:</span> <span class="token punctuation">.</span>meters<span class="token punctuation">)</span> <span class="token comment">// 千米转米</span>
<span class="token function">print</span><span class="token punctuation">(</span>m2<span class="token punctuation">)</span> <span class="token comment">// 1000.0 m</span>
<span class="token comment">// 度量值转为本地化的值</span>
<span class="token keyword">let</span> mf <span class="token operator">=</span> <span class="token class-name">MeasurementFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
mf<span class="token punctuation">.</span>locale <span class="token operator">=</span> <span class="token class-name">Locale</span><span class="token punctuation">(</span>identifier<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"zh_Hans_CN"</span></span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>mf<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> m1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 1公里</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>一些物理公式供参考：</p>
<pre class="line-numbers language-none"><code class="language-none">面积 &#x3D; 长度 × 长度
体积 &#x3D; 长度 × 长度 × 长度 &#x3D; 面积 × 长度

速度&#x3D;长度&#x2F;时间
加速度&#x3D;速度&#x2F;时间

力 &#x3D; 质量 × 加速度
扭矩 &#x3D; 力 × 长度
压力 &#x3D; 力 &#x2F; 面积

密度&#x3D;质量 &#x2F; 体积
能量 &#x3D; 功率 × 时间
电阻 &#x3D; 电压 &#x2F; 电流<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="Data"><a href="#Data" class="headerlink" title="Data"></a>Data</h4><p>数据压缩和解压</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 对数据的压缩</span>
<span class="token keyword">let</span> d1 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？"</span></span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>using<span class="token punctuation">:</span> <span class="token punctuation">.</span>utf8<span class="token punctuation">)</span><span class="token operator">!</span> <span class="token keyword">as</span> <span class="token class-name">NSData</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"ori </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">d1<span class="token punctuation">.</span>count</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> bytes"</span></span><span class="token punctuation">)</span>
<span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">/// 压缩算法</span>
    <span class="token comment">/// * lz4</span>
    <span class="token comment">/// * lzma</span>
    <span class="token comment">/// * zlib</span>
    <span class="token comment">/// * lzfse</span>
    <span class="token keyword">let</span> compressed <span class="token operator">=</span> <span class="token keyword">try</span> d1<span class="token punctuation">.</span><span class="token function">compressed</span><span class="token punctuation">(</span>using<span class="token punctuation">:</span> <span class="token punctuation">.</span>zlib<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"comp </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">compressed<span class="token punctuation">.</span>count</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> bytes"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment">// 对数据解压</span>
    <span class="token keyword">let</span> decomressed <span class="token operator">=</span> <span class="token keyword">try</span> compressed<span class="token punctuation">.</span><span class="token function">decompressed</span><span class="token punctuation">(</span>using<span class="token punctuation">:</span> <span class="token punctuation">.</span>zlib<span class="token punctuation">)</span>
    <span class="token keyword">let</span> deStr <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> decomressed <span class="token keyword">as</span> <span class="token class-name">Data</span><span class="token punctuation">,</span> encoding<span class="token punctuation">:</span> <span class="token punctuation">.</span>utf8<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span>deStr <span class="token operator">??</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token comment">/// ori 297 bytes</span>
<span class="token comment">/// comp 37 bytes</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="文件"><a href="#文件" class="headerlink" title="文件"></a>文件</h4><p>文件的一些基本操作的代码如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> path1 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"/Users/mingdai/Downloads/1.html"</span></span>
<span class="token keyword">let</span> path2 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"/Users/mingdai/Documents/GitHub/"</span></span>

<span class="token keyword">let</span> u1 <span class="token operator">=</span> <span class="token function">URL</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> path1<span class="token punctuation">)</span>
<span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 写入</span>
    <span class="token keyword">let</span> url1 <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token class-name">FileManager</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>itemReplacementDirectory<span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>userDomainMask<span class="token punctuation">,</span> appropriateFor<span class="token punctuation">:</span> u1<span class="token punctuation">,</span> create<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// 保证原子性安全保存</span>
    <span class="token function">print</span><span class="token punctuation">(</span>url1<span class="token punctuation">)</span>

    <span class="token comment">// 读取</span>
    <span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token class-name">String</span><span class="token punctuation">(</span>contentsOfFile<span class="token punctuation">:</span> path1<span class="token punctuation">,</span> encoding<span class="token punctuation">:</span> <span class="token punctuation">.</span>utf8<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span>

<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

<span class="token comment">// 检查路径是否可用</span>
<span class="token keyword">let</span> u2 <span class="token operator">=</span> <span class="token function">URL</span><span class="token punctuation">(</span>fileURLWithPath<span class="token punctuation">:</span>path2<span class="token punctuation">)</span>
<span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> values <span class="token operator">=</span> <span class="token keyword">try</span> u2<span class="token punctuation">.</span><span class="token function">resourceValues</span><span class="token punctuation">(</span>forKeys<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">.</span>volumeAvailableCapacityForImportantUsageKey<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">let</span> capacity <span class="token operator">=</span> values<span class="token punctuation">.</span>volumeAvailableCapacityForImportantUsage <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"可用: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">capacity</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"不可用"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"错误: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">error<span class="token punctuation">.</span>localizedDescription</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>怎么遍历多级目录结构中的文件呢？看下面的代码的实现：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 遍历路径下所有目录</span>
<span class="token keyword">let</span> u3 <span class="token operator">=</span> <span class="token function">URL</span><span class="token punctuation">(</span>fileURLWithPath<span class="token punctuation">:</span> <span class="token class-name">FileManager</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span>currentDirectoryPath<span class="token punctuation">)</span>
<span class="token keyword">let</span> fm <span class="token operator">=</span> <span class="token class-name">FileManager</span><span class="token punctuation">.</span><span class="token keyword">default</span>
fm<span class="token punctuation">.</span><span class="token function">enumerator</span><span class="token punctuation">(</span>atPath<span class="token punctuation">:</span> u3<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> path <span class="token keyword">in</span>
    <span class="token keyword">guard</span> <span class="token keyword">let</span> path <span class="token operator">=</span> path <span class="token keyword">as</span><span class="token operator">?</span> <span class="token class-name">String</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token function">URL</span><span class="token punctuation">(</span>fileURLWithPath<span class="token punctuation">:</span> path<span class="token punctuation">,</span> relativeTo<span class="token punctuation">:</span> u3<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span>lastPathComponent<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以使用 FileWrapper 来创建文件夹和文件。举个例子：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// FileWrapper 的使用</span>
<span class="token comment">// 创建文件</span>
<span class="token keyword">let</span> f1 <span class="token operator">=</span> <span class="token class-name">FileWrapper</span><span class="token punctuation">(</span>regularFileWithContents<span class="token punctuation">:</span> <span class="token class-name">Data</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"# 第 n 个文件\n ## 标题"</span></span><span class="token punctuation">.</span>utf8<span class="token punctuation">)</span><span class="token punctuation">)</span>
f1<span class="token punctuation">.</span>fileAttributes<span class="token punctuation">[</span><span class="token class-name">FileAttributeKey</span><span class="token punctuation">.</span>creationDate<span class="token punctuation">.</span>rawValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
f1<span class="token punctuation">.</span>fileAttributes<span class="token punctuation">[</span><span class="token class-name">FileAttributeKey</span><span class="token punctuation">.</span>modificationDate<span class="token punctuation">.</span>rawValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 创建文件夹</span>
<span class="token keyword">let</span> folder1 <span class="token operator">=</span> <span class="token class-name">FileWrapper</span><span class="token punctuation">(</span>directoryWithFileWrappers<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token string-literal"><span class="token string">"file1.md"</span></span><span class="token punctuation">:</span> f1
<span class="token punctuation">]</span><span class="token punctuation">)</span>
folder1<span class="token punctuation">.</span>fileAttributes<span class="token punctuation">[</span><span class="token class-name">FileAttributeKey</span><span class="token punctuation">.</span>creationDate<span class="token punctuation">.</span>rawValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
folder1<span class="token punctuation">.</span>fileAttributes<span class="token punctuation">[</span><span class="token class-name">FileAttributeKey</span><span class="token punctuation">.</span>modificationDate<span class="token punctuation">.</span>rawValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">try</span> folder1<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>
        to<span class="token punctuation">:</span> <span class="token function">URL</span><span class="token punctuation">(</span>fileURLWithPath<span class="token punctuation">:</span> <span class="token class-name">FileManager</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span>currentDirectoryPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendingPathComponent</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"NewFolder"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        options<span class="token punctuation">:</span> <span class="token punctuation">.</span>atomic<span class="token punctuation">,</span>
        originalContentsURL<span class="token punctuation">:</span> <span class="token nil constant">nil</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">FileManager</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span>currentDirectoryPath<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面代码写起来比较繁琐，对 FileWrapper 更好的封装可以参考这篇文章《 <a target="_blank" rel="noopener" href="https://heberti.com/posts/filewrapper/">A Type-Safe FileWrapper | Heberti Almeida</a> 》。</p>
<p>文件读写处理完整能力可以参看这个库  <a target="_blank" rel="noopener" href="https://github.com/JohnSundell/Files">GitHub - JohnSundell&#x2F;Files: A nicer way to handle files &amp; folders in Swift</a> </p>
<p>本地或者网络上，比如网盘和FTP的文件发生变化时，怎样知道能够观察到呢？</p>
<p>通过 HTTPHeader 里的 If-Modified-Since、Last-Modified、If-None-Match 和 Etag 等字段来判断文件的变化，本地则是使用 DispatchSource.makeFileSystemObjectSource 来进行的文件变化监听。可以参考  <a target="_blank" rel="noopener" href="https://github.com/krzysztofzablocki/KZFileWatchers">KZFileWatchers</a>  库的做法。</p>
<h4 id="Scanner"><a href="#Scanner" class="headerlink" title="Scanner"></a>Scanner</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"""
one1,
two2,
three3.
"""</span></span>
<span class="token keyword">let</span> sn1 <span class="token operator">=</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> s1<span class="token punctuation">)</span>
<span class="token keyword">while</span> <span class="token operator">!</span>sn1<span class="token punctuation">.</span>isAtEnd <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token keyword">let</span> r1 <span class="token operator">=</span> sn1<span class="token punctuation">.</span><span class="token function">scanUpToCharacters</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> <span class="token punctuation">.</span>newlines<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span>r1 <span class="token keyword">as</span> <span class="token class-name">String</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/// one1,</span>
<span class="token comment">/// two2,</span>
<span class="token comment">/// three3.</span>

<span class="token comment">// 找出数字</span>
<span class="token keyword">let</span> sn2 <span class="token operator">=</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> s1<span class="token punctuation">)</span>
sn2<span class="token punctuation">.</span>charactersToBeSkipped <span class="token operator">=</span> <span class="token class-name">CharacterSet</span><span class="token punctuation">.</span>decimalDigits<span class="token punctuation">.</span>inverted <span class="token comment">// 不是数字的就跳过</span>
<span class="token keyword">var</span> p<span class="token punctuation">:</span> <span class="token class-name">Int</span> <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">while</span> <span class="token operator">!</span>sn2<span class="token punctuation">.</span>isAtEnd <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> sn2<span class="token punctuation">.</span><span class="token function">scanInt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/// 1</span>
<span class="token comment">/// 2</span>
<span class="token comment">/// 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面的代码还不是那么 Swifty，可以通过用AnySequence和AnyIterator来包装下，将序列中的元素推迟到实际需要时再来处理，这样性能也会更好些。具体实现可以参看《 <a target="_blank" rel="noopener" href="https://www.swiftbysundell.com/articles/string-parsing-in-swift/">String parsing in Swift</a> 》这篇文章。</p>
<h4 id="AttributeString"><a href="#AttributeString" class="headerlink" title="AttributeString"></a>AttributeString</h4><p>效果如下：</p>
<p><img  srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://user-images.githubusercontent.com/251980/150132322-20c5c2d4-6452-4d06-9202-4b93cffd8133.png" class="lozad post-image"src="https://user-images.githubusercontent.com/251980/150132322-20c5c2d4-6452-4d06-9202-4b93cffd8133.png"></p>
<p>代码如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">var</span> aStrs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">AttributedString</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> aStr1 <span class="token operator">=</span> <span class="token class-name">AttributedString</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"""
标题
正文内容，具体查看链接。
这里摘出第一个重点，还要强调的内容。
"""</span></span><span class="token punctuation">)</span>
<span class="token comment">// 标题</span>
<span class="token keyword">let</span> title <span class="token operator">=</span> aStr1<span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span>of<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"标题"</span></span><span class="token punctuation">)</span>
<span class="token keyword">guard</span> <span class="token keyword">let</span> title <span class="token operator">=</span> title <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> aStrs
<span class="token punctuation">&#125;</span>

<span class="token keyword">var</span> c1 <span class="token operator">=</span> <span class="token class-name">AttributeContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 可复用容器</span>
c1<span class="token punctuation">.</span>inlinePresentationIntent <span class="token operator">=</span> <span class="token punctuation">.</span>stronglyEmphasized
c1<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token punctuation">.</span>largeTitle
aStr1<span class="token punctuation">[</span>title<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">setAttributes</span><span class="token punctuation">(</span>c1<span class="token punctuation">)</span>

<span class="token comment">// 链接</span>
<span class="token keyword">let</span> link <span class="token operator">=</span> aStr1<span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span>of<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"链接"</span></span><span class="token punctuation">)</span>
<span class="token keyword">guard</span> <span class="token keyword">let</span> link <span class="token operator">=</span> link <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> aStrs
<span class="token punctuation">&#125;</span>

<span class="token keyword">var</span> c2 <span class="token operator">=</span> <span class="token class-name">AttributeContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 链接</span>
c2<span class="token punctuation">.</span>strokeColor <span class="token operator">=</span> <span class="token punctuation">.</span>blue
c2<span class="token punctuation">.</span>link <span class="token operator">=</span> <span class="token function">URL</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"https://ming1016.github.io/"</span></span><span class="token punctuation">)</span>
aStr1<span class="token punctuation">[</span>link<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">setAttributes</span><span class="token punctuation">(</span>c2<span class="token punctuation">.</span><span class="token function">merging</span><span class="token punctuation">(</span>c1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 合并 AttributeContainer</span>

<span class="token comment">// Runs</span>
<span class="token keyword">let</span> i1 <span class="token operator">=</span> aStr1<span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span>of<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"重点"</span></span><span class="token punctuation">)</span>
<span class="token keyword">let</span> i2 <span class="token operator">=</span> aStr1<span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span>of<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"强调"</span></span><span class="token punctuation">)</span>
<span class="token keyword">guard</span> <span class="token keyword">let</span> i1 <span class="token operator">=</span> i1<span class="token punctuation">,</span> <span class="token keyword">let</span> i2 <span class="token operator">=</span> i2 <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> aStrs
<span class="token punctuation">&#125;</span>

<span class="token keyword">var</span> c3 <span class="token operator">=</span> <span class="token class-name">AttributeContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
c3<span class="token punctuation">.</span>foregroundColor <span class="token operator">=</span> <span class="token punctuation">.</span>yellow
c3<span class="token punctuation">.</span>inlinePresentationIntent <span class="token operator">=</span> <span class="token punctuation">.</span>stronglyEmphasized
aStr1<span class="token punctuation">[</span>i1<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">setAttributes</span><span class="token punctuation">(</span>c3<span class="token punctuation">)</span>
aStr1<span class="token punctuation">[</span>i2<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">setAttributes</span><span class="token punctuation">(</span>c3<span class="token punctuation">)</span>

<span class="token keyword">for</span> r <span class="token keyword">in</span> aStr1<span class="token punctuation">.</span>runs <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"-------------"</span></span><span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>attributes<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

aStrs<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>aStr1<span class="token punctuation">)</span>

<span class="token comment">// Markdown</span>
<span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> aStr2 <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token class-name">AttributedString</span><span class="token punctuation">(</span>markdown<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"""
    内容[链接](https://ming1016.github.io/)。需要**强调**的内容。
    """</span></span><span class="token punctuation">)</span>
    
    aStrs<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>aStr2<span class="token punctuation">)</span>
    
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>SwiftUI 的 Text 可以直接读取 AttributedString 来进行显示。</p>
<h4 id="随机"><a href="#随机" class="headerlink" title="随机"></a>随机</h4><p>用法：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> ri <span class="token operator">=</span> <span class="token class-name">Int</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token operator">..&lt;</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>ri<span class="token punctuation">)</span> <span class="token comment">// 0到10随机数</span>
<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
<span class="token function">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">randomElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 数组中随机取个数</span>
<span class="token function">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">shuffled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 随机打乱数组顺序</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="UserDefaults"><a href="#UserDefaults" class="headerlink" title="UserDefaults"></a>UserDefaults</h4><p>使用方法如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">enum</span> <span class="token class-name">UDKey</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">let</span> k1 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"token"</span></span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> ud <span class="token operator">=</span> <span class="token class-name">UserDefaults</span><span class="token punctuation">.</span>standard
ud<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"xxxxxx"</span></span><span class="token punctuation">,</span> forKey<span class="token punctuation">:</span> <span class="token class-name">UDKey</span><span class="token punctuation">.</span>k1<span class="token punctuation">)</span>
<span class="token keyword">let</span> tk <span class="token operator">=</span> ud<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>forKey<span class="token punctuation">:</span> <span class="token class-name">UDKey</span><span class="token punctuation">.</span>k1<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>tk <span class="token operator">??</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="模式"><a href="#模式" class="headerlink" title="模式"></a>模式</h3><h4 id="单例"><a href="#单例" class="headerlink" title="单例"></a>单例</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">S</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">let</span> shared <span class="token operator">=</span> <span class="token class-name">S</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 防止实例初始化</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="系统及设备"><a href="#系统及设备" class="headerlink" title="系统及设备"></a>系统及设备</h3><h4 id="系统判断"><a href="#系统判断" class="headerlink" title="系统判断"></a>系统判断</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token directive property"><span class="token directive-name">#if</span> os<span class="token punctuation">(</span>tvOS<span class="token punctuation">)</span></span>
     <span class="token comment">// do something in tvOS</span>
<span class="token directive property"><span class="token directive-name">#elseif</span> os<span class="token punctuation">(</span>iOS<span class="token punctuation">)</span></span>
     <span class="token comment">// do somthing in iOS</span>
<span class="token directive property"><span class="token directive-name">#elseif</span> os<span class="token punctuation">(</span>macOS<span class="token punctuation">)</span></span>
    <span class="token comment">// do somthing in macOS</span>
<span class="token directive property"><span class="token directive-name">#endif</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="版本兼容"><a href="#版本兼容" class="headerlink" title="版本兼容"></a>版本兼容</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 版本</span>
<span class="token attribute atrule">@available</span><span class="token punctuation">(</span>iOS <span class="token number">15</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">)</span>
<span class="token keyword">func</span> <span class="token function-definition function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

<span class="token punctuation">&#125;</span>

<span class="token comment">// 版本检查</span>
<span class="token keyword">if</span> <span class="token other-directive property">#available</span><span class="token punctuation">(</span>iOS <span class="token number">15</span><span class="token punctuation">,</span> macOS <span class="token number">12</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// nothing happen</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="canImport-判断库是否可使用"><a href="#canImport-判断库是否可使用" class="headerlink" title="canImport 判断库是否可使用"></a>canImport 判断库是否可使用</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token directive property"><span class="token directive-name">#if</span> canImport<span class="token punctuation">(</span>SpriteKit<span class="token punctuation">)</span></span>
   <span class="token comment">// iOS 等苹果系统执行</span>
<span class="token directive property"><span class="token directive-name">#else</span></span>
   <span class="token comment">// 非苹果系统</span>
<span class="token directive property"><span class="token directive-name">#endif</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="targetEnvironment-环境的判断"><a href="#targetEnvironment-环境的判断" class="headerlink" title="targetEnvironment 环境的判断"></a>targetEnvironment 环境的判断</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token directive property"><span class="token directive-name">#if</span> targetEnvironment<span class="token punctuation">(</span>simulator<span class="token punctuation">)</span></span>
   <span class="token comment">// 模拟器</span>
<span class="token directive property"><span class="token directive-name">#else</span></span>
   <span class="token comment">// 真机</span>
<span class="token directive property"><span class="token directive-name">#endif</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="自带属性包装"><a href="#自带属性包装" class="headerlink" title="自带属性包装"></a>自带属性包装</h3><h4 id="resultBuilder"><a href="#resultBuilder" class="headerlink" title="@resultBuilder"></a>@resultBuilder</h4><p>结果生成器（Result builders），通过传递序列创建新值，SwiftUI就是使用的结果生成器将多个视图生成一个视图</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token attribute atrule">@resultBuilder</span>
<span class="token keyword">struct</span> <span class="token constant">RBS</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 基本闭包支持</span>
    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">buildBlock</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> components<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token operator">...</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Int</span> <span class="token punctuation">&#123;</span>
        components<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> partialResult<span class="token punctuation">,</span> i <span class="token keyword">in</span>
            partialResult <span class="token operator">+</span> i
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// 支持条件判断</span>
    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">buildEither</span><span class="token punctuation">(</span>first component<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Int</span> <span class="token punctuation">&#123;</span>
        component
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">buildEither</span><span class="token punctuation">(</span>second component<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Int</span> <span class="token punctuation">&#123;</span>
        component
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// 支持循环</span>
    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">buildArray</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> components<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Int</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Int</span> <span class="token punctuation">&#123;</span>
        components<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> partialResult<span class="token punctuation">,</span> i <span class="token keyword">in</span>
            partialResult <span class="token operator">+</span> i
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token constant">RBS</span><span class="token punctuation">.</span><span class="token function">buildBlock</span><span class="token punctuation">(</span>
    <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token number">3</span>
<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">// 6</span>

<span class="token comment">// 应用到函数中</span>
<span class="token attribute atrule">@RBS</span> <span class="token keyword">func</span> <span class="token function-definition function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Int</span> <span class="token punctuation">&#123;</span>
    <span class="token number">1</span>
    <span class="token number">2</span>
    <span class="token number">3</span>
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 6</span>

<span class="token comment">// 设置了 buildEither 就可以在闭包中进行条件判断。</span>
<span class="token attribute atrule">@RBS</span> <span class="token keyword">func</span> <span class="token function-definition function">f2</span><span class="token punctuation">(</span>stopAtThree<span class="token punctuation">:</span> <span class="token class-name">Bool</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Int</span> <span class="token punctuation">&#123;</span>
    <span class="token number">1</span>
    <span class="token number">2</span>
    <span class="token number">3</span>
    <span class="token keyword">if</span> stopAtThree <span class="token operator">==</span> <span class="token boolean">true</span> <span class="token punctuation">&#123;</span>
        <span class="token number">0</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token number">4</span>
        <span class="token number">5</span>
        <span class="token number">6</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">f2</span><span class="token punctuation">(</span>stopAtThree<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 21</span>

<span class="token comment">// 设置了 buildArray 就可以在闭包内使用循环了</span>
<span class="token attribute atrule">@RBS</span> <span class="token keyword">func</span> <span class="token function-definition function">f3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Int</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">...</span><span class="token number">3</span> <span class="token punctuation">&#123;</span>
        i <span class="token operator">*</span> <span class="token number">2</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">f3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 12</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="dynamicMemberLookup-动态成员查询"><a href="#dynamicMemberLookup-动态成员查询" class="headerlink" title="@dynamicMemberLookup 动态成员查询"></a>@dynamicMemberLookup 动态成员查询</h4><p>@dynamicMemberLookup 指示访问属性时调用一个已实现的处理动态查找的下标方法 subscript(dynamicMemeber:)，通过指定属性字符串名返回值。使用方法如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token attribute atrule">@dynamicMemberLookup</span>
<span class="token keyword">struct</span> <span class="token class-name">D</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 找字符串</span>
    <span class="token keyword">subscript</span><span class="token punctuation">(</span>dynamicMember m<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"first"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"second"</span></span><span class="token punctuation">]</span>
        <span class="token keyword">return</span> p<span class="token punctuation">[</span>m<span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// 找整型</span>
    <span class="token keyword">subscript</span><span class="token punctuation">(</span>dynamicMember m<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Int</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">]</span>
        <span class="token keyword">return</span> p<span class="token punctuation">[</span>m<span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// 找闭包</span>
    <span class="token keyword">subscript</span><span class="token punctuation">(</span>dynamicMember m<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">(</span><span class="token omit keyword">_</span> s<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Void</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"show </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation"><span class="token short-argument">$0</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// 静态数组成员</span>
    <span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"This is a member"</span></span><span class="token punctuation">]</span>
    <span class="token comment">// 动态数组成员</span>
    <span class="token keyword">subscript</span><span class="token punctuation">(</span>dynamicMember m<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"This is a dynamic member"</span></span><span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> d <span class="token operator">=</span> <span class="token class-name">D</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> s1<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> d<span class="token punctuation">.</span>one
<span class="token function">print</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token comment">// first</span>
<span class="token keyword">let</span> i1<span class="token punctuation">:</span> <span class="token class-name">Int</span> <span class="token operator">=</span> d<span class="token punctuation">.</span>one
<span class="token function">print</span><span class="token punctuation">(</span>i1<span class="token punctuation">)</span> <span class="token comment">// 1</span>
d<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"something"</span></span><span class="token punctuation">)</span> <span class="token comment">// show something</span>
<span class="token function">print</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>p<span class="token punctuation">)</span> <span class="token comment">// ["This is a member"]</span>
<span class="token keyword">let</span> dynamicP<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> d<span class="token punctuation">.</span>dp
<span class="token function">print</span><span class="token punctuation">(</span>dynamicP<span class="token punctuation">)</span> <span class="token comment">// ["This is a dynamic member"]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>类使用 @dynamicMemberLookup，继承的类也会自动加上 @dynamicMemberLookup。协议上定义 @dynamicMemberLookup，通过扩展可以默认实现 subscript(dynamicMember:) 方法。</p>
<h4 id="dynamicCallable-动态可调用类型"><a href="#dynamicCallable-动态可调用类型" class="headerlink" title="@dynamicCallable 动态可调用类型"></a>@dynamicCallable 动态可调用类型</h4><p>@dynamicCallable 动态可调用类型。通过实现 dynamicallyCall 方法来定义变参的处理。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token attribute atrule">@dynamicCallable</span>
<span class="token keyword">struct</span> <span class="token class-name">D</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 带参数说明</span>
    <span class="token keyword">func</span> <span class="token function-definition function">dynamicallyCall</span><span class="token punctuation">(</span>withKeywordArguments args<span class="token punctuation">:</span> <span class="token class-name">KeyValuePairs</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Int</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Int</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> firstArg <span class="token operator">=</span> args<span class="token punctuation">.</span>first<span class="token operator">?</span><span class="token punctuation">.</span>value <span class="token operator">??</span> <span class="token number">0</span>
        <span class="token keyword">return</span> firstArg <span class="token operator">*</span> <span class="token number">2</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">// 无参数说明</span>
    <span class="token keyword">func</span> <span class="token function-definition function">dynamicallyCall</span><span class="token punctuation">(</span>withArguments args<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">var</span> firstArg <span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span>
        <span class="token keyword">if</span> args<span class="token punctuation">.</span>count <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">&#123;</span>
            firstArg <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">"show </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">firstArg</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> d <span class="token operator">=</span> <span class="token class-name">D</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token function">d</span><span class="token punctuation">(</span>numberIs<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token comment">// 4</span>
<span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token function">d</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"hi"</span></span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token comment">// show hi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="自带协议"><a href="#自带协议" class="headerlink" title="自带协议"></a>自带协议</h3><h4 id="Hashable"><a href="#Hashable" class="headerlink" title="Hashable"></a>Hashable</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">H</span><span class="token punctuation">:</span> <span class="token class-name">Hashable</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> p1<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">var</span> p2<span class="token punctuation">:</span> <span class="token class-name">Int</span>
    
    <span class="token comment">// 提供随机 seed</span>
    <span class="token keyword">func</span> <span class="token function-definition function">hash</span><span class="token punctuation">(</span>into hasher<span class="token punctuation">:</span> <span class="token keyword">inout</span> <span class="token class-name">Hasher</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        hasher<span class="token punctuation">.</span><span class="token function">combine</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> h1 <span class="token operator">=</span> <span class="token class-name">H</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> h2 <span class="token operator">=</span> <span class="token class-name">H</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> hs1 <span class="token operator">=</span> <span class="token class-name">Hasher</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
hs1<span class="token punctuation">.</span><span class="token function">combine</span><span class="token punctuation">(</span>h1<span class="token punctuation">)</span>
hs1<span class="token punctuation">.</span><span class="token function">combine</span><span class="token punctuation">(</span>h2<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>h1<span class="token punctuation">.</span>hashValue<span class="token punctuation">)</span> <span class="token comment">// 7417088153212460033 随机值</span>
<span class="token function">print</span><span class="token punctuation">(</span>h2<span class="token punctuation">.</span>hashValue<span class="token punctuation">)</span> <span class="token comment">// -6972912482785541972 随机值</span>
<span class="token function">print</span><span class="token punctuation">(</span>hs1<span class="token punctuation">.</span><span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 7955861102637572758 随机值</span>
<span class="token function">print</span><span class="token punctuation">(</span>h1<span class="token punctuation">.</span>hashValue<span class="token punctuation">)</span> <span class="token comment">// 7417088153212460033 和前面 h1 一样</span>

<span class="token keyword">let</span> h3 <span class="token operator">=</span> <span class="token class-name">H</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>h3<span class="token punctuation">.</span>hashValue<span class="token punctuation">)</span> <span class="token comment">// 7417088153212460033 和前面 h1 一样</span>
<span class="token keyword">var</span> hs2 <span class="token operator">=</span> <span class="token class-name">Hasher</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
hs2<span class="token punctuation">.</span><span class="token function">combine</span><span class="token punctuation">(</span>h3<span class="token punctuation">)</span>
hs2<span class="token punctuation">.</span><span class="token function">combine</span><span class="token punctuation">(</span>h2<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>hs2<span class="token punctuation">.</span><span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 7955861102637572758 和前面 hs1 一样</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>应用生命周期内，调用 combine() 添加相同属性哈希值相同，由于 Hasher 每次都会使用随机的 seed，因此不同应用生命周期，也就是下次启动的哈希值，就会和上次的哈希值不同。</p>
<h3 id="Codable"><a href="#Codable" class="headerlink" title="Codable"></a>Codable</h3><h4 id="JSON-没有-id-字段"><a href="#JSON-没有-id-字段" class="headerlink" title="JSON 没有 id 字段"></a>JSON 没有 id 字段</h4><p>如果SwiftUI要求数据Model都是遵循Identifiable协议的，而有的json没有id这个字段，可以使用扩展struct的方式解决：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">CommitModel</span><span class="token punctuation">:</span> <span class="token class-name">Decodable</span><span class="token punctuation">,</span> <span class="token class-name">Hashable</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> sha<span class="token punctuation">:</span> <span class="token class-name">String</span>
  <span class="token keyword">var</span> author<span class="token punctuation">:</span> <span class="token class-name">AuthorModel</span>
  <span class="token keyword">var</span> commit<span class="token punctuation">:</span> <span class="token class-name">CommitModel</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">extension</span> <span class="token class-name">CommitModel</span><span class="token punctuation">:</span> <span class="token class-name">Identifiable</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> id<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> sha
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h3><h4 id="网络状态检查"><a href="#网络状态检查" class="headerlink" title="网络状态检查"></a>网络状态检查</h4><p>通过 Network 库的 NWPathMonitor 来检查</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">Combine</span>
<span class="token keyword">import</span> <span class="token class-name">Network</span>

<span class="token comment">// 网络状态检查 network state check</span>
<span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Nsck</span><span class="token punctuation">:</span> <span class="token class-name">ObservableObject</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">let</span> shared <span class="token operator">=</span> <span class="token class-name">Nsck</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span><span class="token punctuation">(</span><span class="token keyword">set</span><span class="token punctuation">)</span> <span class="token keyword">lazy</span> <span class="token keyword">var</span> pb <span class="token operator">=</span> <span class="token function">mkpb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token attribute atrule">@Published</span> <span class="token keyword">private</span><span class="token punctuation">(</span><span class="token keyword">set</span><span class="token punctuation">)</span> <span class="token keyword">var</span> pt<span class="token punctuation">:</span> <span class="token class-name">NWPath</span>
    
    <span class="token keyword">private</span> <span class="token keyword">let</span> monitor<span class="token punctuation">:</span> <span class="token class-name">NWPathMonitor</span>
    <span class="token keyword">private</span> <span class="token keyword">lazy</span> <span class="token keyword">var</span> sj <span class="token operator">=</span> <span class="token class-name">CurrentValueSubject</span><span class="token operator">&lt;</span><span class="token class-name">NWPath</span><span class="token punctuation">,</span> <span class="token class-name">Never</span><span class="token operator">></span><span class="token punctuation">(</span>monitor<span class="token punctuation">.</span>currentPath<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">var</span> sb<span class="token punctuation">:</span> <span class="token class-name">AnyCancellable</span><span class="token operator">?</span>
    
    <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        monitor <span class="token operator">=</span> <span class="token class-name">NWPathMonitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        pt <span class="token operator">=</span> monitor<span class="token punctuation">.</span>currentPath
        monitor<span class="token punctuation">.</span>pathUpdateHandler <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">[</span><span class="token keyword">weak</span> <span class="token keyword">self</span><span class="token punctuation">]</span> path <span class="token keyword">in</span>
            <span class="token keyword">self</span><span class="token operator">?</span><span class="token punctuation">.</span>pt <span class="token operator">=</span> path
            <span class="token keyword">self</span><span class="token operator">?</span><span class="token punctuation">.</span>sj<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        monitor<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>queue<span class="token punctuation">:</span> <span class="token class-name">DispatchQueue</span><span class="token punctuation">.</span><span class="token function">global</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">deinit</span> <span class="token punctuation">&#123;</span>
        monitor<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        sj<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>completion<span class="token punctuation">:</span> <span class="token punctuation">.</span>finished<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">private</span> <span class="token keyword">func</span> <span class="token function-definition function">mkpb</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">AnyPublisher</span><span class="token operator">&lt;</span><span class="token class-name">NWPath</span><span class="token punctuation">,</span> <span class="token class-name">Never</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> sj<span class="token punctuation">.</span><span class="token function">eraseToAnyPublisher</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用方法</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">var</span> sb <span class="token operator">=</span> <span class="token class-name">Set</span><span class="token operator">&lt;</span><span class="token class-name">AnyCancellable</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> alertMsg <span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span>

<span class="token class-name">Nsck</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span>pb
    <span class="token punctuation">.</span>sink <span class="token punctuation">&#123;</span> <span class="token omit keyword">_</span> <span class="token keyword">in</span>
        <span class="token comment">//</span>
    <span class="token punctuation">&#125;</span> receiveValue<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span> path <span class="token keyword">in</span>
        alertMsg <span class="token operator">=</span> path<span class="token punctuation">.</span>debugDescription
        <span class="token keyword">switch</span> path<span class="token punctuation">.</span>status <span class="token punctuation">&#123;</span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span>satisfied<span class="token punctuation">:</span>
            alertMsg <span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span>unsatisfied<span class="token punctuation">:</span>
            alertMsg <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"😱"</span></span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span>requiresConnection<span class="token punctuation">:</span>
            alertMsg <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"🥱"</span></span>
        <span class="token attribute atrule">@unknown</span> <span class="token keyword">default</span><span class="token punctuation">:</span>
            alertMsg <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"🤔"</span></span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">if</span> path<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token punctuation">.</span>unsatisfied <span class="token punctuation">&#123;</span>
            <span class="token keyword">switch</span> path<span class="token punctuation">.</span>unsatisfiedReason <span class="token punctuation">&#123;</span>
            <span class="token keyword">case</span> <span class="token punctuation">.</span>notAvailable<span class="token punctuation">:</span>
                alertMsg <span class="token operator">+=</span> <span class="token string-literal"><span class="token string">"网络不可用"</span></span>
            <span class="token keyword">case</span> <span class="token punctuation">.</span>cellularDenied<span class="token punctuation">:</span>
                alertMsg <span class="token operator">+=</span> <span class="token string-literal"><span class="token string">"蜂窝网不可用"</span></span>
            <span class="token keyword">case</span> <span class="token punctuation">.</span>wifiDenied<span class="token punctuation">:</span>
                alertMsg <span class="token operator">+=</span> <span class="token string-literal"><span class="token string">"Wifi不可用"</span></span>
            <span class="token keyword">case</span> <span class="token punctuation">.</span>localNetworkDenied<span class="token punctuation">:</span>
                alertMsg <span class="token operator">+=</span> <span class="token string-literal"><span class="token string">"网线不可用"</span></span>
            <span class="token attribute atrule">@unknown</span> <span class="token keyword">default</span><span class="token punctuation">:</span>
                alertMsg <span class="token operator">+=</span> <span class="token string-literal"><span class="token string">"网络不可用"</span></span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span>sb<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="动画"><a href="#动画" class="headerlink" title="动画"></a>动画</h3><h4 id="布局动画"><a href="#布局动画" class="headerlink" title="布局动画"></a>布局动画</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">SwiftUI</span>

<span class="token keyword">struct</span> <span class="token class-name">AnimateLayout</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
 <span class="token attribute atrule">@State</span> <span class="token keyword">var</span> changeLayout<span class="token punctuation">:</span> <span class="token class-name">Bool</span> <span class="token operator">=</span> <span class="token boolean">true</span>
 <span class="token attribute atrule">@Namespace</span> <span class="token keyword">var</span> namespace

 <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
  <span class="token class-name">VStack</span><span class="token punctuation">(</span>spacing<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token keyword">if</span> changeLayout <span class="token punctuation">&#123;</span>
    <span class="token class-name">HStack</span> <span class="token punctuation">&#123;</span> items <span class="token punctuation">&#125;</span>
   <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">VStack</span> <span class="token punctuation">&#123;</span> items <span class="token punctuation">&#125;</span>
   <span class="token punctuation">&#125;</span>
   <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"切换布局"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    withAnimation <span class="token punctuation">&#123;</span> changeLayout<span class="token punctuation">.</span><span class="token function">toggle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span>
   <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span>

 <span class="token attribute atrule">@ViewBuilder</span> <span class="token keyword">var</span> items<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
  <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">matchedGeometryEffect</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token punctuation">:</span> namespace<span class="token punctuation">)</span>
  <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Two"</span></span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">matchedGeometryEffect</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Two"</span></span><span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token punctuation">:</span> namespace<span class="token punctuation">)</span>
  <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Three"</span></span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">matchedGeometryEffect</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Three"</span></span><span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token punctuation">:</span> namespace<span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h3><h4 id="Keychain"><a href="#Keychain" class="headerlink" title="Keychain"></a>Keychain</h4><p>使用方法：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> d1 <span class="token operator">=</span> <span class="token class-name">Data</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"keyChain github token"</span></span><span class="token punctuation">.</span>utf8<span class="token punctuation">)</span>
<span class="token keyword">let</span> service <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"access-token"</span></span>
<span class="token keyword">let</span> account <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"github"</span></span>
<span class="token keyword">let</span> q1 <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token constant">kSecValueData</span><span class="token punctuation">:</span> d1<span class="token punctuation">,</span>
    <span class="token constant">kSecClass</span><span class="token punctuation">:</span> <span class="token constant">kSecClassGenericPassword</span><span class="token punctuation">,</span>
    <span class="token constant">kSecAttrService</span><span class="token punctuation">:</span> service<span class="token punctuation">,</span>
    <span class="token constant">kSecAttrAccount</span><span class="token punctuation">:</span> account
<span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token class-name">CFDictionary</span>

<span class="token comment">// 添加一个 keychain</span>
<span class="token keyword">let</span> status <span class="token operator">=</span> <span class="token class-name">SecItemAdd</span><span class="token punctuation">(</span>q1<span class="token punctuation">,</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span>

<span class="token comment">// 如果已经添加过会抛出 -25299 错误代码，需要调用 SecItemUpdate 来进行更新</span>
<span class="token keyword">if</span> status <span class="token operator">==</span> errSecDuplicateItem <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> q2 <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token constant">kSecClass</span><span class="token punctuation">:</span> <span class="token constant">kSecClassGenericPassword</span><span class="token punctuation">,</span>
        <span class="token constant">kSecAttrService</span><span class="token punctuation">:</span> service<span class="token punctuation">,</span>
        <span class="token constant">kSecAttrAccount</span><span class="token punctuation">:</span> account
    <span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token class-name">CFDictionary</span>
    <span class="token keyword">let</span> q3 <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token constant">kSecValueData</span><span class="token punctuation">:</span> d1
    <span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token class-name">CFDictionary</span>
    <span class="token class-name">SecItemUpdate</span><span class="token punctuation">(</span>q2<span class="token punctuation">,</span> q3<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 读取</span>
<span class="token keyword">let</span> q4 <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token constant">kSecAttrService</span><span class="token punctuation">:</span> service<span class="token punctuation">,</span>
    <span class="token constant">kSecAttrAccount</span><span class="token punctuation">:</span> account<span class="token punctuation">,</span>
    <span class="token constant">kSecClass</span><span class="token punctuation">:</span> <span class="token constant">kSecClassGenericPassword</span><span class="token punctuation">,</span>
    <span class="token constant">kSecReturnData</span><span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token class-name">CFDictionary</span>

<span class="token keyword">var</span> re<span class="token punctuation">:</span> <span class="token class-name">AnyObject</span><span class="token operator">?</span>
<span class="token class-name">SecItemCopyMatching</span><span class="token punctuation">(</span>q4<span class="token punctuation">,</span> <span class="token operator">&amp;</span>re<span class="token punctuation">)</span>
<span class="token keyword">guard</span> <span class="token keyword">let</span> reData <span class="token operator">=</span> re <span class="token keyword">as</span><span class="token operator">?</span> <span class="token class-name">Data</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">(</span>decoding<span class="token punctuation">:</span> reData<span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token punctuation">:</span> UTF8<span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// keyChain github token</span>

<span class="token comment">// 删除</span>
<span class="token keyword">let</span> q5 <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token constant">kSecAttrService</span><span class="token punctuation">:</span> service<span class="token punctuation">,</span>
    <span class="token constant">kSecAttrAccount</span><span class="token punctuation">:</span> account<span class="token punctuation">,</span>
    <span class="token constant">kSecClass</span><span class="token punctuation">:</span> <span class="token constant">kSecClassGenericPassword</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token class-name">CFDictionary</span>

<span class="token class-name">SecItemDelete</span><span class="token punctuation">(</span>q5<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="工程"><a href="#工程" class="headerlink" title="工程"></a>工程</h3><h4 id="程序入口点"><a href="#程序入口点" class="headerlink" title="程序入口点"></a>程序入口点</h4><p>Swift 允许全局编写 Swift 代码，实际上 clang 会自动将代码包进一个模拟 C 的函数中。Swift 也能够指定入口点，比如 @UIApplicationMain 或 @NSApplicationMain，UIKit 启动后生命周期管理是 AppDelegate 和 SceneDelegate，《 <a target="_blank" rel="noopener" href="https://www.donnywals.com/understanding-the-ios-13-scene-delegate/">Understanding the iOS 13 Scene Delegate</a> 》这篇有详细介绍。</p>
<p>@UIApplicationMain 和 @NSApplicationMain 会自动生成入口点。这些入口点都是平台相关的，Swift 发展来看是多平台的，这样在 Swift 5.3 时引入了 @main，可以方便的指定入口点。代码如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token attribute atrule">@main</span> <span class="token comment">// 要定义个静态的 main 函数</span>
<span class="token keyword">struct</span> <span class="token class-name">M</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"let's begin"</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> <a target="_blank" rel="noopener" href="https://github.com/apple/swift-argument-parser">ArgumentParser</a>  库，Swift 官方开源的一个开发命令行工具的库，也支持 @main。使用方法如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">ArgumentParser</span>

<span class="token attribute atrule">@main</span>
<span class="token keyword">struct</span> <span class="token class-name">C</span><span class="token punctuation">:</span> <span class="token class-name">ParsableCommand</span> <span class="token punctuation">&#123;</span>
  <span class="token attribute atrule">@Argument</span><span class="token punctuation">(</span>help<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Start"</span></span><span class="token punctuation">)</span>
  <span class="token keyword">var</span> phrase<span class="token punctuation">:</span> <span class="token class-name">String</span>
   
  <span class="token keyword">func</span> <span class="token function-definition function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span> <span class="token omit keyword">_</span> <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">...</span><span class="token number">5</span> <span class="token punctuation">&#123;</span>
      <span class="token function">print</span><span class="token punctuation">(</span>phrase<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h2 id="专题"><a href="#专题" class="headerlink" title="专题"></a>专题</h2><h3 id="Swift-那些事"><a href="#Swift-那些事" class="headerlink" title="Swift 那些事"></a>Swift 那些事</h3><h2 id="语法速查-1"><a href="#语法速查-1" class="headerlink" title="语法速查"></a>语法速查</h2><h3 id="基础-1"><a href="#基础-1" class="headerlink" title="基础"></a>基础</h3><h4 id="变量-let-var-1"><a href="#变量-let-var-1" class="headerlink" title="变量 let, var"></a>变量 let, var</h4><p>变量是可变的，使用 var 修饰，常量是不可变的，使用 let 修饰。类、结构体和枚举里的变量是属性。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">var</span> v1<span class="token punctuation">:</span><span class="token class-name">String</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"hi"</span></span> <span class="token comment">// 标注类型</span>
<span class="token keyword">var</span> v2 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"类型推导"</span></span>
<span class="token keyword">let</span> l1 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"标题"</span></span> <span class="token comment">// 常量</span>

<span class="token keyword">class</span> a <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token number">3</span>
    <span class="token keyword">var</span> p2<span class="token punctuation">:</span> <span class="token class-name">Int</span> <span class="token punctuation">&#123;</span>
        p1 <span class="token operator">*</span> <span class="token number">3</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>属性没有 set 可以省略 get，如果有 set 需加 get。变量设置前通过 willSet 访问到，变量设置后通过 didSet 访问。</p>
<h4 id="打印-print-“”-1"><a href="#打印-print-“”-1" class="headerlink" title="打印 print(“”)"></a>打印 print(“”)</h4><p>控制台打印值</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"hi"</span></span><span class="token punctuation">)</span>
<span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">14</span>
<span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"9月</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">是小柠檬的生日"</span></span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">...</span><span class="token number">3</span><span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// output:</span>
<span class="token comment">// 1</span>
<span class="token comment">// 2</span>
<span class="token comment">// 3</span>

<span class="token comment">// 使用terminator使循环打印更整洁</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">...</span><span class="token number">3</span> <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> "</span></span><span class="token punctuation">,</span> terminator<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// output:</span>
<span class="token comment">// 1 2 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="注释-x2F-x2F-1"><a href="#注释-x2F-x2F-1" class="headerlink" title="注释 &#x2F;&#x2F;"></a>注释 &#x2F;&#x2F;</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 单行注释</span>
<span class="token comment">/*
多行注释第一行。
多行注释第二行。
*/</span> 
<span class="token comment">// MARK: 会在 minimap 上展示</span>
<span class="token comment">// TODO: 待做</span>
<span class="token comment">// FIXME: 待修复</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="可选-1"><a href="#可选-1" class="headerlink" title="可选 ?, !"></a>可选 ?, !</h4><p>可能会是 nil 的变量就是可选变量。当变量为 nil 通过??操作符可以提供一个默认值。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">var</span> o<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token operator">?</span> <span class="token operator">=</span> <span class="token nil constant">nil</span>
<span class="token keyword">let</span> i <span class="token operator">=</span> o <span class="token operator">??</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0345-if-let-shorthand.md">SE-0345 if let shorthand for shadowing an existing optional variable</a> 引入的新语法，用于 unwrapping optinal。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> s1<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token operator">?</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"hey"</span></span>
<span class="token keyword">let</span> s2<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token operator">?</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"u"</span></span>
<span class="token keyword">if</span> <span class="token keyword">let</span> s1 <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">guard</span> <span class="token keyword">let</span> s1<span class="token punctuation">,</span> <span class="token keyword">let</span> s2 <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span>s1 <span class="token operator">+</span> <span class="token string-literal"><span class="token string">" "</span></span> <span class="token operator">+</span> s2<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="闭包-1"><a href="#闭包-1" class="headerlink" title="闭包"></a>闭包</h4><p>闭包也可以叫做 lambda，是匿名函数，对应 OC 的 block。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> a1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span>by<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">(</span>l<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">,</span> r<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Bool</span> <span class="token keyword">in</span>
    <span class="token keyword">return</span> l <span class="token operator">&lt;</span> r
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token comment">// 如果闭包是唯一的参数并在表达式最后可以使用结尾闭包语法，写法简化为</span>
<span class="token keyword">let</span> a2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>sorted <span class="token punctuation">&#123;</span> <span class="token punctuation">(</span>l<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">,</span> r<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Bool</span> <span class="token keyword">in</span>
    <span class="token keyword">return</span> l <span class="token operator">&lt;</span> r
<span class="token punctuation">&#125;</span>
<span class="token comment">// 已知类型可以省略</span>
<span class="token keyword">let</span> a3 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>sorted <span class="token punctuation">&#123;</span> l<span class="token punctuation">,</span> r <span class="token keyword">in</span>
    <span class="token keyword">return</span> l <span class="token operator">&lt;</span> r
<span class="token punctuation">&#125;</span>
<span class="token comment">// 通过位置来使用闭包的参数，最后简化如下：</span>
<span class="token keyword">let</span> a4 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>sorted <span class="token punctuation">&#123;</span> <span class="token short-argument">$0</span> <span class="token operator">&lt;</span> <span class="token short-argument">$1</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>函数也是闭包的一种，函数的参数也可以是闭包。@escaping 表示逃逸闭包，逃逸闭包是可以在函数返回之后继续调用的。@autoclosure 表示自动闭包，可以用来省略花括号。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0326-extending-multi-statement-closure-inference.md">SE-0326</a> 提高了 Swift 对闭包使用参数和类型推断的能力。如下代码：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> r <span class="token operator">=</span> a<span class="token punctuation">.</span>map <span class="token punctuation">&#123;</span> i <span class="token keyword">in</span>
    <span class="token keyword">if</span> i <span class="token operator">>=</span> <span class="token number">2</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">"</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> 大于等于2"</span></span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">"</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> 小于2"</span></span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="函数-func-1"><a href="#函数-func-1" class="headerlink" title="函数 func"></a>函数 func</h4><p>函数可以作为另一个函数的参数，也可以作为另一个函数的返回。函数是特殊的闭包，在类、结构体和枚举中是方法。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 为参数设置默认值</span>
<span class="token keyword">func</span> <span class="token function-definition function">f1</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"p"</span></span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
    <span class="token string-literal"><span class="token string">"p is </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">p</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 函数作为参数</span>
<span class="token keyword">func</span> <span class="token function-definition function">f2</span><span class="token punctuation">(</span>fn<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span><span class="token punctuation">,</span> p<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">f2</span><span class="token punctuation">(</span>fn<span class="token punctuation">:</span>f1<span class="token punctuation">,</span> p<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"d"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// p is d</span>

<span class="token comment">// 函数作为返回值</span>
<span class="token keyword">func</span> <span class="token function-definition function">f3</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> f1
<span class="token punctuation">&#125;</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">f3</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"yes"</span></span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"no"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// p is no</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>函数可以返回多个值，函数是可以嵌套的，也就是函数里内可以定义函数，函数内定义的函数可以访问自己作用域外函数内的变量。inout 表示的是输入输出参数，函数可以在函数内改变输入输出参数。defer 标识的代码块会在函数返回之前执行。</p>
<p>函数在 Swift 5.4 时开始有了使用多个变量参数的能力，使用方法如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">func</span> <span class="token function-definition function">f4</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token operator">...</span><span class="token punctuation">,</span> i<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token operator">...</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token function">f4</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"three"</span></span><span class="token punctuation">,</span> i<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token comment">/// ["one", "two", "three"]</span>
<span class="token comment">/// [1, 2, 3]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>嵌套函数可以重载，嵌套函数可以在声明函数之前调用他。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">func</span> <span class="token function-definition function">f5</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">nf5</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">func</span> <span class="token function-definition function">nf5</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"this is nested function"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">f5</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// this is nested function</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="访问控制-1"><a href="#访问控制-1" class="headerlink" title="访问控制"></a>访问控制</h4><p>在 Xcode 里的 target 就是模块，使用 import 可导入模块。模块内包含源文件，每个源文件里可以有多个类、结构体、枚举和函数等多种类型。访问级别可以通过一些关键字描述，分为如下几种：</p>
<ul>
<li>open：在模块外可以调用和继承。</li>
<li>public：在模块外可调用不可继承，open 只适用类和类成员。</li>
<li>internal：默认级别，模块内可跨源文件调用，模块外不可调用。</li>
<li>fileprivate：只能在源文件内访问。</li>
<li>private：只能在所在的作用域内访问。</li>
</ul>
<p>重写继承类的成员，可以设置成员比父类的这个成员更高的访问级别。Setter 的级别可以低于对应的 Getter 的级别，比如设置 Setter 访问级别为 private，可以在属性使用 private(set) 来修饰。</p>
<h4 id="Regex"><a href="#Regex" class="headerlink" title="Regex"></a>Regex</h4><p>标准库多了个 <code>Regex&lt;Output&gt;</code> 类型，Regex 语法与 Perl、Python、Ruby、Java、NSRegularExpression 和许多其他语言兼容。可以用 <code>let regex = try! Regex(&quot;a[bc]+&quot;)</code> 或 <code>let regex = /a[bc]+/</code> 写法来使用。<a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0350-regex-type-overview.md">SE-0350 Regex Type and Overview</a> 引入 Regex 类型。<a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0351-regex-builder.md">SE-0351 Regex builder DSL</a> 使用 result builder 来构建正则表达式的 DSL。<a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0354-regex-literals.md">SE-0354 Regex Literals</a> 简化的正则表达式。<a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0357-regex-string-processing-algorithms.md">SE-0357 Regex-powered string processing algorithms</a> 提案里有基于正则表达式的新字符串处理算法。</p>
<p><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/RegexBuilder">RegexBuilder 文档</a></p>
<p>session <a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2022-110357">Meet Swift Regex</a> 、<a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2022-110358">Swift Regex: Beyond the basics</a></p>
<p>Regex 示例代码如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"I am not a good painter"</span></span>
<span class="token function">print</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span><span class="token function">ranges</span><span class="token punctuation">(</span>of<span class="token punctuation">:</span> <span class="token operator">/</span>good<span class="token operator">/</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> regGood <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token class-name">Regex</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"[a-z]ood"</span></span><span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span><span class="token function">replacing</span><span class="token punctuation">(</span>regGood<span class="token punctuation">,</span> with<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"bad"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span><span class="token function">trimmingPrefix</span><span class="token punctuation">(</span><span class="token operator">/</span>i am <span class="token operator">/</span><span class="token punctuation">.</span><span class="token function">ignoresCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> reg1 <span class="token operator">=</span> <span class="token operator">/</span><span class="token punctuation">(</span><span class="token operator">.+?</span><span class="token punctuation">)</span> <span class="token function">read</span> <span class="token punctuation">(</span><span class="token punctuation">\</span>d<span class="token operator">+</span><span class="token punctuation">)</span> books<span class="token operator">./</span>
<span class="token keyword">let</span> reg2 <span class="token operator">=</span> <span class="token operator">/</span><span class="token punctuation">(</span><span class="token operator">?&lt;</span>name<span class="token operator">></span><span class="token operator">.+?</span><span class="token punctuation">)</span> <span class="token function">read</span> <span class="token punctuation">(</span><span class="token operator">?&lt;</span>books<span class="token operator">></span><span class="token punctuation">\</span>d<span class="token operator">+</span><span class="token punctuation">)</span> books<span class="token operator">./</span>
<span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"Jack read 3 books."</span></span>
<span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token keyword">let</span> r1 <span class="token operator">=</span> <span class="token keyword">try</span> reg1<span class="token punctuation">.</span><span class="token function">wholeMatch</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> s2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span>r1<span class="token punctuation">.</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token function">print</span><span class="token punctuation">(</span>r1<span class="token punctuation">.</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token keyword">let</span> r2 <span class="token operator">=</span> <span class="token keyword">try</span> reg2<span class="token punctuation">.</span><span class="token function">wholeMatch</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> s2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"name:"</span></span> <span class="token operator">+</span> r2<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"books:"</span></span> <span class="token operator">+</span> r2<span class="token punctuation">.</span>books<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用 regex builders 的官方示例：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// Text to parse:</span>
<span class="token comment">// CREDIT  03/02/2022  Payroll from employer     $200.23</span>
<span class="token comment">// CREDIT  03/03/2022  Suspect A           $2,000,000.00</span>
<span class="token comment">// DEBIT   03/03/2022  Ted's Pet Rock Sanctuary    $2,000,000.00</span>
<span class="token comment">// DEBIT   03/05/2022  Doug's Dugout Dogs      $33.27</span>

<span class="token keyword">import</span> <span class="token class-name">RegexBuilder</span>
<span class="token keyword">let</span> fieldSeparator <span class="token operator">=</span> <span class="token operator">/</span><span class="token punctuation">\</span>s<span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token operator">|</span><span class="token punctuation">\</span>t<span class="token operator">/</span>
<span class="token keyword">let</span> transactionMatcher <span class="token operator">=</span> <span class="token class-name">Regex</span> <span class="token punctuation">&#123;</span>
  <span class="token operator">/</span><span class="token constant">CREDIT</span><span class="token operator">|</span><span class="token constant">DEBIT</span><span class="token operator">/</span>
  fieldSeparator
  <span class="token class-name">One</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token punctuation">.</span>numeric<span class="token punctuation">,</span> locale<span class="token punctuation">:</span> <span class="token class-name">Locale</span><span class="token punctuation">(</span>identifier<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"en_US"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> timeZone<span class="token punctuation">:</span> <span class="token punctuation">.</span>gmt<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 👈🏻 we define which data locale/timezone we want to use</span>
  fieldSeparator
  <span class="token class-name">OneOrMore</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">NegativeLookahead</span> <span class="token punctuation">&#123;</span> fieldSeparator <span class="token punctuation">&#125;</span> <span class="token comment">// 👈🏻 we stop as soon as we see one field separator</span>
    <span class="token class-name">CharacterClass</span><span class="token punctuation">.</span>any
  <span class="token punctuation">&#125;</span>
  fieldSeparator
  <span class="token class-name">One</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">localizedCurrency</span><span class="token punctuation">(</span>code<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"USD"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">locale</span><span class="token punctuation">(</span><span class="token class-name">Locale</span><span class="token punctuation">(</span>identifier<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"en_US"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在正则表达式中捕获数据，使用 Capture：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> fieldSeparator <span class="token operator">=</span> <span class="token operator">/</span><span class="token punctuation">\</span>s<span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token operator">|</span><span class="token punctuation">\</span>t<span class="token operator">/</span>
<span class="token keyword">let</span> transactionMatcher <span class="token operator">=</span> <span class="token class-name">Regex</span> <span class="token punctuation">&#123;</span>
  <span class="token class-name">Capture</span> <span class="token punctuation">&#123;</span> <span class="token operator">/</span><span class="token constant">CREDIT</span><span class="token operator">|</span><span class="token constant">DEBIT</span><span class="token operator">/</span> <span class="token punctuation">&#125;</span> <span class="token comment">// 👈🏻</span>
  fieldSeparator

  <span class="token class-name">Capture</span> <span class="token punctuation">&#123;</span> <span class="token class-name">One</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token punctuation">.</span>numeric<span class="token punctuation">,</span> locale<span class="token punctuation">:</span> <span class="token class-name">Locale</span><span class="token punctuation">(</span>identifier<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"en_US"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> timeZone<span class="token punctuation">:</span> <span class="token punctuation">.</span>gmt<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span> <span class="token comment">// 👈🏻</span>
  fieldSeparator

  <span class="token class-name">Capture</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 👈🏻</span>
    <span class="token class-name">OneOrMore</span> <span class="token punctuation">&#123;</span>
      <span class="token class-name">NegativeLookahead</span> <span class="token punctuation">&#123;</span> fieldSeparator <span class="token punctuation">&#125;</span>
      <span class="token class-name">CharacterClass</span><span class="token punctuation">.</span>any
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  fieldSeparator
  <span class="token class-name">Capture</span> <span class="token punctuation">&#123;</span> <span class="token class-name">One</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">localizedCurrency</span><span class="token punctuation">(</span>code<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"USD"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">locale</span><span class="token punctuation">(</span><span class="token class-name">Locale</span><span class="token punctuation">(</span>identifier<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"en_US"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span> <span class="token comment">// 👈🏻</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// transactionMatcher: Regex&lt;(Substring, Substring, Date, Substring, Decimal)></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="基础类型-1"><a href="#基础类型-1" class="headerlink" title="基础类型"></a>基础类型</h3><h4 id="数字-Int-Float-1"><a href="#数字-Int-Float-1" class="headerlink" title="数字 Int, Float"></a>数字 Int, Float</h4><p>数字的类型有 Int、Float 和 Double</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// Int</span>
<span class="token keyword">let</span> i1 <span class="token operator">=</span> <span class="token number">100</span>
<span class="token keyword">let</span> i2 <span class="token operator">=</span> <span class="token number">22</span>
<span class="token function">print</span><span class="token punctuation">(</span>i1 <span class="token operator">/</span> i2<span class="token punctuation">)</span> <span class="token comment">// 向下取整得 4</span>

<span class="token comment">// Float</span>
<span class="token keyword">let</span> f1<span class="token punctuation">:</span> <span class="token class-name">Float</span> <span class="token operator">=</span> <span class="token number">100.0</span>
<span class="token keyword">let</span> f2<span class="token punctuation">:</span> <span class="token class-name">Float</span> <span class="token operator">=</span> <span class="token number">22.0</span>
<span class="token function">print</span><span class="token punctuation">(</span>f1 <span class="token operator">/</span> f2<span class="token punctuation">)</span> <span class="token comment">// 4.5454545</span>

<span class="token keyword">let</span> f3<span class="token punctuation">:</span> <span class="token class-name">Float16</span> <span class="token operator">=</span> <span class="token number">5.0</span> <span class="token comment">// macOS 还不能用</span>
<span class="token keyword">let</span> f4<span class="token punctuation">:</span> <span class="token class-name">Float32</span> <span class="token operator">=</span> <span class="token number">5.0</span>
<span class="token keyword">let</span> f5<span class="token punctuation">:</span> <span class="token class-name">Float64</span> <span class="token operator">=</span> <span class="token number">5.0</span>
<span class="token keyword">let</span> f6<span class="token punctuation">:</span> <span class="token class-name">Float80</span> <span class="token operator">=</span> <span class="token number">5.0</span>
<span class="token function">print</span><span class="token punctuation">(</span>f4<span class="token punctuation">,</span> f5<span class="token punctuation">,</span> f6<span class="token punctuation">)</span> <span class="token comment">// 5.0 5.0 5.0</span>

<span class="token comment">// Double</span>
<span class="token keyword">let</span> d1<span class="token punctuation">:</span> <span class="token class-name">Double</span> <span class="token operator">=</span> <span class="token number">100.0</span>
<span class="token keyword">let</span> d2<span class="token punctuation">:</span> <span class="token class-name">Double</span> <span class="token operator">=</span> <span class="token number">22.0</span>
<span class="token function">print</span><span class="token punctuation">(</span>d1 <span class="token operator">/</span> d2<span class="token punctuation">)</span> <span class="token comment">// 4.545454545454546</span>

<span class="token comment">// 字面量</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Int</span><span class="token punctuation">(</span><span class="token number">0b10101</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 0b 开头是二进制 </span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Int</span><span class="token punctuation">(</span><span class="token number">0x00afff</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 0x 开头是十六进制</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token number">2.5e4</span><span class="token punctuation">)</span> <span class="token comment">// 2.5x10^4 十进制用 e</span>
<span class="token function">print</span><span class="token punctuation">(</span>0xAp2<span class="token punctuation">)</span> <span class="token comment">// 10*2^2  十六进制用 p</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token number">2_000_000</span><span class="token punctuation">)</span> <span class="token comment">// 2000000</span>

<span class="token comment">// isMultiple(of:) 方法检查一个数字是否是另一个数字的倍数</span>
<span class="token keyword">let</span> i3 <span class="token operator">=</span> <span class="token number">36</span>
<span class="token function">print</span><span class="token punctuation">(</span>i3<span class="token punctuation">.</span><span class="token function">isMultiple</span><span class="token punctuation">(</span>of<span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>处理数字有 floor、ceil、round。floor 是向下取整，只取整数部分；cell 是向上取整，只要有不为零的小数，整数就加1;round 是四舍五入。       </p>
<h4 id="布尔数-Bool-1"><a href="#布尔数-Bool-1" class="headerlink" title="布尔数 Bool"></a>布尔数 Bool</h4><p>布尔数有 true 和 false 两种值，还有一个能够切换这两个值的 toggle 方法。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token boolean">false</span>
b<span class="token punctuation">.</span><span class="token function">toggle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
b<span class="token punctuation">.</span><span class="token function">toggle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<h4 id="元组-a-b-c-1"><a href="#元组-a-b-c-1" class="headerlink" title="元组 (a, b, c)"></a>元组 (a, b, c)</h4><p>元组里的值类型可以是不同的。元组可以看成是匿名的结构体。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> t1 <span class="token operator">=</span> <span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">,</span> p3<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>t1<span class="token punctuation">.</span>p1<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>t1<span class="token punctuation">.</span>p3<span class="token punctuation">)</span>

<span class="token comment">// 类型推导</span>
<span class="token keyword">let</span> t2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// 通过下标访问</span>
<span class="token function">print</span><span class="token punctuation">(</span>t2<span class="token punctuation">.</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// two</span>

<span class="token comment">// 分解元组</span>
<span class="token keyword">let</span> <span class="token punctuation">(</span>dp1<span class="token punctuation">,</span> dp2<span class="token punctuation">,</span> <span class="token omit keyword">_</span><span class="token punctuation">)</span> <span class="token operator">=</span> t2
<span class="token function">print</span><span class="token punctuation">(</span>dp1<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>dp2<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="字符串-1"><a href="#字符串-1" class="headerlink" title="字符串"></a>字符串</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"Hi! This is a string. Cool?"</span></span>

<span class="token comment">/// 转义符 \n 表示换行。</span>
<span class="token comment">/// 其它转义字符有 \0 空字符)、\t 水平制表符 、\n 换行符、\r 回车符</span>
<span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"Hi!\nThis is a string. Cool?"</span></span>

<span class="token comment">// 多行</span>
<span class="token keyword">let</span> s3 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"""
Hi!
This is a string.
Cool?
"""</span></span>

<span class="token comment">// 长度</span>
<span class="token function">print</span><span class="token punctuation">(</span>s3<span class="token punctuation">.</span>count<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>s3<span class="token punctuation">.</span>isEmpty<span class="token punctuation">)</span>

<span class="token comment">// 拼接</span>
<span class="token function">print</span><span class="token punctuation">(</span>s3 <span class="token operator">+</span> <span class="token string-literal"><span class="token string">"\nSure!"</span></span><span class="token punctuation">)</span>

<span class="token comment">// 字符串中插入变量</span>
<span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Today is good day, double </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">!"</span></span><span class="token punctuation">)</span>

<span class="token comment">/// 遍历字符串</span>
<span class="token comment">/// 输出：</span>
<span class="token comment">/// o</span>
<span class="token comment">/// n</span>
<span class="token comment">/// e</span>
<span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token string-literal"><span class="token string">"one"</span></span> <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 查找</span>
<span class="token function">print</span><span class="token punctuation">(</span>s3<span class="token punctuation">.</span><span class="token function">lowercased</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"cool"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>

<span class="token comment">// 替换</span>
<span class="token keyword">let</span> s4 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"one is two"</span></span>
<span class="token keyword">let</span> newS4 <span class="token operator">=</span> s4<span class="token punctuation">.</span><span class="token function">replacingOccurrences</span><span class="token punctuation">(</span>of<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">,</span> with<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>newS4<span class="token punctuation">)</span>

<span class="token comment">// 删除空格和换行</span>
<span class="token keyword">let</span> s5 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">" Simple line. \n\n  "</span></span>
<span class="token function">print</span><span class="token punctuation">(</span>s5<span class="token punctuation">.</span><span class="token function">trimmingCharacters</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>whitespacesAndNewlines<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 切割成数组</span>
<span class="token keyword">let</span> s6 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"one/two/three"</span></span>
<span class="token keyword">let</span> a1 <span class="token operator">=</span> s6<span class="token punctuation">.</span><span class="token function">components</span><span class="token punctuation">(</span>separatedBy<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"/"</span></span><span class="token punctuation">)</span> <span class="token comment">// 继承自 NSString 的接口</span>
<span class="token function">print</span><span class="token punctuation">(</span>a1<span class="token punctuation">)</span> <span class="token comment">// ["one", "two", "three"]</span>

<span class="token keyword">let</span> a2 <span class="token operator">=</span> s6<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span>separator<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"/"</span></span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>a2<span class="token punctuation">)</span> <span class="token comment">// ["one", "two", "three"] 属于切片，性能较 components 更好</span>

<span class="token comment">// 判断是否是某种类型</span>
<span class="token keyword">let</span> c1<span class="token punctuation">:</span> <span class="token class-name">Character</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"🤔"</span></span>
<span class="token function">print</span><span class="token punctuation">(</span>c1<span class="token punctuation">.</span>isASCII<span class="token punctuation">)</span> <span class="token comment">// false</span>
<span class="token function">print</span><span class="token punctuation">(</span>c1<span class="token punctuation">.</span>isSymbol<span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token function">print</span><span class="token punctuation">(</span>c1<span class="token punctuation">.</span>isLetter<span class="token punctuation">)</span> <span class="token comment">// false</span>
<span class="token function">print</span><span class="token punctuation">(</span>c1<span class="token punctuation">.</span>isNumber<span class="token punctuation">)</span> <span class="token comment">// false</span>
<span class="token function">print</span><span class="token punctuation">(</span>c1<span class="token punctuation">.</span>isUppercase<span class="token punctuation">)</span> <span class="token comment">// false</span>

<span class="token comment">// 字符串和 Data 互转</span>
<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token class-name">Data</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"hi"</span></span><span class="token punctuation">.</span>utf8<span class="token punctuation">)</span>
<span class="token keyword">let</span> s7 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">(</span>decoding<span class="token punctuation">:</span> data<span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token punctuation">:</span> UTF8<span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>s7<span class="token punctuation">)</span> <span class="token comment">// hi</span>

<span class="token comment">// 字符串可以当作集合来用。</span>
<span class="token keyword">let</span> revered <span class="token operator">=</span> s7<span class="token punctuation">.</span><span class="token function">reversed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">(</span>revered<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Unicode、Character 和 SubString 等内容参见官方字符串文档：<a target="_blank" rel="noopener" href="https://docs.swift.org/swift-book/LanguageGuide/StringsAndCharacters.html">Strings and Characters — The Swift Programming Language (Swift 5.1)</a></p>
<p>字符串字面符号可以参看《<a target="_blank" rel="noopener" href="https://www.swiftbysundell.com/articles/string-literals-in-swift/">String literals in Swift</a>》。</p>
<p>原始字符串</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 原始字符串在字符串前加上一个或多个#符号。里面的双引号和转义符号将不再起作用了，如果想让转义符起作用，需要在转义符后面加上#符号。</span>
<span class="token keyword">let</span> s8 <span class="token operator">=</span> #"<span class="token punctuation">\</span><span class="token punctuation">(</span>s7<span class="token punctuation">)</span><span class="token punctuation">\</span>#<span class="token punctuation">(</span>s7<span class="token punctuation">)</span> <span class="token string-literal"><span class="token string">"one"</span></span> and <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">\</span>n<span class="token punctuation">.</span> <span class="token punctuation">\</span><span class="token other-directive property">#nThe</span> second line<span class="token punctuation">.</span>"#
<span class="token function">print</span><span class="token punctuation">(</span>s8<span class="token punctuation">)</span>
<span class="token comment">/// \(s7)hi "one" and "two"\n.</span>
<span class="token comment">/// The second line.</span>

<span class="token comment">// 原始字符串在正则使用效果更佳，反斜杠更少了。</span>
<span class="token keyword">let</span> s9 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"\\\\[A-Z]+[A-Za-z]+\\.[a-z]+"</span></span>
<span class="token keyword">let</span> s10 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">#"\\[A-Z]+[A-Za-z]+\.[a-z]+"#</span></span>
<span class="token function">print</span><span class="token punctuation">(</span>s9<span class="token punctuation">)</span> <span class="token comment">// \\[A-Z]+[A-Za-z]+\.[a-z]+</span>
<span class="token function">print</span><span class="token punctuation">(</span>s10<span class="token punctuation">)</span> <span class="token comment">// \\[A-Z]+[A-Za-z]+\.[a-z]+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Swift5.7 String Index 大升级 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0180-string-index-overhaul.md">String Index Overhaul</a></p>
<h4 id="枚举-1"><a href="#枚举-1" class="headerlink" title="枚举"></a>枚举</h4><p>Swift的枚举有类的一些特性，比如计算属性、实例方法、扩展、遵循协议等等。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">enum</span> E1<span class="token punctuation">:</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">CaseIterable</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> e1<span class="token punctuation">,</span> e2 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"12"</span></span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 关联值</span>
<span class="token keyword">enum</span> E2 <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token function">e1</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">case</span> <span class="token function">e2</span><span class="token punctuation">(</span><span class="token class-name">Int</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> e1 <span class="token operator">=</span> E2<span class="token punctuation">.</span><span class="token function">e1</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span><span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> e2 <span class="token operator">=</span> E2<span class="token punctuation">.</span><span class="token function">e2</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>

<span class="token keyword">switch</span> e1 <span class="token punctuation">&#123;</span>
<span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">e1</span><span class="token punctuation">(</span><span class="token keyword">let</span> array<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token function">print</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span>
<span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">e2</span><span class="token punctuation">(</span><span class="token keyword">let</span> int<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token function">print</span><span class="token punctuation">(</span>int<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span>e2<span class="token punctuation">)</span>

<span class="token comment">// 原始值</span>
<span class="token function">print</span><span class="token punctuation">(</span>E1<span class="token punctuation">.</span>e1<span class="token punctuation">.</span>rawValue<span class="token punctuation">)</span>

<span class="token comment">// 遵循 CaseIterable 协议可迭代</span>
<span class="token keyword">for</span> ie <span class="token keyword">in</span> E1<span class="token punctuation">.</span>allCases <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"show </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">ie</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 递归枚举</span>
<span class="token keyword">enum</span> <span class="token constant">RE</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token function">v</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>
    <span class="token keyword">indirect</span> <span class="token keyword">case</span> <span class="token function">node</span><span class="token punctuation">(</span>l<span class="token punctuation">:</span><span class="token constant">RE</span><span class="token punctuation">,</span> r<span class="token punctuation">:</span><span class="token constant">RE</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> lNode <span class="token operator">=</span> <span class="token constant">RE</span><span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"left"</span></span><span class="token punctuation">)</span>
<span class="token keyword">let</span> rNode <span class="token operator">=</span> <span class="token constant">RE</span><span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"right"</span></span><span class="token punctuation">)</span>
<span class="token keyword">let</span> pNode <span class="token operator">=</span> <span class="token constant">RE</span><span class="token punctuation">.</span><span class="token function">node</span><span class="token punctuation">(</span>l<span class="token punctuation">:</span> lNode<span class="token punctuation">,</span> r<span class="token punctuation">:</span> rNode<span class="token punctuation">)</span>

<span class="token keyword">switch</span> pNode <span class="token punctuation">&#123;</span>
<span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span><span class="token keyword">let</span> string<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token function">print</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>
<span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">node</span><span class="token punctuation">(</span><span class="token keyword">let</span> l<span class="token punctuation">,</span> <span class="token keyword">let</span> r<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token function">print</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span>r<span class="token punctuation">)</span>
    <span class="token keyword">switch</span> l <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span><span class="token keyword">let</span> string<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">node</span><span class="token punctuation">(</span><span class="token keyword">let</span> l<span class="token punctuation">,</span> <span class="token keyword">let</span> r<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">switch</span> r <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span><span class="token keyword">let</span> string<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">node</span><span class="token punctuation">(</span><span class="token keyword">let</span> l<span class="token punctuation">,</span> <span class="token keyword">let</span> r<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>@unknown 用来区分固定的枚举和可能改变的枚举的能力。@unknown 用于防止未来新增枚举属性会进行提醒提示完善每个 case 的处理。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// @unknown</span>
<span class="token keyword">enum</span> E3 <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> e1<span class="token punctuation">,</span> e2<span class="token punctuation">,</span> e3
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function-definition function">fe1</span><span class="token punctuation">(</span>e<span class="token punctuation">:</span> E3<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">switch</span> e <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span>e1<span class="token punctuation">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"e1 ok"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span>e2<span class="token punctuation">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"e2 ok"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span>e3<span class="token punctuation">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"e3 ok"</span></span><span class="token punctuation">)</span>
    <span class="token attribute atrule">@unknown</span> <span class="token keyword">default</span><span class="token punctuation">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"not ok"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>符合 Comparable 协议的枚举可以进行比较。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// Comparable 枚举比较</span>
<span class="token keyword">enum</span> E4<span class="token punctuation">:</span> <span class="token class-name">Comparable</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> e1<span class="token punctuation">,</span> e2
    <span class="token keyword">case</span> <span class="token function">e3</span><span class="token punctuation">(</span>i<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span>
    <span class="token keyword">case</span> e4
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> e3 <span class="token operator">=</span> E4<span class="token punctuation">.</span>e4
<span class="token keyword">let</span> e4 <span class="token operator">=</span> E4<span class="token punctuation">.</span><span class="token function">e3</span><span class="token punctuation">(</span>i<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> e5 <span class="token operator">=</span> E4<span class="token punctuation">.</span><span class="token function">e3</span><span class="token punctuation">(</span>i<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> e6 <span class="token operator">=</span> E4<span class="token punctuation">.</span>e1
<span class="token function">print</span><span class="token punctuation">(</span>e3 <span class="token operator">></span> e4<span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token keyword">let</span> a1 <span class="token operator">=</span> <span class="token punctuation">[</span>e3<span class="token punctuation">,</span> e4<span class="token punctuation">,</span> e5<span class="token punctuation">,</span> e6<span class="token punctuation">]</span>
<span class="token keyword">let</span> a2 <span class="token operator">=</span> a1<span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> a2 <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/// e1</span>
<span class="token comment">/// e3(i: 2)</span>
<span class="token comment">/// e3(i: 3)</span>
<span class="token comment">/// e4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="泛型和协议"><a href="#泛型和协议" class="headerlink" title="泛型和协议"></a>泛型和协议</h4><p>泛型可以减少重复代码，是一种抽象的表达方式。where 关键字可以对泛型做约束。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">func</span> <span class="token function-definition function">fn</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> r <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    r<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
    <span class="token keyword">return</span> r
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 结构体</span>
<span class="token keyword">struct</span> S1<span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">mutating</span> <span class="token keyword">func</span> <span class="token function-definition function">add</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> p<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        arr<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">var</span> s1 <span class="token operator">=</span> <span class="token function">S1</span><span class="token punctuation">(</span>arr<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"zero"</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span>
s1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">)</span>
s1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span>arr<span class="token punctuation">)</span> <span class="token comment">// ["zero", "one", "two"]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>关联类型</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">protocol</span> pc <span class="token punctuation">&#123;</span>
    <span class="token keyword">associatedtype</span> <span class="token class-name">T</span>
    <span class="token keyword">mutating</span> <span class="token keyword">func</span> <span class="token function-definition function">add</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> p<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">struct</span> S2<span class="token punctuation">:</span> pc <span class="token punctuation">&#123;</span>
    <span class="token keyword">typealias</span> <span class="token class-name">T</span> <span class="token operator">=</span> <span class="token class-name">String</span> <span class="token comment">// 类型推导，可省略</span>
    <span class="token keyword">var</span> strs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">mutating</span> <span class="token keyword">func</span> <span class="token function-definition function">add</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> p<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        strs<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>泛型适用于嵌套类型</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> S3<span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">struct</span> S4 <span class="token punctuation">&#123;</span>
        <span class="token keyword">var</span> p<span class="token punctuation">:</span> <span class="token class-name">T</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">var</span> p1<span class="token punctuation">:</span> <span class="token class-name">T</span>
    <span class="token keyword">var</span> p2<span class="token punctuation">:</span> S4
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token function">S3</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> S3<span class="token punctuation">.</span><span class="token function">S4</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> s3 <span class="token operator">=</span> <span class="token function">S3</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> S3<span class="token punctuation">.</span><span class="token function">S4</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"three"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>s2<span class="token punctuation">,</span>s3<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>session <a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2022/110352/">Embrace Swift generics</a> 、<a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2022-110353">Design protocol interfaces in Swift</a></p>
<p>swift 5.6 和之前编写泛型接口如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">func</span> <span class="token function-definition function">feed</span><span class="token operator">&lt;</span><span class="token class-name">A</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token omit keyword">_</span> animal<span class="token punctuation">:</span> <span class="token class-name">A</span><span class="token punctuation">)</span> <span class="token keyword">where</span> <span class="token class-name">A</span><span class="token punctuation">:</span> <span class="token class-name">Animal</span>

<span class="token comment">// 👆🏻👇🏻 Equivalents</span>

<span class="token keyword">func</span> <span class="token function-definition function">feed</span><span class="token operator">&lt;</span><span class="token class-name">A</span><span class="token punctuation">:</span> <span class="token class-name">Animal</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token omit keyword">_</span> animal<span class="token punctuation">:</span> <span class="token class-name">A</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>swift 5.7 可以这样写：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">func</span> <span class="token function-definition function">feed</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> animal<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">Animal</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>some 关键字可以用于参数和结构类型。some 会保证类型关系，而 any 会持有任意具体类型，删除类型关系。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0347-type-inference-from-default-exprs.md">SE-0347 Type inference from default expressions</a> 扩展 Swift 泛型参数类型的默认值能力。如下代码示例：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">func</span> <span class="token function-definition function">suffledArray</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Sequence</span><span class="token operator">></span><span class="token punctuation">(</span>from options<span class="token punctuation">:</span> <span class="token class-name">T</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">...</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">.</span><span class="token class-name">Element</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Array</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span><span class="token function">shuffled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">suffledArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">suffledArray</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"three"</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0341-opaque-parameters.md">SE-0341 Opaque Parameter Declarations</a> 使用 some 参数简化泛型参数声明。<a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0328-structural-opaque-result-types.md">SE-0328 Structural opaque result types</a> 扩大不透明结果返回类型可以使用的范围。<a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0360-opaque-result-types-with-availability.md">SE-0360 Opaque result types with limited availability</a> 可用性有限的不透明结果类型，比如 <code>if #available(macOS 13.0, *) &#123;&#125;</code> 就可以根据系统不同版本返回不同类型，新版本出现新类型的 View 就可以和以前的 View 类型区别开。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0309-unlock-existential-types-for-all-protocols.md">SE-0309 Unlock existentials for all protocols</a> 改进了 existentials 和 泛型的交互。这样就可以更方便的检查 Any 类型的两个值是否相等</p>
<p>any 关键字充当的是类型擦除的助手，是通过告知编译器你使用 existential 作为类型，此语法可兼容以前系统。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0346-light-weight-same-type-syntax.md">SE-0346 Lightweight same-type requirements for primary associated types</a> 引入一种新语法，用于符合泛型参数并通过相同类型要求约束关联类型。<a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0358-primary-associated-types-in-stdlib.md">SE-0358 Primary Associated Types in the Standard Library</a> 引入主要关联类型概念，并将其带入了标准库。这些关联类型很像泛型，允许开发者将给定关联类型的类型指定为通用约束。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0353-constrained-existential-types.md">SE-0353 Constrained Existential Types</a> 基于 SE-0309 和 SE-0346 提案，在 existential 类型的上下文中重用轻量关联类型的约束。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0352-implicit-open-existentials.md">SE-0352 Implicitly Opened Existentials</a>  允许 Swift 在很多情况下使用协议调用泛型函数。</p>
<p>Swift 论坛上一个对 any 和 some 关键字语法使用场景的讨论，<a target="_blank" rel="noopener" href="https://forums.swift.org/t/do-any-and-some-help-with-protocol-oriented-testing-at-all/58113">Do <code>any</code> and <code>some</code> help with “Protocol Oriented Testing” at all?</a> 。</p>
<h4 id="不透明类型-1"><a href="#不透明类型-1" class="headerlink" title="不透明类型"></a>不透明类型</h4><p>不透明类型会隐藏类型，让使用者更关注功能。不透明类型和协议很类似，不同的是不透明比协议限定的要多，协议能够对应更多类型。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">protocol</span> <span class="token class-name">P</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">func</span> <span class="token function-definition function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">struct</span> S1<span class="token punctuation">:</span> <span class="token class-name">P</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">func</span> <span class="token function-definition function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">"one\n"</span></span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">struct</span> S2<span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">P</span><span class="token operator">></span><span class="token punctuation">:</span> <span class="token class-name">P</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> p<span class="token punctuation">:</span> <span class="token class-name">T</span>
    <span class="token keyword">func</span> <span class="token function-definition function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> p<span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string-literal"><span class="token string">"two\n"</span></span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">struct</span> S3<span class="token operator">&lt;</span>T1<span class="token punctuation">:</span> <span class="token class-name">P</span><span class="token punctuation">,</span> T2<span class="token punctuation">:</span> <span class="token class-name">P</span><span class="token operator">></span><span class="token punctuation">:</span> <span class="token class-name">P</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> p1<span class="token punctuation">:</span> T1
    <span class="token keyword">var</span> p2<span class="token punctuation">:</span> T2
    <span class="token keyword">func</span> <span class="token function-definition function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> p1<span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> p2<span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string-literal"><span class="token string">"three\n"</span></span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">func</span> <span class="token function-definition function">someP</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token keyword">some</span> <span class="token class-name">P</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">S3</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token function">S1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token function">S2</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token function">S1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token function">someP</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>函数调用者决定返回什么类型是泛型，函数自身决定返回什么类型使用不透明返回类型。</p>
<h4 id="Result-1"><a href="#Result-1" class="headerlink" title="Result"></a>Result</h4><p>Result 类型用来处理错误，特别适用异步接口的错误处理。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">extension</span> <span class="token class-name">URLSession</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">func</span> <span class="token function-definition function">dataTaskWithResult</span><span class="token punctuation">(</span>
        with url<span class="token punctuation">:</span> <span class="token constant">URL</span><span class="token punctuation">,</span>
        handler<span class="token punctuation">:</span> <span class="token attribute atrule">@escaping</span> <span class="token punctuation">(</span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Data</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Void</span>
    <span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">URLSessionDataTask</span> <span class="token punctuation">&#123;</span>
        <span class="token function">dataTask</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> url<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> <span class="token omit keyword">_</span><span class="token punctuation">,</span> err <span class="token keyword">in</span>
            <span class="token keyword">if</span> <span class="token keyword">let</span> err <span class="token operator">=</span> err <span class="token punctuation">&#123;</span>
                <span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">failure</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>data <span class="token operator">??</span> <span class="token class-name">Data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token function">URL</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"https://ming1016.github.io/"</span></span><span class="token punctuation">)</span><span class="token operator">!</span>

<span class="token comment">// 以前网络请求</span>
<span class="token keyword">let</span> t1 <span class="token operator">=</span> <span class="token class-name">URLSession</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token function">dataTask</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> url<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    data<span class="token punctuation">,</span> <span class="token omit keyword">_</span><span class="token punctuation">,</span> error <span class="token keyword">in</span>
    <span class="token keyword">if</span> <span class="token keyword">let</span> err <span class="token operator">=</span> error <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token keyword">let</span> data <span class="token operator">=</span> data <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">(</span>decoding<span class="token punctuation">:</span> data<span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token punctuation">:</span> UTF8<span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
t1<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 使用 Result 网络请求</span>
<span class="token keyword">let</span> t2 <span class="token operator">=</span> <span class="token class-name">URLSession</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token function">dataTaskWithResult</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> url<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> result <span class="token keyword">in</span>
    <span class="token keyword">switch</span> result <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token keyword">let</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">(</span>decoding<span class="token punctuation">:</span> data<span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token punctuation">:</span> UTF8<span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">failure</span><span class="token punctuation">(</span><span class="token keyword">let</span> err<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
t2<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="类型转换-1"><a href="#类型转换-1" class="headerlink" title="类型转换"></a>类型转换</h4><p>使用 is 关键字进行类型判断， 使用as 关键字来转换成子类。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">class</span> S0 <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token keyword">class</span> S1<span class="token punctuation">:</span> S0 <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token keyword">class</span> S2<span class="token punctuation">:</span> S0 <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span>S0<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
a<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token function">S1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
a<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token function">S2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> e <span class="token keyword">in</span> a <span class="token punctuation">&#123;</span>
    <span class="token comment">// 类型判断</span>
    <span class="token keyword">if</span> e <span class="token keyword">is</span> S1 <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Type is S1"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> e <span class="token keyword">is</span> S2 <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Type is S2"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// 使用 as 关键字转换成子类</span>
    <span class="token keyword">if</span> <span class="token keyword">let</span> s1 <span class="token operator">=</span> e <span class="token keyword">as</span><span class="token operator">?</span> S1 <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"As S1 </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">s1</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token keyword">let</span> s2 <span class="token operator">=</span> e <span class="token keyword">as</span><span class="token operator">?</span> S2 <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"As S2 </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">s2</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="类和结构体-1"><a href="#类和结构体-1" class="headerlink" title="类和结构体"></a>类和结构体</h3><h4 id="类-1"><a href="#类-1" class="headerlink" title="类"></a>类</h4><p>类可以定义属性、方法、构造器、下标操作。类使用扩展来扩展功能，遵循协议。类还以继承，运行时检查实例类型。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">class</span> <span class="token class-name">C</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> p<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> p<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>p <span class="token operator">=</span> p
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">// 下标操作</span>
    <span class="token keyword">subscript</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">get</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> p <span class="token operator">+</span> s
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">set</span> <span class="token punctuation">&#123;</span>
            p <span class="token operator">=</span> s <span class="token operator">+</span> newValue
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token class-name">C</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"hi"</span></span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>p<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">" ming"</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span>
c<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"k"</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"v"</span></span>
<span class="token function">print</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>p<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="结构体-1"><a href="#结构体-1" class="headerlink" title="结构体"></a>结构体</h4><p>结构体是值类型，可以定义属性、方法、构造器、下标操作。结构体使用扩展来扩展功能，遵循协议。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">S</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> p1<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span>
    <span class="token keyword">var</span> p2<span class="token punctuation">:</span> <span class="token class-name">Int</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">extension</span> <span class="token class-name">S</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">func</span> <span class="token function-definition function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> p1 <span class="token operator">+</span> <span class="token class-name">String</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token class-name">S</span><span class="token punctuation">(</span>p2<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>p1 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"1"</span></span>
<span class="token function">print</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 11</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="属性-1"><a href="#属性-1" class="headerlink" title="属性"></a>属性</h4><p>类、结构体或枚举里的变量常量就是他们的属性。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">S</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">let</span> sp <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"类型属性"</span></span> <span class="token comment">// 类型属性通过类型本身访问，非实例访问</span>
    <span class="token keyword">var</span> p1<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span>
    <span class="token keyword">var</span> p2<span class="token punctuation">:</span> <span class="token class-name">Int</span> <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token comment">// cp 是计算属性</span>
    <span class="token keyword">var</span> cp<span class="token punctuation">:</span> <span class="token class-name">Int</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">get</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> p2 <span class="token operator">*</span> <span class="token number">2</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">set</span> <span class="token punctuation">&#123;</span>
            p2 <span class="token operator">=</span> newValue <span class="token operator">+</span> <span class="token number">2</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// 只有 getter 的是只读计算属性</span>
    <span class="token keyword">var</span> rcp<span class="token punctuation">:</span> <span class="token class-name">Int</span> <span class="token punctuation">&#123;</span>
        p2 <span class="token operator">*</span> <span class="token number">4</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">S</span><span class="token punctuation">.</span>sp<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">S</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cp<span class="token punctuation">)</span> <span class="token comment">// 2</span>
<span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token class-name">S</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>cp <span class="token operator">=</span> <span class="token number">3</span>
<span class="token function">print</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>p2<span class="token punctuation">)</span> <span class="token comment">// 5</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">S</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rcp<span class="token punctuation">)</span> <span class="token comment">// 4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>willSet 和 didSet 是属性观察器，可以在属性值设置前后插入自己的逻辑处理。</p>
<p>键路径表达式作为函数</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> S2 <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> p1<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">let</span> p2<span class="token punctuation">:</span> <span class="token class-name">Int</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token function">S2</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> s3 <span class="token operator">=</span> <span class="token function">S2</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> a1 <span class="token operator">=</span> <span class="token punctuation">[</span>s2<span class="token punctuation">,</span> s3<span class="token punctuation">]</span>
<span class="token keyword">let</span> a2 <span class="token operator">=</span> a1<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">\</span><span class="token punctuation">.</span>p1<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>a2<span class="token punctuation">)</span> <span class="token comment">// ["one", "two"]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="方法-1"><a href="#方法-1" class="headerlink" title="方法"></a>方法</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">enum</span> <span class="token class-name">E</span><span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> one<span class="token punctuation">,</span> two<span class="token punctuation">,</span> three
    <span class="token keyword">func</span> <span class="token function-definition function">showRawValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span>rawValue<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> e <span class="token operator">=</span> <span class="token class-name">E</span><span class="token punctuation">.</span>three
e<span class="token punctuation">.</span><span class="token function">showRawValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// three</span>

<span class="token comment">// 可变的实例方法，使用 mutating 标记</span>
<span class="token keyword">struct</span> <span class="token class-name">S</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> p<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">mutating</span> <span class="token keyword">func</span> <span class="token function-definition function">addFullStopForP</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        p <span class="token operator">+=</span> <span class="token string-literal"><span class="token string">"."</span></span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token class-name">S</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"hi"</span></span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span><span class="token function">addFullStopForP</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>p<span class="token punctuation">)</span>

<span class="token comment">// 类方法</span>
<span class="token keyword">class</span> <span class="token class-name">C</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">class</span> <span class="token keyword">func</span> <span class="token function-definition function">cf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"类方法"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>static和class关键字修饰的方法类似 OC 的类方法。static 可以修饰存储属性，而 class 不能；class 修饰的方法可以继承，而 static 不能。在协议中需用 static 来修饰。</p>
<p>静态下标方法</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 静态下标</span>
<span class="token keyword">struct</span> S2 <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">var</span> sp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">static</span> <span class="token keyword">subscript</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> s<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> d<span class="token punctuation">:</span> <span class="token class-name">Int</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Int</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">get</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> sp<span class="token punctuation">[</span>s<span class="token punctuation">]</span> <span class="token operator">??</span> d
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">set</span> <span class="token punctuation">&#123;</span>
            sp<span class="token punctuation">[</span>s<span class="token punctuation">]</span> <span class="token operator">=</span> newValue
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

S2<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"key1"</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
S2<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"key2"</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span>
<span class="token function">print</span><span class="token punctuation">(</span>S2<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"key2"</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>
<span class="token function">print</span><span class="token punctuation">(</span>S2<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"key3"</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 10</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>自定义类型中实现了 callAsFunction() 的话，该类型的值就可以直接调用。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// callAsFunction()</span>
<span class="token keyword">struct</span> S3 <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> p1<span class="token punctuation">:</span> <span class="token class-name">String</span>
    
    <span class="token keyword">func</span> <span class="token function-definition function">callAsFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">"show </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">p1</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token function">S3</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"hi"</span></span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">s2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// show hi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="继承-1"><a href="#继承-1" class="headerlink" title="继承"></a>继承</h4><p>类能继承另一个类，继承它的方法、属性等。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 类继承</span>
<span class="token keyword">class</span> C1 <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> p1<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">var</span> cp1<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">get</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> p1 <span class="token operator">+</span> <span class="token string-literal"><span class="token string">" like ATM"</span></span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">set</span> <span class="token punctuation">&#123;</span>
            p1 <span class="token operator">=</span> p1 <span class="token operator">+</span> newValue
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>p1 <span class="token operator">=</span> p1
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">func</span> <span class="token function-definition function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Hi! </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">p1</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> C2<span class="token punctuation">:</span> C1 <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> p2<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span>p2<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>p2 <span class="token operator">=</span> p2
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> p2 <span class="token operator">+</span> <span class="token string-literal"><span class="token string">"'s father"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">C2</span><span class="token punctuation">(</span>p2<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Lemon"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Hi! Lemon's father</span>

<span class="token comment">// 重写父类方法</span>
<span class="token keyword">class</span> C3<span class="token punctuation">:</span> C2 <span class="token punctuation">&#123;</span>
    <span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function-definition function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Hi! </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">p2</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">C3</span><span class="token punctuation">(</span>p2<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Lemon"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Hi! Lemon</span>

<span class="token comment">// 重写计算属性</span>
<span class="token keyword">class</span> C4<span class="token punctuation">:</span> C1 <span class="token punctuation">&#123;</span>
    <span class="token keyword">override</span> <span class="token keyword">var</span> cp1<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">get</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> p1 <span class="token operator">+</span> <span class="token string-literal"><span class="token string">" like Out of the blade"</span></span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">set</span> <span class="token punctuation">&#123;</span>
            p1 <span class="token operator">=</span> p1 <span class="token operator">+</span> newValue
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">C1</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Lemon"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span>cp1<span class="token punctuation">)</span> <span class="token comment">// Lemon like ATM</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">C4</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Lemon"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span>cp1<span class="token punctuation">)</span> <span class="token comment">// Lemon like Out of the blade</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>通过 final 关键字可以防止类被继承，final 还可以用于属性和方法。使用 super 关键字指代父类。</p>
<h3 id="函数式-1"><a href="#函数式-1" class="headerlink" title="函数式"></a>函数式</h3><h4 id="map-1"><a href="#map-1" class="headerlink" title="map"></a>map</h4><p>map 可以依次处理数组中元素，并返回一个处理后的新数组。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> a1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"a"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"b"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"c"</span></span><span class="token punctuation">]</span>
<span class="token keyword">let</span> a2 <span class="token operator">=</span> a1<span class="token punctuation">.</span>map <span class="token punctuation">&#123;</span>
    <span class="token string-literal"><span class="token string">"</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation"><span class="token short-argument">$0</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">2"</span></span>
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span>a2<span class="token punctuation">)</span> <span class="token comment">// ["a2", "b2", "c2"]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用 compactMap 可以过滤 nil 的元素。flatMap 会将多个数组合成一个数组返回。</p>
<h4 id="filter-1"><a href="#filter-1" class="headerlink" title="filter"></a>filter</h4><p>根据指定条件返回</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> a1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"a"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"b"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"c"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"call my name"</span></span><span class="token punctuation">]</span>
<span class="token keyword">let</span> a2 <span class="token operator">=</span> a1<span class="token punctuation">.</span>filter <span class="token punctuation">&#123;</span>
    <span class="token short-argument">$0</span><span class="token punctuation">.</span><span class="token keyword">prefix</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string-literal"><span class="token string">"c"</span></span>
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span>a2<span class="token punctuation">)</span> <span class="token comment">// ["c", "call my name"]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="reduce-1"><a href="#reduce-1" class="headerlink" title="reduce"></a>reduce</h4><p>reduce 可以将迭代中返回的结果用于下个迭代中，并，还能让你设个初始值。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> a1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"a"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"b"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"c"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"call my name."</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"get it?"</span></span><span class="token punctuation">]</span>
<span class="token keyword">let</span> a2 <span class="token operator">=</span> a1<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Hey u,"</span></span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> partialResult<span class="token punctuation">,</span> s <span class="token keyword">in</span>
    <span class="token comment">// partialResult 是前面返回的值，s 是遍历到当前的值</span>
    partialResult <span class="token operator">+</span> <span class="token string-literal"><span class="token string">" </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">s</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token function">print</span><span class="token punctuation">(</span>a2<span class="token punctuation">)</span> <span class="token comment">// Hey u, a b c call my name. get it?</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="sorted-1"><a href="#sorted-1" class="headerlink" title="sorted"></a>sorted</h4><p>排序</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 类型遵循 Comparable</span>
<span class="token keyword">let</span> a1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"a"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"b"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"c"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"call my name."</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"get it?"</span></span><span class="token punctuation">]</span>
<span class="token keyword">let</span> a2 <span class="token operator">=</span> a1<span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> a3 <span class="token operator">=</span> a1<span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span>by<span class="token punctuation">:</span> <span class="token operator">></span><span class="token punctuation">)</span>
<span class="token keyword">let</span> a4 <span class="token operator">=</span> a1<span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span>by<span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token punctuation">)</span>

<span class="token function">print</span><span class="token punctuation">(</span>a2<span class="token punctuation">)</span> <span class="token comment">// Hey u, a b c call my name. get it?</span>
<span class="token function">print</span><span class="token punctuation">(</span>a3<span class="token punctuation">)</span> <span class="token comment">// ["get it?", "call my name.", "c", "b", "a"]</span>
<span class="token function">print</span><span class="token punctuation">(</span>a4<span class="token punctuation">)</span> <span class="token comment">// ["a", "b", "c", "call my name.", "get it?"]</span>

<span class="token comment">// 类型不遵循 Comparable</span>
<span class="token keyword">struct</span> <span class="token class-name">S</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> s<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">var</span> i<span class="token punctuation">:</span> <span class="token class-name">Int</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> a5 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">S</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"a"</span></span><span class="token punctuation">,</span> i<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">S</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"b"</span></span><span class="token punctuation">,</span> i<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">S</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"c"</span></span><span class="token punctuation">,</span> i<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> a6 <span class="token operator">=</span> a5
    <span class="token punctuation">.</span>sorted <span class="token punctuation">&#123;</span> l<span class="token punctuation">,</span> r <span class="token keyword">in</span>
        l<span class="token punctuation">.</span>i <span class="token operator">></span> r<span class="token punctuation">.</span>i
    <span class="token punctuation">&#125;</span>
    <span class="token punctuation">.</span>map <span class="token punctuation">&#123;</span>
        <span class="token short-argument">$0</span><span class="token punctuation">.</span>i
    <span class="token punctuation">&#125;</span>

<span class="token function">print</span><span class="token punctuation">(</span>a6<span class="token punctuation">)</span> <span class="token comment">// [2, 1, 0]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="控制流-1"><a href="#控制流-1" class="headerlink" title="控制流"></a>控制流</h3><h4 id="If-•-If-let-•-If-case-let-1"><a href="#If-•-If-let-•-If-case-let-1" class="headerlink" title="If • If let • If case let"></a>If • If let • If case let</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// if</span>
<span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"hi"</span></span>
<span class="token keyword">if</span> s<span class="token punctuation">.</span>isEmpty <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"String is Empty"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"String is </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">s</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 三元条件</span>
s<span class="token punctuation">.</span>isEmpty <span class="token operator">?</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"String is Empty again"</span></span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"String is </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">s</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> again"</span></span><span class="token punctuation">)</span>

<span class="token comment">// if let-else</span>
<span class="token keyword">func</span> <span class="token function-definition function">f</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token keyword">let</span> s1 <span class="token operator">=</span> s <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"s1 is </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">s1</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"s1 is nothing"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// nil-coalescing</span>
    <span class="token keyword">let</span> s2 <span class="token operator">=</span> s <span class="token operator">??</span> <span class="token string-literal"><span class="token string">"nothing"</span></span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"s2 is </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">s2</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token function">f</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"something"</span></span><span class="token punctuation">)</span>
<span class="token function">f</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span>

<span class="token comment">// if case let</span>
<span class="token keyword">enum</span> <span class="token class-name">E</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token function">c1</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>
    <span class="token keyword">case</span> <span class="token function">c2</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    
    <span class="token keyword">func</span> <span class="token function-definition function">des</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">switch</span> <span class="token keyword">self</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">c1</span><span class="token punctuation">(</span><span class="token keyword">let</span> string<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token function">print</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">c2</span><span class="token punctuation">(</span><span class="token keyword">let</span> array<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token function">print</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token class-name">E</span><span class="token punctuation">.</span><span class="token function">c1</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"enum c1"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">des</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token class-name">E</span><span class="token punctuation">.</span><span class="token function">c2</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"three"</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">des</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="Guard-guard-guard-let-1"><a href="#Guard-guard-guard-let-1" class="headerlink" title="Guard guard, guard let"></a>Guard guard, guard let</h4><p>更好地处理异常情况</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// guard</span>
<span class="token keyword">func</span> <span class="token function-definition function">f1</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">guard</span> p<span class="token punctuation">.</span>isEmpty <span class="token operator">!=</span> <span class="token boolean">true</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">"Empty string."</span></span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">"String </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">p</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> is not empty."</span></span>
<span class="token punctuation">&#125;</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">f1</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Empty string.</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">f1</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"lemon"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// String lemon is not empty.</span>

<span class="token comment">// guard let</span>
<span class="token keyword">func</span> <span class="token function-definition function">f2</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">guard</span> <span class="token keyword">let</span> p2 <span class="token operator">=</span> p1 <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">"Nil."</span></span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">"String </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">p2</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> is not nil."</span></span>
<span class="token punctuation">&#125;</span>

<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">f2</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Nil.</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">f2</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"lemon"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// String lemon is not nil.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="遍历-For-in-1"><a href="#遍历-For-in-1" class="headerlink" title="遍历 For-in"></a>遍历 For-in</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"three"</span></span><span class="token punctuation">]</span>
<span class="token keyword">for</span> str <span class="token keyword">in</span> a <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用下标范围</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token operator">..&lt;</span><span class="token number">10</span> <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用 enumerated</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> str<span class="token punctuation">)</span> <span class="token keyword">in</span> a<span class="token punctuation">.</span><span class="token function">enumerated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"第</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i <span class="token operator">+</span> <span class="token number">1</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">个是:</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">str</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// for in where</span>
<span class="token keyword">for</span> str <span class="token keyword">in</span> a <span class="token keyword">where</span> str<span class="token punctuation">.</span><span class="token keyword">prefix</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string-literal"><span class="token string">"t"</span></span> <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 字典 for in，遍历是无序的</span>
<span class="token keyword">let</span> dic <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">"three"</span></span><span class="token punctuation">:</span> <span class="token number">3</span>
<span class="token punctuation">]</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> dic <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"key is </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">k</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">, value is </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">v</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// stride</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">stride</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> through<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> by<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/*
 10
 8
 6
 4
 2
 0
 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="While-while-repeat-while-1"><a href="#While-while-repeat-while-1" class="headerlink" title="While while, repeat-while"></a>While while, repeat-while</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// while</span>
<span class="token keyword">var</span> i1 <span class="token operator">=</span> <span class="token number">10</span>
<span class="token keyword">while</span> i1 <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"positive even number </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i1</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
    i1 <span class="token operator">-=</span> <span class="token number">2</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// repeat while</span>
<span class="token keyword">var</span> i2 <span class="token operator">=</span> <span class="token number">10</span>
<span class="token keyword">repeat</span> <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"positive even number </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i2</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
    i2 <span class="token operator">-=</span> <span class="token number">2</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">while</span> i2 <span class="token operator">></span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用 break 结束遍历，使用 continue 跳过当前作用域，继续下个循环</p>
<h4 id="Switch-1"><a href="#Switch-1" class="headerlink" title="Switch"></a>Switch</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">func</span> <span class="token function-definition function">f1</span><span class="token punctuation">(</span>pa<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> t<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Int</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> p1 <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">var</span> p2 <span class="token operator">=</span> <span class="token number">10</span>
    <span class="token keyword">switch</span> pa <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">:</span>
        p1 <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">case</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">:</span>
        p1 <span class="token operator">=</span> <span class="token number">2</span>
        <span class="token keyword">fallthrough</span> <span class="token comment">// 继续到下个 case 中</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
        p2 <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"p1 is </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">p1</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"p2 is </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">p2</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment">// 元组</span>
    <span class="token keyword">switch</span> t <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"0"</span></span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"zero"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">case</span> <span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"1"</span></span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"no"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">f1</span><span class="token punctuation">(</span>pa<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">,</span> t<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"1"</span></span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">/*
 p1 is 2
 p2 is 0
 one
 */</span>

<span class="token comment">// 枚举</span>
<span class="token keyword">enum</span> <span class="token class-name">E</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> one<span class="token punctuation">,</span> two<span class="token punctuation">,</span> three<span class="token punctuation">,</span> <span class="token function">unknown</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function-definition function">f2</span><span class="token punctuation">(</span>pa<span class="token punctuation">:</span> <span class="token class-name">E</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> p<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">switch</span> pa <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span>one<span class="token punctuation">:</span>
        p <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"1"</span></span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span>two<span class="token punctuation">:</span>
        p <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"2"</span></span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span>three<span class="token punctuation">:</span>
        p <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"3"</span></span>
    <span class="token keyword">case</span> <span class="token keyword">let</span> <span class="token punctuation">.</span><span class="token function">unknown</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span> <span class="token keyword">where</span> <span class="token class-name">Int</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token number">0</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">:</span> <span class="token comment">// 枚举关联值，使用 where 增加条件</span>
        p <span class="token operator">=</span> u
    <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">unknown</span><span class="token punctuation">(</span><span class="token omit keyword">_</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        p <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"negative number"</span></span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token function">f2</span><span class="token punctuation">(</span>pa<span class="token punctuation">:</span> <span class="token class-name">E</span><span class="token punctuation">.</span>one<span class="token punctuation">)</span> <span class="token comment">// 1</span>
<span class="token function">f2</span><span class="token punctuation">(</span>pa<span class="token punctuation">:</span> <span class="token class-name">E</span><span class="token punctuation">.</span><span class="token function">unknown</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"10"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 10</span>
<span class="token function">f2</span><span class="token punctuation">(</span>pa<span class="token punctuation">:</span> <span class="token class-name">E</span><span class="token punctuation">.</span><span class="token function">unknown</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"-10"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// negative number</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="集合-1"><a href="#集合-1" class="headerlink" title="集合"></a>集合</h3><h4 id="数组-1-2-3-1"><a href="#数组-1-2-3-1" class="headerlink" title="数组 [1, 2, 3]"></a>数组 [1, 2, 3]</h4><p>数组是有序集合</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">var</span> a0<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span>
a0<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
a0<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>at<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>a0<span class="token punctuation">)</span> <span class="token comment">// [10, 2]</span>

<span class="token keyword">let</span> a1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"three"</span></span><span class="token punctuation">]</span>
<span class="token keyword">let</span> a2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"three"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"four"</span></span><span class="token punctuation">]</span>

<span class="token comment">// 找两个集合的不同</span>
<span class="token keyword">let</span> dif <span class="token operator">=</span> a1<span class="token punctuation">.</span><span class="token function">difference</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> a2<span class="token punctuation">)</span> <span class="token comment">// swift的 diffing 算法在这 http://www.xmailserver.org/diff2.pdf swift实现在  swift/stdlib/public/core/Diffing.swift</span>
<span class="token keyword">for</span> c <span class="token keyword">in</span> dif <span class="token punctuation">&#123;</span>
    <span class="token keyword">switch</span> c <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">let</span> o<span class="token punctuation">,</span> <span class="token keyword">let</span> e<span class="token punctuation">,</span> <span class="token keyword">let</span> a<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"offset:</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">o</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">, element:</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">e</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">, associatedWith:</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation"><span class="token class-name">String</span><span class="token punctuation">(</span>describing<span class="token punctuation">:</span> a<span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">let</span> o<span class="token punctuation">,</span> <span class="token keyword">let</span> e<span class="token punctuation">,</span> <span class="token keyword">let</span> a<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"offset:</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">o</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">, element:</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">e</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">, associatedWith:</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation"><span class="token class-name">String</span><span class="token punctuation">(</span>describing<span class="token punctuation">:</span> a<span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/*
 remove offset:1, element:four, associatedWith:nil
 insert offset:0, element:one, associatedWith:nil
 insert offset:1, element:two, associatedWith:nil
 */</span>
<span class="token keyword">let</span> a3 <span class="token operator">=</span> a2<span class="token punctuation">.</span><span class="token function">applying</span><span class="token punctuation">(</span>dif<span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 可以用于添加删除动画</span>
<span class="token function">print</span><span class="token punctuation">(</span>a3<span class="token punctuation">)</span> <span class="token comment">// ["one", "two", "three"]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>dif 有第三个 case 值 .insert(let offset, let element, let associatedWith) 可以跟踪成对的变化，用于高级动画。</p>
<p>从数组中随机取一个元素</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token function">print</span><span class="token punctuation">(</span>a0<span class="token punctuation">.</span><span class="token function">randomElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token number">0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>数组排序</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 排序</span>
<span class="token keyword">struct</span> S1 <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> n<span class="token punctuation">:</span> <span class="token class-name">Int</span>
    <span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> a4 <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token function">S1</span><span class="token punctuation">(</span>n<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">S1</span><span class="token punctuation">(</span>n<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">S1</span><span class="token punctuation">(</span>n<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">S1</span><span class="token punctuation">(</span>n<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
<span class="token keyword">let</span> a5 <span class="token operator">=</span> a4<span class="token punctuation">.</span>sorted <span class="token punctuation">&#123;</span> i1<span class="token punctuation">,</span> i2 <span class="token keyword">in</span>
    i1<span class="token punctuation">.</span>n <span class="token operator">&lt;</span> i2<span class="token punctuation">.</span>n
<span class="token punctuation">&#125;</span>
<span class="token keyword">for</span> n <span class="token keyword">in</span> a5 <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/// S1(n: 1)</span>
<span class="token comment">/// S1(n: 2)</span>
<span class="token comment">/// S1(n: 3)</span>
<span class="token comment">/// S1(n: 10)</span>

<span class="token keyword">let</span> a6 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span>
<span class="token function">print</span><span class="token punctuation">(</span>a6<span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span>by<span class="token punctuation">:</span> <span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [10, 7, 4, 2, 1]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以加到数组扩展中，通过扩展约束能够指定特定元素类型的排序，代码如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">extension</span> <span class="token class-name">Array</span> <span class="token keyword">where</span> <span class="token class-name">Element</span> <span class="token operator">==</span> <span class="token class-name">Int</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 升序</span>
    <span class="token keyword">func</span> <span class="token function-definition function">intSortedASC</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">[</span><span class="token class-name">Int</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span>by<span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// 降序</span>
    <span class="token keyword">func</span> <span class="token function-definition function">intSortedDESC</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">[</span><span class="token class-name">Int</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span>by<span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">print</span><span class="token punctuation">(</span>a6<span class="token punctuation">.</span><span class="token function">intSortedASC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 使用扩展增加自定义排序能力</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在数组中检索满足条件的元素，代码如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 第一个满足条件了就返回</span>
<span class="token keyword">let</span> a7 <span class="token operator">=</span> a4<span class="token punctuation">.</span>first <span class="token punctuation">&#123;</span>
    <span class="token short-argument">$0</span><span class="token punctuation">.</span>n <span class="token operator">==</span> <span class="token number">10</span>
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span>a7<span class="token operator">?</span><span class="token punctuation">.</span>n <span class="token operator">??</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment">// 是否都满足了条件</span>
<span class="token function">print</span><span class="token punctuation">(</span>a4<span class="token punctuation">.</span>allSatisfy <span class="token punctuation">&#123;</span> <span class="token short-argument">$0</span><span class="token punctuation">.</span>n <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
<span class="token function">print</span><span class="token punctuation">(</span>a4<span class="token punctuation">.</span><span class="token function">allSatisfy</span><span class="token punctuation">(</span><span class="token punctuation">\</span><span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>

<span class="token comment">// 找出最大的那个</span>
<span class="token function">print</span><span class="token punctuation">(</span>a4<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>by<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span> e1<span class="token punctuation">,</span> e2 <span class="token keyword">in</span>
    e1<span class="token punctuation">.</span>n <span class="token operator">&lt;</span> e2<span class="token punctuation">.</span>n
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token function">S1</span><span class="token punctuation">(</span>n<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// S1(n: 10, b: true)</span>

<span class="token comment">// 看看是否包含某个元素</span>
<span class="token function">print</span><span class="token punctuation">(</span>a4<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token keyword">where</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
    <span class="token short-argument">$0</span><span class="token punctuation">.</span>n <span class="token operator">==</span> <span class="token number">7</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>一些切割数组的方法。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 切片</span>
<span class="token comment">// 取前3个，并不是直接复制，对于大的数组有性能优势。</span>
<span class="token function">print</span><span class="token punctuation">(</span>a6<span class="token punctuation">[</span><span class="token operator">..&lt;</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// [1, 10, 4] 需要做越界检查</span>
<span class="token function">print</span><span class="token punctuation">(</span>a6<span class="token punctuation">.</span><span class="token keyword">prefix</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [1, 10, 4, 7, 2] 不需要做越界检查，也是切片，性能一样</span>

<span class="token comment">// 去掉前3个</span>
<span class="token function">print</span><span class="token punctuation">(</span>a6<span class="token punctuation">.</span><span class="token function">dropFirst</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [7, 2]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>prefix(while:) 和 drop(while:) 方法，顺序遍历执行闭包里的逻辑判断，满足条件就返回，遇到不匹配就会停止遍历。prefix 返回满足条件的元素集合，drop 返回停止遍历之后那些元素集合。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> a8 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> a9 <span class="token operator">=</span> a8<span class="token punctuation">.</span><span class="token keyword">prefix</span> <span class="token punctuation">&#123;</span>
    <span class="token short-argument">$0</span> <span class="token operator">&lt;</span> <span class="token number">30</span>
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span>a9<span class="token punctuation">)</span> <span class="token comment">// [8, 9, 20, 1]</span>
<span class="token keyword">let</span> a10 <span class="token operator">=</span> a8<span class="token punctuation">.</span>drop <span class="token punctuation">&#123;</span>
    <span class="token short-argument">$0</span> <span class="token operator">&lt;</span> <span class="token number">30</span>
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span>a10<span class="token punctuation">)</span> <span class="token comment">// [35, 3]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>比 filter 更高效的删除元素的方法 removeAll</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 删除所有不满足条件的元素</span>
<span class="token keyword">var</span> a11 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">]</span>
a11<span class="token punctuation">.</span>removeAll <span class="token punctuation">&#123;</span> <span class="token short-argument">$0</span> <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span>a11<span class="token punctuation">)</span> <span class="token comment">// [4, 3, 1, 3, 3] 随机</span>

<span class="token comment">// 创建未初始化的数组</span>
<span class="token keyword">let</span> a12 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">...</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span>map <span class="token punctuation">&#123;</span> <span class="token omit keyword">_</span> <span class="token keyword">in</span>
    <span class="token class-name">Int</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token operator">...</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span>a12<span class="token punctuation">)</span> <span class="token comment">// [0, 3, 3, 2, 5] 随机</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>#if 用于后缀表达式</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// #if 用于后缀表达式</span>
<span class="token keyword">let</span> a13 <span class="token operator">=</span> a11
<span class="token directive property"><span class="token directive-name">#if</span> os<span class="token punctuation">(</span>iOS<span class="token punctuation">)</span></span>
    <span class="token punctuation">.</span>count
<span class="token directive property"><span class="token directive-name">#else</span></span>
    <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">+</span><span class="token punctuation">)</span>
<span class="token directive property"><span class="token directive-name">#endif</span></span>
<span class="token function">print</span><span class="token punctuation">(</span>a13<span class="token punctuation">)</span> <span class="token comment">//37</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="Sets-Set"><a href="#Sets-Set" class="headerlink" title="Sets Set"></a>Sets Set<Int></h4><p>Set 是无序集合，元素唯一</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> s0<span class="token punctuation">:</span> <span class="token class-name">Set</span><span class="token operator">&lt;</span><span class="token class-name">Int</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> s1<span class="token punctuation">:</span> <span class="token class-name">Set</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> s2<span class="token punctuation">:</span> <span class="token class-name">Set</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span>

<span class="token keyword">let</span> s3 <span class="token operator">=</span> s1<span class="token punctuation">.</span><span class="token function">union</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span> <span class="token comment">// 合集</span>
<span class="token keyword">let</span> s4 <span class="token operator">=</span> s1<span class="token punctuation">.</span><span class="token function">intersection</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span> <span class="token comment">// 交集</span>
<span class="token keyword">let</span> s5 <span class="token operator">=</span> s1<span class="token punctuation">.</span><span class="token function">subtracting</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span> <span class="token comment">// 非交集部分</span>
<span class="token keyword">let</span> s6 <span class="token operator">=</span> s1<span class="token punctuation">.</span><span class="token function">symmetricDifference</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span> <span class="token comment">// 非交集的合集</span>
<span class="token function">print</span><span class="token punctuation">(</span>s3<span class="token punctuation">)</span> <span class="token comment">// [4, 2, 1, 7, 3, 10, 8, 9, 6, 5]</span>
<span class="token function">print</span><span class="token punctuation">(</span>s4<span class="token punctuation">)</span> <span class="token comment">// [10]</span>
<span class="token function">print</span><span class="token punctuation">(</span>s5<span class="token punctuation">)</span> <span class="token comment">// [8, 4, 2, 6]</span>
<span class="token function">print</span><span class="token punctuation">(</span>s6<span class="token punctuation">)</span> <span class="token comment">// [9, 1, 3, 4, 5, 2, 6, 8, 7]</span>

<span class="token comment">// s0 是否被 s1 包含</span>
<span class="token function">print</span><span class="token punctuation">(</span>s0<span class="token punctuation">.</span><span class="token function">isSubset</span><span class="token punctuation">(</span>of<span class="token punctuation">:</span> s1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token comment">// s1 是否包含了 s0</span>
<span class="token function">print</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span><span class="token function">isSuperset</span><span class="token punctuation">(</span>of<span class="token punctuation">:</span> s0<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>

<span class="token keyword">let</span> s7<span class="token punctuation">:</span> <span class="token class-name">Set</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
<span class="token comment">// s0 和 s7 是否有交集</span>
<span class="token function">print</span><span class="token punctuation">(</span>s0<span class="token punctuation">.</span><span class="token function">isDisjoint</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> s7<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>

<span class="token comment">// 可变 Set</span>
<span class="token keyword">var</span> s8<span class="token punctuation">:</span> <span class="token class-name">Set</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">]</span>
s8<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"three"</span></span><span class="token punctuation">)</span>
s8<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>s8<span class="token punctuation">)</span> <span class="token comment">// ["two", "three"]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="字典-1"><a href="#字典-1" class="headerlink" title="字典 [:]"></a>字典 [:]</h4><p>字典是无序集合，键值对应。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">var</span> d1 <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string-literal"><span class="token string">"k1"</span></span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"v1"</span></span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">"k2"</span></span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"v2"</span></span>
<span class="token punctuation">]</span>
d1<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"k3"</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"v3"</span></span>
d1<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"k4"</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token nil constant">nil</span>

<span class="token function">print</span><span class="token punctuation">(</span>d1<span class="token punctuation">)</span> <span class="token comment">// ["k2": "v2", "k3": "v3", "k1": "v1"]</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> d1 <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"key is </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">k</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">, value is </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">v</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/*
 key is k1, value is v1
 key is k2, value is v2
 key is k3, value is v3
 */</span>
 
<span class="token keyword">if</span> d1<span class="token punctuation">.</span>isEmpty <span class="token operator">==</span> <span class="token boolean">false</span> <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>d1<span class="token punctuation">.</span>count<span class="token punctuation">)</span> <span class="token comment">// 3</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// mapValues</span>
<span class="token keyword">let</span> d2 <span class="token operator">=</span> d1<span class="token punctuation">.</span>mapValues <span class="token punctuation">&#123;</span>
    <span class="token short-argument">$0</span> <span class="token operator">+</span> <span class="token string-literal"><span class="token string">"_new"</span></span>
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span>d2<span class="token punctuation">)</span> <span class="token comment">// ["k2": "v2_new", "k3": "v3_new", "k1": "v1_new"]</span>

<span class="token comment">// 对字典的值或键进行分组</span>
<span class="token keyword">let</span> d3 <span class="token operator">=</span> <span class="token class-name">Dictionary</span><span class="token punctuation">(</span>grouping<span class="token punctuation">:</span> d1<span class="token punctuation">.</span>values<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token short-argument">$0</span><span class="token punctuation">.</span>count
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span>d3<span class="token punctuation">)</span> <span class="token comment">// [2: ["v1", "v2", "v3"]]</span>

<span class="token comment">// 从字典中取值，如果键对应无值，则使用通过 default 指定的默认值</span>
d1<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"k5"</span></span><span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"whatever"</span></span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token string-literal"><span class="token string">"."</span></span>
<span class="token function">print</span><span class="token punctuation">(</span>d1<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"k5"</span></span><span class="token punctuation">]</span> <span class="token operator">??</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span> <span class="token comment">// whatever.</span>
<span class="token keyword">let</span> v1 <span class="token operator">=</span> d1<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"k3"</span></span><span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"whatever"</span></span><span class="token punctuation">]</span>
<span class="token function">print</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span> <span class="token comment">// v3</span>

<span class="token comment">// compactMapValues() 对字典值进行转换和解包。可以解可选类型，并去掉 nil 值</span>
<span class="token keyword">let</span> d4 <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string-literal"><span class="token string">"k1"</span></span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">"k2"</span></span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token string-literal"><span class="token string">"k3"</span></span><span class="token punctuation">:</span> <span class="token nil constant">nil</span>
<span class="token punctuation">]</span>
<span class="token keyword">let</span> d5 <span class="token operator">=</span> d4<span class="token punctuation">.</span>mapValues <span class="token punctuation">&#123;</span> <span class="token short-argument">$0</span> <span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> d6 <span class="token operator">=</span> d4<span class="token punctuation">.</span>compactMapValues<span class="token punctuation">&#123;</span> <span class="token short-argument">$0</span> <span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span>d5<span class="token punctuation">)</span>
<span class="token comment">// ["k3": nil, "k1": Optional(1), "k2": Optional(2)]</span>
<span class="token function">print</span><span class="token punctuation">(</span>d6<span class="token punctuation">)</span>
<span class="token comment">// ["k1": 1, "k2": 2]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="操作符-1"><a href="#操作符-1" class="headerlink" title="操作符"></a>操作符</h3><h4 id="赋值-x3D-x3D-x3D-x3D-x2F-x3D-1"><a href="#赋值-x3D-x3D-x3D-x3D-x2F-x3D-1" class="headerlink" title="赋值 &#x3D;, +&#x3D;. -&#x3D;, *&#x3D;, &#x2F;&#x3D;"></a>赋值 &#x3D;, +&#x3D;. -&#x3D;, *&#x3D;, &#x2F;&#x3D;</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> i1 <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">var</span> i2 <span class="token operator">=</span> i1
i2 <span class="token operator">=</span> <span class="token number">2</span>
<span class="token function">print</span><span class="token punctuation">(</span>i2<span class="token punctuation">)</span> <span class="token comment">// 2</span>

i2 <span class="token operator">+=</span> <span class="token number">1</span>
<span class="token function">print</span><span class="token punctuation">(</span>i2<span class="token punctuation">)</span> <span class="token comment">// 3</span>

i2 <span class="token operator">-=</span> <span class="token number">2</span>
<span class="token function">print</span><span class="token punctuation">(</span>i2<span class="token punctuation">)</span> <span class="token comment">// 1</span>

i2 <span class="token operator">*=</span> <span class="token number">10</span>
<span class="token function">print</span><span class="token punctuation">(</span>i2<span class="token punctuation">)</span> <span class="token comment">// 10</span>

i2 <span class="token operator">/=</span> <span class="token number">2</span>
<span class="token function">print</span><span class="token punctuation">(</span>i2<span class="token punctuation">)</span> <span class="token comment">// 5</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="计算符-x2F-1"><a href="#计算符-x2F-1" class="headerlink" title="计算符 +, -, *, &#x2F;, %"></a>计算符 +, -, *, &#x2F;, %</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> i1 <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">let</span> i2 <span class="token operator">=</span> i1
<span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i1 <span class="token operator">+</span> i2 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"i"</span></span> <span class="token operator">+</span> <span class="token string-literal"><span class="token string">"1"</span></span><span class="token punctuation">)</span> <span class="token comment">// i1</span>

<span class="token comment">// 一元运算符</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token operator">-</span>i1<span class="token punctuation">)</span> <span class="token comment">// -1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="比较运算符-x3D-x3D-gt-1"><a href="#比较运算符-x3D-x3D-gt-1" class="headerlink" title="比较运算符 &#x3D;&#x3D;, &gt;"></a>比较运算符 &#x3D;&#x3D;, &gt;</h4><p>遵循 Equatable 协议可以使用 &#x3D;&#x3D; 和 !&#x3D; 来判断是否相等</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token function">print</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">></span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// false</span>

<span class="token keyword">struct</span> <span class="token class-name">S</span><span class="token punctuation">:</span> <span class="token class-name">Equatable</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> p1<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">var</span> p2<span class="token punctuation">:</span> <span class="token class-name">Int</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token class-name">S</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token class-name">S</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> s3 <span class="token operator">=</span> <span class="token class-name">S</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> s4 <span class="token operator">=</span> <span class="token class-name">S</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>

<span class="token function">print</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s2<span class="token punctuation">)</span> <span class="token comment">// false</span>
<span class="token function">print</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s3<span class="token punctuation">)</span> <span class="token comment">// false</span>
<span class="token function">print</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s4<span class="token punctuation">)</span> <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>类需要实现 &#x3D;&#x3D; 函数</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">:</span> <span class="token class-name">Equatable</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> p1<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">var</span> p2<span class="token punctuation">:</span> <span class="token class-name">Int</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>p1 <span class="token operator">=</span> p1
        <span class="token keyword">self</span><span class="token punctuation">.</span>p2 <span class="token operator">=</span> p2
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token operator">==</span> <span class="token punctuation">(</span>l<span class="token punctuation">:</span> <span class="token class-name">C</span><span class="token punctuation">,</span> r<span class="token punctuation">:</span> <span class="token class-name">C</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Bool</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> l<span class="token punctuation">.</span>p1 <span class="token operator">==</span> r<span class="token punctuation">.</span>p1 <span class="token operator">&amp;&amp;</span> l<span class="token punctuation">.</span>p2 <span class="token operator">==</span> r<span class="token punctuation">.</span>p2
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> c1 <span class="token operator">=</span> <span class="token class-name">C</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> c2 <span class="token operator">=</span> <span class="token class-name">C</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>c1 <span class="token operator">==</span> c2<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 元组比较</span>
<span class="token comment">// 会先比较第一个数，第一个无法比较才会比较第二个数</span>
<span class="token comment">// 字符串比较和字母大小还有长度有关。先比较字母大小，在比较长度</span>
<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"apple"</span></span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"apple"</span></span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"applf"</span></span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"apple"</span></span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"appl"</span></span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"apple"</span></span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"appm"</span></span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"apple"</span></span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="三元-1"><a href="#三元-1" class="headerlink" title="三元 _ ? _ : _"></a>三元 _ ? _ : _</h4><p>简化 if else 写法</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// if else</span>
<span class="token keyword">func</span> <span class="token function-definition function">f1</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> p <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"positive number"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"negative number"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 三元</span>
<span class="token keyword">func</span> <span class="token function-definition function">f2</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    p <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"positive number"</span></span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"negative number"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token function">f1</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token function">f2</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="Nil-coalescing-1"><a href="#Nil-coalescing-1" class="headerlink" title="Nil-coalescing ??"></a>Nil-coalescing ??</h4><p>简化 if let else 写法</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// if else</span>
<span class="token keyword">func</span> <span class="token function-definition function">f1</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token keyword">let</span> i <span class="token operator">=</span> p <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"p have value is </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"p is nil, use defalut value"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用 ??</span>
<span class="token keyword">func</span> <span class="token function-definition function">f2</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> i <span class="token operator">=</span> p <span class="token operator">??</span> <span class="token number">0</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"p is </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="范围-a…b-1"><a href="#范围-a…b-1" class="headerlink" title="范围 a…b"></a>范围 a…b</h4><p>简化的值范围表达方式。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 封闭范围</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token operator">...</span><span class="token number">10</span> <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 半开范围</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token operator">..&lt;</span><span class="token number">10</span> <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 单侧区间</span>
<span class="token keyword">let</span> nums <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span>
<span class="token function">print</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 7 8</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<h4 id="逻辑-amp-amp-1"><a href="#逻辑-amp-amp-1" class="headerlink" title="逻辑 !, &amp;&amp;, ||"></a>逻辑 !, &amp;&amp;, ||</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> i1 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token keyword">let</span> i2 <span class="token operator">=</span> <span class="token number">2</span>

<span class="token keyword">if</span> i1 <span class="token operator">!=</span> i2 <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>i1 <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> i2 <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"i1 and i2 not equal, and one of them is negative number."</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="恒等-x3D-x3D-x3D-x3D-x3D-1"><a href="#恒等-x3D-x3D-x3D-x3D-x3D-1" class="headerlink" title="恒等 &#x3D;&#x3D;&#x3D;, !&#x3D;&#x3D;"></a>恒等 &#x3D;&#x3D;&#x3D;, !&#x3D;&#x3D;</h4><p>恒等返回是否引用了相同实例。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">class</span> <span class="token class-name">C</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> p<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>p <span class="token operator">=</span> p
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> c1 <span class="token operator">=</span> <span class="token class-name">C</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">)</span>
<span class="token keyword">let</span> c2 <span class="token operator">=</span> <span class="token class-name">C</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">)</span>
<span class="token keyword">let</span> c3 <span class="token operator">=</span> c1

<span class="token function">print</span><span class="token punctuation">(</span>c1 <span class="token operator">===</span> c2<span class="token punctuation">)</span> <span class="token comment">// false</span>
<span class="token function">print</span><span class="token punctuation">(</span>c1 <span class="token operator">===</span> c3<span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token function">print</span><span class="token punctuation">(</span>c1 <span class="token operator">!==</span> c2<span class="token punctuation">)</span> <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="运算符-1"><a href="#运算符-1" class="headerlink" title="运算符"></a>运算符</h4><p>位运算符</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> i1<span class="token punctuation">:</span> <span class="token class-name">UInt8</span> <span class="token operator">=</span> <span class="token number">0b00001111</span>
<span class="token keyword">let</span> i2 <span class="token operator">=</span> <span class="token operator">~</span>i1 <span class="token comment">// Bitwise NOT Operator（按位取反运算符），取反</span>

<span class="token keyword">let</span> i3<span class="token punctuation">:</span> <span class="token class-name">UInt8</span> <span class="token operator">=</span> <span class="token number">0b00111111</span>
<span class="token keyword">let</span> i4 <span class="token operator">=</span> i1 <span class="token operator">&amp;</span> i3 <span class="token comment">// Bitwise AND Operator（按位与运算符），都为1才是1</span>
<span class="token keyword">let</span> i5 <span class="token operator">=</span> i1 <span class="token operator">|</span> i3 <span class="token comment">// Bitwise OR Operator（按位或运算符），有一个1就是1</span>
<span class="token keyword">let</span> i6 <span class="token operator">=</span> i1 <span class="token operator">^</span> i3 <span class="token comment">// Bitwise XOR Operator（按位异或运算符），不同为1，相同为0</span>

<span class="token function">print</span><span class="token punctuation">(</span>i1<span class="token punctuation">,</span>i2<span class="token punctuation">,</span>i3<span class="token punctuation">,</span>i4<span class="token punctuation">,</span>i5<span class="token punctuation">,</span>i6<span class="token punctuation">)</span>

<span class="token comment">// &lt;&lt; 按位左移，>> 按位右移</span>
<span class="token keyword">let</span> i7 <span class="token operator">=</span> i1 <span class="token operator">&lt;&lt;</span> <span class="token number">1</span>
<span class="token keyword">let</span> i8 <span class="token operator">=</span> i1 <span class="token operator">>></span> <span class="token number">2</span>
<span class="token function">print</span><span class="token punctuation">(</span>i7<span class="token punctuation">,</span>i8<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>溢出运算符，有 &amp;+、&amp;- 和 &amp;*</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">var</span> i1 <span class="token operator">=</span> <span class="token class-name">Int</span><span class="token punctuation">.</span>max
<span class="token function">print</span><span class="token punctuation">(</span>i1<span class="token punctuation">)</span> <span class="token comment">// 9223372036854775807</span>
i1 <span class="token operator">=</span> i1 <span class="token operator">&amp;+</span> <span class="token number">1</span>
<span class="token function">print</span><span class="token punctuation">(</span>i1<span class="token punctuation">)</span> <span class="token comment">// -9223372036854775808</span>
i1 <span class="token operator">=</span> i1 <span class="token operator">&amp;+</span> <span class="token number">10</span>
<span class="token function">print</span><span class="token punctuation">(</span>i1<span class="token punctuation">)</span> <span class="token comment">// -9223372036854775798</span>

<span class="token keyword">var</span> i2 <span class="token operator">=</span> <span class="token class-name">UInt</span><span class="token punctuation">.</span>max
i2 <span class="token operator">=</span> i2 <span class="token operator">&amp;+</span> <span class="token number">1</span>
<span class="token function">print</span><span class="token punctuation">(</span>i2<span class="token punctuation">)</span> <span class="token comment">// 0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>运算符函数包括前缀运算符、后缀运算符、复合赋值运算符以及等价运算符。另，还可以自定义运算符，新的运算符要用 operator 关键字进行定义，同时要指定 prefix、infix 或者 postfix 修饰符。</p>
<h3 id="基础库-1"><a href="#基础库-1" class="headerlink" title="基础库"></a>基础库</h3><h4 id="时间-1"><a href="#时间-1" class="headerlink" title="时间"></a>时间</h4><p>Date 的基本用法如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> now <span class="token operator">=</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// Date 转 时间戳</span>
<span class="token keyword">let</span> interval <span class="token operator">=</span> now<span class="token punctuation">.</span>timeIntervalSince1970 <span class="token comment">// 时间戳</span>
<span class="token keyword">let</span> df <span class="token operator">=</span> <span class="token class-name">DateFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>dateFormat <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"yyyy 年 MM 月 dd 日 HH:mm:ss"</span></span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"时间戳：</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation"><span class="token class-name">Int</span><span class="token punctuation">(</span>interval<span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span> <span class="token comment">// 时间戳：1642399901</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"格式化的时间："</span></span> <span class="token operator">+</span> df<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> now<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 格式化的时间：2022 年 01 月 17 日 14:11:41</span>
df<span class="token punctuation">.</span>dateStyle <span class="token operator">=</span> <span class="token punctuation">.</span>short
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"short 样式时间："</span></span> <span class="token operator">+</span> df<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> now<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// short 样式时间：2022/1/17</span>
df<span class="token punctuation">.</span>locale <span class="token operator">=</span> <span class="token class-name">Locale</span><span class="token punctuation">(</span>identifier<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"zh_Hans_CN"</span></span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>dateStyle <span class="token operator">=</span> <span class="token punctuation">.</span>full
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"full 样式时间："</span></span> <span class="token operator">+</span> df<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> now<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// full 样式时间：2022年1月17日 星期一</span>

<span class="token comment">// 时间戳转 Date</span>
<span class="token keyword">let</span> date <span class="token operator">=</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>timeIntervalSince1970<span class="token punctuation">:</span> interval<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span> <span class="token comment">// 2022-01-17 06:11:41 +0000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>复杂的时间操作，比如说 GitHub 接口使用的是 ISO 标准，RSS 输出的是 RSS 标准字符串，不同标准对应不同时区的时间计算处理，可以使用开源库  <a target="_blank" rel="noopener" href="https://github.com/malcommac/SwiftDate">SwiftDate</a>  来完成。示例代码如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">SwiftDate</span>

<span class="token comment">// 使用 SwiftDate 库</span>
<span class="token keyword">let</span> cn <span class="token operator">=</span> <span class="token class-name">Region</span><span class="token punctuation">(</span>zone<span class="token punctuation">:</span> <span class="token class-name">Zones</span><span class="token punctuation">.</span>asiaShanghai<span class="token punctuation">,</span> locale<span class="token punctuation">:</span> <span class="token class-name">Locales</span><span class="token punctuation">.</span>chineseChina<span class="token punctuation">)</span>
<span class="token class-name">SwiftDate</span><span class="token punctuation">.</span>defaultRegion <span class="token operator">=</span> cn
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"2008-02-14 23:12:14"</span></span><span class="token punctuation">.</span><span class="token function">toDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span>year <span class="token operator">??</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span> <span class="token comment">// 2008</span>

<span class="token keyword">let</span> d1 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"2022-01-17T23:20:35"</span></span><span class="token punctuation">.</span><span class="token function">toISODate</span><span class="token punctuation">(</span>region<span class="token punctuation">:</span> cn<span class="token punctuation">)</span>
<span class="token keyword">guard</span> <span class="token keyword">let</span> d1 <span class="token operator">=</span> d1 <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span>
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span>d1<span class="token punctuation">.</span>minute<span class="token punctuation">)</span> <span class="token comment">// 20</span>
<span class="token keyword">let</span> d2 <span class="token operator">=</span> d1 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">.</span>minutes
<span class="token function">print</span><span class="token punctuation">(</span>d2<span class="token punctuation">.</span>minute<span class="token punctuation">)</span>

<span class="token comment">// 两个 DateInRegion 相差时间 interval</span>
<span class="token keyword">let</span> i1 <span class="token operator">=</span> <span class="token class-name">DateInRegion</span><span class="token punctuation">(</span><span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> region<span class="token punctuation">:</span> cn<span class="token punctuation">)</span> <span class="token operator">-</span> d1
<span class="token keyword">let</span> s1 <span class="token operator">=</span> i1<span class="token punctuation">.</span>toString <span class="token punctuation">&#123;</span>
    <span class="token short-argument">$0</span><span class="token punctuation">.</span>maximumUnitCount <span class="token operator">=</span> <span class="token number">4</span>
    <span class="token short-argument">$0</span><span class="token punctuation">.</span>allowedUnits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">.</span>day<span class="token punctuation">,</span> <span class="token punctuation">.</span>hour<span class="token punctuation">,</span> <span class="token punctuation">.</span>minute<span class="token punctuation">]</span>
    <span class="token short-argument">$0</span><span class="token punctuation">.</span>collapsesLargestUnit <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token short-argument">$0</span><span class="token punctuation">.</span>unitsStyle <span class="token operator">=</span> <span class="token punctuation">.</span>abbreviated
    <span class="token short-argument">$0</span><span class="token punctuation">.</span>locale <span class="token operator">=</span> <span class="token class-name">Locales</span><span class="token punctuation">.</span>chineseChina
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token comment">// 9小时45分钟</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="格式化-1"><a href="#格式化-1" class="headerlink" title="格式化"></a>格式化</h4><p>使用标准库的格式来描述不同场景的情况可以不用去考虑由于不同地区的区别，这些在标准库里就可以自动完成了。</p>
<p>描述两个时间之间相差多长时间</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 计算两个时间之间相差多少时间，支持多种语言字符串</span>
<span class="token keyword">let</span> d1 <span class="token operator">=</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>timeIntervalSince1970 <span class="token operator">-</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span>
<span class="token keyword">let</span> f1 <span class="token operator">=</span> <span class="token class-name">RelativeDateTimeFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
f1<span class="token punctuation">.</span>dateTimeStyle <span class="token operator">=</span> <span class="token punctuation">.</span>named
f1<span class="token punctuation">.</span>formattingContext <span class="token operator">=</span> <span class="token punctuation">.</span>beginningOfSentence
f1<span class="token punctuation">.</span>locale <span class="token operator">=</span> <span class="token class-name">Locale</span><span class="token punctuation">(</span>identifier<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"zh_Hans_CN"</span></span><span class="token punctuation">)</span>
<span class="token keyword">let</span> str <span class="token operator">=</span> f1<span class="token punctuation">.</span><span class="token function">localizedString</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>timeIntervalSince1970<span class="token punctuation">:</span> d1<span class="token punctuation">)</span><span class="token punctuation">,</span> relativeTo<span class="token punctuation">:</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token comment">// 昨天</span>

<span class="token comment">// 简写</span>
<span class="token keyword">let</span> str2 <span class="token operator">=</span> <span class="token class-name">Date</span><span class="token punctuation">.</span>now<span class="token punctuation">.</span><span class="token function">addingTimeInterval</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">formatted</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">relative</span><span class="token punctuation">(</span>presentation<span class="token punctuation">:</span> <span class="token punctuation">.</span>named<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>str2<span class="token punctuation">)</span> <span class="token comment">// yesterday</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>描述多个事物</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 描述多个事物</span>
<span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token class-name">ListFormatter</span><span class="token punctuation">.</span><span class="token function">localizedString</span><span class="token punctuation">(</span>byJoining<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"冬天"</span></span><span class="token punctuation">,</span><span class="token string-literal"><span class="token string">"春天"</span></span><span class="token punctuation">,</span><span class="token string-literal"><span class="token string">"夏天"</span></span><span class="token punctuation">,</span><span class="token string-literal"><span class="token string">"秋天"</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<p>描述名字</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 名字</span>
<span class="token keyword">let</span> f2 <span class="token operator">=</span> <span class="token class-name">PersonNameComponentsFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> nc1 <span class="token operator">=</span> <span class="token class-name">PersonNameComponents</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
nc1<span class="token punctuation">.</span>familyName <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"戴"</span></span>
nc1<span class="token punctuation">.</span>givenName <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"铭"</span></span>
nc1<span class="token punctuation">.</span>nickname <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"铭哥"</span></span>
<span class="token function">print</span><span class="token punctuation">(</span>f2<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> nc1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 戴铭</span>
f2<span class="token punctuation">.</span>style <span class="token operator">=</span> <span class="token punctuation">.</span>short
<span class="token function">print</span><span class="token punctuation">(</span>f2<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> nc1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 铭哥</span>
f2<span class="token punctuation">.</span>style <span class="token operator">=</span> <span class="token punctuation">.</span>abbreviated
<span class="token function">print</span><span class="token punctuation">(</span>f2<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> nc1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 戴</span>

<span class="token keyword">var</span> nc2 <span class="token operator">=</span> <span class="token class-name">PersonNameComponents</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
nc2<span class="token punctuation">.</span>familyName <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"Dai"</span></span>
nc2<span class="token punctuation">.</span>givenName <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"Ming"</span></span>
nc2<span class="token punctuation">.</span>nickname <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"Starming"</span></span>
f2<span class="token punctuation">.</span>style <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token keyword">default</span>
<span class="token function">print</span><span class="token punctuation">(</span>f2<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> nc2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Ming Dai</span>
f2<span class="token punctuation">.</span>style <span class="token operator">=</span> <span class="token punctuation">.</span>short
<span class="token function">print</span><span class="token punctuation">(</span>f2<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> nc2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Starming</span>
f2<span class="token punctuation">.</span>style <span class="token operator">=</span> <span class="token punctuation">.</span>abbreviated
<span class="token function">print</span><span class="token punctuation">(</span>f2<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> nc2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// MD</span>

<span class="token comment">// 取出名</span>
<span class="token keyword">let</span> componets <span class="token operator">=</span> f2<span class="token punctuation">.</span><span class="token function">personNameComponents</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"戴铭"</span></span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>componets<span class="token operator">?</span><span class="token punctuation">.</span>givenName <span class="token operator">??</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span> <span class="token comment">// 铭</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>描述数字</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 数字</span>
<span class="token keyword">let</span> f3 <span class="token operator">=</span> <span class="token class-name">NumberFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
f3<span class="token punctuation">.</span>locale <span class="token operator">=</span> <span class="token class-name">Locale</span><span class="token punctuation">(</span>identifier<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"zh_Hans_CN"</span></span><span class="token punctuation">)</span>
f3<span class="token punctuation">.</span>numberStyle <span class="token operator">=</span> <span class="token punctuation">.</span>currency
<span class="token function">print</span><span class="token punctuation">(</span>f3<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> <span class="token number">123456</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span> <span class="token comment">// ¥123,456.00</span>
f3<span class="token punctuation">.</span>numberStyle <span class="token operator">=</span> <span class="token punctuation">.</span>percent
<span class="token function">print</span><span class="token punctuation">(</span>f3<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> <span class="token number">123456</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span> <span class="token comment">// 12,345,600%</span>

<span class="token keyword">let</span> n1 <span class="token operator">=</span> <span class="token number">1.23456</span>
<span class="token keyword">let</span> n1Str <span class="token operator">=</span> n1<span class="token punctuation">.</span><span class="token function">formatted</span><span class="token punctuation">(</span><span class="token punctuation">.</span>number<span class="token punctuation">.</span><span class="token function">precision</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">fractionLength</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rounded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>n1Str<span class="token punctuation">)</span> <span class="token comment">// 1.235</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>描述地址</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 地址</span>
<span class="token keyword">import</span> <span class="token class-name">Contacts</span>

<span class="token keyword">let</span> f4 <span class="token operator">=</span> <span class="token class-name">CNPostalAddressFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> address <span class="token operator">=</span> <span class="token class-name">CNMutablePostalAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
address<span class="token punctuation">.</span>street <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"海淀区王庄路XX号院X号楼X门XXX"</span></span>
address<span class="token punctuation">.</span>postalCode <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"100083"</span></span>
address<span class="token punctuation">.</span>city <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"北京"</span></span>
address<span class="token punctuation">.</span>country <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"中国"</span></span>
<span class="token function">print</span><span class="token punctuation">(</span>f4<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> address<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">/// 海淀区王庄路XX号院X号楼X门XXX</span>
<span class="token comment">/// 北京 100083</span>
<span class="token comment">/// 中国</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="度量值-1"><a href="#度量值-1" class="headerlink" title="度量值"></a>度量值</h4><p>标准库里的物理量，在这个文档里有详细列出，包括角度、平方米等。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 参考：https://developer.apple.com/documentation/foundation/nsdimension</span>
<span class="token keyword">let</span> m1 <span class="token operator">=</span> <span class="token class-name">Measurement</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> unit<span class="token punctuation">:</span> <span class="token class-name">UnitLength</span><span class="token punctuation">.</span>kilometers<span class="token punctuation">)</span>
<span class="token keyword">let</span> m2 <span class="token operator">=</span> m1<span class="token punctuation">.</span><span class="token function">converted</span><span class="token punctuation">(</span>to<span class="token punctuation">:</span> <span class="token punctuation">.</span>meters<span class="token punctuation">)</span> <span class="token comment">// 千米转米</span>
<span class="token function">print</span><span class="token punctuation">(</span>m2<span class="token punctuation">)</span> <span class="token comment">// 1000.0 m</span>
<span class="token comment">// 度量值转为本地化的值</span>
<span class="token keyword">let</span> mf <span class="token operator">=</span> <span class="token class-name">MeasurementFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
mf<span class="token punctuation">.</span>locale <span class="token operator">=</span> <span class="token class-name">Locale</span><span class="token punctuation">(</span>identifier<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"zh_Hans_CN"</span></span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>mf<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> m1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 1公里</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>一些物理公式供参考：</p>
<pre class="line-numbers language-none"><code class="language-none">面积 &#x3D; 长度 × 长度
体积 &#x3D; 长度 × 长度 × 长度 &#x3D; 面积 × 长度

速度&#x3D;长度&#x2F;时间
加速度&#x3D;速度&#x2F;时间

力 &#x3D; 质量 × 加速度
扭矩 &#x3D; 力 × 长度
压力 &#x3D; 力 &#x2F; 面积

密度&#x3D;质量 &#x2F; 体积
能量 &#x3D; 功率 × 时间
电阻 &#x3D; 电压 &#x2F; 电流<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="Data-1"><a href="#Data-1" class="headerlink" title="Data"></a>Data</h4><p>数据压缩和解压</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 对数据的压缩</span>
<span class="token keyword">let</span> d1 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？看看能够压缩多少？"</span></span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>using<span class="token punctuation">:</span> <span class="token punctuation">.</span>utf8<span class="token punctuation">)</span><span class="token operator">!</span> <span class="token keyword">as</span> <span class="token class-name">NSData</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"ori </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">d1<span class="token punctuation">.</span>count</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> bytes"</span></span><span class="token punctuation">)</span>
<span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">/// 压缩算法</span>
    <span class="token comment">/// * lz4</span>
    <span class="token comment">/// * lzma</span>
    <span class="token comment">/// * zlib</span>
    <span class="token comment">/// * lzfse</span>
    <span class="token keyword">let</span> compressed <span class="token operator">=</span> <span class="token keyword">try</span> d1<span class="token punctuation">.</span><span class="token function">compressed</span><span class="token punctuation">(</span>using<span class="token punctuation">:</span> <span class="token punctuation">.</span>zlib<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"comp </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">compressed<span class="token punctuation">.</span>count</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> bytes"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment">// 对数据解压</span>
    <span class="token keyword">let</span> decomressed <span class="token operator">=</span> <span class="token keyword">try</span> compressed<span class="token punctuation">.</span><span class="token function">decompressed</span><span class="token punctuation">(</span>using<span class="token punctuation">:</span> <span class="token punctuation">.</span>zlib<span class="token punctuation">)</span>
    <span class="token keyword">let</span> deStr <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> decomressed <span class="token keyword">as</span> <span class="token class-name">Data</span><span class="token punctuation">,</span> encoding<span class="token punctuation">:</span> <span class="token punctuation">.</span>utf8<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span>deStr <span class="token operator">??</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token comment">/// ori 297 bytes</span>
<span class="token comment">/// comp 37 bytes</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="文件-1"><a href="#文件-1" class="headerlink" title="文件"></a>文件</h4><p>文件的一些基本操作的代码如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> path1 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"/Users/mingdai/Downloads/1.html"</span></span>
<span class="token keyword">let</span> path2 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"/Users/mingdai/Documents/GitHub/"</span></span>

<span class="token keyword">let</span> u1 <span class="token operator">=</span> <span class="token function">URL</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> path1<span class="token punctuation">)</span>
<span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 写入</span>
    <span class="token keyword">let</span> url1 <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token class-name">FileManager</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>itemReplacementDirectory<span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>userDomainMask<span class="token punctuation">,</span> appropriateFor<span class="token punctuation">:</span> u1<span class="token punctuation">,</span> create<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// 保证原子性安全保存</span>
    <span class="token function">print</span><span class="token punctuation">(</span>url1<span class="token punctuation">)</span>

    <span class="token comment">// 读取</span>
    <span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token class-name">String</span><span class="token punctuation">(</span>contentsOfFile<span class="token punctuation">:</span> path1<span class="token punctuation">,</span> encoding<span class="token punctuation">:</span> <span class="token punctuation">.</span>utf8<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span>

<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

<span class="token comment">// 检查路径是否可用</span>
<span class="token keyword">let</span> u2 <span class="token operator">=</span> <span class="token function">URL</span><span class="token punctuation">(</span>fileURLWithPath<span class="token punctuation">:</span>path2<span class="token punctuation">)</span>
<span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> values <span class="token operator">=</span> <span class="token keyword">try</span> u2<span class="token punctuation">.</span><span class="token function">resourceValues</span><span class="token punctuation">(</span>forKeys<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">.</span>volumeAvailableCapacityForImportantUsageKey<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">let</span> capacity <span class="token operator">=</span> values<span class="token punctuation">.</span>volumeAvailableCapacityForImportantUsage <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"可用: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">capacity</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"不可用"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"错误: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">error<span class="token punctuation">.</span>localizedDescription</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>怎么遍历多级目录结构中的文件呢？看下面的代码的实现：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 遍历路径下所有目录</span>
<span class="token keyword">let</span> u3 <span class="token operator">=</span> <span class="token function">URL</span><span class="token punctuation">(</span>fileURLWithPath<span class="token punctuation">:</span> <span class="token class-name">FileManager</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span>currentDirectoryPath<span class="token punctuation">)</span>
<span class="token keyword">let</span> fm <span class="token operator">=</span> <span class="token class-name">FileManager</span><span class="token punctuation">.</span><span class="token keyword">default</span>
fm<span class="token punctuation">.</span><span class="token function">enumerator</span><span class="token punctuation">(</span>atPath<span class="token punctuation">:</span> u3<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> path <span class="token keyword">in</span>
    <span class="token keyword">guard</span> <span class="token keyword">let</span> path <span class="token operator">=</span> path <span class="token keyword">as</span><span class="token operator">?</span> <span class="token class-name">String</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token function">URL</span><span class="token punctuation">(</span>fileURLWithPath<span class="token punctuation">:</span> path<span class="token punctuation">,</span> relativeTo<span class="token punctuation">:</span> u3<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span>lastPathComponent<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以使用 FileWrapper 来创建文件夹和文件。举个例子：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// FileWrapper 的使用</span>
<span class="token comment">// 创建文件</span>
<span class="token keyword">let</span> f1 <span class="token operator">=</span> <span class="token class-name">FileWrapper</span><span class="token punctuation">(</span>regularFileWithContents<span class="token punctuation">:</span> <span class="token class-name">Data</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"# 第 n 个文件\n ## 标题"</span></span><span class="token punctuation">.</span>utf8<span class="token punctuation">)</span><span class="token punctuation">)</span>
f1<span class="token punctuation">.</span>fileAttributes<span class="token punctuation">[</span><span class="token class-name">FileAttributeKey</span><span class="token punctuation">.</span>creationDate<span class="token punctuation">.</span>rawValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
f1<span class="token punctuation">.</span>fileAttributes<span class="token punctuation">[</span><span class="token class-name">FileAttributeKey</span><span class="token punctuation">.</span>modificationDate<span class="token punctuation">.</span>rawValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 创建文件夹</span>
<span class="token keyword">let</span> folder1 <span class="token operator">=</span> <span class="token class-name">FileWrapper</span><span class="token punctuation">(</span>directoryWithFileWrappers<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token string-literal"><span class="token string">"file1.md"</span></span><span class="token punctuation">:</span> f1
<span class="token punctuation">]</span><span class="token punctuation">)</span>
folder1<span class="token punctuation">.</span>fileAttributes<span class="token punctuation">[</span><span class="token class-name">FileAttributeKey</span><span class="token punctuation">.</span>creationDate<span class="token punctuation">.</span>rawValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
folder1<span class="token punctuation">.</span>fileAttributes<span class="token punctuation">[</span><span class="token class-name">FileAttributeKey</span><span class="token punctuation">.</span>modificationDate<span class="token punctuation">.</span>rawValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">try</span> folder1<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>
        to<span class="token punctuation">:</span> <span class="token function">URL</span><span class="token punctuation">(</span>fileURLWithPath<span class="token punctuation">:</span> <span class="token class-name">FileManager</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span>currentDirectoryPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendingPathComponent</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"NewFolder"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        options<span class="token punctuation">:</span> <span class="token punctuation">.</span>atomic<span class="token punctuation">,</span>
        originalContentsURL<span class="token punctuation">:</span> <span class="token nil constant">nil</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">FileManager</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span>currentDirectoryPath<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面代码写起来比较繁琐，对 FileWrapper 更好的封装可以参考这篇文章《 <a target="_blank" rel="noopener" href="https://heberti.com/posts/filewrapper/">A Type-Safe FileWrapper | Heberti Almeida</a> 》。</p>
<p>文件读写处理完整能力可以参看这个库  <a target="_blank" rel="noopener" href="https://github.com/JohnSundell/Files">GitHub - JohnSundell&#x2F;Files: A nicer way to handle files &amp; folders in Swift</a> </p>
<p>本地或者网络上，比如网盘和FTP的文件发生变化时，怎样知道能够观察到呢？</p>
<p>通过 HTTPHeader 里的 If-Modified-Since、Last-Modified、If-None-Match 和 Etag 等字段来判断文件的变化，本地则是使用 DispatchSource.makeFileSystemObjectSource 来进行的文件变化监听。可以参考  <a target="_blank" rel="noopener" href="https://github.com/krzysztofzablocki/KZFileWatchers">KZFileWatchers</a>  库的做法。</p>
<h4 id="Scanner-1"><a href="#Scanner-1" class="headerlink" title="Scanner"></a>Scanner</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"""
one1,
two2,
three3.
"""</span></span>
<span class="token keyword">let</span> sn1 <span class="token operator">=</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> s1<span class="token punctuation">)</span>
<span class="token keyword">while</span> <span class="token operator">!</span>sn1<span class="token punctuation">.</span>isAtEnd <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token keyword">let</span> r1 <span class="token operator">=</span> sn1<span class="token punctuation">.</span><span class="token function">scanUpToCharacters</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> <span class="token punctuation">.</span>newlines<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span>r1 <span class="token keyword">as</span> <span class="token class-name">String</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/// one1,</span>
<span class="token comment">/// two2,</span>
<span class="token comment">/// three3.</span>

<span class="token comment">// 找出数字</span>
<span class="token keyword">let</span> sn2 <span class="token operator">=</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> s1<span class="token punctuation">)</span>
sn2<span class="token punctuation">.</span>charactersToBeSkipped <span class="token operator">=</span> <span class="token class-name">CharacterSet</span><span class="token punctuation">.</span>decimalDigits<span class="token punctuation">.</span>inverted <span class="token comment">// 不是数字的就跳过</span>
<span class="token keyword">var</span> p<span class="token punctuation">:</span> <span class="token class-name">Int</span> <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">while</span> <span class="token operator">!</span>sn2<span class="token punctuation">.</span>isAtEnd <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> sn2<span class="token punctuation">.</span><span class="token function">scanInt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/// 1</span>
<span class="token comment">/// 2</span>
<span class="token comment">/// 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面的代码还不是那么 Swifty，可以通过用AnySequence和AnyIterator来包装下，将序列中的元素推迟到实际需要时再来处理，这样性能也会更好些。具体实现可以参看《 <a target="_blank" rel="noopener" href="https://www.swiftbysundell.com/articles/string-parsing-in-swift/">String parsing in Swift</a> 》这篇文章。</p>
<h4 id="AttributeString-1"><a href="#AttributeString-1" class="headerlink" title="AttributeString"></a>AttributeString</h4><p>效果如下：</p>
<p><img  srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://user-images.githubusercontent.com/251980/150132322-20c5c2d4-6452-4d06-9202-4b93cffd8133.png" class="lozad post-image"src="https://user-images.githubusercontent.com/251980/150132322-20c5c2d4-6452-4d06-9202-4b93cffd8133.png"></p>
<p>代码如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">var</span> aStrs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">AttributedString</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> aStr1 <span class="token operator">=</span> <span class="token class-name">AttributedString</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"""
标题
正文内容，具体查看链接。
这里摘出第一个重点，还要强调的内容。
"""</span></span><span class="token punctuation">)</span>
<span class="token comment">// 标题</span>
<span class="token keyword">let</span> title <span class="token operator">=</span> aStr1<span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span>of<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"标题"</span></span><span class="token punctuation">)</span>
<span class="token keyword">guard</span> <span class="token keyword">let</span> title <span class="token operator">=</span> title <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> aStrs
<span class="token punctuation">&#125;</span>

<span class="token keyword">var</span> c1 <span class="token operator">=</span> <span class="token class-name">AttributeContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 可复用容器</span>
c1<span class="token punctuation">.</span>inlinePresentationIntent <span class="token operator">=</span> <span class="token punctuation">.</span>stronglyEmphasized
c1<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token punctuation">.</span>largeTitle
aStr1<span class="token punctuation">[</span>title<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">setAttributes</span><span class="token punctuation">(</span>c1<span class="token punctuation">)</span>

<span class="token comment">// 链接</span>
<span class="token keyword">let</span> link <span class="token operator">=</span> aStr1<span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span>of<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"链接"</span></span><span class="token punctuation">)</span>
<span class="token keyword">guard</span> <span class="token keyword">let</span> link <span class="token operator">=</span> link <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> aStrs
<span class="token punctuation">&#125;</span>

<span class="token keyword">var</span> c2 <span class="token operator">=</span> <span class="token class-name">AttributeContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 链接</span>
c2<span class="token punctuation">.</span>strokeColor <span class="token operator">=</span> <span class="token punctuation">.</span>blue
c2<span class="token punctuation">.</span>link <span class="token operator">=</span> <span class="token function">URL</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"https://ming1016.github.io/"</span></span><span class="token punctuation">)</span>
aStr1<span class="token punctuation">[</span>link<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">setAttributes</span><span class="token punctuation">(</span>c2<span class="token punctuation">.</span><span class="token function">merging</span><span class="token punctuation">(</span>c1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 合并 AttributeContainer</span>

<span class="token comment">// Runs</span>
<span class="token keyword">let</span> i1 <span class="token operator">=</span> aStr1<span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span>of<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"重点"</span></span><span class="token punctuation">)</span>
<span class="token keyword">let</span> i2 <span class="token operator">=</span> aStr1<span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span>of<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"强调"</span></span><span class="token punctuation">)</span>
<span class="token keyword">guard</span> <span class="token keyword">let</span> i1 <span class="token operator">=</span> i1<span class="token punctuation">,</span> <span class="token keyword">let</span> i2 <span class="token operator">=</span> i2 <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> aStrs
<span class="token punctuation">&#125;</span>

<span class="token keyword">var</span> c3 <span class="token operator">=</span> <span class="token class-name">AttributeContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
c3<span class="token punctuation">.</span>foregroundColor <span class="token operator">=</span> <span class="token punctuation">.</span>yellow
c3<span class="token punctuation">.</span>inlinePresentationIntent <span class="token operator">=</span> <span class="token punctuation">.</span>stronglyEmphasized
aStr1<span class="token punctuation">[</span>i1<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">setAttributes</span><span class="token punctuation">(</span>c3<span class="token punctuation">)</span>
aStr1<span class="token punctuation">[</span>i2<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">setAttributes</span><span class="token punctuation">(</span>c3<span class="token punctuation">)</span>

<span class="token keyword">for</span> r <span class="token keyword">in</span> aStr1<span class="token punctuation">.</span>runs <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"-------------"</span></span><span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>attributes<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

aStrs<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>aStr1<span class="token punctuation">)</span>

<span class="token comment">// Markdown</span>
<span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> aStr2 <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token class-name">AttributedString</span><span class="token punctuation">(</span>markdown<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"""
    内容[链接](https://ming1016.github.io/)。需要**强调**的内容。
    """</span></span><span class="token punctuation">)</span>
    
    aStrs<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>aStr2<span class="token punctuation">)</span>
    
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>SwiftUI 的 Text 可以直接读取 AttributedString 来进行显示。</p>
<h4 id="随机-1"><a href="#随机-1" class="headerlink" title="随机"></a>随机</h4><p>用法：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> ri <span class="token operator">=</span> <span class="token class-name">Int</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token operator">..&lt;</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>ri<span class="token punctuation">)</span> <span class="token comment">// 0到10随机数</span>
<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
<span class="token function">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">randomElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 数组中随机取个数</span>
<span class="token function">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">shuffled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 随机打乱数组顺序</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="UserDefaults-1"><a href="#UserDefaults-1" class="headerlink" title="UserDefaults"></a>UserDefaults</h4><p>使用方法如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">enum</span> <span class="token class-name">UDKey</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">let</span> k1 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"token"</span></span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> ud <span class="token operator">=</span> <span class="token class-name">UserDefaults</span><span class="token punctuation">.</span>standard
ud<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"xxxxxx"</span></span><span class="token punctuation">,</span> forKey<span class="token punctuation">:</span> <span class="token class-name">UDKey</span><span class="token punctuation">.</span>k1<span class="token punctuation">)</span>
<span class="token keyword">let</span> tk <span class="token operator">=</span> ud<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>forKey<span class="token punctuation">:</span> <span class="token class-name">UDKey</span><span class="token punctuation">.</span>k1<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>tk <span class="token operator">??</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="模式-1"><a href="#模式-1" class="headerlink" title="模式"></a>模式</h3><h4 id="单例-1"><a href="#单例-1" class="headerlink" title="单例"></a>单例</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">S</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">let</span> shared <span class="token operator">=</span> <span class="token class-name">S</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 防止实例初始化</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="系统及设备-1"><a href="#系统及设备-1" class="headerlink" title="系统及设备"></a>系统及设备</h3><h4 id="系统判断-1"><a href="#系统判断-1" class="headerlink" title="系统判断"></a>系统判断</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token directive property"><span class="token directive-name">#if</span> os<span class="token punctuation">(</span>tvOS<span class="token punctuation">)</span></span>
     <span class="token comment">// do something in tvOS</span>
<span class="token directive property"><span class="token directive-name">#elseif</span> os<span class="token punctuation">(</span>iOS<span class="token punctuation">)</span></span>
     <span class="token comment">// do somthing in iOS</span>
<span class="token directive property"><span class="token directive-name">#elseif</span> os<span class="token punctuation">(</span>macOS<span class="token punctuation">)</span></span>
    <span class="token comment">// do somthing in macOS</span>
<span class="token directive property"><span class="token directive-name">#endif</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="版本兼容-1"><a href="#版本兼容-1" class="headerlink" title="版本兼容"></a>版本兼容</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 版本</span>
<span class="token attribute atrule">@available</span><span class="token punctuation">(</span>iOS <span class="token number">15</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">)</span>
<span class="token keyword">func</span> <span class="token function-definition function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

<span class="token punctuation">&#125;</span>

<span class="token comment">// 版本检查</span>
<span class="token keyword">if</span> <span class="token other-directive property">#available</span><span class="token punctuation">(</span>iOS <span class="token number">15</span><span class="token punctuation">,</span> macOS <span class="token number">12</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// nothing happen</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="canImport-判断库是否可使用-1"><a href="#canImport-判断库是否可使用-1" class="headerlink" title="canImport 判断库是否可使用"></a>canImport 判断库是否可使用</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token directive property"><span class="token directive-name">#if</span> canImport<span class="token punctuation">(</span>SpriteKit<span class="token punctuation">)</span></span>
   <span class="token comment">// iOS 等苹果系统执行</span>
<span class="token directive property"><span class="token directive-name">#else</span></span>
   <span class="token comment">// 非苹果系统</span>
<span class="token directive property"><span class="token directive-name">#endif</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="targetEnvironment-环境的判断-1"><a href="#targetEnvironment-环境的判断-1" class="headerlink" title="targetEnvironment 环境的判断"></a>targetEnvironment 环境的判断</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token directive property"><span class="token directive-name">#if</span> targetEnvironment<span class="token punctuation">(</span>simulator<span class="token punctuation">)</span></span>
   <span class="token comment">// 模拟器</span>
<span class="token directive property"><span class="token directive-name">#else</span></span>
   <span class="token comment">// 真机</span>
<span class="token directive property"><span class="token directive-name">#endif</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="自带属性包装-1"><a href="#自带属性包装-1" class="headerlink" title="自带属性包装"></a>自带属性包装</h3><h4 id="resultBuilder-1"><a href="#resultBuilder-1" class="headerlink" title="@resultBuilder"></a>@resultBuilder</h4><p>结果生成器（Result builders），通过传递序列创建新值，SwiftUI就是使用的结果生成器将多个视图生成一个视图</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token attribute atrule">@resultBuilder</span>
<span class="token keyword">struct</span> <span class="token constant">RBS</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 基本闭包支持</span>
    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">buildBlock</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> components<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token operator">...</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Int</span> <span class="token punctuation">&#123;</span>
        components<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> partialResult<span class="token punctuation">,</span> i <span class="token keyword">in</span>
            partialResult <span class="token operator">+</span> i
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// 支持条件判断</span>
    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">buildEither</span><span class="token punctuation">(</span>first component<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Int</span> <span class="token punctuation">&#123;</span>
        component
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">buildEither</span><span class="token punctuation">(</span>second component<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Int</span> <span class="token punctuation">&#123;</span>
        component
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// 支持循环</span>
    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">buildArray</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> components<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Int</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Int</span> <span class="token punctuation">&#123;</span>
        components<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> partialResult<span class="token punctuation">,</span> i <span class="token keyword">in</span>
            partialResult <span class="token operator">+</span> i
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token constant">RBS</span><span class="token punctuation">.</span><span class="token function">buildBlock</span><span class="token punctuation">(</span>
    <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token number">3</span>
<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">// 6</span>

<span class="token comment">// 应用到函数中</span>
<span class="token attribute atrule">@RBS</span> <span class="token keyword">func</span> <span class="token function-definition function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Int</span> <span class="token punctuation">&#123;</span>
    <span class="token number">1</span>
    <span class="token number">2</span>
    <span class="token number">3</span>
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 6</span>

<span class="token comment">// 设置了 buildEither 就可以在闭包中进行条件判断。</span>
<span class="token attribute atrule">@RBS</span> <span class="token keyword">func</span> <span class="token function-definition function">f2</span><span class="token punctuation">(</span>stopAtThree<span class="token punctuation">:</span> <span class="token class-name">Bool</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Int</span> <span class="token punctuation">&#123;</span>
    <span class="token number">1</span>
    <span class="token number">2</span>
    <span class="token number">3</span>
    <span class="token keyword">if</span> stopAtThree <span class="token operator">==</span> <span class="token boolean">true</span> <span class="token punctuation">&#123;</span>
        <span class="token number">0</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token number">4</span>
        <span class="token number">5</span>
        <span class="token number">6</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">f2</span><span class="token punctuation">(</span>stopAtThree<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 21</span>

<span class="token comment">// 设置了 buildArray 就可以在闭包内使用循环了</span>
<span class="token attribute atrule">@RBS</span> <span class="token keyword">func</span> <span class="token function-definition function">f3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Int</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">...</span><span class="token number">3</span> <span class="token punctuation">&#123;</span>
        i <span class="token operator">*</span> <span class="token number">2</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">f3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 12</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0348-buildpartialblock.md">SE-0348 buildPartialBlock for result builders</a>  简化了实现复杂 result buiders 所需的重载。</p>
<h4 id="dynamicMemberLookup-动态成员查询-1"><a href="#dynamicMemberLookup-动态成员查询-1" class="headerlink" title="@dynamicMemberLookup 动态成员查询"></a>@dynamicMemberLookup 动态成员查询</h4><p>@dynamicMemberLookup 指示访问属性时调用一个已实现的处理动态查找的下标方法 subscript(dynamicMemeber:)，通过指定属性字符串名返回值。使用方法如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token attribute atrule">@dynamicMemberLookup</span>
<span class="token keyword">struct</span> <span class="token class-name">D</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 找字符串</span>
    <span class="token keyword">subscript</span><span class="token punctuation">(</span>dynamicMember m<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"first"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"second"</span></span><span class="token punctuation">]</span>
        <span class="token keyword">return</span> p<span class="token punctuation">[</span>m<span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// 找整型</span>
    <span class="token keyword">subscript</span><span class="token punctuation">(</span>dynamicMember m<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Int</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">]</span>
        <span class="token keyword">return</span> p<span class="token punctuation">[</span>m<span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// 找闭包</span>
    <span class="token keyword">subscript</span><span class="token punctuation">(</span>dynamicMember m<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">(</span><span class="token omit keyword">_</span> s<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Void</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"show </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation"><span class="token short-argument">$0</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// 静态数组成员</span>
    <span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"This is a member"</span></span><span class="token punctuation">]</span>
    <span class="token comment">// 动态数组成员</span>
    <span class="token keyword">subscript</span><span class="token punctuation">(</span>dynamicMember m<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"This is a dynamic member"</span></span><span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> d <span class="token operator">=</span> <span class="token class-name">D</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> s1<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> d<span class="token punctuation">.</span>one
<span class="token function">print</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token comment">// first</span>
<span class="token keyword">let</span> i1<span class="token punctuation">:</span> <span class="token class-name">Int</span> <span class="token operator">=</span> d<span class="token punctuation">.</span>one
<span class="token function">print</span><span class="token punctuation">(</span>i1<span class="token punctuation">)</span> <span class="token comment">// 1</span>
d<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"something"</span></span><span class="token punctuation">)</span> <span class="token comment">// show something</span>
<span class="token function">print</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>p<span class="token punctuation">)</span> <span class="token comment">// ["This is a member"]</span>
<span class="token keyword">let</span> dynamicP<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> d<span class="token punctuation">.</span>dp
<span class="token function">print</span><span class="token punctuation">(</span>dynamicP<span class="token punctuation">)</span> <span class="token comment">// ["This is a dynamic member"]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>类使用 @dynamicMemberLookup，继承的类也会自动加上 @dynamicMemberLookup。协议上定义 @dynamicMemberLookup，通过扩展可以默认实现 subscript(dynamicMember:) 方法。</p>
<h4 id="dynamicCallable-动态可调用类型-1"><a href="#dynamicCallable-动态可调用类型-1" class="headerlink" title="@dynamicCallable 动态可调用类型"></a>@dynamicCallable 动态可调用类型</h4><p>@dynamicCallable 动态可调用类型。通过实现 dynamicallyCall 方法来定义变参的处理。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token attribute atrule">@dynamicCallable</span>
<span class="token keyword">struct</span> <span class="token class-name">D</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 带参数说明</span>
    <span class="token keyword">func</span> <span class="token function-definition function">dynamicallyCall</span><span class="token punctuation">(</span>withKeywordArguments args<span class="token punctuation">:</span> <span class="token class-name">KeyValuePairs</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Int</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Int</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> firstArg <span class="token operator">=</span> args<span class="token punctuation">.</span>first<span class="token operator">?</span><span class="token punctuation">.</span>value <span class="token operator">??</span> <span class="token number">0</span>
        <span class="token keyword">return</span> firstArg <span class="token operator">*</span> <span class="token number">2</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">// 无参数说明</span>
    <span class="token keyword">func</span> <span class="token function-definition function">dynamicallyCall</span><span class="token punctuation">(</span>withArguments args<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">var</span> firstArg <span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span>
        <span class="token keyword">if</span> args<span class="token punctuation">.</span>count <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">&#123;</span>
            firstArg <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">"show </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">firstArg</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> d <span class="token operator">=</span> <span class="token class-name">D</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token function">d</span><span class="token punctuation">(</span>numberIs<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token comment">// 4</span>
<span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token function">d</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"hi"</span></span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token comment">// show hi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="自带协议-1"><a href="#自带协议-1" class="headerlink" title="自带协议"></a>自带协议</h3><h4 id="Hashable-1"><a href="#Hashable-1" class="headerlink" title="Hashable"></a>Hashable</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">H</span><span class="token punctuation">:</span> <span class="token class-name">Hashable</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> p1<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">var</span> p2<span class="token punctuation">:</span> <span class="token class-name">Int</span>
    
    <span class="token comment">// 提供随机 seed</span>
    <span class="token keyword">func</span> <span class="token function-definition function">hash</span><span class="token punctuation">(</span>into hasher<span class="token punctuation">:</span> <span class="token keyword">inout</span> <span class="token class-name">Hasher</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        hasher<span class="token punctuation">.</span><span class="token function">combine</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> h1 <span class="token operator">=</span> <span class="token class-name">H</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> h2 <span class="token operator">=</span> <span class="token class-name">H</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> hs1 <span class="token operator">=</span> <span class="token class-name">Hasher</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
hs1<span class="token punctuation">.</span><span class="token function">combine</span><span class="token punctuation">(</span>h1<span class="token punctuation">)</span>
hs1<span class="token punctuation">.</span><span class="token function">combine</span><span class="token punctuation">(</span>h2<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>h1<span class="token punctuation">.</span>hashValue<span class="token punctuation">)</span> <span class="token comment">// 7417088153212460033 随机值</span>
<span class="token function">print</span><span class="token punctuation">(</span>h2<span class="token punctuation">.</span>hashValue<span class="token punctuation">)</span> <span class="token comment">// -6972912482785541972 随机值</span>
<span class="token function">print</span><span class="token punctuation">(</span>hs1<span class="token punctuation">.</span><span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 7955861102637572758 随机值</span>
<span class="token function">print</span><span class="token punctuation">(</span>h1<span class="token punctuation">.</span>hashValue<span class="token punctuation">)</span> <span class="token comment">// 7417088153212460033 和前面 h1 一样</span>

<span class="token keyword">let</span> h3 <span class="token operator">=</span> <span class="token class-name">H</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>h3<span class="token punctuation">.</span>hashValue<span class="token punctuation">)</span> <span class="token comment">// 7417088153212460033 和前面 h1 一样</span>
<span class="token keyword">var</span> hs2 <span class="token operator">=</span> <span class="token class-name">Hasher</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
hs2<span class="token punctuation">.</span><span class="token function">combine</span><span class="token punctuation">(</span>h3<span class="token punctuation">)</span>
hs2<span class="token punctuation">.</span><span class="token function">combine</span><span class="token punctuation">(</span>h2<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>hs2<span class="token punctuation">.</span><span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 7955861102637572758 和前面 hs1 一样</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>应用生命周期内，调用 combine() 添加相同属性哈希值相同，由于 Hasher 每次都会使用随机的 seed，因此不同应用生命周期，也就是下次启动的哈希值，就会和上次的哈希值不同。</p>
<h3 id="Codable-1"><a href="#Codable-1" class="headerlink" title="Codable"></a>Codable</h3><h4 id="JSON-没有-id-字段-1"><a href="#JSON-没有-id-字段-1" class="headerlink" title="JSON 没有 id 字段"></a>JSON 没有 id 字段</h4><p>如果SwiftUI要求数据Model都是遵循Identifiable协议的，而有的json没有id这个字段，可以使用扩展struct的方式解决：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">CommitModel</span><span class="token punctuation">:</span> <span class="token class-name">Decodable</span><span class="token punctuation">,</span> <span class="token class-name">Hashable</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> sha<span class="token punctuation">:</span> <span class="token class-name">String</span>
  <span class="token keyword">var</span> author<span class="token punctuation">:</span> <span class="token class-name">AuthorModel</span>
  <span class="token keyword">var</span> commit<span class="token punctuation">:</span> <span class="token class-name">CommitModel</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">extension</span> <span class="token class-name">CommitModel</span><span class="token punctuation">:</span> <span class="token class-name">Identifiable</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> id<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> sha
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="网络-1"><a href="#网络-1" class="headerlink" title="网络"></a>网络</h3><h4 id="网络状态检查-1"><a href="#网络状态检查-1" class="headerlink" title="网络状态检查"></a>网络状态检查</h4><p>通过 Network 库的 NWPathMonitor 来检查</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">Combine</span>
<span class="token keyword">import</span> <span class="token class-name">Network</span>

<span class="token comment">// 网络状态检查 network state check</span>
<span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Nsck</span><span class="token punctuation">:</span> <span class="token class-name">ObservableObject</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">let</span> shared <span class="token operator">=</span> <span class="token class-name">Nsck</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span><span class="token punctuation">(</span><span class="token keyword">set</span><span class="token punctuation">)</span> <span class="token keyword">lazy</span> <span class="token keyword">var</span> pb <span class="token operator">=</span> <span class="token function">mkpb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token attribute atrule">@Published</span> <span class="token keyword">private</span><span class="token punctuation">(</span><span class="token keyword">set</span><span class="token punctuation">)</span> <span class="token keyword">var</span> pt<span class="token punctuation">:</span> <span class="token class-name">NWPath</span>
    
    <span class="token keyword">private</span> <span class="token keyword">let</span> monitor<span class="token punctuation">:</span> <span class="token class-name">NWPathMonitor</span>
    <span class="token keyword">private</span> <span class="token keyword">lazy</span> <span class="token keyword">var</span> sj <span class="token operator">=</span> <span class="token class-name">CurrentValueSubject</span><span class="token operator">&lt;</span><span class="token class-name">NWPath</span><span class="token punctuation">,</span> <span class="token class-name">Never</span><span class="token operator">></span><span class="token punctuation">(</span>monitor<span class="token punctuation">.</span>currentPath<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">var</span> sb<span class="token punctuation">:</span> <span class="token class-name">AnyCancellable</span><span class="token operator">?</span>
    
    <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        monitor <span class="token operator">=</span> <span class="token class-name">NWPathMonitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        pt <span class="token operator">=</span> monitor<span class="token punctuation">.</span>currentPath
        monitor<span class="token punctuation">.</span>pathUpdateHandler <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">[</span><span class="token keyword">weak</span> <span class="token keyword">self</span><span class="token punctuation">]</span> path <span class="token keyword">in</span>
            <span class="token keyword">self</span><span class="token operator">?</span><span class="token punctuation">.</span>pt <span class="token operator">=</span> path
            <span class="token keyword">self</span><span class="token operator">?</span><span class="token punctuation">.</span>sj<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        monitor<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>queue<span class="token punctuation">:</span> <span class="token class-name">DispatchQueue</span><span class="token punctuation">.</span><span class="token function">global</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">deinit</span> <span class="token punctuation">&#123;</span>
        monitor<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        sj<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>completion<span class="token punctuation">:</span> <span class="token punctuation">.</span>finished<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">private</span> <span class="token keyword">func</span> <span class="token function-definition function">mkpb</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">AnyPublisher</span><span class="token operator">&lt;</span><span class="token class-name">NWPath</span><span class="token punctuation">,</span> <span class="token class-name">Never</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> sj<span class="token punctuation">.</span><span class="token function">eraseToAnyPublisher</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用方法</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">var</span> sb <span class="token operator">=</span> <span class="token class-name">Set</span><span class="token operator">&lt;</span><span class="token class-name">AnyCancellable</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> alertMsg <span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span>

<span class="token class-name">Nsck</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span>pb
    <span class="token punctuation">.</span>sink <span class="token punctuation">&#123;</span> <span class="token omit keyword">_</span> <span class="token keyword">in</span>
        <span class="token comment">//</span>
    <span class="token punctuation">&#125;</span> receiveValue<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span> path <span class="token keyword">in</span>
        alertMsg <span class="token operator">=</span> path<span class="token punctuation">.</span>debugDescription
        <span class="token keyword">switch</span> path<span class="token punctuation">.</span>status <span class="token punctuation">&#123;</span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span>satisfied<span class="token punctuation">:</span>
            alertMsg <span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span>unsatisfied<span class="token punctuation">:</span>
            alertMsg <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"😱"</span></span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span>requiresConnection<span class="token punctuation">:</span>
            alertMsg <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"🥱"</span></span>
        <span class="token attribute atrule">@unknown</span> <span class="token keyword">default</span><span class="token punctuation">:</span>
            alertMsg <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"🤔"</span></span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">if</span> path<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token punctuation">.</span>unsatisfied <span class="token punctuation">&#123;</span>
            <span class="token keyword">switch</span> path<span class="token punctuation">.</span>unsatisfiedReason <span class="token punctuation">&#123;</span>
            <span class="token keyword">case</span> <span class="token punctuation">.</span>notAvailable<span class="token punctuation">:</span>
                alertMsg <span class="token operator">+=</span> <span class="token string-literal"><span class="token string">"网络不可用"</span></span>
            <span class="token keyword">case</span> <span class="token punctuation">.</span>cellularDenied<span class="token punctuation">:</span>
                alertMsg <span class="token operator">+=</span> <span class="token string-literal"><span class="token string">"蜂窝网不可用"</span></span>
            <span class="token keyword">case</span> <span class="token punctuation">.</span>wifiDenied<span class="token punctuation">:</span>
                alertMsg <span class="token operator">+=</span> <span class="token string-literal"><span class="token string">"Wifi不可用"</span></span>
            <span class="token keyword">case</span> <span class="token punctuation">.</span>localNetworkDenied<span class="token punctuation">:</span>
                alertMsg <span class="token operator">+=</span> <span class="token string-literal"><span class="token string">"网线不可用"</span></span>
            <span class="token attribute atrule">@unknown</span> <span class="token keyword">default</span><span class="token punctuation">:</span>
                alertMsg <span class="token operator">+=</span> <span class="token string-literal"><span class="token string">"网络不可用"</span></span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span>sb<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="动画-1"><a href="#动画-1" class="headerlink" title="动画"></a>动画</h3><h4 id="布局动画-1"><a href="#布局动画-1" class="headerlink" title="布局动画"></a>布局动画</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">SwiftUI</span>

<span class="token keyword">struct</span> <span class="token class-name">AnimateLayout</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
 <span class="token attribute atrule">@State</span> <span class="token keyword">var</span> changeLayout<span class="token punctuation">:</span> <span class="token class-name">Bool</span> <span class="token operator">=</span> <span class="token boolean">true</span>
 <span class="token attribute atrule">@Namespace</span> <span class="token keyword">var</span> namespace

 <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
  <span class="token class-name">VStack</span><span class="token punctuation">(</span>spacing<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token keyword">if</span> changeLayout <span class="token punctuation">&#123;</span>
    <span class="token class-name">HStack</span> <span class="token punctuation">&#123;</span> items <span class="token punctuation">&#125;</span>
   <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">VStack</span> <span class="token punctuation">&#123;</span> items <span class="token punctuation">&#125;</span>
   <span class="token punctuation">&#125;</span>
   <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"切换布局"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    withAnimation <span class="token punctuation">&#123;</span> changeLayout<span class="token punctuation">.</span><span class="token function">toggle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span>
   <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span>

 <span class="token attribute atrule">@ViewBuilder</span> <span class="token keyword">var</span> items<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
  <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">matchedGeometryEffect</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token punctuation">:</span> namespace<span class="token punctuation">)</span>
  <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Two"</span></span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">matchedGeometryEffect</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Two"</span></span><span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token punctuation">:</span> namespace<span class="token punctuation">)</span>
  <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Three"</span></span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">matchedGeometryEffect</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Three"</span></span><span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token punctuation">:</span> namespace<span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="安全-1"><a href="#安全-1" class="headerlink" title="安全"></a>安全</h3><h4 id="Keychain-1"><a href="#Keychain-1" class="headerlink" title="Keychain"></a>Keychain</h4><p>使用方法：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> d1 <span class="token operator">=</span> <span class="token class-name">Data</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"keyChain github token"</span></span><span class="token punctuation">.</span>utf8<span class="token punctuation">)</span>
<span class="token keyword">let</span> service <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"access-token"</span></span>
<span class="token keyword">let</span> account <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"github"</span></span>
<span class="token keyword">let</span> q1 <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token constant">kSecValueData</span><span class="token punctuation">:</span> d1<span class="token punctuation">,</span>
    <span class="token constant">kSecClass</span><span class="token punctuation">:</span> <span class="token constant">kSecClassGenericPassword</span><span class="token punctuation">,</span>
    <span class="token constant">kSecAttrService</span><span class="token punctuation">:</span> service<span class="token punctuation">,</span>
    <span class="token constant">kSecAttrAccount</span><span class="token punctuation">:</span> account
<span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token class-name">CFDictionary</span>

<span class="token comment">// 添加一个 keychain</span>
<span class="token keyword">let</span> status <span class="token operator">=</span> <span class="token class-name">SecItemAdd</span><span class="token punctuation">(</span>q1<span class="token punctuation">,</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span>

<span class="token comment">// 如果已经添加过会抛出 -25299 错误代码，需要调用 SecItemUpdate 来进行更新</span>
<span class="token keyword">if</span> status <span class="token operator">==</span> errSecDuplicateItem <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> q2 <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token constant">kSecClass</span><span class="token punctuation">:</span> <span class="token constant">kSecClassGenericPassword</span><span class="token punctuation">,</span>
        <span class="token constant">kSecAttrService</span><span class="token punctuation">:</span> service<span class="token punctuation">,</span>
        <span class="token constant">kSecAttrAccount</span><span class="token punctuation">:</span> account
    <span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token class-name">CFDictionary</span>
    <span class="token keyword">let</span> q3 <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token constant">kSecValueData</span><span class="token punctuation">:</span> d1
    <span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token class-name">CFDictionary</span>
    <span class="token class-name">SecItemUpdate</span><span class="token punctuation">(</span>q2<span class="token punctuation">,</span> q3<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 读取</span>
<span class="token keyword">let</span> q4 <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token constant">kSecAttrService</span><span class="token punctuation">:</span> service<span class="token punctuation">,</span>
    <span class="token constant">kSecAttrAccount</span><span class="token punctuation">:</span> account<span class="token punctuation">,</span>
    <span class="token constant">kSecClass</span><span class="token punctuation">:</span> <span class="token constant">kSecClassGenericPassword</span><span class="token punctuation">,</span>
    <span class="token constant">kSecReturnData</span><span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token class-name">CFDictionary</span>

<span class="token keyword">var</span> re<span class="token punctuation">:</span> <span class="token class-name">AnyObject</span><span class="token operator">?</span>
<span class="token class-name">SecItemCopyMatching</span><span class="token punctuation">(</span>q4<span class="token punctuation">,</span> <span class="token operator">&amp;</span>re<span class="token punctuation">)</span>
<span class="token keyword">guard</span> <span class="token keyword">let</span> reData <span class="token operator">=</span> re <span class="token keyword">as</span><span class="token operator">?</span> <span class="token class-name">Data</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">(</span>decoding<span class="token punctuation">:</span> reData<span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token punctuation">:</span> UTF8<span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// keyChain github token</span>

<span class="token comment">// 删除</span>
<span class="token keyword">let</span> q5 <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token constant">kSecAttrService</span><span class="token punctuation">:</span> service<span class="token punctuation">,</span>
    <span class="token constant">kSecAttrAccount</span><span class="token punctuation">:</span> account<span class="token punctuation">,</span>
    <span class="token constant">kSecClass</span><span class="token punctuation">:</span> <span class="token constant">kSecClassGenericPassword</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token class-name">CFDictionary</span>

<span class="token class-name">SecItemDelete</span><span class="token punctuation">(</span>q5<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="工程-1"><a href="#工程-1" class="headerlink" title="工程"></a>工程</h3><h4 id="程序入口点-1"><a href="#程序入口点-1" class="headerlink" title="程序入口点"></a>程序入口点</h4><p>Swift 允许全局编写 Swift 代码，实际上 clang 会自动将代码包进一个模拟 C 的函数中。Swift 也能够指定入口点，比如 @UIApplicationMain 或 @NSApplicationMain，UIKit 启动后生命周期管理是 AppDelegate 和 SceneDelegate，《 <a target="_blank" rel="noopener" href="https://www.donnywals.com/understanding-the-ios-13-scene-delegate/">Understanding the iOS 13 Scene Delegate</a> 》这篇有详细介绍。</p>
<p>@UIApplicationMain 和 @NSApplicationMain 会自动生成入口点。这些入口点都是平台相关的，Swift 发展来看是多平台的，这样在 Swift 5.3 时引入了 @main，可以方便的指定入口点。代码如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token attribute atrule">@main</span> <span class="token comment">// 要定义个静态的 main 函数</span>
<span class="token keyword">struct</span> <span class="token class-name">M</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"let's begin"</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> <a target="_blank" rel="noopener" href="https://github.com/apple/swift-argument-parser">ArgumentParser</a>  库，Swift 官方开源的一个开发命令行工具的库，也支持 @main。使用方法如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">ArgumentParser</span>

<span class="token attribute atrule">@main</span>
<span class="token keyword">struct</span> <span class="token class-name">C</span><span class="token punctuation">:</span> <span class="token class-name">ParsableCommand</span> <span class="token punctuation">&#123;</span>
  <span class="token attribute atrule">@Argument</span><span class="token punctuation">(</span>help<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Start"</span></span><span class="token punctuation">)</span>
  <span class="token keyword">var</span> phrase<span class="token punctuation">:</span> <span class="token class-name">String</span>
   
  <span class="token keyword">func</span> <span class="token function-definition function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span> <span class="token omit keyword">_</span> <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">...</span><span class="token number">5</span> <span class="token punctuation">&#123;</span>
      <span class="token function">print</span><span class="token punctuation">(</span>phrase<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h3><h4 id="Swift-DocC"><a href="#Swift-DocC" class="headerlink" title="Swift-DocC"></a>Swift-DocC</h4><p>现在支持 Swift、OC 和 C，文档标记一样。<code>.doccarchive</code> 包含可部署的网站内容，兼容大多数托管服务，比如 Github pages。部署到在线服务上可参考 <a target="_blank" rel="noopener" href="https://apple.github.io/swift-docc-plugin/documentation/swiftdoccplugin/generating-documentation-for-hosting-online/">Generating Documentation for Hosting Online</a> 和 <a target="_blank" rel="noopener" href="https://apple.github.io/swift-docc-plugin/documentation/swiftdoccplugin/publishing-to-github-pages/">Publishing to GitHub Pages</a> 文档。</p>
<p>和 SPM 集成参看 <a target="_blank" rel="noopener" href="https://apple.github.io/swift-docc-plugin/documentation/swiftdoccplugin/">SwiftDocCPlugin</a> 。</p>
<p>session 有 <a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2022-110368">What’s new in Swift -DocC</a> 和 <a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2022-110369">Improve the discoverability of your Swift-DocC content</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0356-swift-snippets.md">SE-0356 Swift Snippets</a>  代码片段用于示例文档的提案。</p>
<h2 id="专题-1"><a href="#专题-1" class="headerlink" title="专题"></a>专题</h2><h3 id="Swift-那些事-1"><a href="#Swift-那些事-1" class="headerlink" title="Swift 那些事"></a>Swift 那些事</h3><h4 id="Swift-各版本演进"><a href="#Swift-各版本演进" class="headerlink" title="Swift 各版本演进"></a>Swift 各版本演进</h4><h5 id="Swift-1-1"><a href="#Swift-1-1" class="headerlink" title="Swift 1.1"></a>Swift 1.1</h5><ul>
<li>countElements() 改成了 count()。</li>
<li>@NSApplicationMain 可以在 macOS 上使用。</li>
</ul>
<h5 id="Swift-1-2"><a href="#Swift-1-2" class="headerlink" title="Swift 1.2"></a>Swift 1.2</h5><ul>
<li>引入 Set 类型。</li>
<li>if let 可以放到一起，使用逗号分隔。</li>
<li>新增 zip() 和 flatMap()。</li>
<li>类增加静态方法和静态属性，使用 static 关键字描述。</li>
<li>as! 用于类型强转，失败会崩溃。</li>
<li>@noescape 用于描述作为参数闭包，用来告诉 Swift 闭包将在函数返回前使用。</li>
<li>常量可以延后初始化。</li>
</ul>
<h5 id="Swift-2-0"><a href="#Swift-2-0" class="headerlink" title="Swift 2.0"></a>Swift 2.0</h5><ul>
<li>增加 guard 关键字，用于解可选项值。</li>
<li>defer 关键字用来延迟执行，即使抛出错误了都会在最后执行。</li>
<li>ErrorType 协议，以及 throws、do、try 和 catch 的引入用来处理错误。</li>
<li>characters 加上 count，用来替代 count()。</li>
<li>#available 用来检查系统版本。</li>
</ul>
<h5 id="Swift-2-1"><a href="#Swift-2-1" class="headerlink" title="Swift 2.1"></a>Swift 2.1</h5><ul>
<li>字符串插值可以包含字符串字面符号。</li>
</ul>
<p><em>Swift 2.2</em></p>
<p>官方博客介绍：<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-2.2-released/">Swift 2.2 Released!</a>、<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-2.2-new-features/">New Features in Swift 2.2</a>、<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-2.2-release-process/">Swift 2.2 Release Process</a></p>
<ul>
<li><strong>FILE</strong>, <strong>LINE</strong> 和 <strong>FUNCTION</strong> 换成 #file，#line 和 #function。</li>
<li>废弃 ++ 和 – 操作符。</li>
<li>C 语言风格 for 循环废弃。</li>
<li>废弃变量参数，因为变量参数容易和 inout 搞混。</li>
<li>废弃字符串化的选择器，选择器不再能写成字符串了。</li>
<li>元组可直接比较是否相等。</li>
</ul>
<h5 id="Swift-3-0"><a href="#Swift-3-0" class="headerlink" title="Swift 3.0"></a>Swift 3.0</h5><p>官方博客介绍：<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-3.0-released/">Swift 3.0 Released!</a>、<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-3.0-preview-1-released/">Swift 3.0 Preview 1 Released!</a>、<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-3.0-release-process/">Swift 3.0 Release Process</a></p>
<ul>
<li>规范动词和名词来命名。</li>
<li>去掉 NS 前缀。</li>
<li>方法名描述参数部分变为参数名。</li>
<li>省略没必要的单词，命名做了简化呢。比如 stringByTrimmingCharactersInSet 就换成了 trimmingCharacters。</li>
<li>枚举的属性使用小写开头。</li>
<li>引入 C 函数的属性。</li>
</ul>
<h5 id="Swift-3-1"><a href="#Swift-3-1" class="headerlink" title="Swift 3.1"></a>Swift 3.1</h5><p>官方博客介绍：<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-3.1-released/">Swift 3.1 Released!</a>、<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-3.1-release-process/">Swift 3.1 Release Process</a></p>
<ul>
<li>序列新增 prefix(while:) 和 drop(while:) 方法，顺序遍历执行闭包里的逻辑判断，满足条件就返回，遇到不匹配就会停止遍历。prefix 返回满足条件的元素集合，drop 返回停止遍历之后那些元素集合。</li>
<li>泛型适用于嵌套类型。</li>
<li>类型的扩展可以使用约束条件，比如扩展数组时，加上元素为整数的约束，这样的扩展就只会对元素为整数的数组有效。</li>
</ul>
<h5 id="Swift-4-0"><a href="#Swift-4-0" class="headerlink" title="Swift 4.0"></a>Swift 4.0</h5><p>官方博客介绍：<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-4.0-released/">Swift 4.0 Released!</a>、<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-4.0-release-process/">Swift 4 Release Process</a></p>
<ul>
<li>加入 Codable 协议，更 Swifty 的编码和解码。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0167-swift-encoders.md">SE-0167 Swift Encoders</a></li>
<li>字符串加入三个双引号的支持，让多行字符串编写更加直观。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0168-multi-line-string-literals.md">SE-0168 Multi-Line String Literals</a></li>
<li>字符串变成集合，表示可以对字符串进行逐字遍历、map 和反转等操作。</li>
<li>keypaths 语法提升。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0161-key-paths.md">SE-0161 Smart KeyPaths: Better Key-Value Coding for Swift</a></li>
<li>集合加入 <code>..&lt;10</code> 这样语法的单边切片。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0172-one-sided-ranges.md">SE-0172 One-sided Ranges</a></li>
<li>字典新增 mapValues，可 map 字典的值。通过 grouping 可对字典进行分组生成新字典，键和值都可以。从字典中取值，如果键对应无值，则使用通过 default 指定的默认值。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0165-dict.md">SE-0165 Dictionary &amp; Set Enhancements</a></li>
</ul>
<h5 id="Swift-4-1"><a href="#Swift-4-1" class="headerlink" title="Swift 4.1"></a>Swift 4.1</h5><p>官方博客介绍：<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-4.1-released/">Swift 4.1 Released!</a>、<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-4.1-release-process/">Swift 4.1 Release Process</a></p>
<ul>
<li>Hashable 也不需要返回一个唯一的 hashValue 哈希值属性。</li>
<li>Equatable 和 Hashable 自动合成的提案参见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0185-synthesize-equatable-hashable.md">SE-0185 Synthesizing Equatable and Hashable conformance</a>。</li>
<li>两个自定类型比较是否相等时，不再需要比较每个属性，Swift 会自动生成 &#x3D;&#x3D; 方法，你只需要声明 Equatable 协议。</li>
<li>引入 KeyDecodingStrategy属性，其中 .convertFromSnakeCase 可以将下划线的命名转化成驼峰的命名。</li>
<li>引入条件符合性，只有满足一定条件才符合协议。比如扩展数组要求当里面元素满足某协议数组才符合这个协议。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0143-conditional-conformances.md">SE-0143 Conditional conformances</a>。</li>
<li>引入 canImport 宏条件关键字，判断是否可以使用某库，以前只能通过判断操作系统平台来判断。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0075-import-test.md">SE-0075 Adding a Build Configuration Import Test</a>。</li>
<li>新增能够去除为零项目的 compactMap()。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0187-introduce-filtermap.md">SE-0187 Introduce Sequence.compactMap(_:)</a></li>
<li>关联类型可以创建递归约束，提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0157-recursive-protocol-constraints.md">SE-0157 Support recursive constraints on associated types</a></li>
<li>targetEnvironment 环境的判断，比如模拟器。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0190-target-environment-platform-condition.md">SE-0190 Target environment platform condition</a> 。</li>
</ul>
<h5 id="Swift-4-2"><a href="#Swift-4-2" class="headerlink" title="Swift 4.2"></a>Swift 4.2</h5><p>官方博客介绍：<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-4.2-released/">Swift 4.2 Released!</a>、<a target="_blank" rel="noopener" href="https://swift.org/blog/4.2-release-process/">Swift 4.2 Release Process</a></p>
<ul>
<li>新增动态成员查询，@dynamicMemberLookup 新属性，指示访问属性时调用一个已实现的处理动态查找的下标方法 subscript(dynamicMemeber:)，通过指定属性字符串名返回值。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0195-dynamic-member-lookup.md">SE-0195 Introduce User-defined “Dynamic Member Lookup” Types</a></li>
<li>集合新加 removeAll(where:) 方法，过滤满足条件所有元素。比 filter 更高效。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0197-remove-where.md">SE-0197 Adding in-place removeAll(where:) to the Standard Library</a></li>
<li>布尔值增加 toggle() 方法，用来切换布尔值。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0199-bool-toggle.md">SE-0199 Adding toggle to Bool</a></li>
<li>引入 CaseIterable 协议，可以将枚举中所有 case 生成 allCases 数组。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0194-derived-collection-of-enum-cases.md">SE-0194 Derived Collection of Enum Cases</a></li>
<li>引入 #warning 和 #error 两个新的编译器指令。#warning 会产生一个警告，#error 会直接让编译出错。比如必须要填写 token 才能编译的话可以在设置 token 的代码前加上 #error 和说明。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0196-diagnostic-directives.md">SE-0196 Compiler Diagnostic Directives</a></li>
<li>新增加密安全的随机 API。直接在数字类型上调用 random() 方法生成随机数。shuffle() 方法可以对数组进行乱序重排。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0202-random-unification.md">SE-0202 Random Unification</a></li>
<li>更简单更安全的哈希协议，引入新的 Hasher 结构，通过 combine() 方法为哈希值添加更多属性，调用 finalize() 方法生成最终哈希值。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0206-hashable-enhancements.md">SE-0206 Hashable Enhancements</a></li>
<li>集合增加 allSatisfy() 用来判断集合中的元素是否都满足了一个条件。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0207-containsOnly.md">SE-0207 Add an allSatisfy algorithm to Sequence</a></li>
</ul>
<h5 id="Swift-5-0"><a href="#Swift-5-0" class="headerlink" title="Swift 5.0"></a>Swift 5.0</h5><p>官方博客介绍：<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-5-released/">Swift 5 Released!</a>、<a target="_blank" rel="noopener" href="https://swift.org/blog/5.0-release-process/">Swift 5.0 Release Process</a></p>
<ul>
<li>@dynamicCallable 动态可调用类型。通过实现 dynamicallyCall 方法来定义变参的处理。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0216-dynamic-callable.md">SE-0216 Introduce user-defined dynamically “callable” types</a></li>
<li>新加 Result 类型用来处理错误。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0235-add-result.md">SE-0235 Add Result to the Standard Library</a></li>
<li>新增原始字符串能力，在字符串前加上一个或多个#符号。里面的双引号和转义符号将不再起作用了，如果想让转义符起作用，需要在转义符后面加上#符号。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0200-raw-string-escaping.md">SE-0200 Enhancing String Literals Delimiters to Support Raw Text</a></li>
<li>自定义字符串插值。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0228-fix-expressiblebystringinterpolation.md">SE-0228 Fix ExpressibleByStringInterpolation</a></li>
<li>枚举新增 @unknown 用来区分固定的枚举和可能改变的枚举的能力。用于防止未来新增枚举属性会进行提醒提示完善每个 case 的处理。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0192-non-exhaustive-enums.md">SE-0192 Handling Future Enum Cases</a></li>
<li>compactMapValues() 对字典值进行转换和解包。可以解可选类型，并去掉 nil 值。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0218-introduce-compact-map-values.md">SE-0218 Introduce compactMapValues to Dictionary</a></li>
<li>扁平化 try?。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0230-flatten-optional-try.md">SE-0230 Flatten nested optionals resulting from ‘try?’</a></li>
<li>isMultiple(of:) 方法检查一个数字是否是另一个数字的倍数。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0225-binaryinteger-iseven-isodd-ismultiple.md">SE-0225 Adding isMultiple to BinaryInteger</a></li>
</ul>
<h5 id="Swift-5-1"><a href="#Swift-5-1" class="headerlink" title="Swift 5.1"></a>Swift 5.1</h5><p>官方博客介绍：<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-5.1-released/">Swift 5.1 Released!</a>、<a target="_blank" rel="noopener" href="https://swift.org/blog/5.1-release-process/">Swift 5.1 Release Process</a></p>
<ul>
<li>有序集合的 diff，通过 difference(from:) 方法，可以返回要删除哪些和添加哪些项目能够让两个集合相等。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0240-ordered-collection-diffing.md">SE-0240 Ordered Collection Diffing</a></li>
<li>属性包装。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0258-property-wrappers.md">SE-0258 Property Wrappers</a></li>
<li>不透明返回类型。函数调用者决定返回什么类型是泛型，函数自身决定返回什么类型使用不透明返回类型。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0244-opaque-result-types.md">SE-0244 Opaque Result Types</a></li>
<li>初始化有默认值的属性可不设置。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0242-default-values-memberwise.md">SE-0242 Synthesize default values for the memberwise initializer</a></li>
<li>单行表达式函数隐式返回，返回一个单行表达式的函数可以不用 return 关键字。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0255-omit-return.md">SE-0255 Implicit returns from single-expression functions</a></li>
<li>在类、结构体和枚举里使用 Self，Self 可以指代包含的类型。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0068-universal-self.md">SE-0068 Expanding Swift Self to class members and value types</a></li>
<li>静态下标。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0254-static-subscripts.md">SE-0254 Static and class subscripts</a></li>
<li>枚举里有 none 的 case 编译器会提示换成 Optional.none。</li>
<li>引入未初始化数组。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0245-array-uninitialized-initializer.md">SE-0245 Add an Array Initializer with Access to Uninitialized Storage</a></li>
</ul>
<h5 id="Swift-5-2"><a href="#Swift-5-2" class="headerlink" title="Swift 5.2"></a>Swift 5.2</h5><p>官方博客介绍：<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-5.2-released/">Swift 5.2 Released!</a>、<a target="_blank" rel="noopener" href="https://swift.org/blog/5.2-release-process/">Swift 5.2 Release Process</a></p>
<ul>
<li>自定义类型中实现了 callAsFunction() 的话，该类型的值就可以直接调用。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0253-callable.md">SE-0253 Callable values of user-defined nominal types</a></li>
<li>键路径表达式作为函数。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0249-key-path-literal-function-expressions.md">SE-0249 Key Path Expressions as Functions</a></li>
</ul>
<h5 id="Swift-5-3"><a href="#Swift-5-3" class="headerlink" title="Swift 5.3"></a>Swift 5.3</h5><p>官方博客介绍：<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-5.3-released/">Swift 5.3 released!</a>、<a target="_blank" rel="noopener" href="https://swift.org/blog/5.3-release-process/">Swift 5.3 Release Process</a></p>
<ul>
<li>SPM 包管理资源，SPM 可以包含资源文件，比如多媒体或文本等。通过 Bundle.module 访问这些资源。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0271-package-manager-resources.md">SE-0271 Package Manager Resources</a></li>
<li>SPM 包里资源本地化。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0278-package-manager-localized-resources.md">SE-0278 Package Manager Localized Resources</a></li>
<li>SPM 可以整合二进制包依赖。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0272-swiftpm-binary-dependencies.md">SE-0272 Package Manager Binary Dependencies</a></li>
<li>SPM 可以设置特定平台的依赖。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0273-swiftpm-conditional-target-dependencies.md">SE-0273 Package Manager Conditional Target Dependencies</a></li>
<li>单个 catch 块中捕获多个 Error 的 case。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0276-multi-pattern-catch-clauses.md">SE-0276 Multi-Pattern Catch Clauses</a></li>
<li>支持多个尾部闭包。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0279-multiple-trailing-closures.md">SE-0279 Multiple Trailing Closures</a></li>
<li>符合 Comparable 协议的枚举可以进行比较。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0266-synthesized-comparable-for-enumerations.md">SE-0266 Synthesized Comparable conformance for enum types</a></li>
<li>很多地方可以不用加 self 来指代实例自己了。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0269-implicit-self-explicit-capture.md">SE-0269 Increase availability of implicit self in @escaping closures when reference cycles are unlikely to occur</a></li>
<li>@main 可以方便指定程序入口点。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0281-main-attribute.md">SE-0281 @main: Type-Based Program Entry Points</a></li>
<li>where 子句可以用到泛型和扩展函数中。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0267-where-on-contextually-generic.md">SE-0267 where clauses on contextually generic declarations</a></li>
<li>枚举的 case 也可以符合协议。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0280-enum-cases-as-protocol-witnesses.md">SE-0280 Enum cases as protocol witnesses</a></li>
<li>完善 didSet，性能提升。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0268-didset-semantics.md">SE-0268 Refine didSet Semantics</a></li>
<li>新增 Float16 类型，即半精度浮点类型。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0277-float16.md">SE-0277 Float16</a></li>
</ul>
<h5 id="Swift-5-4"><a href="#Swift-5-4" class="headerlink" title="Swift 5.4"></a>Swift 5.4</h5><p>官方博客介绍：<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-5.4-released/">Swift 5.4 Released!</a></p>
<ul>
<li>SPM 支持 @main。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0294-package-executable-targets.md">SE-0294 Declaring executable targets in Package Manifests</a></li>
<li>结果生成器（Result builders），通过传递序列创建新值，SwiftUI就是使用的结果生成器将多个视图生成一个视图。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0289-result-builders.md">SE-0289 Result builders</a></li>
<li>增强隐式成员语法，即使用了隐式的成员可以进行链式处理。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0287-implicit-member-chains.md">SE-0287 Extend implicit member syntax to cover chains of member references</a></li>
<li>函数开始有了使用多个变量参数的能力。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0284-multiple-variadic-parameters.md">SE-0284 Allow Multiple Variadic Parameters in Functions, Subscripts, and Initializers</a></li>
<li>嵌套函数可以重载，嵌套函数可以在声明函数之前调用他。</li>
<li>属性包装支持局部变量。</li>
</ul>
<h5 id="Swift-5-5"><a href="#Swift-5-5" class="headerlink" title="Swift 5.5"></a>Swift 5.5</h5><p>官方博客介绍：<a target="_blank" rel="noopener" href="https://swift.org/blog/swift-5.5-released/">Swift 5.5 Released!</a></p>
<ul>
<li>Async await，用同步写法来处理异步。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0296-async-await.md">SE-0296 Async&#x2F;await</a></li>
<li>Async sequences，异步序列上的循环能力。符合 AsyncSequence 协议的序列可以通过 for await 来进行异步循环。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0298-asyncsequence.md">SE-0298 Async&#x2F;Await: Sequences</a> </li>
<li>结构化的并发，使用 Task 和 TaskGroup 执行、取消和监听当前操作的方法。复杂的并发处理可以使用 withTaskGroup() 来创建一组 Task，addTask() 用来添加任务，cancelAll() 可以取消任务，addTask() 在取消任务后可以继续添加任务，如果使用了 addTaskUnlessCancelled() 方法就可以避免取消后会继续添加任务这种情况。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0304-structured-concurrency.md">SE-0304 Structured concurrency</a></li>
<li>只读属性支持 async 和 throws 关键字。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0310-effectful-readonly-properties.md">SE-0310 Effectful Read-only Properties</a></li>
<li>async let，可以创建 await 子任务。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0317-async-let.md">SE-0317 async let bindings</a></li>
<li>以前异步代码的适配。比如 DispatchQueue.main.async，外部库可以通过 withCheckedContinuation() 函数来对以前异步代码进行封装。 提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0300-continuation.md">SE-0300 Continuations for interfacing async tasks with synchronous code</a></li>
<li>Actor，可以确保内部只能被一个线程访问，避免存储属性和方法出现竞争条件。提案在这 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0306-actors.md">SE-0306 Actors</a></li>
<li>全局 actors，通过 actor 将全局状态隔离出来，避免数据竞争。比如主线程 @MainActor 这个属性包装可以将属性和方法标记为只能在主线程上访问。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0316-global-actors.md">SE-0316 Global actors</a></li>
<li>Sendable 协议和 @Sendable 属性包装，目的是支持安全的将数据从一个线程传给另一个线程。Swift 的核心数据类型比如字符、集合等已符合 Sendable 协议。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0302-concurrent-value-and-concurrent-closures.md">SE-0302 Sendable and @Sendable closures</a></li>
<li>局部变量可以使用 lazy。</li>
<li>属性包装可以用到函数和闭包参数上。提案<a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0293-extend-property-wrappers-to-function-and-closure-parameters.md">SE-0293 Extend Property Wrappers to Function and Closure Parameters</a></li>
<li>泛型支持静态成员查找。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0299-extend-generic-static-member-lookup.md">SE-0299 Extending Static Member Lookup in Generic Contexts</a></li>
<li>#if 用于后缀成员表达式。提案见 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0308-postfix-if-config-expressions.md">SE-0308 #if for postfix member expressions</a></li>
<li>CGFloat 和 Double 之间可以隐式转换。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0307-allow-interchangeable-use-of-double-cgfloat-types.md">SE-0307 Allow interchangeable use of CGFloat and Double types</a></li>
<li>Codable 支持关联值枚举。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0295-codable-synthesis-for-enums-with-associated-values.md">SE-0295 Codable synthesis for enums with associated values</a></li>
</ul>
<h5 id="Swift-5-6"><a href="#Swift-5-6" class="headerlink" title="Swift 5.6"></a>Swift 5.6</h5><p><a target="_blank" rel="noopener" href="https://www.swift.org/blog/swift-5.6-released/">5.6 官方博客介绍</a></p>
<ul>
<li>使用 any 注释此类类型，使存在类型的影响在语言中明确。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0335-existential-any.md">SE-0335 Introduce existential any</a></li>
<li>类型占位符。<a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0315-placeholder-types.md">SE-0315 Type placeholders (formerly, “Placeholder types”)</a></li>
<li>新增 CodingKeyRepresentable 协议将非字符串和整数类型自定义表现。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0320-codingkeyrepresentable.md">SE-0320 Allow coding of non String &#x2F; Int keyed Dictionary into a KeyedContainer</a></li>
<li>增加 Unavailability 用来在检查不可用时可以做些事情。<a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0290-negative-availability.md">SE-0290 Unavailability Condition</a></li>
<li>增加了 <code>@preconcurrency</code> 属性。提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0337-support-incremental-migration-to-concurrency-checking.md">SE-0337 Incremental migration to concurrency checking</a></li>
<li>actor 的 init 和 deinit。<a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0327-actor-initializers.md">SE-0327 On Actors and Initialization</a></li>
</ul>
<p>Package Manage 的一些提案</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0303-swiftpm-extensible-build-tools.md">SE-0303 Package Manager Extensible Build Tools</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0305-swiftpm-binary-target-improvements.md">SE-0305 Package Manager Binary Target Improvements</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0325-swiftpm-additional-plugin-apis.md">SE-0325 Additional Package Plugin APIs</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0332-swiftpm-command-plugins.md">SE-0332 Package Manager Command Plugins</a></li>
</ul>
<h5 id="Swift-5-7"><a href="#Swift-5-7" class="headerlink" title="Swift 5.7"></a>Swift 5.7</h5><ul>
<li>标准库多了个 <code>Regex&lt;Output&gt;</code> 类型，Regex 语法与 Perl、Python、Ruby、Java、NSRegularExpression 和许多其他语言兼容。可以用 <code>let regex = try! Regex(&quot;a[bc]+&quot;)</code> 或 <code>let regex = /a[bc]+/</code> 写法来使用。<a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0350-regex-type-overview.md">SE-0350 Regex Type and Overview</a> 引入 Regex 类型。<a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0351-regex-builder.md">SE-0351 Regex builder DSL</a> 使用 result builder 来构建正则表达式的 DSL。<a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0354-regex-literals.md">SE-0354 Regex Literals</a> 简化的正则表达式。<a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0357-regex-string-processing-algorithms.md">SE-0357 Regex-powered string processing algorithms</a> 提案里有基于正则表达式的新字符串处理算法。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0347-type-inference-from-default-exprs.md">SE-0347 Type inference from default expressions</a> 扩展 Swift 泛型参数类型的默认值能力。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0341-opaque-parameters.md">SE-0341 Opaque Parameter Declarations</a> 使用 some 参数简化泛型参数声明。<a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0328-structural-opaque-result-types.md">SE-0328 Structural opaque result types</a> 扩大不透明结果返回类型可以使用的范围。<a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0360-opaque-result-types-with-availability.md">SE-0360 Opaque result types with limited availability</a> 可用性有限的不透明结果类型，比如 <code>if #available(macOS 13.0, *) &#123;&#125;</code> 就可以根据系统不同版本返回不同类型，新版本出现新类型的 View 就可以和以前的 View 类型区别开。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0309-unlock-existential-types-for-all-protocols.md">SE-0309 Unlock existentials for all protocols</a> 改进了 existentials 和 泛型的交互。这样就可以更方便的检查 Any 类型的两个值是否相等.</li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0346-light-weight-same-type-syntax.md">SE-0346 Lightweight same-type requirements for primary associated types</a> 引入一种新语法，用于符合泛型参数并通过相同类型要求约束关联类型。<a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0358-primary-associated-types-in-stdlib.md">SE-0358 Primary Associated Types in the Standard Library</a> 引入主要关联类型概念，并将其带入了标准库。这些关联类型很像泛型，允许开发者将给定关联类型的类型指定为通用约束。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0353-constrained-existential-types.md">SE-0353 Constrained Existential Types</a> 基于 SE-0309 和 SE-0346 提案，在 existential 类型的上下文中重用轻量关联类型的约束。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0352-implicit-open-existentials.md">SE-0352 Implicitly Opened Existentials</a>  允许 Swift 在很多情况下使用协议调用泛型函数。</li>
<li>新增 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0338-clarify-execution-non-actor-async.md">SE-0338 Clarify the Execution of Non-Actor-Isolated Async Functions</a> 通过收紧可发送性检查的规则来避免潜在的数据竞争。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0343-top-level-concurrency.md">SE-0343 Concurrency in Top-level Code</a> 这个提案主要是更好地支持命令行工具的开发，可以直接将 concurrency 代码写到 main.swift 文件里。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0340-swift-noasync.md">SE-0340 Unavailable From Async Attribute</a> 提供 noasync 语法以允许我们将类型和函数标记为在异步上下文不可用。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0336-distributed-actor-isolation.md">SE-0336 Distributed Actor Isolation</a> 和 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0344-distributed-actor-runtime.md">SE-0344 Distributed Actor Runtime</a> 是两个 Distributed Actors 的相关提案。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0345-if-let-shorthand.md">SE-0345 if let shorthand for shadowing an existing optional variable</a> 引入的新语法，用于 unwrapping optinal。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0326-extending-multi-statement-closure-inference.md">SE-0326</a> 提高了 Swift 对闭包使用参数和类型推断的能力。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0348-buildpartialblock.md">SE-0348 buildPartialBlock for result builders</a>  简化了实现复杂 result buiders 所需的重载。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0356-swift-snippets.md">SE-0356 Swift Snippets</a>  代码片段用于示例文档的提案。</li>
<li>内存管理相关提案包括 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0349-unaligned-loads-and-stores.md">SE-0349 Unaligned Loads and Stores from Raw Memory</a> 、<a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0334-pointer-usability-improvements.md">SE-0334 Pointer API Usability Improvements</a> 、<a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0333-with-memory-rebound.md">SE-0333 Expand usability of withMemoryRebound</a> 。</li>
</ul>
<h3 id="规范"><a href="#规范" class="headerlink" title="规范"></a>规范</h3><h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><p>参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://google.github.io/swift/">Swift Style Guide</a></li>
</ul>
<p>多用静态特性。swift 在编译期间所做的优化比 OC 要多，这是由于他的静态派发、泛型特化、写时复制这些静态特性决定的。另外通过 final  和 private 这样的表示可将动态特性转化为静态方式，编译开启 WMO 可以自动推导出哪些动态派发可转化为静态派发。</p>
<p>如何避免崩溃？</p>
<ul>
<li>字典：用结构体替代</li>
<li>Any：可用泛型或关联关联类型替代</li>
<li>as? ：少用 AnyObject，多用泛型或不透明类型</li>
<li>!：要少用</li>
</ul>
<p>好的实践？</p>
<ul>
<li>少用继承，多用 protocol</li>
<li>多用 extension 对自己代码进行管理</li>
</ul>
<h3 id="资料推荐"><a href="#资料推荐" class="headerlink" title="资料推荐"></a>资料推荐</h3><h4 id="书单"><a href="#书单" class="headerlink" title="书单"></a>书单</h4><ul>
<li>《Thinking in SwiftUI》</li>
<li>《Swift 进阶》</li>
<li>《函数式Swift》</li>
<li>《深入解析Mac OS X &amp; iOS操作系统》</li>
<li>《LLVM Techniques, Tips, and Best Practices Clang and Middle-End Libraries》</li>
<li>《Learn LLVM 12》</li>
<li>《Crafting Interpreters》</li>
<li>《TCP&#x2F;IP Illustrated》</li>
<li>《松本行弘的程序世界》</li>
<li>《现代操作系统》</li>
<li>《深入理解计算机系统》</li>
<li>《程序员的自我修养》</li>
<li>《Head First 设计模式》</li>
</ul>
<h3 id="三方库使用"><a href="#三方库使用" class="headerlink" title="三方库使用"></a>三方库使用</h3><h4 id="SQLite-swift-的使用"><a href="#SQLite-swift-的使用" class="headerlink" title="SQLite.swift 的使用"></a>SQLite.swift 的使用</h4><p>下面是 SQLite.swift 库的使用介绍，包括了数据库创建，表创建，表的添加、更新、删除、查找等处理方法</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">SQLite</span>

<span class="token keyword">struct</span> <span class="token constant">DB</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">let</span> shared <span class="token operator">=</span> <span class="token function">DB</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">static</span> <span class="token keyword">let</span> path <span class="token operator">=</span> <span class="token class-name">NSSearchPathForDirectoriesInDomains</span><span class="token punctuation">(</span>
        <span class="token punctuation">.</span>applicationSupportDirectory<span class="token punctuation">,</span> <span class="token punctuation">.</span>userDomainMask<span class="token punctuation">,</span> <span class="token boolean">true</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token operator">!</span>
    <span class="token keyword">let</span> <span class="token constant">BBDB</span><span class="token punctuation">:</span> <span class="token class-name">Connection</span><span class="token operator">?</span>
    <span class="token keyword">private</span> <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token constant">DB</span><span class="token punctuation">.</span>path<span class="token punctuation">)</span>
            <span class="token constant">BBDB</span> <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token class-name">Connection</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation"><span class="token constant">DB</span><span class="token punctuation">.</span>path</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">/github.sqlite3"</span></span><span class="token punctuation">)</span>
            
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span>
            <span class="token constant">BBDB</span> <span class="token operator">=</span> <span class="token nil constant">nil</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">/// Swift 类型和 SQLite 类型对标如下：</span>
        <span class="token comment">/// Int64 = INTEGER</span>
        <span class="token comment">/// Double = REAL</span>
        <span class="token comment">/// String = TEXT</span>
        <span class="token comment">/// nil = NULL</span>
        <span class="token comment">/// SQLite.Blob = BLOB</span>
        
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">// 创建表</span>
    <span class="token keyword">func</span> <span class="token function-definition function">cTbs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">try</span> <span class="token class-name">ReposNotiDataHelper</span><span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">try</span> <span class="token class-name">DevsNotiDataHelper</span><span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token class-name">DBError</span><span class="token punctuation">.</span>connectionErr
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    
<span class="token punctuation">&#125;</span>

<span class="token keyword">enum</span> <span class="token class-name">DBError</span><span class="token punctuation">:</span> <span class="token class-name">Error</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> connectionErr<span class="token punctuation">,</span> insertErr<span class="token punctuation">,</span> deleteErr<span class="token punctuation">,</span> searchErr<span class="token punctuation">,</span> updateErr<span class="token punctuation">,</span> nilInData
<span class="token punctuation">&#125;</span>

<span class="token keyword">protocol</span> <span class="token class-name">DataHelperProtocol</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">associatedtype</span> <span class="token class-name">T</span>
    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">createTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token operator">-></span> <span class="token class-name">Void</span>
    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">insert</span><span class="token punctuation">(</span>i<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token operator">-></span> <span class="token class-name">Int64</span>
    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">delete</span><span class="token punctuation">(</span>i<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token operator">-></span> <span class="token class-name">Void</span>
    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token operator">-></span> <span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">]</span><span class="token operator">?</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// MARK: 开发者更新提醒</span>
<span class="token keyword">typealias</span> <span class="token class-name">DBDevNoti</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
    login<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
    lastReadId<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
    unRead<span class="token punctuation">:</span> <span class="token class-name">Int</span>
<span class="token punctuation">)</span>

<span class="token keyword">struct</span> <span class="token class-name">DevsNotiDataHelper</span><span class="token punctuation">:</span> <span class="token class-name">DataHelperProtocol</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">let</span> table <span class="token operator">=</span> <span class="token class-name">Table</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"devsNoti"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">static</span> <span class="token keyword">let</span> login <span class="token operator">=</span> <span class="token class-name">Expression</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"login"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">static</span> <span class="token keyword">let</span> lastReadId <span class="token operator">=</span> <span class="token class-name">Expression</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"lastReadId"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">static</span> <span class="token keyword">let</span> unRead <span class="token operator">=</span> <span class="token class-name">Expression</span><span class="token operator">&lt;</span><span class="token class-name">Int</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"unRead"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">typealias</span> <span class="token class-name">T</span> <span class="token operator">=</span> <span class="token class-name">DBDevNoti</span>
    
    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">createTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">guard</span> <span class="token keyword">let</span> db <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token constant">BBDB</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token class-name">DBError</span><span class="token punctuation">.</span>connectionErr
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">let</span> <span class="token omit keyword">_</span> <span class="token operator">=</span> <span class="token keyword">try</span> db<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>ifNotExists<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> t <span class="token keyword">in</span>
                t<span class="token punctuation">.</span><span class="token function">column</span><span class="token punctuation">(</span>login<span class="token punctuation">,</span> unique<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
                t<span class="token punctuation">.</span><span class="token function">column</span><span class="token punctuation">(</span>lastReadId<span class="token punctuation">,</span> defaultValue<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span>
                t<span class="token punctuation">.</span><span class="token function">column</span><span class="token punctuation">(</span>unRead<span class="token punctuation">,</span> defaultValue<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token omit keyword">_</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token class-name">DBError</span><span class="token punctuation">.</span>connectionErr
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span> <span class="token comment">// end createTable</span>
    
    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">insert</span><span class="token punctuation">(</span>i<span class="token punctuation">:</span> <span class="token class-name">DBDevNoti</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token operator">-></span> <span class="token class-name">Int64</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">guard</span> <span class="token keyword">let</span> db <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token constant">BBDB</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token class-name">DBError</span><span class="token punctuation">.</span>connectionErr
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">let</span> insert <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>login <span class="token operator">&lt;-</span> i<span class="token punctuation">.</span>login<span class="token punctuation">,</span> lastReadId <span class="token operator">&lt;-</span> i<span class="token punctuation">.</span>lastReadId<span class="token punctuation">,</span> unRead <span class="token operator">&lt;-</span> i<span class="token punctuation">.</span>unRead<span class="token punctuation">)</span>
        <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">let</span> rowId <span class="token operator">=</span> <span class="token keyword">try</span> db<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>insert<span class="token punctuation">)</span>
            <span class="token keyword">guard</span> rowId <span class="token operator">></span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">throw</span> <span class="token class-name">DBError</span><span class="token punctuation">.</span>insertErr
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">return</span> rowId
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token class-name">DBError</span><span class="token punctuation">.</span>insertErr
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span> <span class="token comment">// end insert</span>
    
    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">delete</span><span class="token punctuation">(</span>i<span class="token punctuation">:</span> <span class="token class-name">DBDevNoti</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">guard</span> <span class="token keyword">let</span> db <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token constant">BBDB</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token class-name">DBError</span><span class="token punctuation">.</span>connectionErr
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">let</span> query <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>login <span class="token operator">==</span> i<span class="token punctuation">.</span>login<span class="token punctuation">)</span>
        <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">let</span> tmp <span class="token operator">=</span> <span class="token keyword">try</span> db<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">guard</span> tmp <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">throw</span> <span class="token class-name">DBError</span><span class="token punctuation">.</span>deleteErr
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token class-name">DBError</span><span class="token punctuation">.</span>deleteErr
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span> <span class="token comment">// end delete</span>
    
    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">find</span><span class="token punctuation">(</span>sLogin<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token operator">-></span> <span class="token class-name">DBDevNoti</span><span class="token operator">?</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">guard</span> <span class="token keyword">let</span> db <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token constant">BBDB</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token class-name">DBError</span><span class="token punctuation">.</span>connectionErr
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">let</span> query <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>login <span class="token operator">==</span> sLogin<span class="token punctuation">)</span>
        <span class="token keyword">let</span> items <span class="token operator">=</span> <span class="token keyword">try</span> db<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> items <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token class-name">DBDevNoti</span><span class="token punctuation">(</span>login<span class="token punctuation">:</span> i<span class="token punctuation">[</span>login<span class="token punctuation">]</span><span class="token punctuation">,</span> lastReadId<span class="token punctuation">:</span> i<span class="token punctuation">[</span>lastReadId<span class="token punctuation">]</span><span class="token punctuation">,</span> unRead<span class="token punctuation">:</span> i<span class="token punctuation">[</span>unRead<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token nil constant">nil</span>
    <span class="token punctuation">&#125;</span> <span class="token comment">// end find</span>
    
    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">update</span><span class="token punctuation">(</span>i<span class="token punctuation">:</span> <span class="token class-name">DBDevNoti</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">guard</span> <span class="token keyword">let</span> db <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token constant">BBDB</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token class-name">DBError</span><span class="token punctuation">.</span>connectionErr
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">let</span> query <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>login <span class="token operator">==</span> i<span class="token punctuation">.</span>login<span class="token punctuation">)</span>
        <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token keyword">try</span> db<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>lastReadId <span class="token operator">&lt;-</span> i<span class="token punctuation">.</span>lastReadId<span class="token punctuation">,</span> unRead <span class="token operator">&lt;-</span> i<span class="token punctuation">.</span>unRead<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">&#123;</span>
                
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">throw</span> <span class="token class-name">DBError</span><span class="token punctuation">.</span>updateErr
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token class-name">DBError</span><span class="token punctuation">.</span>updateErr
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span> <span class="token comment">// end update</span>
    
    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token operator">-></span> <span class="token punctuation">[</span><span class="token class-name">DBDevNoti</span><span class="token punctuation">]</span><span class="token operator">?</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">guard</span> <span class="token keyword">let</span> db <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token constant">BBDB</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token class-name">DBError</span><span class="token punctuation">.</span>connectionErr
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">DBDevNoti</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> items <span class="token operator">=</span> <span class="token keyword">try</span> db<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span>table<span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> items <span class="token punctuation">&#123;</span>
            arr<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">DBDevNoti</span><span class="token punctuation">(</span>login<span class="token punctuation">:</span> i<span class="token punctuation">[</span>login<span class="token punctuation">]</span><span class="token punctuation">,</span> lastReadId<span class="token punctuation">:</span> i<span class="token punctuation">[</span>lastReadId<span class="token punctuation">]</span><span class="token punctuation">,</span> unRead<span class="token punctuation">:</span> i<span class="token punctuation">[</span>unRead<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> arr
    <span class="token punctuation">&#125;</span> <span class="token comment">// end find all</span>
    
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用时，可以在初始化时这么做：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// MARK: 初始化数据库</span>
et db <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">.</span>shared
<span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">try</span> db<span class="token punctuation">.</span><span class="token function">cTbs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 创建表</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span>
    
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用的操作示例如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token keyword">let</span> fd <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token class-name">ReposNotiDataHelper</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>sFullName<span class="token punctuation">:</span> r<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        reposDic<span class="token punctuation">[</span>fd<span class="token punctuation">.</span>fullName<span class="token punctuation">]</span> <span class="token operator">=</span> fd<span class="token punctuation">.</span>unRead
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">let</span> <span class="token omit keyword">_</span> <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token class-name">ReposNotiDataHelper</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>i<span class="token punctuation">:</span> <span class="token class-name">DBRepoNoti</span><span class="token punctuation">(</span>fullName<span class="token punctuation">:</span> r<span class="token punctuation">.</span>id<span class="token punctuation">,</span> lastReadCommitSha<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">,</span> unRead<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            reposDic<span class="token punctuation">[</span>r<span class="token punctuation">.</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> reposDic
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> reposDic
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="macOS"><a href="#macOS" class="headerlink" title="macOS"></a>macOS</h3><h4 id="范例"><a href="#范例" class="headerlink" title="范例"></a>范例</h4><ul>
<li>官方提供的两个例子，<a target="_blank" rel="noopener" href="https://developer.apple.com/tutorials/swiftui/creating-a-macos-app">Creating a macOS App</a>，<a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/swiftui/building_a_great_mac_app_with_swiftui">Building a Great Mac App with SwiftUI</a> （有table和LazyVGrid的用法）。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/adamayoung/Movies">GitHub - adamayoung&#x2F;Movies: Movies and TV Shows App for iOS, iPadOS, watchOS and macOS</a> 使用了SwiftUI和Combine，电影数据使用的是<a target="_blank" rel="noopener" href="https://www.themoviedb.org/">The Movie Database (TMDB)</a>的API</li>
</ul>
<h4 id="三栏结构"><a href="#三栏结构" class="headerlink" title="三栏结构"></a>三栏结构</h4><p>三栏结构架子搭建，代码如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">SwiftUI</span>
<span class="token keyword">struct</span> <span class="token class-name">SwiftPamphletApp</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">NavigationView</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">SPSidebar</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"第二栏"</span></span><span class="token punctuation">)</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"第三栏"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">navigationTitle</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Swift 小册子"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>toolbar <span class="token punctuation">&#123;</span>
            <span class="token class-name">ToolbarItem</span><span class="token punctuation">(</span>placement<span class="token punctuation">:</span> <span class="token class-name">ToolbarItemPlacement</span><span class="token punctuation">.</span>navigation<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Button</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">NSApp</span><span class="token punctuation">.</span>keyWindow<span class="token operator">?</span><span class="token punctuation">.</span>firstResponder<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">tryToPerform</span><span class="token punctuation">(</span><span class="token other-directive property">#selector</span><span class="token punctuation">(</span><span class="token class-name">NSSplitViewController</span><span class="token punctuation">.</span><span class="token function">toggleSidebar</span><span class="token punctuation">(</span><span class="token omit keyword">_</span><span class="token punctuation">:</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> with<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span> label<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Label</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Sidebar"</span></span><span class="token punctuation">,</span> systemImage<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"sidebar.left"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">struct</span> <span class="token class-name">SPSidebar</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">List</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Section</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"第一组"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">NavigationLink</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"第一项"</span></span><span class="token punctuation">,</span> destination<span class="token punctuation">:</span> <span class="token class-name">SPList</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"列表1"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">badge</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
                <span class="token class-name">NavigationLink</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"第二项"</span></span><span class="token punctuation">,</span> destination<span class="token punctuation">:</span> <span class="token class-name">SPList</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"列表2"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
            <span class="token class-name">Section</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"第二组"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">NavigationLink</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"第三项"</span></span><span class="token punctuation">,</span> destination<span class="token punctuation">:</span> <span class="token class-name">SPList</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"列表3"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token class-name">NavigationLink</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"第四项"</span></span><span class="token punctuation">,</span> destination<span class="token punctuation">:</span> <span class="token class-name">SPList</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"列表4"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">listStyle</span><span class="token punctuation">(</span><span class="token class-name">SidebarListStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>minWidth<span class="token punctuation">:</span> <span class="token number">160</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>toolbar <span class="token punctuation">&#123;</span>
            <span class="token class-name">ToolbarItem</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Menu</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"1"</span></span><span class="token punctuation">)</span>
                    <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"2"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span> label<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Label</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Label"</span></span><span class="token punctuation">,</span> systemImage<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"slider.horizontal.3"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">struct</span> <span class="token class-name">SPList</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> title<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">var</span> searchText<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">List</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">..&lt;</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> i <span class="token keyword">in</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"内容</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">toolbar</span><span class="token punctuation">(</span>content<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Button</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">//</span>
            <span class="token punctuation">&#125;</span> label<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Label</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Add"</span></span><span class="token punctuation">,</span> systemImage<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"plus"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">navigationTitle</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">navigationSubtitle</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"副标题"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">searchable</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> $searchText<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>显示效果如下：<br><img  srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://user-images.githubusercontent.com/251980/142977421-bed5b5ae-01fe-471f-a951-63dd4338c97a.png" class="lozad post-image"src="https://user-images.githubusercontent.com/251980/142977421-bed5b5ae-01fe-471f-a951-63dd4338c97a.png"></p>
<h4 id="全屏模式"><a href="#全屏模式" class="headerlink" title="全屏模式"></a>全屏模式</h4><p>将 NSSplitView 里的其中一个 NSView 设置为全屏和退出全屏的函数如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// MARK: - 获取 NSSplitViewController</span>
<span class="token keyword">func</span> <span class="token function-definition function">splitVC</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">NSSplitViewController</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">NSApp</span><span class="token punctuation">.</span>keyWindow<span class="token operator">?</span><span class="token punctuation">.</span>contentView<span class="token operator">?</span><span class="token punctuation">.</span>subviews<span class="token punctuation">.</span>first<span class="token operator">?</span><span class="token punctuation">.</span>subviews<span class="token punctuation">.</span>first<span class="token operator">?</span><span class="token punctuation">.</span>subviews<span class="token punctuation">.</span>first <span class="token keyword">as</span><span class="token operator">?</span> <span class="token class-name">NSSplitView</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span>delegate <span class="token keyword">as</span><span class="token operator">?</span> <span class="token class-name">NSSplitViewController</span><span class="token punctuation">)</span><span class="token operator">!</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// MARK: - 全屏</span>
<span class="token keyword">func</span> <span class="token function-definition function">fullScreen</span><span class="token punctuation">(</span>isEnter<span class="token punctuation">:</span> <span class="token class-name">Bool</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> isEnter <span class="token operator">==</span> <span class="token boolean">true</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 进入全屏</span>
        <span class="token keyword">let</span> presOptions<span class="token punctuation">:</span>
        <span class="token class-name">NSApplication</span><span class="token punctuation">.</span><span class="token class-name">PresentationOptions</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">.</span>autoHideDock<span class="token punctuation">,</span><span class="token punctuation">.</span>autoHideMenuBar<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> optionsDictionary <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">NSView</span><span class="token punctuation">.</span><span class="token class-name">FullScreenModeOptionKey</span><span class="token punctuation">.</span>fullScreenModeApplicationPresentationOptions <span class="token punctuation">:</span> <span class="token class-name">NSNumber</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> presOptions<span class="token punctuation">.</span>rawValue<span class="token punctuation">)</span><span class="token punctuation">]</span>
        
        <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token function">splitVC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>splitViewItems<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>viewController<span class="token punctuation">.</span>view
        v<span class="token punctuation">.</span><span class="token function">enterFullScreenMode</span><span class="token punctuation">(</span><span class="token class-name">NSScreen</span><span class="token punctuation">.</span>main<span class="token operator">!</span><span class="token punctuation">,</span> withOptions<span class="token punctuation">:</span> optionsDictionary<span class="token punctuation">)</span>
        v<span class="token punctuation">.</span>wantsLayer <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 退出全屏</span>
        <span class="token class-name">NSApp</span><span class="token punctuation">.</span>keyWindow<span class="token operator">?</span><span class="token punctuation">.</span>contentView<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">exitFullScreenMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span> <span class="token comment">// end if</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用方法</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">V</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@StateObject</span> <span class="token keyword">var</span> appVM <span class="token operator">=</span> <span class="token class-name">AppVM</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">var</span> isEnterFullScreen<span class="token punctuation">:</span> <span class="token class-name">Bool</span> <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">// 全屏控制</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Button</span> <span class="token punctuation">&#123;</span>
            isEnterFullScreen<span class="token punctuation">.</span><span class="token function">toggle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            appVM<span class="token punctuation">.</span><span class="token function">fullScreen</span><span class="token punctuation">(</span>isEnter<span class="token punctuation">:</span> isEnterFullScreen<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span> label<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> isEnterFullScreen <span class="token operator">==</span> <span class="token boolean">true</span> <span class="token operator">?</span> <span class="token string-literal"><span class="token string">"arrow.down.right.and.arrow.up.left"</span></span> <span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"arrow.up.left.and.arrow.down.right"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="共享菜单"><a href="#共享菜单" class="headerlink" title="共享菜单"></a>共享菜单</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">ShareView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> s<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Menu</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Button</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token class-name">NSPasteboard</span><span class="token punctuation">.</span>general
                p<span class="token punctuation">.</span><span class="token function">declareTypes</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">.</span>string<span class="token punctuation">]</span><span class="token punctuation">,</span> owner<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span>
                p<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> forType<span class="token punctuation">:</span> <span class="token punctuation">.</span>string<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span> label<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"拷贝链接"</span></span><span class="token punctuation">)</span>
                <span class="token class-name">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"doc.on.doc"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
            <span class="token class-name">Divider</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token class-name">ForEach</span><span class="token punctuation">(</span><span class="token class-name">NSSharingService</span><span class="token punctuation">.</span><span class="token function">sharingServices</span><span class="token punctuation">(</span>forItems<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token punctuation">\</span><span class="token punctuation">.</span>title<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> item <span class="token keyword">in</span>
                <span class="token class-name">Button</span> <span class="token punctuation">&#123;</span>
                    item<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span>withItems<span class="token punctuation">:</span> <span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span> label<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Text</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>title<span class="token punctuation">)</span>
                    <span class="token class-name">Image</span><span class="token punctuation">(</span>nsImage<span class="token punctuation">:</span> item<span class="token punctuation">.</span>image<span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> label<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"分享"</span></span><span class="token punctuation">)</span>
            <span class="token class-name">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"square.and.arrow.up"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="剪贴板"><a href="#剪贴板" class="headerlink" title="剪贴板"></a>剪贴板</h4><p>添加和读取剪贴板的方法如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 读取剪贴板内容</span>
<span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token class-name">NSPasteboard</span><span class="token punctuation">.</span>general<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>forType<span class="token punctuation">:</span> <span class="token punctuation">.</span>string<span class="token punctuation">)</span>
<span class="token keyword">guard</span> <span class="token keyword">let</span> s <span class="token operator">=</span> s <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span>
<span class="token punctuation">&#125;</span>
<span class="token function">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>

<span class="token comment">// 设置剪贴板内容</span>
<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token class-name">NSPasteboard</span><span class="token punctuation">.</span>general
p<span class="token punctuation">.</span><span class="token function">declareTypes</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">.</span>string<span class="token punctuation">]</span><span class="token punctuation">,</span> owner<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> forType<span class="token punctuation">:</span> <span class="token punctuation">.</span>string<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="性能和构建"><a href="#性能和构建" class="headerlink" title="性能和构建"></a>性能和构建</h3><h4 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h4><p>session <a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2022-110370">Debug Swift debugging with LLDB</a></p>
<p>编译器编译 swift 文件生成 <code>.o</code> 文件会有 <code>__debug_info</code> 段，其中有可以映射到源文件和行号的地址。debug 信息可以链接到 <code>.dSYM</code> 包。debug 信息链接器叫 dsymutil，dsymutil 可以为每个动态库、framework 或 dylib 和可执行文件打包一个 debug 信息存档（<code>.dSYM</code> 包）。</p>
<p>image 和路径怎么重映射。使用 <code>image list nameOfFramework</code> 来检查 LLDB 是否找到了我们应用程序里嵌入的第三方框架的 debug dSYM。使用 <code>image lookup 0xMemoryAddressHere</code> 获取当前地址更多信息。要重新映射源文件 <code>.dSYM</code> 路径，使用 <code>settings set target.source-map old/path new/path</code>。每个 <code>.dSYM</code> 都有一个 <code>UUID.plist</code>，我们可以在其中设置 DBGSourcePathRemapping 这个字典。</p>
<p>Xcode 14 新增 <code>swift-healthcheck</code> 命令，这个命令可以了解 module 为何导入失败。</p>
<p>LLDB 怎么找到 Swift module？每个 <code>.dSYM</code> 包都可以包含二级制 swift module，其中可能包含桥头文件、swift 接口文件 <code>.swiftinterface</code>，还有 debug 信息。静态存档不是由链接器生成的，需要向链接器注册 swift module，使用 <code>ld ... -add-ast-path /path/to/My.swiftmodule</code> ，动态库和可执行文件的话，Xcode 会自动完成此操作。可以使用 dsymutil 来 dump 你可执行文件的符号表，并用 grep 找 swiftmodule，命令是 <code>dsymutil -s MyApp | grep .swiftmodule</code> 。</p>
<h4 id="内存管理"><a href="#内存管理" class="headerlink" title="内存管理"></a>内存管理</h4><p>相关提案包括 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0349-unaligned-loads-and-stores.md">SE-0349 Unaligned Loads and Stores from Raw Memory</a> 、<a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0334-pointer-usability-improvements.md">SE-0334 Pointer API Usability Improvements</a> 、<a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0333-with-memory-rebound.md">SE-0333 Expand usability of withMemoryRebound</a></p>
<p>Set 使用新的 Temporary Buffers 功能，让 intersect 速度提升了 4 到 6 倍。</p>
<h4 id="链接器"><a href="#链接器" class="headerlink" title="链接器"></a>链接器</h4><p><a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2022/110362/">Link fast: Improve build and launch time</a> 详细讲了 Apple 今年怎么改进了 link，思路很棒，很值得学习。</p>
<p>Static linking 和 Dynamic linking ，也就是静态链接和动态链接。</p>
<p>静态链接就是链接各个编译好的源文件以及链接源文件和编译好的库文件，通过将函数名放到符号表，链接新文件时确定先前是否有包含的 undefined 符号，给函数的数据指令分配地址，最后生成一个有 TEXT、DATA、LINKEDIT 段的可执行文件。</p>
<p>今年 Apple  通过利用多核优势让静态链接快了两倍。</p>
<p>具体做法是，并行的拷贝文件内容。并行构建 LINKEDIT 段的各个不同部分。并行改变 UUID 计算和 codesigning 哈希。然后是提高 exports-trie 构建器的算法。使用最新的 Crypto 库利用硬件加速的优势加速 UUID 计算。提高其它静态库处理算法库，debug-notes 生成也更快了。</p>
<p>Apple 推荐静态库最佳实践是：</p>
<p>使用 <code>-all_load</code> 或 <code>-force_load</code> 可以让 .a 文件像 .o 文件那样并行处理，不过开启这个选项需要先处理重复的符号。另外一个副作用是会将一些被判断无用的代码也被链接进来，使包体变大，因此开启之前可以先使用静态分析工具分析处理，这个过程定期做就行，不用放到每次编译过程中。演讲者推荐使用 <code>-dead_strip</code> 选项，但是这样做并没有真实去掉费代码，以后这些代码还是会被编译分析，如果只是暂时不用，可以先注释掉。</p>
<p>使用 <code>-no_exported_symbols</code> 选项。链接器生成的 LINKEDIT 段的一部分是 exports trie，这是一个前缀树，对所有导出的符号名称、地址和标志进行编码。动态库 是会导出符号的，但运行的二进制文件其实是不用这些符号的，因此可以用 <code>-no_exported_symbols</code> 选项来跳过 LINKEDIT 中 trie 数据结构的创建，这样链接起来就快多了。如果程序导出符号是一百万个，这个选项就可以减少 2 到 3 秒的时间。但需要注意的是，如果要加载插件链接回主程序就需要所有的导出的 trie 数据，无法用这个选项。</p>
<p>另外一个是 <code>-no_deduplicate</code> 选项。先前 Apple 给链接器加了个 pass 用来合并函数的指令相同，函数名不相同，这个 pass 会对每个函数的指令进行递归散列，用这种方式来找重复指令，这样做比较费 CPU，由于调试时其实是不需要关注包大小，因此可以加上 <code>-no_deduplicate</code> 选项来跳过这个 pass。</p>
<p>这些选项在 Xcode 的 Other Linker Flags 里进行设置即可。</p>
<p>动态库也就是 dylib，其它平台就是 DSO 或 DLL。 动态链接器不是将代码从库里考到主二进制里，而是记录某种承诺，记录从动态库中使用符号名称，还有库路径。这样做好处就是好复用动态库，不用拷贝多份。虚拟内存看到多进程使用相同动态库，就会重新给这个动态库用相同的物理内存页。</p>
<p>动态库好处是构建快了，启动加载慢了，多个动态库不光要加载，还要在启动时链接。也就是把链接成本从本地构建换到了用户启动时。动态库还有个缺点是基于动态库的程序会有更多的 dirty 页，因为静态链接时会把全局数据放到主程序同一个 DATA 页中，动态库的话，每个都在自己的 DATA 页中。</p>
<p>动态库工作的原理是，可执行的二进制会有不同权限的段，至少会有 TEXT、DATA 和 LINKEDIT。分段总是操作系统页大小的倍数。TEXT 段有执行的权限，CPU 可以将页上的字节当做机器代码指令。运行时，dyld 会根据每个段权限将可执行文件 mmap() 到内存，这些段是页大小和页对齐的，虚拟内存系统可以直接将程序或动态库文件设置为 VM 范围的备份存储。在这些页的内存访问前是不会被加载到 RAM 里，就会触发一个页 fault，导致 VM 去读取文件的子范围，将内存填充到需要 RAM 页中。光映射不够，还要用某种方式“wired up”或绑到动态库上。比如要调用动态库上的某个函数，会转换成调用 site，调用 site 成为一个在相同 TEXT 段合成的 sub 的调用，相对地址在构建时就知道了，就意味着可以正确的形成 BL 指令。这样做的好处是，stub 从 DATA 加载一个指针并跳到对应的位置，不用在运行时修改 TEXT 段，dyld 只在运行时改 DATA 段。dyld 所进行的修改很简单，就是在 DATA 段里设置了一个指针而已。</p>
<p>当 dyld 或应用程序的指针指向自己时要 rebase，ASLR 使 dyld 以随机地址加载动态库，内部指针不能在构建时设置，dyld 在启动时 rebase 这些指针，磁盘上，如果动态库在地址零出被加载，这些指针包含它们的目标地址。LINKEDIT 需要记录的就是每个重定位的位置。然后，dyld 只需将动态库的实际加载地址添加到每个 rebase 位置。还有种修改方式是绑定，绑定就是符号引用，符号存储在 LINKEDIT 中，dyld 在动态库的 exports tire 中找实际地址，然后 dyld 将该值存储在绑定指定的位置。</p>
<p>今年 Apple 发布了一个新的修改方式 chained fixups。较前面两种的优势就是可以使 LINKEDIT 更小。新格式只存储每个 DATA 页中第一个 fixup 位置和一个导入的符号列表。其它信息编码到 DATA 段。iOS 13.4 就开始支持了。</p>
<p>下面先说下 dyld 原理介绍。</p>
<p>dyld 从主可执行文件开始，解析 mach-o 找依赖动态库，对动态库进行 mmap()。然后对每个动态库进行遍历并解析 mach-o 结构，根据需要加载其它动态库。加载完毕，dyld 会查找所有需要绑定符号，并在修改时使用这些地址。最后修改完，dyld 自下而上运行初始化程序。先前做的优化是只要程序和动态库，dyld 很多步骤都可以在首次启动时被缓存。</p>
<p>今年 Apple 做了更多的优化，这个优化叫 page-in linking，就是 dyld 在启动时做的 DATA 页面修改放到 page-in 时，也可以理解为懒修改。以前，在 mmap() 区域的某些页面中第一次使用某些地址会触发内核读入该页面。现在如果它是一个数据页，内核会应用改页需要的修改。这种机制减少了 dirty 内存和启动时间。意味着 DATA_CONST 也是干净的，可以像 TEXT 页一样被 evicted 和重新创建，以减少内存压力。需要注意的是 page-in linking 只用于启动，dlopen() 不支持。你看，Apple 优化启动的思路也是按需加载。</p>
<p>Apple 还提供了追踪 dyld 运行情况的 dyld_usage 工具。检查磁盘和 dyld 缓存中的二进制文件的 dyld_info 工具。</p>
<h4 id="2022年-Apple-性能更新"><a href="#2022年-Apple-性能更新" class="headerlink" title="2022年 Apple 性能更新"></a>2022年 Apple 性能更新</h4><p><a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2022/110363">Improve app size and runtime performance</a></p>
<p>今年苹果通过更有效的检查 Swift 协议，使 OC 消息发送调用更小，使 autorelease elision 更快更小这几个个方面来让 App 体积更小，性能更高。</p>
<p>Swift 协议检查。</p>
<p>一个协议通过 as 操作符检查传递值是否符合协议，这种检查会在编译器的构建时间被优化掉，所以往往需要在运行时借助之前计算协议检查元数据来看对象是否真的符合了协议。一些元数据是在编译时建的，但还有很多元数据只能在启动时建立，特别是使用泛型时。协议多了，会增加耗时，差不多会多一半启动时间。</p>
<p>今年 Apple 推出新的 Swift 运行时，可以提前计算 Swift 协议元数据，作为 App 可执行文件和它在启动时使用的任何动态库的 dyld 闭包的一部分。这个是在系统上的，因此，只要是使用了今年最新系统的 App 都会享受这个优化，可以理解为，新系统上启动老 App 也会快些。</p>
<p>消息发送。</p>
<p>Xcode 14 中新的编译器和链接器已经将 ARM64 的消息发送调用从 12 字节减少到 8 字节。因此如果你的 App 都是 OC 代码的话，使用 Xcode 14 编出来的二进制文件可以少 2%。老系统也有效。</p>
<p>使用 objc_stubs_small 选项可以只优化大小，获得最大的大小优化。objc_msgSend 调动有 8 个字节指令，也就是2个指令是专门用来准备 selector 的，对于任何特定的 selector，总是相同的代码，由于始终是相同的代码，那么就可以对其共享，每个 selector 只 emit 一次，而不是每次发送消息时都 emit。共享这段代码地方是一个叫 selector stub 的函数。</p>
<p>ARC 会在编译器插入大量的 c 的 retain&#x2F;release 函数调用。这些调用遵守平台应用二进制接口（ABI）所定义的 c 语言 call convention。也就意味着我们要更多代码来完成这些调用，用来传递正确寄存器的指针。Apple 今年推出了自定义的 call convention 根据指针位置，适时使用正确变量而不用移动它，从而摆脱了调用里的多余代码。Apple 果然是坚持用户体验优先，为了更好体验不惜修改 c 的 ABI。</p>
<p>autorelease elision 。</p>
<p>App 今年对 objc 运行时进行了修改，使 autorelease elision 更小更快。deployment target 为 iOS 16 今年新系统时才可享用哦。</p>
<p>Apple 怎么做的呢？</p>
<p>ARC 在调用方插入一个 retain，在被调用的函数中插入一个 release。当我们返回我们的临时对象时，我们需要在函数中先释放它，因为它要离开 scope。在它还没有任何其它引用时还不能这么做，不然返回前他就会被销毁。Apple 现在使用一个新的 convention ，让其可以返回临时对象。做法是当返回一个自动释放值，编译器会发出一个特殊标记，这个标记会告诉运行时这是符合自动释放条件的。它的后面是 retain，我们会在后面执行。获取返回地址，也就是一个指针，将它先保存起来，然后离开运行时的自动释放调用。在运行时，可以将保留时得到的指正和先前做自动释放时保存的指针进行比较，这样标记指令不再是数据之间的比较，比较指针内存访问少。比较成功就可以省去 autorelease&#x2F;retain。</p>
<p>autorelease elision 的优化同样也可以减少 2% 大小。感谢 Apple 为了用户和开发者 OKR 的付出。</p>
<h2 id="Combine"><a href="#Combine" class="headerlink" title="Combine"></a>Combine</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><h4 id="Combine-是什么？"><a href="#Combine-是什么？" class="headerlink" title="Combine 是什么？"></a>Combine 是什么？</h4><p>WWDC 2019苹果推出Combine，Combine是一种响应式编程范式，采用声明式的Swift API。</p>
<p>Combine 写代码的思路是你写代码不同于以往命令式的描述如何处理数据，Combine 是要去描述好数据会经过哪些逻辑运算处理。这样代码更好维护，可以有效的减少嵌套闭包以及分散的回调等使得代码维护麻烦的苦恼。</p>
<p>声明式和过程时区别可见如下代码：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// 所有数相加</span>
<span class="token comment">// 命令式思维</span>
<span class="token keyword">func</span> <span class="token function-definition function">sum1</span><span class="token punctuation">(</span>arr<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Int</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Int</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> sum<span class="token punctuation">:</span> <span class="token class-name">Int</span> <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">for</span> v <span class="token keyword">in</span> arr <span class="token punctuation">&#123;</span>
    sum <span class="token operator">+=</span> v
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> sum
<span class="token punctuation">&#125;</span>

<span class="token comment">// 声明式思维</span>
<span class="token keyword">func</span> <span class="token function-definition function">sum2</span><span class="token punctuation">(</span>arr<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Int</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Int</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">+</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>Combine 主要用来处理异步的事件和值。苹果 UI 框架都是在主线程上进行 UI 更新，Combine 通过 Publisher 的 receive 设置回主线程更新UI会非常的简单。</p>
<p>已有的 RxSwift 和 ReactiveSwift 框架和 Combine 的思路和用法类似。</p>
<p>Combine 的三个核心概念</p>
<ul>
<li>发布者</li>
<li>订阅者</li>
<li>操作符</li>
</ul>
<p>简单举个发布数据和类属性绑定的例子：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> pA <span class="token operator">=</span> <span class="token class-name">Just</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> <span class="token omit keyword">_</span> <span class="token operator">=</span> pA<span class="token punctuation">.</span>sink <span class="token punctuation">&#123;</span> v <span class="token keyword">in</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"pA is: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">v</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> pB <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">90</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">.</span>publisher
<span class="token keyword">let</span> <span class="token omit keyword">_</span> <span class="token operator">=</span> pB
    <span class="token punctuation">.</span>sink <span class="token punctuation">&#123;</span> v <span class="token keyword">in</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"pB: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">v</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">AClass</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> p<span class="token punctuation">:</span> <span class="token class-name">Int</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">didSet</span> <span class="token punctuation">&#123;</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"property update to </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">p</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token class-name">AClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> <span class="token omit keyword">_</span> <span class="token operator">=</span> pB<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>to<span class="token punctuation">:</span> <span class="token punctuation">\</span><span class="token punctuation">.</span>p<span class="token punctuation">,</span> on<span class="token punctuation">:</span> o<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="Combine-资料"><a href="#Combine-资料" class="headerlink" title="Combine 资料"></a>Combine 资料</h4><p>官方文档链接  <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/combine">Combine | Apple Developer Documentation</a> 。还有  <a target="_blank" rel="noopener" href="https://heckj.github.io/swiftui-notes/">Using Combine</a>  这里有大量使用示例，内容较全。官方讨论Combine的论坛  <a target="_blank" rel="noopener" href="https://forums.swift.org/tag/combine">Topics tagged combine</a> 。StackOverflow上相关问题  <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/tagged/combine">Newest ‘combine’ Questions</a> 。</p>
<p>WWDC上关于Combine的Session如下：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2019/722/">Introducing Combine</a> </li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2019/721/">Combine in Practice</a></li>
</ul>
<p>和Combine相关的Session：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2019/415/">Modern Swift API Design</a> </li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2019/226">Data Flow Through SwiftUI</a> </li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2019/711">Introducing Combine and Advances in Foundation</a> </li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2019/712/">Advances in Networking, Part 1</a> </li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2019/610/">Building Collaborative AR Experiences</a> </li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2019/223/">Expanding the Sensory Experience with Core Haptics</a></li>
</ul>
<h3 id="使用说明"><a href="#使用说明" class="headerlink" title="使用说明"></a>使用说明</h3><h4 id="publisher"><a href="#publisher" class="headerlink" title="publisher"></a>publisher</h4><p>publisher 是发布者，sink 是订阅者</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">Combine</span>

<span class="token keyword">var</span> cc <span class="token operator">=</span> <span class="token class-name">Set</span><span class="token operator">&lt;</span><span class="token class-name">AnyCancellable</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">struct</span> <span class="token class-name">S</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> p1<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">let</span> p2<span class="token punctuation">:</span> <span class="token class-name">String</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">[</span><span class="token class-name">S</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"1"</span></span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">S</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"2"</span></span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token punctuation">.</span>publisher
    <span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"array"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>sink <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token short-argument">$0</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span>cc<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> 输出<br> <pre class="line-numbers language-none"><code class="language-none"> array: receive subscription: ([戴铭的开发小册子.AppDelegate.(unknown context at $10ac82d20).(unknown context at $10ac82da4).S(p1: &quot;1&quot;, p2: &quot;one&quot;), 戴铭的开发小册子.AppDelegate.(unknown context at $10ac82d20).(unknown context at $10ac82da4).S(p1: &quot;2&quot;, p2: &quot;two&quot;)])
array: request unlimited
array: receive value: (S(p1: &quot;1&quot;, p2: &quot;one&quot;))
S(p1: &quot;1&quot;, p2: &quot;one&quot;)
array: receive value: (S(p1: &quot;2&quot;, p2: &quot;two&quot;))
S(p1: &quot;2&quot;, p2: &quot;two&quot;)
array: receive finished<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<h4 id="Just"><a href="#Just" class="headerlink" title="Just"></a>Just</h4><p>Just 是发布者，发布的数据在初始化时完成</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">Combine</span>
<span class="token keyword">var</span> cc <span class="token operator">=</span> <span class="token class-name">Set</span><span class="token operator">&lt;</span><span class="token class-name">AnyCancellable</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">struct</span> <span class="token class-name">S</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> p1<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">let</span> p2<span class="token punctuation">:</span> <span class="token class-name">String</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> pb <span class="token operator">=</span> <span class="token class-name">Just</span><span class="token punctuation">(</span><span class="token class-name">S</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"1"</span></span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
pb
    <span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"pb"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>sink <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token short-argument">$0</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span>cc<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>输出</p>
<pre class="line-numbers language-none"><code class="language-none">pb: receive subscription: (Just)
pb: request unlimited
pb: receive value: (S(p1: &quot;1&quot;, p2: &quot;one&quot;))
S(p1: &quot;1&quot;, p2: &quot;one&quot;)
pb: receive finished<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="PassthroughSubject"><a href="#PassthroughSubject" class="headerlink" title="PassthroughSubject"></a>PassthroughSubject</h4><p>PassthroughSubject 可以传递多值，订阅者可以是一个也可以是多个，send 指明 completion 后，订阅者就没法接收到新发送的值了。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">Combine</span>

<span class="token keyword">var</span> cc <span class="token operator">=</span> <span class="token class-name">Set</span><span class="token operator">&lt;</span><span class="token class-name">AnyCancellable</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">struct</span> <span class="token class-name">S</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> p1<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">let</span> p2<span class="token punctuation">:</span> <span class="token class-name">String</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">enum</span> <span class="token class-name">CError</span><span class="token punctuation">:</span> <span class="token class-name">Error</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> aE<span class="token punctuation">,</span> bE
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> ps1 <span class="token operator">=</span> <span class="token class-name">PassthroughSubject</span><span class="token operator">&lt;</span><span class="token class-name">S</span><span class="token punctuation">,</span> <span class="token class-name">CError</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
ps1
    <span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"ps1"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>sink <span class="token punctuation">&#123;</span> c <span class="token keyword">in</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"completion:"</span></span><span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token comment">// send 了 .finished 后会执行</span>
    <span class="token punctuation">&#125;</span> receiveValue<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span> s <span class="token keyword">in</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"receive:"</span></span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>
        
    <span class="token punctuation">&#125;</span>
    <span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span>cc<span class="token punctuation">)</span>

ps1<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token class-name">S</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"1"</span></span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ps1<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>completion<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">failure</span><span class="token punctuation">(</span><span class="token class-name">CError</span><span class="token punctuation">.</span>aE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 和 .finished 一样后面就不会发送了</span>
ps1<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token class-name">S</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"2"</span></span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ps1<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>completion<span class="token punctuation">:</span> <span class="token punctuation">.</span>finished<span class="token punctuation">)</span>
ps1<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token class-name">S</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"3"</span></span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"three"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 多个订阅者</span>
<span class="token keyword">let</span> ps2 <span class="token operator">=</span> <span class="token class-name">PassthroughSubject</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Never</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
ps2<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">)</span> <span class="token comment">// 订阅之前 send 的数据没有订阅者可以接收</span>
ps2<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">)</span>

<span class="token keyword">let</span> sb1 <span class="token operator">=</span> ps2
    <span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"ps2 sb1"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>sink <span class="token punctuation">&#123;</span> s <span class="token keyword">in</span>
    <span class="token function">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>

ps2<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"three"</span></span><span class="token punctuation">)</span> <span class="token comment">// 这个 send 的值会被 sb1</span>

<span class="token keyword">let</span> sb2 <span class="token operator">=</span> ps2
    <span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"ps2 sb2"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>sink <span class="token punctuation">&#123;</span> s <span class="token keyword">in</span>
        <span class="token function">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>

ps2<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"four"</span></span><span class="token punctuation">)</span> <span class="token comment">// 这个 send 的值会被 sb1 和 sb2 接受</span>

sb1<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span>cc<span class="token punctuation">)</span>
sb2<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span>cc<span class="token punctuation">)</span>
ps2<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>completion<span class="token punctuation">:</span> <span class="token punctuation">.</span>finished<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>输出</p>
<pre class="line-numbers language-none"><code class="language-none">ps1: receive subscription: (PassthroughSubject)
ps1: request unlimited
ps1: receive value: (S(p1: &quot;1&quot;, p2: &quot;one&quot;))
receive: S(p1: &quot;1&quot;, p2: &quot;one&quot;)
ps1: receive error: (aE)
completion: failure(戴铭的开发小册子.AppDelegate.(unknown context at $10b15ce10).(unknown context at $10b15cf3c).CError.aE)
ps2 sb1: receive subscription: (PassthroughSubject)
ps2 sb1: request unlimited
ps2 sb1: receive value: (three)
three
ps2 sb2: receive subscription: (PassthroughSubject)
ps2 sb2: request unlimited
ps2 sb1: receive value: (four)
four
ps2 sb2: receive value: (four)
four
ps2 sb1: receive finished
ps2 sb2: receive finished<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="Empty"><a href="#Empty" class="headerlink" title="Empty"></a>Empty</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">Combine</span>

<span class="token keyword">var</span> cc <span class="token operator">=</span> <span class="token class-name">Set</span><span class="token operator">&lt;</span><span class="token class-name">AnyCancellable</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">struct</span> <span class="token class-name">S</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> p1<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">let</span> p2<span class="token punctuation">:</span> <span class="token class-name">String</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> ept <span class="token operator">=</span> <span class="token class-name">Empty</span><span class="token operator">&lt;</span><span class="token class-name">S</span><span class="token punctuation">,</span> <span class="token class-name">Never</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 加上 completeImmediately: false 后面即使用 replaceEmpty 也不会接受值</span>
ept
    <span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"ept"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>sink <span class="token punctuation">&#123;</span> c <span class="token keyword">in</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"completion:"</span></span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span> receiveValue<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span> s <span class="token keyword">in</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"receive:"</span></span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span>cc<span class="token punctuation">)</span>

ept<span class="token punctuation">.</span><span class="token function">replaceEmpty</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> <span class="token class-name">S</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"1"</span></span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>sink <span class="token punctuation">&#123;</span> c <span class="token keyword">in</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"completion:"</span></span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span> receiveValue<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span> s <span class="token keyword">in</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"receive:"</span></span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span>cc<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>输出</p>
<pre class="line-numbers language-none"><code class="language-none">ept: receive subscription: (Empty)
ept: request unlimited
ept: receive finished
completion: finished
receive: S(p1: &quot;1&quot;, p2: &quot;one&quot;)
completion: finished<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="CurrentValueSubject"><a href="#CurrentValueSubject" class="headerlink" title="CurrentValueSubject"></a>CurrentValueSubject</h4><p>CurrentValueSubject 的订阅者可以收到订阅时已发出的那条数据</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">Combine</span>

<span class="token keyword">var</span> cc <span class="token operator">=</span> <span class="token class-name">Set</span><span class="token operator">&lt;</span><span class="token class-name">AnyCancellable</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> cs <span class="token operator">=</span> <span class="token class-name">CurrentValueSubject</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Never</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">)</span>
cs<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">)</span>
cs<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"three"</span></span><span class="token punctuation">)</span>
<span class="token keyword">let</span> sb1 <span class="token operator">=</span> cs
    <span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"cs sb1"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>sink <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token short-argument">$0</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    
cs<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"four"</span></span><span class="token punctuation">)</span>
cs<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"five"</span></span><span class="token punctuation">)</span>

<span class="token keyword">let</span> sb2 <span class="token operator">=</span> cs
    <span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"cs sb2"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>sink <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token short-argument">$0</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>

cs<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"six"</span></span><span class="token punctuation">)</span>

sb1<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span>cc<span class="token punctuation">)</span>
sb2<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span>cc<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>输出</p>
<pre class="line-numbers language-none"><code class="language-none">cs sb1: receive subscription: (CurrentValueSubject)
cs sb1: request unlimited
cs sb1: receive value: (three)
three
cs sb1: receive value: (four)
four
cs sb1: receive value: (five)
five
cs sb2: receive subscription: (CurrentValueSubject)
cs sb2: request unlimited
cs sb2: receive value: (five)
five
cs sb1: receive value: (six)
six
cs sb2: receive value: (six)
six
cs sb1: receive cancel
cs sb2: receive cancel<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="removeDuplicates"><a href="#removeDuplicates" class="headerlink" title="removeDuplicates"></a>removeDuplicates</h4><p>使用 removeDuplicates，重复的值就不会发送了。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">Combine</span>

<span class="token keyword">var</span> cc <span class="token operator">=</span> <span class="token class-name">Set</span><span class="token operator">&lt;</span><span class="token class-name">AnyCancellable</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> pb <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span><span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">,</span><span class="token string-literal"><span class="token string">"three"</span></span><span class="token punctuation">,</span><span class="token string-literal"><span class="token string">"three"</span></span><span class="token punctuation">,</span><span class="token string-literal"><span class="token string">"four"</span></span><span class="token punctuation">]</span>
    <span class="token punctuation">.</span>publisher

<span class="token keyword">let</span> sb <span class="token operator">=</span> pb
    <span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"sb"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">removeDuplicates</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>sink <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token short-argument">$0</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    
sb<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span>cc<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>输出</p>
<pre class="line-numbers language-none"><code class="language-none">sb: receive subscription: ([&quot;one&quot;, &quot;two&quot;, &quot;three&quot;, &quot;three&quot;, &quot;four&quot;])
sb: request unlimited
sb: receive value: (one)
one
sb: receive value: (two)
two
sb: receive value: (three)
three
sb: receive value: (three)
sb: request max: (1) (synchronous)
sb: receive value: (four)
four
sb: receive finished<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="flatMap"><a href="#flatMap" class="headerlink" title="flatMap"></a>flatMap</h4><p>flatMap 能将多个发布者的值打平发送给订阅者</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">Combine</span>

<span class="token keyword">var</span> cc <span class="token operator">=</span> <span class="token class-name">Set</span><span class="token operator">&lt;</span><span class="token class-name">AnyCancellable</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">struct</span> <span class="token class-name">S</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> p<span class="token punctuation">:</span> <span class="token class-name">AnyPublisher</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Never</span><span class="token operator">></span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token class-name">S</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token class-name">Just</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eraseToAnyPublisher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token class-name">S</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token class-name">Just</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eraseToAnyPublisher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> s3 <span class="token operator">=</span> <span class="token class-name">S</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token class-name">Just</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"three"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eraseToAnyPublisher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> pb <span class="token operator">=</span> <span class="token punctuation">[</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> s3<span class="token punctuation">]</span><span class="token punctuation">.</span>publisher
    
<span class="token keyword">let</span> sb <span class="token operator">=</span> pb
    <span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"sb"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>flatMap <span class="token punctuation">&#123;</span>
        <span class="token short-argument">$0</span><span class="token punctuation">.</span>p
    <span class="token punctuation">&#125;</span>
    <span class="token punctuation">.</span>sink <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token short-argument">$0</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>

sb<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span>cc<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>输出</p>
<pre class="line-numbers language-none"><code class="language-none">sb: receive subscription: ([戴铭的开发小册子.AppDelegate.(unknown context at $101167070).(unknown context at $1011670f4).S(p: AnyPublisher), 戴铭的开发小册子.AppDelegate.(unknown context at $101167070).(unknown context at $1011670f4).S(p: AnyPublisher), 戴铭的开发小册子.AppDelegate.(unknown context at $101167070).(unknown context at $1011670f4).S(p: AnyPublisher)])
sb: request unlimited
sb: receive value: (S(p: AnyPublisher))
one
sb: receive value: (S(p: AnyPublisher))
two
sb: receive value: (S(p: AnyPublisher))
three
sb: receive finished<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="append"><a href="#append" class="headerlink" title="append"></a>append</h4><p>append 会在发布者发布结束后追加发送数据，发布者不结束，append 的数据不会发送。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">Combine</span>

<span class="token keyword">var</span> cc <span class="token operator">=</span> <span class="token class-name">Set</span><span class="token operator">&lt;</span><span class="token class-name">AnyCancellable</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> pb <span class="token operator">=</span> <span class="token class-name">PassthroughSubject</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Never</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> sb <span class="token operator">=</span> pb
    <span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"sb"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"five"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"six"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>sink <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token short-argument">$0</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>

sb<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span>cc<span class="token punctuation">)</span>

pb<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">)</span>
pb<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">)</span>
pb<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"three"</span></span><span class="token punctuation">)</span>
pb<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>completion<span class="token punctuation">:</span> <span class="token punctuation">.</span>finished<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>输出</p>
<pre class="line-numbers language-none"><code class="language-none">sb: receive subscription: ([戴铭的开发小册子.AppDelegate.(unknown context at $101167070).(unknown context at $1011670f4).S(p: AnyPublisher), 戴铭的开发小册子.AppDelegate.(unknown context at $101167070).(unknown context at $1011670f4).S(p: AnyPublisher), 戴铭的开发小册子.AppDelegate.(unknown context at $101167070).(unknown context at $1011670f4).S(p: AnyPublisher)])
sb: request unlimited
sb: receive value: (S(p: AnyPublisher))
one
sb: receive value: (S(p: AnyPublisher))
two
sb: receive value: (S(p: AnyPublisher))
three
sb: receive finished<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="prepend"><a href="#prepend" class="headerlink" title="prepend"></a>prepend</h4><p>prepend 会在发布者发布前先发送数据，发布者不结束也不会受影响。发布者和集合也可以被打平发布。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">Combine</span>

<span class="token keyword">var</span> cc <span class="token operator">=</span> <span class="token class-name">Set</span><span class="token operator">&lt;</span><span class="token class-name">AnyCancellable</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> pb1 <span class="token operator">=</span> <span class="token class-name">PassthroughSubject</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Never</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> pb2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"nine"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"ten"</span></span><span class="token punctuation">]</span><span class="token punctuation">.</span>publisher

<span class="token keyword">let</span> sb <span class="token operator">=</span> pb1
    <span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"sb"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">prepend</span><span class="token punctuation">(</span>pb2<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">prepend</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"seven"</span></span><span class="token punctuation">,</span><span class="token string-literal"><span class="token string">"eight"</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">prepend</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"five"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"six"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>sink <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token short-argument">$0</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>

sb<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span>cc<span class="token punctuation">)</span>

pb1<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">)</span>
pb1<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">)</span>
pb1<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"three"</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>输出</p>
<pre class="line-numbers language-none"><code class="language-none">five
six
seven
eight
nine
ten
sb: receive subscription: (PassthroughSubject)
sb: request unlimited
sb: receive value: (one)
one
sb: receive value: (two)
two
sb: receive value: (three)
three
sb: receive cancel<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="merge"><a href="#merge" class="headerlink" title="merge"></a>merge</h4><p>订阅者可以通过 merge 合并多个发布者发布的数据</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">Combine</span>

<span class="token keyword">var</span> cc <span class="token operator">=</span> <span class="token class-name">Set</span><span class="token operator">&lt;</span><span class="token class-name">AnyCancellable</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> ps1 <span class="token operator">=</span> <span class="token class-name">PassthroughSubject</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Never</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> ps2 <span class="token operator">=</span> <span class="token class-name">PassthroughSubject</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Never</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> sb1 <span class="token operator">=</span> ps1<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> ps2<span class="token punctuation">)</span>
    <span class="token punctuation">.</span>sink <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token short-argument">$0</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    
ps1<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">)</span>
ps1<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">)</span>
ps2<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"1"</span></span><span class="token punctuation">)</span>
ps2<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"2"</span></span><span class="token punctuation">)</span>
ps1<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"three"</span></span><span class="token punctuation">)</span>

sb1<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span>cc<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>输出</p>
<pre class="line-numbers language-none"><code class="language-none">sb1: receive subscription: (Merge)
sb1: request unlimited
sb1: receive value: (one)
one
sb1: receive value: (two)
two
sb1: receive value: (1)
1
sb1: receive value: (2)
2
sb1: receive value: (three)
three
sb1: receive cancel<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="zip"><a href="#zip" class="headerlink" title="zip"></a>zip</h4><p>zip 会合并多个发布者发布的数据，只有当多个发布者都发布了数据后才会组合成一个数据给订阅者。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">Combine</span>

<span class="token keyword">var</span> cc <span class="token operator">=</span> <span class="token class-name">Set</span><span class="token operator">&lt;</span><span class="token class-name">AnyCancellable</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> ps1 <span class="token operator">=</span> <span class="token class-name">PassthroughSubject</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Never</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> ps2 <span class="token operator">=</span> <span class="token class-name">PassthroughSubject</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Never</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> ps3 <span class="token operator">=</span> <span class="token class-name">PassthroughSubject</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Never</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> sb1 <span class="token operator">=</span> ps1<span class="token punctuation">.</span><span class="token function">zip</span><span class="token punctuation">(</span>ps2<span class="token punctuation">,</span> ps3<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"sb1"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>sink <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token short-argument">$0</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    
ps1<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">)</span>
ps1<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">)</span>
ps1<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"three"</span></span><span class="token punctuation">)</span>
ps2<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"1"</span></span><span class="token punctuation">)</span>
ps2<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"2"</span></span><span class="token punctuation">)</span>
ps1<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"four"</span></span><span class="token punctuation">)</span>
ps2<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"3"</span></span><span class="token punctuation">)</span>
ps3<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"一"</span></span><span class="token punctuation">)</span>

sb1<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span>cc<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>输出</p>
<pre class="line-numbers language-none"><code class="language-none">sb1: receive subscription: (Zip)
sb1: request unlimited
sb1: receive value: ((&quot;one&quot;, &quot;1&quot;, &quot;一&quot;))
(&quot;one&quot;, &quot;1&quot;, &quot;一&quot;)
sb1: receive cancel<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="combineLatest"><a href="#combineLatest" class="headerlink" title="combineLatest"></a>combineLatest</h4><p>combineLatest 会合并多个发布者发布的数据，只有当多个发布者都发布了数据后才会触发合并，合并每个发布者发布的最后一个数据。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">Combine</span>

<span class="token keyword">var</span> cc <span class="token operator">=</span> <span class="token class-name">Set</span><span class="token operator">&lt;</span><span class="token class-name">AnyCancellable</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        
<span class="token keyword">let</span> ps1 <span class="token operator">=</span> <span class="token class-name">PassthroughSubject</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Never</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> ps2 <span class="token operator">=</span> <span class="token class-name">PassthroughSubject</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Never</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> ps3 <span class="token operator">=</span> <span class="token class-name">PassthroughSubject</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Never</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> sb1 <span class="token operator">=</span> ps1<span class="token punctuation">.</span><span class="token function">combineLatest</span><span class="token punctuation">(</span>ps2<span class="token punctuation">,</span> ps3<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"sb1"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>sink <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token short-argument">$0</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    
ps1<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">)</span>
ps1<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">)</span>
ps1<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"three"</span></span><span class="token punctuation">)</span>
ps2<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"1"</span></span><span class="token punctuation">)</span>
ps2<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"2"</span></span><span class="token punctuation">)</span>
ps1<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"four"</span></span><span class="token punctuation">)</span>
ps2<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"3"</span></span><span class="token punctuation">)</span>
ps3<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"一"</span></span><span class="token punctuation">)</span>
ps3<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"二"</span></span><span class="token punctuation">)</span>

sb1<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span>cc<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>输出</p>
<pre class="line-numbers language-none"><code class="language-none">sb1: receive subscription: (CombineLatest)
sb1: request unlimited
sb1: receive value: ((&quot;four&quot;, &quot;3&quot;, &quot;一&quot;))
(&quot;four&quot;, &quot;3&quot;, &quot;一&quot;)
sb1: receive value: ((&quot;four&quot;, &quot;3&quot;, &quot;二&quot;))
(&quot;four&quot;, &quot;3&quot;, &quot;二&quot;)
sb1: receive cancel<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="Scheduler"><a href="#Scheduler" class="headerlink" title="Scheduler"></a>Scheduler</h4><p>Scheduler 处理队列。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">Combine</span>

<span class="token keyword">var</span> cc <span class="token operator">=</span> <span class="token class-name">Set</span><span class="token operator">&lt;</span><span class="token class-name">AnyCancellable</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        
<span class="token keyword">let</span> sb1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span><span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">,</span><span class="token string-literal"><span class="token string">"three"</span></span><span class="token punctuation">]</span><span class="token punctuation">.</span>publisher
    <span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"sb1"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>on<span class="token punctuation">:</span> <span class="token class-name">DispatchQueue</span><span class="token punctuation">.</span><span class="token function">global</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">handleEvents</span><span class="token punctuation">(</span>receiveOutput<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"receiveOutput"</span></span><span class="token punctuation">,</span><span class="token short-argument">$0</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span>on<span class="token punctuation">:</span> <span class="token class-name">DispatchQueue</span><span class="token punctuation">.</span>main<span class="token punctuation">)</span>
    <span class="token punctuation">.</span>sink <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token short-argument">$0</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
sb1<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span>cc<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>输出</p>
<pre class="line-numbers language-none"><code class="language-none">sb1: receive subscription: ([1, 2, 3])
sb1: request unlimited
sb1: receive value: (1)
receiveOutput 1
sb1: receive value: (2)
receiveOutput 2
sb1: receive value: (3)
receiveOutput 3
sb1: receive finished
1
2
3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><h4 id="网络请求"><a href="#网络请求" class="headerlink" title="网络请求"></a>网络请求</h4><p>网络URLSession.dataTaskPublisher使用例子如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> req <span class="token operator">=</span> <span class="token class-name">URLRequest</span><span class="token punctuation">(</span>url<span class="token punctuation">:</span> <span class="token function">URL</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"http://www.starming.com"</span></span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> dpPublisher <span class="token operator">=</span> <span class="token class-name">URLSession</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token function">dataTaskPublisher</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> req<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>一个请求Github接口并展示结果的例子</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">//</span>
<span class="token comment">// CombineSearchAPI.swift</span>
<span class="token comment">// SwiftOnly (iOS)</span>
<span class="token comment">//</span>
<span class="token comment">// Created by Ming Dai on 2021/11/4.</span>
<span class="token comment">//</span>

<span class="token keyword">import</span> <span class="token class-name">SwiftUI</span>
<span class="token keyword">import</span> <span class="token class-name">Combine</span>

<span class="token keyword">struct</span> <span class="token class-name">CombineSearchAPI</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">GithubSearchView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// MARK: Github View</span>
<span class="token keyword">struct</span> <span class="token class-name">GithubSearchView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
  <span class="token attribute atrule">@State</span> <span class="token keyword">var</span> str<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"Swift"</span></span>
  <span class="token attribute atrule">@StateObject</span> <span class="token keyword">var</span> ss<span class="token punctuation">:</span> <span class="token class-name">SearchStore</span> <span class="token operator">=</span> <span class="token class-name">SearchStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token attribute atrule">@State</span> <span class="token keyword">var</span> repos<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">GithubRepo</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">NavigationView</span> <span class="token punctuation">&#123;</span>
      <span class="token class-name">List</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">TextField</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"输入："</span></span><span class="token punctuation">,</span> text<span class="token punctuation">:</span> $str<span class="token punctuation">,</span> onCommit<span class="token punctuation">:</span> fetch<span class="token punctuation">)</span>
        <span class="token class-name">ForEach</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>ss<span class="token punctuation">.</span>repos<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> repo <span class="token operator">-></span> <span class="token class-name">GithubRepoCell</span> <span class="token keyword">in</span>
          <span class="token class-name">GithubRepoCell</span><span class="token punctuation">(</span>repo<span class="token punctuation">:</span> repo<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
      <span class="token punctuation">.</span><span class="token function">navigationTitle</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"搜索"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token punctuation">.</span><span class="token function">onAppear</span><span class="token punctuation">(</span>perform<span class="token punctuation">:</span> fetch<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
   
  <span class="token keyword">private</span> <span class="token keyword">func</span> <span class="token function-definition function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>ss<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>str<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>str<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">struct</span> <span class="token class-name">GithubRepoCell</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> repo<span class="token punctuation">:</span> <span class="token class-name">GithubRepo</span>
  <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">VStack</span><span class="token punctuation">(</span>alignment<span class="token punctuation">:</span> <span class="token punctuation">.</span>leading<span class="token punctuation">,</span> spacing<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>repo<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
      <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>repo<span class="token punctuation">.</span>description<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// MARK: Github Service</span>
<span class="token keyword">struct</span> <span class="token class-name">GithubRepo</span><span class="token punctuation">:</span> <span class="token class-name">Decodable</span><span class="token punctuation">,</span> <span class="token class-name">Identifiable</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> id<span class="token punctuation">:</span> <span class="token class-name">Int</span>
  <span class="token keyword">let</span> name<span class="token punctuation">:</span> <span class="token class-name">String</span>
  <span class="token keyword">let</span> description<span class="token punctuation">:</span> <span class="token class-name">String</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">struct</span> <span class="token class-name">GithubResp</span><span class="token punctuation">:</span> <span class="token class-name">Decodable</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> items<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">GithubRepo</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">GithubSearchManager</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">func</span> <span class="token function-definition function">search</span><span class="token punctuation">(</span>str<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">AnyPublisher</span><span class="token operator">&lt;</span><span class="token class-name">GithubResp</span><span class="token punctuation">,</span> <span class="token class-name">Never</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">guard</span> <span class="token keyword">var</span> urlComponents <span class="token operator">=</span> <span class="token class-name">URLComponents</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"https://api.github.com/search/repositories"</span></span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
      <span class="token function">preconditionFailure</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"链接无效"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    urlComponents<span class="token punctuation">.</span>queryItems <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">URLQueryItem</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"q"</span></span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> str<span class="token punctuation">)</span><span class="token punctuation">]</span>
     
    <span class="token keyword">guard</span> <span class="token keyword">let</span> url <span class="token operator">=</span> urlComponents<span class="token punctuation">.</span>url <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
      <span class="token function">preconditionFailure</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"链接无效"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">let</span> sch <span class="token operator">=</span> <span class="token class-name">DispatchQueue</span><span class="token punctuation">(</span>label<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"API"</span></span><span class="token punctuation">,</span> qos<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">,</span> attributes<span class="token punctuation">:</span> <span class="token punctuation">.</span>concurrent<span class="token punctuation">)</span>
     
    <span class="token keyword">return</span> <span class="token class-name">URLSession</span><span class="token punctuation">.</span>shared
      <span class="token punctuation">.</span><span class="token function">dataTaskPublisher</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> url<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span>on<span class="token punctuation">:</span> sch<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">tryMap</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> element <span class="token operator">-></span> <span class="token class-name">Data</span> <span class="token keyword">in</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">(</span>decoding<span class="token punctuation">:</span> element<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token punctuation">:</span> UTF8<span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> element<span class="token punctuation">.</span>data
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>type<span class="token punctuation">:</span> <span class="token class-name">GithubResp</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">,</span> decoder<span class="token punctuation">:</span> <span class="token class-name">JSONDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token keyword">catch</span> <span class="token punctuation">&#123;</span> <span class="token omit keyword">_</span> <span class="token keyword">in</span>
        <span class="token class-name">Empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eraseToAnyPublisher</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span>
      <span class="token punctuation">.</span><span class="token function">eraseToAnyPublisher</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">SearchStore</span><span class="token punctuation">:</span> <span class="token class-name">ObservableObject</span> <span class="token punctuation">&#123;</span>
  <span class="token attribute atrule">@Published</span> <span class="token keyword">var</span> query<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span>
  <span class="token attribute atrule">@Published</span> <span class="token keyword">var</span> repos<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">GithubRepo</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">private</span> <span class="token keyword">let</span> searchManager<span class="token punctuation">:</span> <span class="token class-name">GithubSearchManager</span>
  <span class="token keyword">private</span> <span class="token keyword">var</span> cancellable <span class="token operator">=</span> <span class="token class-name">Set</span><span class="token operator">&lt;</span><span class="token class-name">AnyCancellable</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   
  <span class="token keyword">init</span><span class="token punctuation">(</span>searchManager<span class="token punctuation">:</span> <span class="token class-name">GithubSearchManager</span> <span class="token operator">=</span> <span class="token class-name">GithubSearchManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>searchManager <span class="token operator">=</span> searchManager
    $query
      <span class="token punctuation">.</span><span class="token function">debounce</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">milliseconds</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">,</span> scheduler<span class="token punctuation">:</span> <span class="token class-name">RunLoop</span><span class="token punctuation">.</span>main<span class="token punctuation">)</span>
      <span class="token punctuation">.</span>flatMap <span class="token punctuation">&#123;</span> query <span class="token operator">-></span> <span class="token class-name">AnyPublisher</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token class-name">GithubRepo</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token class-name">Never</span><span class="token operator">></span> <span class="token keyword">in</span>
        <span class="token keyword">return</span> searchManager<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>str<span class="token punctuation">:</span> query<span class="token punctuation">)</span>
          <span class="token punctuation">.</span>map <span class="token punctuation">&#123;</span>
            <span class="token short-argument">$0</span><span class="token punctuation">.</span>items
          <span class="token punctuation">&#125;</span>
          <span class="token punctuation">.</span><span class="token function">eraseToAnyPublisher</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span>
      <span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span>on<span class="token punctuation">:</span> <span class="token class-name">DispatchQueue</span><span class="token punctuation">.</span>main<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>to<span class="token punctuation">:</span> <span class="token punctuation">\</span><span class="token punctuation">.</span>repos<span class="token punctuation">,</span> on<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span>cancellable<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">func</span> <span class="token function-definition function">search</span><span class="token punctuation">(</span>str<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>query <span class="token operator">=</span> str
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>抽象基础网络能力，方便扩展，代码如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">//</span>
<span class="token comment">// CombineAPI.swift</span>
<span class="token comment">// SwiftOnly (iOS)</span>
<span class="token comment">//</span>
<span class="token comment">// Created by Ming Dai on 2021/11/4.</span>
<span class="token comment">//</span>

<span class="token keyword">import</span> <span class="token class-name">SwiftUI</span>
<span class="token keyword">import</span> <span class="token class-name">Combine</span>

<span class="token keyword">struct</span> <span class="token class-name">CombineAPI</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">RepListView</span><span class="token punctuation">(</span>vm<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">struct</span> <span class="token class-name">RepListView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
  <span class="token attribute atrule">@ObservedObject</span> <span class="token keyword">var</span> vm<span class="token punctuation">:</span> <span class="token class-name">RepListVM</span>
   
  <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">NavigationView</span> <span class="token punctuation">&#123;</span>
      <span class="token class-name">List</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>repos<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> rep <span class="token keyword">in</span>
        <span class="token class-name">RepListCell</span><span class="token punctuation">(</span>rep<span class="token punctuation">:</span> rep<span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span>
      <span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span>isPresented<span class="token punctuation">:</span> $vm<span class="token punctuation">.</span>isErrorShow<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Alert</span> <span class="token keyword">in</span>
        <span class="token class-name">Alert</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"出错了"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token class-name">Text</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>errorMessage<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span>
      <span class="token punctuation">.</span><span class="token function">navigationBarTitle</span><span class="token punctuation">(</span><span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"仓库"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token punctuation">.</span>onAppear <span class="token punctuation">&#123;</span>
      vm<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">.</span>onAppear<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">struct</span> <span class="token class-name">RepListCell</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
  <span class="token attribute atrule">@State</span> <span class="token keyword">var</span> rep<span class="token punctuation">:</span> <span class="token class-name">RepoModel</span>
  <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">HStack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token class-name">VStack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">AsyncImage</span><span class="token punctuation">(</span>url<span class="token punctuation">:</span> <span class="token function">URL</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> rep<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>avatarUrl <span class="token operator">??</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> content<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span> image <span class="token keyword">in</span>
          image
            <span class="token punctuation">.</span><span class="token function">resizable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">aspectRatio</span><span class="token punctuation">(</span>contentMode<span class="token punctuation">:</span> <span class="token punctuation">.</span>fit<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        placeholder<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
          <span class="token class-name">ProgressView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">rep<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>login</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">system</span><span class="token punctuation">(</span>size<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span>
      <span class="token class-name">VStack</span><span class="token punctuation">(</span>alignment<span class="token punctuation">:</span> <span class="token punctuation">.</span>leading<span class="token punctuation">,</span> spacing<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">rep<span class="token punctuation">.</span>name</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>title<span class="token punctuation">)</span>
        <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">rep<span class="token punctuation">.</span>stargazersCount</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>title3<span class="token punctuation">)</span>
        <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation"><span class="token class-name">String</span><span class="token punctuation">(</span>describing<span class="token punctuation">:</span> rep<span class="token punctuation">.</span>description <span class="token operator">??</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation"><span class="token class-name">String</span><span class="token punctuation">(</span>describing<span class="token punctuation">:</span> rep<span class="token punctuation">.</span>language <span class="token operator">??</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>title3<span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span>
      <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">system</span><span class="token punctuation">(</span>size<span class="token punctuation">:</span> <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
     
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>


<span class="token comment">// MARK: Repo View Model</span>
<span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">RepListVM</span><span class="token punctuation">:</span> <span class="token class-name">ObservableObject</span><span class="token punctuation">,</span> <span class="token class-name">UnidirectionalDataFlowType</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">typealias</span> <span class="token class-name">InputType</span> <span class="token operator">=</span> <span class="token class-name">Input</span>
  <span class="token keyword">private</span> <span class="token keyword">var</span> cancellables<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">AnyCancellable</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
   
  <span class="token comment">// Input</span>
  <span class="token keyword">enum</span> <span class="token class-name">Input</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> onAppear
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">func</span> <span class="token function-definition function">apply</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> input<span class="token punctuation">:</span> <span class="token class-name">Input</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">switch</span> input <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token punctuation">.</span>onAppear<span class="token punctuation">:</span>
      onAppearSubject<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">private</span> <span class="token keyword">let</span> onAppearSubject <span class="token operator">=</span> <span class="token class-name">PassthroughSubject</span><span class="token operator">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">,</span> <span class="token class-name">Never</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   
  <span class="token comment">// Output</span>
  <span class="token attribute atrule">@Published</span> <span class="token keyword">private</span><span class="token punctuation">(</span><span class="token keyword">set</span><span class="token punctuation">)</span> <span class="token keyword">var</span> repos<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">RepoModel</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token attribute atrule">@Published</span> <span class="token keyword">var</span> isErrorShow <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token attribute atrule">@Published</span> <span class="token keyword">var</span> errorMessage <span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span>
  <span class="token attribute atrule">@Published</span> <span class="token keyword">private</span><span class="token punctuation">(</span><span class="token keyword">set</span><span class="token punctuation">)</span> <span class="token keyword">var</span> shouldShowIcon <span class="token operator">=</span> <span class="token boolean">false</span>
   
  <span class="token keyword">private</span> <span class="token keyword">let</span> resSubject <span class="token operator">=</span> <span class="token class-name">PassthroughSubject</span><span class="token operator">&lt;</span><span class="token class-name">SearchRepoModel</span><span class="token punctuation">,</span> <span class="token class-name">Never</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">private</span> <span class="token keyword">let</span> errSubject <span class="token operator">=</span> <span class="token class-name">PassthroughSubject</span><span class="token operator">&lt;</span><span class="token class-name">APISevError</span><span class="token punctuation">,</span> <span class="token class-name">Never</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   
  <span class="token keyword">private</span> <span class="token keyword">let</span> apiSev<span class="token punctuation">:</span> <span class="token class-name">APISev</span>
   
  <span class="token keyword">init</span><span class="token punctuation">(</span>apiSev<span class="token punctuation">:</span> <span class="token class-name">APISev</span> <span class="token operator">=</span> <span class="token class-name">APISev</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>apiSev <span class="token operator">=</span> apiSev
    <span class="token function">bindInputs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">bindOutputs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
   
  <span class="token keyword">private</span> <span class="token keyword">func</span> <span class="token function-definition function">bindInputs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> req <span class="token operator">=</span> <span class="token class-name">SearchRepoRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> resPublisher <span class="token operator">=</span> onAppearSubject
      <span class="token punctuation">.</span>flatMap <span class="token punctuation">&#123;</span> <span class="token punctuation">[</span>apiSev<span class="token punctuation">]</span> <span class="token keyword">in</span>
        apiSev<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> req<span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token keyword">catch</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">[</span><span class="token keyword">weak</span> <span class="token keyword">self</span><span class="token punctuation">]</span> error <span class="token operator">-></span> <span class="token class-name">Empty</span><span class="token operator">&lt;</span><span class="token class-name">SearchRepoModel</span><span class="token punctuation">,</span> <span class="token class-name">Never</span><span class="token operator">></span> <span class="token keyword">in</span>
            <span class="token keyword">self</span><span class="token operator">?</span><span class="token punctuation">.</span>errSubject<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token keyword">let</span> resStream <span class="token operator">=</span> resPublisher
      <span class="token punctuation">.</span><span class="token function">share</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>resSubject<span class="token punctuation">)</span>
     
    <span class="token comment">// 其它异步事件，比如日志等操作都可以做成Stream加到下面数组内。</span>
    cancellables <span class="token operator">+=</span> <span class="token punctuation">[</span>resStream<span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
   
  <span class="token keyword">private</span> <span class="token keyword">func</span> <span class="token function-definition function">bindOutputs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> repStream <span class="token operator">=</span> resSubject
      <span class="token punctuation">.</span>map <span class="token punctuation">&#123;</span>
        <span class="token short-argument">$0</span><span class="token punctuation">.</span>items
      <span class="token punctuation">&#125;</span>
      <span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>to<span class="token punctuation">:</span> <span class="token punctuation">\</span><span class="token punctuation">.</span>repos<span class="token punctuation">,</span> on<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> errMsgStream <span class="token operator">=</span> errSubject
      <span class="token punctuation">.</span>map <span class="token punctuation">&#123;</span> error <span class="token operator">-></span> <span class="token class-name">String</span> <span class="token keyword">in</span>
        <span class="token keyword">switch</span> error <span class="token punctuation">&#123;</span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span>resError<span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">"network error"</span></span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span>parseError<span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">"parse error"</span></span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
      <span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>to<span class="token punctuation">:</span> <span class="token punctuation">\</span><span class="token punctuation">.</span>errorMessage<span class="token punctuation">,</span> on<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> errStream <span class="token operator">=</span> errSubject
      <span class="token punctuation">.</span>map <span class="token punctuation">&#123;</span> <span class="token omit keyword">_</span> <span class="token keyword">in</span>
        <span class="token boolean">true</span>
      <span class="token punctuation">&#125;</span>
      <span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>to<span class="token punctuation">:</span> <span class="token punctuation">\</span><span class="token punctuation">.</span>isErrorShow<span class="token punctuation">,</span> on<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">)</span>
    cancellables <span class="token operator">+=</span> <span class="token punctuation">[</span>repStream<span class="token punctuation">,</span>errStream<span class="token punctuation">,</span>errMsgStream<span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
   
<span class="token punctuation">&#125;</span>


<span class="token keyword">protocol</span> <span class="token class-name">UnidirectionalDataFlowType</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">associatedtype</span> <span class="token class-name">InputType</span>
  <span class="token keyword">func</span> <span class="token function-definition function">apply</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> input<span class="token punctuation">:</span> <span class="token class-name">InputType</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// MARK: Repo Request and Models</span>

<span class="token keyword">struct</span> <span class="token class-name">SearchRepoRequest</span><span class="token punctuation">:</span> <span class="token class-name">APIReqType</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">typealias</span> <span class="token class-name">Res</span> <span class="token operator">=</span> <span class="token class-name">SearchRepoModel</span>
   
  <span class="token keyword">var</span> path<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">"/search/repositories"</span></span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">var</span> qItems<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">URLQueryItem</span><span class="token punctuation">]</span><span class="token operator">?</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
      <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"q"</span></span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Combine"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"order"</span></span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"desc"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">struct</span> <span class="token class-name">SearchRepoModel</span><span class="token punctuation">:</span> <span class="token class-name">Decodable</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> items<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">RepoModel</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">struct</span> <span class="token class-name">RepoModel</span><span class="token punctuation">:</span> <span class="token class-name">Decodable</span><span class="token punctuation">,</span> <span class="token class-name">Hashable</span><span class="token punctuation">,</span> <span class="token class-name">Identifiable</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> id<span class="token punctuation">:</span> <span class="token class-name">Int64</span>
  <span class="token keyword">var</span> name<span class="token punctuation">:</span> <span class="token class-name">String</span>
  <span class="token keyword">var</span> fullName<span class="token punctuation">:</span> <span class="token class-name">String</span>
  <span class="token keyword">var</span> description<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token operator">?</span>
  <span class="token keyword">var</span> stargazersCount<span class="token punctuation">:</span> <span class="token class-name">Int</span> <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">var</span> language<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token operator">?</span>
  <span class="token keyword">var</span> owner<span class="token punctuation">:</span> <span class="token class-name">OwnerModel</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">struct</span> <span class="token class-name">OwnerModel</span><span class="token punctuation">:</span> <span class="token class-name">Decodable</span><span class="token punctuation">,</span> <span class="token class-name">Hashable</span><span class="token punctuation">,</span> <span class="token class-name">Identifiable</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> id<span class="token punctuation">:</span> <span class="token class-name">Int64</span>
  <span class="token keyword">var</span> login<span class="token punctuation">:</span> <span class="token class-name">String</span>
  <span class="token keyword">var</span> avatarUrl<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token operator">?</span>
<span class="token punctuation">&#125;</span>


<span class="token comment">// MARK: API Request Fundation</span>

<span class="token keyword">protocol</span> <span class="token class-name">APIReqType</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">associatedtype</span> <span class="token class-name">Res</span><span class="token punctuation">:</span> <span class="token class-name">Decodable</span>
  <span class="token keyword">var</span> path<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span> <span class="token keyword">get</span> <span class="token punctuation">&#125;</span>
  <span class="token keyword">var</span> qItems<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">URLQueryItem</span><span class="token punctuation">]</span><span class="token operator">?</span> <span class="token punctuation">&#123;</span> <span class="token keyword">get</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">protocol</span> <span class="token class-name">APISevType</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">func</span> <span class="token function-definition function">response</span><span class="token operator">&lt;</span><span class="token class-name">Request</span><span class="token operator">></span><span class="token punctuation">(</span>from req<span class="token punctuation">:</span> <span class="token class-name">Request</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">AnyPublisher</span><span class="token operator">&lt;</span><span class="token class-name">Request</span><span class="token punctuation">.</span><span class="token class-name">Res</span><span class="token punctuation">,</span> <span class="token class-name">APISevError</span><span class="token operator">></span> <span class="token keyword">where</span> <span class="token class-name">Request</span><span class="token punctuation">:</span> <span class="token class-name">APIReqType</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">APISev</span><span class="token punctuation">:</span> <span class="token class-name">APISevType</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">private</span> <span class="token keyword">let</span> rootUrl<span class="token punctuation">:</span> <span class="token constant">URL</span>
  <span class="token keyword">init</span><span class="token punctuation">(</span>rootUrl<span class="token punctuation">:</span> <span class="token constant">URL</span> <span class="token operator">=</span> <span class="token function">URL</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"https://api.github.com"</span></span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>rootUrl <span class="token operator">=</span> rootUrl
  <span class="token punctuation">&#125;</span>
   
  <span class="token keyword">func</span> <span class="token function-definition function">response</span><span class="token operator">&lt;</span><span class="token class-name">Request</span><span class="token operator">></span><span class="token punctuation">(</span>from req<span class="token punctuation">:</span> <span class="token class-name">Request</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">AnyPublisher</span><span class="token operator">&lt;</span><span class="token class-name">Request</span><span class="token punctuation">.</span><span class="token class-name">Res</span><span class="token punctuation">,</span> <span class="token class-name">APISevError</span><span class="token operator">></span> <span class="token keyword">where</span> <span class="token class-name">Request</span> <span class="token punctuation">:</span> <span class="token class-name">APIReqType</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> path <span class="token operator">=</span> <span class="token function">URL</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> req<span class="token punctuation">.</span>path<span class="token punctuation">,</span> relativeTo<span class="token punctuation">:</span> rootUrl<span class="token punctuation">)</span><span class="token operator">!</span>
    <span class="token keyword">var</span> comp <span class="token operator">=</span> <span class="token class-name">URLComponents</span><span class="token punctuation">(</span>url<span class="token punctuation">:</span> path<span class="token punctuation">,</span> resolvingAgainstBaseURL<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token operator">!</span>
    comp<span class="token punctuation">.</span>queryItems <span class="token operator">=</span> req<span class="token punctuation">.</span>qItems
    <span class="token function">print</span><span class="token punctuation">(</span>comp<span class="token punctuation">.</span>url<span class="token operator">?</span><span class="token punctuation">.</span>description <span class="token operator">??</span> <span class="token string-literal"><span class="token string">"url wrong"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> req <span class="token operator">=</span> <span class="token class-name">URLRequest</span><span class="token punctuation">(</span>url<span class="token punctuation">:</span> comp<span class="token punctuation">.</span>url<span class="token operator">!</span><span class="token punctuation">)</span>
    req<span class="token punctuation">.</span><span class="token function">addValue</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"application/json"</span></span><span class="token punctuation">,</span> forHTTPHeaderField<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Content-Type"</span></span><span class="token punctuation">)</span>
     
    <span class="token keyword">let</span> de <span class="token operator">=</span> <span class="token class-name">JSONDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    de<span class="token punctuation">.</span>keyDecodingStrategy <span class="token operator">=</span> <span class="token punctuation">.</span>convertFromSnakeCase
    <span class="token keyword">return</span> <span class="token class-name">URLSession</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token function">dataTaskPublisher</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> req<span class="token punctuation">)</span>
      <span class="token punctuation">.</span>map <span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> res <span class="token keyword">in</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">(</span>decoding<span class="token punctuation">:</span> data<span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token punctuation">:</span> UTF8<span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> data
      <span class="token punctuation">&#125;</span>
      <span class="token punctuation">.</span>mapError <span class="token punctuation">&#123;</span> <span class="token omit keyword">_</span> <span class="token keyword">in</span>
        <span class="token class-name">APISevError</span><span class="token punctuation">.</span>resError
      <span class="token punctuation">&#125;</span>
      <span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>type<span class="token punctuation">:</span> <span class="token class-name">Request</span><span class="token punctuation">.</span><span class="token class-name">Res</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">,</span> decoder<span class="token punctuation">:</span> de<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">mapError</span><span class="token punctuation">(</span><span class="token class-name">APISevError</span><span class="token punctuation">.</span>parseError<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span>on<span class="token punctuation">:</span> <span class="token class-name">RunLoop</span><span class="token punctuation">.</span>main<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">eraseToAnyPublisher</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">enum</span> <span class="token class-name">APISevError</span><span class="token punctuation">:</span> <span class="token class-name">Error</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">case</span> resError
  <span class="token keyword">case</span> <span class="token function">parseError</span><span class="token punctuation">(</span><span class="token class-name">Error</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="KVO"><a href="#KVO" class="headerlink" title="KVO"></a>KVO</h4><p>例子如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">KVOObject</span><span class="token punctuation">:</span> <span class="token class-name">NSObject</span> <span class="token punctuation">&#123;</span>
  <span class="token attribute atrule">@objc</span> <span class="token keyword">dynamic</span> <span class="token keyword">var</span> intV<span class="token punctuation">:</span> <span class="token class-name">Int</span> <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token attribute atrule">@objc</span> <span class="token keyword">dynamic</span> <span class="token keyword">var</span> boolV<span class="token punctuation">:</span> <span class="token class-name">Bool</span> <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token class-name">KVOObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> <span class="token omit keyword">_</span> <span class="token operator">=</span> o<span class="token punctuation">.</span><span class="token function">publisher</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token punctuation">\</span><span class="token punctuation">.</span>intV<span class="token punctuation">)</span>
  <span class="token punctuation">.</span>sink <span class="token punctuation">&#123;</span> v <span class="token keyword">in</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"value : </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">v</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="通知"><a href="#通知" class="headerlink" title="通知"></a>通知</h4><p>使用例子如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">extension</span> <span class="token class-name">Notification</span><span class="token punctuation">.</span><span class="token class-name">Name</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">let</span> noti <span class="token operator">=</span> <span class="token class-name">Notification</span><span class="token punctuation">.</span><span class="token class-name">Name</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"nameofnoti"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> notiPb <span class="token operator">=</span> <span class="token class-name">NotificationCenter</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span><span class="token function">publisher</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>noti<span class="token punctuation">,</span> object<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>sink <span class="token punctuation">&#123;</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token short-argument">$0</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>退到后台接受通知的例子如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> storage <span class="token operator">=</span> <span class="token class-name">Set</span><span class="token operator">&lt;</span><span class="token class-name">AnyCancellable</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   
  <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">NotificationCenter</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span><span class="token function">publisher</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token class-name">UIWindowScene</span><span class="token punctuation">.</span>didEnterBackgroundNotification<span class="token punctuation">)</span>
      <span class="token punctuation">.</span>sink <span class="token punctuation">&#123;</span> <span class="token omit keyword">_</span> <span class="token keyword">in</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"enter background"</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span>
      <span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>storage<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="Timer"><a href="#Timer" class="headerlink" title="Timer"></a>Timer</h4><p>使用方式如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">let</span> timePb <span class="token operator">=</span> <span class="token class-name">Timer</span><span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>every<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> on<span class="token punctuation">:</span> <span class="token class-name">RunLoop</span><span class="token punctuation">.</span>main<span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> timeSk <span class="token operator">=</span> timePb<span class="token punctuation">.</span>sink <span class="token punctuation">&#123;</span> r <span class="token keyword">in</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"r is </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">r</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> cPb <span class="token operator">=</span> timePb<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h2 id="Concurrency"><a href="#Concurrency" class="headerlink" title="Concurrency"></a>Concurrency</h2><h3 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h3><h4 id="Swift-Concurrency-是什么？"><a href="#Swift-Concurrency-是什么？" class="headerlink" title="Swift Concurrency 是什么？"></a>Swift Concurrency 是什么？</h4><p>ABI 稳定后，Swift 的核心团队可以开始关注 Swift 语言一直缺失的原生并发能力了。最初是由 <a target="_blank" rel="noopener" href="https://twitter.com/clattner_llvm">Chris Lattner</a> 在17年发的 <a target="_blank" rel="noopener" href="https://gist.github.com/lattner/31ed37682ef1576b16bca1432ea9f782">Swift并发宣言</a> ，从此开阔了大家的眼界。后来 Swift Evolution 社区讨论了十几个提案，几十个方案，以及几百页的设计文件，做了大量的改进，社区中用户积极的参与反馈，Chris 也一直在 Evolution 中积极的参与设计。</p>
<p>Swift Concurrency 的实现用了 <a target="_blank" rel="noopener" href="https://llvm.org/docs/Coroutines.html">LLVM的协程</a> 把 async&#x2F;await 函数转换为基于回调的代码，这个过程发生在编译后期，这个阶段你的代码都没法辨识了。异步的函数被实现为 coroutines，在每次异步调用时，函数被分割成可调用的函数部分和后面恢复的部分。coroutine 拆分的过程发生在生成LLVM IR阶段。Swift使用了哪些带有自定义调用约定的函数保证尾部调用，并专门为Swift进行了调整。</p>
<p>Swift Concurrency 不是建立在 GCD 上，而是使用的一个全新的线程池。GCD 中启动队列工作会很快在提起线程，一个队列阻塞了线程，就会生成一个新线程。基于这种机制 GCD 线程数很容易比 CPU 核心数量多，线程多了，线程就会有大量的调度开销，大量的上下文切换，会使 CPU 运行效率降低。而 Swift Concurrency 的线程数量不会超过 CPU 内核，将上下文切换放到同一个线程中去做。为了实现线程不被阻塞，需要通过语言特性来做。做法是，每个线程都有一个堆栈记录函数调用情况，一个函数占一个帧。函数返回后，这个函数所占的帧就会从堆栈弹出。await 的 async 函数被作为异步帧保存在堆上等待恢复，而不阻碍其它函数入栈执行。在 await 后运行的代码叫 continuation，continuation 会在要恢复时放回到线程的堆栈里。异步帧会根据需要放回栈上。在一个异步函数中调用同步代码将添加帧到线程的堆栈中。这样线程就能够一直向前跑，而不用创建更多线程减少调度。</p>
<p>Douglas 在 Swift 论坛里发的 Swift Concurrency 下个版本的规划贴  <a target="_blank" rel="noopener" href="https://forums.swift.org/t/concurrency-in-swift-5-and-6/49337">Concurrency in Swift 5 and 6</a> ，论坛里还有一个帖子是专门用来 <a target="_blank" rel="noopener" href="https://forums.swift.org/t/swift-concurrency-feedback-wanted/49336">征集Swift Concurrency意见</a> 的，帖子本身列出了 Swift Concurrency 相关的所有提案，也提出欢迎有新提案发出来，除了这些提案可以看外，帖子回复目前已经过百，非常热闹，可以看出大家对 Swift Concurrency 的关注度相当的高。</p>
<p>非常多的人参与了 Swift Concurrency 才使其看起来和用起来那么简单。Doug Gregor 在参与 John Sundell 的播客后，发了很多条推聊 Swift Concurrency，可以看到参与的人非常多，可见背后付出的努力有多大。下面我汇总了 Doug Gregor 在推上发的一些信息，你通过这些信息也可以了解 Swift Concurrency 幕后信息，所做的事和负责的人。</p>
<p> <a target="_blank" rel="noopener" href="https://twitter.com/pathofshrines">@pathofshrines</a> 是 Swift Concurrency 整体架构师，包括低级别运行时和编译器相关细节。 <a target="_blank" rel="noopener" href="https://twitter.com/illian">@illian</a> 是 async sequences、stream 和 Fundation 的负责人。 <a target="_blank" rel="noopener" href="https://twitter.com/optshiftk">@optshiftk</a> 对 UI 和并发交互的极好的洞察力带来了很棒的 async 接口， <a target="_blank" rel="noopener" href="https://twitter.com/phausler">@phausler</a> 带来了 async sequences。Arnold Schwaighofer、 <a target="_blank" rel="noopener" href="https://twitter.com/neightchan">@neightchan</a> 、 <a target="_blank" rel="noopener" href="https://twitter.com/typesanitizer">@typesanitizer</a> 还有 Tim Northover 实现了 async calling convention。</p>
<p> <a target="_blank" rel="noopener" href="https://twitter.com/ktosopl">@ktosopl</a> 有很深厚的 actor、分布式计算和 Swift-on-Server 经验，带来了 actor 系统。Erik Eckstein 为 async 函数和actors建立了关键的优化和功能。</p>
<p>SwiftUI是 <a target="_blank" rel="noopener" href="https://twitter.com/ricketson_">@ricketson_</a> 和 <a target="_blank" rel="noopener" href="https://twitter.com/luka_bernardi">@luka_bernardi</a> 完成的async接口。async I&#x2F;O的接口是 <a target="_blank" rel="noopener" href="https://twitter.com/Catfish_Man">@Catfish_Man</a> 完成的。 <a target="_blank" rel="noopener" href="https://twitter.com/slava_pestov">@slava_pestov</a> 处理了 Swift 泛型问题，还指导其他人编译器实现的细节。async 重构工具是Ben Barham 做的。大量代码移植到 async 是由 <a target="_blank" rel="noopener" href="https://twitter.com/AirspeedSwift">@AirspeedSwift</a> 领导，由 Angela Laar，Clack Cole，Nicole Jacques 和 <a target="_blank" rel="noopener" href="https://twitter.com/mishaldshah">@mishaldshah</a> 共同完成的。</p>
<p> <a target="_blank" rel="noopener" href="https://twitter.com/lorentey">@lorentey</a> 负责 Swift 接口的改进。 <a target="_blank" rel="noopener" href="https://twitter.com/jckarter">@jckarter</a> 有着敏锐的语言设计洞察力，带来了语言设计经验和编译器及运行时实现技能。 <a target="_blank" rel="noopener" href="https://twitter.com/mikeash">@mikeash</a>  也参与了运行时开发中。操作系统的集成是 <a target="_blank" rel="noopener" href="https://twitter.com/rokhinip">@rokhinip</a> 完成的， <a target="_blank" rel="noopener" href="https://twitter.com/chimz">@chimz</a> 提供了关于 Dispatch 和 OS 很好的建议，Pavel Yaskevich 和<br> <a href="https://ming1016.github.io/2021/07/24/my-little-idea-about-writing-technical-article/">@hollyborla</a> 进行了并发所需要关键类型检查器的改进。 <a target="_blank" rel="noopener" href="https://twitter.com/kastiglione">@kastiglione</a> 、Adrian Prantl和 <a target="_blank" rel="noopener" href="https://twitter.com/fred_riss">@fred_riss</a> 实现了调试。 <a target="_blank" rel="noopener" href="https://twitter.com/etcwilde">@etcwilde</a> 和 <a target="_blank" rel="noopener" href="https://twitter.com/call1cc">@call1cc</a> 实现了语义模型中的重要部分。</p>
<p> <a target="_blank" rel="noopener" href="https://twitter.com/evonox">@evonox</a> 负责了服务器Linux 的支持。 <a target="_blank" rel="noopener" href="https://twitter.com/compnerd">@compnerd</a> 将 Swift Concurrency 移植到了 Windows。</p>
<p>Swift Concurrency 模型简单，细节都被隐藏了，比 Kotlin 和 C++的 Coroutine 接口要简洁很多。比如 Task 接口形式就很简洁。Swift Concurrency 大体可分为 async&#x2F;await、Async Sequences、结构化并发和 Actors。</p>
<h4 id="async-x2F-await"><a href="#async-x2F-await" class="headerlink" title="async&#x2F;await"></a>async&#x2F;await</h4><p>通过类似 throws 语法的 async 来指定函数为异步函数，异步函数才能够使用 await，使用异步函数要用 await。await 修饰在 suspension point 时当前线程可以让给其它任务执行，而不用阻塞当前线程，等 await 后面的函数执行完成再回来继续执行，这里需要注意的是回来执行不一定是在离开时的线程上。async&#x2F;await 提案是 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0296-async-await.md">SE-0296</a> 。如果想把现有的异步开发带到 async&#x2F;await 世界，请使用 withCheckedThrowingContinuation。</p>
<p>async&#x2F;await 还有一个非常明显的好处，就是不会再有[weak self] dance 了。</p>
<h4 id="Async-Sequences"><a href="#Async-Sequences" class="headerlink" title="Async Sequences"></a>Async Sequences</h4><p>AsyncSequence 的使用方式是 for-await-in 和 for-try-await-in，系统提供了一些接口，如下：</p>
<ul>
<li>FileHandle.standardInput.bytes.lines</li>
<li>URL.lines</li>
<li>URLSession.shared.data(from: URL)</li>
<li>let (localURL, _ ) &#x3D; try await session.download(from: url) 下载和get请求数据区别是需要边请求边存储数据以减少内存占用</li>
<li>let (responseData, response) &#x3D; try await session.upload(for: request, from: data)</li>
<li>URLSession.shared.bytes(from: URL)</li>
<li>NotificationCenter.default.notifications</li>
</ul>
<h4 id="结构化并发"><a href="#结构化并发" class="headerlink" title="结构化并发"></a>结构化并发</h4><p>使用这些接口可以一边接收数据一边进行显示，AsyncSequence 的提案是 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0298-asyncsequence.md">SE-0298</a> （Swift 5.5可用）。AsyncStream 是创建自己异步序列的最简单的方法，处理迭代、取消和缓冲。AsyncStream 正在路上，提案是 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0314-async-stream.md">SE-0314</a> 。</p>
<p>Task 为一组并发任务创建一个运行环境，async let 可以让任务并发执行，结构化并发（Structured concurrency，提案在路上 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0304-structured-concurrency.md">SE-0304</a> ）withTaskGroup 中 group.async 可以将并发任务进行分组。</p>
<h4 id="Actors"><a href="#Actors" class="headerlink" title="Actors"></a>Actors</h4><p>我们写的程序会在进程中被拆成一个一个小指令，这些指令会在某刻会一个接一个同步的或者并发的执行。系统会用多个线程执行并行的任务，执行顺序是调度器来管理的，现代多核可以同时处理多个线程，当一个资源在多个线程上同时被更改时就会出问题。并发任务对数据资源操作容易造成数据竞争，以前需要手动放到串行队列、使用锁、调度屏障或 Atomics 的方式来避免。以前处理容易导致昂贵的上下文切换，过多线程容易导致线程爆炸，容易意外阻断线程导致后面代码没法执行，多任务相互的等待造成了死锁，block 和内存引用容易出错等等问题。</p>
<p>现在 Swift Concurrency 可以通过 actor 来创建一个区域，在这个区域会自动进行数据安全保护，保证一定时间只有一个线程访问里面数据，防止数据竞争。actor 内部对成员访问是同步的，成员默认是隔离的，actor 外部对 actor 内成员的访问只能是异步的，隐式同步以防止数据竞争。MainActor 继承自能确保全局唯一实例的 GlobalActor，保证任务在主线程执行，这样你就可以抛弃掉在你的 ViewModel 里写 DispatchQueue.main.async 了。</p>
<p>Actors 的概念通常被用于分布式计算，Actor 模型参看 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Actor_model">Wikipedia</a> 里的详细解释，Swift 中的实现效果也非常的理想。Actors 的提案 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0306-actors.md">SE-0306</a> 已在 Swift 5.5落实。</p>
<p>很多语言都支持 actors 还有 async&#x2F;await，实现的方式也类似，actor 使用的不是锁，而是用的 async&#x2F;await 这样能够在一个线程中切换上下文来避免线程空闲的线程模型。actor 还利用编译器，提前做会引起并发问题的检查。</p>
<p>actor 是遵循 Sendable 协议的，只有结构体和 final 类才能够遵循 Sendable，继承于 Sendable 协议的 Excutor 协议表示方法本身，SerialExecutor 表示以串行方式执行。actor 使用 C++写的，源码在 <a target="_blank" rel="noopener" href="https://github.com/apple/swift/blob/main/stdlib/public/Concurrency/Actor.cpp">这里</a> ，可以看到 actor 主要是通过控制各个 job 执行的状态的管理器。job 执行优先级来自 Task 对象，排队时需要确保高优 job 先被执行。全局 Executor 用来为 job 排队，通知 actor 拥有或者放弃线程，实现在 <a target="_blank" rel="noopener" href="https://github.com/apple/swift/blob/main/stdlib/public/Concurrency/GlobalExecutor.cpp">这里</a> 。由于等待而放弃当前线程让其他 actor 执行的 actor，在收到全局 Executor 创建一个新的 job 的通知，使其可以进入一个可能不同线程，这个过程就是并发模型中描述的 Actor Reentrancy。</p>
<h4 id="Distributed-Actors"><a href="#Distributed-Actors" class="headerlink" title="Distributed Actors"></a>Distributed Actors</h4><p>actor 具有分布式形式工作能力，也就是可以 RPC 通过网络读取和写入属性或者调用方法。设计为保护在跨多个进程中的低级别数据竞争。Distributed actors 可以在两个进程间建立通道，隔离它们状态，并在它们之间异步通信。每个 distributed actors 在 actor 初始化时分配一个不可以手动创建的 id，在它所属整个 distributed actor 系统中唯一标识所指 actor，这样无论 distributed actors 在哪，都可以以相同的方式与之交互。</p>
<p>session <a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2022/110356/">Meet distributed actors in Swift</a> 。这里有个 distributed actors 的代码示例 <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/swift/tictacfish_implementing_a_game_using_distributed_actors">TicTacFish: Implementing a game using distributed actors</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0336-distributed-actor-isolation.md">SE-0336 Distributed Actor Isolation</a> 和 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0344-distributed-actor-runtime.md">SE-0344 Distributed Actor Runtime</a> 是两个 Distributed Actors 的相关提案。</p>
<p>Apple 提供了一个参考的服务端 cluster actor 系统实现示例，<a target="_blank" rel="noopener" href="https://github.com/apple/swift-distributed-actors">cluster actor system implementation</a> 。</p>
<h4 id="相关提案"><a href="#相关提案" class="headerlink" title="相关提案"></a>相关提案</h4><p>所有相关提案清单如下：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0296-async-await.md">SE-0296: Async&#x2F;await</a>   <a target="_blank" rel="noopener" href="https://kemchenj.github.io/2021-03-06/">【译】SE-0296 Async&#x2F;await</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0317-async-let.md">SE-0317: async let</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0300-continuation.md">SE-0300: Continuations for interfacing async tasks with synchronous code</a>   <a target="_blank" rel="noopener" href="https://kemchenj.github.io/2021-03-31/">【译】SE-0300 Continuation – 执行同步代码的异步任务接口</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0302-concurrent-value-and-concurrent-closures.md">SE-0302: Sendable and @Sendable closures</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0298-asyncsequence.md">SE-0298: Async&#x2F;Await: Sequences</a>   <a target="_blank" rel="noopener" href="https://kemchenj.github.io/2021-03-10/">【译】SE-0298 Async&#x2F;Await 序列</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0304-structured-concurrency.md">SE-0304: Structured concurrency</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0306-actors.md">SE-0306: Actors</a>   <a target="_blank" rel="noopener" href="https://kemchenj.github.io/2021-04-25/">【译】SE-0306 Actors</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0313-actor-isolation-control.md">SE-0313: Improved control over actor isolation</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0297-concurrency-objc.md">SE-0297: Concurrency Interoperability with Objective-C</a>   <a target="_blank" rel="noopener" href="https://kemchenj.github.io/2021-03-07/">【译】SE-0297 Concurrency 与 Objective-C 的交互</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0314-async-stream.md">SE-0314: AsyncStream and AsyncThrowingStream</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0316-global-actors.md">SE-0316: Global actors</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0310-effectful-readonly-properties.md">SE-0310: Effectful read-only properties</a> </li>
<li><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0311-task-locals.md">SE-0311: Task Local Values</a> </li>
<li><a target="_blank" rel="noopener" href="https://forums.swift.org/t/support-custom-executors-in-swift-concurrency/44425">Custom Executors</a></li>
</ul>
<h4 id="学习路径"><a href="#学习路径" class="headerlink" title="学习路径"></a>学习路径</h4><p>如果打算尝试 Swift Concurrency 的话，按照先后顺序，可以先看官方手册介绍文章 <a target="_blank" rel="noopener" href="https://docs.swift.org/swift-book/LanguageGuide/Concurrency.html">Concurrency</a> 。再看 <a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2021/10132/">Meet async&#x2F;await in Swift</a> 这个Session，了解背后原理看 <a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2021/10134">Explore structured concurrency in Swift</a> 。动手照着试示例代码，看Paul的 <a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/quick-start/concurrency">Swift Concurrency by Example</a> 这个系列。接着看 <a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2021/10133">Protect mutable state with Swift actors</a> 来了解 actors 怎么防止数据竞争。通过 <a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2021/10019">Discover concurrency in SwiftUI</a> 看 concurrency 如何在 SwiftUI 中使用， <a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2021/10095">Use async&#x2F;await with URLSession</a> 来看怎么在 URLSession 中使用 async&#x2F;await。最后听听负责 Swift Concurrency 的 Doug Gregor 参加的一个 <a target="_blank" rel="noopener" href="https://www.swiftbysundell.com/podcast/99/">播客的访谈</a> ，了解下 Swift Concurrency 背后的故事。</p>
<h4 id="Swift-Concurrency-和-Combine"><a href="#Swift-Concurrency-和-Combine" class="headerlink" title="Swift Concurrency 和 Combine"></a>Swift Concurrency 和 Combine</h4><p>由于 Swift Concurrency 的推出和大量的 Session 发布，特别是 <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/swift/asyncsequence/">AsyncSequence</a> 的出现，以及正在路上的 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0314-async-stream.md">AsyncStream、AsyncThrowingStream</a> 和 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0300-continuation.md">continuation</a> 提案（在Xcode 13.0 beta 3 AsyncStream 正式 <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/swift/asyncstream?changes=latest_beta">release</a> ），这些越来越多和 Combine 功能重叠的特性出现在 Swift Concurrency 蓝图里时，大家开始猜测是否 Combine 会被 Swift Concurrency 替代。关于未来是 Swift Concurrency 还是 Combine，我的感觉是，Combine 更侧重在响应式编程上，而响应式编程并不是所有开发人员都会接受的，而 Swift Concurrency 是所有人都愿意接受的开发方式，从 Swift Concurrency 推出后开发者使用的数量和社区反应火热程度来看都比 Combine 要大。在苹果对 Combine 有下一步动作之前，我还是更偏向 Swift Concurrency。</p>
<h4 id="Concurrency-5-7-版本更新"><a href="#Concurrency-5-7-版本更新" class="headerlink" title="Concurrency 5.7 版本更新"></a>Concurrency 5.7 版本更新</h4><p>session <a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2022-110351">Eliminate data races using Swift Concurrency</a> 、<a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2022-110350">Visualize and optimize Swift concurrency</a> 、<a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2022-110355">Meet Swift Async Algorithms</a> 。</p>
<p>表示持续时间有了新的放来来表达，对应提案是 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0329-clock-instant-duration.md">SE-0329 Clock, Instant, and Duration</a> ，continuous clock 是在系统睡眠状态还会增加时间，suspending clock 在系统睡眠状态不会增加时间。Instants 表示一个确定的时间。Duration 表示两个时间经历了多久。</p>
<p>新增 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0338-clarify-execution-non-actor-async.md">SE-0338 Clarify the Execution of Non-Actor-Isolated Async Functions</a> 通过收紧可发送性检查的规则来避免潜在的数据竞争。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0343-top-level-concurrency.md">SE-0343 Concurrency in Top-level Code</a> 这个提案主要是更好地支持命令行工具的开发，可以直接将 concurrency 代码写到 main.swift 文件里。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0340-swift-noasync.md">SE-0340 Unavailable From Async Attribute</a> 提供 noasync 语法以允许我们将类型和函数标记为在异步上下文不可用。</p>
<p>Task 是按顺序执行的，是异步的，在 await 时可以暂停任意次数。task 是自包含的，有自己的资源，可以独立于任何其他 task 独立运行。task 通过在 body 末尾返回一个值来传递对象，值类型没问题，如果是引用类型有可能出现数据竞争。</p>
<p>通过 Sendable 协议 Swift 可以帮助告诉我们什么时候 task 之间共享数据是安全的。Sendable 描述的类型可以跨隔离 domain，不会有数据竞争，Swift 编译器会在构建时检查数据竞争。task 的返回类型要符合 Sendable。</p>
<p>引用类型只能在很少的情况下符合 Sendable。比如 final class 只有不可变的存储。对于自己内部同步的引用类型，比如锁，可以用 <code>@unchecked Sendable</code> 。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">class</span> <span class="token class-name">ConcurrentCache</span><span class="token operator">&lt;</span><span class="token class-name">Key</span><span class="token punctuation">:</span> <span class="token class-name">Hashable</span> <span class="token operator">&amp;</span> <span class="token class-name">Sendable</span><span class="token punctuation">,</span> <span class="token class-name">Value</span><span class="token punctuation">:</span> <span class="token class-name">Sendable</span><span class="token operator">></span><span class="token punctuation">:</span> <span class="token attribute atrule">@unchecked</span> <span class="token class-name">Sendable</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> lock<span class="token punctuation">:</span> <span class="token class-name">NSLock</span>
  <span class="token keyword">var</span> storage<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Key</span><span class="token punctuation">:</span> <span class="token class-name">Value</span><span class="token punctuation">]</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Actor 提供了一种隔离状态的方法可以消除数据竞争。使用 task 来执行 actor 定义的代码。一次只能在一个 actor 上执行一个 task。actor 也是依赖 Sendable。actor 是引用类型，但隔离了他们所有属性和代码来防止并发访问。<code>@MainActor</code> 表示的是主线程，你要在应用中更新 UI 时来用它。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token attribute atrule">@MainActor</span> <span class="token keyword">func</span> <span class="token function-definition function">updateView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> … <span class="token punctuation">&#125;</span>

<span class="token class-name">Task</span> <span class="token punctuation">&#123;</span> <span class="token attribute atrule">@MainActor</span> <span class="token keyword">in</span>
  <span class="token comment">// update UI here</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>@MainActor</code> 也可以用于类，类的属性和方法只能在主 main actor 上访问，除非标记为 <code>nonisolated</code> 。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token attribute atrule">@MainActor</span>
<span class="token keyword">class</span> <span class="token class-name">ChickenValley</span><span class="token punctuation">:</span> <span class="token class-name">Sendable</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> flock<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Chicken</span><span class="token punctuation">]</span>
  <span class="token keyword">var</span> food<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Pineapple</span><span class="token punctuation">]</span>

  <span class="token keyword">func</span> <span class="token function-definition function">advanceTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span> chicken <span class="token keyword">in</span> flock <span class="token punctuation">&#123;</span>
      chicken<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> <span class="token operator">&amp;</span>food<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>




<h2 id="SwiftUI"><a href="#SwiftUI" class="headerlink" title="SwiftUI"></a>SwiftUI</h2><h3 id="介绍-2"><a href="#介绍-2" class="headerlink" title="介绍"></a>介绍</h3><h4 id="SwiftUI-是什么？"><a href="#SwiftUI-是什么？" class="headerlink" title="SwiftUI 是什么？"></a>SwiftUI 是什么？</h4><p>对于一个基于UIKit的项目是没有必要全部用SwiftUI重写的，在UIKit里使用SwiftUI的视图非常容易，UIHostingController是UIViewController的子类，可以直接用在UIKit里，因此直接将SwiftUI视图加到UIHostingController中，就可以在UIKit里使用SwiftUI视图了。</p>
<p>SwiftUI的布局核心是 GeometryReader、View Preferences和Anchor Preferences。如下图所示：</p>
<p><img  srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://user-images.githubusercontent.com/251980/142988837-ab49c202-9779-4c7a-8dc2-5584900c0765.png" class="lozad post-image"src="https://user-images.githubusercontent.com/251980/142988837-ab49c202-9779-4c7a-8dc2-5584900c0765.png"></p>
<p>SwiftUI的数据流更适合Redux结构，如下图所示：</p>
<p><img  srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://user-images.githubusercontent.com/251980/142988879-af591aaf-161f-4f60-9891-d7b8d313f69f.png" class="lozad post-image"src="https://user-images.githubusercontent.com/251980/142988879-af591aaf-161f-4f60-9891-d7b8d313f69f.png"></p>
<p>如上图，Redux结构是真正的单向单数据源结构，易于分割，能充分利用SwiftUI内置的数据流Property Wrapper。UI组件干净、体量小、可复用并且无业务逻辑，因此开发时可以聚焦于UI代码。业务逻辑放在一起，所有业务逻辑和数据Model都在Reducer里。 <a target="_blank" rel="noopener" href="https://github.com/Dimillian/ACHNBrowserUI">ACHNBrowserUI</a>  和  <a target="_blank" rel="noopener" href="https://github.com/Dimillian/MovieSwiftUI">MovieSwiftUI</a>  开源项目都是使用的Redux架构。最近比较瞩目的TCA（The Composable Architecture）也是类Redux&#x2F;Elm的架构的框架， <a target="_blank" rel="noopener" href="https://github.com/pointfreeco/swift-composable-architecture">项目地址见</a> 。</p>
<p>提到数据流就不得不说下苹果公司新出的Combine，对标的是RxSwift，由于是苹果公司官方的库，所以应该优先选择。不过和SwiftUI一样，这两个新库对APP支持最低的系统版本都要求是iOS13及以上。那么怎么能够提前用上SwiftUI和Combine呢？或者说现在使用什么库可以以相同接口方式暂时替换它们，又能在以后改为SwiftUI和Combine时成本最小化呢？</p>
<p>对于SwiftUI，AcFun自研了声明式UI Ysera，类似SwiftUI的接口，并且重构了AcFun里收藏模块列表视图和交互逻辑，如下图所示：</p>
<p><img  srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://user-images.githubusercontent.com/251980/142988909-e6626954-2c93-4c34-b10e-5345c8015cea.png" class="lozad post-image"src="https://user-images.githubusercontent.com/251980/142988909-e6626954-2c93-4c34-b10e-5345c8015cea.png"></p>
<p>通过上图可以看到，swift代码量相比较OC减少了65%以上，原先使用Objective-C实现的相同功能代码超过了1000行，而Swift重写只需要350行，对于AcFun的业务研发工程师而言，同样的需求实现代码比之前少了至少30%，面对单周迭代这样的节奏，团队也变得更从容。代码可读性增加了，后期功能迭代和维护更容易了，Swift让AcFun驶入了iOS开发生态的“快车道”。</p>
<p>SwiftUI全部都是基于Swift的各大可提高开发效率特性完成的，比如前面提到的，能够访问只给语言特性级别行为的Property Wrapper，通过Property Wrapper包装代码逻辑，来降低代码复杂度，除了SwiftUI和Combine里@开头的Property Wrapper外，Swift还自带类似 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0195-dynamic-member-lookup.md">@dynamicMemberLookup</a>  和 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0216-dynamic-callable.md">@dynamicCallable</a>  这样重量级的Property Wrapper。还有 <a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/main/proposals/0289-result-builders.md">ResultBuilder</a> 这种能够简化语法的特性，有些如GraphQL、REST和Networking实际使用ResultBuilder的 <a target="_blank" rel="noopener" href="https://github.com/carson-katri/awesome-result-builders">范例可以参考</a> 。这些Swift的特性如果也能得到充分利用，即使不用SwiftUI也能使开发效率得到大幅提升。</p>
<p>网飞（Netflix）App已使用SwiftUI重构了登录界面，网飞增长团队移动负责人故胤道长记录了SwiftUI在网飞的落地过程，详细描述了 <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/oRPRCx78owLe3_gROYapCw">SwiftUI的收益</a> 。网飞能够直接使用SwiftUI得益于他们最低支持iOS 13系统。</p>
<p>不过如最低支持系统低于iOS 13，还有开源项目 <a target="_blank" rel="noopener" href="https://github.com/rakutentech/AltSwiftUI">AltSwiftUI</a> 也实现了SwiftUI的语法和特性，能够向前兼容到iOS 11。</p>
<p><a target="_blank" rel="noopener" href="https://twitter.com/kuba_suder">Kuba Suder</a> 做了一个 <a target="_blank" rel="noopener" href="https://mackuba.eu/swiftui/changelog">SwiftUI Index&#x2F;Changelog</a> ，从官方文档中提取版本信息，一目了然 SwiftUI 每个版本 view，modifier 还有属性做了哪些增加和改变。当然也包括这次 SwiftUI 4 的更新。还有份对今年更新整理的 cheat sheet <a target="_blank" rel="noopener" href="https://bigmountainstudio.github.io/What-is-new-in-SwiftUI/">What’s New In SwiftUI for iOS Cheat Sheet - WWDC22</a> 。</p>
<p>SwiftUI 4 做了大量细节更新，比如添加了后台任务函数 <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/swiftui/scene/backgroundtask(_:action:)?changes=latest_minor">backgroundTask(_:action:)</a> 。List 改用 UICollectionView。AnyLayout 让 HStack 和 VStack 之间可以自由切换。<code>scrollDismissesKeyboard()</code> modifier 可以让键盘在滚动时自动 dismiss。<code>scrollIndicators()</code> modifier 可以隐藏 ScrollView 和 List 等视图的滚动指示。defersSystemGestures() modifier 允许我们的手势优先于系统的内置手势。颜色的 <code>.gradient </code> 可以获得很简单的渐变，<code>Rectangle().fill(.red.gradient)</code>，还有 <code>.shadow</code> 用来创建投影 <code>Rectangle().fill(.red.shadow(.drop(color: .black, radius: 10)))</code>，还有 <code>.inner</code> 内阴影。<code>lineLimit()</code> modifier 支持范围设置。还有一些 modifier 支持 toggle 参数，比如 <code>.bold()</code> 和 <code>.italic()</code> 等，这样利于运行时进行调整。</p>
<p>嵌入 UIKit<br>示例如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift">cell<span class="token punctuation">.</span>contentConfiguration <span class="token operator">=</span> <span class="token class-name">UIHostingConfiguration</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">VStack</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"wand.and.stars"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>title<span class="token punctuation">)</span>
        <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Like magic!"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>title2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bold</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token punctuation">.</span><span class="token function">foregroundStyle</span><span class="token punctuation">(</span><span class="token class-name">Color</span><span class="token punctuation">.</span>purple<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>锁屏的 Widget 和 WatchOS 一样，可以瞟一眼就获取信息。</p>
<p>官方指南 <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/WidgetKit/Creating-lock-screen-widgets-and-watch-complications">Creating Lock Screen Widgets and Watch Complications</a></p>
<p>可以将 SwiftUI 的 View 生成图片。</p>
<p>官方参考文档 <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/swiftui/imagerenderer">ImageRenderer</a></p>
<p>session <a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2022-10142">Efficiency awaits: Background tasks in SwiftUI</a> 了解如何使用 SwiftUI 后台任务 API 简洁地处理任务。展示如何使用 Swift Concurrency 来处理网络响应、后台刷新等——同时保持性能和功率。</p>
<h4 id="SwiftUI-参考资料"><a href="#SwiftUI-参考资料" class="headerlink" title="SwiftUI 参考资料"></a>SwiftUI 参考资料</h4><ul>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/wwdc22/topics/swiftui-ui-frameworks/">WWDC22 SwiftUI 和 UI 库相关专题</a></li>
<li>官方教程 <a target="_blank" rel="noopener" href="https://developer.apple.com/tutorials/swiftui-concepts">Learnning SwiftUI</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/xcode/swiftui/">SwiftUI 主题</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/videos/swiftui-ui-frameworks">SwiftUI Session</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/SwiftUI">SwiftUI 文档</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/tutorials/swiftui-concepts">Learning SwiftUI</a> 一年一度官方入门教程</li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/swiftui/food_truck_building_a_swiftui_multiplatform_app">Food Truck: Building a SwiftUI multiplatform app</a> 一套代码适配 Mac、iPad 和 iPhone 的官方示例</li>
<li><a target="_blank" rel="noopener" href="https://redalemeden.com/collections/swiftui-2022/">Reda Lemeden 整理的 WWDC22 所有 SwiftUI 相关内容</a></li>
</ul>
<p>session：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2022-10052">What’s new in SwiftUI</a></li>
</ul>
<p>社区整理的和 SwiftUI 的 digital lounges 内容：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://onmyway133.com/posts/wwdc-swiftui-lounge/">WWDC swiftui-lounge</a></li>
<li><a target="_blank" rel="noopener" href="https://swiftui-lab.com/digital-lounges-2022/">WWDC 2022: Lessons from the SwiftUI Digital Lounges</a> javier 整理的，做了详细的分类</li>
<li><a target="_blank" rel="noopener" href="https://midnight-beanie-ccb.notion.site/swiftui-lounge-wwdc22-e20094b91f074398ba395c3fa245e63d">#swiftui-lounge #wwdc22</a></li>
</ul>
<h3 id="视图组件使用"><a href="#视图组件使用" class="headerlink" title="视图组件使用"></a>视图组件使用</h3><h4 id="SwiftUI-对标的-UIKit-视图"><a href="#SwiftUI-对标的-UIKit-视图" class="headerlink" title="SwiftUI 对标的 UIKit 视图"></a>SwiftUI 对标的 UIKit 视图</h4><p>如下：</p>
<table>
<thead>
<tr>
<th>SwiftUI</th>
<th>UIKit</th>
</tr>
</thead>
<tbody><tr>
<td>Text 和 Label</td>
<td>UILabel</td>
</tr>
<tr>
<td>TextField</td>
<td>UITextField</td>
</tr>
<tr>
<td>TextEditor</td>
<td>UITextView</td>
</tr>
<tr>
<td>Button 和 Link</td>
<td>UIButton</td>
</tr>
<tr>
<td>Image</td>
<td>UIImageView</td>
</tr>
<tr>
<td>NavigationView</td>
<td>UINavigationController 和 UISplitViewController</td>
</tr>
<tr>
<td>ToolbarItem</td>
<td>UINavigationItem</td>
</tr>
<tr>
<td>ScrollView</td>
<td>UIScrollView</td>
</tr>
<tr>
<td>List</td>
<td>UITableView</td>
</tr>
<tr>
<td>LazyVGrid 和 LazyHGrid</td>
<td>UICollectionView</td>
</tr>
<tr>
<td>HStack 和 LazyHStack</td>
<td>UIStack</td>
</tr>
<tr>
<td>VStack 和 LazyVStack</td>
<td>UIStack</td>
</tr>
<tr>
<td>TabView</td>
<td>UITabBarController 和 UIPageViewController</td>
</tr>
<tr>
<td>Toggle</td>
<td>UISwitch</td>
</tr>
<tr>
<td>Slider</td>
<td>UISlider</td>
</tr>
<tr>
<td>Stepper</td>
<td>UIStepper</td>
</tr>
<tr>
<td>ProgressView</td>
<td>UIProgressView 和 UIActivityIndicatorView</td>
</tr>
<tr>
<td>Picker</td>
<td>UISegmentedControl</td>
</tr>
<tr>
<td>DatePicker</td>
<td>UIDatePicker</td>
</tr>
<tr>
<td>Alert</td>
<td>UIAlertController</td>
</tr>
<tr>
<td>ActionSheet</td>
<td>UIAlertController</td>
</tr>
<tr>
<td>Map</td>
<td>MapKit</td>
</tr>
</tbody></table>
<h4 id="Text"><a href="#Text" class="headerlink" title="Text"></a>Text</h4><p>基本用法</p>
<p><img  srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://user-images.githubusercontent.com/251980/154473546-94ba6f9f-2ce3-44ef-a7c6-60d86df8c90f.png" class="lozad post-image"src="https://user-images.githubusercontent.com/251980/154473546-94ba6f9f-2ce3-44ef-a7c6-60d86df8c90f.png"></p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// MARK: - Text</span>
<span class="token keyword">struct</span> <span class="token class-name">PlayTextView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> manyString <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"这是一段长文。总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么，总得说点什么吧。"</span></span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ScrollView</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Group</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"大标题"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>largeTitle<span class="token punctuation">)</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"说点啥呢？"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">tracking</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token comment">// 字间距</span>
                    <span class="token punctuation">.</span><span class="token function">kerning</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token comment">// 尾部留白</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"划重点"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">underline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span><span class="token punctuation">.</span>yellow<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">fontWeight</span><span class="token punctuation">(</span><span class="token punctuation">.</span>heavy<span class="token punctuation">)</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"可旋转的文字"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">rotationEffect</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">degrees</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">fixedSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">80</span><span class="token punctuation">)</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"自定义系统字体大小"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">system</span><span class="token punctuation">(</span>size<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"使用指定的字体"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">custom</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Georgia"</span></span><span class="token punctuation">,</span> size<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
            <span class="token class-name">Group</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"有阴影"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>largeTitle<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span><span class="token punctuation">.</span>orange<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">bold</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">italic</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">shadow</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token punctuation">.</span>black<span class="token punctuation">,</span> radius<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Gradient Background"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>largeTitle<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span><span class="token punctuation">.</span>white<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">background</span><span class="token punctuation">(</span><span class="token class-name">LinearGradient</span><span class="token punctuation">(</span>gradient<span class="token punctuation">:</span> <span class="token class-name">Gradient</span><span class="token punctuation">(</span>colors<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">.</span>white<span class="token punctuation">,</span> <span class="token punctuation">.</span>black<span class="token punctuation">,</span> <span class="token punctuation">.</span>red<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> startPoint<span class="token punctuation">:</span> <span class="token punctuation">.</span>top<span class="token punctuation">,</span> endPoint<span class="token punctuation">:</span> <span class="token punctuation">.</span>bottom<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">cornerRadius</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Gradient Background"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span><span class="token punctuation">.</span>white<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">background</span><span class="token punctuation">(</span><span class="token class-name">LinearGradient</span><span class="token punctuation">(</span>gradient<span class="token punctuation">:</span> <span class="token class-name">Gradient</span><span class="token punctuation">(</span>colors<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">.</span>white<span class="token punctuation">,</span> <span class="token punctuation">.</span>black<span class="token punctuation">,</span> <span class="token punctuation">.</span>purple<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> startPoint<span class="token punctuation">:</span> <span class="token punctuation">.</span>leading<span class="token punctuation">,</span> endPoint<span class="token punctuation">:</span> <span class="token punctuation">.</span>trailing<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">cornerRadius</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
                <span class="token class-name">ZStack</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"渐变透明材质风格"</span></span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">background</span><span class="token punctuation">(</span>
                            <span class="token punctuation">.</span>regularMaterial<span class="token punctuation">,</span>
                            <span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token class-name">RoundedRectangle</span><span class="token punctuation">(</span>cornerRadius<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token punctuation">.</span>continuous<span class="token punctuation">)</span>
                        <span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">shadow</span><span class="token punctuation">(</span>radius<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>largeTitle<span class="token punctuation">.</span><span class="token function">weight</span><span class="token punctuation">(</span><span class="token punctuation">.</span>black<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
                <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">background</span><span class="token punctuation">(</span>
                    <span class="token class-name">LinearGradient</span><span class="token punctuation">(</span>colors<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">.</span>yellow<span class="token punctuation">,</span> <span class="token punctuation">.</span>pink<span class="token punctuation">]</span><span class="token punctuation">,</span> startPoint<span class="token punctuation">:</span> <span class="token punctuation">.</span>topLeading<span class="token punctuation">,</span> endPoint<span class="token punctuation">:</span> <span class="token punctuation">.</span>bottomTrailing<span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Angular Gradient Background"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">background</span><span class="token punctuation">(</span><span class="token class-name">AngularGradient</span><span class="token punctuation">(</span>colors<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">.</span>red<span class="token punctuation">,</span> <span class="token punctuation">.</span>yellow<span class="token punctuation">,</span> <span class="token punctuation">.</span>green<span class="token punctuation">,</span> <span class="token punctuation">.</span>blue<span class="token punctuation">,</span> <span class="token punctuation">.</span>purple<span class="token punctuation">,</span> <span class="token punctuation">.</span>red<span class="token punctuation">]</span><span class="token punctuation">,</span> center<span class="token punctuation">:</span> <span class="token punctuation">.</span>center<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">cornerRadius</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"带背景图片的"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>largeTitle<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span><span class="token punctuation">.</span>white<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span>background <span class="token punctuation">&#123;</span>
                        <span class="token class-name">Rectangle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token class-name">Color</span><span class="token punctuation">(</span><span class="token punctuation">.</span>black<span class="token punctuation">)</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">cornerRadius</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
                        <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"logo"</span></span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">resizable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">)</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>

            <span class="token class-name">Group</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// 设置 lineLimit 表示最多支持行数，依据情况依然有会被减少显示行数</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span>manyString<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">lineLimit</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// 对行的限制，如果多余设定行数，尾部会显示...</span>
                    <span class="token punctuation">.</span><span class="token function">lineSpacing</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment">// 行间距</span>
                    <span class="token punctuation">.</span><span class="token function">multilineTextAlignment</span><span class="token punctuation">(</span><span class="token punctuation">.</span>leading<span class="token punctuation">)</span> <span class="token comment">// 对齐</span>
                
                <span class="token comment">// 使用 fixedSize 就可以在任何时候完整显示</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span>manyString<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">fixedSize</span><span class="token punctuation">(</span>horizontal<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> vertical<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
                
            <span class="token punctuation">&#125;</span>
            
            <span class="token comment">// 使用 AttributeString</span>
            <span class="token class-name">PTextViewAttribute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

            <span class="token comment">// 使用 Markdown</span>
            <span class="token class-name">PTextViewMarkdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            <span class="token comment">// 时间</span>
            <span class="token class-name">PTextViewDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            <span class="token comment">// 插值</span>
            <span class="token class-name">PTextViewInterpolation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>font 字体设置的样式对应 weight 和 size 可以在官方交互文档中查看 <a target="_blank" rel="noopener" href="https://developer.apple.com/design/human-interface-guidelines/ios/visual-design/typography/#dynamic-type-sizes">Typography</a></p>
<p>markdown 使用</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// MARK: - Markdown</span>
<span class="token keyword">struct</span> <span class="token class-name">PTextViewMarkdown</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> mdaStr<span class="token punctuation">:</span> <span class="token class-name">AttributedString</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        
        <span class="token keyword">var</span> mda <span class="token operator">=</span> <span class="token class-name">AttributedString</span><span class="token punctuation">(</span>localized<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"这是一个 **Attribute** ~string~"</span></span><span class="token punctuation">)</span>
        
        <span class="token comment">/// 自定义的属性语法是^[string](key：value)</span>
        mda <span class="token operator">=</span> <span class="token class-name">AttributedString</span><span class="token punctuation">(</span>localized<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"^[这是](p2:'one')^[一](p3:&#123;k1:1,k2:2&#125;)个 **Attribute** ~string~"</span></span><span class="token punctuation">,</span> including<span class="token punctuation">:</span> <span class="token punctuation">\</span><span class="token punctuation">.</span>newScope<span class="token punctuation">)</span>
        <span class="token function">print</span><span class="token punctuation">(</span>mda<span class="token punctuation">)</span>
        <span class="token comment">/// 这是 &#123;</span>
        <span class="token comment">///     NSLanguage = en</span>
        <span class="token comment">///     p2 = one</span>
        <span class="token comment">/// &#125;</span>
        <span class="token comment">/// 一 &#123;</span>
        <span class="token comment">///     NSLanguage = en</span>
        <span class="token comment">///     p3 = P3(k1: 1, k2: 2)</span>
        <span class="token comment">/// &#125;</span>
        <span class="token comment">/// 个  &#123;</span>
        <span class="token comment">///     NSLanguage = en</span>
        <span class="token comment">/// &#125;</span>
        <span class="token comment">/// Attribute &#123;</span>
        <span class="token comment">///     NSLanguage = en</span>
        <span class="token comment">///     NSInlinePresentationIntent = NSInlinePresentationIntent(rawValue: 2)</span>
        <span class="token comment">/// &#125;</span>
        <span class="token comment">///   &#123;</span>
        <span class="token comment">///     NSLanguage = en</span>
        <span class="token comment">/// &#125;</span>
        <span class="token comment">/// string &#123;</span>
        <span class="token comment">///     NSInlinePresentationIntent = NSInlinePresentationIntent(rawValue: 32)</span>
        <span class="token comment">///     NSLanguage = en</span>
        <span class="token comment">/// &#125;</span>
        
        <span class="token comment">// 从文件中读取 Markdown 内容</span>
        <span class="token keyword">let</span> mdUrl <span class="token operator">=</span> <span class="token class-name">Bundle</span><span class="token punctuation">.</span>main<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span>forResource<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"1"</span></span><span class="token punctuation">,</span> withExtension<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"md"</span></span><span class="token punctuation">)</span><span class="token operator">!</span>
        mda <span class="token operator">=</span> <span class="token keyword">try</span><span class="token operator">!</span> <span class="token class-name">AttributedString</span><span class="token punctuation">(</span>contentsOf<span class="token punctuation">:</span> mdUrl<span class="token punctuation">,</span>options<span class="token punctuation">:</span> <span class="token class-name">AttributedString</span><span class="token punctuation">.</span><span class="token class-name">MarkdownParsingOptions</span><span class="token punctuation">(</span>interpretedSyntax<span class="token punctuation">:</span> <span class="token punctuation">.</span>inlineOnlyPreservingWhitespace<span class="token punctuation">)</span><span class="token punctuation">,</span> baseURL<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span> <span class="token comment">// .inlineOnlyPreservingWhitespace 支持 markdown 文件的换行</span>
                
        <span class="token comment">// Markdown 已转换成 AtrributedString 结构。</span>
        <span class="token keyword">for</span> r <span class="token keyword">in</span> mda<span class="token punctuation">.</span>runs <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token keyword">let</span> ipi <span class="token operator">=</span> r<span class="token punctuation">.</span>inlinePresentationIntent <span class="token punctuation">&#123;</span>
                <span class="token keyword">switch</span> ipi <span class="token punctuation">&#123;</span>
                <span class="token keyword">case</span> <span class="token punctuation">.</span>lineBreak<span class="token punctuation">:</span>
                    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"paragrahp"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">case</span> <span class="token punctuation">.</span>code<span class="token punctuation">:</span>
                    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"this is code"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">default</span><span class="token punctuation">:</span>
                    <span class="token keyword">break</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">if</span> <span class="token keyword">let</span> pi <span class="token operator">=</span> r<span class="token punctuation">.</span>presentationIntent <span class="token punctuation">&#123;</span>
                <span class="token keyword">for</span> c <span class="token keyword">in</span> pi<span class="token punctuation">.</span>components <span class="token punctuation">&#123;</span>
                    <span class="token keyword">switch</span> c<span class="token punctuation">.</span>kind <span class="token punctuation">&#123;</span>
                    <span class="token keyword">case</span> <span class="token punctuation">.</span>paragraph<span class="token punctuation">:</span>
                        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"this is paragraph"</span></span><span class="token punctuation">)</span>
                    <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">codeBlock</span><span class="token punctuation">(</span><span class="token keyword">let</span> lang<span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"this is </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">lang <span class="token operator">??</span> <span class="token string-literal"><span class="token string">""</span></span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> code"</span></span><span class="token punctuation">)</span>
                    <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token keyword">let</span> level<span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"this is </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">level</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> level"</span></span><span class="token punctuation">)</span>
                    <span class="token keyword">default</span><span class="token punctuation">:</span>
                        <span class="token keyword">break</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        
        <span class="token keyword">return</span> mda
    <span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Text</span><span class="token punctuation">(</span>mdaStr<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>AttributedString 的使用</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// MARK: - AttributedString</span>
<span class="token keyword">struct</span> <span class="token class-name">PTextViewAttribute</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> aStr<span class="token punctuation">:</span> <span class="token class-name">AttributedString</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">var</span> a1 <span class="token operator">=</span> <span class="token class-name">AttributedString</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"这是一个 "</span></span><span class="token punctuation">)</span>
        <span class="token keyword">var</span> c1 <span class="token operator">=</span> <span class="token class-name">AttributeContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        c1<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token punctuation">.</span>footnote
        c1<span class="token punctuation">.</span>foregroundColor <span class="token operator">=</span> <span class="token punctuation">.</span>secondary
        a1<span class="token punctuation">.</span><span class="token function">setAttributes</span><span class="token punctuation">(</span>c1<span class="token punctuation">)</span>
        
        <span class="token keyword">var</span> a2 <span class="token operator">=</span> <span class="token class-name">AttributedString</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Attribute "</span></span><span class="token punctuation">)</span>
        <span class="token keyword">var</span> c2 <span class="token operator">=</span> <span class="token class-name">AttributeContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        c2<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token punctuation">.</span>title
        a2<span class="token punctuation">.</span><span class="token function">setAttributes</span><span class="token punctuation">(</span>c2<span class="token punctuation">)</span>
        
        <span class="token keyword">var</span> a3 <span class="token operator">=</span> <span class="token class-name">AttributedString</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"String "</span></span><span class="token punctuation">)</span>
        <span class="token keyword">var</span> c3 <span class="token operator">=</span> <span class="token class-name">AttributeContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        c3<span class="token punctuation">.</span>baselineOffset <span class="token operator">=</span> <span class="token number">10</span>
        c3<span class="token punctuation">.</span>appKit<span class="token punctuation">.</span>foregroundColor <span class="token operator">=</span> <span class="token punctuation">.</span>yellow <span class="token comment">// 仅在 macOS 里显示的颜色</span>
        c3<span class="token punctuation">.</span>swiftUI<span class="token punctuation">.</span>foregroundColor <span class="token operator">=</span> <span class="token punctuation">.</span>secondary
        c3<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token punctuation">.</span>footnote
        a3<span class="token punctuation">.</span><span class="token function">setAttributes</span><span class="token punctuation">(</span>c3<span class="token punctuation">)</span>
        <span class="token comment">// a3 使用自定义属性</span>
        a3<span class="token punctuation">.</span>p1 <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"This is a custom property."</span></span>
        
        <span class="token comment">// formatter 的支持</span>
        <span class="token keyword">var</span> a4 <span class="token operator">=</span> <span class="token class-name">Date</span><span class="token punctuation">.</span>now<span class="token punctuation">.</span><span class="token function">formatted</span><span class="token punctuation">(</span><span class="token punctuation">.</span>dateTime
                                        <span class="token punctuation">.</span><span class="token function">hour</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                        <span class="token punctuation">.</span><span class="token function">minute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                        <span class="token punctuation">.</span><span class="token function">weekday</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                        <span class="token punctuation">.</span>attributed
        <span class="token punctuation">)</span>
        
        <span class="token keyword">let</span> c4AMPM <span class="token operator">=</span> <span class="token class-name">AttributeContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">dateField</span><span class="token punctuation">(</span><span class="token punctuation">.</span>amPM<span class="token punctuation">)</span>
        <span class="token keyword">let</span> c4AMPMColor <span class="token operator">=</span> <span class="token class-name">AttributeContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span><span class="token punctuation">.</span>green<span class="token punctuation">)</span>
        
        a4<span class="token punctuation">.</span><span class="token function">replaceAttributes</span><span class="token punctuation">(</span>c4AMPM<span class="token punctuation">,</span> with<span class="token punctuation">:</span> c4AMPMColor<span class="token punctuation">)</span>
        <span class="token keyword">let</span> c4Week <span class="token operator">=</span> <span class="token class-name">AttributeContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">dateField</span><span class="token punctuation">(</span><span class="token punctuation">.</span>weekday<span class="token punctuation">)</span>
        <span class="token keyword">let</span> c4WeekColor <span class="token operator">=</span> <span class="token class-name">AttributeContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span><span class="token punctuation">.</span>purple<span class="token punctuation">)</span>
        a4<span class="token punctuation">.</span><span class="token function">replaceAttributes</span><span class="token punctuation">(</span>c4Week<span class="token punctuation">,</span> with<span class="token punctuation">:</span> c4WeekColor<span class="token punctuation">)</span>
        
        a1<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>a2<span class="token punctuation">)</span>
        a1<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>a3<span class="token punctuation">)</span>
        a1<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>a4<span class="token punctuation">)</span>
        
        
        
        <span class="token comment">// Runs 视图</span>
        <span class="token keyword">for</span> r <span class="token keyword">in</span> a1<span class="token punctuation">.</span>runs <span class="token punctuation">&#123;</span>
            <span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">/// 这是一个  &#123;</span>
        <span class="token comment">///     SwiftUI.Font = Font(provider: SwiftUI.(unknown context at $7ff91d4a5e90).FontBox&lt;SwiftUI.Font.(unknown context at $7ff91d4ad5d8).TextStyleProvider>)</span>
        <span class="token comment">///     SwiftUI.ForegroundColor = secondary</span>
        <span class="token comment">/// &#125;</span>
        <span class="token comment">/// Attribute  &#123;</span>
        <span class="token comment">///     SwiftUI.Font = Font(provider: SwiftUI.(unknown context at $7ff91d4a5e90).FontBox&lt;SwiftUI.Font.(unknown context at $7ff91d4ad5d8).TextStyleProvider>)</span>
        <span class="token comment">/// &#125;</span>
        <span class="token comment">/// String  &#123;</span>
        <span class="token comment">///     SwiftUI.ForegroundColor = secondary</span>
        <span class="token comment">///     SwiftUI.BaselineOffset = 10.0</span>
        <span class="token comment">///     NSColor = sRGB IEC61966-2.1 colorspace 1 1 0 1</span>
        <span class="token comment">///     SwiftUI.Font = Font(provider: SwiftUI.(unknown context at $7ff91d4a5e90).FontBox&lt;SwiftUI.Font.(unknown context at $7ff91d4ad5d8).TextStyleProvider>)</span>
        <span class="token comment">///     p1 = This is a custom property.</span>
        <span class="token comment">/// &#125;</span>
        <span class="token comment">/// Tue &#123;</span>
        <span class="token comment">///     SwiftUI.ForegroundColor = purple</span>
        <span class="token comment">/// &#125;</span>
        <span class="token comment">///   &#123;</span>
        <span class="token comment">/// &#125;</span>
        <span class="token comment">/// 5 &#123;</span>
        <span class="token comment">///     Foundation.DateFormatField = hour</span>
        <span class="token comment">/// &#125;</span>
        <span class="token comment">/// : &#123;</span>
        <span class="token comment">/// &#125;</span>
        <span class="token comment">/// 16 &#123;</span>
        <span class="token comment">///     Foundation.DateFormatField = minute</span>
        <span class="token comment">/// &#125;</span>
        <span class="token comment">///   &#123;</span>
        <span class="token comment">/// &#125;</span>
        <span class="token comment">/// PM &#123;</span>
        <span class="token comment">///     SwiftUI.ForegroundColor = green</span>
        <span class="token comment">/// &#125;</span>
        
        <span class="token keyword">return</span> a1
    <span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Text</span><span class="token punctuation">(</span>aStr<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// MARK: - 自定 AttributedString 属性</span>
<span class="token keyword">struct</span> PAKP1<span class="token punctuation">:</span> <span class="token class-name">AttributedStringKey</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">typealias</span> <span class="token class-name">Value</span> <span class="token operator">=</span> <span class="token class-name">String</span>
    <span class="token keyword">static</span> <span class="token keyword">var</span> name<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"p1"</span></span>
    
    
<span class="token punctuation">&#125;</span>
<span class="token keyword">struct</span> PAKP2<span class="token punctuation">:</span> <span class="token class-name">CodableAttributedStringKey</span><span class="token punctuation">,</span> <span class="token class-name">MarkdownDecodableAttributedStringKey</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">enum</span> P2<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Codable</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">case</span> one<span class="token punctuation">,</span> two<span class="token punctuation">,</span> three
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">var</span> name<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"p2"</span></span>
    <span class="token keyword">typealias</span> <span class="token class-name">Value</span> <span class="token operator">=</span> P2
<span class="token punctuation">&#125;</span>
<span class="token keyword">struct</span> PAKP3<span class="token punctuation">:</span> <span class="token class-name">CodableAttributedStringKey</span><span class="token punctuation">,</span> <span class="token class-name">MarkdownDecodableAttributedStringKey</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">struct</span> P3<span class="token punctuation">:</span> <span class="token class-name">Codable</span><span class="token punctuation">,</span> <span class="token class-name">Hashable</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> k1<span class="token punctuation">:</span> <span class="token class-name">Int</span>
        <span class="token keyword">let</span> k2<span class="token punctuation">:</span> <span class="token class-name">Int</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">typealias</span> <span class="token class-name">Value</span> <span class="token operator">=</span> P3
    <span class="token keyword">static</span> <span class="token keyword">var</span> name<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"p3"</span></span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">extension</span> <span class="token class-name">AttributeScopes</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">struct</span> <span class="token class-name">NewScope</span><span class="token punctuation">:</span> <span class="token class-name">AttributeScope</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> p1<span class="token punctuation">:</span> PAKP1
        <span class="token keyword">let</span> p2<span class="token punctuation">:</span> PAKP2
        <span class="token keyword">let</span> p3<span class="token punctuation">:</span> PAKP3
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">var</span> newScope<span class="token punctuation">:</span> <span class="token class-name">NewScope</span><span class="token punctuation">.</span><span class="token keyword">Type</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">NewScope</span><span class="token punctuation">.</span><span class="token keyword">self</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">extension</span> <span class="token class-name">AttributeDynamicLookup</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">subscript</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">(</span>dynamicMember keyPath<span class="token punctuation">:</span><span class="token class-name">KeyPath</span><span class="token operator">&lt;</span><span class="token class-name">AttributeScopes</span><span class="token punctuation">.</span><span class="token class-name">NewScope</span><span class="token punctuation">,</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">T</span> <span class="token keyword">where</span> <span class="token class-name">T</span><span class="token punctuation">:</span><span class="token class-name">AttributedStringKey</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">self</span><span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>时间的显示</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// MARK: - 时间</span>
<span class="token keyword">struct</span> <span class="token class-name">PDateTextView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> date<span class="token punctuation">:</span> <span class="token class-name">Date</span> <span class="token operator">=</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> df<span class="token punctuation">:</span> <span class="token class-name">DateFormatter</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> df <span class="token operator">=</span> <span class="token class-name">DateFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        df<span class="token punctuation">.</span>dateStyle <span class="token operator">=</span> <span class="token punctuation">.</span>long
        df<span class="token punctuation">.</span>timeStyle <span class="token operator">=</span> <span class="token punctuation">.</span>short
        <span class="token keyword">return</span> df
    <span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> dv<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> df<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> date<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">HStack</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span>dv<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">environment</span><span class="token punctuation">(</span><span class="token punctuation">\</span><span class="token punctuation">.</span>locale<span class="token punctuation">,</span> <span class="token class-name">Locale</span><span class="token punctuation">(</span>identifier<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"zh_cn"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>插值使用</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token comment">// MARK: - 插值</span>
<span class="token keyword">struct</span> <span class="token class-name">PTextViewInterpolation</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> nf<span class="token punctuation">:</span> <span class="token class-name">NumberFormatter</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> f <span class="token operator">=</span> <span class="token class-name">NumberFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        f<span class="token punctuation">.</span>numberStyle <span class="token operator">=</span> <span class="token punctuation">.</span>currencyPlural
        <span class="token keyword">return</span> f
    <span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">VStack</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"图文 </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation"><span class="token class-name">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"sun.min"</span></span><span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"💰 </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation"><span class="token number">999</span> <span class="token keyword">as</span> <span class="token class-name">NSNumber</span><span class="token punctuation">,</span> formatter<span class="token punctuation">:</span> nf</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">environment</span><span class="token punctuation">(</span><span class="token punctuation">\</span><span class="token punctuation">.</span>locale<span class="token punctuation">,</span> <span class="token class-name">Locale</span><span class="token punctuation">(</span>identifier<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"zh_cn"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"数组： </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation"><span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">]</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"红字：</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">red<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"变红了"</span></span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">，带图标的字：</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">sun<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"天晴"</span></span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 扩展 LocalizedStringKey.StringInterpolation 自定义插值</span>
<span class="token keyword">extension</span> <span class="token class-name">LocalizedStringKey</span><span class="token punctuation">.</span><span class="token class-name">StringInterpolation</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 特定类型处理</span>
    <span class="token keyword">mutating</span> <span class="token keyword">func</span> <span class="token function-definition function">appendInterpolation</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> value<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> s <span class="token keyword">in</span> value <span class="token punctuation">&#123;</span>
            <span class="token function">appendLiteral</span><span class="token punctuation">(</span>s <span class="token operator">+</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span>
            <span class="token function">appendInterpolation</span><span class="token punctuation">(</span><span class="token class-name">Text</span><span class="token punctuation">(</span>s <span class="token operator">+</span> <span class="token string-literal"><span class="token string">" "</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bold</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span><span class="token punctuation">.</span>secondary<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">// 实现不同情况处理，可以简化设置修改器设置</span>
    <span class="token keyword">mutating</span> <span class="token keyword">func</span> <span class="token function-definition function">appendInterpolation</span><span class="token punctuation">(</span>red value<span class="token punctuation">:</span> <span class="token class-name">LocalizedStringKey</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">appendInterpolation</span><span class="token punctuation">(</span><span class="token class-name">Text</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bold</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span><span class="token punctuation">.</span>red<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">mutating</span> <span class="token keyword">func</span> <span class="token function-definition function">appendInterpolation</span><span class="token punctuation">(</span>sun value<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">appendInterpolation</span><span class="token punctuation">(</span><span class="token class-name">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"sun.max.fill"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token function">appendLiteral</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="Link"><a href="#Link" class="headerlink" title="Link"></a>Link</h4><p>使用方法如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PlayLinkView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@Environment</span><span class="token punctuation">(</span><span class="token punctuation">\</span><span class="token punctuation">.</span>openURL<span class="token punctuation">)</span> <span class="token keyword">var</span> openURL
    <span class="token keyword">var</span> aStr<span class="token punctuation">:</span> <span class="token class-name">AttributedString</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token class-name">AttributedString</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"戴铭的博客"</span></span><span class="token punctuation">)</span>
        a<span class="token punctuation">.</span>link <span class="token operator">=</span> <span class="token function">URL</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"https://ming1016.github.io/"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> a
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">VStack</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 普通</span>
            <span class="token class-name">Link</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"前往 www.starming.com"</span></span><span class="token punctuation">,</span> destination<span class="token punctuation">:</span> <span class="token function">URL</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"http://www.starming.com"</span></span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">buttonStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>borderedProminent<span class="token punctuation">)</span>
            <span class="token class-name">Link</span><span class="token punctuation">(</span>destination<span class="token punctuation">:</span> <span class="token function">URL</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"https://twitter.com/daiming_cn"</span></span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Label</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"My Twitter"</span></span><span class="token punctuation">,</span> systemImage<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"message.circle.fill"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
            
            <span class="token comment">// AttributedString 链接</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span>aStr<span class="token punctuation">)</span>
            
            <span class="token comment">// markdown 链接</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"[Go Ming's GitHub](https://github.com/ming1016)"</span></span><span class="token punctuation">)</span>
            
            <span class="token comment">// 控件使用 OpenURL</span>
            <span class="token class-name">Link</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"小册子源码"</span></span><span class="token punctuation">,</span> destination<span class="token punctuation">:</span> <span class="token function">URL</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"https://github.com/KwaiAppTeam/SwiftPamphletApp"</span></span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">environment</span><span class="token punctuation">(</span><span class="token punctuation">\</span><span class="token punctuation">.</span>openURL<span class="token punctuation">,</span> <span class="token class-name">OpenURLAction</span> <span class="token punctuation">&#123;</span> url <span class="token keyword">in</span>
                    <span class="token keyword">return</span> <span class="token punctuation">.</span>systemAction
                    <span class="token comment">/// return .handled 不会返回系统打开浏览器动作，只会处理 return 前的事件。</span>
                    <span class="token comment">/// .discard 和 .handled 类似。</span>
                    <span class="token comment">/// .systemAction(URL(string: "https://www.anotherurl.com")) 可以返回另外一个 url 来替代指定的url</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            
            <span class="token comment">// 扩展 View 后更简洁的使用 OpenURL</span>
            <span class="token class-name">Link</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"戴铭的微博"</span></span><span class="token punctuation">,</span> destination<span class="token punctuation">:</span> <span class="token function">URL</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"https://weibo.com/allstarming"</span></span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span>goOpenURL <span class="token punctuation">&#123;</span> url <span class="token keyword">in</span>
                    <span class="token function">print</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span>absoluteString<span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token punctuation">.</span>systemAction
                <span class="token punctuation">&#125;</span>
            
            <span class="token comment">// 根据内容返回不同链接</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"戴铭博客有好几个，存在[GitHub Page](github)、[自建服务器](starming)和[知乎](zhihu)上"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">environment</span><span class="token punctuation">(</span><span class="token punctuation">\</span><span class="token punctuation">.</span>openURL<span class="token punctuation">,</span> <span class="token class-name">OpenURLAction</span> <span class="token punctuation">&#123;</span> url <span class="token keyword">in</span>
                    <span class="token keyword">switch</span> url<span class="token punctuation">.</span>absoluteString <span class="token punctuation">&#123;</span>
                    <span class="token keyword">case</span> <span class="token string-literal"><span class="token string">"github"</span></span><span class="token punctuation">:</span>
                        <span class="token keyword">return</span> <span class="token punctuation">.</span><span class="token function">systemAction</span><span class="token punctuation">(</span><span class="token function">URL</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"https://ming1016.github.io/"</span></span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">)</span>
                    <span class="token keyword">case</span> <span class="token string-literal"><span class="token string">"starming"</span></span><span class="token punctuation">:</span>
                        <span class="token keyword">return</span> <span class="token punctuation">.</span><span class="token function">systemAction</span><span class="token punctuation">(</span><span class="token function">URL</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"http://www.starming.com"</span></span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">)</span>
                    <span class="token keyword">case</span> <span class="token string-literal"><span class="token string">"zhihu"</span></span><span class="token punctuation">:</span>
                        <span class="token keyword">return</span> <span class="token punctuation">.</span><span class="token function">systemAction</span><span class="token punctuation">(</span><span class="token function">URL</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"https://www.zhihu.com/people/starming/posts"</span></span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">)</span>
                    <span class="token keyword">default</span><span class="token punctuation">:</span>
                        <span class="token keyword">return</span> <span class="token punctuation">.</span>handled
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span> <span class="token comment">// end VStack</span>
        <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">// View 支持 openURL 的能力</span>
    <span class="token keyword">func</span> <span class="token function-definition function">goUrl</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> url<span class="token punctuation">:</span> <span class="token constant">URL</span><span class="token punctuation">,</span> done<span class="token punctuation">:</span> <span class="token attribute atrule">@escaping</span> <span class="token punctuation">(</span><span class="token omit keyword">_</span> accepted<span class="token punctuation">:</span> <span class="token class-name">Bool</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Void</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">openURL</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> completion<span class="token punctuation">:</span> done<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 为 View 扩展一个 OpenURL 方法</span>
<span class="token keyword">extension</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">func</span> <span class="token function-definition function">goOpenURL</span><span class="token punctuation">(</span>done<span class="token punctuation">:</span> <span class="token attribute atrule">@escaping</span> <span class="token punctuation">(</span><span class="token constant">URL</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">OpenURLAction</span><span class="token punctuation">.</span><span class="token class-name">Result</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token function">environment</span><span class="token punctuation">(</span><span class="token punctuation">\</span><span class="token punctuation">.</span>openURL<span class="token punctuation">,</span> <span class="token class-name">OpenURLAction</span><span class="token punctuation">(</span>handler<span class="token punctuation">:</span> done<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>View 的 onOpenURL 方法可以处理 Universal Links。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">V</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">VStack</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"hi"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span>onOpenURL <span class="token punctuation">&#123;</span> url <span class="token keyword">in</span>
            <span class="token function">print</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span>absoluteString<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="Label"><a href="#Label" class="headerlink" title="Label"></a>Label</h4><p><img  srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://user-images.githubusercontent.com/251980/154474725-d696d50b-9da7-4a0d-808f-07894a9597cb.png" class="lozad post-image"src="https://user-images.githubusercontent.com/251980/154474725-d696d50b-9da7-4a0d-808f-07894a9597cb.png"></p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PlayLabelView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">VStack</span><span class="token punctuation">(</span>spacing<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Label</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"一个 Label"</span></span><span class="token punctuation">,</span> systemImage<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"bolt.circle"</span></span><span class="token punctuation">)</span>
            
            <span class="token class-name">Label</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"只显示 icon"</span></span><span class="token punctuation">,</span> systemImage<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"heart.fill"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">labelStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>iconOnly<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span><span class="token punctuation">.</span>red<span class="token punctuation">)</span>
            
            <span class="token comment">// 自建 Label</span>
            <span class="token class-name">Label</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"自建 Label"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span><span class="token punctuation">.</span>orange<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">bold</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>largeTitle<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">shadow</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token punctuation">.</span>black<span class="token punctuation">,</span> radius<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span> icon<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"p3"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">resizable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">aspectRatio</span><span class="token punctuation">(</span>contentMode<span class="token punctuation">:</span> <span class="token punctuation">.</span>fit<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">shadow</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token punctuation">.</span>black<span class="token punctuation">,</span> radius<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>

            
            <span class="token comment">// 自定义 LabelStyle</span>
            <span class="token class-name">Label</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"有边框的 Label"</span></span><span class="token punctuation">,</span> systemImage<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"b.square.fill"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">labelStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>border<span class="token punctuation">)</span>
            
            <span class="token class-name">Label</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"仅标题有边框"</span></span><span class="token punctuation">,</span> systemImage<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"text.bubble"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">labelStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>borderOnlyTitle<span class="token punctuation">)</span>
            
            <span class="token comment">// 扩展的 Label</span>
            <span class="token class-name">Label</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"扩展的 Label"</span></span><span class="token punctuation">,</span> originalSystemImage<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"cloud.sun.bolt.fill"</span></span><span class="token punctuation">)</span>
            
        <span class="token punctuation">&#125;</span> <span class="token comment">// end VStack</span>
    <span class="token punctuation">&#125;</span> <span class="token comment">// end body</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 对 Label 做扩展</span>
<span class="token keyword">extension</span> <span class="token class-name">Label</span> <span class="token keyword">where</span> <span class="token class-name">Title</span> <span class="token operator">==</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">Icon</span> <span class="token operator">==</span> <span class="token class-name">Image</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> title<span class="token punctuation">:</span> <span class="token class-name">LocalizedStringKey</span><span class="token punctuation">,</span> originalSystemImage systemImageString<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token keyword">init</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span> icon<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> systemImageString<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">renderingMode</span><span class="token punctuation">(</span><span class="token punctuation">.</span>original<span class="token punctuation">)</span> <span class="token comment">// 让 SFSymbol 显示本身的颜色</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 添加自定义 LabelStyle，用来加上边框</span>
<span class="token keyword">struct</span> <span class="token class-name">BorderLabelStyle</span><span class="token punctuation">:</span> <span class="token class-name">LabelStyle</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">func</span> <span class="token function-definition function">makeBody</span><span class="token punctuation">(</span>configuration<span class="token punctuation">:</span> <span class="token class-name">Configuration</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Label</span><span class="token punctuation">(</span>configuration<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">overlay</span><span class="token punctuation">(</span><span class="token class-name">RoundedRectangle</span><span class="token punctuation">(</span>cornerRadius<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">.</span>purple<span class="token punctuation">,</span> lineWidth<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">shadow</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token punctuation">.</span>black<span class="token punctuation">,</span> radius<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">labelStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>automatic<span class="token punctuation">)</span> <span class="token comment">// 样式擦除器，防止样式被 .iconOnly、.titleOnly 这样的 LabelStyle 擦除了样式。</span>
                        
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">extension</span> <span class="token class-name">LabelStyle</span> <span class="token keyword">where</span> <span class="token keyword">Self</span> <span class="token operator">==</span> <span class="token class-name">BorderLabelStyle</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">internal</span> <span class="token keyword">static</span> <span class="token keyword">var</span> border<span class="token punctuation">:</span> <span class="token class-name">BorderLabelStyle</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">BorderLabelStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 只给标题加边框</span>
<span class="token keyword">struct</span> <span class="token class-name">BorderOnlyTitleLabelStyle</span><span class="token punctuation">:</span> <span class="token class-name">LabelStyle</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">func</span> <span class="token function-definition function">makeBody</span><span class="token punctuation">(</span>configuration<span class="token punctuation">:</span> <span class="token class-name">Configuration</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">HStack</span> <span class="token punctuation">&#123;</span>
            configuration<span class="token punctuation">.</span>icon
            configuration<span class="token punctuation">.</span>title
                <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">overlay</span><span class="token punctuation">(</span><span class="token class-name">RoundedRectangle</span><span class="token punctuation">(</span>cornerRadius<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">.</span>pink<span class="token punctuation">,</span> lineWidth<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">shadow</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token punctuation">.</span>black<span class="token punctuation">,</span> radius<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">labelStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>automatic<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">extension</span> <span class="token class-name">LabelStyle</span> <span class="token keyword">where</span> <span class="token keyword">Self</span> <span class="token operator">==</span> <span class="token class-name">BorderOnlyTitleLabelStyle</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">internal</span> <span class="token keyword">static</span> <span class="token keyword">var</span> borderOnlyTitle<span class="token punctuation">:</span> <span class="token class-name">BorderOnlyTitleLabelStyle</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">BorderOnlyTitleLabelStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="TextEditor"><a href="#TextEditor" class="headerlink" title="TextEditor"></a>TextEditor</h4><p><img  srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://user-images.githubusercontent.com/251980/154667163-e906dfd4-074e-4c04-9c80-94af86df4ba6.png" class="lozad post-image"src="https://user-images.githubusercontent.com/251980/154667163-e906dfd4-074e-4c04-9c80-94af86df4ba6.png"></p>
<p>对应的代码如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">SwiftUI</span>
<span class="token keyword">import</span> <span class="token class-name">CodeEditorView</span>

<span class="token keyword">struct</span> <span class="token class-name">PlayTextEditorView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// for TextEditor</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> txt<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"一段可编辑文字...\n"</span></span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> count<span class="token punctuation">:</span> <span class="token class-name">Int</span> <span class="token operator">=</span> <span class="token number">0</span>
    
    <span class="token comment">// for CodeEditorView</span>
    <span class="token attribute atrule">@Environment</span><span class="token punctuation">(</span><span class="token punctuation">\</span><span class="token punctuation">.</span>colorScheme<span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token keyword">var</span> colorScheme<span class="token punctuation">:</span> <span class="token class-name">ColorScheme</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> codeMessages<span class="token punctuation">:</span> <span class="token class-name">Set</span><span class="token operator">&lt;</span><span class="token class-name">Located</span><span class="token operator">&lt;</span><span class="token class-name">Message</span><span class="token operator">>></span> <span class="token operator">=</span> <span class="token class-name">Set</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token attribute atrule">@SceneStorage</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"editLocation"</span></span><span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token keyword">var</span> editLocation<span class="token punctuation">:</span> <span class="token class-name">CodeEditor</span><span class="token punctuation">.</span><span class="token class-name">Location</span> <span class="token operator">=</span> <span class="token class-name">CodeEditor</span><span class="token punctuation">.</span><span class="token class-name">Location</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        
        <span class="token comment">// 使用 SwiftUI 自带 TextEditor</span>
        <span class="token class-name">TextEditor</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> $txt<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>title<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">lineSpacing</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">disableAutocorrection</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">(</span>of<span class="token punctuation">:</span> txt<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> newValue <span class="token keyword">in</span>
                count <span class="token operator">=</span> txt<span class="token punctuation">.</span>count
            <span class="token punctuation">&#125;</span>
        <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"字数：</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">count</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span><span class="token punctuation">.</span>secondary<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>footnote<span class="token punctuation">)</span>
        
        <span class="token comment">// 使用的 CodeEditorView 显示和编辑代码高亮的代码，还有 minimap</span>
        <span class="token class-name">CodeEditor</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">constant</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"""
static func number() &#123;
    // Int
    let i1 = 100
    let i2 = 22
    print(i1 / i2) // 向下取整得 4

    // Float
    let f1: Float = 100.0
    let f2: Float = 22.0
    print(f1 / f2) // 4.5454545
    
    let f4: Float32 = 5.0
    let f5: Float64 = 5.0
    print(f4, f5) // 5.0 5.0 5.0

    // Double
    let d1: Double = 100.0
    let d2: Double = 22.0
    print(d1 / d2) // 4.545454545454546

    // 字面量
    print(Int(0b10101)) // 0b 开头是二进制
    print(Int(0x00afff)) // 0x 开头是十六进制
    print(2.5e4) // 2.5x10^4 十进制用 e
    print(0xAp2) // 10*2^2  十六进制用 p
    print(2_000_000) // 2000000
    
    // isMultiple(of:) 方法检查一个数字是否是另一个数字的倍数
    let i3 = 36
    print(i3.isMultiple(of: 9)) // true
&#125;
"""</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                   messages<span class="token punctuation">:</span> $codeMessages<span class="token punctuation">,</span>
                   language<span class="token punctuation">:</span> <span class="token punctuation">.</span>swift<span class="token punctuation">,</span>
                   layout<span class="token punctuation">:</span> <span class="token class-name">CodeEditor</span><span class="token punctuation">.</span><span class="token class-name">LayoutConfiguration</span><span class="token punctuation">(</span>showMinimap<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">environment</span><span class="token punctuation">(</span><span class="token punctuation">\</span><span class="token punctuation">.</span>codeEditorTheme<span class="token punctuation">,</span> colorScheme <span class="token operator">==</span> <span class="token punctuation">.</span>dark <span class="token operator">?</span> <span class="token class-name">Theme</span><span class="token punctuation">.</span>defaultDark <span class="token punctuation">:</span> <span class="token class-name">Theme</span><span class="token punctuation">.</span>defaultLight<span class="token punctuation">)</span>
        
        <span class="token comment">// 包装的 NSTextView</span>
        <span class="token class-name">HSplitView</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">PNSTextView</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">constant</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"左边写...\n"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> onDidChange<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">(</span>s<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token keyword">in</span>
                <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Typing </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> times."</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token class-name">PNSTextView</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">constant</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"右边写...\n"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span> <span class="token comment">// end HSplitView</span>
    <span class="token punctuation">&#125;</span> <span class="token comment">// end body</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// MARK: - 自己包装 NSTextView</span>
<span class="token keyword">struct</span> <span class="token class-name">PNSTextView</span><span class="token punctuation">:</span> <span class="token class-name">NSViewRepresentable</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@Binding</span> <span class="token keyword">var</span> text<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">var</span> onBeginEditing<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Void</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    <span class="token keyword">var</span> onCommit<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Void</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    <span class="token keyword">var</span> onDidChange<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Void</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token omit keyword">_</span><span class="token punctuation">,</span><span class="token omit keyword">_</span>  <span class="token keyword">in</span> <span class="token punctuation">&#125;</span>
    
    <span class="token comment">// 返回要包装的 NSView</span>
    <span class="token keyword">func</span> <span class="token function-definition function">makeNSView</span><span class="token punctuation">(</span>context<span class="token punctuation">:</span> <span class="token class-name">Context</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">PNSTextConfiguredView</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token class-name">PNSTextConfiguredView</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> text<span class="token punctuation">)</span>
        t<span class="token punctuation">.</span>delegate <span class="token operator">=</span> context<span class="token punctuation">.</span>coordinator
        <span class="token keyword">return</span> t
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">func</span> <span class="token function-definition function">updateNSView</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> view<span class="token punctuation">:</span> <span class="token class-name">PNSTextConfiguredView</span><span class="token punctuation">,</span> context<span class="token punctuation">:</span> <span class="token class-name">Context</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        view<span class="token punctuation">.</span>text <span class="token operator">=</span> text
        view<span class="token punctuation">.</span>selectedRanges <span class="token operator">=</span> context<span class="token punctuation">.</span>coordinator<span class="token punctuation">.</span>sRanges
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">// 回调</span>
    <span class="token keyword">func</span> <span class="token function-definition function">makeCoordinator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">TextViewDelegate</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">TextViewDelegate</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 处理 delegate 回调</span>
<span class="token keyword">extension</span> <span class="token class-name">PNSTextView</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">class</span> <span class="token class-name">TextViewDelegate</span><span class="token punctuation">:</span> <span class="token class-name">NSObject</span><span class="token punctuation">,</span> <span class="token class-name">NSTextViewDelegate</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">var</span> tView<span class="token punctuation">:</span> <span class="token class-name">PNSTextView</span>
        <span class="token keyword">var</span> sRanges<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">NSValue</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">var</span> typeCount<span class="token punctuation">:</span> <span class="token class-name">Int</span> <span class="token operator">=</span> <span class="token number">0</span>
        
        <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> v<span class="token punctuation">:</span> <span class="token class-name">PNSTextView</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>tView <span class="token operator">=</span> v
        <span class="token punctuation">&#125;</span>
        <span class="token comment">// 开始编辑</span>
        <span class="token keyword">func</span> <span class="token function-definition function">textDidBeginEditing</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> notification<span class="token punctuation">:</span> <span class="token class-name">Notification</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">guard</span> <span class="token keyword">let</span> textView <span class="token operator">=</span> notification<span class="token punctuation">.</span>object <span class="token keyword">as</span><span class="token operator">?</span> <span class="token class-name">NSTextView</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>tView<span class="token punctuation">.</span>text <span class="token operator">=</span> textView<span class="token punctuation">.</span>string
            <span class="token keyword">self</span><span class="token punctuation">.</span>tView<span class="token punctuation">.</span><span class="token function">onBeginEditing</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">// 每次敲字</span>
        <span class="token keyword">func</span> <span class="token function-definition function">textDidChange</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> notification<span class="token punctuation">:</span> <span class="token class-name">Notification</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">guard</span> <span class="token keyword">let</span> textView <span class="token operator">=</span> notification<span class="token punctuation">.</span>object <span class="token keyword">as</span><span class="token operator">?</span> <span class="token class-name">NSTextView</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span>
            <span class="token punctuation">&#125;</span>
            typeCount <span class="token operator">+=</span> <span class="token number">1</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>tView<span class="token punctuation">.</span>text <span class="token operator">=</span> textView<span class="token punctuation">.</span>string
            <span class="token keyword">self</span><span class="token punctuation">.</span>sRanges <span class="token operator">=</span> textView<span class="token punctuation">.</span>selectedRanges
            <span class="token keyword">self</span><span class="token punctuation">.</span>tView<span class="token punctuation">.</span><span class="token function">onDidChange</span><span class="token punctuation">(</span>textView<span class="token punctuation">.</span>string<span class="token punctuation">,</span> typeCount<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">// 提交</span>
        <span class="token keyword">func</span> <span class="token function-definition function">textDidEndEditing</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> notification<span class="token punctuation">:</span> <span class="token class-name">Notification</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">guard</span> <span class="token keyword">let</span> textView <span class="token operator">=</span> notification<span class="token punctuation">.</span>object <span class="token keyword">as</span><span class="token operator">?</span> <span class="token class-name">NSTextView</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>tView<span class="token punctuation">.</span>text <span class="token operator">=</span> textView<span class="token punctuation">.</span>string
            <span class="token keyword">self</span><span class="token punctuation">.</span>tView<span class="token punctuation">.</span><span class="token function">onCommit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 配置 NSTextView</span>
<span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">PNSTextConfiguredView</span><span class="token punctuation">:</span> <span class="token class-name">NSView</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">weak</span> <span class="token keyword">var</span> delegate<span class="token punctuation">:</span> <span class="token class-name">NSTextViewDelegate</span><span class="token operator">?</span>
    
    <span class="token keyword">private</span> <span class="token keyword">lazy</span> <span class="token keyword">var</span> tv<span class="token punctuation">:</span> <span class="token class-name">NSTextView</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> contentSize <span class="token operator">=</span> sv<span class="token punctuation">.</span>contentSize
        <span class="token keyword">let</span> textStorage <span class="token operator">=</span> <span class="token class-name">NSTextStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token keyword">let</span> layoutManager <span class="token operator">=</span> <span class="token class-name">NSLayoutManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        textStorage<span class="token punctuation">.</span><span class="token function">addLayoutManager</span><span class="token punctuation">(</span>layoutManager<span class="token punctuation">)</span>
        
        <span class="token keyword">let</span> textContainer <span class="token operator">=</span> <span class="token class-name">NSTextContainer</span><span class="token punctuation">(</span>containerSize<span class="token punctuation">:</span> sv<span class="token punctuation">.</span>frame<span class="token punctuation">.</span>size<span class="token punctuation">)</span>
        textContainer<span class="token punctuation">.</span>widthTracksTextView <span class="token operator">=</span> <span class="token boolean">true</span>
        textContainer<span class="token punctuation">.</span>containerSize <span class="token operator">=</span> <span class="token class-name">NSSize</span><span class="token punctuation">(</span>
            width<span class="token punctuation">:</span> contentSize<span class="token punctuation">.</span>width<span class="token punctuation">,</span>
            height<span class="token punctuation">:</span> <span class="token class-name">CGFloat</span><span class="token punctuation">.</span>greatestFiniteMagnitude
        <span class="token punctuation">)</span>
        
        layoutManager<span class="token punctuation">.</span><span class="token function">addTextContainer</span><span class="token punctuation">(</span>textContainer<span class="token punctuation">)</span>
        
        <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token class-name">NSTextView</span><span class="token punctuation">(</span>frame<span class="token punctuation">:</span> <span class="token punctuation">.</span>zero<span class="token punctuation">,</span> textContainer<span class="token punctuation">:</span> textContainer<span class="token punctuation">)</span>
        t<span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>delegate
        t<span class="token punctuation">.</span>isEditable <span class="token operator">=</span> <span class="token boolean">true</span>
        t<span class="token punctuation">.</span>allowsUndo <span class="token operator">=</span> <span class="token boolean">true</span>
        
        t<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token function">systemFont</span><span class="token punctuation">(</span>ofSize<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">)</span>
        t<span class="token punctuation">.</span>textColor <span class="token operator">=</span> <span class="token class-name">NSColor</span><span class="token punctuation">.</span>labelColor
        t<span class="token punctuation">.</span>drawsBackground <span class="token operator">=</span> <span class="token boolean">true</span>
        t<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token class-name">NSColor</span><span class="token punctuation">.</span>textBackgroundColor
        
        t<span class="token punctuation">.</span>maxSize <span class="token operator">=</span> <span class="token class-name">NSSize</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token class-name">CGFloat</span><span class="token punctuation">.</span>greatestFiniteMagnitude<span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token class-name">CGFloat</span><span class="token punctuation">.</span>greatestFiniteMagnitude<span class="token punctuation">)</span>
        t<span class="token punctuation">.</span>minSize <span class="token operator">=</span> <span class="token class-name">NSSize</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> contentSize<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
        t<span class="token punctuation">.</span>autoresizingMask <span class="token operator">=</span> <span class="token punctuation">.</span>width

        t<span class="token punctuation">.</span>isHorizontallyResizable <span class="token operator">=</span> <span class="token boolean">false</span>
        t<span class="token punctuation">.</span>isVerticallyResizable   <span class="token operator">=</span> <span class="token boolean">true</span>
        
        <span class="token keyword">return</span> t
    <span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">private</span> <span class="token keyword">lazy</span> <span class="token keyword">var</span> sv<span class="token punctuation">:</span> <span class="token class-name">NSScrollView</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token class-name">NSScrollView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        s<span class="token punctuation">.</span>drawsBackground <span class="token operator">=</span> <span class="token boolean">true</span>
        s<span class="token punctuation">.</span>borderType <span class="token operator">=</span> <span class="token punctuation">.</span>noBorder
        s<span class="token punctuation">.</span>hasVerticalScroller <span class="token operator">=</span> <span class="token boolean">true</span>
        s<span class="token punctuation">.</span>hasHorizontalRuler <span class="token operator">=</span> <span class="token boolean">false</span>
        s<span class="token punctuation">.</span>translatesAutoresizingMaskIntoConstraints <span class="token operator">=</span> <span class="token boolean">false</span>
        s<span class="token punctuation">.</span>autoresizingMask <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token punctuation">.</span>height<span class="token punctuation">]</span>
        <span class="token keyword">return</span> s
    <span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">var</span> text<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">didSet</span> <span class="token punctuation">&#123;</span>
            tv<span class="token punctuation">.</span>string <span class="token operator">=</span> text
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">var</span> selectedRanges<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">NSValue</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">didSet</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">guard</span> selectedRanges<span class="token punctuation">.</span>count <span class="token operator">></span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span>
            <span class="token punctuation">&#125;</span>
            tv<span class="token punctuation">.</span>selectedRanges <span class="token operator">=</span> selectedRanges
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">required</span> <span class="token keyword">init</span><span class="token operator">?</span><span class="token punctuation">(</span>coder<span class="token punctuation">:</span> <span class="token class-name">NSCoder</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">fatalError</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Error coder"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">init</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>text <span class="token operator">=</span> text
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>frame<span class="token punctuation">:</span> <span class="token punctuation">.</span>zero<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function-definition function">viewWillDraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">viewWillDraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        sv<span class="token punctuation">.</span>translatesAutoresizingMaskIntoConstraints <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token function">addSubview</span><span class="token punctuation">(</span>sv<span class="token punctuation">)</span>
        <span class="token class-name">NSLayoutConstraint</span><span class="token punctuation">.</span><span class="token function">activate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
            sv<span class="token punctuation">.</span>topAnchor<span class="token punctuation">.</span><span class="token function">constraint</span><span class="token punctuation">(</span>equalTo<span class="token punctuation">:</span> topAnchor<span class="token punctuation">)</span><span class="token punctuation">,</span>
            sv<span class="token punctuation">.</span>trailingAnchor<span class="token punctuation">.</span><span class="token function">constraint</span><span class="token punctuation">(</span>equalTo<span class="token punctuation">:</span> trailingAnchor<span class="token punctuation">)</span><span class="token punctuation">,</span>
            sv<span class="token punctuation">.</span>bottomAnchor<span class="token punctuation">.</span><span class="token function">constraint</span><span class="token punctuation">(</span>equalTo<span class="token punctuation">:</span> bottomAnchor<span class="token punctuation">)</span><span class="token punctuation">,</span>
            sv<span class="token punctuation">.</span>leadingAnchor<span class="token punctuation">.</span><span class="token function">constraint</span><span class="token punctuation">(</span>equalTo<span class="token punctuation">:</span> leadingAnchor<span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span>
        sv<span class="token punctuation">.</span>documentView <span class="token operator">=</span> tv
    <span class="token punctuation">&#125;</span> <span class="token comment">// end viewWillDraw</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>SwiftUI 中用 NSView，可以通过 NSViewRepresentable 来包装视图，这个协议主要是实现 makeNSView、updateNSView 和 makeCoordinator 三个方法。makeNSView 要求返回需要包装的 NSView。每当 SwiftUI 的状态变化时触发 updateNSView 方法的调用。为了实现 NSView 里的 delegate 和 SwiftUI 通信，就要用 makeCoordinator 返回一个用于处理 delegate 的实例。</p>
<h4 id="TextField"><a href="#TextField" class="headerlink" title="TextField"></a>TextField</h4><p><img  srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://user-images.githubusercontent.com/251980/154916174-2e9b1bd8-992a-485e-803a-07da59d0c7e3.png" class="lozad post-image"src="https://user-images.githubusercontent.com/251980/154916174-2e9b1bd8-992a-485e-803a-07da59d0c7e3.png"></p>
<p>使用方法如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PlayTextFieldView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"Starming"</span></span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> showT <span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> isEditing <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token keyword">var</span> placeholder <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"输入些文字..."</span></span>
    
    <span class="token attribute atrule">@FocusState</span> <span class="token keyword">private</span> <span class="token keyword">var</span> isFocus<span class="token punctuation">:</span> <span class="token class-name">Bool</span>
    
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">VStack</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">TextField</span><span class="token punctuation">(</span>placeholder<span class="token punctuation">,</span> text<span class="token punctuation">:</span> $t<span class="token punctuation">)</span>
            
            <span class="token comment">// 样式设置</span>
            <span class="token class-name">TextField</span><span class="token punctuation">(</span>placeholder<span class="token punctuation">,</span> text<span class="token punctuation">:</span> $t<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">textFieldStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>roundedBorder<span class="token punctuation">)</span> <span class="token comment">// textFieldStyle 有三个预置值 automatic、plain 和 roundedBorder。</span>
                <span class="token punctuation">.</span><span class="token function">multilineTextAlignment</span><span class="token punctuation">(</span><span class="token punctuation">.</span>leading<span class="token punctuation">)</span> <span class="token comment">// 对齐方式</span>
                <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">system</span><span class="token punctuation">(</span>size<span class="token punctuation">:</span> <span class="token number">14</span><span class="token punctuation">,</span> weight<span class="token punctuation">:</span> <span class="token punctuation">.</span>heavy<span class="token punctuation">,</span> design<span class="token punctuation">:</span> <span class="token punctuation">.</span>rounded<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">border</span><span class="token punctuation">(</span><span class="token punctuation">.</span>teal<span class="token punctuation">,</span> width<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">background</span><span class="token punctuation">(</span><span class="token punctuation">.</span>white<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span><span class="token punctuation">.</span>brown<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">textCase</span><span class="token punctuation">(</span><span class="token punctuation">.</span>uppercase<span class="token punctuation">)</span>

            <span class="token comment">// 多视图组合</span>
            <span class="token class-name">HStack</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"lock.circle"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span><span class="token punctuation">.</span>gray<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>headline<span class="token punctuation">)</span>
                <span class="token class-name">TextField</span><span class="token punctuation">(</span>placeholder<span class="token punctuation">,</span> text<span class="token punctuation">:</span> $t<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">textFieldStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>plain<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">submitLabel</span><span class="token punctuation">(</span><span class="token punctuation">.</span>done<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span>onSubmit <span class="token punctuation">&#123;</span>
                        showT <span class="token operator">=</span> t
                        isFocus <span class="token operator">=</span> <span class="token boolean">true</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">(</span>of<span class="token punctuation">:</span> t<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> newValue <span class="token keyword">in</span>
                        t <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">(</span>newValue<span class="token punctuation">.</span><span class="token keyword">prefix</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 限制字数</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token class-name">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"eye.slash"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span><span class="token punctuation">.</span>gray<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>headline<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
            <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">overlay</span><span class="token punctuation">(</span>
                <span class="token class-name">RoundedRectangle</span><span class="token punctuation">(</span>cornerRadius<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">.</span>gray<span class="token punctuation">,</span> lineWidth<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">.</span>horizontal<span class="token punctuation">)</span>

            <span class="token class-name">Text</span><span class="token punctuation">(</span>showT<span class="token punctuation">)</span>


            <span class="token comment">// 自定义 textFieldStyle 样式</span>
            <span class="token class-name">TextField</span><span class="token punctuation">(</span>placeholder<span class="token punctuation">,</span> text<span class="token punctuation">:</span> $t<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">textFieldStyle</span><span class="token punctuation">(</span><span class="token class-name">PClearTextStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">focused</span><span class="token punctuation">(</span>$isFocus<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span> <span class="token comment">// end body</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">struct</span> <span class="token class-name">PClearTextStyle</span><span class="token punctuation">:</span> <span class="token class-name">TextFieldStyle</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@ViewBuilder</span>
    <span class="token keyword">func</span> <span class="token function-definition function">_body</span><span class="token punctuation">(</span>configuration<span class="token punctuation">:</span> <span class="token class-name">TextField</span><span class="token operator">&lt;</span>_Label<span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> mirror <span class="token operator">=</span> <span class="token class-name">Mirror</span><span class="token punctuation">(</span>reflecting<span class="token punctuation">:</span> configuration<span class="token punctuation">)</span>
        <span class="token keyword">let</span> bindingText<span class="token punctuation">:</span> <span class="token class-name">Binding</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">></span> <span class="token operator">=</span> mirror<span class="token punctuation">.</span><span class="token function">descendant</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"_text"</span></span><span class="token punctuation">)</span> <span class="token keyword">as</span><span class="token operator">!</span> <span class="token class-name">Binding</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">></span>
        configuration
            <span class="token punctuation">.</span><span class="token function">overlay</span><span class="token punctuation">(</span>alignment<span class="token punctuation">:</span> <span class="token punctuation">.</span>trailing<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Button</span><span class="token punctuation">(</span>action<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                    bindingText<span class="token punctuation">.</span>wrappedValue <span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> label<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"clear"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        
        <span class="token keyword">let</span> text<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> mirror<span class="token punctuation">.</span><span class="token function">descendant</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"_text"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"_value"</span></span><span class="token punctuation">)</span> <span class="token keyword">as</span><span class="token operator">!</span> <span class="token class-name">String</span>
        configuration
            <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">background</span><span class="token punctuation">(</span>
                <span class="token class-name">RoundedRectangle</span><span class="token punctuation">(</span>cornerRadius<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">strokeBorder</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span>count <span class="token operator">></span> <span class="token number">10</span> <span class="token operator">?</span> <span class="token punctuation">.</span>pink <span class="token punctuation">:</span> <span class="token punctuation">.</span>gray<span class="token punctuation">,</span> lineWidth<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span> <span class="token comment">// end func</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>目前iOS 和 iPadOS上支持的键盘有：</p>
<ul>
<li>asciiCapable：能显示标准 ASCII 字符的键盘</li>
<li>asciiCapableNumberPad：只输出 ASCII 数字的数字键盘</li>
<li>numberPad：用于输入 PIN 码的数字键盘</li>
<li>numbersAndPunctuation：数字和标点符号的键盘</li>
<li>decimalPad：带有数字和小数点的键盘</li>
<li>phonePad：电话中使用的键盘</li>
<li>namePhonePad：用于输入人名或电话号码的小键盘</li>
<li>URL：用于输入URL的键盘</li>
<li>emailAddress：用于输入电子邮件地址的键盘</li>
<li>twitter：用于Twitter文本输入的键盘，支持@和#字符简便输入</li>
<li>webSearch：用于网络搜索词和URL输入的键盘</li>
</ul>
<p>可以通过 keyboardType 修改器来指定。</p>
<p>支持多行，使用 Axis.vertical 以允许多行。TextField 超过行限制可以变成滚动视图。</p>
<p>今年 TextField 可以嵌到 <code>.alert</code> 里了。</p>
<h4 id="Button"><a href="#Button" class="headerlink" title="Button"></a>Button</h4><p><img  srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://user-images.githubusercontent.com/251980/155062538-108a79b4-3e5c-417b-867a-3f7e58316664.png" class="lozad post-image"src="https://user-images.githubusercontent.com/251980/155062538-108a79b4-3e5c-417b-867a-3f7e58316664.png"></p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PlayButtonView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> asyncAction<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token operator">-></span> <span class="token class-name">Void</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">try</span> <span class="token keyword">await</span> <span class="token class-name">Task</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>nanoseconds<span class="token punctuation">:</span> <span class="token number">300_000_000</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> isFollowed<span class="token punctuation">:</span> <span class="token class-name">Bool</span> <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">VStack</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 常用方式</span>
            <span class="token class-name">Button</span> <span class="token punctuation">&#123;</span>
                <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Clicked"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span> label<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"ladybug.fill"</span></span><span class="token punctuation">)</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Report Bug"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>

            <span class="token comment">// 图标</span>
            <span class="token class-name">Button</span><span class="token punctuation">(</span>systemIconName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"ladybug.fill"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"bug"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
            <span class="token punctuation">.</span><span class="token function">buttonStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>plain<span class="token punctuation">)</span> <span class="token comment">// 无背景</span>
            <span class="token punctuation">.</span><span class="token function">simultaneousGesture</span><span class="token punctuation">(</span><span class="token class-name">LongPressGesture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">onEnded</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token omit keyword">_</span> <span class="token keyword">in</span>
                <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"长按"</span></span><span class="token punctuation">)</span> <span class="token comment">// macOS 暂不支持</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">simultaneousGesture</span><span class="token punctuation">(</span><span class="token class-name">TapGesture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">onEnded</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token omit keyword">_</span> <span class="token keyword">in</span>
                <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"短按"</span></span><span class="token punctuation">)</span> <span class="token comment">// macOS 暂不支持</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            
            
            <span class="token comment">// iOS 15 修改器的使用。role 在 macOS 上暂不支持</span>
            <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"要删除了"</span></span><span class="token punctuation">,</span> role<span class="token punctuation">:</span> <span class="token punctuation">.</span>destructive<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"删除"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
            <span class="token punctuation">.</span><span class="token function">tint</span><span class="token punctuation">(</span><span class="token punctuation">.</span>purple<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">controlSize</span><span class="token punctuation">(</span><span class="token punctuation">.</span>large<span class="token punctuation">)</span> <span class="token comment">// .regular 是默认大小</span>
            <span class="token punctuation">.</span><span class="token function">buttonStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>borderedProminent<span class="token punctuation">)</span> <span class="token comment">// borderedProminent 可显示 tint 的设置。还有 bordered、plain 和 borderless 可选。</span>
            <span class="token punctuation">.</span><span class="token function">clipShape</span><span class="token punctuation">(</span><span class="token class-name">RoundedRectangle</span><span class="token punctuation">(</span>cornerRadius<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">accentColor</span><span class="token punctuation">(</span><span class="token punctuation">.</span>pink<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">buttonBorderShape</span><span class="token punctuation">(</span><span class="token punctuation">.</span>automatic<span class="token punctuation">)</span> <span class="token comment">// 会依据 controlSize 调整边框样式</span>
            <span class="token punctuation">.</span><span class="token function">background</span><span class="token punctuation">(</span><span class="token punctuation">.</span>ultraThinMaterial<span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token class-name">Capsule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 添加材质就像在视图和背景间加了个透明层达到模糊的效果。效果由高到底分别是.ultraThinMaterial、.thinMaterial、.regularMaterial、.thickMaterial、.ultraThickMaterial。</span>
            
            <span class="token comment">// 风格化</span>
            <span class="token class-name">Button</span><span class="token punctuation">(</span>action<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">//</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> label<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"风格化"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>largeTitle<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">buttonStyle</span><span class="token punctuation">(</span><span class="token class-name">PStarmingButtonStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            
            
            <span class="token comment">// 自定义 Button</span>
            <span class="token class-name">PCustomButton</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"点一下触发"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Clicked!"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
            
            <span class="token comment">// 自定义 ButtonStyle</span>
            <span class="token class-name">Button</span> <span class="token punctuation">&#123;</span>
                <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Double Clicked!"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span> label<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"点两下触发"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
            <span class="token punctuation">.</span><span class="token function">buttonStyle</span><span class="token punctuation">(</span><span class="token class-name">PCustomPrimitiveButtonStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

            <span class="token comment">// 将 Text 视图加上另一个 Text 视图中，类型仍还是 Text。</span>
            <span class="token class-name">PCustomButton</span><span class="token punctuation">(</span><span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"点我 "</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">underline</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"别犹豫"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>title<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"🤫悄悄说声，有惊喜"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>footnote<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span><span class="token punctuation">.</span>secondary<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"多 Text 组合标题按钮点击！"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
            
            <span class="token comment">// 异步按钮</span>
            <span class="token class-name">ButtonAsync</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">await</span> <span class="token function">asyncAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                isFollowed <span class="token operator">=</span> <span class="token boolean">true</span>
            <span class="token punctuation">&#125;</span> label<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> isFollowed <span class="token operator">==</span> <span class="token boolean">true</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"已关注"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"关注"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>largeTitle<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">disabled</span><span class="token punctuation">(</span>isFollowed<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">buttonStyle</span><span class="token punctuation">(</span><span class="token class-name">PCustomButtonStyle</span><span class="token punctuation">(</span>backgroundColor<span class="token punctuation">:</span> isFollowed <span class="token operator">==</span> <span class="token boolean">true</span> <span class="token operator">?</span> <span class="token punctuation">.</span>gray <span class="token punctuation">:</span> <span class="token punctuation">.</span>pink<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">background</span><span class="token punctuation">(</span><span class="token class-name">Color</span><span class="token punctuation">.</span>skeumorphismBG<span class="token punctuation">)</span>
        
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// MARK: - 异步操作的按钮</span>
<span class="token keyword">struct</span> <span class="token class-name">ButtonAsync</span><span class="token operator">&lt;</span><span class="token class-name">Label</span><span class="token punctuation">:</span> <span class="token class-name">View</span><span class="token operator">></span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> doAsync<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token operator">-></span> <span class="token class-name">Void</span>
    <span class="token attribute atrule">@ViewBuilder</span> <span class="token keyword">var</span> label<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Label</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> isRunning <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">// 避免连续点击造成重复执行事件</span>
    
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Button</span> <span class="token punctuation">&#123;</span>
            isRunning <span class="token operator">=</span> <span class="token boolean">true</span>
            <span class="token class-name">Task</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">await</span> <span class="token function">doAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                isRunning <span class="token operator">=</span> <span class="token boolean">false</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> label<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
            <span class="token function">label</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">opacity</span><span class="token punctuation">(</span>isRunning <span class="token operator">==</span> <span class="token boolean">true</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> isRunning <span class="token operator">==</span> <span class="token boolean">true</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">ProgressView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">disabled</span><span class="token punctuation">(</span>isRunning<span class="token punctuation">)</span>

    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// MARK: - 扩展 Button</span>
<span class="token comment">// 使用 SFSymbol 做图标</span>
<span class="token keyword">extension</span> <span class="token class-name">Button</span> <span class="token keyword">where</span> <span class="token class-name">Label</span> <span class="token operator">==</span> <span class="token class-name">Image</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span>systemIconName<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> done<span class="token punctuation">:</span> <span class="token attribute atrule">@escaping</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Void</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>action<span class="token punctuation">:</span> done<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> systemIconName<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">renderingMode</span><span class="token punctuation">(</span><span class="token punctuation">.</span>original<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// MARK: - 自定义 Button</span>
<span class="token keyword">struct</span> <span class="token class-name">PCustomButton</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> desTextView<span class="token punctuation">:</span> <span class="token class-name">Text</span>
    <span class="token keyword">let</span> act<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Void</span>
    
    <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> des<span class="token punctuation">:</span> <span class="token class-name">LocalizedStringKey</span><span class="token punctuation">,</span> act<span class="token punctuation">:</span> <span class="token attribute atrule">@escaping</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Void</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>desTextView <span class="token operator">=</span> <span class="token class-name">Text</span><span class="token punctuation">(</span>des<span class="token punctuation">)</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>act <span class="token operator">=</span> act
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Button</span> <span class="token punctuation">&#123;</span>
            <span class="token function">act</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span> label<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
            desTextView<span class="token punctuation">.</span><span class="token function">bold</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">buttonStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>starming<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">extension</span> <span class="token class-name">PCustomButton</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> desTextView<span class="token punctuation">:</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> act<span class="token punctuation">:</span> <span class="token attribute atrule">@escaping</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Void</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>desTextView <span class="token operator">=</span> desTextView
        <span class="token keyword">self</span><span class="token punctuation">.</span>act <span class="token operator">=</span> act
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 点语法使用自定义样式</span>
<span class="token keyword">extension</span> <span class="token class-name">ButtonStyle</span> <span class="token keyword">where</span> <span class="token keyword">Self</span> <span class="token operator">==</span> <span class="token class-name">PCustomButtonStyle</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">var</span> starming<span class="token punctuation">:</span> <span class="token class-name">PCustomButtonStyle</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">PCustomButtonStyle</span><span class="token punctuation">(</span>cornerRadius<span class="token punctuation">:</span> <span class="token number">15</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>


<span class="token comment">// MARK: - ButtonStyle</span>
<span class="token keyword">struct</span> <span class="token class-name">PCustomButtonStyle</span><span class="token punctuation">:</span> <span class="token class-name">ButtonStyle</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> cornerRadius<span class="token punctuation">:</span><span class="token class-name">Double</span> <span class="token operator">=</span> <span class="token number">10</span>
    <span class="token keyword">var</span> backgroundColor<span class="token punctuation">:</span> <span class="token class-name">Color</span> <span class="token operator">=</span> <span class="token punctuation">.</span>pink
    <span class="token keyword">func</span> <span class="token function-definition function">makeBody</span><span class="token punctuation">(</span>configuration<span class="token punctuation">:</span> <span class="token class-name">Configuration</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">HStack</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Spacer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            configuration<span class="token punctuation">.</span>label
            <span class="token class-name">Spacer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">background</span><span class="token punctuation">(</span>
            <span class="token class-name">RoundedRectangle</span><span class="token punctuation">(</span>cornerRadius<span class="token punctuation">:</span> cornerRadius<span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token punctuation">.</span>continuous<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span>backgroundColor<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">shadow</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> configuration<span class="token punctuation">.</span>isPressed <span class="token operator">?</span> <span class="token punctuation">.</span>white <span class="token punctuation">:</span> <span class="token punctuation">.</span>black<span class="token punctuation">,</span> radius<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">opacity</span><span class="token punctuation">(</span>configuration<span class="token punctuation">.</span>isPressed <span class="token operator">?</span> <span class="token number">0.5</span> <span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">scaleEffect</span><span class="token punctuation">(</span>configuration<span class="token punctuation">.</span>isPressed <span class="token operator">?</span> <span class="token number">0.99</span> <span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
        
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// MARK: - PrimitiveButtonStyle</span>
<span class="token keyword">struct</span> <span class="token class-name">PCustomPrimitiveButtonStyle</span><span class="token punctuation">:</span> <span class="token class-name">PrimitiveButtonStyle</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">func</span> <span class="token function-definition function">makeBody</span><span class="token punctuation">(</span>configuration<span class="token punctuation">:</span> <span class="token class-name">Configuration</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 双击触发</span>
        configuration<span class="token punctuation">.</span>label
            <span class="token punctuation">.</span><span class="token function">onTapGesture</span><span class="token punctuation">(</span>count<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                configuration<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        <span class="token comment">// 手势识别</span>
        <span class="token class-name">Button</span><span class="token punctuation">(</span>configuration<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">gesture</span><span class="token punctuation">(</span>
                <span class="token class-name">LongPressGesture</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">onEnded</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token omit keyword">_</span> <span class="token keyword">in</span>
                        configuration<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// MARK: - 风格化</span>
<span class="token keyword">struct</span> <span class="token class-name">PStarmingButtonStyle</span><span class="token punctuation">:</span> <span class="token class-name">ButtonStyle</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> backgroundColor <span class="token operator">=</span> <span class="token class-name">Color</span><span class="token punctuation">.</span>skeumorphismBG
    <span class="token keyword">func</span> <span class="token function-definition function">makeBody</span><span class="token punctuation">(</span>configuration<span class="token punctuation">:</span> <span class="token class-name">Configuration</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">HStack</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Spacer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            configuration<span class="token punctuation">.</span>label
            <span class="token class-name">Spacer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">background</span><span class="token punctuation">(</span>
            <span class="token class-name">ZStack</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">RoundedRectangle</span><span class="token punctuation">(</span>cornerRadius<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token punctuation">.</span>continuous<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">shadow</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token punctuation">.</span>white<span class="token punctuation">,</span> radius<span class="token punctuation">:</span> configuration<span class="token punctuation">.</span>isPressed <span class="token operator">?</span> <span class="token number">7</span> <span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> x<span class="token punctuation">:</span> configuration<span class="token punctuation">.</span>isPressed <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">5</span> <span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> configuration<span class="token punctuation">.</span>isPressed <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">5</span> <span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">shadow</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token punctuation">.</span>black<span class="token punctuation">,</span> radius<span class="token punctuation">:</span> configuration<span class="token punctuation">.</span>isPressed <span class="token operator">?</span> <span class="token number">7</span> <span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> x<span class="token punctuation">:</span> configuration<span class="token punctuation">.</span>isPressed <span class="token operator">?</span> <span class="token number">5</span> <span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> configuration<span class="token punctuation">.</span>isPressed <span class="token operator">?</span> <span class="token number">5</span> <span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">blendMode</span><span class="token punctuation">(</span><span class="token punctuation">.</span>overlay<span class="token punctuation">)</span>
                <span class="token class-name">RoundedRectangle</span><span class="token punctuation">(</span>cornerRadius<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token punctuation">.</span>continuous<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span>backgroundColor<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">scaleEffect</span><span class="token punctuation">(</span>configuration<span class="token punctuation">.</span>isPressed <span class="token operator">?</span> <span class="token number">0.98</span> <span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">extension</span> <span class="token class-name">Color</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">let</span> skeumorphismBG <span class="token operator">=</span> <span class="token class-name">Color</span><span class="token punctuation">(</span>hex<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"f0f0f3"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">extension</span> <span class="token class-name">Color</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span>hex<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">var</span> rgbValue<span class="token punctuation">:</span> <span class="token class-name">UInt64</span> <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token class-name">Scanner</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> hex<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">scanHexInt64</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rgbValue<span class="token punctuation">)</span>

        <span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token punctuation">(</span>rgbValue <span class="token operator">&amp;</span> <span class="token number">0xff0000</span><span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">16</span>
        <span class="token keyword">let</span> g <span class="token operator">=</span> <span class="token punctuation">(</span>rgbValue <span class="token operator">&amp;</span> <span class="token number">0xff00</span><span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">8</span>
        <span class="token keyword">let</span> b <span class="token operator">=</span> rgbValue <span class="token operator">&amp;</span> <span class="token number">0xff</span>

        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>red<span class="token punctuation">:</span> <span class="token class-name">Double</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">0xff</span><span class="token punctuation">,</span> green<span class="token punctuation">:</span> <span class="token class-name">Double</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">0xff</span><span class="token punctuation">,</span> blue<span class="token punctuation">:</span> <span class="token class-name">Double</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">0xff</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>.buttonStyle</code> 可组合，示例如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PButtonStyleComposition</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> isT <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Section</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"标签"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">VStack</span><span class="token punctuation">(</span>alignment<span class="token punctuation">:</span> <span class="token punctuation">.</span>leading<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">HStack</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Toggle</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Swift"</span></span><span class="token punctuation">,</span> isOn<span class="token punctuation">:</span> $isT<span class="token punctuation">)</span>
                    <span class="token class-name">Toggle</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"SwiftUI"</span></span><span class="token punctuation">,</span> isOn<span class="token punctuation">:</span> $isT<span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
                <span class="token class-name">HStack</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Toggle</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Swift Chart"</span></span><span class="token punctuation">,</span> isOn<span class="token punctuation">:</span> $isT<span class="token punctuation">)</span>
                    <span class="token class-name">Toggle</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Navigation API"</span></span><span class="token punctuation">,</span> isOn<span class="token punctuation">:</span> $isT<span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token punctuation">.</span><span class="token function">toggleStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>button<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">buttonStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>bordered<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Tap Location 可以获取点击的位置，示例代码如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token class-name">Rectangle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">.</span>green<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">onTapGesture</span><span class="token punctuation">(</span>coordinateSpace<span class="token punctuation">:</span> <span class="token punctuation">.</span>global<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> location <span class="token keyword">in</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Tap in </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">location</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>其中 coordinateSpace 指定为 <code>.global</code> 表示位置是相对屏幕左上角，默认是相对当前视图的左上角的位置。</p>
<h4 id="进度"><a href="#进度" class="headerlink" title="进度"></a>进度</h4><p><img  srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://user-images.githubusercontent.com/251980/155676571-726c15d1-e4a2-4493-8fb0-c37c1c61c88c.jpeg" class="lozad post-image"src="https://user-images.githubusercontent.com/251980/155676571-726c15d1-e4a2-4493-8fb0-c37c1c61c88c.jpeg"></p>
<p>用 ProgressViewStyle 协议，可以创建自定义的进度条视图。在 WatchOS 上会多一个 Guage 视图。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PlayProgressView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> v<span class="token punctuation">:</span> <span class="token class-name">CGFloat</span> <span class="token operator">=</span> <span class="token number">0.0</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">VStack</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 默认旋转</span>
            <span class="token class-name">ProgressView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            <span class="token comment">// 有进度条</span>
            <span class="token class-name">ProgressView</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> v <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">tint</span><span class="token punctuation">(</span><span class="token punctuation">.</span>yellow<span class="token punctuation">)</span>
            
            <span class="token class-name">ProgressView</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> v <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"music.note.tv"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
            <span class="token punctuation">.</span><span class="token function">progressViewStyle</span><span class="token punctuation">(</span><span class="token class-name">CircularProgressViewStyle</span><span class="token punctuation">(</span>tint<span class="token punctuation">:</span> <span class="token punctuation">.</span>pink<span class="token punctuation">)</span><span class="token punctuation">)</span>
            
            <span class="token comment">// 自定义样式</span>
            <span class="token class-name">ProgressView</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> v <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">.</span>vertical<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">progressViewStyle</span><span class="token punctuation">(</span><span class="token class-name">PCProgressStyle1</span><span class="token punctuation">(</span>borderWidth<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            
            <span class="token class-name">ProgressView</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> v <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">progressViewStyle</span><span class="token punctuation">(</span><span class="token class-name">PCProgressStyle2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span><span class="token number">200</span><span class="token punctuation">)</span>
            
            <span class="token class-name">Slider</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> $v<span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token operator">...</span><span class="token number">100</span><span class="token punctuation">,</span> step<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 自定义 Progress 样式</span>
<span class="token keyword">struct</span> <span class="token class-name">PCProgressStyle1</span><span class="token punctuation">:</span> <span class="token class-name">ProgressViewStyle</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> lg <span class="token operator">=</span> <span class="token class-name">LinearGradient</span><span class="token punctuation">(</span>colors<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">.</span>purple<span class="token punctuation">,</span> <span class="token punctuation">.</span>black<span class="token punctuation">,</span> <span class="token punctuation">.</span>blue<span class="token punctuation">]</span><span class="token punctuation">,</span> startPoint<span class="token punctuation">:</span> <span class="token punctuation">.</span>topLeading<span class="token punctuation">,</span> endPoint<span class="token punctuation">:</span> <span class="token punctuation">.</span>bottomTrailing<span class="token punctuation">)</span>
    <span class="token keyword">var</span> borderWidth<span class="token punctuation">:</span> <span class="token class-name">Double</span> <span class="token operator">=</span> <span class="token number">2</span>
    
    <span class="token keyword">func</span> <span class="token function-definition function">makeBody</span><span class="token punctuation">(</span>configuration<span class="token punctuation">:</span> <span class="token class-name">Configuration</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> fc <span class="token operator">=</span> configuration<span class="token punctuation">.</span>fractionCompleted <span class="token operator">??</span> <span class="token number">0</span>
        
        <span class="token keyword">return</span> <span class="token class-name">VStack</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">ZStack</span><span class="token punctuation">(</span>alignment<span class="token punctuation">:</span> <span class="token punctuation">.</span>topLeading<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">GeometryReader</span> <span class="token punctuation">&#123;</span> g <span class="token keyword">in</span>
                    <span class="token class-name">Rectangle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span>lg<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>maxWidth<span class="token punctuation">:</span> g<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token class-name">CGFloat</span><span class="token punctuation">(</span>fc<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">cornerRadius</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">overlay</span><span class="token punctuation">(</span>
                <span class="token class-name">RoundedRectangle</span><span class="token punctuation">(</span>cornerRadius<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span>lg<span class="token punctuation">,</span> lineWidth<span class="token punctuation">:</span> borderWidth<span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
            <span class="token comment">// end ZStack</span>
        <span class="token punctuation">&#125;</span> <span class="token comment">// end VStack</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">struct</span> <span class="token class-name">PCProgressStyle2</span><span class="token punctuation">:</span> <span class="token class-name">ProgressViewStyle</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> lg <span class="token operator">=</span> <span class="token class-name">LinearGradient</span><span class="token punctuation">(</span>colors<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">.</span>orange<span class="token punctuation">,</span> <span class="token punctuation">.</span>yellow<span class="token punctuation">,</span> <span class="token punctuation">.</span>green<span class="token punctuation">,</span> <span class="token punctuation">.</span>blue<span class="token punctuation">,</span> <span class="token punctuation">.</span>purple<span class="token punctuation">]</span><span class="token punctuation">,</span> startPoint<span class="token punctuation">:</span> <span class="token punctuation">.</span>topLeading<span class="token punctuation">,</span> endPoint<span class="token punctuation">:</span> <span class="token punctuation">.</span>bottomTrailing<span class="token punctuation">)</span>
    
    <span class="token keyword">var</span> borderWidth<span class="token punctuation">:</span> <span class="token class-name">Double</span> <span class="token operator">=</span> <span class="token number">20</span>
    
    <span class="token keyword">func</span> <span class="token function-definition function">makeBody</span><span class="token punctuation">(</span>configuration<span class="token punctuation">:</span> <span class="token class-name">Configuration</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> fc <span class="token operator">=</span> configuration<span class="token punctuation">.</span>fractionCompleted <span class="token operator">??</span> <span class="token number">0</span>
        
        <span class="token keyword">func</span> <span class="token function-definition function">strokeStyle</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> g<span class="token punctuation">:</span> <span class="token class-name">GeometryProxy</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">StrokeStyle</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">StrokeStyle</span><span class="token punctuation">(</span>lineWidth<span class="token punctuation">:</span> <span class="token number">0.1</span> <span class="token operator">*</span> <span class="token function">min</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width<span class="token punctuation">,</span> g<span class="token punctuation">.</span>size<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">,</span> lineCap<span class="token punctuation">:</span> <span class="token punctuation">.</span>round<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        
        <span class="token keyword">return</span> <span class="token class-name">VStack</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">GeometryReader</span> <span class="token punctuation">&#123;</span> g <span class="token keyword">in</span>
                <span class="token class-name">ZStack</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Group</span> <span class="token punctuation">&#123;</span>
                        <span class="token class-name">Circle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> to<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span>lg<span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token function">strokeStyle</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span>borderWidth<span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">opacity</span><span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">)</span>
                        <span class="token class-name">Circle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> to<span class="token punctuation">:</span> fc<span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span>lg<span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token function">strokeStyle</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span>borderWidth<span class="token punctuation">)</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">.</span><span class="token function">rotationEffect</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">degrees</span><span class="token punctuation">(</span><span class="token number">90</span> <span class="token operator">+</span> <span class="token number">360</span> <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> anchor<span class="token punctuation">:</span> <span class="token punctuation">.</span>center<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0.1</span> <span class="token operator">*</span> <span class="token function">min</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width<span class="token punctuation">,</span> g<span class="token punctuation">.</span>size<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
                
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"读取 </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation"><span class="token class-name">Int</span><span class="token punctuation">(</span>fc <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> %"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">bold</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>headline<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
            <span class="token comment">// end ZStack</span>
        <span class="token punctuation">&#125;</span> <span class="token comment">// end VStack</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>SwiftUI 引入一个新显示进度的视图 Gauge。</p>
<p>简单示例如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PGauge</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> progress <span class="token operator">=</span> <span class="token number">0.45</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Gauge</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> progress<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"进度"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span> currentValueLabel<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span>progress<span class="token punctuation">.</span><span class="token function">formatted</span><span class="token punctuation">(</span><span class="token punctuation">.</span>percent<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span> minimumValueLabel<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token function">formatted</span><span class="token punctuation">(</span><span class="token punctuation">.</span>percent<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span> maximumValueLabel<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">.</span><span class="token function">formatted</span><span class="token punctuation">(</span><span class="token punctuation">.</span>percent<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        
        <span class="token class-name">Gauge</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> progress<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            
        <span class="token punctuation">&#125;</span> currentValueLabel<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span>progress<span class="token punctuation">.</span><span class="token function">formatted</span><span class="token punctuation">(</span><span class="token punctuation">.</span>percent<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>footnote<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">gaugeStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>accessoryCircularCapacity<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">tint</span><span class="token punctuation">(</span><span class="token punctuation">.</span>cyan<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="Image"><a href="#Image" class="headerlink" title="Image"></a>Image</h4><p><img  srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://user-images.githubusercontent.com/251980/155683776-0f0acdee-c7c1-44e3-a68b-38f778863821.png" class="lozad post-image"src="https://user-images.githubusercontent.com/251980/155683776-0f0acdee-c7c1-44e3-a68b-38f778863821.png"></p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PlayImageView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"logo"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">resizable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">)</span>
        
        <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"logo"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">resizable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">aspectRatio</span><span class="token punctuation">(</span>contentMode<span class="token punctuation">:</span> <span class="token punctuation">.</span>fit<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">clipShape</span><span class="token punctuation">(</span><span class="token class-name">Circle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">overlay</span><span class="token punctuation">(</span>
                <span class="token class-name">Circle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">.</span>cyan<span class="token punctuation">,</span> lineWidth<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">shadow</span><span class="token punctuation">(</span>radius<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">)</span>
        
        <span class="token comment">// SF Symbols</span>
        <span class="token class-name">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"scissors"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">imageScale</span><span class="token punctuation">(</span><span class="token punctuation">.</span>large<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span><span class="token punctuation">.</span>pink<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">40</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">40</span><span class="token punctuation">)</span>
        
        <span class="token comment">// SF Symbols 多色时使用原色</span>
        <span class="token class-name">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"thermometer.sun.fill"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">renderingMode</span><span class="token punctuation">(</span><span class="token punctuation">.</span>original<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">imageScale</span><span class="token punctuation">(</span><span class="token punctuation">.</span>large<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="ControlGroup"><a href="#ControlGroup" class="headerlink" title="ControlGroup"></a>ControlGroup</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PlayControlGroupView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ControlGroup</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Button</span> <span class="token punctuation">&#123;</span>
                <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"plus"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span> label<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"plus"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>

            <span class="token class-name">Button</span> <span class="token punctuation">&#123;</span>
                <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"minus"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span> label<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"minus"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">controlGroupStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>automatic<span class="token punctuation">)</span> <span class="token comment">// .automatic 是默认样式，还有 .navigation</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="GroupBox"><a href="#GroupBox" class="headerlink" title="GroupBox"></a>GroupBox</h4><p><img  srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://user-images.githubusercontent.com/251980/155317172-dc137c38-64d0-415a-8412-e3f479f2bd91.png" class="lozad post-image"src="https://user-images.githubusercontent.com/251980/155317172-dc137c38-64d0-415a-8412-e3f479f2bd91.png"></p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PlayGroupBoxView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">GroupBox</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"这是 GroupBox 的内容"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span> label<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Label</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"标题一"</span></span><span class="token punctuation">,</span> systemImage<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"t.square.fill"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token class-name">GroupBox</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"还是 GroupBox 的内容"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span> label<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Label</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"标题二"</span></span><span class="token punctuation">,</span> systemImage<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"t.square.fill"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">groupBoxStyle</span><span class="token punctuation">(</span><span class="token class-name">PCGroupBoxStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">struct</span> <span class="token class-name">PCGroupBoxStyle</span><span class="token punctuation">:</span> <span class="token class-name">GroupBoxStyle</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">func</span> <span class="token function-definition function">makeBody</span><span class="token punctuation">(</span>configuration<span class="token punctuation">:</span> <span class="token class-name">Configuration</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">VStack</span><span class="token punctuation">(</span>alignment<span class="token punctuation">:</span> <span class="token punctuation">.</span>leading<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            configuration<span class="token punctuation">.</span>label
                <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>title<span class="token punctuation">)</span>
            configuration<span class="token punctuation">.</span>content
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">background</span><span class="token punctuation">(</span><span class="token punctuation">.</span>pink<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">clipShape</span><span class="token punctuation">(</span><span class="token class-name">RoundedRectangle</span><span class="token punctuation">(</span>cornerRadius<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token punctuation">.</span>continuous<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="Stack"><a href="#Stack" class="headerlink" title="Stack"></a>Stack</h4><p>Stack View 有 VStack、HStack 和 ZStack</p>
<p><img  srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://user-images.githubusercontent.com/251980/155077158-f6efd3bb-4b82-48ac-b5e6-792dd833dfda.jpeg" class="lozad post-image"src="https://user-images.githubusercontent.com/251980/155077158-f6efd3bb-4b82-48ac-b5e6-792dd833dfda.jpeg"></p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PlayStackView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 默认是 VStack 竖排</span>
        
        <span class="token comment">// 横排</span>
        <span class="token class-name">HStack</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"左"</span></span><span class="token punctuation">)</span>
            <span class="token class-name">Spacer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"右"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment">// Z 轴排</span>
        <span class="token class-name">ZStack</span><span class="token punctuation">(</span>alignment<span class="token punctuation">:</span> <span class="token punctuation">.</span>top<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"logo"</span></span><span class="token punctuation">)</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"戴铭的开发小册子"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>title<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">bold</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span><span class="token punctuation">.</span>white<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">shadow</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token punctuation">.</span>black<span class="token punctuation">,</span> radius<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        
        <span class="token class-name">Color</span><span class="token punctuation">.</span>cyan
            <span class="token punctuation">.</span><span class="token function">cornerRadius</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">overlay</span><span class="token punctuation">(</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"一段文字"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="Advanced-layout-control"><a href="#Advanced-layout-control" class="headerlink" title="Advanced layout control"></a>Advanced layout control</h4><p>session <a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2022-10056">Compose custom layouts with SwiftUI</a> </p>
<p>提供了新的 Grid 视图来同时满足 VStack 和 HStack。还有一个更低级别 Layout 接口，可以完全控制构建应用所需的布局。另外还有 ViewThatFits 可以自动选择填充可用空间的方式。</p>
<p>Grid 示例代码如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token class-name">Grid</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">GridRow</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"One"</span></span><span class="token punctuation">)</span>
        <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"One"</span></span><span class="token punctuation">)</span>
        <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"One"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token class-name">GridRow</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Two"</span></span><span class="token punctuation">)</span>
        <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Two"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token class-name">Divider</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token class-name">GridRow</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Three"</span></span><span class="token punctuation">)</span>
        <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Three"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">gridCellColumns</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>gridCellColumns()</code>  modifier 可以让一个单元格跨多列。</p>
<p>ViewThatFits 的新视图，允许根据适合的大小放视图。ViewThatFits 会自动选择对于当前屏幕大小合适的子视图进行显示。Ryan Lintott 的<a target="_blank" rel="noopener" href="https://twitter.com/ryanlintott/status/1534706352177700871">示例效果</a> ，对应示例代码 <a target="_blank" rel="noopener" href="https://gist.github.com/ryanlintott/d03140dd155d0493a758dcd284e68eaa">LayoutThatFits.swift</a> 。</p>
<p>新的 Layout 协议可以观看 Swift Talk 第 308 期 <a target="_blank" rel="noopener" href="https://talk.objc.io/episodes/S01E308-the-layout-protocol">The Layout Protocol</a> 。</p>
<p>通过符合 Layout 协议，我们可以自定义一个自定义的布局容器，直接参与 SwiftUI 的布局过程。新的 ProposedViewSize 结构，它是容器视图提供的大小。 <code>Layout.Subviews</code> 是布局视图的子视图代理集合，我们可以在其中为每个子视图请求各种布局属性。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">public</span> <span class="token keyword">protocol</span> <span class="token class-name">Layout</span><span class="token punctuation">:</span> <span class="token class-name">Animatable</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">static</span> <span class="token keyword">var</span> layoutProperties<span class="token punctuation">:</span> <span class="token class-name">LayoutProperties</span> <span class="token punctuation">&#123;</span> <span class="token keyword">get</span> <span class="token punctuation">&#125;</span>
  <span class="token keyword">associatedtype</span> <span class="token class-name">Cache</span> <span class="token operator">=</span> <span class="token class-name">Void</span>
  <span class="token keyword">typealias</span> <span class="token class-name">Subviews</span> <span class="token operator">=</span> <span class="token class-name">LayoutSubviews</span>

  <span class="token keyword">func</span> <span class="token function-definition function">updateCache</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> cache<span class="token punctuation">:</span> <span class="token keyword">inout</span> <span class="token keyword">Self</span><span class="token punctuation">.</span><span class="token class-name">Cache</span><span class="token punctuation">,</span> subviews<span class="token punctuation">:</span> <span class="token keyword">Self</span><span class="token punctuation">.</span><span class="token class-name">Subviews</span><span class="token punctuation">)</span>

  <span class="token keyword">func</span> <span class="token function-definition function">spacing</span><span class="token punctuation">(</span>subviews<span class="token punctuation">:</span> <span class="token keyword">Self</span><span class="token punctuation">.</span><span class="token class-name">Subviews</span><span class="token punctuation">,</span> cache<span class="token punctuation">:</span> <span class="token keyword">inout</span> <span class="token keyword">Self</span><span class="token punctuation">.</span><span class="token class-name">Cache</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">ViewSpacing</span>

  <span class="token comment">/// We return our view size here, use the passed parameters for computing the</span>
  <span class="token comment">/// layout.</span>
  <span class="token keyword">func</span> <span class="token function-definition function">sizeThatFits</span><span class="token punctuation">(</span>
    proposal<span class="token punctuation">:</span> <span class="token class-name">ProposedViewSize</span><span class="token punctuation">,</span> 
    subviews<span class="token punctuation">:</span> <span class="token keyword">Self</span><span class="token punctuation">.</span><span class="token class-name">Subviews</span><span class="token punctuation">,</span> 
    cache<span class="token punctuation">:</span> <span class="token keyword">inout</span> <span class="token keyword">Self</span><span class="token punctuation">.</span><span class="token class-name">Cache</span> <span class="token comment">// 👈🏻 use this for calculated data shared among Layout methods</span>
  <span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">CGSize</span>
  
  <span class="token comment">/// Use this to tell your subviews where to appear.</span>
  <span class="token keyword">func</span> <span class="token function-definition function">placeSubviews</span><span class="token punctuation">(</span>
    <span class="token keyword">in</span> bounds<span class="token punctuation">:</span> <span class="token class-name">CGRect</span><span class="token punctuation">,</span> <span class="token comment">// 👈🏻 region where we need to place our subviews into, origin might not be .zero</span>
    proposal<span class="token punctuation">:</span> <span class="token class-name">ProposedViewSize</span><span class="token punctuation">,</span> 
    subviews<span class="token punctuation">:</span> <span class="token keyword">Self</span><span class="token punctuation">.</span><span class="token class-name">Subviews</span><span class="token punctuation">,</span> 
    cache<span class="token punctuation">:</span> <span class="token keyword">inout</span> <span class="token keyword">Self</span><span class="token punctuation">.</span><span class="token class-name">Cache</span>
  <span class="token punctuation">)</span>
  
  <span class="token comment">// ... there are more a couple more optional methods</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>下面例子是一个自定义的水平 stack 视图，为其所有子视图提供其最大子视图的宽度：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">MyEqualWidthHStack</span><span class="token punctuation">:</span> <span class="token class-name">Layout</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">/// Returns a size that the layout container needs to arrange its subviews.</span>
  <span class="token comment">/// - Tag: sizeThatFitsHorizontal</span>
  <span class="token keyword">func</span> <span class="token function-definition function">sizeThatFits</span><span class="token punctuation">(</span>
    proposal<span class="token punctuation">:</span> <span class="token class-name">ProposedViewSize</span><span class="token punctuation">,</span>
    subviews<span class="token punctuation">:</span> <span class="token class-name">Subviews</span><span class="token punctuation">,</span>
    cache<span class="token punctuation">:</span> <span class="token keyword">inout</span> <span class="token class-name">Void</span>
  <span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">CGSize</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">guard</span> <span class="token operator">!</span>subviews<span class="token punctuation">.</span>isEmpty <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token punctuation">.</span>zero <span class="token punctuation">&#125;</span>

    <span class="token keyword">let</span> maxSize <span class="token operator">=</span> <span class="token function">maxSize</span><span class="token punctuation">(</span>subviews<span class="token punctuation">:</span> subviews<span class="token punctuation">)</span>
    <span class="token keyword">let</span> spacing <span class="token operator">=</span> <span class="token function">spacing</span><span class="token punctuation">(</span>subviews<span class="token punctuation">:</span> subviews<span class="token punctuation">)</span>
    <span class="token keyword">let</span> totalSpacing <span class="token operator">=</span> spacing<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token short-argument">$0</span> <span class="token operator">+</span> <span class="token short-argument">$1</span> <span class="token punctuation">&#125;</span>

    <span class="token keyword">return</span> <span class="token class-name">CGSize</span><span class="token punctuation">(</span>
      width<span class="token punctuation">:</span> maxSize<span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token class-name">CGFloat</span><span class="token punctuation">(</span>subviews<span class="token punctuation">.</span>count<span class="token punctuation">)</span> <span class="token operator">+</span> totalSpacing<span class="token punctuation">,</span>
      height<span class="token punctuation">:</span> maxSize<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>

  <span class="token comment">/// Places the stack's subviews.</span>
  <span class="token comment">/// - Tag: placeSubviewsHorizontal</span>
  <span class="token keyword">func</span> <span class="token function-definition function">placeSubviews</span><span class="token punctuation">(</span>
    <span class="token keyword">in</span> bounds<span class="token punctuation">:</span> <span class="token class-name">CGRect</span><span class="token punctuation">,</span>
    proposal<span class="token punctuation">:</span> <span class="token class-name">ProposedViewSize</span><span class="token punctuation">,</span>
    subviews<span class="token punctuation">:</span> <span class="token class-name">Subviews</span><span class="token punctuation">,</span>
    cache<span class="token punctuation">:</span> <span class="token keyword">inout</span> <span class="token class-name">Void</span>
  <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">guard</span> <span class="token operator">!</span>subviews<span class="token punctuation">.</span>isEmpty <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token punctuation">&#125;</span>

    <span class="token keyword">let</span> maxSize <span class="token operator">=</span> <span class="token function">maxSize</span><span class="token punctuation">(</span>subviews<span class="token punctuation">:</span> subviews<span class="token punctuation">)</span>
    <span class="token keyword">let</span> spacing <span class="token operator">=</span> <span class="token function">spacing</span><span class="token punctuation">(</span>subviews<span class="token punctuation">:</span> subviews<span class="token punctuation">)</span>

    <span class="token keyword">let</span> placementProposal <span class="token operator">=</span> <span class="token class-name">ProposedViewSize</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> maxSize<span class="token punctuation">.</span>width<span class="token punctuation">,</span> height<span class="token punctuation">:</span> maxSize<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
    <span class="token keyword">var</span> nextX <span class="token operator">=</span> bounds<span class="token punctuation">.</span>minX <span class="token operator">+</span> maxSize<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span>

    <span class="token keyword">for</span> index <span class="token keyword">in</span> subviews<span class="token punctuation">.</span>indices <span class="token punctuation">&#123;</span>
      subviews<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">place</span><span class="token punctuation">(</span>
        at<span class="token punctuation">:</span> <span class="token class-name">CGPoint</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> nextX<span class="token punctuation">,</span> y<span class="token punctuation">:</span> bounds<span class="token punctuation">.</span>midY<span class="token punctuation">)</span><span class="token punctuation">,</span>
        anchor<span class="token punctuation">:</span> <span class="token punctuation">.</span>center<span class="token punctuation">,</span>
        proposal<span class="token punctuation">:</span> placementProposal<span class="token punctuation">)</span>
      nextX <span class="token operator">+=</span> maxSize<span class="token punctuation">.</span>width <span class="token operator">+</span> spacing<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token comment">/// Finds the largest ideal size of the subviews.</span>
  <span class="token keyword">private</span> <span class="token keyword">func</span> <span class="token function-definition function">maxSize</span><span class="token punctuation">(</span>subviews<span class="token punctuation">:</span> <span class="token class-name">Subviews</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">CGSize</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> subviewSizes <span class="token operator">=</span> subviews<span class="token punctuation">.</span>map <span class="token punctuation">&#123;</span> <span class="token short-argument">$0</span><span class="token punctuation">.</span><span class="token function">sizeThatFits</span><span class="token punctuation">(</span><span class="token punctuation">.</span>unspecified<span class="token punctuation">)</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">let</span> maxSize<span class="token punctuation">:</span> <span class="token class-name">CGSize</span> <span class="token operator">=</span> subviewSizes<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">.</span>zero<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> currentMax<span class="token punctuation">,</span> subviewSize <span class="token keyword">in</span>
      <span class="token class-name">CGSize</span><span class="token punctuation">(</span>
        width<span class="token punctuation">:</span> <span class="token function">max</span><span class="token punctuation">(</span>currentMax<span class="token punctuation">.</span>width<span class="token punctuation">,</span> subviewSize<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">,</span>
        height<span class="token punctuation">:</span> <span class="token function">max</span><span class="token punctuation">(</span>currentMax<span class="token punctuation">.</span>height<span class="token punctuation">,</span> subviewSize<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">return</span> maxSize
  <span class="token punctuation">&#125;</span>

  <span class="token comment">/// Gets an array of preferred spacing sizes between subviews in the</span>
  <span class="token comment">/// horizontal dimension.</span>
  <span class="token keyword">private</span> <span class="token keyword">func</span> <span class="token function-definition function">spacing</span><span class="token punctuation">(</span>subviews<span class="token punctuation">:</span> <span class="token class-name">Subviews</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">[</span><span class="token class-name">CGFloat</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>
    subviews<span class="token punctuation">.</span>indices<span class="token punctuation">.</span>map <span class="token punctuation">&#123;</span> index <span class="token keyword">in</span>
      <span class="token keyword">guard</span> index <span class="token operator">&lt;</span> subviews<span class="token punctuation">.</span>count <span class="token operator">-</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span>
      <span class="token keyword">return</span> subviews<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>spacing<span class="token punctuation">.</span><span class="token function">distance</span><span class="token punctuation">(</span>
        to<span class="token punctuation">:</span> subviews<span class="token punctuation">[</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>spacing<span class="token punctuation">,</span>
        along<span class="token punctuation">:</span> <span class="token punctuation">.</span>horizontal<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>自定义 layout 只能访问子视图代理 <code>Layout.Subviews</code> ，而不是视图或数据模型。我们可以通过 LayoutValueKey 在每个子视图上存储自定义值，通过 <code>layoutValue(key:value:)</code> modifier 设置。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">private</span> <span class="token keyword">struct</span> <span class="token class-name">Rank</span><span class="token punctuation">:</span> <span class="token class-name">LayoutValueKey</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">static</span> <span class="token keyword">let</span> defaultValue<span class="token punctuation">:</span> <span class="token class-name">Int</span> <span class="token operator">=</span> <span class="token number">1</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">extension</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">func</span> <span class="token function-definition function">rank</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> value<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 👈🏻 convenience method</span>
    <span class="token function">layoutValue</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> <span class="token class-name">Rank</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> value<span class="token punctuation">)</span> <span class="token comment">// 👈🏻 the new modifier</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>然后，我们就可以通过 Layout 方法中的 <code>Layout.Subviews</code> 代理读取自定义 <code>LayoutValueKey</code> 值：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">func</span> <span class="token function-definition function">placeSubviews</span><span class="token punctuation">(</span>
  <span class="token keyword">in</span> bounds<span class="token punctuation">:</span> <span class="token class-name">CGRect</span><span class="token punctuation">,</span>
  proposal<span class="token punctuation">:</span> <span class="token class-name">ProposedViewSize</span><span class="token punctuation">,</span>
  subviews<span class="token punctuation">:</span> <span class="token class-name">Subviews</span><span class="token punctuation">,</span>
  cache<span class="token punctuation">:</span> <span class="token keyword">inout</span> <span class="token class-name">Void</span>
<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> ranks <span class="token operator">=</span> subviews<span class="token punctuation">.</span>map <span class="token punctuation">&#123;</span> subview <span class="token keyword">in</span>
    subview<span class="token punctuation">[</span><span class="token class-name">Rank</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">]</span> <span class="token comment">// 👈🏻</span>
  <span class="token punctuation">&#125;</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>要在布局之间变化使用动画，需要用 AnyLayout，代码示例如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PAnyLayout</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> isVertical <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> layout <span class="token operator">=</span> isVertical <span class="token operator">?</span> <span class="token class-name">AnyLayout</span><span class="token punctuation">(</span><span class="token class-name">VStack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token class-name">AnyLayout</span><span class="token punctuation">(</span><span class="token class-name">HStack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        layout <span class="token punctuation">&#123;</span>
            <span class="token class-name">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"star"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span><span class="token punctuation">.</span>yellow<span class="token punctuation">)</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Starming.com"</span></span><span class="token punctuation">)</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"戴铭"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Click"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            withAnimation <span class="token punctuation">&#123;</span>
                isVertical<span class="token punctuation">.</span><span class="token function">toggle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token comment">// end button</span>
    <span class="token punctuation">&#125;</span> <span class="token comment">// end body</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>同时 Text 和图片也支持了样式布局变化，代码示例如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PTextTransitionsView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> expandMessage <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">private</span> <span class="token keyword">let</span> mintWithShadow<span class="token punctuation">:</span> <span class="token class-name">AnyShapeStyle</span> <span class="token operator">=</span> <span class="token class-name">AnyShapeStyle</span><span class="token punctuation">(</span><span class="token class-name">Color</span><span class="token punctuation">.</span>mint<span class="token punctuation">.</span><span class="token function">shadow</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">drop</span><span class="token punctuation">(</span>radius<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">let</span> primaryWithoutShadow<span class="token punctuation">:</span> <span class="token class-name">AnyShapeStyle</span> <span class="token operator">=</span> <span class="token class-name">AnyShapeStyle</span><span class="token punctuation">(</span><span class="token class-name">Color</span><span class="token punctuation">.</span>primary<span class="token punctuation">.</span><span class="token function">shadow</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">drop</span><span class="token punctuation">(</span>radius<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Dai Ming Swift Pamphlet"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span>expandMessage <span class="token operator">?</span> <span class="token punctuation">.</span>largeTitle<span class="token punctuation">.</span><span class="token function">weight</span><span class="token punctuation">(</span><span class="token punctuation">.</span>heavy<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">.</span>body<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">foregroundStyle</span><span class="token punctuation">(</span>expandMessage <span class="token operator">?</span> mintWithShadow <span class="token punctuation">:</span> primaryWithoutShadow<span class="token punctuation">)</span>
            <span class="token punctuation">.</span>onTapGesture <span class="token punctuation">&#123;</span> withAnimation <span class="token punctuation">&#123;</span> expandMessage<span class="token punctuation">.</span><span class="token function">toggle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
            <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>maxWidth<span class="token punctuation">:</span> expandMessage <span class="token operator">?</span> <span class="token number">150</span> <span class="token punctuation">:</span> <span class="token number">250</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">drawingGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">background</span><span class="token punctuation">(</span><span class="token punctuation">.</span>cyan<span class="token punctuation">.</span><span class="token function">opacity</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token class-name">RoundedRectangle</span><span class="token punctuation">(</span>cornerRadius<span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="Navigation"><a href="#Navigation" class="headerlink" title="Navigation"></a>Navigation</h4><p>控制导航启动状态、管理 size class 之间的 transition 和响应 deep link。</p>
<p>Navigation bar 有新的默认行为，如果没有提供标题，导航栏默认为 inline  title 显示模式。使用 <code>navigationBarTitleDisplayMode(_:)</code> 改变显示模式。如果 navigation bar  没有标题、工具栏项或搜索内容，它就会自动隐藏。使用 <code>.toolbar(.visible)</code> modifier 显示一个空 navigation bar。</p>
<p>参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/swiftui/migrating-to-new-navigation-types?changes=latest_minor">Migrating to New Navigation Types</a> 官方迁移指南</li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/swiftui/navigationstack?changes=latest_minor">NavigationStack</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/swiftui/navigationsplitview">NavigationSplitView</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2022/10054/">The SwiftUI cookbook for navigation</a></li>
</ul>
<p>NavigationStack 的示例：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PNavigationStack</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span> <span class="token comment">// 深层链接</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">NavigationStack</span><span class="token punctuation">(</span>path<span class="token punctuation">:</span> $a<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">List</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">..&lt;</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> i <span class="token keyword">in</span>
                <span class="token class-name">NavigationLink</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Label</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"第 </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> 行"</span></span><span class="token punctuation">,</span> systemImage<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">.circle"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token punctuation">.</span><span class="token function">navigationDestination</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> i <span class="token keyword">in</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"第 </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> 行内容"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
            <span class="token punctuation">.</span><span class="token function">navigationTitle</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"NavigationStack Demo"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这里的 path 设置了 stack 的深度路径。</p>
<p>NavigationSplitView 两栏的例子：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PNavigationSplitViewTwoColumn</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"three"</span></span><span class="token punctuation">]</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> choice<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token operator">?</span>
    
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">NavigationSplitView</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">List</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token punctuation">\</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">,</span> selection<span class="token punctuation">:</span> $choice<span class="token punctuation">,</span> rowContent<span class="token punctuation">:</span> <span class="token class-name">Text</span><span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span> detail<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span>choice <span class="token operator">??</span> <span class="token string-literal"><span class="token string">"选一个"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>NavigationSplitView 三栏的例子：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PNavigationSplitViewThreeColumn</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">struct</span> <span class="token class-name">Group</span><span class="token punctuation">:</span> <span class="token class-name">Identifiable</span><span class="token punctuation">,</span> <span class="token class-name">Hashable</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token function">UUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">var</span> title<span class="token punctuation">:</span> <span class="token class-name">String</span>
        <span class="token keyword">var</span> subs<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> gps <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token class-name">Group</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"One"</span></span><span class="token punctuation">,</span> subs<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"o1"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"o2"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"o3"</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">Group</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Two"</span></span><span class="token punctuation">,</span> subs<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"t1"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"t2"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"t3"</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
    
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> choiceGroup<span class="token punctuation">:</span> <span class="token class-name">Group</span><span class="token operator">?</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> choiceSub<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token operator">?</span>
    
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> cv <span class="token operator">=</span> <span class="token class-name">NavigationSplitViewVisibility</span><span class="token punctuation">.</span>automatic
    
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">NavigationSplitView</span><span class="token punctuation">(</span>columnVisibility<span class="token punctuation">:</span> $cv<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">List</span><span class="token punctuation">(</span>gps<span class="token punctuation">,</span> selection<span class="token punctuation">:</span> $choiceGroup<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> g <span class="token keyword">in</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
            <span class="token punctuation">.</span><span class="token function">navigationSplitViewColumnWidth</span><span class="token punctuation">(</span><span class="token number">250</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span> content<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">List</span><span class="token punctuation">(</span>choiceGroup<span class="token operator">?</span><span class="token punctuation">.</span>subs <span class="token operator">??</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token punctuation">\</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">,</span> selection<span class="token punctuation">:</span> $choiceSub<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> s <span class="token keyword">in</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> detail<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span>choiceSub <span class="token operator">??</span> <span class="token string-literal"><span class="token string">"选一个"</span></span><span class="token punctuation">)</span>
            <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"点击"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                cv <span class="token operator">=</span> <span class="token punctuation">.</span>all
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">navigationSplitViewStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>prominentDetail<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>navigationSplitViewColumnWidth() </code> 是用来自定义宽的，<code>navigationSplitViewStyle</code> 设置为 <code>.prominentDetail</code> 是让 detail 的视图尽量保持其大小。</p>
<p>SwiftUI 新加了个<a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/swiftui/presentedwindowcontent/toolbar(_:in:)">功能</a>可以配置是否隐藏 Tabbar，这样在从主页进入下一级时就可以选择不显示底部标签栏了，示例代码如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token class-name">ContentView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toolbar</span><span class="token punctuation">(</span><span class="token punctuation">.</span>hidden<span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>tabBar<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>相比较以前 NavigationView 增强的是 destination 可以根据值的不同类型展示不同的目的页面，示例代码如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PNavigationStackDestination</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">NavigationStack</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">List</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">NavigationLink</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"字符串"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"字符串"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
                <span class="token class-name">NavigationLink</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token class-name">Color</span><span class="token punctuation">.</span>red<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"红色"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token punctuation">.</span><span class="token function">navigationTitle</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"不同类型 Destination"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">navigationDestination</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token class-name">Color</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> c <span class="token keyword">in</span>
                c<span class="token punctuation">.</span><span class="token function">clipShape</span><span class="token punctuation">(</span><span class="token class-name">Circle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
            <span class="token punctuation">.</span><span class="token function">navigationDestination</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> s <span class="token keyword">in</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">s</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> 的 detail"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>对 toolbar 的自定义，示例如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token punctuation">.</span><span class="token function">toolbar</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"toolbar"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">ToolbarItem</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"new"</span></span><span class="token punctuation">,</span> placement<span class="token punctuation">:</span> <span class="token punctuation">.</span>secondaryAction<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Button</span><span class="token punctuation">(</span>action<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Label</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"New Invitation"</span></span><span class="token punctuation">,</span> systemImage<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"envelope"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">.</span><span class="token function">toolbarRole</span><span class="token punctuation">(</span><span class="token punctuation">.</span>editor<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>以下是废弃的 NavigationView 的用法。</p>
<p><img  srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://user-images.githubusercontent.com/251980/155517358-4e5d54b8-0284-4fde-bf09-4b5e22e0e9a5.jpeg" class="lozad post-image"src="https://user-images.githubusercontent.com/251980/155517358-4e5d54b8-0284-4fde-bf09-4b5e22e0e9a5.jpeg"></p>
<p>对应代码如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PlayNavigationView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> lData <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">...</span><span class="token number">10</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">NavigationView</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">ZStack</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">LinearGradient</span><span class="token punctuation">(</span>colors<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">.</span>pink<span class="token punctuation">,</span> <span class="token punctuation">.</span>orange<span class="token punctuation">]</span><span class="token punctuation">,</span> startPoint<span class="token punctuation">:</span> <span class="token punctuation">.</span>topLeading<span class="token punctuation">,</span> endPoint<span class="token punctuation">:</span> <span class="token punctuation">.</span>bottomTrailing<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">ignoresSafeArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                
                <span class="token class-name">List</span><span class="token punctuation">(</span>lData<span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token punctuation">\</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> i <span class="token keyword">in</span>
                    <span class="token class-name">NavigationLink</span> <span class="token punctuation">&#123;</span>
                        <span class="token class-name">PNavDetailView</span><span class="token punctuation">(</span>contentStr<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">&#125;</span> label<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                        <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
            
            <span class="token class-name">ZStack</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">LinearGradient</span><span class="token punctuation">(</span>colors<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">.</span>mint<span class="token punctuation">,</span> <span class="token punctuation">.</span>yellow<span class="token punctuation">]</span><span class="token punctuation">,</span> startPoint<span class="token punctuation">:</span> <span class="token punctuation">.</span>topLeading<span class="token punctuation">,</span> endPoint<span class="token punctuation">:</span> <span class="token punctuation">.</span>bottomTrailing<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">ignoresSafeArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                
                <span class="token class-name">VStack</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"一个 NavigationView 的示例"</span></span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">bold</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>largeTitle<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">shadow</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token punctuation">.</span>white<span class="token punctuation">,</span> radius<span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">,</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">scaleEffect</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token punctuation">.</span><span class="token function">safeAreaInset</span><span class="token punctuation">(</span>edge<span class="token punctuation">:</span> <span class="token punctuation">.</span>bottom<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">HStack</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"bottom1"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
                    <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>headline<span class="token punctuation">)</span>
                    <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"bottom2"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
                    <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"bottom3"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
                    <span class="token class-name">Spacer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
                <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">background</span><span class="token punctuation">(</span><span class="token class-name">LinearGradient</span><span class="token punctuation">(</span>colors<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">.</span>purple<span class="token punctuation">,</span> <span class="token punctuation">.</span>blue<span class="token punctuation">]</span><span class="token punctuation">,</span> startPoint<span class="token punctuation">:</span> <span class="token punctuation">.</span>topLeading<span class="token punctuation">,</span> endPoint<span class="token punctuation">:</span> <span class="token punctuation">.</span>bottomTrailing<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span><span class="token punctuation">.</span>white<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">navigationTitle</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"数字列表"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>toolbar <span class="token punctuation">&#123;</span>
            <span class="token comment">// placement 共有 keyboard、destructiveAction、cancellationAction、confirmationAction、status、primaryAction、navigation、principal、automatic 这些</span>
            <span class="token class-name">ToolbarItem</span><span class="token punctuation">(</span>placement<span class="token punctuation">:</span> <span class="token punctuation">.</span>primaryAction<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"primaryAction"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
                <span class="token punctuation">.</span><span class="token function">background</span><span class="token punctuation">(</span><span class="token punctuation">.</span>ultraThinMaterial<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>headline<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
            <span class="token comment">// 通过 ToolbarItemGroup 可以简化相同位置 ToolbarItem 的编写。</span>
            <span class="token class-name">ToolbarItemGroup</span><span class="token punctuation">(</span>placement<span class="token punctuation">:</span> <span class="token punctuation">.</span>navigation<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"返回"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
                <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"前进"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token class-name">PCToolbar</span><span class="token punctuation">(</span>doDestruct<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"删除了"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> doCancel<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"取消了"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> doConfirm<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"确认了"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            <span class="token class-name">ToolbarItem</span><span class="token punctuation">(</span>placement<span class="token punctuation">:</span> <span class="token punctuation">.</span>status<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"status"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token class-name">ToolbarItem</span><span class="token punctuation">(</span>placement<span class="token punctuation">:</span> <span class="token punctuation">.</span>principal<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"principal"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token class-name">ToolbarItem</span><span class="token punctuation">(</span>placement<span class="token punctuation">:</span> <span class="token punctuation">.</span>keyboard<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Touch Bar Button"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token comment">// end toolbar</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// MARK: - NavigationView 的目的页面</span>
<span class="token keyword">struct</span> <span class="token class-name">PNavDetailView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@Environment</span><span class="token punctuation">(</span><span class="token punctuation">\</span><span class="token punctuation">.</span>presentationMode<span class="token punctuation">)</span> <span class="token keyword">var</span> pMode<span class="token punctuation">:</span> <span class="token class-name">Binding</span><span class="token operator">&lt;</span><span class="token class-name">PresentationMode</span><span class="token operator">></span>
    <span class="token keyword">var</span> contentStr<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ZStack</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">LinearGradient</span><span class="token punctuation">(</span>colors<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">.</span>purple<span class="token punctuation">,</span> <span class="token punctuation">.</span>blue<span class="token punctuation">]</span><span class="token punctuation">,</span> startPoint<span class="token punctuation">:</span> <span class="token punctuation">.</span>topLeading<span class="token punctuation">,</span> endPoint<span class="token punctuation">:</span> <span class="token punctuation">.</span>bottomTrailing<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">ignoresSafeArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token class-name">VStack</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span>contentStr<span class="token punctuation">)</span>
                <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"返回"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    pMode<span class="token punctuation">.</span>wrappedValue<span class="token punctuation">.</span><span class="token function">dismiss</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token comment">// end ZStack</span>
    <span class="token punctuation">&#125;</span> <span class="token comment">// end body</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// MARK: - 自定义 toolbar</span>
<span class="token comment">// 通过 ToolbarContent 创建可重复使用的 toolbar 组</span>
<span class="token keyword">struct</span> <span class="token class-name">PCToolbar</span><span class="token punctuation">:</span> <span class="token class-name">ToolbarContent</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> doDestruct<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Void</span>
    <span class="token keyword">let</span> doCancel<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Void</span>
    <span class="token keyword">let</span> doConfirm<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Void</span>
    
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">ToolbarContent</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ToolbarItem</span><span class="token punctuation">(</span>placement<span class="token punctuation">:</span> <span class="token punctuation">.</span>destructiveAction<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"删除"</span></span><span class="token punctuation">,</span> action<span class="token punctuation">:</span> doDestruct<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">ToolbarItem</span><span class="token punctuation">(</span>placement<span class="token punctuation">:</span> <span class="token punctuation">.</span>cancellationAction<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"取消"</span></span><span class="token punctuation">,</span> action<span class="token punctuation">:</span> doCancel<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">ToolbarItem</span><span class="token punctuation">(</span>placement<span class="token punctuation">:</span> <span class="token punctuation">.</span>confirmationAction<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"确定"</span></span><span class="token punctuation">,</span> action<span class="token punctuation">:</span> doConfirm<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>toolbar 的位置设置可选项如下：</p>
<ul>
<li>primaryAction：放置到最主要位置，macOS 就是放在 toolbar 的最左边</li>
<li>automatic：根据平台不同放到默认位置</li>
<li>confirmationAction：一些确定的动作</li>
<li>cancellationAction：取消动作</li>
<li>destructiveAction：删除的动作</li>
<li>status：状态变化，比如检查更新等动作</li>
<li>navigation：导航动作，比如浏览器的前进后退</li>
<li>principal：突出的位置，iOS 和 macOS 会出现在中间的位置</li>
<li>keyboard：macOS 会出现在 Touch Bar 里。iOS 会出现在弹出的虚拟键盘上。</li>
</ul>
<h4 id="List"><a href="#List" class="headerlink" title="List"></a>List</h4><p><img  srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://user-images.githubusercontent.com/251980/155293565-d85080c1-2304-491b-be72-20aa921f7067.jpeg" class="lozad post-image"src="https://user-images.githubusercontent.com/251980/155293565-d85080c1-2304-491b-be72-20aa921f7067.jpeg"></p>
<p>List 除了能够展示数据外，还有下拉刷新、过滤搜索和侧滑 Swipe 动作提供更多 Cell 操作的能力。</p>
<p>通过 List 的可选子项参数提供数据模型的关键路径来制定子项路劲，还可以实现大纲视图，使用 DisclosureGroup 和 OutlineGroup  可以进一步定制大纲视图。</p>
<p>下面是 List 使用，包括了 DisclosureGroup 和 OutlineGroup 的演示代码：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PlayListView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@StateObject</span> <span class="token keyword">var</span> l<span class="token punctuation">:</span> <span class="token constant">PLVM</span> <span class="token operator">=</span> <span class="token function">PLVM</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> s<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span>
    
    <span class="token keyword">var</span> outlineModel <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token class-name">POutlineModel</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"文件夹一"</span></span><span class="token punctuation">,</span> iconName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"folder.fill"</span></span><span class="token punctuation">,</span> children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token class-name">POutlineModel</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"个人"</span></span><span class="token punctuation">,</span> iconName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"person.crop.circle.fill"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">POutlineModel</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"群组"</span></span><span class="token punctuation">,</span> iconName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"person.2.circle.fill"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">POutlineModel</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"加好友"</span></span><span class="token punctuation">,</span> iconName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"person.badge.plus"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">POutlineModel</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"文件夹二"</span></span><span class="token punctuation">,</span> iconName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"folder.fill"</span></span><span class="token punctuation">,</span> children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token class-name">POutlineModel</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"晴天"</span></span><span class="token punctuation">,</span> iconName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"sun.max.fill"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">POutlineModel</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"夜间"</span></span><span class="token punctuation">,</span> iconName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"moon.fill"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">POutlineModel</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"雨天"</span></span><span class="token punctuation">,</span> iconName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"cloud.rain.fill"</span></span><span class="token punctuation">,</span> children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token class-name">POutlineModel</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"雷加雨"</span></span><span class="token punctuation">,</span> iconName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"cloud.bolt.rain.fill"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">POutlineModel</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"太阳雨"</span></span><span class="token punctuation">,</span> iconName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"cloud.sun.rain.fill"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">POutlineModel</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"文件夹三"</span></span><span class="token punctuation">,</span> iconName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"folder.fill"</span></span><span class="token punctuation">,</span> children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token class-name">POutlineModel</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"电话"</span></span><span class="token punctuation">,</span> iconName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"phone"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">POutlineModel</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"拍照"</span></span><span class="token punctuation">,</span> iconName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"camera.circle.fill"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">POutlineModel</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"提醒"</span></span><span class="token punctuation">,</span> iconName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"bell"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
    
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">HStack</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// List 通过$语法可以将集合的元素转换成可绑定的值</span>
            <span class="token class-name">List</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">ForEach</span><span class="token punctuation">(</span>$l<span class="token punctuation">.</span>ls<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> $d <span class="token keyword">in</span>
                    <span class="token class-name">PRowView</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> d<span class="token punctuation">.</span>s<span class="token punctuation">,</span> i<span class="token punctuation">:</span> d<span class="token punctuation">.</span>i<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">listRowInsets</span><span class="token punctuation">(</span><span class="token class-name">EdgeInsets</span><span class="token punctuation">(</span>top<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> leading<span class="token punctuation">:</span> <span class="token number">15</span><span class="token punctuation">,</span> bottom<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> trailing<span class="token punctuation">:</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">listRowBackground</span><span class="token punctuation">(</span><span class="token class-name">Color</span><span class="token punctuation">.</span>black<span class="token punctuation">.</span><span class="token function">opacity</span><span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token punctuation">.</span>refreshable <span class="token punctuation">&#123;</span>
                <span class="token comment">// 下拉刷新</span>
            <span class="token punctuation">&#125;</span>
            <span class="token punctuation">.</span><span class="token function">searchable</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> $s<span class="token punctuation">)</span> <span class="token comment">// 搜索</span>
            <span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">(</span>of<span class="token punctuation">:</span> s<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> newValue <span class="token keyword">in</span>
                <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"搜索关键字：</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">s</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
            
            <span class="token class-name">Divider</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            <span class="token comment">// 自定义 List</span>
            <span class="token class-name">VStack</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">PCustomListView</span><span class="token punctuation">(</span>$l<span class="token punctuation">.</span>ls<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> $d <span class="token keyword">in</span>
                    <span class="token class-name">PRowView</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> d<span class="token punctuation">.</span>s<span class="token punctuation">,</span> i<span class="token punctuation">:</span> d<span class="token punctuation">.</span>i<span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
                <span class="token comment">// 添加数据</span>
                <span class="token class-name">Button</span> <span class="token punctuation">&#123;</span>
                    l<span class="token punctuation">.</span>ls<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">PLModel</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"More"</span></span><span class="token punctuation">,</span> i<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span> label<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"添加"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            <span class="token class-name">Divider</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            <span class="token comment">// 使用大纲</span>
            <span class="token class-name">List</span><span class="token punctuation">(</span>outlineModel<span class="token punctuation">,</span> children<span class="token punctuation">:</span> <span class="token punctuation">\</span><span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> i <span class="token keyword">in</span>
                <span class="token class-name">Label</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>title<span class="token punctuation">,</span> systemImage<span class="token punctuation">:</span> i<span class="token punctuation">.</span>iconName<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
            
            <span class="token class-name">Divider</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            <span class="token comment">// 自定义大纲视图</span>
            <span class="token class-name">VStack</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"可点击标题展开"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>headline<span class="token punctuation">)</span>
                <span class="token class-name">PCOutlineListView</span><span class="token punctuation">(</span>d<span class="token punctuation">:</span> outlineModel<span class="token punctuation">,</span> c<span class="token punctuation">:</span> <span class="token punctuation">\</span><span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> i <span class="token keyword">in</span>
                    <span class="token class-name">Label</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>title<span class="token punctuation">,</span> systemImage<span class="token punctuation">:</span> i<span class="token punctuation">.</span>iconName<span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            <span class="token class-name">Divider</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            <span class="token comment">// 使用 OutlineGroup 实现大纲视图</span>
            <span class="token class-name">VStack</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"OutlineGroup 实现大纲"</span></span><span class="token punctuation">)</span>
                
                <span class="token class-name">OutlineGroup</span><span class="token punctuation">(</span>outlineModel<span class="token punctuation">,</span> children<span class="token punctuation">:</span> <span class="token punctuation">\</span><span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> i <span class="token keyword">in</span>
                    <span class="token class-name">Label</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>title<span class="token punctuation">,</span> systemImage<span class="token punctuation">:</span> i<span class="token punctuation">.</span>iconName<span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
                
                <span class="token comment">// OutlineGroup 和 List 结合</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"OutlineGroup 和 List 结合"</span></span><span class="token punctuation">)</span>
                <span class="token class-name">List</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">ForEach</span><span class="token punctuation">(</span>outlineModel<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> s <span class="token keyword">in</span>
                        <span class="token class-name">Section</span> <span class="token punctuation">&#123;</span>
                            <span class="token class-name">OutlineGroup</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>children <span class="token operator">??</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> children<span class="token punctuation">:</span> <span class="token punctuation">\</span><span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> i <span class="token keyword">in</span>
                                <span class="token class-name">Label</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>title<span class="token punctuation">,</span> systemImage<span class="token punctuation">:</span> i<span class="token punctuation">.</span>iconName<span class="token punctuation">)</span>
                            <span class="token punctuation">&#125;</span>
                        <span class="token punctuation">&#125;</span> header<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                            <span class="token class-name">Label</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>title<span class="token punctuation">,</span> systemImage<span class="token punctuation">:</span> s<span class="token punctuation">.</span>iconName<span class="token punctuation">)</span>
                        <span class="token punctuation">&#125;</span>

                    <span class="token punctuation">&#125;</span> <span class="token comment">// end ForEach</span>
                <span class="token punctuation">&#125;</span> <span class="token comment">// end List</span>
            <span class="token punctuation">&#125;</span> <span class="token comment">// end VStack</span>
        <span class="token punctuation">&#125;</span> <span class="token comment">// end HStack</span>
    <span class="token punctuation">&#125;</span> <span class="token comment">// end body</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// MARK: - 自定义大纲视图</span>
<span class="token keyword">struct</span> <span class="token class-name">PCOutlineListView</span><span class="token operator">&lt;</span><span class="token class-name">D</span><span class="token punctuation">,</span> <span class="token class-name">Content</span><span class="token operator">></span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token keyword">where</span> <span class="token class-name">D</span><span class="token punctuation">:</span> <span class="token class-name">RandomAccessCollection</span><span class="token punctuation">,</span> <span class="token class-name">D</span><span class="token punctuation">.</span><span class="token class-name">Element</span><span class="token punctuation">:</span> <span class="token class-name">Identifiable</span><span class="token punctuation">,</span> <span class="token class-name">Content</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token keyword">let</span> v<span class="token punctuation">:</span> <span class="token class-name">PCOutlineView</span><span class="token operator">&lt;</span><span class="token class-name">D</span><span class="token punctuation">,</span> <span class="token class-name">Content</span><span class="token operator">></span>
    
    <span class="token keyword">init</span><span class="token punctuation">(</span>d<span class="token punctuation">:</span> <span class="token class-name">D</span><span class="token punctuation">,</span> c<span class="token punctuation">:</span> <span class="token class-name">KeyPath</span><span class="token operator">&lt;</span><span class="token class-name">D</span><span class="token punctuation">.</span><span class="token class-name">Element</span><span class="token punctuation">,</span> <span class="token class-name">D</span><span class="token operator">?></span><span class="token punctuation">,</span> content<span class="token punctuation">:</span> <span class="token attribute atrule">@escaping</span> <span class="token punctuation">(</span><span class="token class-name">D</span><span class="token punctuation">.</span><span class="token class-name">Element</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Content</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>v <span class="token operator">=</span> <span class="token class-name">PCOutlineView</span><span class="token punctuation">(</span>d<span class="token punctuation">:</span> d<span class="token punctuation">,</span> c<span class="token punctuation">:</span> c<span class="token punctuation">,</span> content<span class="token punctuation">:</span> content<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">List</span> <span class="token punctuation">&#123;</span>
            v
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">struct</span> <span class="token class-name">PCOutlineView</span><span class="token operator">&lt;</span><span class="token class-name">D</span><span class="token punctuation">,</span> <span class="token class-name">Content</span><span class="token operator">></span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token keyword">where</span> <span class="token class-name">D</span><span class="token punctuation">:</span> <span class="token class-name">RandomAccessCollection</span><span class="token punctuation">,</span> <span class="token class-name">D</span><span class="token punctuation">.</span><span class="token class-name">Element</span><span class="token punctuation">:</span> <span class="token class-name">Identifiable</span><span class="token punctuation">,</span> <span class="token class-name">Content</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> d<span class="token punctuation">:</span> <span class="token class-name">D</span>
    <span class="token keyword">let</span> c<span class="token punctuation">:</span> <span class="token class-name">KeyPath</span><span class="token operator">&lt;</span><span class="token class-name">D</span><span class="token punctuation">.</span><span class="token class-name">Element</span><span class="token punctuation">,</span> <span class="token class-name">D</span><span class="token operator">?></span>
    <span class="token keyword">let</span> content<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token class-name">D</span><span class="token punctuation">.</span><span class="token class-name">Element</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Content</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">var</span> isExpanded <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// 控制初始是否展开的状态</span>
    
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ForEach</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> i <span class="token keyword">in</span>
            <span class="token keyword">if</span> <span class="token keyword">let</span> sub <span class="token operator">=</span> i<span class="token punctuation">[</span>keyPath<span class="token punctuation">:</span> c<span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">PCDisclosureGroup</span><span class="token punctuation">(</span>content<span class="token punctuation">:</span> <span class="token class-name">PCOutlineView</span><span class="token punctuation">(</span>d<span class="token punctuation">:</span> sub<span class="token punctuation">,</span> c<span class="token punctuation">:</span> c<span class="token punctuation">,</span> content<span class="token punctuation">:</span> content<span class="token punctuation">)</span><span class="token punctuation">,</span> label<span class="token punctuation">:</span> <span class="token function">content</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token function">content</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span> <span class="token comment">// end if</span>
        <span class="token punctuation">&#125;</span> <span class="token comment">// end ForEach</span>
    <span class="token punctuation">&#125;</span> <span class="token comment">// end body</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">struct</span> <span class="token class-name">PCDisclosureGroup</span><span class="token operator">&lt;</span><span class="token class-name">C</span><span class="token punctuation">,</span> <span class="token class-name">L</span><span class="token operator">></span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token keyword">where</span> <span class="token class-name">C</span><span class="token punctuation">:</span> <span class="token class-name">View</span><span class="token punctuation">,</span> <span class="token class-name">L</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">var</span> isExpanded <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token keyword">var</span> content<span class="token punctuation">:</span> <span class="token class-name">C</span>
    <span class="token keyword">var</span> label<span class="token punctuation">:</span> <span class="token class-name">L</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">DisclosureGroup</span><span class="token punctuation">(</span>isExpanded<span class="token punctuation">:</span> $isExpanded<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            content
        <span class="token punctuation">&#125;</span> label<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Button</span> <span class="token punctuation">&#123;</span>
                isExpanded<span class="token punctuation">.</span><span class="token function">toggle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span> label<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                label
            <span class="token punctuation">&#125;</span>
            <span class="token punctuation">.</span><span class="token function">buttonStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>plain<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// MARK: - 大纲模式数据模型</span>
<span class="token keyword">struct</span> <span class="token class-name">POutlineModel</span><span class="token punctuation">:</span> <span class="token class-name">Hashable</span><span class="token punctuation">,</span> <span class="token class-name">Identifiable</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> id <span class="token operator">=</span> <span class="token function">UUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> title<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">var</span> iconName<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">var</span> children<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">POutlineModel</span><span class="token punctuation">]</span><span class="token operator">?</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// MARK: - List 的抽象，数据兼容任何集合类型</span>
<span class="token keyword">struct</span> <span class="token class-name">PCustomListView</span><span class="token operator">&lt;</span><span class="token class-name">D</span><span class="token punctuation">:</span> <span class="token class-name">RandomAccessCollection</span> <span class="token operator">&amp;</span> <span class="token class-name">MutableCollection</span> <span class="token operator">&amp;</span> <span class="token class-name">RangeReplaceableCollection</span><span class="token punctuation">,</span> <span class="token class-name">Content</span><span class="token punctuation">:</span> <span class="token class-name">View</span><span class="token operator">></span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token keyword">where</span> <span class="token class-name">D</span><span class="token punctuation">.</span><span class="token class-name">Element</span><span class="token punctuation">:</span> <span class="token class-name">Identifiable</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@Binding</span> <span class="token keyword">var</span> data<span class="token punctuation">:</span> <span class="token class-name">D</span>
    <span class="token keyword">var</span> content<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token class-name">Binding</span><span class="token operator">&lt;</span><span class="token class-name">D</span><span class="token punctuation">.</span><span class="token class-name">Element</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Content</span>
    
    <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> data<span class="token punctuation">:</span> <span class="token class-name">Binding</span><span class="token operator">&lt;</span><span class="token class-name">D</span><span class="token operator">></span><span class="token punctuation">,</span> content<span class="token punctuation">:</span> <span class="token attribute atrule">@escaping</span> <span class="token punctuation">(</span><span class="token class-name">Binding</span><span class="token operator">&lt;</span><span class="token class-name">D</span><span class="token punctuation">.</span><span class="token class-name">Element</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Content</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>_data <span class="token operator">=</span> data
        <span class="token keyword">self</span><span class="token punctuation">.</span>content <span class="token operator">=</span> content
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">List</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Section</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">ForEach</span><span class="token punctuation">(</span>$data<span class="token punctuation">,</span> content<span class="token punctuation">:</span> content<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span>onMove <span class="token punctuation">&#123;</span> indexSet<span class="token punctuation">,</span> offset <span class="token keyword">in</span>
                        data<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span>fromOffsets<span class="token punctuation">:</span> indexSet<span class="token punctuation">,</span> toOffset<span class="token punctuation">:</span> offset<span class="token punctuation">)</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">.</span>onDelete <span class="token punctuation">&#123;</span> indexSet <span class="token keyword">in</span>
                        data<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>atOffsets<span class="token punctuation">:</span> indexSet<span class="token punctuation">)</span> <span class="token comment">// macOS 暂不支持</span>
                    <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span> header<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"第一栏，共 </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">data<span class="token punctuation">.</span>count</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> 项"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span> footer<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"The End"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">listStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>plain<span class="token punctuation">)</span> <span class="token comment">// 有.automatic、.inset、.plain、sidebar，macOS 暂不支持的有.grouped 和 .insetGrouped</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// MARK: - Cell 视图</span>
<span class="token keyword">struct</span> <span class="token class-name">PRowView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> s<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">var</span> i<span class="token punctuation">:</span> <span class="token class-name">Int</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">HStack</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">："</span></span><span class="token punctuation">)</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// MARK: - 数据模型设计</span>
<span class="token keyword">struct</span> <span class="token class-name">PLModel</span><span class="token punctuation">:</span> <span class="token class-name">Hashable</span><span class="token punctuation">,</span> <span class="token class-name">Identifiable</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token function">UUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> s<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">var</span> i<span class="token punctuation">:</span> <span class="token class-name">Int</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token constant">PLVM</span><span class="token punctuation">:</span> <span class="token class-name">ObservableObject</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@Published</span> <span class="token keyword">var</span> ls<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">PLModel</span><span class="token punctuation">]</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        ls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">PLModel</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token operator">...</span><span class="token number">20</span> <span class="token punctuation">&#123;</span>
            ls<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">PLModel</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">,</span> i<span class="token punctuation">:</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>list 支持 Section footer。</p>
<p>list 分隔符可以自定义，使用  <code>HorizontalEdge.leading</code> 和 <code>HorizontalEdge.trailing</code> 。</p>
<p>list 不使用 UITableView 了。</p>
<p>今年 list 还新增了一个 <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/swiftui/editoperations">EditOperation</a> 可以自动生成移动和删除，新增了 edits 参数，传入 <code>[.delete, .move]</code> 数组即可。这也是一个演示如何更好扩展和配置功能的方式。</p>
<p><code>.searchable</code> 支持 token 和 scope，示例如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PSearchTokensAndScopes</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">enum</span> <span class="token class-name">AttendanceScope</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">case</span> inPerson<span class="token punctuation">,</span> online
    <span class="token punctuation">&#125;</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> queryText<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> queryTokens<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">InvitationToken</span><span class="token punctuation">]</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> scope<span class="token punctuation">:</span> <span class="token class-name">AttendanceScope</span>
    
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token function">invitationCountView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">searchable</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> $queryText<span class="token punctuation">,</span> tokens<span class="token punctuation">:</span> $queryTokens<span class="token punctuation">,</span> scope<span class="token punctuation">:</span> $scope<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> token <span class="token keyword">in</span>
                <span class="token class-name">Label</span><span class="token punctuation">(</span>token<span class="token punctuation">.</span>diplayName<span class="token punctuation">,</span> systemImage<span class="token punctuation">:</span> token<span class="token punctuation">.</span>systemImage<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span> scopes<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"In Person"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span><span class="token class-name">AttendanceScope</span><span class="token punctuation">.</span>inPerson<span class="token punctuation">)</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Online"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span><span class="token class-name">AttendanceScope</span><span class="token punctuation">.</span>online<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="LazyVStack-和-LazyHStack"><a href="#LazyVStack-和-LazyHStack" class="headerlink" title="LazyVStack 和 LazyHStack"></a>LazyVStack 和 LazyHStack</h4><p>LazyVStack 和 LazyHStack 里的视图只有在滚到时才会被创建。</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PlayLazyVStackAndLazyHStackView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ScrollView</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">LazyVStack</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">ForEach</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">...</span><span class="token number">300</span><span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token punctuation">\</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> i <span class="token keyword">in</span>
                    <span class="token class-name">PLHSRowView</span><span class="token punctuation">(</span>i<span class="token punctuation">:</span> i<span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">struct</span> <span class="token class-name">PLHSRowView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> i<span class="token punctuation">:</span> <span class="token class-name">Int</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"第 </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> 个"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span>i<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"第 </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> 个初始化了"</span></span><span class="token punctuation">)</span> <span class="token comment">// 用来查看什么时候创建的。</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>i <span class="token operator">=</span> i
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="LazyVGrid-和-LazyHGrid"><a href="#LazyVGrid-和-LazyHGrid" class="headerlink" title="LazyVGrid 和 LazyHGrid"></a>LazyVGrid 和 LazyHGrid</h4><p><img  srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://user-images.githubusercontent.com/251980/155708552-35396dcd-f120-4498-a793-a65abd68c0a6.jpeg" class="lozad post-image"src="https://user-images.githubusercontent.com/251980/155708552-35396dcd-f120-4498-a793-a65abd68c0a6.jpeg"></p>
<p>列的设置有三种，这三种也可以组合用。</p>
<ul>
<li>GridItem(.fixed(10)) 会固定设置有多少列。</li>
<li>GridItem(.flexible()) 会充满没有使用的空间。</li>
<li>GridItem(.adaptive(minimum: 10)) 表示会根据设置大小自动设置有多少列展示。</li>
</ul>
<p>示例：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PlayLazyVGridAndLazyHGridView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> colors<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">:</span><span class="token class-name">Color</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string-literal"><span class="token string">"red"</span></span> <span class="token punctuation">:</span> <span class="token punctuation">.</span>red<span class="token punctuation">,</span>
        <span class="token string-literal"><span class="token string">"orange"</span></span> <span class="token punctuation">:</span> <span class="token punctuation">.</span>orange<span class="token punctuation">,</span>
        <span class="token string-literal"><span class="token string">"yellow"</span></span> <span class="token punctuation">:</span> <span class="token punctuation">.</span>yellow<span class="token punctuation">,</span>
        <span class="token string-literal"><span class="token string">"green"</span></span> <span class="token punctuation">:</span> <span class="token punctuation">.</span>green<span class="token punctuation">,</span>
        <span class="token string-literal"><span class="token string">"mint"</span></span> <span class="token punctuation">:</span> <span class="token punctuation">.</span>mint<span class="token punctuation">,</span>
        <span class="token string-literal"><span class="token string">"teal"</span></span> <span class="token punctuation">:</span> <span class="token punctuation">.</span>teal<span class="token punctuation">,</span>
        <span class="token string-literal"><span class="token string">"cyan"</span></span> <span class="token punctuation">:</span> <span class="token punctuation">.</span>cyan<span class="token punctuation">,</span>
        <span class="token string-literal"><span class="token string">"blue"</span></span> <span class="token punctuation">:</span> <span class="token punctuation">.</span>blue<span class="token punctuation">,</span>
        <span class="token string-literal"><span class="token string">"indigo"</span></span> <span class="token punctuation">:</span> <span class="token punctuation">.</span>indigo<span class="token punctuation">,</span>
        <span class="token string-literal"><span class="token string">"purple"</span></span> <span class="token punctuation">:</span> <span class="token punctuation">.</span>purple<span class="token punctuation">,</span>
        <span class="token string-literal"><span class="token string">"pink"</span></span> <span class="token punctuation">:</span> <span class="token punctuation">.</span>pink<span class="token punctuation">,</span>
        <span class="token string-literal"><span class="token string">"brown"</span></span> <span class="token punctuation">:</span> <span class="token punctuation">.</span>brown<span class="token punctuation">,</span>
        <span class="token string-literal"><span class="token string">"gray"</span></span> <span class="token punctuation">:</span> <span class="token punctuation">.</span>gray<span class="token punctuation">,</span>
        <span class="token string-literal"><span class="token string">"black"</span></span> <span class="token punctuation">:</span> <span class="token punctuation">.</span>black
    <span class="token punctuation">]</span>
    
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ScrollView</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">LazyVGrid</span><span class="token punctuation">(</span>columns<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token class-name">GridItem</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">adaptive</span><span class="token punctuation">(</span>minimum<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> spacing<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">)</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span> pinnedViews<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">.</span>sectionHeaders<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Section</span><span class="token punctuation">(</span>header<span class="token punctuation">:</span>
                            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"🎨调色板"</span></span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>title<span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>maxWidth<span class="token punctuation">:</span> <span class="token punctuation">.</span>infinity<span class="token punctuation">,</span> maxHeight<span class="token punctuation">:</span> <span class="token punctuation">.</span>infinity<span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">background</span><span class="token punctuation">(</span><span class="token class-name">RoundedRectangle</span><span class="token punctuation">(</span>cornerRadius<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span>
                                                <span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">.</span>black<span class="token punctuation">.</span><span class="token function">opacity</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">ForEach</span><span class="token punctuation">(</span><span class="token class-name">Array</span><span class="token punctuation">(</span>colors<span class="token punctuation">.</span>keys<span class="token punctuation">)</span><span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token punctuation">\</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> k <span class="token keyword">in</span>
                        colors<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span><span class="token class-name">Double</span><span class="token punctuation">(</span><span class="token class-name">Int</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token number">50</span><span class="token operator">...</span><span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">overlay</span><span class="token punctuation">(</span>
                                <span class="token class-name">Text</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span>
                            <span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">shadow</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token punctuation">.</span>black<span class="token punctuation">,</span> radius<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            <span class="token class-name">LazyVGrid</span><span class="token punctuation">(</span>columns<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token class-name">GridItem</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">adaptive</span><span class="token punctuation">(</span>minimum<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> spacing<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">)</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Section</span><span class="token punctuation">(</span>header<span class="token punctuation">:</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"图标集"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">ForEach</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">...</span><span class="token number">30</span><span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token punctuation">\</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> i <span class="token keyword">in</span>
                        <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"p</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">resizable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">aspectRatio</span><span class="token punctuation">(</span>contentMode<span class="token punctuation">:</span> <span class="token punctuation">.</span>fit<span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">shadow</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token punctuation">.</span>black<span class="token punctuation">,</span> radius<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="table"><a href="#table" class="headerlink" title="table"></a>table</h4><p>今年 iOS 和 iPadOS 也可以使用去年只能在 macOS 上使用的 Table了，据 digital lounges 里说，iOS table 的性能和 list 差不多，table 默认为 plian list。我想 iOS 上加上 table 只是为了兼容 macOS 代码吧。</p>
<p>table 使用示例如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token class-name">Table</span><span class="token punctuation">(</span>attendeeStore<span class="token punctuation">.</span>attendees<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">TableColumn</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Name"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> attendee <span class="token keyword">in</span>
        <span class="token class-name">AttendeeRow</span><span class="token punctuation">(</span>attendee<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token class-name">TableColumn</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"City"</span></span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token punctuation">\</span><span class="token punctuation">.</span>city<span class="token punctuation">)</span>
    <span class="token class-name">TableColumn</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Status"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> attendee <span class="token keyword">in</span>
        <span class="token class-name">StatusRow</span><span class="token punctuation">(</span>attendee<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">.</span><span class="token function">contextMenu</span><span class="token punctuation">(</span>forSelectionType<span class="token punctuation">:</span> <span class="token class-name">Attendee</span><span class="token punctuation">.</span><span class="token constant">ID</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> selection <span class="token keyword">in</span>
    <span class="token keyword">if</span> selection<span class="token punctuation">.</span>isEmpty <span class="token punctuation">&#123;</span>
        <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"New Invitation"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">addInvitation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> selection<span class="token punctuation">.</span>count <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Mark as VIP"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">markVIPs</span><span class="token punctuation">(</span>selection<span class="token punctuation">)</span> <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Mark as VIPs"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">markVIPs</span><span class="token punctuation">(</span>selection<span class="token punctuation">)</span> <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="ScrollView"><a href="#ScrollView" class="headerlink" title="ScrollView"></a>ScrollView</h4><p>ScrollView 使用 scrollTo 可以直接滚动到指定的位置。ScrollView 还可以透出偏移量，利用偏移量可以定义自己的动态视图，比如向下向上滚动视图时有不同效果，到顶部显示标题视图等。</p>
<p>示例代码如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PlayScrollView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> scrollOffset<span class="token punctuation">:</span> <span class="token class-name">CGFloat</span> <span class="token operator">=</span> <span class="token punctuation">.</span>zero
    
    <span class="token keyword">var</span> infoView<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">GeometryReader</span> <span class="token punctuation">&#123;</span> g <span class="token keyword">in</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span>"移动了 <span class="token punctuation">\</span><span class="token punctuation">(</span><span class="token class-name">Double</span><span class="token punctuation">(</span>scrollOffset<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">formatted</span><span class="token punctuation">(</span><span class="token punctuation">.</span>number<span class="token punctuation">.</span><span class="token function">precision</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">fractionLength</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rounded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>"<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 标准用法</span>
        <span class="token class-name">ScrollViewReader</span> <span class="token punctuation">&#123;</span> s <span class="token keyword">in</span>
            <span class="token class-name">ScrollView</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">ForEach</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">..&lt;</span><span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> i <span class="token keyword">in</span>
                    <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"跳到150"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                withAnimation <span class="token punctuation">&#123;</span>
                    s<span class="token punctuation">.</span><span class="token function">scrollTo</span><span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">,</span> anchor<span class="token punctuation">:</span> <span class="token punctuation">.</span>top<span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span> <span class="token comment">// end Button</span>
        <span class="token punctuation">&#125;</span> <span class="token comment">// end ScrollViewReader</span>
        
        <span class="token comment">// 自定义的 ScrollView 透出 offset 供使用</span>
        <span class="token class-name">ZStack</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">PCScrollView</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">ForEach</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">..&lt;</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> i <span class="token keyword">in</span>
                    <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span> whenMoved<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span> d <span class="token keyword">in</span>
                scrollOffset <span class="token operator">=</span> d
            <span class="token punctuation">&#125;</span>
            infoView
            
        <span class="token punctuation">&#125;</span> <span class="token comment">// end ZStack</span>
    <span class="token punctuation">&#125;</span> <span class="token comment">// end body</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// MARK: - 自定义 ScrollView</span>
<span class="token keyword">struct</span> <span class="token class-name">PCScrollView</span><span class="token operator">&lt;</span><span class="token class-name">C</span><span class="token punctuation">:</span> <span class="token class-name">View</span><span class="token operator">></span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> c<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">C</span>
    <span class="token keyword">let</span> whenMoved<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token class-name">CGFloat</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Void</span>
    
    <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token attribute atrule">@ViewBuilder</span> c<span class="token punctuation">:</span> <span class="token attribute atrule">@escaping</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">C</span><span class="token punctuation">,</span> whenMoved<span class="token punctuation">:</span> <span class="token attribute atrule">@escaping</span> <span class="token punctuation">(</span><span class="token class-name">CGFloat</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Void</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>c <span class="token operator">=</span> c
        <span class="token keyword">self</span><span class="token punctuation">.</span>whenMoved <span class="token operator">=</span> whenMoved
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">var</span> offsetReader<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">GeometryReader</span> <span class="token punctuation">&#123;</span> g <span class="token keyword">in</span>
            <span class="token class-name">Color</span><span class="token punctuation">.</span>clear
                <span class="token punctuation">.</span><span class="token function">preference</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> <span class="token class-name">OffsetPreferenceKey</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> g<span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">named</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"frameLayer"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>minY<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ScrollView</span> <span class="token punctuation">&#123;</span>
            offsetReader
            <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">.</span>top<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">coordinateSpace</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"frameLayer"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">onPreferenceChange</span><span class="token punctuation">(</span><span class="token class-name">OffsetPreferenceKey</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">,</span> perform<span class="token punctuation">:</span> whenMoved<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span> <span class="token comment">// end body</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">private</span> <span class="token keyword">struct</span> <span class="token class-name">OffsetPreferenceKey</span><span class="token punctuation">:</span> <span class="token class-name">PreferenceKey</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">static</span> <span class="token keyword">var</span> defaultValue<span class="token punctuation">:</span> <span class="token class-name">CGFloat</span> <span class="token operator">=</span> <span class="token punctuation">.</span>zero
  <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">reduce</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token keyword">inout</span> <span class="token class-name">CGFloat</span><span class="token punctuation">,</span> nextValue<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">CGFloat</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>新增 modifier</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token class-name">ScrollView</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">ForEach</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">..&lt;</span><span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> i <span class="token keyword">in</span>
        <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">.</span><span class="token function">scrollDisabled</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">scrollDismissesKeyboard</span><span class="token punctuation">(</span><span class="token punctuation">.</span>interactively<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">scrollIndicators</span><span class="token punctuation">(</span><span class="token punctuation">.</span>visible<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="浮层"><a href="#浮层" class="headerlink" title="浮层"></a>浮层</h4><p><img  srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://user-images.githubusercontent.com/251980/156135869-7451bbc9-95b9-445f-8721-66f0aedbed70.png" class="lozad post-image"src="https://user-images.githubusercontent.com/251980/156135869-7451bbc9-95b9-445f-8721-66f0aedbed70.png"></p>
<p>浮层有 HUD、ContextMenu、Sheet、Alert、ConfirmationDialog、Popover、ActionSheet 等几种方式。这些方式实现代码如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PlaySuperposedLayerView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@StateObject</span> <span class="token keyword">var</span> hudVM <span class="token operator">=</span> <span class="token function">PHUDVM</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> isShow <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> isShowAlert <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> isShowConfirmationDialog <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> isShowPopover <span class="token operator">=</span> <span class="token boolean">false</span>
    
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">VStack</span> <span class="token punctuation">&#123;</span>
            
            
            <span class="token class-name">List</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">ForEach</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">..&lt;</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> i <span class="token keyword">in</span>
                    <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span>contextMenu <span class="token punctuation">&#123;</span>
                            <span class="token comment">// 在 macOS 上右键会出现的菜单</span>
                            <span class="token class-name">Button</span> <span class="token punctuation">&#123;</span>
                                <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string"> is clicked"</span></span><span class="token punctuation">)</span>
                            <span class="token punctuation">&#125;</span> label<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Click </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
                            <span class="token punctuation">&#125;</span>
                        <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token punctuation">.</span><span class="token function">navigationTitle</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"列表"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span>toolbar <span class="token punctuation">&#123;</span>
                <span class="token class-name">ToolbarItemGroup</span><span class="token punctuation">(</span>placement<span class="token punctuation">:</span> <span class="token punctuation">.</span>automatic<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"查看 Sheet"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        isShow <span class="token operator">=</span> <span class="token boolean">true</span>
                    <span class="token punctuation">&#125;</span>
                    
                    <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"查看 Alert"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        isShowAlert <span class="token operator">=</span> <span class="token boolean">true</span>
                    <span class="token punctuation">&#125;</span>
                    
                    <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"查看 confirmationDialog"</span></span><span class="token punctuation">,</span> role<span class="token punctuation">:</span> <span class="token punctuation">.</span>destructive<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        isShowConfirmationDialog <span class="token operator">=</span> <span class="token boolean">true</span>
                    <span class="token punctuation">&#125;</span>
                    
                    <span class="token comment">// Popover 样式默认是弹出窗口置于按钮上方，指向底部。</span>
                    <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"查看 Popover"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        isShowPopover <span class="token operator">=</span> <span class="token boolean">true</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">.</span><span class="token function">popover</span><span class="token punctuation">(</span>isPresented<span class="token punctuation">:</span> $isShowPopover<span class="token punctuation">,</span> attachmentAnchor<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">point</span><span class="token punctuation">(</span><span class="token punctuation">.</span>trailing<span class="token punctuation">)</span><span class="token punctuation">,</span> arrowEdge<span class="token punctuation">:</span> <span class="token punctuation">.</span>trailing<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Popover 的内容"</span></span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">&#125;</span>
                    
                <span class="token punctuation">&#125;</span> <span class="token comment">// end ToolbarItemGroup</span>
            <span class="token punctuation">&#125;</span> <span class="token comment">// end toolbar</span>
            <span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span>isPresented<span class="token punctuation">:</span> $isShowAlert<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Alert</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"弹框标题"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"弹框内容"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
            <span class="token punctuation">.</span><span class="token function">sheet</span><span class="token punctuation">(</span>isPresented<span class="token punctuation">:</span> $isShow<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"dismiss"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span> content<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">VStack</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Label</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Sheet"</span></span><span class="token punctuation">,</span> systemImage<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"brain.head.profile"</span></span><span class="token punctuation">)</span>
                    <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"关闭"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        isShow <span class="token operator">=</span> <span class="token boolean">false</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
            <span class="token punctuation">.</span><span class="token function">confirmationDialog</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"确定删除？"</span></span><span class="token punctuation">,</span> isPresented<span class="token punctuation">:</span> $isShowConfirmationDialog<span class="token punctuation">,</span> titleVisibility<span class="token punctuation">:</span> <span class="token punctuation">.</span>hidden<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"确定"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token comment">// do good thing</span>
                <span class="token punctuation">&#125;</span>
                <span class="token punctuation">.</span><span class="token function">keyboardShortcut</span><span class="token punctuation">(</span><span class="token punctuation">.</span>defaultAction<span class="token punctuation">)</span> <span class="token comment">// 使用 keyboardShortcut 可以设置成为默认选项样式</span>
                
                <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"不不"</span></span><span class="token punctuation">,</span> role<span class="token punctuation">:</span> <span class="token punctuation">.</span>cancel<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token comment">// good choice</span>
                <span class="token punctuation">&#125;</span>
                
            <span class="token punctuation">&#125;</span> message<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"这个东西还有点重要哦"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
            
            <span class="token class-name">Button</span> <span class="token punctuation">&#123;</span>
                hudVM<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"您有一条新的短消息"</span></span><span class="token punctuation">,</span> systemImage<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"ellipsis.bubble"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span> label<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Label</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"查看 HUD"</span></span><span class="token punctuation">,</span> systemImage<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"switch.2"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
            <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">environmentObject</span><span class="token punctuation">(</span>hudVM<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">hud</span><span class="token punctuation">(</span>isShow<span class="token punctuation">:</span> $hudVM<span class="token punctuation">.</span>isShow<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Label</span><span class="token punctuation">(</span>hudVM<span class="token punctuation">.</span>title<span class="token punctuation">,</span> systemImage<span class="token punctuation">:</span> hudVM<span class="token punctuation">.</span>systemImage<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// MARK: - 供全局使用的 HUD</span>
<span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token constant">PHUDVM</span><span class="token punctuation">:</span> <span class="token class-name">ObservableObject</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@Published</span> <span class="token keyword">var</span> isShow<span class="token punctuation">:</span> <span class="token class-name">Bool</span> <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token keyword">var</span> title<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span>
    <span class="token keyword">var</span> systemImage<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span>
    
    <span class="token keyword">func</span> <span class="token function-definition function">show</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> systemImage<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>title <span class="token operator">=</span> title
        <span class="token keyword">self</span><span class="token punctuation">.</span>systemImage <span class="token operator">=</span> systemImage
        withAnimation <span class="token punctuation">&#123;</span>
            isShow <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// MARK: - 扩展 View 使其能够有 HUD 的能力</span>
<span class="token keyword">extension</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">func</span> <span class="token function-definition function">hud</span><span class="token operator">&lt;</span><span class="token class-name">V</span><span class="token punctuation">:</span> <span class="token class-name">View</span><span class="token operator">></span><span class="token punctuation">(</span>
        isShow<span class="token punctuation">:</span> <span class="token class-name">Binding</span><span class="token operator">&lt;</span><span class="token class-name">Bool</span><span class="token operator">></span><span class="token punctuation">,</span>
        <span class="token attribute atrule">@ViewBuilder</span> v<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">V</span>
    <span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ZStack</span><span class="token punctuation">(</span>alignment<span class="token punctuation">:</span> <span class="token punctuation">.</span>top<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">self</span>
            
            <span class="token keyword">if</span> isShow<span class="token punctuation">.</span>wrappedValue <span class="token operator">==</span> <span class="token boolean">true</span> <span class="token punctuation">&#123;</span>
                <span class="token function">PHUD</span><span class="token punctuation">(</span>v<span class="token punctuation">:</span> v<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">transition</span><span class="token punctuation">(</span><span class="token class-name">AnyTransition</span><span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span>edge<span class="token punctuation">:</span> <span class="token punctuation">.</span>top<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">combined</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> <span class="token punctuation">.</span>opacity<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span>onAppear <span class="token punctuation">&#123;</span>
                        <span class="token class-name">DispatchQueue</span><span class="token punctuation">.</span>main<span class="token punctuation">.</span><span class="token function">asyncAfter</span><span class="token punctuation">(</span>deadline<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                            withAnimation <span class="token punctuation">&#123;</span>
                                isShow<span class="token punctuation">.</span>wrappedValue <span class="token operator">=</span> <span class="token boolean">false</span>
                            <span class="token punctuation">&#125;</span>
                        <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">.</span><span class="token function">zIndex</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// MARK: - 自定义 HUD</span>
<span class="token keyword">struct</span> <span class="token constant">PHUD</span><span class="token operator">&lt;</span><span class="token class-name">V</span><span class="token punctuation">:</span> <span class="token class-name">View</span><span class="token operator">></span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@ViewBuilder</span> <span class="token keyword">let</span> v<span class="token punctuation">:</span> <span class="token class-name">V</span>
    
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        v
            <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span><span class="token punctuation">.</span>black<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">background</span><span class="token punctuation">(</span>
                <span class="token class-name">Capsule</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span><span class="token punctuation">.</span>white<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">shadow</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token punctuation">.</span>black<span class="token punctuation">.</span><span class="token function">opacity</span><span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> radius<span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>SwiftUI 新推出的 <code>presentationDetents()</code> modifier 可以创建一个可以定制的 bottom sheet。示例代码如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PSheet</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> isShow <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"显示 Sheet"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            isShow<span class="token punctuation">.</span><span class="token function">toggle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">sheet</span><span class="token punctuation">(</span>isPresented<span class="token punctuation">:</span> $isShow<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"这里是 Sheet 的内容"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">presentationDetents</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">.</span>medium<span class="token punctuation">,</span> <span class="token punctuation">.</span>large<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>detent 默认值是 <code>.large</code>。也可以提供一个百分比，比如 <code>.presentationDetents([.fraction(0.7)])</code>，或者直接指定高度 <code>.presentationDetents([.height(100)])</code>。</p>
<p>presentationDragIndicator modifier 可以用来显示隐藏拖动标识。</p>
<h4 id="TabView"><a href="#TabView" class="headerlink" title="TabView"></a>TabView</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PlayTabView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> selection <span class="token operator">=</span> <span class="token number">0</span>
    
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ZStack</span><span class="token punctuation">(</span>alignment<span class="token punctuation">:</span> <span class="token punctuation">.</span>bottom<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">TabView</span><span class="token punctuation">(</span>selection<span class="token punctuation">:</span> $selection<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span>tabItem <span class="token punctuation">&#123;</span>
                        <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"首页"</span></span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">hidden</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span>tabItem <span class="token punctuation">&#123;</span>
                        <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"二栏"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"three"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span>tabItem <span class="token punctuation">&#123;</span>
                        <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"三栏"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"four"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"five"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"six"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"seven"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"eight"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"nine"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"ten"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span> <span class="token comment">// end TabView</span>
            
            
            <span class="token class-name">HStack</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"上一页"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">if</span> selection <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">&#123;</span>
                        selection <span class="token operator">-=</span> <span class="token number">1</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token punctuation">.</span><span class="token function">keyboardShortcut</span><span class="token punctuation">(</span><span class="token punctuation">.</span>cancelAction<span class="token punctuation">)</span>
                <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"下一页"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">if</span> selection <span class="token operator">&lt;</span> <span class="token number">9</span> <span class="token punctuation">&#123;</span>
                        selection <span class="token operator">+=</span> <span class="token number">1</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token punctuation">.</span><span class="token function">keyboardShortcut</span><span class="token punctuation">(</span><span class="token punctuation">.</span>defaultAction<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span> <span class="token comment">// end HStack</span>
            <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>.tabViewStyle(PageTabViewStyle(indexDisplayMode: .never)) 可以实现 UIPageViewController 的效果，如果要给小白点加上背景，可以多添加一个 .indexViewStyle(PageIndexViewStyle(backgroundDisplayMode: .always)) 修改器。</p>
<h4 id="Swift-Charts"><a href="#Swift-Charts" class="headerlink" title="Swift Charts"></a>Swift Charts</h4><p>可视化数据，使用 SwiftUI 语法来创建。还可以使用 ChartRenderer 接口将图标渲染成图。</p>
<p>官方文档 <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/Charts">Swift Charts</a></p>
<p>入门参看 <a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2022/10136/">Hello Swift Charts</a></p>
<p>Apple 文章 <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/Charts/Creating-a-chart-using-Swift-Charts">Creating a chart using Swift Charts</a></p>
<p>高级定制和创建更精细图表，可以看这个 session <a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2022/10137">Swift Charts: Raise the bar</a> 这个 session 也会提到如何在图表中进行交互。这里是 session 对应的代码示例 <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/charts/visualizing_your_app_s_data">Visualizing your app’s data</a> 。</p>
<p>图表设计的 session，<a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2022-110340">Design an effective chart</a> 和 <a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2022-110342">Design app experiences with charts</a> 。</p>
<p>下面是一个简单的代码示例：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">Charts</span>

<span class="token keyword">struct</span> <span class="token class-name">PChartModel</span><span class="token punctuation">:</span> <span class="token class-name">Hashable</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> day<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">var</span> amount<span class="token punctuation">:</span> <span class="token class-name">Int</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token operator">..&lt;</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">extension</span> <span class="token class-name">PChartModel</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">var</span> data<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">PChartModel</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> calendar <span class="token operator">=</span> <span class="token class-name">Calendar</span><span class="token punctuation">(</span>identifier<span class="token punctuation">:</span> <span class="token punctuation">.</span>gregorian<span class="token punctuation">)</span>
        <span class="token keyword">let</span> days <span class="token operator">=</span> calendar<span class="token punctuation">.</span>shortWeekdaySymbols
        <span class="token keyword">return</span> days<span class="token punctuation">.</span>map <span class="token punctuation">&#123;</span> day <span class="token keyword">in</span>
            <span class="token class-name">PChartModel</span><span class="token punctuation">(</span>day<span class="token punctuation">:</span> day<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">struct</span> <span class="token class-name">PlayCharts</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Chart</span><span class="token punctuation">(</span><span class="token class-name">PChartModel</span><span class="token punctuation">.</span>data<span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token punctuation">\</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> v <span class="token keyword">in</span>
            <span class="token class-name">BarMark</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"天"</span></span><span class="token punctuation">,</span> v<span class="token punctuation">.</span>day<span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"数量"</span></span><span class="token punctuation">,</span> v<span class="token punctuation">.</span>amount<span class="token punctuation">)</span><span class="token punctuation">)</span>
            
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">struct</span> <span class="token class-name">PSwiftCharts</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">struct</span> <span class="token class-name">CData</span><span class="token punctuation">:</span> <span class="token class-name">Identifiable</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token function">UUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> i<span class="token punctuation">:</span> <span class="token class-name">Int</span>
        <span class="token keyword">let</span> v<span class="token punctuation">:</span> <span class="token class-name">Double</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> a<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">CData</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>i<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> v<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>i<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> v<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>i<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> v<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>i<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> v<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>i<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> v<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>i<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> v<span class="token punctuation">:</span> <span class="token number">80</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
    
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Chart</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> i <span class="token keyword">in</span>
            <span class="token class-name">LineMark</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Index"</span></span><span class="token punctuation">,</span> i<span class="token punctuation">.</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Value"</span></span><span class="token punctuation">,</span> i<span class="token punctuation">.</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token class-name">BarMark</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Index"</span></span><span class="token punctuation">,</span> i<span class="token punctuation">.</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> yStart<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"开始"</span></span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> yEnd<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"结束"</span></span><span class="token punctuation">,</span> i<span class="token punctuation">.</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">foregroundStyle</span><span class="token punctuation">(</span>by<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Value"</span></span><span class="token punctuation">,</span> i<span class="token punctuation">.</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span> <span class="token comment">// end Chart</span>
    <span class="token punctuation">&#125;</span> <span class="token comment">// end body</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>BarMark 用于创建条形图，LineMark 用于创建折线图。SwiftUI Charts 框架还提供 PointMark、AxisMarks、AreaMark、RectangularMark 和 RuleMark 用于创建不同类型的图表。注释使用 <code>.annotation</code> modifier，修改颜色可以使用 <code>.foregroundStyle</code> modifier。<code>.lineStyle</code> modifier 可以修改线宽。</p>
<p>AxisMarks 的示例如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">MonthlySalesChart</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Chart</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token punctuation">\</span><span class="token punctuation">.</span>month<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">BarMark</span><span class="token punctuation">(</span>
                x<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Month"</span></span><span class="token punctuation">,</span> <span class="token short-argument">$0</span><span class="token punctuation">.</span>month<span class="token punctuation">,</span> unit<span class="token punctuation">:</span> <span class="token punctuation">.</span>month<span class="token punctuation">)</span><span class="token punctuation">,</span>
                y<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Sales"</span></span><span class="token punctuation">,</span> <span class="token short-argument">$0</span><span class="token punctuation">.</span>sales<span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span>chartXAxis <span class="token punctuation">&#123;</span>
            <span class="token class-name">AxisMarks</span><span class="token punctuation">(</span>values<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">stride</span><span class="token punctuation">(</span>by<span class="token punctuation">:</span> <span class="token punctuation">.</span>month<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> value <span class="token keyword">in</span>
                <span class="token keyword">if</span> value<span class="token punctuation">.</span><span class="token keyword">as</span><span class="token punctuation">(</span><span class="token class-name">Date</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">.</span>isFirstMonthOfQuarter <span class="token punctuation">&#123;</span>
                    <span class="token class-name">AxisGridLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">foregroundStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>black<span class="token punctuation">)</span>
                    <span class="token class-name">AxisTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">foregroundStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>black<span class="token punctuation">)</span>
                    <span class="token class-name">AxisValueLabel</span><span class="token punctuation">(</span>
                        format<span class="token punctuation">:</span> <span class="token punctuation">.</span>dateTime<span class="token punctuation">.</span><span class="token function">month</span><span class="token punctuation">(</span><span class="token punctuation">.</span>narrow<span class="token punctuation">)</span>
                    <span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">AxisGridLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可交互图表示例如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">InteractiveBrushingChart</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">var</span> range<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token class-name">Date</span><span class="token punctuation">,</span> <span class="token class-name">Date</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token operator">=</span> <span class="token nil constant">nil</span>
    
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Chart</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">ForEach</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token punctuation">\</span><span class="token punctuation">.</span>day<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">LineMark</span><span class="token punctuation">(</span>
                    x<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Month"</span></span><span class="token punctuation">,</span> <span class="token short-argument">$0</span><span class="token punctuation">.</span>day<span class="token punctuation">,</span> unit<span class="token punctuation">:</span> <span class="token punctuation">.</span>day<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    y<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Sales"</span></span><span class="token punctuation">,</span> <span class="token short-argument">$0</span><span class="token punctuation">.</span>sales<span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">interpolationMethod</span><span class="token punctuation">(</span><span class="token punctuation">.</span>catmullRom<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">symbol</span><span class="token punctuation">(</span><span class="token class-name">Circle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">strokeBorder</span><span class="token punctuation">(</span>lineWidth<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">)</span> <span class="token operator">=</span> range <span class="token punctuation">&#123;</span>
                <span class="token class-name">RectangleMark</span><span class="token punctuation">(</span>
                    xStart<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Selection Start"</span></span><span class="token punctuation">,</span> start<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    xEnd<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Selection End"</span></span><span class="token punctuation">,</span> end<span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">foregroundStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>gray<span class="token punctuation">.</span><span class="token function">opacity</span><span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span>chartOverlay <span class="token punctuation">&#123;</span> proxy <span class="token keyword">in</span>
            <span class="token class-name">GeometryReader</span> <span class="token punctuation">&#123;</span> nthGeoItem <span class="token keyword">in</span>
                <span class="token class-name">Rectangle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">.</span>clear<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contentShape</span><span class="token punctuation">(</span><span class="token class-name">Rectangle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">gesture</span><span class="token punctuation">(</span><span class="token class-name">DragGesture</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span>onChanged <span class="token punctuation">&#123;</span> value <span class="token keyword">in</span>
                            <span class="token comment">// Find the x-coordinates in the chart’s plot area.</span>
                            <span class="token keyword">let</span> xStart <span class="token operator">=</span> value<span class="token punctuation">.</span>startLocation<span class="token punctuation">.</span>x <span class="token operator">-</span> nthGeoItem<span class="token punctuation">[</span>proxy<span class="token punctuation">.</span>plotAreaFrame<span class="token punctuation">]</span><span class="token punctuation">.</span>origin<span class="token punctuation">.</span>x
                            <span class="token keyword">let</span> xCurrent <span class="token operator">=</span> value<span class="token punctuation">.</span>location<span class="token punctuation">.</span>x <span class="token operator">-</span> nthGeoItem<span class="token punctuation">[</span>proxy<span class="token punctuation">.</span>plotAreaFrame<span class="token punctuation">]</span><span class="token punctuation">.</span>origin<span class="token punctuation">.</span>x
                            <span class="token comment">// Find the date values at the x-coordinates.</span>
                            <span class="token keyword">if</span> <span class="token keyword">let</span> dateStart<span class="token punctuation">:</span> <span class="token class-name">Date</span> <span class="token operator">=</span> proxy<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span>atX<span class="token punctuation">:</span> xStart<span class="token punctuation">)</span><span class="token punctuation">,</span>
                               <span class="token keyword">let</span> dateCurrent<span class="token punctuation">:</span> <span class="token class-name">Date</span> <span class="token operator">=</span> proxy<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span>atX<span class="token punctuation">:</span> xCurrent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                range <span class="token operator">=</span> <span class="token punctuation">(</span>dateStart<span class="token punctuation">,</span> dateCurrent<span class="token punctuation">)</span>
                            <span class="token punctuation">&#125;</span>
                        <span class="token punctuation">&#125;</span>
                        <span class="token punctuation">.</span>onEnded <span class="token punctuation">&#123;</span> <span class="token omit keyword">_</span> <span class="token keyword">in</span> range <span class="token operator">=</span> <span class="token nil constant">nil</span> <span class="token punctuation">&#125;</span> <span class="token comment">// Clear the state on gesture end.</span>
                    <span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>社区做的更多 Swift Charts 范例 <a target="_blank" rel="noopener" href="https://github.com/jordibruin/Swift-Charts-Examples">Swift Charts Examples</a> 。</p>
<h4 id="Toggle"><a href="#Toggle" class="headerlink" title="Toggle"></a>Toggle</h4><p><img  srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://user-images.githubusercontent.com/251980/156289124-bde3c73e-2a81-4043-8682-ae55a820f1aa.png" class="lozad post-image"src="https://user-images.githubusercontent.com/251980/156289124-bde3c73e-2a81-4043-8682-ae55a820f1aa.png"></p>
<p>Toggle 可以设置 toggleStyle，可以自定义样式。使用示例如下</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PlayToggleView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> isEnable <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 普通样式</span>
        <span class="token class-name">Toggle</span><span class="token punctuation">(</span>isOn<span class="token punctuation">:</span> $isEnable<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">isEnable <span class="token operator">?</span> <span class="token string-literal"><span class="token string">"开了"</span></span> <span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"关了"</span></span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment">// 按钮样式</span>
        <span class="token class-name">Toggle</span><span class="token punctuation">(</span>isOn<span class="token punctuation">:</span> $isEnable<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Label</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">isEnable <span class="token operator">?</span> <span class="token string-literal"><span class="token string">"打开了"</span></span> <span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"关闭了"</span></span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">,</span> systemImage<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"cloud.moon"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">tint</span><span class="token punctuation">(</span><span class="token punctuation">.</span>pink<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">controlSize</span><span class="token punctuation">(</span><span class="token punctuation">.</span>large<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">toggleStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>button<span class="token punctuation">)</span>
        
        <span class="token comment">// Switch 样式</span>
        <span class="token class-name">Toggle</span><span class="token punctuation">(</span>isOn<span class="token punctuation">:</span> $isEnable<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">isEnable <span class="token operator">?</span> <span class="token string-literal"><span class="token string">"开了"</span></span> <span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"关了"</span></span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">toggleStyle</span><span class="token punctuation">(</span><span class="token class-name">SwitchToggleStyle</span><span class="token punctuation">(</span>tint<span class="token punctuation">:</span> <span class="token punctuation">.</span>orange<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment">// 自定义样式</span>
        <span class="token class-name">Toggle</span><span class="token punctuation">(</span>isOn<span class="token punctuation">:</span> $isEnable<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span>isEnable <span class="token operator">?</span> <span class="token string-literal"><span class="token string">"录音中"</span></span> <span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"已静音"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">toggleStyle</span><span class="token punctuation">(</span><span class="token class-name">PCToggleStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// MARK: - 自定义样式</span>
<span class="token keyword">struct</span> <span class="token class-name">PCToggleStyle</span><span class="token punctuation">:</span> <span class="token class-name">ToggleStyle</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">func</span> <span class="token function-definition function">makeBody</span><span class="token punctuation">(</span>configuration<span class="token punctuation">:</span> <span class="token class-name">Configuration</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">HStack</span> <span class="token punctuation">&#123;</span>
            configuration<span class="token punctuation">.</span>label
            <span class="token class-name">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> configuration<span class="token punctuation">.</span>isOn <span class="token operator">?</span> <span class="token string-literal"><span class="token string">"mic.square.fill"</span></span> <span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"mic.slash.circle.fill"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">renderingMode</span><span class="token punctuation">(</span><span class="token punctuation">.</span>original<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">resizable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span>onTapGesture <span class="token punctuation">&#123;</span>
                    configuration<span class="token punctuation">.</span>isOn<span class="token punctuation">.</span><span class="token function">toggle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="Picker"><a href="#Picker" class="headerlink" title="Picker"></a>Picker</h4><p><img  srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://user-images.githubusercontent.com/251980/156298284-2fb37b3e-55f0-4918-ba8e-74f747bf3171.jpeg" class="lozad post-image"src="https://user-images.githubusercontent.com/251980/156298284-2fb37b3e-55f0-4918-ba8e-74f747bf3171.jpeg"></p>
<p>有 Picker 视图，还有颜色和时间选择的 ColorPicker 和 DatePicker。</p>
<p>示例代码如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PlayPickerView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> select <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> color <span class="token operator">=</span> <span class="token class-name">Color</span><span class="token punctuation">.</span>red<span class="token punctuation">.</span><span class="token function">opacity</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span>
    
    <span class="token keyword">var</span> dateFt<span class="token punctuation">:</span> <span class="token class-name">DateFormatter</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> ft <span class="token operator">=</span> <span class="token class-name">DateFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        ft<span class="token punctuation">.</span>dateStyle <span class="token operator">=</span> <span class="token punctuation">.</span>long
        <span class="token keyword">return</span> ft
    <span class="token punctuation">&#125;</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> date <span class="token operator">=</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        
        <span class="token comment">// 默认是下拉的风格</span>
        <span class="token class-name">Form</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Section</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"选区"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Picker</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"选一个"</span></span><span class="token punctuation">,</span> selection<span class="token punctuation">:</span> $select<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"1"</span></span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
                    <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"2"</span></span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment">// Segment 风格，</span>
        <span class="token class-name">Picker</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"选一个"</span></span><span class="token punctuation">,</span> selection<span class="token punctuation">:</span> $select<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"one"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"two"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">pickerStyle</span><span class="token punctuation">(</span><span class="token class-name">SegmentedPickerStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment">// 颜色选择器</span>
        <span class="token class-name">ColorPicker</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"选一个颜色"</span></span><span class="token punctuation">,</span> selection<span class="token punctuation">:</span> $color<span class="token punctuation">,</span> supportsOpacity<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token class-name">RoundedRectangle</span><span class="token punctuation">(</span>cornerRadius<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">)</span>
        
        <span class="token comment">// 时间选择器</span>
        <span class="token class-name">VStack</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">DatePicker</span><span class="token punctuation">(</span>selection<span class="token punctuation">:</span> $date<span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token operator">...</span><span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> displayedComponents<span class="token punctuation">:</span> <span class="token punctuation">.</span>date<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"选时间"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
            
            <span class="token class-name">DatePicker</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"选时间"</span></span><span class="token punctuation">,</span> selection<span class="token punctuation">:</span> $date<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">datePickerStyle</span><span class="token punctuation">(</span><span class="token class-name">GraphicalDatePickerStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>maxHeight<span class="token punctuation">:</span> <span class="token number">400</span><span class="token punctuation">)</span>
            
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"时间：</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">date<span class="token punctuation">,</span> formatter<span class="token punctuation">:</span> dateFt</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>选择多个日期</p>
<p>MultiDatePicker 视图会显示一个日历，用户可以选择多个日期，可以设置选择范围。示例如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PMultiDatePicker</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@Environment</span><span class="token punctuation">(</span><span class="token punctuation">\</span><span class="token punctuation">.</span>calendar<span class="token punctuation">)</span> <span class="token keyword">var</span> cal
    <span class="token attribute atrule">@State</span> <span class="token keyword">var</span> dates<span class="token punctuation">:</span> <span class="token class-name">Set</span><span class="token operator">&lt;</span><span class="token class-name">DateComponents</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">MultiDatePicker</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"选择个日子"</span></span><span class="token punctuation">,</span> selection<span class="token punctuation">:</span> $dates<span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token class-name">Date</span><span class="token punctuation">.</span>now<span class="token operator">...</span><span class="token punctuation">)</span>
        <span class="token class-name">Text</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">var</span> s<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span>
        dates<span class="token punctuation">.</span>compactMap <span class="token punctuation">&#123;</span> c <span class="token keyword">in</span>
            cal<span class="token punctuation">.</span><span class="token function">date</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span>c<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">formatted</span><span class="token punctuation">(</span>date<span class="token punctuation">:</span> <span class="token punctuation">.</span>long<span class="token punctuation">,</span> time<span class="token punctuation">:</span> <span class="token punctuation">.</span>omitted<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">formatted</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>PhotosPick</p>
<p>支持图片选择，示例代码如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">PhotosUI</span>
<span class="token keyword">import</span> <span class="token class-name">CoreTransferable</span>

<span class="token keyword">struct</span> <span class="token class-name">ContentView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@ObservedObject</span> <span class="token keyword">var</span> viewModel<span class="token punctuation">:</span> <span class="token class-name">FilterModel</span> <span class="token operator">=</span> <span class="token punctuation">.</span>shared
    
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">NavigationStack</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Gallery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">navigationTitle</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Birthday Filter"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span>toolbar <span class="token punctuation">&#123;</span>
                    <span class="token class-name">PhotosPicker</span><span class="token punctuation">(</span>
                        selection<span class="token punctuation">:</span> $viewModel<span class="token punctuation">.</span>imageSelection<span class="token punctuation">,</span>
                        matching<span class="token punctuation">:</span> <span class="token punctuation">.</span>images
                    <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token class-name">Label</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Pick a photo"</span></span><span class="token punctuation">,</span> systemImage<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"plus.app"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token class-name">Button</span> <span class="token punctuation">&#123;</span>
                        viewModel<span class="token punctuation">.</span><span class="token function">applyFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">&#125;</span> label<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                        <span class="token class-name">Label</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Apply Filter"</span></span><span class="token punctuation">,</span> systemImage<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"camera.filters"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="Slider"><a href="#Slider" class="headerlink" title="Slider"></a>Slider</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PlaySliderView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">var</span> count<span class="token punctuation">:</span> <span class="token class-name">Double</span> <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Slider</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> $count<span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token operator">...</span><span class="token number">100</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation"><span class="token class-name">Int</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="Stepper"><a href="#Stepper" class="headerlink" title="Stepper"></a>Stepper</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PlayStepperView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> count<span class="token punctuation">:</span> <span class="token class-name">Int</span> <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Stepper</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> $count<span class="token punctuation">,</span> step<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"共</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">count</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span> onEditingChanged<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span> b <span class="token keyword">in</span>
            <span class="token function">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span> <span class="token comment">// end Stepper</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="Form"><a href="#Form" class="headerlink" title="Form"></a>Form</h4><p>Form 今年也得到了增强，示例如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token class-name">Form</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Section</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">LabeledContent</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Location"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">AddressView</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">DatePicker</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Date"</span></span><span class="token punctuation">,</span> selection<span class="token punctuation">:</span> $date<span class="token punctuation">)</span>
        <span class="token class-name">TextField</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Description"</span></span><span class="token punctuation">,</span> text<span class="token punctuation">:</span> $eventDescription<span class="token punctuation">,</span> axis<span class="token punctuation">:</span> <span class="token punctuation">.</span>vertical<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">lineLimit</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> reservesSpace<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token class-name">Section</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Vibe"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Picker</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Accent color"</span></span><span class="token punctuation">,</span> selection<span class="token punctuation">:</span> $accent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">ForEach</span><span class="token punctuation">(</span><span class="token class-name">Theme</span><span class="token punctuation">.</span>allCases<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> accent <span class="token keyword">in</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span>accent<span class="token punctuation">.</span>rawValue<span class="token punctuation">.</span>capitalized<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span>accent<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">Picker</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Color scheme"</span></span><span class="token punctuation">,</span> selection<span class="token punctuation">:</span> $scheme<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Light"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span><span class="token class-name">ColorScheme</span><span class="token punctuation">.</span>light<span class="token punctuation">)</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Dark"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span><span class="token class-name">ColorScheme</span><span class="token punctuation">.</span>dark<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
<span class="token directive property"><span class="token directive-name">#if</span> os<span class="token punctuation">(</span>macOS<span class="token punctuation">)</span></span>
        <span class="token punctuation">.</span><span class="token function">pickerStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>inline<span class="token punctuation">)</span>
<span class="token directive property"><span class="token directive-name">#endif</span></span>
        <span class="token class-name">Toggle</span><span class="token punctuation">(</span>isOn<span class="token punctuation">:</span> $extraGuests<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Allow extra guests"</span></span><span class="token punctuation">)</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"The more the merrier!"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">if</span> extraGuests <span class="token punctuation">&#123;</span>
            <span class="token class-name">Stepper</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Guests limit"</span></span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> $spacesCount<span class="token punctuation">,</span> format<span class="token punctuation">:</span> <span class="token punctuation">.</span>number<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token class-name">Section</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Decorations"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Section</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">List</span><span class="token punctuation">(</span>selection<span class="token punctuation">:</span> $selectedDecorations<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">DisclosureGroup</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">HStack</span> <span class="token punctuation">&#123;</span>
                        <span class="token class-name">Toggle</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Balloons 🎈"</span></span><span class="token punctuation">,</span> isOn<span class="token punctuation">:</span> $includeBalloons<span class="token punctuation">)</span>
                        <span class="token class-name">Spacer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        decorationThemes<span class="token punctuation">[</span><span class="token punctuation">.</span>balloon<span class="token punctuation">]</span><span class="token punctuation">.</span>map <span class="token punctuation">&#123;</span> <span class="token short-argument">$0</span><span class="token punctuation">.</span>swatch <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span><span class="token class-name">Decoration</span><span class="token punctuation">.</span>balloon<span class="token punctuation">)</span>
                    
                    <span class="token class-name">HStack</span> <span class="token punctuation">&#123;</span>
                        <span class="token class-name">Toggle</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Confetti 🎊"</span></span><span class="token punctuation">,</span> isOn<span class="token punctuation">:</span> $includeConfetti<span class="token punctuation">)</span>
                        <span class="token class-name">Spacer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        decorationThemes<span class="token punctuation">[</span><span class="token punctuation">.</span>confetti<span class="token punctuation">]</span><span class="token punctuation">.</span>map <span class="token punctuation">&#123;</span> <span class="token short-argument">$0</span><span class="token punctuation">.</span>swatch <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span><span class="token class-name">Decoration</span><span class="token punctuation">.</span>confetti<span class="token punctuation">)</span>
                    
                    <span class="token class-name">HStack</span> <span class="token punctuation">&#123;</span>
                        <span class="token class-name">Toggle</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Inflatables 🪅"</span></span><span class="token punctuation">,</span> isOn<span class="token punctuation">:</span> $includeInflatables<span class="token punctuation">)</span>
                        <span class="token class-name">Spacer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        decorationThemes<span class="token punctuation">[</span><span class="token punctuation">.</span>inflatables<span class="token punctuation">]</span><span class="token punctuation">.</span>map <span class="token punctuation">&#123;</span> <span class="token short-argument">$0</span><span class="token punctuation">.</span>swatch <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span><span class="token class-name">Decoration</span><span class="token punctuation">.</span>inflatables<span class="token punctuation">)</span>
                    
                    <span class="token class-name">HStack</span> <span class="token punctuation">&#123;</span>
                        <span class="token class-name">Toggle</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Party Horns 🥳"</span></span><span class="token punctuation">,</span> isOn<span class="token punctuation">:</span> $includeBlowers<span class="token punctuation">)</span>
                        <span class="token class-name">Spacer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        decorationThemes<span class="token punctuation">[</span><span class="token punctuation">.</span>noisemakers<span class="token punctuation">]</span><span class="token punctuation">.</span>map <span class="token punctuation">&#123;</span> <span class="token short-argument">$0</span><span class="token punctuation">.</span>swatch <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span><span class="token class-name">Decoration</span><span class="token punctuation">.</span>noisemakers<span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span> label<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Toggle</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"All Decorations"</span></span><span class="token punctuation">,</span> isOn<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                        $includeBalloons<span class="token punctuation">,</span> $includeConfetti<span class="token punctuation">,</span>
                        $includeInflatables<span class="token punctuation">,</span> $includeBlowers
                    <span class="token punctuation">]</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span><span class="token class-name">Decoration</span><span class="token punctuation">.</span>all<span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
<span class="token directive property"><span class="token directive-name">#if</span> os<span class="token punctuation">(</span>macOS<span class="token punctuation">)</span></span>
                <span class="token punctuation">.</span><span class="token function">toggleStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>checkbox<span class="token punctuation">)</span>
<span class="token directive property"><span class="token directive-name">#endif</span></span>
            <span class="token punctuation">&#125;</span>
            
            <span class="token class-name">Picker</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Decoration theme"</span></span><span class="token punctuation">,</span> selection<span class="token punctuation">:</span> themes<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Blue"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span><span class="token class-name">Theme</span><span class="token punctuation">.</span>blue<span class="token punctuation">)</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Black"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span><span class="token class-name">Theme</span><span class="token punctuation">.</span>black<span class="token punctuation">)</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Gold"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span><span class="token class-name">Theme</span><span class="token punctuation">.</span>gold<span class="token punctuation">)</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"White"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span><span class="token class-name">Theme</span><span class="token punctuation">.</span>white<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
<span class="token directive property"><span class="token directive-name">#if</span> os<span class="token punctuation">(</span>macOS<span class="token punctuation">)</span></span>
            <span class="token punctuation">.</span><span class="token function">pickerStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>radioGroup<span class="token punctuation">)</span>
<span class="token directive property"><span class="token directive-name">#endif</span></span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    
<span class="token punctuation">&#125;</span>
<span class="token punctuation">.</span><span class="token function">formStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>grouped<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="Keyboard"><a href="#Keyboard" class="headerlink" title="Keyboard"></a>Keyboard</h4><p>键盘快捷键的使用方法如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PlayKeyboard</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Button</span><span class="token punctuation">(</span>systemIconName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"camera.shutter.button"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"按了回车键"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">keyboardShortcut</span><span class="token punctuation">(</span><span class="token punctuation">.</span>defaultAction<span class="token punctuation">)</span> <span class="token comment">// 回车</span>
        
        <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"ESC"</span></span><span class="token punctuation">,</span> action<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"按了 ESC"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">keyboardShortcut</span><span class="token punctuation">(</span><span class="token punctuation">.</span>cancelAction<span class="token punctuation">)</span> <span class="token comment">// ESC 键</span>
        
        <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"CMD + p"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"按了 CMD + p"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">keyboardShortcut</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"p"</span></span><span class="token punctuation">)</span>
        
        <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"SHIFT + p"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"按了 SHIFT + p"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">keyboardShortcut</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"p"</span></span><span class="token punctuation">,</span> modifiers<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">.</span>shift<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="Transferable"><a href="#Transferable" class="headerlink" title="Transferable"></a>Transferable</h4><p>Transferable 协议使数据可以用于剪切板、拖放和 Share Sheet。</p>
<p>可以在自己应用程序之间或你的应用和其他应用之间发送或接受可传输项目。</p>
<p>支持 SwiftUI 来使用。</p>
<p>官方文档 <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/CoreTransferable">Core Transferable</a></p>
<p>session <a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2022-10062">Meet Transferable</a></p>
<p>新增一个专门用来接受 Transferable 的按钮视图 PasteButton，使用示例如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PPasteButton</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"戴铭"</span></span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">TextField</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"输入"</span></span><span class="token punctuation">,</span> text<span class="token punctuation">:</span> $s<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">textFieldStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>roundedBorder<span class="token punctuation">)</span>
        <span class="token class-name">PasteButton</span><span class="token punctuation">(</span>payloadType<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> str <span class="token keyword">in</span>
            <span class="token keyword">guard</span> <span class="token keyword">let</span> first <span class="token operator">=</span> str<span class="token punctuation">.</span>first <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token punctuation">&#125;</span>
            s <span class="token operator">=</span> first
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="ShareLink"><a href="#ShareLink" class="headerlink" title="ShareLink"></a>ShareLink</h4><p>ShareLink 视图可以让你轻松共享数据。示例代码如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PShareLink</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token function">URL</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"https://ming1016.github.io/"</span></span><span class="token punctuation">)</span><span class="token operator">!</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ShareLink</span><span class="token punctuation">(</span>item<span class="token punctuation">:</span> url<span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"戴铭的博客"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token class-name">ShareLink</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"戴铭的博客"</span></span><span class="token punctuation">,</span> item<span class="token punctuation">:</span> url<span class="token punctuation">)</span>
        <span class="token class-name">ShareLink</span><span class="token punctuation">(</span>item<span class="token punctuation">:</span> url<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Label</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"戴铭的博客"</span></span><span class="token punctuation">,</span> systemImage<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"swift"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="视觉"><a href="#视觉" class="headerlink" title="视觉"></a>视觉</h3><h4 id="Color"><a href="#Color" class="headerlink" title="Color"></a>Color</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PlayColor</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ZStack</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Color</span><span class="token punctuation">.</span>black<span class="token punctuation">.</span><span class="token function">edgesIgnoringSafeArea</span><span class="token punctuation">(</span><span class="token punctuation">.</span>all<span class="token punctuation">)</span> <span class="token comment">// Color 也是一个 View</span>
            
            <span class="token class-name">VStack</span><span class="token punctuation">(</span>spacing<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"这是一个适配了暗黑的文字颜色"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span>light<span class="token punctuation">:</span> <span class="token punctuation">.</span>purple<span class="token punctuation">,</span> dark<span class="token punctuation">:</span> <span class="token punctuation">.</span>pink<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">background</span><span class="token punctuation">(</span><span class="token class-name">Color</span><span class="token punctuation">(</span>nsColor<span class="token punctuation">:</span> <span class="token punctuation">.</span>quaternaryLabelColor<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 使用以前 NSColor</span>
                
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"自定义颜色"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span><span class="token class-name">Color</span><span class="token punctuation">(</span>red<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> green<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> blue<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
            <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// MARK: - 暗黑适配颜色</span>
<span class="token keyword">struct</span> <span class="token class-name">PCColorModifier</span><span class="token punctuation">:</span> <span class="token class-name">ViewModifier</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@Environment</span><span class="token punctuation">(</span><span class="token punctuation">\</span><span class="token punctuation">.</span>colorScheme<span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token keyword">var</span> colorScheme
    <span class="token keyword">var</span> light<span class="token punctuation">:</span> <span class="token class-name">Color</span>
    <span class="token keyword">var</span> dark<span class="token punctuation">:</span> <span class="token class-name">Color</span>
    
    <span class="token keyword">private</span> <span class="token keyword">var</span> adaptColor<span class="token punctuation">:</span> <span class="token class-name">Color</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">switch</span> colorScheme <span class="token punctuation">&#123;</span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span>light<span class="token punctuation">:</span>
            <span class="token keyword">return</span> light
        <span class="token keyword">case</span> <span class="token punctuation">.</span>dark<span class="token punctuation">:</span>
            <span class="token keyword">return</span> dark
        <span class="token attribute atrule">@unknown</span> <span class="token keyword">default</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> light
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">func</span> <span class="token function-definition function">body</span><span class="token punctuation">(</span>content<span class="token punctuation">:</span> <span class="token class-name">Content</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        content<span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span>adaptColor<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">extension</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">func</span> <span class="token function-definition function">foregroundColor</span><span class="token punctuation">(</span>light<span class="token punctuation">:</span> <span class="token class-name">Color</span><span class="token punctuation">,</span> dark<span class="token punctuation">:</span> <span class="token class-name">Color</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token function">modifier</span><span class="token punctuation">(</span><span class="token class-name">PCColorModifier</span><span class="token punctuation">(</span>light<span class="token punctuation">:</span> light<span class="token punctuation">,</span> dark<span class="token punctuation">:</span> dark<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="Effect"><a href="#Effect" class="headerlink" title="Effect"></a>Effect</h4><p><img  srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://user-images.githubusercontent.com/251980/156332122-66813e4e-851c-4207-8cb9-b41ea0365008.jpeg" class="lozad post-image"src="https://user-images.githubusercontent.com/251980/156332122-66813e4e-851c-4207-8cb9-b41ea0365008.jpeg"></p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PlayEffect</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> isHover <span class="token operator">=</span> <span class="token boolean">false</span>
    
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ZStack</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">LinearGradient</span><span class="token punctuation">(</span>colors<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">.</span>purple<span class="token punctuation">,</span> <span class="token punctuation">.</span>black<span class="token punctuation">,</span> <span class="token punctuation">.</span>pink<span class="token punctuation">]</span><span class="token punctuation">,</span> startPoint<span class="token punctuation">:</span> <span class="token punctuation">.</span>top<span class="token punctuation">,</span> endPoint<span class="token punctuation">:</span> <span class="token punctuation">.</span>bottom<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ignoresSafeArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            <span class="token class-name">VStack</span><span class="token punctuation">(</span>spacing<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                
                <span class="token comment">// 材质</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"材质效果"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">system</span><span class="token punctuation">(</span>size<span class="token punctuation">:</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span>isHover <span class="token operator">?</span> <span class="token number">40</span> <span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">background</span><span class="token punctuation">(</span><span class="token punctuation">.</span>regularMaterial<span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token class-name">RoundedRectangle</span><span class="token punctuation">(</span>cornerRadius<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token punctuation">.</span>continuous<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span>onHover <span class="token punctuation">&#123;</span> b <span class="token keyword">in</span>
                        withAnimation <span class="token punctuation">&#123;</span>
                            isHover <span class="token operator">=</span> b
                        <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">&#125;</span>
                
                <span class="token comment">// 模糊</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"模糊效果"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">system</span><span class="token punctuation">(</span>size<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span>background <span class="token punctuation">&#123;</span>
                        <span class="token class-name">Color</span><span class="token punctuation">.</span>black<span class="token punctuation">.</span><span class="token function">blur</span><span class="token punctuation">(</span>radius<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span> opaque<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
                    <span class="token punctuation">&#125;</span>
                
                <span class="token comment">// 选择</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"3D 旋转"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>largeTitle<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">rotation3DEffect</span><span class="token punctuation">(</span><span class="token class-name">Angle</span><span class="token punctuation">(</span>degrees<span class="token punctuation">:</span> <span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token punctuation">:</span> <span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span> z<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">scaleEffect</span><span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">blendMode</span><span class="token punctuation">(</span><span class="token punctuation">.</span>hardLight<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">blur</span><span class="token punctuation">(</span>radius<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">)</span>
                
            <span class="token punctuation">&#125;</span>
                
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>材质厚度从低到高有：</p>
<ul>
<li>.regularMaterial</li>
<li>.thinMaterial</li>
<li>.ultraThinMaterial</li>
<li>.thickMaterial</li>
<li>.ultraThickMaterial</li>
</ul>
<p>Gradient 和 Shadow 的 2022 的更新</p>
<p>下面是个简单示例：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PGradientAndShadow</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"bird"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">150</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">150</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">background</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token class-name">Rectangle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">backgroundStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>cyan<span class="token punctuation">.</span>gradient<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">foregroundStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>white<span class="token punctuation">.</span><span class="token function">shadow</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">drop</span><span class="token punctuation">(</span>radius<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">3.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">system</span><span class="token punctuation">(</span>size<span class="token punctuation">:</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Paul Hudson 使用 Core Motion 做了一个阴影随设备倾斜而变化的效果，非常棒，<a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/articles/253/how-to-use-inner-shadows-to-simulate-depth-with-swiftui-and-core-motion">How to use inner shadows to simulate depth with SwiftUI and Core Motion</a> 。</p>
<h4 id="Animation"><a href="#Animation" class="headerlink" title="Animation"></a>Animation</h4><p>SwiftUI 里实现动画的方式包括有 .animation 隐式动画、withAnimation 和 withTransaction 显示动画、matchedGeometryEffect Hero 动画和 TimelineView 等。</p>
<p>示例代码如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PlayAnimation</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> isChange <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token keyword">private</span> <span class="token keyword">var</span> anis<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">:</span> <span class="token class-name">Animation</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string-literal"><span class="token string">"p1"</span></span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">,</span>
        <span class="token string-literal"><span class="token string">"p2"</span></span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">linear</span><span class="token punctuation">(</span>duration<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string-literal"><span class="token string">"p3"</span></span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">interpolatingSpring</span><span class="token punctuation">(</span>stiffness<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> damping<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string-literal"><span class="token string">"p4"</span></span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">easeInOut</span><span class="token punctuation">(</span>duration<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string-literal"><span class="token string">"p5"</span></span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">easeIn</span><span class="token punctuation">(</span>duration<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string-literal"><span class="token string">"p6"</span></span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">easeOut</span><span class="token punctuation">(</span>duration<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string-literal"><span class="token string">"p7"</span></span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">interactiveSpring</span><span class="token punctuation">(</span>response<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> dampingFraction<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> blendDuration<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string-literal"><span class="token string">"p8"</span></span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">spring</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string-literal"><span class="token string">"p9"</span></span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span><span class="token function">repeatCount</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> selection <span class="token operator">=</span> <span class="token number">1</span>
    
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// animation 隐式动画和 withAnimation 显示动画</span>
        <span class="token class-name">Text</span><span class="token punctuation">(</span>isChange <span class="token operator">?</span> <span class="token string-literal"><span class="token string">"另一种状态"</span></span> <span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"一种状态"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>headline<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">animation</span><span class="token punctuation">(</span><span class="token punctuation">.</span>easeInOut<span class="token punctuation">,</span> value<span class="token punctuation">:</span> isChange<span class="token punctuation">)</span> <span class="token comment">// 受限的隐式动画，只绑定某个值。</span>
            <span class="token punctuation">.</span>onTapGesture <span class="token punctuation">&#123;</span>
                <span class="token comment">// 使用 withAnimation 就是显式动画，效果等同 withTransaction(Transaction(animation: .default))</span>
                withAnimation <span class="token punctuation">&#123;</span>
                    isChange<span class="token punctuation">.</span><span class="token function">toggle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>

                <span class="token comment">// 设置 Transaction。和隐式动画共存时，优先执行 withAnimation 或 Transaction。</span>
                <span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token class-name">Transaction</span><span class="token punctuation">(</span>animation<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">linear</span><span class="token punctuation">(</span>duration<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                t<span class="token punctuation">.</span>disablesAnimations <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// 用来禁用隐式动画</span>
                <span class="token function">withTransaction</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    isChange<span class="token punctuation">.</span><span class="token function">toggle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span> <span class="token comment">// end onHover</span>
        
        <span class="token class-name">LazyVGrid</span><span class="token punctuation">(</span>columns<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">GridItem</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">adaptive</span><span class="token punctuation">(</span>minimum<span class="token punctuation">:</span> isChange <span class="token operator">?</span> <span class="token number">60</span> <span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span> spacing<span class="token punctuation">:</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">ForEach</span><span class="token punctuation">(</span><span class="token class-name">Array</span><span class="token punctuation">(</span>anis<span class="token punctuation">.</span>keys<span class="token punctuation">)</span><span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token punctuation">\</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> s <span class="token keyword">in</span>
                <span class="token class-name">Image</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">resizable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">scaledToFit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">animation</span><span class="token punctuation">(</span>anis<span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> isChange<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">scaleEffect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token class-name">Button</span> <span class="token punctuation">&#123;</span>
            isChange<span class="token punctuation">.</span><span class="token function">toggle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span> label<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> isChange <span class="token operator">?</span> <span class="token string-literal"><span class="token string">"pause.fill"</span></span> <span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"play.fill"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">renderingMode</span><span class="token punctuation">(</span><span class="token punctuation">.</span>original<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        
        <span class="token comment">// matchedGeometryEffect 的使用</span>
        <span class="token class-name">VStack</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"后台"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>headline<span class="token punctuation">)</span>
            placeStayView
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"前台"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>headline<span class="token punctuation">)</span>
            placeShowView
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>
        
        <span class="token comment">// 通过使用相同 matchedGeometryEffect 的 id，绑定两个元素变化。</span>
        <span class="token class-name">HStack</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> isChange <span class="token punctuation">&#123;</span>
                <span class="token class-name">Rectangle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">.</span>pink<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">matchedGeometryEffect</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"g1"</span></span><span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token punctuation">:</span> mgeStore<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
            <span class="token class-name">Spacer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"转换"</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token function">withAnimation</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">linear</span><span class="token punctuation">(</span>duration<span class="token punctuation">:</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    isChange<span class="token punctuation">.</span><span class="token function">toggle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token class-name">Spacer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token operator">!</span>isChange <span class="token punctuation">&#123;</span>
                <span class="token class-name">Circle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">.</span>orange<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">matchedGeometryEffect</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"g1"</span></span><span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token punctuation">:</span> mgeStore<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">70</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">70</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
            <span class="token class-name">HStack</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"p1"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">resizable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">scaledToFit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token operator">!</span>isChange <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"p19"</span></span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">resizable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">scaledToFit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">matchedGeometryEffect</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"g1"</span></span><span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token punctuation">:</span> mgeStore<span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
                <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"p1"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">resizable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">scaledToFit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment">// 使用 isSource，作为移动到相同 matchedGeometryEffect id 的方法。</span>
        <span class="token class-name">HStack</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"p19"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">resizable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">scaledToFit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> isChange <span class="token operator">?</span> <span class="token number">100</span> <span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> isChange <span class="token operator">?</span> <span class="token number">100</span> <span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">matchedGeometryEffect</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> isChange <span class="token operator">?</span> <span class="token string-literal"><span class="token string">"g2"</span></span> <span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token punctuation">:</span> mgeStore<span class="token punctuation">,</span> isSource<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
            
            <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"p19"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">resizable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">scaledToFit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">matchedGeometryEffect</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"g2"</span></span><span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token punctuation">:</span> mgeStore<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">opacity</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        
        
        
        <span class="token comment">// 点击跟随的效果</span>
        <span class="token class-name">HStack</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">ForEach</span><span class="token punctuation">(</span><span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">...</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token punctuation">\</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> i <span class="token keyword">in</span>
                <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"p</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">resizable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">scaledToFit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> i <span class="token operator">==</span> selection <span class="token operator">?</span> <span class="token number">200</span> <span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">matchedGeometryEffect</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"h</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">i</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token punctuation">:</span> mgeStore<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span>onTapGesture <span class="token punctuation">&#123;</span>
                        withAnimation <span class="token punctuation">&#123;</span>
                            selection <span class="token operator">=</span> i
                        <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">.</span><span class="token function">shadow</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token punctuation">.</span>black<span class="token punctuation">,</span> radius<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> x<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token punctuation">.</span><span class="token function">background</span><span class="token punctuation">(</span>
            <span class="token class-name">RoundedRectangle</span><span class="token punctuation">(</span>cornerRadius<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">.</span>pink<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">matchedGeometryEffect</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"h</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">selection</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token punctuation">:</span> mgeStore<span class="token punctuation">,</span> isSource<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
        
        <span class="token comment">// matchedGeometryEffect 还可以应用到 List 中，通过 Array enumerated 获得 index 作为 matchedGeometryEffect 的 id。右侧固定按钮可以直接让对应 id 的视图滚动到固定按钮的位置</span>
        
        
        <span class="token comment">// TimelineView</span>
        <span class="token class-name">TimelineView</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">periodic</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> <span class="token punctuation">.</span>now<span class="token punctuation">,</span> by<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> t <span class="token keyword">in</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">t<span class="token punctuation">.</span>date</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token class-name">HStack</span><span class="token punctuation">(</span>spacing<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">let</span> e <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"p</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation"><span class="token class-name">Int</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token operator">...</span><span class="token number">30</span><span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span>
                <span class="token class-name">Image</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">resizable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">scaledToFit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token number">40</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">animation</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span><span class="token function">repeatCount</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> e<span class="token punctuation">)</span>
                
                <span class="token class-name">TimelineSubView</span><span class="token punctuation">(</span>date<span class="token punctuation">:</span> t<span class="token punctuation">.</span>date<span class="token punctuation">)</span> <span class="token comment">// 需要传入 timeline 的时间给子视图才能够起作用。</span>
                    
            <span class="token punctuation">&#125;</span>
            <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        
        <span class="token comment">// matchedGeometryEffect</span>

        <span class="token comment">/// TimelineScheduler 的使用，TimelineScheduler 有以下类型</span>
        <span class="token comment">/// .animation：制定更新的频率，可以控制暂停</span>
        <span class="token comment">/// .everyMinute：每分钟更新一次</span>
        <span class="token comment">/// .explicit：所有要更新的放到一个数组里</span>
        <span class="token comment">/// .periodic：设置开始时间和更新频率</span>
        <span class="token comment">/// 也可以自定义 TimelineScheduler</span>
        <span class="token class-name">TimelineView</span><span class="token punctuation">(</span><span class="token punctuation">.</span>everySecond<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> t <span class="token keyword">in</span>
            <span class="token keyword">let</span> e <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"p</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation"><span class="token class-name">Int</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token operator">...</span><span class="token number">30</span><span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span>
            <span class="token class-name">Image</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">resizable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">scaledToFit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token number">40</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        
        <span class="token comment">// 自定义的 TimelineScheduler</span>
        <span class="token class-name">TimelineView</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">everyLoop</span><span class="token punctuation">(</span>timeOffsets<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> t <span class="token keyword">in</span>
            <span class="token class-name">TimelineSubView</span><span class="token punctuation">(</span>date<span class="token punctuation">:</span> t<span class="token punctuation">.</span>date<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">// MARK: - TimelineSubView</span>
    <span class="token keyword">struct</span> <span class="token class-name">TimelineSubView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> date <span class="token punctuation">:</span> <span class="token class-name">Date</span>
        <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"let's go"</span></span>
        <span class="token comment">// 顺序从数组中取值，取完再重头开始</span>
        <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> idx<span class="token punctuation">:</span> <span class="token class-name">Int</span> <span class="token operator">=</span> <span class="token number">1</span>
        <span class="token keyword">func</span> <span class="token function-definition function">advanceIndex</span><span class="token punctuation">(</span>count<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            idx <span class="token operator">=</span> <span class="token punctuation">(</span>idx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> count
            <span class="token keyword">if</span> idx <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">&#123;</span> idx <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        
        <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">HStack</span><span class="token punctuation">(</span>spacing<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"p</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">idx</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">resizable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">scaledToFit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token number">40</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">animation</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">easeIn</span><span class="token punctuation">(</span>duration<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> date<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">(</span>of<span class="token punctuation">:</span> date<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> newValue <span class="token keyword">in</span>
                        <span class="token function">advanceIndex</span><span class="token punctuation">(</span>count<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">)</span>
                        s <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">date<span class="token punctuation">.</span>hour</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">:</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">date<span class="token punctuation">.</span>minute</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">:</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">date<span class="token punctuation">.</span>second</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">.</span>onAppear <span class="token punctuation">&#123;</span>
                        <span class="token function">advanceIndex</span><span class="token punctuation">(</span>count<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">)</span>
                    <span class="token punctuation">&#125;</span>
                    
                <span class="token class-name">Text</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">// MARK: - 用 matchedGeometryEffect 做动画</span>
    <span class="token comment">/// matchedGeometryEffect 可以无缝的将一个图像变成另外一个图像。</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> placeStayItems <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"p1"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"p2"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"p3"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"p4"</span></span><span class="token punctuation">]</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> placeShowItems<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    
    <span class="token attribute atrule">@Namespace</span> <span class="token keyword">private</span> <span class="token keyword">var</span> mgeStore
    
    <span class="token keyword">private</span> <span class="token keyword">var</span> placeStayView<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">LazyVGrid</span><span class="token punctuation">(</span>columns<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">GridItem</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">adaptive</span><span class="token punctuation">(</span>minimum<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span> spacing<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">ForEach</span><span class="token punctuation">(</span>placeStayItems<span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token punctuation">\</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> s <span class="token keyword">in</span>
                <span class="token class-name">Image</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">resizable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">scaledToFit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">matchedGeometryEffect</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> s<span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token punctuation">:</span> mgeStore<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span>onTapGesture <span class="token punctuation">&#123;</span>
                        withAnimation <span class="token punctuation">&#123;</span>
                            placeStayItems<span class="token punctuation">.</span>removeAll <span class="token punctuation">&#123;</span> <span class="token short-argument">$0</span> <span class="token operator">==</span> s <span class="token punctuation">&#125;</span>
                            placeShowItems<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
                        <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">.</span><span class="token function">shadow</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token punctuation">.</span>black<span class="token punctuation">,</span> radius<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> x<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span> <span class="token comment">// end ForEach</span>
        <span class="token punctuation">&#125;</span> <span class="token comment">// end LazyVGrid</span>
    <span class="token punctuation">&#125;</span> <span class="token comment">// private var placeStayView</span>
    
    <span class="token keyword">private</span> <span class="token keyword">var</span> placeShowView<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">LazyVGrid</span><span class="token punctuation">(</span>columns<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">GridItem</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">adaptive</span><span class="token punctuation">(</span>minimum<span class="token punctuation">:</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">,</span> spacing<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">ForEach</span><span class="token punctuation">(</span>placeShowItems<span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token punctuation">\</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> s <span class="token keyword">in</span>
                <span class="token class-name">Image</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">resizable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">scaledToFit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">matchedGeometryEffect</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> s<span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token punctuation">:</span> mgeStore<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span>onTapGesture <span class="token punctuation">&#123;</span>
                        withAnimation <span class="token punctuation">&#123;</span>
                            placeShowItems<span class="token punctuation">.</span>removeAll <span class="token punctuation">&#123;</span> <span class="token short-argument">$0</span> <span class="token operator">==</span> s <span class="token punctuation">&#125;</span>
                            placeStayItems<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
                        <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">.</span><span class="token function">shadow</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token punctuation">.</span>black<span class="token punctuation">,</span> radius<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">shadow</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token punctuation">.</span>white<span class="token punctuation">,</span> radius<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span> <span class="token comment">// end ForEach</span>
        <span class="token punctuation">&#125;</span> <span class="token comment">// end LazyVGrid</span>
    <span class="token punctuation">&#125;</span> <span class="token comment">// end private var placeShowView</span>
    
<span class="token punctuation">&#125;</span> <span class="token comment">// end struct PlayAnimation</span>

<span class="token comment">// MARK: - 扩展 TimelineSchedule</span>
<span class="token keyword">extension</span> <span class="token class-name">TimelineSchedule</span> <span class="token keyword">where</span> <span class="token keyword">Self</span> <span class="token operator">==</span> <span class="token class-name">PeriodicTimelineSchedule</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">var</span> everySecond<span class="token punctuation">:</span> <span class="token class-name">PeriodicTimelineSchedule</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">get</span> <span class="token punctuation">&#123;</span>
            <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> <span class="token punctuation">.</span>now<span class="token punctuation">,</span> by<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// MARK: - 自定义一个 TimelineSchedule</span>
<span class="token comment">// timeOffsets 用完，就会再重头重新再来一遍</span>
<span class="token keyword">struct</span> <span class="token class-name">PCLoopTimelineSchedule</span><span class="token punctuation">:</span> <span class="token class-name">TimelineSchedule</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> timeOffsets<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">TimeInterval</span><span class="token punctuation">]</span>
    
    <span class="token keyword">func</span> <span class="token function-definition function">entries</span><span class="token punctuation">(</span>from startDate<span class="token punctuation">:</span> <span class="token class-name">Date</span><span class="token punctuation">,</span> mode<span class="token punctuation">:</span> <span class="token class-name">TimelineScheduleMode</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Entries</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Entries</span><span class="token punctuation">(</span>last<span class="token punctuation">:</span> startDate<span class="token punctuation">,</span> offsets<span class="token punctuation">:</span> timeOffsets<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">struct</span> <span class="token class-name">Entries</span><span class="token punctuation">:</span> <span class="token class-name">Sequence</span><span class="token punctuation">,</span> <span class="token class-name">IteratorProtocol</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">var</span> last<span class="token punctuation">:</span> <span class="token class-name">Date</span>
        <span class="token keyword">let</span> offsets<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">TimeInterval</span><span class="token punctuation">]</span>
        <span class="token keyword">var</span> idx<span class="token punctuation">:</span> <span class="token class-name">Int</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
        <span class="token keyword">mutating</span> <span class="token keyword">func</span> <span class="token function-definition function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Date</span><span class="token operator">?</span> <span class="token punctuation">&#123;</span>
            idx <span class="token operator">=</span> <span class="token punctuation">(</span>idx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> offsets<span class="token punctuation">.</span>count
            last <span class="token operator">=</span> last<span class="token punctuation">.</span><span class="token function">addingTimeInterval</span><span class="token punctuation">(</span>offsets<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> last
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span> <span class="token comment">// end Struct Entries</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 为自定义的 PCLoopTimelineSchedule 做一个 TimelineSchedule 的扩展函数，方便使用</span>
<span class="token keyword">extension</span> <span class="token class-name">TimelineSchedule</span> <span class="token keyword">where</span> <span class="token keyword">Self</span> <span class="token operator">==</span> <span class="token class-name">PCLoopTimelineSchedule</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">everyLoop</span><span class="token punctuation">(</span>timeOffsets<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">TimeInterval</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">PCLoopTimelineSchedule</span> <span class="token punctuation">&#123;</span>
        <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>timeOffsets<span class="token punctuation">:</span> timeOffsets<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="Canvas"><a href="#Canvas" class="headerlink" title="Canvas"></a>Canvas</h4><p>Canvas 可以画路径、图片和文字、Symbols、可变的图形上下文、使用 CoreGraphics 代码和做动画。</p>
<p>图形上下文可以被 addFilter、clip、clipToLayer、concatenate、rotate、scaleBy、translateBy 这些方法来进行改变。</p>
<p>示例代码如下：</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PlayCanvas</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> colors<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Color</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">.</span>purple<span class="token punctuation">,</span> <span class="token punctuation">.</span>blue<span class="token punctuation">,</span> <span class="token punctuation">.</span>yellow<span class="token punctuation">,</span> <span class="token punctuation">.</span>pink<span class="token punctuation">]</span>
    
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        
        <span class="token comment">// 画路径</span>
        <span class="token class-name">PCCanvasPathView</span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> <span class="token punctuation">.</span>rounded<span class="token punctuation">)</span>
        <span class="token class-name">PCCanvasPathView</span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> <span class="token punctuation">.</span>ellipse<span class="token punctuation">)</span>
        <span class="token class-name">PCCanvasPathView</span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> <span class="token punctuation">.</span>circle<span class="token punctuation">)</span>

        <span class="token comment">// 图片和文字</span>
        <span class="token class-name">PCCanvasImageAndText</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Starming"</span></span><span class="token punctuation">,</span> colors<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">.</span>purple<span class="token punctuation">,</span> <span class="token punctuation">.</span>pink<span class="token punctuation">]</span><span class="token punctuation">)</span>

        <span class="token comment">// Symbol，在 Canvas 里引用 SwiftUI 视图</span>
        <span class="token class-name">Canvas</span> <span class="token punctuation">&#123;</span> c<span class="token punctuation">,</span> s <span class="token keyword">in</span>
            <span class="token keyword">let</span> c0 <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">resolveSymbol</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">!</span>
            <span class="token keyword">let</span> c1 <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">resolveSymbol</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">!</span>
            <span class="token keyword">let</span> c2 <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">resolveSymbol</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">!</span>
            <span class="token keyword">let</span> c3 <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">resolveSymbol</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">!</span>

            c<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>c0<span class="token punctuation">,</span> at<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> anchor<span class="token punctuation">:</span> <span class="token punctuation">.</span>topLeading<span class="token punctuation">)</span>
            c<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>c1<span class="token punctuation">,</span> at<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> anchor<span class="token punctuation">:</span> <span class="token punctuation">.</span>topLeading<span class="token punctuation">)</span>
            c<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>c2<span class="token punctuation">,</span> at<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span> anchor<span class="token punctuation">:</span> <span class="token punctuation">.</span>topLeading<span class="token punctuation">)</span>
            c<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>c3<span class="token punctuation">,</span> at<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token number">70</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">,</span> anchor<span class="token punctuation">:</span> <span class="token punctuation">.</span>topLeading<span class="token punctuation">)</span>

        <span class="token punctuation">&#125;</span> symbols<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">ForEach</span><span class="token punctuation">(</span><span class="token class-name">Array</span><span class="token punctuation">(</span>colors<span class="token punctuation">.</span><span class="token function">enumerated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token punctuation">\</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> i<span class="token punctuation">,</span> c <span class="token keyword">in</span>
                <span class="token class-name">Circle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">// Symbol 动画和 SwiftUI 视图一样，不会受影响</span>
        <span class="token class-name">Canvas</span> <span class="token punctuation">&#123;</span> c<span class="token punctuation">,</span> s <span class="token keyword">in</span>
            <span class="token keyword">let</span> sb <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">resolveSymbol</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">!</span>
            c<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>sb<span class="token punctuation">,</span> at<span class="token punctuation">:</span> <span class="token class-name">CGPoint</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> s<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> s<span class="token punctuation">.</span>height <span class="token operator">/</span>  <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> anchor<span class="token punctuation">:</span> <span class="token punctuation">.</span>center<span class="token punctuation">)</span>

        <span class="token punctuation">&#125;</span> symbols<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">PCForSymbolView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span> <span class="token comment">// end var body</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// MARK: - 给 Symbol 用的视图</span>
<span class="token keyword">struct</span> <span class="token class-name">PCForSymbolView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> change <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"star.fill"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">renderingMode</span><span class="token punctuation">(</span><span class="token punctuation">.</span>original<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>largeTitle<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">rotationEffect</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">degrees</span><span class="token punctuation">(</span>change <span class="token operator">?</span> <span class="token number">0</span> <span class="token punctuation">:</span> <span class="token number">72</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span>onAppear <span class="token punctuation">&#123;</span>
                <span class="token function">withAnimation</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">linear</span><span class="token punctuation">(</span>duration<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">repeatForever</span><span class="token punctuation">(</span>autoreverses<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    change<span class="token punctuation">.</span><span class="token function">toggle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// MARK: - 图片和文字</span>
<span class="token keyword">struct</span> <span class="token class-name">PCCanvasImageAndText</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> text<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">let</span> colors<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Color</span><span class="token punctuation">]</span>
    <span class="token keyword">var</span> fontSize<span class="token punctuation">:</span> <span class="token class-name">Double</span> <span class="token operator">=</span> <span class="token number">42</span>
    
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Canvas</span> <span class="token punctuation">&#123;</span> context<span class="token punctuation">,</span> size <span class="token keyword">in</span>
            <span class="token keyword">let</span> midPoint <span class="token operator">=</span> <span class="token class-name">CGPoint</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> size<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> size<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>
            <span class="token keyword">let</span> font <span class="token operator">=</span> <span class="token class-name">Font</span><span class="token punctuation">.</span><span class="token function">system</span><span class="token punctuation">(</span>size<span class="token punctuation">:</span> fontSize<span class="token punctuation">)</span>
            <span class="token keyword">var</span> resolved <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token class-name">Text</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span>font<span class="token punctuation">)</span><span class="token punctuation">)</span>
            
            <span class="token keyword">let</span> start <span class="token operator">=</span> <span class="token class-name">CGPoint</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token punctuation">(</span>size<span class="token punctuation">.</span>width <span class="token operator">-</span> resolved<span class="token punctuation">.</span><span class="token function">measure</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> size<span class="token punctuation">)</span><span class="token punctuation">.</span>width<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">let</span> end <span class="token operator">=</span> <span class="token class-name">CGPoint</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> size<span class="token punctuation">.</span>width <span class="token operator">-</span> start<span class="token punctuation">.</span>x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span>
            
            resolved<span class="token punctuation">.</span>shading <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token function">linearGradient</span><span class="token punctuation">(</span><span class="token class-name">Gradient</span><span class="token punctuation">(</span>colors<span class="token punctuation">:</span> colors<span class="token punctuation">)</span><span class="token punctuation">,</span> startPoint<span class="token punctuation">:</span> start<span class="token punctuation">,</span> endPoint<span class="token punctuation">:</span> end<span class="token punctuation">)</span>
            context<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>resolved<span class="token punctuation">,</span> at<span class="token punctuation">:</span> midPoint<span class="token punctuation">,</span> anchor<span class="token punctuation">:</span> <span class="token punctuation">.</span>center<span class="token punctuation">)</span>
            
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// MARK: - Path</span>
<span class="token keyword">struct</span> <span class="token class-name">PCCanvasPathView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">enum</span> <span class="token class-name">PathType</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">case</span> rounded<span class="token punctuation">,</span> ellipse<span class="token punctuation">,</span> casual<span class="token punctuation">,</span> circle
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">let</span> t<span class="token punctuation">:</span> <span class="token class-name">PathType</span>
    
    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Canvas</span> <span class="token punctuation">&#123;</span> context<span class="token punctuation">,</span> size <span class="token keyword">in</span>
            
            <span class="token function">conf</span><span class="token punctuation">(</span>context<span class="token punctuation">:</span> <span class="token operator">&amp;</span>context<span class="token punctuation">,</span> size<span class="token punctuation">:</span> size<span class="token punctuation">,</span> type<span class="token punctuation">:</span> t<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span> <span class="token comment">// end Canvas</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">func</span> <span class="token function-definition function">conf</span><span class="token punctuation">(</span> context<span class="token punctuation">:</span> <span class="token keyword">inout</span> <span class="token class-name">GraphicsContext</span><span class="token punctuation">,</span> size<span class="token punctuation">:</span> <span class="token class-name">CGSize</span><span class="token punctuation">,</span> type<span class="token punctuation">:</span> <span class="token class-name">PathType</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> rect <span class="token operator">=</span> <span class="token class-name">CGRect</span><span class="token punctuation">(</span>origin<span class="token punctuation">:</span> <span class="token punctuation">.</span>zero<span class="token punctuation">,</span> size<span class="token punctuation">:</span> size<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insetBy</span><span class="token punctuation">(</span>dx<span class="token punctuation">:</span> <span class="token number">25</span><span class="token punctuation">,</span> dy<span class="token punctuation">:</span> <span class="token number">25</span><span class="token punctuation">)</span>
        <span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">switch</span> type <span class="token punctuation">&#123;</span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span>rounded<span class="token punctuation">:</span>
            path <span class="token operator">=</span> <span class="token class-name">Path</span><span class="token punctuation">(</span>roundedRect<span class="token punctuation">:</span> rect<span class="token punctuation">,</span> cornerRadius<span class="token punctuation">:</span> <span class="token number">35.0</span><span class="token punctuation">)</span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span>ellipse<span class="token punctuation">:</span>
            <span class="token keyword">let</span> cgPath <span class="token operator">=</span> <span class="token class-name">CGPath</span><span class="token punctuation">(</span>ellipseIn<span class="token punctuation">:</span> rect<span class="token punctuation">,</span> transform<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span>
            path <span class="token operator">=</span> <span class="token class-name">Path</span><span class="token punctuation">(</span>cgPath<span class="token punctuation">)</span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span>casual<span class="token punctuation">:</span>
            path <span class="token operator">=</span> <span class="token class-name">Path</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">let</span> points<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">CGPoint</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span>
                <span class="token short-argument">$0</span><span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span>to<span class="token punctuation">:</span> <span class="token punctuation">.</span>zero<span class="token punctuation">)</span>
                <span class="token short-argument">$0</span><span class="token punctuation">.</span><span class="token function">addLines</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span>circle<span class="token punctuation">:</span>
            path <span class="token operator">=</span> <span class="token class-name">Circle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> rect<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        
        
        <span class="token keyword">let</span> gradient <span class="token operator">=</span> <span class="token class-name">Gradient</span><span class="token punctuation">(</span>colors<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">.</span>purple<span class="token punctuation">,</span> <span class="token punctuation">.</span>pink<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> from <span class="token operator">=</span> rect<span class="token punctuation">.</span>origin
        <span class="token keyword">let</span> to <span class="token operator">=</span> <span class="token class-name">CGPoint</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> rect<span class="token punctuation">.</span>width<span class="token punctuation">,</span> y<span class="token punctuation">:</span> rect<span class="token punctuation">.</span>height <span class="token operator">+</span> from<span class="token punctuation">.</span>y<span class="token punctuation">)</span>
        
        <span class="token comment">// Stroke path</span>
        context<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> with<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token punctuation">.</span>blue<span class="token punctuation">)</span><span class="token punctuation">,</span> lineWidth<span class="token punctuation">:</span> <span class="token number">25</span><span class="token punctuation">)</span>
        context<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> with<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">linearGradient</span><span class="token punctuation">(</span>gradient<span class="token punctuation">,</span> startPoint<span class="token punctuation">:</span> from<span class="token punctuation">,</span> endPoint<span class="token punctuation">:</span> to<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="SF-Symbol"><a href="#SF-Symbol" class="headerlink" title="SF Symbol"></a>SF Symbol</h4><p>SF Symbol 支持变量值，可以通过设置 variableValue 来填充不同部分，比如 wifi 图标，不同值会亮不同部分，<code>Image(systemName: &quot;wifi&quot;, variableValue: 0.5)</code> 。</p>
<h2 id="开发者"><a href="#开发者" class="headerlink" title="开发者"></a>开发者</h2><h3 id="Swift官方"><a href="#Swift官方" class="headerlink" title="Swift官方"></a>Swift官方</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/tkremenek">tkremenek</a>：Swift director</li>
<li><a target="_blank" rel="noopener" href="https://github.com/DougGregor">DougGregor</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/mikeash">mikeash</a>：Friday Q&amp;A</li>
</ul>
<h3 id="社区"><a href="#社区" class="headerlink" title="社区"></a>社区</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/onevcat">onevcat</a>：喵神</li>
<li><a target="_blank" rel="noopener" href="https://github.com/DianQK">DianQK</a>：靛青 - SwiftGG翻译组</li>
<li><a target="_blank" rel="noopener" href="https://github.com/kean">kean</a>：Nuke、Pulse</li>
<li><a target="_blank" rel="noopener" href="https://github.com/stephencelis">stephencelis</a>：Point-Free &amp; SQLite.swift</li>
<li><a target="_blank" rel="noopener" href="https://github.com/ibireme">ibireme</a>：YYDS</li>
<li><a target="_blank" rel="noopener" href="https://github.com/mattt">mattt</a>：NSHipster</li>
<li><a target="_blank" rel="noopener" href="https://github.com/ethanhuang13">ethanhuang13</a>：13 - [weak self]播客</li>
<li><a target="_blank" rel="noopener" href="https://github.com/Kyle-Ye">Kyle-Ye</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/ming1016">ming1016</a>：戴铭</li>
<li><a target="_blank" rel="noopener" href="https://github.com/mxcl">mxcl</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/lkzhao">lkzhao</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/insidegui">insidegui</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/johnno1962">johnno1962</a>：InjectionIII</li>
<li><a target="_blank" rel="noopener" href="https://github.com/wigging">wigging</a>：Back to the Mac</li>
<li><a target="_blank" rel="noopener" href="https://github.com/Dimillian">Dimillian</a>：MovieSwiftUI</li>
<li><a target="_blank" rel="noopener" href="https://github.com/krzysztofzablocki">krzysztofzablocki</a>：元编程 Sourcery</li>
<li><a target="_blank" rel="noopener" href="https://github.com/onmyway133">onmyway133</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/pofat">pofat</a>：Pofat - [weak self]播客</li>
<li><a target="_blank" rel="noopener" href="https://github.com/mecid">mecid</a>：Swift with Majid</li>
<li><a target="_blank" rel="noopener" href="https://github.com/hebertialmeida">hebertialmeida</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/kylef">kylef</a>：Commander</li>
<li><a target="_blank" rel="noopener" href="https://github.com/joshaber">joshaber</a>：at GitHub</li>
<li><a target="_blank" rel="noopener" href="https://github.com/ashfurrow">ashfurrow</a>：Moya</li>
<li><a target="_blank" rel="noopener" href="https://github.com/jessesquires">jessesquires</a></li>
</ul>
<h2 id="探索库"><a href="#探索库" class="headerlink" title="探索库"></a>探索库</h2><h3 id="新鲜事"><a href="#新鲜事" class="headerlink" title="新鲜事"></a>新鲜事</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/SwiftOldDriver/iOS-Weekly">SwiftOldDriver&#x2F;iOS-Weekly</a></em><br>老司机 iOS 周报<br>Star：4222 Issue：19 开发语言：<br>🇨🇳 老司机技术 iOS 周报</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/matteocrippa/awesome-swift">matteocrippa&#x2F;awesome-swift</a></em><br>Star：22100 Issue：1 开发语言：Ruby<br>A collaborative list of awesome Swift libraries and resources. Feel free to contribute!</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/ruanyf/weekly">ruanyf&#x2F;weekly</a></em><br>科技爱好者周刊<br>Star：24124 Issue：1902 开发语言：<br>科技爱好者周刊，每周五发布</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/KwaiAppTeam/SwiftPamphletApp">KwaiAppTeam&#x2F;SwiftPamphletApp</a></em><br>戴铭的开发小册子<br>Star：0 Issue：0 开发语言：</p>
<h3 id="封装易用功能"><a href="#封装易用功能" class="headerlink" title="封装易用功能"></a>封装易用功能</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/SwifterSwift/SwifterSwift">SwifterSwift&#x2F;SwifterSwift</a></em><br>Handy Swift extensions<br>Star：11409 Issue：17 开发语言：Swift<br>A handy collection of more than 500 native Swift extensions to boost your productivity.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/JoanKing/JKSwiftExtension">JoanKing&#x2F;JKSwiftExtension</a></em><br>Swift常用扩展、组件、协议<br>Star：359 Issue：1 开发语言：Swift<br>Swift常用扩展、组件、协议，方便项目快速搭建，提供完整清晰的Demo示例，不断的完善中…… </p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/infinum/iOS-Nuts-And-Bolts">infinum&#x2F;iOS-Nuts-And-Bolts</a></em><br>Star：178 Issue：0 开发语言：Swift<br>iOS bits and pieces that you can include in your project to make your life a bit easier.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/gtokman/ExtensionKit">gtokman&#x2F;ExtensionKit</a></em><br>Star：101 Issue：0 开发语言：Swift<br>Helpful extensions for iOS app development 🚀 </p>
<h3 id="SwiftUI-扩展"><a href="#SwiftUI-扩展" class="headerlink" title="SwiftUI 扩展"></a>SwiftUI 扩展</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/SwiftUIX/SwiftUIX">SwiftUIX&#x2F;SwiftUIX</a></em><br>扩展 SwiftUI<br>Star：4777 Issue：8 开发语言：Swift<br>Extensions and additions to the standard SwiftUI library.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/SDWebImage/SDWebImageSwiftUI">SDWebImage&#x2F;SDWebImageSwiftUI</a></em><br>Star：1403 Issue：45 开发语言：Swift<br>SwiftUI Image loading and Animation framework powered by SDWebImage</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/apptekstudios/ASCollectionView">apptekstudios&#x2F;ASCollectionView</a></em><br>SwiftUI collection<br>Star：1208 Issue：32 开发语言：Swift<br>A SwiftUI collection view with support for custom layouts, preloading, and more.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/siteline/SwiftUI-Introspect">siteline&#x2F;SwiftUI-Introspect</a></em><br>SwiftUI 引入 UIKit<br>Star：3262 Issue：53 开发语言：Swift<br>Introspect underlying UIKit components from SwiftUI</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/AvdLee/SwiftUIKitView">AvdLee&#x2F;SwiftUIKitView</a></em><br>在 SwiftUI 中 使用 UIKit<br>Star：506 Issue：3 开发语言：Swift<br>Easily use UIKit views in your SwiftUI applications. Create Xcode Previews for UIView elements</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/danielsaidi/SwiftUIKit">danielsaidi&#x2F;SwiftUIKit</a></em><br>给 SwiftUI 添加更多功能<br>Star：666 Issue：3 开发语言：Swift<br>SwiftUIKit contains additional functionality for SwiftUI.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Toni77777/awesome-swiftui-libraries">Toni77777&#x2F;awesome-swiftui-libraries</a></em><br>SwiftUI 可使用的库<br>Star：199 Issue：0 开发语言：Swift<br>:rocket: Awesome SwiftUI Libraries </p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/rakutentech/AltSwiftUI">rakutentech&#x2F;AltSwiftUI</a></em><br>类 SwiftUI<br>Star：269 Issue：6 开发语言：Swift<br>Open Source UI framework based on SwiftUI syntax and features, adding backwards compatibility.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/gymshark/ios-stack-kit">gymshark&#x2F;ios-stack-kit</a></em><br>类 SwiftUI<br>Star：118 Issue：2 开发语言：Swift<br>The power of SwiftUI with UIKit</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/jordibruin/Swift-Charts-Examples">jordibruin&#x2F;Swift-Charts-Examples</a></em><br>Swift Charts 制作的不同类型图表示例<br>Star：0 Issue：0 开发语言：</p>
<h3 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/onevcat/Kingfisher">onevcat&#x2F;Kingfisher</a></em><br>Star：20267 Issue：76 开发语言：Swift<br>A lightweight, pure-Swift library for downloading and caching images from the web.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/kean/Nuke">kean&#x2F;Nuke</a></em><br>Star：6721 Issue：6 开发语言：Swift<br>Image loading system</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/suzuki-0000/SKPhotoBrowser">suzuki-0000&#x2F;SKPhotoBrowser</a></em><br>图片浏览<br>Star：2358 Issue：94 开发语言：Swift<br>Simple PhotoBrowser&#x2F;Viewer inspired by facebook, twitter photo browsers written by swift</p>
<h3 id="文字处理"><a href="#文字处理" class="headerlink" title="文字处理"></a>文字处理</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/gonzalezreal/MarkdownUI">gonzalezreal&#x2F;MarkdownUI</a></em><br>Star：730 Issue：14 开发语言：Swift<br>Render Markdown text in SwiftUI</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/tophat/RichTextView">tophat&#x2F;RichTextView</a></em><br>Star：1073 Issue：31 开发语言：Swift<br>iOS Text View (UIView) that Properly Displays LaTeX, HTML, Markdown, and YouTube&#x2F;Vimeo Links</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/keitaoouchi/MarkdownView">keitaoouchi&#x2F;MarkdownView</a></em><br>Star：1778 Issue：32 开发语言：Swift<br>Markdown View for iOS.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/johnxnguyen/Down">johnxnguyen&#x2F;Down</a></em><br>fast Markdown<br>Star：1963 Issue：25 开发语言：C<br>Blazing fast Markdown &#x2F; CommonMark rendering in Swift, built upon cmark.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/qeude/SwiftDown">qeude&#x2F;SwiftDown</a></em><br>Swift 写的可换主题的 Markdown 编辑器组件<br>Star：115 Issue：2 开发语言：Swift<br>📦 A themable markdown editor component for your SwiftUI apps.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/JohnSundell/Ink">JohnSundell&#x2F;Ink</a></em><br>Markdown 解析器<br>Star：2117 Issue：22 开发语言：Swift<br>A fast and flexible Markdown parser written in Swift.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/tnantoka/edhita">tnantoka&#x2F;edhita</a></em><br>Star：1194 Issue：15 开发语言：Swift<br>Fully open source text editor for iOS written in Swift.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/glushchenko/fsnotes">glushchenko&#x2F;fsnotes</a></em><br>Star：5025 Issue：222 开发语言：Swift<br>Notes manager for macOS&#x2F;iOS</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/coteditor/CotEditor">coteditor&#x2F;CotEditor</a></em><br>Star：4602 Issue：96 开发语言：Swift<br>Lightweight Plain-Text Editor for macOS</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/mchakravarty/CodeEditorView">mchakravarty&#x2F;CodeEditorView</a></em><br>SwiftUI 写的代码编辑器<br>Star：400 Issue：30 开发语言：Swift<br>SwiftUI code editor view for iOS and macOS</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/CodeEditApp/CodeEdit">CodeEditApp&#x2F;CodeEdit</a></em><br>原生，性能好的代码编辑器<br>Star：10816 Issue：93 开发语言：Swift<br>CodeEdit App for macOS – Elevate your code editing experience. Open source, free forever.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/ZeeZide/CodeEditor">ZeeZide&#x2F;CodeEditor</a></em><br>使用 Highlight.js 的来做语法高亮的 SwiftUI 编辑器<br>Star：202 Issue：3 开发语言：Swift<br>A SwiftUI TextEditor with syntax highlighting using Highlight.js</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/tw93/MiaoYan">tw93&#x2F;MiaoYan</a></em><br>轻灵的 Markdown 笔记本伴你写出妙言<br>Star：0 Issue：0 开发语言：</p>
<h3 id="动画-2"><a href="#动画-2" class="headerlink" title="动画"></a>动画</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/recherst/kavsoft-swiftui-animations">recherst&#x2F;kavsoft-swiftui-animations</a></em><br>Star：132 Issue：0 开发语言：Swift<br>SwiftUI animation tutorials, all of demos are consisted of youtube videos at website of kavsoft. 🔗 <a target="_blank" rel="noopener" href="https://kavsoft.dev/">https://kavsoft.dev</a></p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/timdonnelly/Advance">timdonnelly&#x2F;Advance</a></em><br>Physics-based animations<br>Star：4463 Issue：4 开发语言：Swift<br>Physics-based animations for iOS, tvOS, and macOS.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/MengTo/Spring">MengTo&#x2F;Spring</a></em><br>动画<br>Star：13987 Issue：167 开发语言：Swift<br>A library to simplify iOS animations in Swift.</p>
<h3 id="持久化存储"><a href="#持久化存储" class="headerlink" title="持久化存储"></a>持久化存储</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/stephencelis/SQLite.swift">stephencelis&#x2F;SQLite.swift</a></em><br>Star：8349 Issue：88 开发语言：Swift<br>A type-safe, Swift-language layer over SQLite3.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/groue/GRDB.swift">groue&#x2F;GRDB.swift</a></em><br>Star：5185 Issue：2 开发语言：Swift<br>A toolkit for SQLite databases, with a focus on application development</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/caiyue1993/IceCream">caiyue1993&#x2F;IceCream</a></em><br>CloudKit 同步 Realm 数据库<br>Star：1732 Issue：46 开发语言：Swift<br>Sync Realm Database with CloudKit</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/realm/realm-cocoa">realm&#x2F;realm-cocoa</a></em><br>Star：15375 Issue：367 开发语言：Objective-C<br>Realm is a mobile database: a replacement for Core Data &amp; SQLite</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/PostgresApp/PostgresApp">PostgresApp&#x2F;PostgresApp</a></em><br>PostgreSQL macOS 应用<br>Star：6332 Issue：125 开发语言：Makefile<br>The easiest way to get started with PostgreSQL on the Mac</p>
<h3 id="编程范式"><a href="#编程范式" class="headerlink" title="编程范式"></a>编程范式</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/ReactiveX/RxSwift">ReactiveX&#x2F;RxSwift</a></em><br>函数响应式编程<br>Star：22278 Issue：10 开发语言：Swift<br>Reactive Programming in Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/pointfreeco/swift-composable-architecture">pointfreeco&#x2F;swift-composable-architecture</a></em><br>Star：6377 Issue：20 开发语言：Swift<br>A library for building applications in a consistent and understandable way, with composition, testing, and ergonomics in mind.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/onmyway133/awesome-ios-architecture">onmyway133&#x2F;awesome-ios-architecture</a></em><br>Star：4628 Issue：0 开发语言：<br>:japanese_castle: Better ways to structure iOS apps</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/ReSwift/ReSwift">ReSwift&#x2F;ReSwift</a></em><br>单页面状态和数据管理<br>Star：7206 Issue：39 开发语言：Swift<br>Unidirectional Data Flow in Swift - Inspired by Redux</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/gre4ixin/ReduxUI">gre4ixin&#x2F;ReduxUI</a></em><br>SwiftUI Redux 架构<br>Star：29 Issue：0 开发语言：Swift<br>💎 Redux like architecture for SwiftUI</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/BohdanOrlov/iOS-Developer-Roadmap">BohdanOrlov&#x2F;iOS-Developer-Roadmap</a></em><br>Star：5834 Issue：7 开发语言：Swift<br>Roadmap to becoming an iOS developer in 2018.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/ReactiveCocoa/ReactiveCocoa">ReactiveCocoa&#x2F;ReactiveCocoa</a></em><br>Star：19983 Issue：4 开发语言：Swift<br>Cocoa framework and Obj-C dynamism bindings for ReactiveSwift.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/mehdihadeli/awesome-software-architecture">mehdihadeli&#x2F;awesome-software-architecture</a></em><br>软件架构<br>Star：291 Issue：2 开发语言：<br>A curated list of awesome articles, videos, and other resources to learn and practice software architecture, patterns, and principles.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/nalexn/clean-architecture-swiftui">nalexn&#x2F;clean-architecture-swiftui</a></em><br>干净完整的SwiftUI+Combine例子，包含网络和单元测试等<br>Star：3517 Issue：17 开发语言：Swift<br>SwiftUI sample app using Clean Architecture. Examples of working with CoreData persistence, networking, dependency injection, unit testing, and more.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/krzysztofzablocki/Sourcery">krzysztofzablocki&#x2F;Sourcery</a></em><br>Swift 元编程<br>Star：6644 Issue：55 开发语言：Swift<br>Meta-programming for Swift, stop writing boilerplate code.</p>
<h3 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/pointfreeco/swiftui-navigation">pointfreeco&#x2F;swiftui-navigation</a></em><br>Star：866 Issue：2 开发语言：Swift<br>Tools for making SwiftUI navigation simpler, more ergonomic and more precise.</p>
<h3 id="静态检查"><a href="#静态检查" class="headerlink" title="静态检查"></a>静态检查</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/realm/SwiftLint">realm&#x2F;SwiftLint</a></em><br>Star：16224 Issue：312 开发语言：Swift<br>A tool to enforce Swift style and conventions.</p>
<h3 id="系统能力"><a href="#系统能力" class="headerlink" title="系统能力"></a>系统能力</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/devicekit/DeviceKit">devicekit&#x2F;DeviceKit</a></em><br>UIDevice 易用封装<br>Star：3700 Issue：46 开发语言：Swift<br>DeviceKit is a value-type replacement of UIDevice.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/kishikawakatsumi/KeychainAccess">kishikawakatsumi&#x2F;KeychainAccess</a></em><br>Star：6935 Issue：39 开发语言：Swift<br>Simple Swift wrapper for Keychain that works on iOS, watchOS, tvOS and macOS.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/nvzqz/FileKit">nvzqz&#x2F;FileKit</a></em><br>文件操作<br>Star：2217 Issue：11 开发语言：Swift<br>Simple and expressive file management in Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/JohnSundell/Files">JohnSundell&#x2F;Files</a></em><br>文件操作<br>Star：2298 Issue：23 开发语言：Swift<br>A nicer way to handle files &amp; folders in Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/kylef/PathKit">kylef&#x2F;PathKit</a></em><br>文件操作<br>Star：1348 Issue：12 开发语言：Swift<br>Effortless path operations in Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/rushisangani/BiometricAuthentication">rushisangani&#x2F;BiometricAuthentication</a></em><br>FaceID or TouchID authentication<br>Star：798 Issue：14 开发语言：Swift<br>Use Apple FaceID or TouchID authentication in your app using BiometricAuthentication.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/sunshinejr/SwiftyUserDefaults">sunshinejr&#x2F;SwiftyUserDefaults</a></em><br>Star：4653 Issue：48 开发语言：Swift<br>Modern Swift API for NSUserDefaults</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/MonitorControl/MonitorControl">MonitorControl&#x2F;MonitorControl</a></em><br>亮度和声音控制<br>Star：16608 Issue：65 开发语言：Swift<br>🖥 Control your display’s brightness &amp; volume on your Mac as if it was a native Apple Display. Use Apple Keyboard keys or custom shortcuts. Shows the native macOS OSDs.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/carekit-apple/CareKit">carekit-apple&#x2F;CareKit</a></em><br>使用 SwiftUI 开发健康相关的库<br>Star：2224 Issue：71 开发语言：Swift<br>CareKit is an open source software framework for creating apps that help people better understand and manage their health.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Cay-Zhang/SwiftSpeech">Cay-Zhang&#x2F;SwiftSpeech</a></em><br>苹果语言识别封装库，已适配 SwiftUI<br>Star：269 Issue：0 开发语言：Swift<br>A speech recognition framework designed for SwiftUI.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/malcommac/SwiftDate">malcommac&#x2F;SwiftDate</a></em><br>Swift编写的时间时区，时间比较等复杂处理的包装<br>Star：6943 Issue：68 开发语言：Swift<br>🐔 Toolkit to parse, validate, manipulate, compare and display dates, time &amp; timezones in Swift.</p>
<h3 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/OAuthSwift/OAuthSwift">OAuthSwift&#x2F;OAuthSwift</a></em><br>Star：3017 Issue：42 开发语言：Swift<br>Swift based OAuth library for iOS</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/p2/OAuth2">p2&#x2F;OAuth2</a></em><br>Star：1067 Issue：74 开发语言：Swift<br>OAuth2 framework for macOS and iOS, written in Swift.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/public-apis/public-apis">public-apis&#x2F;public-apis</a></em><br>Star：197421 Issue：19 开发语言：Python<br>A collective list of free APIs</p>
<h3 id="接口应用"><a href="#接口应用" class="headerlink" title="接口应用"></a>接口应用</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/bpisano/Weather">bpisano&#x2F;Weather</a></em><br>天气应用<br>Star：282 Issue：2 开发语言：Swift<br>A Weather app in SwiftUI.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Dimillian/MovieSwiftUI">Dimillian&#x2F;MovieSwiftUI</a></em><br>电影 MovieDB 应用<br>Star：6063 Issue：8 开发语言：Swift<br>SwiftUI &amp; Combine app using MovieDB API. With a custom Flux (Redux) implementation.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/chojnac/NotionSwift">chojnac&#x2F;NotionSwift</a></em><br>Star：29 Issue：4 开发语言：Swift<br>Unofficial Notion API SDK for iOS &amp; macOS</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Dimillian/RedditOS">Dimillian&#x2F;RedditOS</a></em><br>SwiftUI 写的 Reddit客户端<br>Star：3605 Issue：16 开发语言：Swift<br>The product name is Curiosity, a SwiftUI Reddit client for macOS Big Sur</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/carson-katri/reddit-swiftui">carson-katri&#x2F;reddit-swiftui</a></em><br>SwiftUI 写的 Reddit客户端<br>Star：1127 Issue：7 开发语言：Swift<br>A cross-platform Reddit client built in SwiftUI</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Dimillian/SwiftHN">Dimillian&#x2F;SwiftHN</a></em><br>Hacker News 阅读<br>Star：1685 Issue：20 开发语言：Swift<br>A Hacker News reader in Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/tatsuz0u/EhPanda">tatsuz0u&#x2F;EhPanda</a></em><br>Star：1507 Issue：24 开发语言：Swift<br>An unofficial E-Hentai App for iOS built with SwiftUI &amp; TCA.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Dimillian/MortyUI">Dimillian&#x2F;MortyUI</a></em><br>GraphQL + SwiftUI 开发的瑞克和莫蒂应用<br>Star：431 Issue：4 开发语言：Swift<br>A very simple Rick &amp; Morty app to demo GraphQL + SwiftUI</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Finb/V2ex-Swift">Finb&#x2F;V2ex-Swift</a></em><br>V2EX 客户端<br>Star：1513 Issue：11 开发语言：Swift<br>An iOS client written in Swift for V2EX</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/v2er-app/iOS">v2er-app&#x2F;iOS</a></em><br>V2EX 客户端<br>Star：194 Issue：4 开发语言：Swift<br>The source of V2er.iOS</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/sinaweibosdk/weibo_ios_sdk">sinaweibosdk&#x2F;weibo_ios_sdk</a></em><br>Star：1423 Issue：66 开发语言：Objective-C<br>新浪微博 IOS SDK</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/miniLV/MNWeibo">miniLV&#x2F;MNWeibo</a></em><br>Swift5 + MVVM 微博客户端<br>Star：251 Issue：4 开发语言：Swift<br>Swift5 + MVVM + 文艺复兴微博(纯代码 + 纯Swift)，可作为第一个上手的Swift项目.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/nerdishbynature/octokit.swift">nerdishbynature&#x2F;octokit.swift</a></em><br>Swift API Client for GitHub<br>Star：400 Issue：10 开发语言：Swift<br>A Swift API Client for GitHub and GitHub Enterprise</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/GitHawkApp/GitHawk">GitHawkApp&#x2F;GitHawk</a></em><br>iOS app for GitHub<br>Star：2838 Issue：460 开发语言：Swift<br>The (second) best iOS app for GitHub.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/fangzesheng/free-api">fangzesheng&#x2F;free-api</a></em><br>Star：12335 Issue：28 开发语言：<br>收集免费的接口服务,做一个api的搬运工</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/nerdsupremacist/Graphaello">nerdsupremacist&#x2F;Graphaello</a></em><br>SwiftUI 中使用 GraphQL 的工具<br>Star：454 Issue：22 开发语言：Swift<br>A Tool for Writing Declarative, Type-Safe and Data-Driven Applications in SwiftUI using GraphQL</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/nerdsupremacist/tmdb">nerdsupremacist&#x2F;tmdb</a></em><br>GraphQL 包装电影数据接口<br>Star：16 Issue：1 开发语言：Swift<br>A GraphQL Wrapper for The Movie Database</p>
<h3 id="macOS-1"><a href="#macOS-1" class="headerlink" title="macOS"></a>macOS</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/serhii-londar/open-source-mac-os-apps">serhii-londar&#x2F;open-source-mac-os-apps</a></em><br>开源 macOS 程序合集<br>Star：30760 Issue：65 开发语言：Swift<br>🚀 Awesome list of open source applications for macOS. <a target="_blank" rel="noopener" href="https://t.me/s/opensourcemacosapps">https://t.me/s/opensourcemacosapps</a></p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Ranchero-Software/NetNewsWire">Ranchero-Software&#x2F;NetNewsWire</a></em><br>Star：5773 Issue：551 开发语言：Swift<br>RSS reader for macOS and iOS.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/overtake/TelegramSwift">overtake&#x2F;TelegramSwift</a></em><br>Star：3876 Issue：485 开发语言：Swift<br>Source code of Telegram for macos on Swift 5.0</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/eonist/FileWatcher">eonist&#x2F;FileWatcher</a></em><br>macOS 上监听文件变化<br>Star：159 Issue：5 开发语言：Swift<br>Monitoring file system changes in macOS</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/waylybaye/XcodeCleaner-SwiftUI">waylybaye&#x2F;XcodeCleaner-SwiftUI</a></em><br>清理 Xcode<br>Star：1204 Issue：3 开发语言：Swift<br>Make Xcode Clean Again</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/gao-sun/eul">gao-sun&#x2F;eul</a></em><br>SwiftUI 写的 macOS 状态监控工具<br>Star：7658 Issue：55 开发语言：Swift<br>🖥️ macOS status monitoring app written in SwiftUI.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Dimillian/ACHNBrowserUI">Dimillian&#x2F;ACHNBrowserUI</a></em><br>SwiftUI 写的动物之森小助手程序<br>Star：1528 Issue：32 开发语言：Swift<br>Animal Crossing New Horizon companion app in SwiftUI</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/lexrus/RegExPlus">lexrus&#x2F;RegExPlus</a></em><br>正则表达式<br>Star：186 Issue：0 开发语言：Swift<br>A nifty RegEx test tool built with SwiftUI</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/v2ex/launcher">v2ex&#x2F;launcher</a></em><br>用来启动那些本地开发时需要的各种进程，及查看其输出<br>Star：212 Issue：5 开发语言：Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/lukakerr/Pine">lukakerr&#x2F;Pine</a></em><br>Markdown 编辑器<br>Star：2988 Issue：45 开发语言：Swift<br>A modern, native macOS markdown editor</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/root3nl/SupportApp">root3nl&#x2F;SupportApp</a></em><br>企业支持 macOS 软件<br>Star：283 Issue：20 开发语言：Swift<br>The Support App is developed by Root3, specialized in managing Apple devices. Root3 offers consultancy and support for organizations to get the most out of their Apple devices and is based in The Netherlands (Haarlem).</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/jaywcjlove/awesome-mac">jaywcjlove&#x2F;awesome-mac</a></em><br>macOS 软件大全<br>Star：49993 Issue：126 开发语言：JavaScript<br> Now we have become very big, Different from the original idea. Collect premium software in various categories.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/insidegui/WWDC">insidegui&#x2F;WWDC</a></em><br>Star：8216 Issue：33 开发语言：Swift<br>The unofficial WWDC app for macOS</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/sindresorhus/Actions">sindresorhus&#x2F;Actions</a></em><br>Star：904 Issue：11 开发语言：Swift<br>⚙️ Supercharge your shortcuts</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/ObuchiYuki/DevToysMac">ObuchiYuki&#x2F;DevToysMac</a></em><br>开发者工具合集<br>Star：5552 Issue：40 开发语言：Swift<br>DevToys For mac</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/jacklandrin/OnlySwitch">jacklandrin&#x2F;OnlySwitch</a></em><br>macOS 状态栏一键设置工具，隐藏桌面图标、清理 Xcode 缓存、一键隐藏刘海儿、进入夜览模式等数十种功能<br>Star：1389 Issue：10 开发语言：Swift<br>⚙️ All-in-One menu bar app, hide 💻MacBook Pro’s notch, dark mode, AirPods, Shortcuts</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/exelban/stats">exelban&#x2F;stats</a></em><br>macOS 系统资源监控<br>Star：11296 Issue：14 开发语言：Swift<br>macOS system monitor in your menu bar</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/brunophilipe/Cakebrew">brunophilipe&#x2F;Cakebrew</a></em><br>可视化管理 Homebrew 软件包<br>Star：4234 Issue：57 开发语言：Objective-C<br>Manage your Homebrew formulas with style using Cakebrew.</p>
<h3 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/vinhnx/Clendar">vinhnx&#x2F;Clendar</a></em><br>SwiftUI 写的日历应用<br>Star：361 Issue：58 开发语言：Swift<br>Clendar - universal Apple-platform calendar app. Written in SwiftUI. Available on App Store. MIT License.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/SvenTiigi/WhatsNewKit">SvenTiigi&#x2F;WhatsNewKit</a></em><br>欢迎屏<br>Star：2560 Issue：1 开发语言：Swift<br>Showcase your awesome new app features 📱</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/kickstarter/ios-oss">kickstarter&#x2F;ios-oss</a></em><br>Kickstarter 的 iOS 版本<br>Star：7968 Issue：1 开发语言：Swift<br>Kickstarter for iOS. Bring new ideas to life, anywhere.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/CoreOffice/CryptoOffice">CoreOffice&#x2F;CryptoOffice</a></em><br>Swift 解析 Office Open XML（OOXML）包括 xlsx, docx, pptx<br>Star：27 Issue：0 开发语言：Swift<br>Office Open XML (OOXML) formats (.xlsx, .docx, .pptx) decryption for Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/CoreOffice/CoreXLSX">CoreOffice&#x2F;CoreXLSX</a></em><br>Swift编写的Excel电子表格（XLSX）格式解析器<br>Star：643 Issue：13 开发语言：Swift<br>Excel spreadsheet (XLSX) format parser written in pure Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/analogcode/Swift-Radio-Pro">analogcode&#x2F;Swift-Radio-Pro</a></em><br>电台应用<br>Star：2679 Issue：13 开发语言：Swift<br>Professional Radio Station App for iOS!</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/bizz84/SwiftyStoreKit">bizz84&#x2F;SwiftyStoreKit</a></em><br>应用内购框架<br>Star：6000 Issue：163 开发语言：Swift<br>Lightweight In App Purchases Swift framework for iOS 8.0+, tvOS 9.0+ and macOS 10.10+ ⛺</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/wikimedia/wikipedia-ios">wikimedia&#x2F;wikipedia-ios</a></em><br>Star：2462 Issue：6 开发语言：Swift<br> 📱The official Wikipedia iOS app.</p>
<h3 id="游戏"><a href="#游戏" class="headerlink" title="游戏"></a>游戏</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/pointfreeco/isowords">pointfreeco&#x2F;isowords</a></em><br>单词搜索游戏<br>Star：1792 Issue：2 开发语言：Swift<br>Open source game built in SwiftUI and the Composable Architecture.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/michelpereira/awesome-games-of-coding">michelpereira&#x2F;awesome-games-of-coding</a></em><br>教你学编程的游戏收集<br>Star：1459 Issue：1 开发语言：<br>A curated list of games that can teach you how to learn a programming language.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/OpenEmu/OpenEmu">OpenEmu&#x2F;OpenEmu</a></em><br>视频游戏模拟器<br>Star：13964 Issue：201 开发语言：Swift<br>🕹 Retro video game emulation for macOS</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/jVirus/swiftui-2048">jVirus&#x2F;swiftui-2048</a></em><br>Star：162 Issue：0 开发语言：Swift<br>🎲 100% SwiftUI 3.0, classic 2048 game [iOS 15.0+, iPadOS 15.0+, macOS 12.0+, Swift 5.5].</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/schellingb/dosbox-pure">schellingb&#x2F;dosbox-pure</a></em><br>DOS 游戏模拟器<br>Star：452 Issue：112 开发语言：C++<br>DOSBox Pure is a new fork of DOSBox built for RetroArch&#x2F;Libretro aiming for simplicity and ease of use.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/chrismaltby/gb-studio">chrismaltby&#x2F;gb-studio</a></em><br>拖放式复古游戏创建器<br>Star：6089 Issue：513 开发语言：C<br>A quick and easy to use drag and drop retro game creator for your favourite handheld video game system</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/darrellroot/Netrek-SwiftUI">darrellroot&#x2F;Netrek-SwiftUI</a></em><br>SwiftUI 开发的1989年的 Netrek 游戏<br>Star：10 Issue：0 开发语言：Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/freeCodeCamp/LearnToCodeRPG">freeCodeCamp&#x2F;LearnToCodeRPG</a></em><br>学习编码的游戏<br>Star：828 Issue：10 开发语言：Ren’Py<br>A visual novel video game where you learn to code and get a dev job 🎯</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/pmgl/microstudio">pmgl&#x2F;microstudio</a></em><br>游戏开发平台集搜索、开发、学习、体验、交流等功能于一身<br>Star：634 Issue：37 开发语言：JavaScript<br>Free, open source game engine online</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/InvadingOctopus/octopuskit">InvadingOctopus&#x2F;octopuskit</a></em><br>2D游戏引擎，用的 GameplayKit + SpriteKit + SwiftUI<br>Star：310 Issue：0 开发语言：Swift<br>2D ECS game engine in 100% Swift + SwiftUI for iOS, macOS, tvOS</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/a-little-org-called-mario/a-little-game-called-mario">a-little-org-called-mario&#x2F;a-little-game-called-mario</a></em><br>用 Godot 引擎做的马里奥游戏<br>Star：1046 Issue：5 开发语言：GDScript<br>open source collective hell game</p>
<h3 id="新技术展示"><a href="#新技术展示" class="headerlink" title="新技术展示"></a>新技术展示</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/JakeLin/Moments-SwiftUI">JakeLin&#x2F;Moments-SwiftUI</a></em><br>SwiftUI、Async、Actor<br>Star：42 Issue：0 开发语言：Swift<br>WeChat-like Moments App implemented using Swift 5.5 and SwiftUI</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/twostraws/HackingWithSwift">twostraws&#x2F;HackingWithSwift</a></em><br>示例代码<br>Star：4529 Issue：10 开发语言：Swift<br>The project source code for hackingwithswift.com</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/carson-katri/awesome-result-builders">carson-katri&#x2F;awesome-result-builders</a></em><br>Result Builders awesome<br>Star：798 Issue：2 开发语言：<br>A list of cool DSLs made with Swift 5.4’s @resultBuilder</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/pointfreeco/episode-code-samples">pointfreeco&#x2F;episode-code-samples</a></em><br>Star：684 Issue：3 开发语言：Swift<br>💾 Point-Free episode code.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/SwiftGGTeam/the-swift-programming-language-in-chinese">SwiftGGTeam&#x2F;the-swift-programming-language-in-chinese</a></em><br>中文版 Apple 官方 Swift 教程<br>Star：20535 Issue：5 开发语言：CSS<br>中文版 Apple 官方 Swift 教程《The Swift Programming Language》</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/jessesquires/TIL">jessesquires&#x2F;TIL</a></em><br>学习笔记<br>Star：258 Issue：1 开发语言：<br>Things I’ve learned and&#x2F;or things I want to remember. Notes, links, advice, example code, etc.</p>
<h3 id="Combine-扩展"><a href="#Combine-扩展" class="headerlink" title="Combine 扩展"></a>Combine 扩展</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/OpenCombine/OpenCombine">OpenCombine&#x2F;OpenCombine</a></em><br>Combine 的开源实现<br>Star：2228 Issue：13 开发语言：Swift<br>Open source implementation of Apple’s Combine framework for processing values over time.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/CombineCommunity/CombineExt">CombineCommunity&#x2F;CombineExt</a></em><br>对 Combine 的补充<br>Star：1198 Issue：23 开发语言：Swift<br>CombineExt provides a collection of operators, publishers and utilities for Combine, that are not provided by Apple themselves, but are common in other Reactive Frameworks and standards.</p>
<h3 id="聚合"><a href="#聚合" class="headerlink" title="聚合"></a>聚合</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/dkhamsing/open-source-ios-apps">dkhamsing&#x2F;open-source-ios-apps</a></em><br>开源的完整 App 例子<br>Star：30612 Issue：0 开发语言：<br>:iphone: Collaborative List of Open-Source iOS Apps</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/vlondon/awesome-swiftui">vlondon&#x2F;awesome-swiftui</a></em><br>Star：1246 Issue：5 开发语言：<br>A collaborative list of awesome articles, talks, books, videos and code examples about SwiftUI.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/ivanvorobei/SwiftUI">ivanvorobei&#x2F;SwiftUI</a></em><br>Star：3896 Issue：3 开发语言：Swift<br>Examples projects using SwiftUI released by WWDC2019. Include Layout, UI, Animations, Gestures, Draw and Data.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/kon9chunkit/GitHub-Chinese-Top-Charts">kon9chunkit&#x2F;GitHub-Chinese-Top-Charts</a></em><br>GitHub中文排行榜<br>Star：46675 Issue：88 开发语言：Java<br>:cn: GitHub中文排行榜，各语言分设「软件 | 资料」榜单，精准定位中文好项目。各取所需，高效学习。</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/onmyway133/awesome-swiftui">onmyway133&#x2F;awesome-swiftui</a></em><br>Star：402 Issue：4 开发语言：<br>🌮 Awesome resources, articles, libraries about SwiftUI</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Juanpe/About-SwiftUI">Juanpe&#x2F;About-SwiftUI</a></em><br>汇总 SwiftUI 的资料<br>Star：6225 Issue：0 开发语言：Swift<br>Gathering all info published, both by Apple and by others, about new framework SwiftUI. </p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/sindresorhus/awesome">sindresorhus&#x2F;awesome</a></em><br>内容广<br>Star：206308 Issue：37 开发语言：<br>😎 Awesome lists about all kinds of interesting topics</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/SwiftPackageIndex/PackageList">SwiftPackageIndex&#x2F;PackageList</a></em><br>Swift 开源库索引<br>Star：627 Issue：0 开发语言：Swift<br>The master list of repositories for the Swift Package Index.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/matteocrippa/awesome-swift">matteocrippa&#x2F;awesome-swift</a></em><br>Star：22100 Issue：1 开发语言：Ruby<br>A collaborative list of awesome Swift libraries and resources. Feel free to contribute!</p>
<h3 id="性能、工程构建及自动化"><a href="#性能、工程构建及自动化" class="headerlink" title="性能、工程构建及自动化"></a>性能、工程构建及自动化</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/tuist/tuist">tuist&#x2F;tuist</a></em><br>创建和维护 Xcode projects 文件<br>Star：2782 Issue：131 开发语言：Swift<br>🚀 Create, maintain, and interact with Xcode projects at scale</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/swift-server/vscode-swift">swift-server&#x2F;vscode-swift</a></em><br>VSCode 的 Swift 扩展<br>Star：316 Issue：33 开发语言：TypeScript<br>Visual Studio Code Extension for Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/peripheryapp/periphery">peripheryapp&#x2F;periphery</a></em><br>检测 Swift 无用代码<br>Star：3438 Issue：31 开发语言：Swift<br>A tool to identify unused code in Swift projects.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/nalexn/ViewInspector">nalexn&#x2F;ViewInspector</a></em><br>SwiftUI Runtime introspection 和 单元测试<br>Star：1251 Issue：24 开发语言：Swift<br>Runtime introspection and unit testing of SwiftUI views</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/shibapm/Komondor">shibapm&#x2F;Komondor</a></em><br>Git Hooks for Swift projects<br>Star：513 Issue：20 开发语言：Swift<br>Git Hooks for Swift projects 🐩</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/SwiftGen/SwiftGen">SwiftGen&#x2F;SwiftGen</a></em><br>代码生成<br>Star：7987 Issue：91 开发语言：Swift<br>The Swift code generator for your assets, storyboards, Localizable.strings, … — Get rid of all String-based APIs!</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/hyperoslo/Cache">hyperoslo&#x2F;Cache</a></em><br>Star：2602 Issue：23 开发语言：Swift<br>:package: Nothing but Cache.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/kylef/Commander">kylef&#x2F;Commander</a></em><br>命令行<br>Star：1492 Issue：3 开发语言：Swift<br>Compose beautiful command line interfaces in Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Carthage/Carthage">Carthage&#x2F;Carthage</a></em><br>Star：14605 Issue：169 开发语言：Swift<br>A simple, decentralized dependency manager for Cocoa</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/NARKOZ/hacker-scripts">NARKOZ&#x2F;hacker-scripts</a></em><br>程序员的活都让机器干的脚本（真实故事）<br>Star：44591 Issue：67 开发语言：JavaScript<br>Based on a true story</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/RobotsAndPencils/XcodesApp">RobotsAndPencils&#x2F;XcodesApp</a></em><br>Xcode 多版本安装<br>Star：3276 Issue：51 开发语言：Swift<br>The easiest way to install and switch between multiple versions of Xcode - with a mouse click. </p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/ZeeZide/5GUIs">ZeeZide&#x2F;5GUIs</a></em><br>可以分析程序用了哪些库，用了LLVM objdump<br>Star：189 Issue：11 开发语言：Swift<br>A tiny macOS app that can detect the GUI technologies used in other apps.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/faisalmemon/ios-crash-dump-analysis-book">faisalmemon&#x2F;ios-crash-dump-analysis-book</a></em><br>iOS Crash Dump Analysis Book<br>Star：474 Issue：1 开发语言：Objective-C<br>iOS Crash Dump Analysis Book</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/majd/ipatool">majd&#x2F;ipatool</a></em><br>下载 ipa<br>Star：2303 Issue：12 开发语言：Swift<br>Command-line tool that allows searching and downloading app packages (known as ipa files) from the iOS App Store</p>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/Quick/Quick">Quick&#x2F;Quick</a></em><br>测试框架<br>Star：9456 Issue：31 开发语言：Swift<br>The Swift (and Objective-C) testing framework.</p>
<h3 id="网络-2"><a href="#网络-2" class="headerlink" title="网络"></a>网络</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/Alamofire/Alamofire">Alamofire&#x2F;Alamofire</a></em><br>Star：37835 Issue：29 开发语言：Swift<br>Elegant HTTP Networking in Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/socketio/socket.io-client-swift">socketio&#x2F;socket.io-client-swift</a></em><br>Star：4814 Issue：189 开发语言：Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Lojii/Knot">Lojii&#x2F;Knot</a></em><br>使用 SwiftNIO 实现 HTTPS 抓包<br>Star：1239 Issue：3 开发语言：C<br>一款iOS端基于MITM(中间人攻击技术)实现的HTTPS抓包工具，完整的App，核心代码使用SwiftNIO实现</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/swift-server/async-http-client">swift-server&#x2F;async-http-client</a></em><br>使用 SwiftNIO 开发的 HTTP 客户端<br>Star：609 Issue：83 开发语言：Swift<br>HTTP client library built on SwiftNIO</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/kean/Get">kean&#x2F;Get</a></em><br>Star：406 Issue：0 开发语言：Swift<br>Web API client built using async&#x2F;await</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/awesome-selfhosted/awesome-selfhosted">awesome-selfhosted&#x2F;awesome-selfhosted</a></em><br>网络服务及上面的应用<br>Star：92737 Issue：151 开发语言：JavaScript<br>A list of Free Software network services and web applications which can be hosted on your own servers</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/daltoniam/Starscream">daltoniam&#x2F;Starscream</a></em><br>WebSocket<br>Star：7348 Issue：149 开发语言：Swift<br>Websockets in swift for iOS and OSX</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/shadowsocks/ShadowsocksX-NG">shadowsocks&#x2F;ShadowsocksX-NG</a></em><br>Star：30440 Issue：257 开发语言：Swift<br>Next Generation of ShadowsocksX</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/carson-katri/swift-request">carson-katri&#x2F;swift-request</a></em><br>声明式的网络请求<br>Star：648 Issue：7 开发语言：Swift<br>Declarative HTTP networking, designed for SwiftUI</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/alibaba/xquic">alibaba&#x2F;xquic</a></em><br>阿里巴巴发布的 XQUIC 库<br>Star：1132 Issue：21 开发语言：C<br>XQUIC Library released by Alibaba is a cross-platform implementation of QUIC and HTTP&#x2F;3 protocol.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/kasketis/netfox">kasketis&#x2F;netfox</a></em><br>获取所有网络请求<br>Star：3269 Issue：18 开发语言：Swift<br>A lightweight, one line setup, iOS &#x2F; OSX network debugging library! 🦊</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Moya/Moya">Moya&#x2F;Moya</a></em><br>Swift 编写的网络抽象层<br>Star：14012 Issue：125 开发语言：Swift<br>Network abstraction layer written in Swift.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Kitura/BlueSocket">Kitura&#x2F;BlueSocket</a></em><br>Star：1301 Issue：31 开发语言：Swift<br>Socket framework for Swift using the Swift Package Manager. Works on iOS, macOS, and Linux.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/rhummelmose/BluetoothKit">rhummelmose&#x2F;BluetoothKit</a></em><br>蓝牙<br>Star：2086 Issue：35 开发语言：Swift<br>Easily communicate between iOS&#x2F;OSX devices using BLE</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/WeTransfer/Mocker">WeTransfer&#x2F;Mocker</a></em><br>Mock Alamofire and URLSession<br>Star：817 Issue：3 开发语言：Swift<br>Mock Alamofire and URLSession requests without touching your code implementation</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/bagder/everything-curl">bagder&#x2F;everything-curl</a></em><br>记录了 curl 的一切<br>Star：1488 Issue：0 开发语言：Perl<br>The book documenting the curl project, the curl tool, libcurl and more. Simply put: everything curl.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/LANDrop/LANDrop">LANDrop&#x2F;LANDrop</a></em><br>全平台局域网文件传输<br>Star：2787 Issue：90 开发语言：C++<br>Drop any files to any devices on your LAN.</p>
<h3 id="图形"><a href="#图形" class="headerlink" title="图形"></a>图形</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/willdale/SwiftUICharts">willdale&#x2F;SwiftUICharts</a></em><br>用于SwiftUI的图表绘图库<br>Star：560 Issue：30 开发语言：Swift<br>A charts &#x2F; plotting library for SwiftUI. Works on macOS, iOS, watchOS, and tvOS and has accessibility features built in.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/lludo/SwiftSunburstDiagram">lludo&#x2F;SwiftSunburstDiagram</a></em><br>SwiftUI 图表<br>Star：479 Issue：12 开发语言：Swift<br>SwiftUI library to easily render diagrams given a tree of objects. Similar to ring chart, sunburst chart, multilevel pie chart.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/ivanschuetz/SwiftCharts">ivanschuetz&#x2F;SwiftCharts</a></em><br>Star：2399 Issue：49 开发语言：Swift<br>Easy to use and highly customizable charts library for iOS</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/danielgindi/Charts">danielgindi&#x2F;Charts</a></em><br>Star：25565 Issue：832 开发语言：Swift<br>Beautiful charts for iOS&#x2F;tvOS&#x2F;OSX! The Apple side of the crossplatform MPAndroidChart.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/imxieyi/waifu2x-ios">imxieyi&#x2F;waifu2x-ios</a></em><br>waifu2x Core ML 动漫风格图片的高清渲染<br>Star：430 Issue：3 开发语言：Swift<br>iOS Core ML implementation of waifu2x</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/mecid/SwiftUICharts">mecid&#x2F;SwiftUICharts</a></em><br>支持 SwiftUI 的简单的线图和柱状图库<br>Star：1306 Issue：2 开发语言：Swift<br>A simple line and bar charting library that supports accessibility written using SwiftUI. </p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Tencent/libpag">Tencent&#x2F;libpag</a></em><br>PAG（Portable Animated Graphics）实时渲染库，多个平台渲染AE动画。<br>Star：1809 Issue：2 开发语言：C++<br>The official rendering library for PAG (Portable Animated Graphics) files that renders After Effects animations natively across multiple platforms.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/jathu/UIImageColors">jathu&#x2F;UIImageColors</a></em><br>获取图片主次颜色<br>Star：3100 Issue：10 开发语言：Swift<br>Fetches the most dominant and prominent colors from an image.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/BradLarson/GPUImage3">BradLarson&#x2F;GPUImage3</a></em><br>Metal 实现<br>Star：2362 Issue：74 开发语言：Swift<br>GPUImage 3 is a BSD-licensed Swift framework for GPU-accelerated video and image processing using Metal.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/exyte/Macaw">exyte&#x2F;Macaw</a></em><br>SVG<br>Star：5845 Issue：129 开发语言：Swift<br>Powerful and easy-to-use vector graphics Swift library with SVG support</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/exyte/SVGView">exyte&#x2F;SVGView</a></em><br>支持 SwiftUI 的 SVG 解析渲染视图<br>Star：173 Issue：3 开发语言：Swift<br>SVG parser and renderer written in SwiftUI</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/efremidze/Magnetic">efremidze&#x2F;Magnetic</a></em><br>SpriteKit气泡支持SwiftUI<br>Star：1398 Issue：23 开发语言：Swift<br>SpriteKit Floating Bubble Picker (inspired by Apple Music) 🧲</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/NextLevel/NextLevel">NextLevel&#x2F;NextLevel</a></em><br>相机<br>Star：1994 Issue：69 开发语言：Swift<br>⬆️ Rad Media Capture in Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Harley-xk/MaLiang">Harley-xk&#x2F;MaLiang</a></em><br>基于 Metal 的涂鸦绘图库<br>Star：1271 Issue：43 开发语言：Swift<br>iOS painting and drawing library based on Metal. 神笔马良有一支神笔（基于 Metal 的涂鸦绘图库）</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/frzi/Model3DView">frzi&#x2F;Model3DView</a></em><br>毫不费力的使用 SwiftUI 渲染 3d models<br>Star：49 Issue：0 开发语言：Swift<br>Render 3d models with SwiftUI effortlessly</p>
<h3 id="音视频"><a href="#音视频" class="headerlink" title="音视频"></a>音视频</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/iina/iina">iina&#x2F;iina</a></em><br>Star：30443 Issue：1348 开发语言：Swift<br>The modern video player for macOS.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/shogo4405/HaishinKit.swift">shogo4405&#x2F;HaishinKit.swift</a></em><br>RTMP, HLS<br>Star：2319 Issue：12 开发语言：Swift<br>Camera and Microphone streaming library via RTMP, HLS for iOS, macOS and tvOS.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/AudioKit/AudioKit">AudioKit&#x2F;AudioKit</a></em><br>Star：9194 Issue：2 开发语言：Swift<br>Swift audio synthesis, processing, &amp; analysis platform for iOS, macOS and tvOS</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/josejuanqm/VersaPlayer">josejuanqm&#x2F;VersaPlayer</a></em><br>Star：698 Issue：3 开发语言：Swift<br>Versatile Video Player implementation for iOS, macOS, and tvOS</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/bilibili/ijkplayer">bilibili&#x2F;ijkplayer</a></em><br>bilibili 播放器<br>Star：30489 Issue：2748 开发语言：C<br>Android&#x2F;iOS video player based on FFmpeg n3.4, with MediaCodec, VideoToolbox support.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/mpv-player/mpv">mpv-player&#x2F;mpv</a></em><br>命令行视频播放器<br>Star：19139 Issue：867 开发语言：C<br>🎥 Command line video player</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/analogcode/Swift-Radio-Pro">analogcode&#x2F;Swift-Radio-Pro</a></em><br>广播电台<br>Star：2679 Issue：13 开发语言：Swift<br>Professional Radio Station App for iOS!</p>
<h3 id="安全-2"><a href="#安全-2" class="headerlink" title="安全"></a>安全</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/krzyzanowskim/CryptoSwift">krzyzanowskim&#x2F;CryptoSwift</a></em><br>Star：9121 Issue：40 开发语言：Swift<br>CryptoSwift is a growing collection of standard and secure cryptographic algorithms implemented in Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/rockbruno/SwiftInfo">rockbruno&#x2F;SwiftInfo</a></em><br>提取和分析一个iOS应用<br>Star：1094 Issue：20 开发语言：Swift<br>📊 Extract and analyze the evolution of an iOS app’s code.</p>
<h3 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/Kitura/swift-html-entities">Kitura&#x2F;swift-html-entities</a></em><br>HTML5 规范字符编码&#x2F;解码器<br>Star：145 Issue：5 开发语言：Swift<br>HTML5 spec-compliant character encoder&#x2F;decoder for Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/TokamakUI/Tokamak">TokamakUI&#x2F;Tokamak</a></em><br>SwiftUI 兼容，WebAssembly 构建 HTML<br>Star：1732 Issue：99 开发语言：Swift<br>SwiftUI-compatible framework for building browser apps with WebAssembly and native apps for other platforms</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/johnsundell/publish">johnsundell&#x2F;publish</a></em><br>用 swift 来写网站<br>Star：4050 Issue：29 开发语言：Swift<br>A static site generator for Swift developers</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/highlightjs/highlight.js">highlightjs&#x2F;highlight.js</a></em><br>语法高亮<br>Star：20128 Issue：64 开发语言：JavaScript<br>JavaScript syntax highlighter with language auto-detection and zero dependencies.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/sivan/heti">sivan&#x2F;heti</a></em><br>赫蹏（hètí）中文排版<br>Star：4864 Issue：17 开发语言：SCSS<br>赫蹏（hètí）是专为中文内容展示设计的排版样式增强。它基于通行的中文排版规范而来，可以为网站的读者带来更好的文章阅读体验。</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/kevquirk/simple.css">kevquirk&#x2F;simple.css</a></em><br>简单大方基础 CSS 样式<br>Star：2619 Issue：5 开发语言：CSS<br>Simple.css is a classless CSS template that allows you to make a good looking website really quickly.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/mozilla-mobile/firefox-ios">mozilla-mobile&#x2F;firefox-ios</a></em><br>Star：10907 Issue：1062 开发语言：Swift<br>Firefox for iOS</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/liviuschera/noctis">liviuschera&#x2F;noctis</a></em><br>好看的代码编辑器配色主题<br>Star：388 Issue：19 开发语言：JavaScript<br>Noctis is a collection of light &amp; dark themes with a well balanced blend of warm and cold colors</p>
<h3 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/vapor/vapor">vapor&#x2F;vapor</a></em><br>Star：21853 Issue：86 开发语言：Swift<br>💧 A server-side Swift HTTP web framework.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Lakr233/Rayon">Lakr233&#x2F;Rayon</a></em><br>SSH 机器管理，Swift 编写<br>Star：2190 Issue：21 开发语言：Swift<br>yet another SSH machine manager</p>
<h3 id="系统"><a href="#系统" class="headerlink" title="系统"></a>系统</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/spevans/swift-project1">spevans&#x2F;swift-project1</a></em><br>Swift编写内核，可在 Mac 和 PC 启动<br>Star：243 Issue：1 开发语言：Swift<br>A minimal bare metal kernel in Swift</p>
<h3 id="Web-3-0"><a href="#Web-3-0" class="headerlink" title="Web 3.0"></a>Web 3.0</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/chaozh/awesome-blockchain-cn">chaozh&#x2F;awesome-blockchain-cn</a></em><br>区块链 awesome<br>Star：16629 Issue：15 开发语言：JavaScript<br>收集所有区块链(BlockChain)技术开发相关资料，包括Fabric和Ethereum开发资料</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/argentlabs/web3.swift">argentlabs&#x2F;web3.swift</a></em><br>以太坊 Swift API，支持智能合约、ENS 和 ERC20<br>Star：439 Issue：14 开发语言：Swift<br>Ethereum Swift API with support for smart contracts, ENS &amp; ERC20</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/chainfeeds/RSSAggregatorforWeb3">chainfeeds&#x2F;RSSAggregatorforWeb3</a></em><br>web3 的 rss feed 订阅源<br>Star：1502 Issue：4 开发语言：Python<br>Bootstrapping your personal Web3 info hub from more than 500 RSS Feeds.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/Planetable/Planet">Planetable&#x2F;Planet</a></em><br>由 IPFS 和以太坊名称系统提供支持的去中心化博客和网站<br>Star：531 Issue：13 开发语言：Swift<br>Decentralized blogs and websites powered by IPFS and Ethereum Name System</p>
<h3 id="Apple"><a href="#Apple" class="headerlink" title="Apple"></a>Apple</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/apple/swift">apple&#x2F;swift</a></em><br>Star：59937 Issue：6020 开发语言：C++<br>The Swift Programming Language</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution">apple&#x2F;swift-evolution</a></em><br>提案<br>Star：13440 Issue：42 开发语言：Markdown<br>This maintains proposals for changes and user-visible enhancements to the Swift Programming Language.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/apple/swift-corelibs-foundation">apple&#x2F;swift-corelibs-foundation</a></em><br>Star：4624 Issue：607 开发语言：Swift<br>The Foundation Project, providing core utilities, internationalization, and OS independence</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/apple/swift-package-manager">apple&#x2F;swift-package-manager</a></em><br>Star：8819 Issue：513 开发语言：Swift<br>The Package Manager for the Swift Programming Language</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/apple/swift-markdown">apple&#x2F;swift-markdown</a></em><br>Star：1840 Issue：17 开发语言：Swift<br>A Swift package for parsing, building, editing, and analyzing Markdown documents.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/apple/sourcekit-lsp">apple&#x2F;sourcekit-lsp</a></em><br>Star：2599 Issue：32 开发语言：Swift<br>Language Server Protocol implementation for Swift and C-based languages</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/apple/swift-nio">apple&#x2F;swift-nio</a></em><br>Star：7023 Issue：170 开发语言：Swift<br>Event-driven network application framework for high performance protocol servers &amp; clients, non-blocking.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/apple/swift-syntax">apple&#x2F;swift-syntax</a></em><br>解析、生成、转换 Swift 代码<br>Star：1842 Issue：24 开发语言：Swift<br>SwiftPM package for SwiftSyntax library.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/apple/swift-crypto">apple&#x2F;swift-crypto</a></em><br>CryptoKit 的开源实现<br>Star：1208 Issue：10 开发语言：C<br>Open-source implementation of a substantial portion of the API of Apple CryptoKit suitable for use on Linux platforms.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/apple/swift-driver">apple&#x2F;swift-driver</a></em><br>用 Swift 语言重新实现的编译器的驱动程序库<br>Star：629 Issue：25 开发语言：Swift<br>Swift compiler driver reimplementation in Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/apple/swift-numerics">apple&#x2F;swift-numerics</a></em><br>用简单的方式用浮点型进行数值计算<br>Star：1405 Issue：45 开发语言：Swift<br>Advanced mathematical types and functions for Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/apple/swift-atomics">apple&#x2F;swift-atomics</a></em><br>Swift 的低级原子操作<br>Star：763 Issue：11 开发语言：Swift<br>Low-level atomic operations for Swift</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/apple/swift-async-algorithms">apple&#x2F;swift-async-algorithms</a></em><br>Combine 的官方开源替代<br>Star：1546 Issue：21 开发语言：Swift<br>Async Algorithms for Swift</p>
<h3 id="计算机科学"><a href="#计算机科学" class="headerlink" title="计算机科学"></a>计算机科学</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/raywenderlich/swift-algorithm-club">raywenderlich&#x2F;swift-algorithm-club</a></em><br>Star：26593 Issue：55 开发语言：Swift<br>Algorithms and data structures in Swift, with explanations!</p>
<h3 id="扩展知识"><a href="#扩展知识" class="headerlink" title="扩展知识"></a>扩展知识</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/trimstray/the-book-of-secret-knowledge">trimstray&#x2F;the-book-of-secret-knowledge</a></em><br>Star：71271 Issue：19 开发语言：<br>A collection of inspiring lists, manuals, cheatsheets, blogs, hacks, one-liners, cli&#x2F;web tools and more.</p>
<p><em><a target="_blank" rel="noopener" href="https://github.com/rossant/awesome-math">rossant&#x2F;awesome-math</a></em><br>Star：6046 Issue：7 开发语言：Python<br>A curated list of awesome mathematics resources</p>
<h3 id="待分类"><a href="#待分类" class="headerlink" title="待分类"></a>待分类</h3><p><em><a target="_blank" rel="noopener" href="https://github.com/krzysztofzablocki/KZFileWatchers">krzysztofzablocki&#x2F;KZFileWatchers</a></em><br>Swift编写的观察本地或者网络上，比如网盘和FTP的文件变化<br>Star：1029 Issue：2 开发语言：Swift<br>A micro-framework for observing file changes, both local and remote. Helpful in building developer tools.</p>
<h2 id="博客和资讯"><a href="#博客和资讯" class="headerlink" title="博客和资讯"></a>博客和资讯</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.swift.org/">Swift.org</a>：Swift 官方博客</li>
<li><a target="_blank" rel="noopener" href="https://github.com/SwiftOldDriver/iOS-Weekly/releases">Release notes from iOS-Weekly</a>：老司机 iOS 周报</li>
<li><a target="_blank" rel="noopener" href="https://zhangferry.com/">iOS摸鱼周报</a>：iOS 摸鱼周报</li>
<li><a target="_blank" rel="noopener" href="https://mjtsai.com/blog">Michael Tsai</a>：一名 macOS 开发者的博客</li>
<li><a target="_blank" rel="noopener" href="https://sspai.com/">少数派</a>：少数派致力于更好地运用数字产品或科学方法，帮助用户提升工作效率和生活品质</li>
<li><a target="_blank" rel="noopener" href="https://onevcat.com/">OneV’s Den</a>：上善若水，人淡如菊。这里是王巍 (onevcat) 的博客，用来记录一些技术和想法，主要专注于 Swift 和 iOS 开发。</li>
<li><a target="_blank" rel="noopener" href="https://www.avanderlee.com/">SwiftLee</a>：A weekly blog about Swift, iOS and Xcode Tips and Tricks</li>
<li><a target="_blank" rel="noopener" href="https://swiftwithmajid.com/">Swift with Majid</a>：Majid’s blog about Swift development</li>
<li><a target="_blank" rel="noopener" href="https://www.fatbobman.com/">肘子的Swift记事本</a></li>
<li><a href="https://ming1016.github.io/">戴铭的博客 - 星光社</a>：一个人走得快，一群人走的远</li>
<li><a target="_blank" rel="noopener" href="https://www.swiftbysundell.com/">Swift by Sundell</a>：Weekly Swift articles, podcasts and tips by John Sundell</li>
<li><a target="_blank" rel="noopener" href="https://www.fivestars.blog/">FIVE STARS</a>：Exploring iOS, SwiftUI &amp; much more.</li>
<li><a target="_blank" rel="noopener" href="http://weekly.swiftwithmajid.com/">SwiftUI Weekly</a>：The curated collection of links about SwiftUI. Delivered every Monday.</li>
<li><a target="_blank" rel="noopener" href="https://www.getrevue.co/profile/peterfriese">Not Only Swift Weekly</a>：Xcode tips &amp; tricks, Swift, SwiftUI, Combine, Firebase, computing and internet history, and - of course - some fun stuff.</li>
<li><a target="_blank" rel="noopener" href="https://swiftlyrush.curated.co/issues">SwiftlyRush Weekly</a>：SwiftlyRush Weekly is a weekly curated publication full of interesting, relevant links, alongside industry news and updates. Subscribe now and never miss an issue.</li>
<li><a target="_blank" rel="noopener" href="https://iosdevweekly.com/issues">iOS Dev Weekly</a>：Subscribe to a hand-picked round-up of the best iOS development links every week. Curated by Dave Verwer and published every Friday. Free.</li>
<li><a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/">阮一峰的网络日志</a>：Ruan YiFeng’s Blog 科技爱好者周刊</li>
<li><a target="_blank" rel="noopener" href="https://theswiftdev.com/">The.Swift.Dev.</a>：Weekly Swift articles</li>
<li><a target="_blank" rel="noopener" href="https://www.ifanr.com/">爱范儿</a>：让未来触手可及</li>
<li><a target="_blank" rel="noopener" href="https://www.gcores.com/">机核</a>：不止是游戏</li>
</ul>

  </div>
  <div>
    
      <div 
        class="post-note note-warning copyright" 
        style="margin-top: 42px">
        <p>
          <span style="font-weight: bold;">作者：</span><a 
            target="_blank" 
            rel="nofollow noopener noreferrer" 
            href="/about">
            戴铭
          </a>
        </p>
        <p>
          <span style="font-weight: bold;">文章链接：</span><a 
            target="_blank" 
            rel="nofollow noopener noreferrer" 
            href="http://ming1016.github.io/2021/11/23/daiming-swift-pamphlet/">
            http://ming1016.github.io/2021/11/23/daiming-swift-pamphlet/
          </a>
        </p>
        <p><span style="font-weight: bold;">版权声明：</span>本博客所有文章除特别声明外，均采用<a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0 协议</a>。转载请注明出处！</p>
      </div>
    
  </div>
</article>
<div class="nav">
  
    <div class="nav-item-prev">
      <a 
        href="/2022/01/03/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/" 
        class="nav-link">
        <i class="iconfont icon-left nav-prev-icon"></i>
        <div>
          <div class="nav-label">Prev</div>
          
            <div class="nav-title">如何用 SwiftUI + Combine + Swift Concurrency Aysnc/Await Actor 欢畅开发 </div>
          
        </div>
      </a>
    </div>
  
  
    <div class="nav-item-next">
      <a 
        href="/2021/07/24/my-little-idea-about-writing-technical-article/" 
        class="nav-link">
        <div>
          <div class="nav-label">Next</div>
          
            <div class="nav-title">我写技术文章的一点心得 </div>
          
        </div>
        <i class="iconfont icon-right nav-next-icon"></i>
      </a>
    </div>
  
</div>

<div 
  class="card card-content toc-card" 
  id="mobiletoc">
  <div class="toc-header">
  <i 
    class="iconfont icon-menu" 
    style="padding-right: 2px;">
  </i>TOC
</div>
<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E8%AF%B4%E6%98%8E"><span class="toc-number">1.</span> <span class="toc-text">背景说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95%E9%80%9F%E6%9F%A5"><span class="toc-number">2.</span> <span class="toc-text">语法速查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80"><span class="toc-number">2.1.</span> <span class="toc-text">基础</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%98%E9%87%8F-let-var"><span class="toc-number">2.1.1.</span> <span class="toc-text">变量 let, var</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%93%E5%8D%B0-print-%E2%80%9C%E2%80%9D"><span class="toc-number">2.1.2.</span> <span class="toc-text">打印 print(“”)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E9%87%8A-x2F-x2F"><span class="toc-number">2.1.3.</span> <span class="toc-text">注释 &#x2F;&#x2F;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%AF%E9%80%89"><span class="toc-number">2.1.4.</span> <span class="toc-text">可选 ?, !</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AD%E5%8C%85"><span class="toc-number">2.1.5.</span> <span class="toc-text">闭包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0-func"><span class="toc-number">2.1.6.</span> <span class="toc-text">函数 func</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="toc-number">2.1.7.</span> <span class="toc-text">访问控制</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.2.</span> <span class="toc-text">基础类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E5%AD%97-Int-Float"><span class="toc-number">2.2.1.</span> <span class="toc-text">数字 Int, Float</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E6%95%B0-Bool"><span class="toc-number">2.2.2.</span> <span class="toc-text">布尔数 Bool</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%83%E7%BB%84-a-b-c"><span class="toc-number">2.2.3.</span> <span class="toc-text">元组 (a, b, c)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">2.2.4.</span> <span class="toc-text">字符串</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%9A%E4%B8%BE"><span class="toc-number">2.2.5.</span> <span class="toc-text">枚举</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%9B%E5%9E%8B"><span class="toc-number">2.2.6.</span> <span class="toc-text">泛型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8D%E9%80%8F%E6%98%8E%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.2.7.</span> <span class="toc-text">不透明类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Result"><span class="toc-number">2.2.8.</span> <span class="toc-text">Result</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="toc-number">2.2.9.</span> <span class="toc-text">类型转换</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%92%8C%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-number">2.3.</span> <span class="toc-text">类和结构体</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB"><span class="toc-number">2.3.1.</span> <span class="toc-text">类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-number">2.3.2.</span> <span class="toc-text">结构体</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7"><span class="toc-number">2.3.3.</span> <span class="toc-text">属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95"><span class="toc-number">2.3.4.</span> <span class="toc-text">方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF"><span class="toc-number">2.3.5.</span> <span class="toc-text">继承</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%BC%8F"><span class="toc-number">2.4.</span> <span class="toc-text">函数式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#map"><span class="toc-number">2.4.1.</span> <span class="toc-text">map</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#filter"><span class="toc-number">2.4.2.</span> <span class="toc-text">filter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#reduce"><span class="toc-number">2.4.3.</span> <span class="toc-text">reduce</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sorted"><span class="toc-number">2.4.4.</span> <span class="toc-text">sorted</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E6%B5%81"><span class="toc-number">2.5.</span> <span class="toc-text">控制流</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#If-%E2%80%A2-If-let-%E2%80%A2-If-case-let"><span class="toc-number">2.5.1.</span> <span class="toc-text">If • If let • If case let</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Guard-guard-guard-let"><span class="toc-number">2.5.2.</span> <span class="toc-text">Guard guard, guard let</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%81%8D%E5%8E%86-For-in"><span class="toc-number">2.5.3.</span> <span class="toc-text">遍历 For-in</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#While-while-repeat-while"><span class="toc-number">2.5.4.</span> <span class="toc-text">While while, repeat-while</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Switch"><span class="toc-number">2.5.5.</span> <span class="toc-text">Switch</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E5%90%88"><span class="toc-number">2.6.</span> <span class="toc-text">集合</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E7%BB%84-1-2-3"><span class="toc-number">2.6.1.</span> <span class="toc-text">数组 [1, 2, 3]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Sets-Set-lt-Int-gt"><span class="toc-number">2.6.2.</span> <span class="toc-text">Sets Set&lt;Int&gt;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E5%85%B8"><span class="toc-number">2.6.3.</span> <span class="toc-text">字典 [:]</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">2.7.</span> <span class="toc-text">操作符</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B5%8B%E5%80%BC-x3D-x3D-x3D-x3D-x2F-x3D"><span class="toc-number">2.7.1.</span> <span class="toc-text">赋值 &#x3D;, +&#x3D;. -&#x3D;, *&#x3D;, &#x2F;&#x3D;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E7%AC%A6-x2F"><span class="toc-number">2.7.2.</span> <span class="toc-text">计算符 +, -, *, &#x2F;, %</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97%E7%AC%A6-x3D-x3D-gt"><span class="toc-number">2.7.3.</span> <span class="toc-text">比较运算符 &#x3D;&#x3D;, &gt;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E5%85%83"><span class="toc-number">2.7.4.</span> <span class="toc-text">三元 _ ? _ : _</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Nil-coalescing"><span class="toc-number">2.7.5.</span> <span class="toc-text">Nil-coalescing ??</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8C%83%E5%9B%B4-a%E2%80%A6b"><span class="toc-number">2.7.6.</span> <span class="toc-text">范围 a…b</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%BB%E8%BE%91-amp-amp"><span class="toc-number">2.7.7.</span> <span class="toc-text">逻辑 !, &amp;&amp;, ||</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%81%92%E7%AD%89-x3D-x3D-x3D-x3D-x3D"><span class="toc-number">2.7.8.</span> <span class="toc-text">恒等 &#x3D;&#x3D;&#x3D;, !&#x3D;&#x3D;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">2.7.9.</span> <span class="toc-text">运算符</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E5%BA%93"><span class="toc-number">2.8.</span> <span class="toc-text">基础库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%B6%E9%97%B4"><span class="toc-number">2.8.1.</span> <span class="toc-text">时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%BC%E5%BC%8F%E5%8C%96"><span class="toc-number">2.8.2.</span> <span class="toc-text">格式化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%A6%E9%87%8F%E5%80%BC"><span class="toc-number">2.8.3.</span> <span class="toc-text">度量值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Data"><span class="toc-number">2.8.4.</span> <span class="toc-text">Data</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6"><span class="toc-number">2.8.5.</span> <span class="toc-text">文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Scanner"><span class="toc-number">2.8.6.</span> <span class="toc-text">Scanner</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AttributeString"><span class="toc-number">2.8.7.</span> <span class="toc-text">AttributeString</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9A%8F%E6%9C%BA"><span class="toc-number">2.8.8.</span> <span class="toc-text">随机</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UserDefaults"><span class="toc-number">2.8.9.</span> <span class="toc-text">UserDefaults</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.9.</span> <span class="toc-text">模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E4%BE%8B"><span class="toc-number">2.9.1.</span> <span class="toc-text">单例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%8F%8A%E8%AE%BE%E5%A4%87"><span class="toc-number">2.10.</span> <span class="toc-text">系统及设备</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%88%A4%E6%96%AD"><span class="toc-number">2.10.1.</span> <span class="toc-text">系统判断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%88%E6%9C%AC%E5%85%BC%E5%AE%B9"><span class="toc-number">2.10.2.</span> <span class="toc-text">版本兼容</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#canImport-%E5%88%A4%E6%96%AD%E5%BA%93%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BD%BF%E7%94%A8"><span class="toc-number">2.10.3.</span> <span class="toc-text">canImport 判断库是否可使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#targetEnvironment-%E7%8E%AF%E5%A2%83%E7%9A%84%E5%88%A4%E6%96%AD"><span class="toc-number">2.10.4.</span> <span class="toc-text">targetEnvironment 环境的判断</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%B8%A6%E5%B1%9E%E6%80%A7%E5%8C%85%E8%A3%85"><span class="toc-number">2.11.</span> <span class="toc-text">自带属性包装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#resultBuilder"><span class="toc-number">2.11.1.</span> <span class="toc-text">@resultBuilder</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dynamicMemberLookup-%E5%8A%A8%E6%80%81%E6%88%90%E5%91%98%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.11.2.</span> <span class="toc-text">@dynamicMemberLookup 动态成员查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dynamicCallable-%E5%8A%A8%E6%80%81%E5%8F%AF%E8%B0%83%E7%94%A8%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.11.3.</span> <span class="toc-text">@dynamicCallable 动态可调用类型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%B8%A6%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.12.</span> <span class="toc-text">自带协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Hashable"><span class="toc-number">2.12.1.</span> <span class="toc-text">Hashable</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Codable"><span class="toc-number">2.13.</span> <span class="toc-text">Codable</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#JSON-%E6%B2%A1%E6%9C%89-id-%E5%AD%97%E6%AE%B5"><span class="toc-number">2.13.1.</span> <span class="toc-text">JSON 没有 id 字段</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C"><span class="toc-number">2.14.</span> <span class="toc-text">网络</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E7%8A%B6%E6%80%81%E6%A3%80%E6%9F%A5"><span class="toc-number">2.14.1.</span> <span class="toc-text">网络状态检查</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E7%94%BB"><span class="toc-number">2.15.</span> <span class="toc-text">动画</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%83%E5%B1%80%E5%8A%A8%E7%94%BB"><span class="toc-number">2.15.1.</span> <span class="toc-text">布局动画</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8"><span class="toc-number">2.16.</span> <span class="toc-text">安全</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Keychain"><span class="toc-number">2.16.1.</span> <span class="toc-text">Keychain</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E7%A8%8B"><span class="toc-number">2.17.</span> <span class="toc-text">工程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%85%A5%E5%8F%A3%E7%82%B9"><span class="toc-number">2.17.1.</span> <span class="toc-text">程序入口点</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%93%E9%A2%98"><span class="toc-number">3.</span> <span class="toc-text">专题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Swift-%E9%82%A3%E4%BA%9B%E4%BA%8B"><span class="toc-number">3.1.</span> <span class="toc-text">Swift 那些事</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95%E9%80%9F%E6%9F%A5-1"><span class="toc-number">4.</span> <span class="toc-text">语法速查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80-1"><span class="toc-number">4.1.</span> <span class="toc-text">基础</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%98%E9%87%8F-let-var-1"><span class="toc-number">4.1.1.</span> <span class="toc-text">变量 let, var</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%93%E5%8D%B0-print-%E2%80%9C%E2%80%9D-1"><span class="toc-number">4.1.2.</span> <span class="toc-text">打印 print(“”)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E9%87%8A-x2F-x2F-1"><span class="toc-number">4.1.3.</span> <span class="toc-text">注释 &#x2F;&#x2F;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%AF%E9%80%89-1"><span class="toc-number">4.1.4.</span> <span class="toc-text">可选 ?, !</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AD%E5%8C%85-1"><span class="toc-number">4.1.5.</span> <span class="toc-text">闭包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0-func-1"><span class="toc-number">4.1.6.</span> <span class="toc-text">函数 func</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6-1"><span class="toc-number">4.1.7.</span> <span class="toc-text">访问控制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Regex"><span class="toc-number">4.1.8.</span> <span class="toc-text">Regex</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%B1%BB%E5%9E%8B-1"><span class="toc-number">4.2.</span> <span class="toc-text">基础类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E5%AD%97-Int-Float-1"><span class="toc-number">4.2.1.</span> <span class="toc-text">数字 Int, Float</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E6%95%B0-Bool-1"><span class="toc-number">4.2.2.</span> <span class="toc-text">布尔数 Bool</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%83%E7%BB%84-a-b-c-1"><span class="toc-number">4.2.3.</span> <span class="toc-text">元组 (a, b, c)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2-1"><span class="toc-number">4.2.4.</span> <span class="toc-text">字符串</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%9A%E4%B8%BE-1"><span class="toc-number">4.2.5.</span> <span class="toc-text">枚举</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%9B%E5%9E%8B%E5%92%8C%E5%8D%8F%E8%AE%AE"><span class="toc-number">4.2.6.</span> <span class="toc-text">泛型和协议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8D%E9%80%8F%E6%98%8E%E7%B1%BB%E5%9E%8B-1"><span class="toc-number">4.2.7.</span> <span class="toc-text">不透明类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Result-1"><span class="toc-number">4.2.8.</span> <span class="toc-text">Result</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2-1"><span class="toc-number">4.2.9.</span> <span class="toc-text">类型转换</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%92%8C%E7%BB%93%E6%9E%84%E4%BD%93-1"><span class="toc-number">4.3.</span> <span class="toc-text">类和结构体</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB-1"><span class="toc-number">4.3.1.</span> <span class="toc-text">类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E4%BD%93-1"><span class="toc-number">4.3.2.</span> <span class="toc-text">结构体</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7-1"><span class="toc-number">4.3.3.</span> <span class="toc-text">属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95-1"><span class="toc-number">4.3.4.</span> <span class="toc-text">方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF-1"><span class="toc-number">4.3.5.</span> <span class="toc-text">继承</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%BC%8F-1"><span class="toc-number">4.4.</span> <span class="toc-text">函数式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#map-1"><span class="toc-number">4.4.1.</span> <span class="toc-text">map</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#filter-1"><span class="toc-number">4.4.2.</span> <span class="toc-text">filter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#reduce-1"><span class="toc-number">4.4.3.</span> <span class="toc-text">reduce</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sorted-1"><span class="toc-number">4.4.4.</span> <span class="toc-text">sorted</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E6%B5%81-1"><span class="toc-number">4.5.</span> <span class="toc-text">控制流</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#If-%E2%80%A2-If-let-%E2%80%A2-If-case-let-1"><span class="toc-number">4.5.1.</span> <span class="toc-text">If • If let • If case let</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Guard-guard-guard-let-1"><span class="toc-number">4.5.2.</span> <span class="toc-text">Guard guard, guard let</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%81%8D%E5%8E%86-For-in-1"><span class="toc-number">4.5.3.</span> <span class="toc-text">遍历 For-in</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#While-while-repeat-while-1"><span class="toc-number">4.5.4.</span> <span class="toc-text">While while, repeat-while</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Switch-1"><span class="toc-number">4.5.5.</span> <span class="toc-text">Switch</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E5%90%88-1"><span class="toc-number">4.6.</span> <span class="toc-text">集合</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E7%BB%84-1-2-3-1"><span class="toc-number">4.6.1.</span> <span class="toc-text">数组 [1, 2, 3]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Sets-Set"><span class="toc-number">4.6.2.</span> <span class="toc-text">Sets Set</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E5%85%B8-1"><span class="toc-number">4.6.3.</span> <span class="toc-text">字典 [:]</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E7%AC%A6-1"><span class="toc-number">4.7.</span> <span class="toc-text">操作符</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B5%8B%E5%80%BC-x3D-x3D-x3D-x3D-x2F-x3D-1"><span class="toc-number">4.7.1.</span> <span class="toc-text">赋值 &#x3D;, +&#x3D;. -&#x3D;, *&#x3D;, &#x2F;&#x3D;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E7%AC%A6-x2F-1"><span class="toc-number">4.7.2.</span> <span class="toc-text">计算符 +, -, *, &#x2F;, %</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97%E7%AC%A6-x3D-x3D-gt-1"><span class="toc-number">4.7.3.</span> <span class="toc-text">比较运算符 &#x3D;&#x3D;, &gt;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E5%85%83-1"><span class="toc-number">4.7.4.</span> <span class="toc-text">三元 _ ? _ : _</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Nil-coalescing-1"><span class="toc-number">4.7.5.</span> <span class="toc-text">Nil-coalescing ??</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8C%83%E5%9B%B4-a%E2%80%A6b-1"><span class="toc-number">4.7.6.</span> <span class="toc-text">范围 a…b</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%BB%E8%BE%91-amp-amp-1"><span class="toc-number">4.7.7.</span> <span class="toc-text">逻辑 !, &amp;&amp;, ||</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%81%92%E7%AD%89-x3D-x3D-x3D-x3D-x3D-1"><span class="toc-number">4.7.8.</span> <span class="toc-text">恒等 &#x3D;&#x3D;&#x3D;, !&#x3D;&#x3D;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%90%E7%AE%97%E7%AC%A6-1"><span class="toc-number">4.7.9.</span> <span class="toc-text">运算符</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E5%BA%93-1"><span class="toc-number">4.8.</span> <span class="toc-text">基础库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%B6%E9%97%B4-1"><span class="toc-number">4.8.1.</span> <span class="toc-text">时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%BC%E5%BC%8F%E5%8C%96-1"><span class="toc-number">4.8.2.</span> <span class="toc-text">格式化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%A6%E9%87%8F%E5%80%BC-1"><span class="toc-number">4.8.3.</span> <span class="toc-text">度量值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Data-1"><span class="toc-number">4.8.4.</span> <span class="toc-text">Data</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6-1"><span class="toc-number">4.8.5.</span> <span class="toc-text">文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Scanner-1"><span class="toc-number">4.8.6.</span> <span class="toc-text">Scanner</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AttributeString-1"><span class="toc-number">4.8.7.</span> <span class="toc-text">AttributeString</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9A%8F%E6%9C%BA-1"><span class="toc-number">4.8.8.</span> <span class="toc-text">随机</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UserDefaults-1"><span class="toc-number">4.8.9.</span> <span class="toc-text">UserDefaults</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F-1"><span class="toc-number">4.9.</span> <span class="toc-text">模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E4%BE%8B-1"><span class="toc-number">4.9.1.</span> <span class="toc-text">单例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%8F%8A%E8%AE%BE%E5%A4%87-1"><span class="toc-number">4.10.</span> <span class="toc-text">系统及设备</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%88%A4%E6%96%AD-1"><span class="toc-number">4.10.1.</span> <span class="toc-text">系统判断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%88%E6%9C%AC%E5%85%BC%E5%AE%B9-1"><span class="toc-number">4.10.2.</span> <span class="toc-text">版本兼容</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#canImport-%E5%88%A4%E6%96%AD%E5%BA%93%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BD%BF%E7%94%A8-1"><span class="toc-number">4.10.3.</span> <span class="toc-text">canImport 判断库是否可使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#targetEnvironment-%E7%8E%AF%E5%A2%83%E7%9A%84%E5%88%A4%E6%96%AD-1"><span class="toc-number">4.10.4.</span> <span class="toc-text">targetEnvironment 环境的判断</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%B8%A6%E5%B1%9E%E6%80%A7%E5%8C%85%E8%A3%85-1"><span class="toc-number">4.11.</span> <span class="toc-text">自带属性包装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#resultBuilder-1"><span class="toc-number">4.11.1.</span> <span class="toc-text">@resultBuilder</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dynamicMemberLookup-%E5%8A%A8%E6%80%81%E6%88%90%E5%91%98%E6%9F%A5%E8%AF%A2-1"><span class="toc-number">4.11.2.</span> <span class="toc-text">@dynamicMemberLookup 动态成员查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dynamicCallable-%E5%8A%A8%E6%80%81%E5%8F%AF%E8%B0%83%E7%94%A8%E7%B1%BB%E5%9E%8B-1"><span class="toc-number">4.11.3.</span> <span class="toc-text">@dynamicCallable 动态可调用类型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%B8%A6%E5%8D%8F%E8%AE%AE-1"><span class="toc-number">4.12.</span> <span class="toc-text">自带协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Hashable-1"><span class="toc-number">4.12.1.</span> <span class="toc-text">Hashable</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Codable-1"><span class="toc-number">4.13.</span> <span class="toc-text">Codable</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#JSON-%E6%B2%A1%E6%9C%89-id-%E5%AD%97%E6%AE%B5-1"><span class="toc-number">4.13.1.</span> <span class="toc-text">JSON 没有 id 字段</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C-1"><span class="toc-number">4.14.</span> <span class="toc-text">网络</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E7%8A%B6%E6%80%81%E6%A3%80%E6%9F%A5-1"><span class="toc-number">4.14.1.</span> <span class="toc-text">网络状态检查</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E7%94%BB-1"><span class="toc-number">4.15.</span> <span class="toc-text">动画</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%83%E5%B1%80%E5%8A%A8%E7%94%BB-1"><span class="toc-number">4.15.1.</span> <span class="toc-text">布局动画</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8-1"><span class="toc-number">4.16.</span> <span class="toc-text">安全</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Keychain-1"><span class="toc-number">4.16.1.</span> <span class="toc-text">Keychain</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E7%A8%8B-1"><span class="toc-number">4.17.</span> <span class="toc-text">工程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%85%A5%E5%8F%A3%E7%82%B9-1"><span class="toc-number">4.17.1.</span> <span class="toc-text">程序入口点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7"><span class="toc-number">4.18.</span> <span class="toc-text">工具</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Swift-DocC"><span class="toc-number">4.18.1.</span> <span class="toc-text">Swift-DocC</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%93%E9%A2%98-1"><span class="toc-number">5.</span> <span class="toc-text">专题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Swift-%E9%82%A3%E4%BA%9B%E4%BA%8B-1"><span class="toc-number">5.1.</span> <span class="toc-text">Swift 那些事</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Swift-%E5%90%84%E7%89%88%E6%9C%AC%E6%BC%94%E8%BF%9B"><span class="toc-number">5.1.1.</span> <span class="toc-text">Swift 各版本演进</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-1-1"><span class="toc-number">5.1.1.1.</span> <span class="toc-text">Swift 1.1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-1-2"><span class="toc-number">5.1.1.2.</span> <span class="toc-text">Swift 1.2</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-2-0"><span class="toc-number">5.1.1.3.</span> <span class="toc-text">Swift 2.0</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-2-1"><span class="toc-number">5.1.1.4.</span> <span class="toc-text">Swift 2.1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-3-0"><span class="toc-number">5.1.1.5.</span> <span class="toc-text">Swift 3.0</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-3-1"><span class="toc-number">5.1.1.6.</span> <span class="toc-text">Swift 3.1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-4-0"><span class="toc-number">5.1.1.7.</span> <span class="toc-text">Swift 4.0</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-4-1"><span class="toc-number">5.1.1.8.</span> <span class="toc-text">Swift 4.1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-4-2"><span class="toc-number">5.1.1.9.</span> <span class="toc-text">Swift 4.2</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-5-0"><span class="toc-number">5.1.1.10.</span> <span class="toc-text">Swift 5.0</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-5-1"><span class="toc-number">5.1.1.11.</span> <span class="toc-text">Swift 5.1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-5-2"><span class="toc-number">5.1.1.12.</span> <span class="toc-text">Swift 5.2</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-5-3"><span class="toc-number">5.1.1.13.</span> <span class="toc-text">Swift 5.3</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-5-4"><span class="toc-number">5.1.1.14.</span> <span class="toc-text">Swift 5.4</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-5-5"><span class="toc-number">5.1.1.15.</span> <span class="toc-text">Swift 5.5</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-5-6"><span class="toc-number">5.1.1.16.</span> <span class="toc-text">Swift 5.6</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-5-7"><span class="toc-number">5.1.1.17.</span> <span class="toc-text">Swift 5.7</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%84%E8%8C%83"><span class="toc-number">5.2.</span> <span class="toc-text">规范</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">5.2.1.</span> <span class="toc-text">注意事项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B5%84%E6%96%99%E6%8E%A8%E8%8D%90"><span class="toc-number">5.3.</span> <span class="toc-text">资料推荐</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B9%A6%E5%8D%95"><span class="toc-number">5.3.1.</span> <span class="toc-text">书单</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E6%96%B9%E5%BA%93%E4%BD%BF%E7%94%A8"><span class="toc-number">5.4.</span> <span class="toc-text">三方库使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SQLite-swift-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">5.4.1.</span> <span class="toc-text">SQLite.swift 的使用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#macOS"><span class="toc-number">5.5.</span> <span class="toc-text">macOS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8C%83%E4%BE%8B"><span class="toc-number">5.5.1.</span> <span class="toc-text">范例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E6%A0%8F%E7%BB%93%E6%9E%84"><span class="toc-number">5.5.2.</span> <span class="toc-text">三栏结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A8%E5%B1%8F%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.5.3.</span> <span class="toc-text">全屏模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B1%E4%BA%AB%E8%8F%9C%E5%8D%95"><span class="toc-number">5.5.4.</span> <span class="toc-text">共享菜单</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%AA%E8%B4%B4%E6%9D%BF"><span class="toc-number">5.5.5.</span> <span class="toc-text">剪贴板</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E5%92%8C%E6%9E%84%E5%BB%BA"><span class="toc-number">5.6.</span> <span class="toc-text">性能和构建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E8%AF%95"><span class="toc-number">5.6.1.</span> <span class="toc-text">调试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"><span class="toc-number">5.6.2.</span> <span class="toc-text">内存管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%93%BE%E6%8E%A5%E5%99%A8"><span class="toc-number">5.6.3.</span> <span class="toc-text">链接器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2022%E5%B9%B4-Apple-%E6%80%A7%E8%83%BD%E6%9B%B4%E6%96%B0"><span class="toc-number">5.6.4.</span> <span class="toc-text">2022年 Apple 性能更新</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Combine"><span class="toc-number">6.</span> <span class="toc-text">Combine</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">6.1.</span> <span class="toc-text">介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Combine-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">6.1.1.</span> <span class="toc-text">Combine 是什么？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Combine-%E8%B5%84%E6%96%99"><span class="toc-number">6.1.2.</span> <span class="toc-text">Combine 资料</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E"><span class="toc-number">6.2.</span> <span class="toc-text">使用说明</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#publisher"><span class="toc-number">6.2.1.</span> <span class="toc-text">publisher</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Just"><span class="toc-number">6.2.2.</span> <span class="toc-text">Just</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PassthroughSubject"><span class="toc-number">6.2.3.</span> <span class="toc-text">PassthroughSubject</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Empty"><span class="toc-number">6.2.4.</span> <span class="toc-text">Empty</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CurrentValueSubject"><span class="toc-number">6.2.5.</span> <span class="toc-text">CurrentValueSubject</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#removeDuplicates"><span class="toc-number">6.2.6.</span> <span class="toc-text">removeDuplicates</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#flatMap"><span class="toc-number">6.2.7.</span> <span class="toc-text">flatMap</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#append"><span class="toc-number">6.2.8.</span> <span class="toc-text">append</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#prepend"><span class="toc-number">6.2.9.</span> <span class="toc-text">prepend</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#merge"><span class="toc-number">6.2.10.</span> <span class="toc-text">merge</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#zip"><span class="toc-number">6.2.11.</span> <span class="toc-text">zip</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#combineLatest"><span class="toc-number">6.2.12.</span> <span class="toc-text">combineLatest</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Scheduler"><span class="toc-number">6.2.13.</span> <span class="toc-text">Scheduler</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">6.3.</span> <span class="toc-text">使用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82"><span class="toc-number">6.3.1.</span> <span class="toc-text">网络请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#KVO"><span class="toc-number">6.3.2.</span> <span class="toc-text">KVO</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E7%9F%A5"><span class="toc-number">6.3.3.</span> <span class="toc-text">通知</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Timer"><span class="toc-number">6.3.4.</span> <span class="toc-text">Timer</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Concurrency"><span class="toc-number">7.</span> <span class="toc-text">Concurrency</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-1"><span class="toc-number">7.1.</span> <span class="toc-text">介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Swift-Concurrency-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">7.1.1.</span> <span class="toc-text">Swift Concurrency 是什么？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#async-x2F-await"><span class="toc-number">7.1.2.</span> <span class="toc-text">async&#x2F;await</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Async-Sequences"><span class="toc-number">7.1.3.</span> <span class="toc-text">Async Sequences</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E5%8C%96%E5%B9%B6%E5%8F%91"><span class="toc-number">7.1.4.</span> <span class="toc-text">结构化并发</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Actors"><span class="toc-number">7.1.5.</span> <span class="toc-text">Actors</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Distributed-Actors"><span class="toc-number">7.1.6.</span> <span class="toc-text">Distributed Actors</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%8F%90%E6%A1%88"><span class="toc-number">7.1.7.</span> <span class="toc-text">相关提案</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%A6%E4%B9%A0%E8%B7%AF%E5%BE%84"><span class="toc-number">7.1.8.</span> <span class="toc-text">学习路径</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Swift-Concurrency-%E5%92%8C-Combine"><span class="toc-number">7.1.9.</span> <span class="toc-text">Swift Concurrency 和 Combine</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Concurrency-5-7-%E7%89%88%E6%9C%AC%E6%9B%B4%E6%96%B0"><span class="toc-number">7.1.10.</span> <span class="toc-text">Concurrency 5.7 版本更新</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SwiftUI"><span class="toc-number">8.</span> <span class="toc-text">SwiftUI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-2"><span class="toc-number">8.1.</span> <span class="toc-text">介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SwiftUI-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">8.1.1.</span> <span class="toc-text">SwiftUI 是什么？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SwiftUI-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">8.1.2.</span> <span class="toc-text">SwiftUI 参考资料</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8"><span class="toc-number">8.2.</span> <span class="toc-text">视图组件使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SwiftUI-%E5%AF%B9%E6%A0%87%E7%9A%84-UIKit-%E8%A7%86%E5%9B%BE"><span class="toc-number">8.2.1.</span> <span class="toc-text">SwiftUI 对标的 UIKit 视图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Text"><span class="toc-number">8.2.2.</span> <span class="toc-text">Text</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Link"><span class="toc-number">8.2.3.</span> <span class="toc-text">Link</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Label"><span class="toc-number">8.2.4.</span> <span class="toc-text">Label</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TextEditor"><span class="toc-number">8.2.5.</span> <span class="toc-text">TextEditor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TextField"><span class="toc-number">8.2.6.</span> <span class="toc-text">TextField</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Button"><span class="toc-number">8.2.7.</span> <span class="toc-text">Button</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9B%E5%BA%A6"><span class="toc-number">8.2.8.</span> <span class="toc-text">进度</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Image"><span class="toc-number">8.2.9.</span> <span class="toc-text">Image</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ControlGroup"><span class="toc-number">8.2.10.</span> <span class="toc-text">ControlGroup</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GroupBox"><span class="toc-number">8.2.11.</span> <span class="toc-text">GroupBox</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Stack"><span class="toc-number">8.2.12.</span> <span class="toc-text">Stack</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Advanced-layout-control"><span class="toc-number">8.2.13.</span> <span class="toc-text">Advanced layout control</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Navigation"><span class="toc-number">8.2.14.</span> <span class="toc-text">Navigation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#List"><span class="toc-number">8.2.15.</span> <span class="toc-text">List</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LazyVStack-%E5%92%8C-LazyHStack"><span class="toc-number">8.2.16.</span> <span class="toc-text">LazyVStack 和 LazyHStack</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LazyVGrid-%E5%92%8C-LazyHGrid"><span class="toc-number">8.2.17.</span> <span class="toc-text">LazyVGrid 和 LazyHGrid</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#table"><span class="toc-number">8.2.18.</span> <span class="toc-text">table</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ScrollView"><span class="toc-number">8.2.19.</span> <span class="toc-text">ScrollView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%AE%E5%B1%82"><span class="toc-number">8.2.20.</span> <span class="toc-text">浮层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TabView"><span class="toc-number">8.2.21.</span> <span class="toc-text">TabView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Swift-Charts"><span class="toc-number">8.2.22.</span> <span class="toc-text">Swift Charts</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Toggle"><span class="toc-number">8.2.23.</span> <span class="toc-text">Toggle</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Picker"><span class="toc-number">8.2.24.</span> <span class="toc-text">Picker</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Slider"><span class="toc-number">8.2.25.</span> <span class="toc-text">Slider</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Stepper"><span class="toc-number">8.2.26.</span> <span class="toc-text">Stepper</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Form"><span class="toc-number">8.2.27.</span> <span class="toc-text">Form</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Keyboard"><span class="toc-number">8.2.28.</span> <span class="toc-text">Keyboard</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Transferable"><span class="toc-number">8.2.29.</span> <span class="toc-text">Transferable</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ShareLink"><span class="toc-number">8.2.30.</span> <span class="toc-text">ShareLink</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E8%A7%89"><span class="toc-number">8.3.</span> <span class="toc-text">视觉</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Color"><span class="toc-number">8.3.1.</span> <span class="toc-text">Color</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Effect"><span class="toc-number">8.3.2.</span> <span class="toc-text">Effect</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Animation"><span class="toc-number">8.3.3.</span> <span class="toc-text">Animation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Canvas"><span class="toc-number">8.3.4.</span> <span class="toc-text">Canvas</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SF-Symbol"><span class="toc-number">8.3.5.</span> <span class="toc-text">SF Symbol</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E8%80%85"><span class="toc-number">9.</span> <span class="toc-text">开发者</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Swift%E5%AE%98%E6%96%B9"><span class="toc-number">9.1.</span> <span class="toc-text">Swift官方</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BE%E5%8C%BA"><span class="toc-number">9.2.</span> <span class="toc-text">社区</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A2%E7%B4%A2%E5%BA%93"><span class="toc-number">10.</span> <span class="toc-text">探索库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E9%B2%9C%E4%BA%8B"><span class="toc-number">10.1.</span> <span class="toc-text">新鲜事</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E6%98%93%E7%94%A8%E5%8A%9F%E8%83%BD"><span class="toc-number">10.2.</span> <span class="toc-text">封装易用功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SwiftUI-%E6%89%A9%E5%B1%95"><span class="toc-number">10.3.</span> <span class="toc-text">SwiftUI 扩展</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E7%89%87"><span class="toc-number">10.4.</span> <span class="toc-text">图片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E5%AD%97%E5%A4%84%E7%90%86"><span class="toc-number">10.5.</span> <span class="toc-text">文字处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E7%94%BB-2"><span class="toc-number">10.6.</span> <span class="toc-text">动画</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8"><span class="toc-number">10.7.</span> <span class="toc-text">持久化存储</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E8%8C%83%E5%BC%8F"><span class="toc-number">10.8.</span> <span class="toc-text">编程范式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1"><span class="toc-number">10.9.</span> <span class="toc-text">路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E6%A3%80%E6%9F%A5"><span class="toc-number">10.10.</span> <span class="toc-text">静态检查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E8%83%BD%E5%8A%9B"><span class="toc-number">10.11.</span> <span class="toc-text">系统能力</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3"><span class="toc-number">10.12.</span> <span class="toc-text">接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%BA%94%E7%94%A8"><span class="toc-number">10.13.</span> <span class="toc-text">接口应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#macOS-1"><span class="toc-number">10.14.</span> <span class="toc-text">macOS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8"><span class="toc-number">10.15.</span> <span class="toc-text">应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%B8%E6%88%8F"><span class="toc-number">10.16.</span> <span class="toc-text">游戏</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E6%8A%80%E6%9C%AF%E5%B1%95%E7%A4%BA"><span class="toc-number">10.17.</span> <span class="toc-text">新技术展示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Combine-%E6%89%A9%E5%B1%95"><span class="toc-number">10.18.</span> <span class="toc-text">Combine 扩展</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%9A%E5%90%88"><span class="toc-number">10.19.</span> <span class="toc-text">聚合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E3%80%81%E5%B7%A5%E7%A8%8B%E6%9E%84%E5%BB%BA%E5%8F%8A%E8%87%AA%E5%8A%A8%E5%8C%96"><span class="toc-number">10.20.</span> <span class="toc-text">性能、工程构建及自动化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">10.21.</span> <span class="toc-text">测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C-2"><span class="toc-number">10.22.</span> <span class="toc-text">网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E5%BD%A2"><span class="toc-number">10.23.</span> <span class="toc-text">图形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9F%B3%E8%A7%86%E9%A2%91"><span class="toc-number">10.24.</span> <span class="toc-text">音视频</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8-2"><span class="toc-number">10.25.</span> <span class="toc-text">安全</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Web"><span class="toc-number">10.26.</span> <span class="toc-text">Web</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">10.27.</span> <span class="toc-text">服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F"><span class="toc-number">10.28.</span> <span class="toc-text">系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Web-3-0"><span class="toc-number">10.29.</span> <span class="toc-text">Web 3.0</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Apple"><span class="toc-number">10.30.</span> <span class="toc-text">Apple</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6"><span class="toc-number">10.31.</span> <span class="toc-text">计算机科学</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E7%9F%A5%E8%AF%86"><span class="toc-number">10.32.</span> <span class="toc-text">扩展知识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%85%E5%88%86%E7%B1%BB"><span class="toc-number">10.33.</span> <span class="toc-text">待分类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%9A%E5%AE%A2%E5%92%8C%E8%B5%84%E8%AE%AF"><span class="toc-number">11.</span> <span class="toc-text">博客和资讯</span></a></li></ol>
</div>
            </main>
            <aside class="right-column">
              <div class="sticky-widescreen">
  
  
    <article class="card card-content toc-card">
      <div class="toc-header">
  <i 
    class="iconfont icon-menu" 
    style="padding-right: 2px;">
  </i>TOC
</div>
<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E8%AF%B4%E6%98%8E"><span class="toc-number">1.</span> <span class="toc-text">背景说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95%E9%80%9F%E6%9F%A5"><span class="toc-number">2.</span> <span class="toc-text">语法速查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80"><span class="toc-number">2.1.</span> <span class="toc-text">基础</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%98%E9%87%8F-let-var"><span class="toc-number">2.1.1.</span> <span class="toc-text">变量 let, var</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%93%E5%8D%B0-print-%E2%80%9C%E2%80%9D"><span class="toc-number">2.1.2.</span> <span class="toc-text">打印 print(“”)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E9%87%8A-x2F-x2F"><span class="toc-number">2.1.3.</span> <span class="toc-text">注释 &#x2F;&#x2F;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%AF%E9%80%89"><span class="toc-number">2.1.4.</span> <span class="toc-text">可选 ?, !</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AD%E5%8C%85"><span class="toc-number">2.1.5.</span> <span class="toc-text">闭包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0-func"><span class="toc-number">2.1.6.</span> <span class="toc-text">函数 func</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="toc-number">2.1.7.</span> <span class="toc-text">访问控制</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.2.</span> <span class="toc-text">基础类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E5%AD%97-Int-Float"><span class="toc-number">2.2.1.</span> <span class="toc-text">数字 Int, Float</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E6%95%B0-Bool"><span class="toc-number">2.2.2.</span> <span class="toc-text">布尔数 Bool</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%83%E7%BB%84-a-b-c"><span class="toc-number">2.2.3.</span> <span class="toc-text">元组 (a, b, c)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">2.2.4.</span> <span class="toc-text">字符串</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%9A%E4%B8%BE"><span class="toc-number">2.2.5.</span> <span class="toc-text">枚举</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%9B%E5%9E%8B"><span class="toc-number">2.2.6.</span> <span class="toc-text">泛型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8D%E9%80%8F%E6%98%8E%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.2.7.</span> <span class="toc-text">不透明类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Result"><span class="toc-number">2.2.8.</span> <span class="toc-text">Result</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="toc-number">2.2.9.</span> <span class="toc-text">类型转换</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%92%8C%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-number">2.3.</span> <span class="toc-text">类和结构体</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB"><span class="toc-number">2.3.1.</span> <span class="toc-text">类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-number">2.3.2.</span> <span class="toc-text">结构体</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7"><span class="toc-number">2.3.3.</span> <span class="toc-text">属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95"><span class="toc-number">2.3.4.</span> <span class="toc-text">方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF"><span class="toc-number">2.3.5.</span> <span class="toc-text">继承</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%BC%8F"><span class="toc-number">2.4.</span> <span class="toc-text">函数式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#map"><span class="toc-number">2.4.1.</span> <span class="toc-text">map</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#filter"><span class="toc-number">2.4.2.</span> <span class="toc-text">filter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#reduce"><span class="toc-number">2.4.3.</span> <span class="toc-text">reduce</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sorted"><span class="toc-number">2.4.4.</span> <span class="toc-text">sorted</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E6%B5%81"><span class="toc-number">2.5.</span> <span class="toc-text">控制流</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#If-%E2%80%A2-If-let-%E2%80%A2-If-case-let"><span class="toc-number">2.5.1.</span> <span class="toc-text">If • If let • If case let</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Guard-guard-guard-let"><span class="toc-number">2.5.2.</span> <span class="toc-text">Guard guard, guard let</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%81%8D%E5%8E%86-For-in"><span class="toc-number">2.5.3.</span> <span class="toc-text">遍历 For-in</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#While-while-repeat-while"><span class="toc-number">2.5.4.</span> <span class="toc-text">While while, repeat-while</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Switch"><span class="toc-number">2.5.5.</span> <span class="toc-text">Switch</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E5%90%88"><span class="toc-number">2.6.</span> <span class="toc-text">集合</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E7%BB%84-1-2-3"><span class="toc-number">2.6.1.</span> <span class="toc-text">数组 [1, 2, 3]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Sets-Set-lt-Int-gt"><span class="toc-number">2.6.2.</span> <span class="toc-text">Sets Set&lt;Int&gt;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E5%85%B8"><span class="toc-number">2.6.3.</span> <span class="toc-text">字典 [:]</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">2.7.</span> <span class="toc-text">操作符</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B5%8B%E5%80%BC-x3D-x3D-x3D-x3D-x2F-x3D"><span class="toc-number">2.7.1.</span> <span class="toc-text">赋值 &#x3D;, +&#x3D;. -&#x3D;, *&#x3D;, &#x2F;&#x3D;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E7%AC%A6-x2F"><span class="toc-number">2.7.2.</span> <span class="toc-text">计算符 +, -, *, &#x2F;, %</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97%E7%AC%A6-x3D-x3D-gt"><span class="toc-number">2.7.3.</span> <span class="toc-text">比较运算符 &#x3D;&#x3D;, &gt;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E5%85%83"><span class="toc-number">2.7.4.</span> <span class="toc-text">三元 _ ? _ : _</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Nil-coalescing"><span class="toc-number">2.7.5.</span> <span class="toc-text">Nil-coalescing ??</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8C%83%E5%9B%B4-a%E2%80%A6b"><span class="toc-number">2.7.6.</span> <span class="toc-text">范围 a…b</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%BB%E8%BE%91-amp-amp"><span class="toc-number">2.7.7.</span> <span class="toc-text">逻辑 !, &amp;&amp;, ||</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%81%92%E7%AD%89-x3D-x3D-x3D-x3D-x3D"><span class="toc-number">2.7.8.</span> <span class="toc-text">恒等 &#x3D;&#x3D;&#x3D;, !&#x3D;&#x3D;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">2.7.9.</span> <span class="toc-text">运算符</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E5%BA%93"><span class="toc-number">2.8.</span> <span class="toc-text">基础库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%B6%E9%97%B4"><span class="toc-number">2.8.1.</span> <span class="toc-text">时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%BC%E5%BC%8F%E5%8C%96"><span class="toc-number">2.8.2.</span> <span class="toc-text">格式化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%A6%E9%87%8F%E5%80%BC"><span class="toc-number">2.8.3.</span> <span class="toc-text">度量值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Data"><span class="toc-number">2.8.4.</span> <span class="toc-text">Data</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6"><span class="toc-number">2.8.5.</span> <span class="toc-text">文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Scanner"><span class="toc-number">2.8.6.</span> <span class="toc-text">Scanner</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AttributeString"><span class="toc-number">2.8.7.</span> <span class="toc-text">AttributeString</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9A%8F%E6%9C%BA"><span class="toc-number">2.8.8.</span> <span class="toc-text">随机</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UserDefaults"><span class="toc-number">2.8.9.</span> <span class="toc-text">UserDefaults</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.9.</span> <span class="toc-text">模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E4%BE%8B"><span class="toc-number">2.9.1.</span> <span class="toc-text">单例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%8F%8A%E8%AE%BE%E5%A4%87"><span class="toc-number">2.10.</span> <span class="toc-text">系统及设备</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%88%A4%E6%96%AD"><span class="toc-number">2.10.1.</span> <span class="toc-text">系统判断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%88%E6%9C%AC%E5%85%BC%E5%AE%B9"><span class="toc-number">2.10.2.</span> <span class="toc-text">版本兼容</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#canImport-%E5%88%A4%E6%96%AD%E5%BA%93%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BD%BF%E7%94%A8"><span class="toc-number">2.10.3.</span> <span class="toc-text">canImport 判断库是否可使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#targetEnvironment-%E7%8E%AF%E5%A2%83%E7%9A%84%E5%88%A4%E6%96%AD"><span class="toc-number">2.10.4.</span> <span class="toc-text">targetEnvironment 环境的判断</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%B8%A6%E5%B1%9E%E6%80%A7%E5%8C%85%E8%A3%85"><span class="toc-number">2.11.</span> <span class="toc-text">自带属性包装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#resultBuilder"><span class="toc-number">2.11.1.</span> <span class="toc-text">@resultBuilder</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dynamicMemberLookup-%E5%8A%A8%E6%80%81%E6%88%90%E5%91%98%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.11.2.</span> <span class="toc-text">@dynamicMemberLookup 动态成员查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dynamicCallable-%E5%8A%A8%E6%80%81%E5%8F%AF%E8%B0%83%E7%94%A8%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.11.3.</span> <span class="toc-text">@dynamicCallable 动态可调用类型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%B8%A6%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.12.</span> <span class="toc-text">自带协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Hashable"><span class="toc-number">2.12.1.</span> <span class="toc-text">Hashable</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Codable"><span class="toc-number">2.13.</span> <span class="toc-text">Codable</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#JSON-%E6%B2%A1%E6%9C%89-id-%E5%AD%97%E6%AE%B5"><span class="toc-number">2.13.1.</span> <span class="toc-text">JSON 没有 id 字段</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C"><span class="toc-number">2.14.</span> <span class="toc-text">网络</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E7%8A%B6%E6%80%81%E6%A3%80%E6%9F%A5"><span class="toc-number">2.14.1.</span> <span class="toc-text">网络状态检查</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E7%94%BB"><span class="toc-number">2.15.</span> <span class="toc-text">动画</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%83%E5%B1%80%E5%8A%A8%E7%94%BB"><span class="toc-number">2.15.1.</span> <span class="toc-text">布局动画</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8"><span class="toc-number">2.16.</span> <span class="toc-text">安全</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Keychain"><span class="toc-number">2.16.1.</span> <span class="toc-text">Keychain</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E7%A8%8B"><span class="toc-number">2.17.</span> <span class="toc-text">工程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%85%A5%E5%8F%A3%E7%82%B9"><span class="toc-number">2.17.1.</span> <span class="toc-text">程序入口点</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%93%E9%A2%98"><span class="toc-number">3.</span> <span class="toc-text">专题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Swift-%E9%82%A3%E4%BA%9B%E4%BA%8B"><span class="toc-number">3.1.</span> <span class="toc-text">Swift 那些事</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95%E9%80%9F%E6%9F%A5-1"><span class="toc-number">4.</span> <span class="toc-text">语法速查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80-1"><span class="toc-number">4.1.</span> <span class="toc-text">基础</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%98%E9%87%8F-let-var-1"><span class="toc-number">4.1.1.</span> <span class="toc-text">变量 let, var</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%93%E5%8D%B0-print-%E2%80%9C%E2%80%9D-1"><span class="toc-number">4.1.2.</span> <span class="toc-text">打印 print(“”)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E9%87%8A-x2F-x2F-1"><span class="toc-number">4.1.3.</span> <span class="toc-text">注释 &#x2F;&#x2F;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%AF%E9%80%89-1"><span class="toc-number">4.1.4.</span> <span class="toc-text">可选 ?, !</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AD%E5%8C%85-1"><span class="toc-number">4.1.5.</span> <span class="toc-text">闭包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0-func-1"><span class="toc-number">4.1.6.</span> <span class="toc-text">函数 func</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6-1"><span class="toc-number">4.1.7.</span> <span class="toc-text">访问控制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Regex"><span class="toc-number">4.1.8.</span> <span class="toc-text">Regex</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%B1%BB%E5%9E%8B-1"><span class="toc-number">4.2.</span> <span class="toc-text">基础类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E5%AD%97-Int-Float-1"><span class="toc-number">4.2.1.</span> <span class="toc-text">数字 Int, Float</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E6%95%B0-Bool-1"><span class="toc-number">4.2.2.</span> <span class="toc-text">布尔数 Bool</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%83%E7%BB%84-a-b-c-1"><span class="toc-number">4.2.3.</span> <span class="toc-text">元组 (a, b, c)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2-1"><span class="toc-number">4.2.4.</span> <span class="toc-text">字符串</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%9A%E4%B8%BE-1"><span class="toc-number">4.2.5.</span> <span class="toc-text">枚举</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%9B%E5%9E%8B%E5%92%8C%E5%8D%8F%E8%AE%AE"><span class="toc-number">4.2.6.</span> <span class="toc-text">泛型和协议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8D%E9%80%8F%E6%98%8E%E7%B1%BB%E5%9E%8B-1"><span class="toc-number">4.2.7.</span> <span class="toc-text">不透明类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Result-1"><span class="toc-number">4.2.8.</span> <span class="toc-text">Result</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2-1"><span class="toc-number">4.2.9.</span> <span class="toc-text">类型转换</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%92%8C%E7%BB%93%E6%9E%84%E4%BD%93-1"><span class="toc-number">4.3.</span> <span class="toc-text">类和结构体</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB-1"><span class="toc-number">4.3.1.</span> <span class="toc-text">类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E4%BD%93-1"><span class="toc-number">4.3.2.</span> <span class="toc-text">结构体</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7-1"><span class="toc-number">4.3.3.</span> <span class="toc-text">属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95-1"><span class="toc-number">4.3.4.</span> <span class="toc-text">方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF-1"><span class="toc-number">4.3.5.</span> <span class="toc-text">继承</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%BC%8F-1"><span class="toc-number">4.4.</span> <span class="toc-text">函数式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#map-1"><span class="toc-number">4.4.1.</span> <span class="toc-text">map</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#filter-1"><span class="toc-number">4.4.2.</span> <span class="toc-text">filter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#reduce-1"><span class="toc-number">4.4.3.</span> <span class="toc-text">reduce</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sorted-1"><span class="toc-number">4.4.4.</span> <span class="toc-text">sorted</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E6%B5%81-1"><span class="toc-number">4.5.</span> <span class="toc-text">控制流</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#If-%E2%80%A2-If-let-%E2%80%A2-If-case-let-1"><span class="toc-number">4.5.1.</span> <span class="toc-text">If • If let • If case let</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Guard-guard-guard-let-1"><span class="toc-number">4.5.2.</span> <span class="toc-text">Guard guard, guard let</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%81%8D%E5%8E%86-For-in-1"><span class="toc-number">4.5.3.</span> <span class="toc-text">遍历 For-in</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#While-while-repeat-while-1"><span class="toc-number">4.5.4.</span> <span class="toc-text">While while, repeat-while</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Switch-1"><span class="toc-number">4.5.5.</span> <span class="toc-text">Switch</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E5%90%88-1"><span class="toc-number">4.6.</span> <span class="toc-text">集合</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E7%BB%84-1-2-3-1"><span class="toc-number">4.6.1.</span> <span class="toc-text">数组 [1, 2, 3]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Sets-Set"><span class="toc-number">4.6.2.</span> <span class="toc-text">Sets Set</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E5%85%B8-1"><span class="toc-number">4.6.3.</span> <span class="toc-text">字典 [:]</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E7%AC%A6-1"><span class="toc-number">4.7.</span> <span class="toc-text">操作符</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B5%8B%E5%80%BC-x3D-x3D-x3D-x3D-x2F-x3D-1"><span class="toc-number">4.7.1.</span> <span class="toc-text">赋值 &#x3D;, +&#x3D;. -&#x3D;, *&#x3D;, &#x2F;&#x3D;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E7%AC%A6-x2F-1"><span class="toc-number">4.7.2.</span> <span class="toc-text">计算符 +, -, *, &#x2F;, %</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97%E7%AC%A6-x3D-x3D-gt-1"><span class="toc-number">4.7.3.</span> <span class="toc-text">比较运算符 &#x3D;&#x3D;, &gt;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E5%85%83-1"><span class="toc-number">4.7.4.</span> <span class="toc-text">三元 _ ? _ : _</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Nil-coalescing-1"><span class="toc-number">4.7.5.</span> <span class="toc-text">Nil-coalescing ??</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8C%83%E5%9B%B4-a%E2%80%A6b-1"><span class="toc-number">4.7.6.</span> <span class="toc-text">范围 a…b</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%BB%E8%BE%91-amp-amp-1"><span class="toc-number">4.7.7.</span> <span class="toc-text">逻辑 !, &amp;&amp;, ||</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%81%92%E7%AD%89-x3D-x3D-x3D-x3D-x3D-1"><span class="toc-number">4.7.8.</span> <span class="toc-text">恒等 &#x3D;&#x3D;&#x3D;, !&#x3D;&#x3D;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%90%E7%AE%97%E7%AC%A6-1"><span class="toc-number">4.7.9.</span> <span class="toc-text">运算符</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E5%BA%93-1"><span class="toc-number">4.8.</span> <span class="toc-text">基础库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%B6%E9%97%B4-1"><span class="toc-number">4.8.1.</span> <span class="toc-text">时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%BC%E5%BC%8F%E5%8C%96-1"><span class="toc-number">4.8.2.</span> <span class="toc-text">格式化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%A6%E9%87%8F%E5%80%BC-1"><span class="toc-number">4.8.3.</span> <span class="toc-text">度量值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Data-1"><span class="toc-number">4.8.4.</span> <span class="toc-text">Data</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6-1"><span class="toc-number">4.8.5.</span> <span class="toc-text">文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Scanner-1"><span class="toc-number">4.8.6.</span> <span class="toc-text">Scanner</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AttributeString-1"><span class="toc-number">4.8.7.</span> <span class="toc-text">AttributeString</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9A%8F%E6%9C%BA-1"><span class="toc-number">4.8.8.</span> <span class="toc-text">随机</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UserDefaults-1"><span class="toc-number">4.8.9.</span> <span class="toc-text">UserDefaults</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F-1"><span class="toc-number">4.9.</span> <span class="toc-text">模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E4%BE%8B-1"><span class="toc-number">4.9.1.</span> <span class="toc-text">单例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%8F%8A%E8%AE%BE%E5%A4%87-1"><span class="toc-number">4.10.</span> <span class="toc-text">系统及设备</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%88%A4%E6%96%AD-1"><span class="toc-number">4.10.1.</span> <span class="toc-text">系统判断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%88%E6%9C%AC%E5%85%BC%E5%AE%B9-1"><span class="toc-number">4.10.2.</span> <span class="toc-text">版本兼容</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#canImport-%E5%88%A4%E6%96%AD%E5%BA%93%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BD%BF%E7%94%A8-1"><span class="toc-number">4.10.3.</span> <span class="toc-text">canImport 判断库是否可使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#targetEnvironment-%E7%8E%AF%E5%A2%83%E7%9A%84%E5%88%A4%E6%96%AD-1"><span class="toc-number">4.10.4.</span> <span class="toc-text">targetEnvironment 环境的判断</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%B8%A6%E5%B1%9E%E6%80%A7%E5%8C%85%E8%A3%85-1"><span class="toc-number">4.11.</span> <span class="toc-text">自带属性包装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#resultBuilder-1"><span class="toc-number">4.11.1.</span> <span class="toc-text">@resultBuilder</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dynamicMemberLookup-%E5%8A%A8%E6%80%81%E6%88%90%E5%91%98%E6%9F%A5%E8%AF%A2-1"><span class="toc-number">4.11.2.</span> <span class="toc-text">@dynamicMemberLookup 动态成员查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dynamicCallable-%E5%8A%A8%E6%80%81%E5%8F%AF%E8%B0%83%E7%94%A8%E7%B1%BB%E5%9E%8B-1"><span class="toc-number">4.11.3.</span> <span class="toc-text">@dynamicCallable 动态可调用类型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%B8%A6%E5%8D%8F%E8%AE%AE-1"><span class="toc-number">4.12.</span> <span class="toc-text">自带协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Hashable-1"><span class="toc-number">4.12.1.</span> <span class="toc-text">Hashable</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Codable-1"><span class="toc-number">4.13.</span> <span class="toc-text">Codable</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#JSON-%E6%B2%A1%E6%9C%89-id-%E5%AD%97%E6%AE%B5-1"><span class="toc-number">4.13.1.</span> <span class="toc-text">JSON 没有 id 字段</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C-1"><span class="toc-number">4.14.</span> <span class="toc-text">网络</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E7%8A%B6%E6%80%81%E6%A3%80%E6%9F%A5-1"><span class="toc-number">4.14.1.</span> <span class="toc-text">网络状态检查</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E7%94%BB-1"><span class="toc-number">4.15.</span> <span class="toc-text">动画</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%83%E5%B1%80%E5%8A%A8%E7%94%BB-1"><span class="toc-number">4.15.1.</span> <span class="toc-text">布局动画</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8-1"><span class="toc-number">4.16.</span> <span class="toc-text">安全</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Keychain-1"><span class="toc-number">4.16.1.</span> <span class="toc-text">Keychain</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E7%A8%8B-1"><span class="toc-number">4.17.</span> <span class="toc-text">工程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%85%A5%E5%8F%A3%E7%82%B9-1"><span class="toc-number">4.17.1.</span> <span class="toc-text">程序入口点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7"><span class="toc-number">4.18.</span> <span class="toc-text">工具</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Swift-DocC"><span class="toc-number">4.18.1.</span> <span class="toc-text">Swift-DocC</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%93%E9%A2%98-1"><span class="toc-number">5.</span> <span class="toc-text">专题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Swift-%E9%82%A3%E4%BA%9B%E4%BA%8B-1"><span class="toc-number">5.1.</span> <span class="toc-text">Swift 那些事</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Swift-%E5%90%84%E7%89%88%E6%9C%AC%E6%BC%94%E8%BF%9B"><span class="toc-number">5.1.1.</span> <span class="toc-text">Swift 各版本演进</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-1-1"><span class="toc-number">5.1.1.1.</span> <span class="toc-text">Swift 1.1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-1-2"><span class="toc-number">5.1.1.2.</span> <span class="toc-text">Swift 1.2</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-2-0"><span class="toc-number">5.1.1.3.</span> <span class="toc-text">Swift 2.0</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-2-1"><span class="toc-number">5.1.1.4.</span> <span class="toc-text">Swift 2.1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-3-0"><span class="toc-number">5.1.1.5.</span> <span class="toc-text">Swift 3.0</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-3-1"><span class="toc-number">5.1.1.6.</span> <span class="toc-text">Swift 3.1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-4-0"><span class="toc-number">5.1.1.7.</span> <span class="toc-text">Swift 4.0</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-4-1"><span class="toc-number">5.1.1.8.</span> <span class="toc-text">Swift 4.1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-4-2"><span class="toc-number">5.1.1.9.</span> <span class="toc-text">Swift 4.2</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-5-0"><span class="toc-number">5.1.1.10.</span> <span class="toc-text">Swift 5.0</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-5-1"><span class="toc-number">5.1.1.11.</span> <span class="toc-text">Swift 5.1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-5-2"><span class="toc-number">5.1.1.12.</span> <span class="toc-text">Swift 5.2</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-5-3"><span class="toc-number">5.1.1.13.</span> <span class="toc-text">Swift 5.3</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-5-4"><span class="toc-number">5.1.1.14.</span> <span class="toc-text">Swift 5.4</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-5-5"><span class="toc-number">5.1.1.15.</span> <span class="toc-text">Swift 5.5</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-5-6"><span class="toc-number">5.1.1.16.</span> <span class="toc-text">Swift 5.6</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Swift-5-7"><span class="toc-number">5.1.1.17.</span> <span class="toc-text">Swift 5.7</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%84%E8%8C%83"><span class="toc-number">5.2.</span> <span class="toc-text">规范</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">5.2.1.</span> <span class="toc-text">注意事项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B5%84%E6%96%99%E6%8E%A8%E8%8D%90"><span class="toc-number">5.3.</span> <span class="toc-text">资料推荐</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B9%A6%E5%8D%95"><span class="toc-number">5.3.1.</span> <span class="toc-text">书单</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E6%96%B9%E5%BA%93%E4%BD%BF%E7%94%A8"><span class="toc-number">5.4.</span> <span class="toc-text">三方库使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SQLite-swift-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">5.4.1.</span> <span class="toc-text">SQLite.swift 的使用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#macOS"><span class="toc-number">5.5.</span> <span class="toc-text">macOS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8C%83%E4%BE%8B"><span class="toc-number">5.5.1.</span> <span class="toc-text">范例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E6%A0%8F%E7%BB%93%E6%9E%84"><span class="toc-number">5.5.2.</span> <span class="toc-text">三栏结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A8%E5%B1%8F%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.5.3.</span> <span class="toc-text">全屏模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B1%E4%BA%AB%E8%8F%9C%E5%8D%95"><span class="toc-number">5.5.4.</span> <span class="toc-text">共享菜单</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%AA%E8%B4%B4%E6%9D%BF"><span class="toc-number">5.5.5.</span> <span class="toc-text">剪贴板</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E5%92%8C%E6%9E%84%E5%BB%BA"><span class="toc-number">5.6.</span> <span class="toc-text">性能和构建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E8%AF%95"><span class="toc-number">5.6.1.</span> <span class="toc-text">调试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"><span class="toc-number">5.6.2.</span> <span class="toc-text">内存管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%93%BE%E6%8E%A5%E5%99%A8"><span class="toc-number">5.6.3.</span> <span class="toc-text">链接器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2022%E5%B9%B4-Apple-%E6%80%A7%E8%83%BD%E6%9B%B4%E6%96%B0"><span class="toc-number">5.6.4.</span> <span class="toc-text">2022年 Apple 性能更新</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Combine"><span class="toc-number">6.</span> <span class="toc-text">Combine</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">6.1.</span> <span class="toc-text">介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Combine-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">6.1.1.</span> <span class="toc-text">Combine 是什么？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Combine-%E8%B5%84%E6%96%99"><span class="toc-number">6.1.2.</span> <span class="toc-text">Combine 资料</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E"><span class="toc-number">6.2.</span> <span class="toc-text">使用说明</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#publisher"><span class="toc-number">6.2.1.</span> <span class="toc-text">publisher</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Just"><span class="toc-number">6.2.2.</span> <span class="toc-text">Just</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PassthroughSubject"><span class="toc-number">6.2.3.</span> <span class="toc-text">PassthroughSubject</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Empty"><span class="toc-number">6.2.4.</span> <span class="toc-text">Empty</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CurrentValueSubject"><span class="toc-number">6.2.5.</span> <span class="toc-text">CurrentValueSubject</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#removeDuplicates"><span class="toc-number">6.2.6.</span> <span class="toc-text">removeDuplicates</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#flatMap"><span class="toc-number">6.2.7.</span> <span class="toc-text">flatMap</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#append"><span class="toc-number">6.2.8.</span> <span class="toc-text">append</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#prepend"><span class="toc-number">6.2.9.</span> <span class="toc-text">prepend</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#merge"><span class="toc-number">6.2.10.</span> <span class="toc-text">merge</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#zip"><span class="toc-number">6.2.11.</span> <span class="toc-text">zip</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#combineLatest"><span class="toc-number">6.2.12.</span> <span class="toc-text">combineLatest</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Scheduler"><span class="toc-number">6.2.13.</span> <span class="toc-text">Scheduler</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">6.3.</span> <span class="toc-text">使用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82"><span class="toc-number">6.3.1.</span> <span class="toc-text">网络请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#KVO"><span class="toc-number">6.3.2.</span> <span class="toc-text">KVO</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E7%9F%A5"><span class="toc-number">6.3.3.</span> <span class="toc-text">通知</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Timer"><span class="toc-number">6.3.4.</span> <span class="toc-text">Timer</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Concurrency"><span class="toc-number">7.</span> <span class="toc-text">Concurrency</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-1"><span class="toc-number">7.1.</span> <span class="toc-text">介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Swift-Concurrency-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">7.1.1.</span> <span class="toc-text">Swift Concurrency 是什么？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#async-x2F-await"><span class="toc-number">7.1.2.</span> <span class="toc-text">async&#x2F;await</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Async-Sequences"><span class="toc-number">7.1.3.</span> <span class="toc-text">Async Sequences</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E5%8C%96%E5%B9%B6%E5%8F%91"><span class="toc-number">7.1.4.</span> <span class="toc-text">结构化并发</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Actors"><span class="toc-number">7.1.5.</span> <span class="toc-text">Actors</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Distributed-Actors"><span class="toc-number">7.1.6.</span> <span class="toc-text">Distributed Actors</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%8F%90%E6%A1%88"><span class="toc-number">7.1.7.</span> <span class="toc-text">相关提案</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%A6%E4%B9%A0%E8%B7%AF%E5%BE%84"><span class="toc-number">7.1.8.</span> <span class="toc-text">学习路径</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Swift-Concurrency-%E5%92%8C-Combine"><span class="toc-number">7.1.9.</span> <span class="toc-text">Swift Concurrency 和 Combine</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Concurrency-5-7-%E7%89%88%E6%9C%AC%E6%9B%B4%E6%96%B0"><span class="toc-number">7.1.10.</span> <span class="toc-text">Concurrency 5.7 版本更新</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SwiftUI"><span class="toc-number">8.</span> <span class="toc-text">SwiftUI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-2"><span class="toc-number">8.1.</span> <span class="toc-text">介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SwiftUI-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">8.1.1.</span> <span class="toc-text">SwiftUI 是什么？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SwiftUI-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">8.1.2.</span> <span class="toc-text">SwiftUI 参考资料</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8"><span class="toc-number">8.2.</span> <span class="toc-text">视图组件使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SwiftUI-%E5%AF%B9%E6%A0%87%E7%9A%84-UIKit-%E8%A7%86%E5%9B%BE"><span class="toc-number">8.2.1.</span> <span class="toc-text">SwiftUI 对标的 UIKit 视图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Text"><span class="toc-number">8.2.2.</span> <span class="toc-text">Text</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Link"><span class="toc-number">8.2.3.</span> <span class="toc-text">Link</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Label"><span class="toc-number">8.2.4.</span> <span class="toc-text">Label</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TextEditor"><span class="toc-number">8.2.5.</span> <span class="toc-text">TextEditor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TextField"><span class="toc-number">8.2.6.</span> <span class="toc-text">TextField</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Button"><span class="toc-number">8.2.7.</span> <span class="toc-text">Button</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9B%E5%BA%A6"><span class="toc-number">8.2.8.</span> <span class="toc-text">进度</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Image"><span class="toc-number">8.2.9.</span> <span class="toc-text">Image</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ControlGroup"><span class="toc-number">8.2.10.</span> <span class="toc-text">ControlGroup</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GroupBox"><span class="toc-number">8.2.11.</span> <span class="toc-text">GroupBox</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Stack"><span class="toc-number">8.2.12.</span> <span class="toc-text">Stack</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Advanced-layout-control"><span class="toc-number">8.2.13.</span> <span class="toc-text">Advanced layout control</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Navigation"><span class="toc-number">8.2.14.</span> <span class="toc-text">Navigation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#List"><span class="toc-number">8.2.15.</span> <span class="toc-text">List</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LazyVStack-%E5%92%8C-LazyHStack"><span class="toc-number">8.2.16.</span> <span class="toc-text">LazyVStack 和 LazyHStack</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LazyVGrid-%E5%92%8C-LazyHGrid"><span class="toc-number">8.2.17.</span> <span class="toc-text">LazyVGrid 和 LazyHGrid</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#table"><span class="toc-number">8.2.18.</span> <span class="toc-text">table</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ScrollView"><span class="toc-number">8.2.19.</span> <span class="toc-text">ScrollView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%AE%E5%B1%82"><span class="toc-number">8.2.20.</span> <span class="toc-text">浮层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TabView"><span class="toc-number">8.2.21.</span> <span class="toc-text">TabView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Swift-Charts"><span class="toc-number">8.2.22.</span> <span class="toc-text">Swift Charts</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Toggle"><span class="toc-number">8.2.23.</span> <span class="toc-text">Toggle</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Picker"><span class="toc-number">8.2.24.</span> <span class="toc-text">Picker</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Slider"><span class="toc-number">8.2.25.</span> <span class="toc-text">Slider</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Stepper"><span class="toc-number">8.2.26.</span> <span class="toc-text">Stepper</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Form"><span class="toc-number">8.2.27.</span> <span class="toc-text">Form</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Keyboard"><span class="toc-number">8.2.28.</span> <span class="toc-text">Keyboard</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Transferable"><span class="toc-number">8.2.29.</span> <span class="toc-text">Transferable</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ShareLink"><span class="toc-number">8.2.30.</span> <span class="toc-text">ShareLink</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E8%A7%89"><span class="toc-number">8.3.</span> <span class="toc-text">视觉</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Color"><span class="toc-number">8.3.1.</span> <span class="toc-text">Color</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Effect"><span class="toc-number">8.3.2.</span> <span class="toc-text">Effect</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Animation"><span class="toc-number">8.3.3.</span> <span class="toc-text">Animation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Canvas"><span class="toc-number">8.3.4.</span> <span class="toc-text">Canvas</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SF-Symbol"><span class="toc-number">8.3.5.</span> <span class="toc-text">SF Symbol</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E8%80%85"><span class="toc-number">9.</span> <span class="toc-text">开发者</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Swift%E5%AE%98%E6%96%B9"><span class="toc-number">9.1.</span> <span class="toc-text">Swift官方</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BE%E5%8C%BA"><span class="toc-number">9.2.</span> <span class="toc-text">社区</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A2%E7%B4%A2%E5%BA%93"><span class="toc-number">10.</span> <span class="toc-text">探索库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E9%B2%9C%E4%BA%8B"><span class="toc-number">10.1.</span> <span class="toc-text">新鲜事</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E6%98%93%E7%94%A8%E5%8A%9F%E8%83%BD"><span class="toc-number">10.2.</span> <span class="toc-text">封装易用功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SwiftUI-%E6%89%A9%E5%B1%95"><span class="toc-number">10.3.</span> <span class="toc-text">SwiftUI 扩展</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E7%89%87"><span class="toc-number">10.4.</span> <span class="toc-text">图片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E5%AD%97%E5%A4%84%E7%90%86"><span class="toc-number">10.5.</span> <span class="toc-text">文字处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E7%94%BB-2"><span class="toc-number">10.6.</span> <span class="toc-text">动画</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8"><span class="toc-number">10.7.</span> <span class="toc-text">持久化存储</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E8%8C%83%E5%BC%8F"><span class="toc-number">10.8.</span> <span class="toc-text">编程范式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1"><span class="toc-number">10.9.</span> <span class="toc-text">路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E6%A3%80%E6%9F%A5"><span class="toc-number">10.10.</span> <span class="toc-text">静态检查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E8%83%BD%E5%8A%9B"><span class="toc-number">10.11.</span> <span class="toc-text">系统能力</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3"><span class="toc-number">10.12.</span> <span class="toc-text">接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%BA%94%E7%94%A8"><span class="toc-number">10.13.</span> <span class="toc-text">接口应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#macOS-1"><span class="toc-number">10.14.</span> <span class="toc-text">macOS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8"><span class="toc-number">10.15.</span> <span class="toc-text">应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%B8%E6%88%8F"><span class="toc-number">10.16.</span> <span class="toc-text">游戏</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E6%8A%80%E6%9C%AF%E5%B1%95%E7%A4%BA"><span class="toc-number">10.17.</span> <span class="toc-text">新技术展示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Combine-%E6%89%A9%E5%B1%95"><span class="toc-number">10.18.</span> <span class="toc-text">Combine 扩展</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%9A%E5%90%88"><span class="toc-number">10.19.</span> <span class="toc-text">聚合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E3%80%81%E5%B7%A5%E7%A8%8B%E6%9E%84%E5%BB%BA%E5%8F%8A%E8%87%AA%E5%8A%A8%E5%8C%96"><span class="toc-number">10.20.</span> <span class="toc-text">性能、工程构建及自动化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">10.21.</span> <span class="toc-text">测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C-2"><span class="toc-number">10.22.</span> <span class="toc-text">网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E5%BD%A2"><span class="toc-number">10.23.</span> <span class="toc-text">图形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9F%B3%E8%A7%86%E9%A2%91"><span class="toc-number">10.24.</span> <span class="toc-text">音视频</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8-2"><span class="toc-number">10.25.</span> <span class="toc-text">安全</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Web"><span class="toc-number">10.26.</span> <span class="toc-text">Web</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">10.27.</span> <span class="toc-text">服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F"><span class="toc-number">10.28.</span> <span class="toc-text">系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Web-3-0"><span class="toc-number">10.29.</span> <span class="toc-text">Web 3.0</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Apple"><span class="toc-number">10.30.</span> <span class="toc-text">Apple</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6"><span class="toc-number">10.31.</span> <span class="toc-text">计算机科学</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E7%9F%A5%E8%AF%86"><span class="toc-number">10.32.</span> <span class="toc-text">扩展知识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%85%E5%88%86%E7%B1%BB"><span class="toc-number">10.33.</span> <span class="toc-text">待分类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%9A%E5%AE%A2%E5%92%8C%E8%B5%84%E8%AE%AF"><span class="toc-number">11.</span> <span class="toc-text">博客和资讯</span></a></li></ol>
    </article>
  
  
  <article class="card card-content">
    <div class="recent-posts-card">
  <div class="recent-posts-header">
    <i 
      class="iconfont icon-wenzhang_huaban" 
      style="padding-right: 2px;">
    </i>Recent Posts
  </div>
  <div class="recent-posts-list">
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2022-07-08</div>
        <a href="/2022/07/08/slides-of-use-llvm/"><div class="recent-posts-item-content">使用 LLVM 分享的幻灯片</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2022-06-10</div>
        <a href="/2022/06/10/use-llvm/"><div class="recent-posts-item-content">使用 LLVM</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2022-06-10</div>
        <a href="/2022/06/10/wwdc22-notes/"><div class="recent-posts-item-content">WWDC22 笔记</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2022-03-25</div>
        <a href="/2022/03/25/develop-with-swiftui/"><div class="recent-posts-item-content">在苹果加速器活动做的 SwiftUI 开发分享</div></a>
      </div>
    
  </div>
</div>
  </article>
  
  
</div>
            </aside>
          </div>
        </div>
      </div>
    </div>
     
    <footer class="footer">
  <div class="footer-container">
    <div>
      <div class="footer-dsc">
        <span>
          Copyright ©
          
            2014
          
          
                - 
                2022
          
        </span>
        &nbsp;
        <a 
          href="/" 
          class="footer-link">
          戴铭的博客
        </a>
      </div>
    </div>

    
    
    
      <div class="BbeiAn-info">
        <a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/">鄂ICP备17011999号 </a>
      </div>
      
        <div class="BbeiAn-info">
          <span style="padding-left: 25px;background: url(/img/beian.png) no-repeat left center"></span>
          <a target="_blank" rel="noopener" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=7011999 ">京公网安备 7011999号
          </a>
          <br />
        </div>
      
    
    
      <div class="footer-dsc">
        
          本站总访问量<span id="busuanzi_value_site_pv"></span>次
        
        
          <span>&nbsp;|&nbsp;</span>
        
        
          本站总访客数<span id="busuanzi_value_site_uv"></span>次
        
      </div>
      
    
</footer>
 
    
  <a 
    role="button" 
    id="scrollbutton" 
    class="basebutton" 
    aria-label="回到顶部">
    <i class="iconfont icon-arrowleft button-icon"></i>
  </a>

<a 
  role="button" 
  id="menubutton"
  aria-label="menu button"
  class="basebutton">
  <i class="iconfont icon-menu button-icon"></i>
</a>
<a 
  role="button" 
  id="popbutton" 
  class="basebutton" 
  aria-label="控制中心">
  <i class="iconfont icon-expand button-icon"></i>
</a>
<a 
  role="button" 
  id="darkbutton" 
  class="basebutton darkwidget" 
  aria-label="夜色模式">
  <i class="iconfont icon-weather button-icon"></i>
</a>
<a 
  role="button" 
  id="searchbutton" 
  class="basebutton searchwidget" 
  aria-label="搜索">
  <i class="iconfont icon-search button-icon"></i>
</a> 
     
     
     
      <script>
  var addImgLayout = function () {
    var img = document.querySelectorAll('.post-content img')
    var i
    for (i = 0; i < img.length; i++) {
      var wrapper = document.createElement('a')
      wrapper.setAttribute('href', img[i].getAttribute('data-src'))
      wrapper.setAttribute('aria-label', 'illustration')
      wrapper.style.cssText =
        'width: 100%; display: flex; justify-content: center;'
      if (img[i].alt) wrapper.dataset.caption = img[i].alt
      wrapper.dataset.nolink = true
      img[i].before(wrapper)
      wrapper.append(img[i])
      var divWrap = document.createElement('div')
      divWrap.classList.add('gallery')
      wrapper.before(divWrap)
      divWrap.append(wrapper)
    }
    baguetteBox.run('.gallery')
  }
</script>
<script>
  loadScript(
    "/js/lib/lightbox/baguetteBox.min.js",
    addImgLayout
  )
</script>
 
     
     
    <script src="/js/main.js"></script> 
    
      <script> 
        loadScript('/js/lib/busuanzi.min.js') 
      </script>
     
    
      <script>
        var addLazyload = function () {
          var observer = lozad('.lozad', {
            load: function (el) {
              el.srcset = el.getAttribute('data-src')
            },
            loaded: function (el) {
              el.classList.add('loaded')
            },
          })
          observer.observe()
        }
      </script>
      <script>
        loadScript('/js/lib/lozad.min.js', addLazyload)
      </script>
    
    <script src="//instant.page/5.1.0" type="module"
      integrity="sha384-by67kQnR+pyfy8yWP4kPO12fHKRLHZPfEsiSXR8u2IKcTdxD805MGUXBzVPnkLHw"></script>
    
    
  </body>
</html>
