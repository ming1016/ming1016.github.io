<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>æˆ´é“­çš„åšå®¢ - æ˜Ÿå…‰ç¤¾</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://ming1016.github.io/"/>
  <updated>2022-01-04T03:32:22.932Z</updated>
  <id>http://ming1016.github.io/</id>
  
  <author>
    <name>æˆ´é“­</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>å¦‚ä½•ç”¨ SwiftUI + Combine + Swift Concurrency Aysnc/Await Actor æ¬¢ç•…å¼€å‘</title>
    <link href="http://ming1016.github.io/2022/01/03/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/"/>
    <id>http://ming1016.github.io/2022/01/03/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/</id>
    <published>2022-01-03T03:53:21.000Z</published>
    <updated>2022-01-04T03:32:22.932Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å…ˆè¯´ä¸¤å¥åºŸè¯ï¼ˆDonâ€™t-blame-me-about-my-caculationï¼‰"><a href="#å…ˆè¯´ä¸¤å¥åºŸè¯ï¼ˆDonâ€™t-blame-me-about-my-caculationï¼‰" class="headerlink" title="å…ˆè¯´ä¸¤å¥åºŸè¯ï¼ˆDonâ€™t blame me about my caculationï¼‰"></a>å…ˆè¯´ä¸¤å¥åºŸè¯ï¼ˆDonâ€™t blame me about my caculationï¼‰</h2><p>ä¸ºå•¥å†™è¿™ç¯‡æ–‡ç« ï¼Œç®€å•è¯´ï¼Œè¿™äº›æ—¥å­ä»¥æ¥ï¼Œæ€»è§‰ç€åšäº‹è¿˜æ˜¯ä¸“æ³¨äº›å¥½ï¼Œäºæ˜¯ä¹Ÿé€æ­¥å‡å°‘äº†å¾ˆå¤šä¿¡æ¯æ¶ˆè´¹ï¼Œç¼©å‡äº†äº›æ¬²æœ›å§ã€‚ç›®å‰æ›´åŠ å…³æ³¨æ€ä¹ˆèƒ½å¤Ÿè®©å¼€å‘æ›´å¿«ä¹äº›ï¼Œç›¸ä¿¡æœ‰äº†è¿™ä¸ªæ–¹å‘ï¼Œå…¶ä»–äº‹æƒ…å°±æ›´å®¹æ˜“è§æ‹›æ‹†æ‹›äº†ï¼Œé¢å¯¹çš„æŒ‘æˆ˜ä¹Ÿä¸å†æ˜¯æŒ‘æˆ˜ï¼Œè€Œæ˜¯æ¿€å‘è‡ªå·±æ–—å¿—çš„è¾…åŠ©å·¥å…·ï¼Œå…¶å®ä¸ç”¨åœ¨ä¹é‚£äº›çœ‹ä¼¼æƒå¨çš„åšæ³•å’Œæ‰“æ³•ï¼Œåªè¦æ˜¯æ²¡è®©ä½ å¼€å¿ƒçš„ï¼Œè‚¯å®šæ˜¯æœ‰æ”¹è¿›ç©ºé—´çš„ã€‚æ€è·¯å’Œæ–¹å‘æ‰æ˜¯æœ€é‡è¦çš„ï¼Œæ¯”å¦‚<a href="https://search.douban.com/movie/subject_search?search_text=%E5%A4%A7%E4%BE%A6%E6%8E%A2%E6%B3%A2%E7%BD%97&amp;cat=1002">ã€Šå¤§ä¾¦æ¢æ³¢æ´›ã€‹</a>ï¼Œæ¯æ¬¡ç ´æ¡ˆä¹‹å‰æ³¢æ´›å°±å·²ç»é€šè¿‡åˆ©å®³å…³ç³»æ‰¾å¥½äº†æ–¹å‘ï¼Œä»–çš„æ¨ç†éƒ½æ˜¯åŸºäºè®¤å®šçš„æ–¹å‘å»å¯»æ‰¾ç´ æã€‚ </p>
<p>å¼€å¿ƒä¸æ˜¯å› ä¸ºæ²¡æœ‰æŒ‘æˆ˜ï¼Œæ²¡æœ‰å›°éš¾ï¼Œæ²¡æœ‰ç…ç†¬ï¼Œè€Œæ˜¯å› ä¸ºæ‰¾åˆ°äº†æ–¹å‘ï¼Œè¿™ä¸ªæ–¹å‘å°±æ˜¯ï¼Œå¿«ä¹çš„ Codingï¼Œå¼€å¿ƒçš„å·¥ä½œï¼Œä¸ºäº†è¾¾æˆè¿™ä¸ªç›®æ ‡é‚£äº›è‰°éš¾æŒ‘æˆ˜ä¹Ÿå°±ä¸ç®—ä»€ä¹ˆäº†ã€‚å¯¹äº Codingï¼Œç»è¿‡å®æ“ï¼Œæˆ‘è§‰å¾—å£°æ˜å¼ UI å“åº”å¼ç¼–ç¨‹èŒƒå¼å°±æ˜¯å¾ˆå¥½çš„æå‡å·¥ä½œæ„‰æ‚¦ç¨‹åº¦çš„æ–¹å¼ã€‚ä»£ç åœ¨ GitHub ä¸Šï¼Œé“¾æ¥ï¼š<a href="https://github.com/KwaiAppTeam/SwiftPamphletApp">https://github.com/KwaiAppTeam/SwiftPamphletApp</a> ã€‚åé¢æˆ‘ä¼šè¯¦ç»†è·Ÿä½ è¯´è¯´è¿™ä¸ªåº”ç”¨å¦‚ä½•å¼€å‘çš„åŠç›¸å…³çŸ¥è¯†ç‚¹ï¼Œå¸Œæœ›ä½ ä¹Ÿèƒ½å¤Ÿæ„Ÿå—ä¸‹è¿™ç§ Happy çš„å¼€å‘æ¨¡å¼ã€‚ </p>
<p>è¿™ä¹‹å‰ï¼Œæˆ‘æƒ³å…ˆè¯´ä¸‹ä¸ºä»€ä¹ˆæˆ‘è§‰å¾—å¿«ä¹æ˜¯å¾ˆä»¶é‡è¦çš„äº‹æƒ…ã€‚è¿™æ®µæ—¶é—´ï¼Œæˆ‘æ¥å—äº†å¥½å‡ æ¬¡é‡‡è®¿ï¼Œæœ‰å…³äºå·¥ç¨‹å¸ˆæ–‡åŒ–æ–¹é¢çš„ï¼Œè¿˜æœ‰ã€Šæ—¶å°šCOSMOPOLITANã€‹æ‚å¿—çš„é‡‡è®¿ï¼Œè®°è€…ä¼šé—®åˆ°ä¸€äº›ä»¥å‰çš„äº‹æƒ…ï¼Œåœ¨èŠè¿‡å¾€äº‹æƒ…æ—¶æˆ‘å‘ç°åŸæ¥å¿«ä¹æ‰æ˜¯æ¯å¤©è‡ªå·±å­˜åœ¨ç€çš„æœ€æ ¹æœ¬çš„åŸåŠ¨åŠ›ã€‚ä¸ºäº†èƒ½å¤Ÿè®©è‡ªå·±èƒ½å¤Ÿä¸€ç›´æ´»ç€ï¼Œå°±ä¸è¦åç¦»å¿«ä¹ã€‚æ‘„å½±å¸ˆæ˜¯ä»»æ¬£ç¾½ï¼Œå‚ä¸è¿‡ã€Šä¸€ä»£å®—å¸ˆã€‹çš„æ‹æ‘„ï¼Œè¿˜æ˜¯ã€Šæ—¶å°šèŠ­èã€‹çš„æ¨¡ç‰¹ã€‚ä»¥ä¸‹æ˜¯æ—¶å°š COSMOPOLITAN çš„é‡‡è®¿å†…å®¹ï¼š </p>
<p><img src="/uploads/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/00.jpg" alt=""></p>
<p><img src="/uploads/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/01.jpg" alt=""></p>
<p>å®Œæ•´å†…å®¹è§ï¼š<a href="https://mp.weixin.qq.com/s/b5fj2b65xRv4mhFpftwNcg">https://mp.weixin.qq.com/s/b5fj2b65xRv4mhFpftwNcg</a> </p>
<p>è§†é¢‘å¯è§è¿™æ¡å¾®åšåœ°å€ï¼š<a href="https://weibo.com/1351051897/KEdu5Fi1x?pagetype=profilefeed">https://weibo.com/1351051897/KEdu5Fi1x?pagetype=profilefeed</a> </p>
<p>è§†é¢‘æœ‰å…­åå¤šä¸‡æ’­æ”¾é‡ï¼Œä¸¤ç™¾å¤šè¯„è®ºå’Œä¸€åƒå¤šè½¬å‘ã€‚ </p>
<p><img src="/uploads/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/02.png" alt=""></p>
<p>è¯é¢˜è¿˜ä¸Šäº†å¾®åšçƒ­æœï¼Œæœ‰å…­ç™¾å¤šä¸‡é˜…è¯»å’Œä¸‰åƒå¤šè®¨è®ºã€‚ </p>
<p><img src="/uploads/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/03.png" alt=""></p>
<p>ä½ è‚¯å®šä¼šè§‰å¾—å¾ˆå¥‡æ€ªï¼Œæˆ‘æ€ä¹ˆä¼šæ¥å—æ—¶å°šæ‚å¿—é‡‡è®¿ï¼Œå…¶å®æˆ‘æ—©åœ¨2006å¹´å°±è·Ÿæ—¶å°šå¨±ä¹åœˆæœ‰æŸ“äº†ï¼Œé‚£å¹´å¼ çºªä¸­ç‰ˆã€Šç¥é›•ä¾ ä¾£ã€‹åˆšçƒ­æ’­å®Œï¼Œåˆ˜äº¦è²æ¼”çš„å°é¾™å¥³ï¼Œæˆ‘ç‰¹åˆ«çš„å–œæ¬¢ã€‚æœ‰å¹¸åœ¨ä¸€æ¬¡æ´»åŠ¨ä¸­æˆ‘æˆä¸ºå¥¹çš„å¾¡ç”¨æ‘„å½±å¸ˆï¼Œç”±äºè¿‡äºæ¿€åŠ¨æ‰‹æŠ–ï¼Œæ‹ç³Šäº†å¥½å¤šå¼ ï¼Œè›®å¯æƒœçš„ã€‚ç§å­˜è¿™æ‰¹é‡Œè¿˜æ˜¯æœ‰äº›æ¸…æ™°çš„ï¼Œè¿™äº›ç…§ç‰‡æœ€è¿‘åœ¨æ‰¾èµ„æ–™æ—¶ä¸å°å¿ƒè¢«æˆ‘ç¿»äº†å‡ºæ¥ã€‚æŒ‘å‡ å¼ çœ‹çœ‹åå…­å¹´å‰çš„åˆ˜äº¦è²å’Œæˆ‘æ˜¯ä»€ä¹ˆæ ·çš„å§ã€‚ </p>
<p><img src="/uploads/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/04.jpg" alt=""></p>
<p><img src="/uploads/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/05.jpg" alt=""></p>
<p><img src="/uploads/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/06.jpg" alt=""></p>
<p><img src="/uploads/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/07.jpg" alt=""></p>
<p>æˆ‘è¿˜å¾ˆç”¨å¿ƒçš„ç½®åŠäº†æ–°å®¶ã€‚ä¹Ÿæ˜¯å¸Œæœ›èƒ½å¤Ÿè®©è‡ªå·±èƒ½å¤Ÿå¼€å¿ƒäº›ã€‚ </p>
<p><img src="/uploads/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/08.jpg" alt=""></p>
<p><img src="/uploads/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/09.jpg" alt=""></p>
<p><img src="/uploads/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/10.jpg" alt=""></p>
<p><img src="/uploads/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/11.jpg" alt=""></p>
<p><img src="/uploads/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/12.jpg" alt=""></p>
<p><img src="/uploads/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/30.jpg" alt=""></p>
<p><img src="/uploads/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/13.jpg" alt=""></p>
<p>é‚£ä¹ˆï¼Œæ€æ ·é«˜æ•ˆå¼€å‘ï¼Œå¸¦æ¥æ„‰æ‚¦çš„å‘¢ï¼Ÿ </p>
<h2 id="çœ‹çœ‹åšå‡ºæ¥çš„æ ·å­"><a href="#çœ‹çœ‹åšå‡ºæ¥çš„æ ·å­" class="headerlink" title="çœ‹çœ‹åšå‡ºæ¥çš„æ ·å­"></a>çœ‹çœ‹åšå‡ºæ¥çš„æ ·å­</h2><p>è¿™æ˜¯ä¸ª macOS åº”ç”¨ï¼ˆ<a href="https://github.com/KwaiAppTeam/SwiftPamphletAppï¼‰ã€Šæˆ´é“­çš„">https://github.com/KwaiAppTeam/SwiftPamphletAppï¼‰ã€Šæˆ´é“­çš„</a> Swift å°å†Œå­ã€‹ï¼Œèƒ½å¤Ÿæ–¹ä¾¿çš„æŸ¥çœ‹ Swift è¯­æ³•ï¼Œè¿˜æœ‰ä¸€äº›ä¸»è¦åº“çš„ä½¿ç”¨æŒ‡å—ï¼Œå†…å®¹è¿˜åœ¨å®Œå–„ä¸­ï¼Œé€‰æ‹©çš„åº“ä¸»è¦å°±æ˜¯å¼€å‘å°å†Œå­åº”ç”¨ä½¿ç”¨åˆ°çš„ SwitUIã€Combineã€Swift Concurrencyã€‚å°å†Œå­åº”ç”¨ç›®å‰åœ¨ GitHub ä¸Šå·²æœ‰<a href="https://github.com/KwaiAppTeam/SwiftPamphletApp">ä¸€åƒå¤š Star</a>ï¼ˆæ„Ÿè°¢æœ‰çˆ±ğŸ˜„â¤ï¸ï¼‰ï¼Œæˆä¸ºæˆ‘ç¬¬ä¸‰ä¸ªè¿‡åƒçš„ä»“åº“ï¼Œç°å·²ç§»è‡³<a href="https://github.com/KwaiAppTeam">å¿«æ‰‹ App å›¢é˜Ÿè´¦å·</a>ä¸‹ç»§ç»­è¿­ä»£å®Œå–„ã€‚ </p>
<p><img src="/uploads/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/14.png" alt=""></p>
<p>é™¤äº†è¿™äº›é€ŸæŸ¥å’Œåº“çš„ä½¿ç”¨å†…å®¹å¤–ï¼Œè¿™ä¸ªåº”ç”¨è¿˜æœ‰ä¸€äº›å¼€å‘è€…çš„åŠ¨æ€ï¼Œå½“ä»–ä»¬æœ‰æ–°çš„åŠ¨ä½œï¼Œæ¯”å¦‚æäº¤äº†ä»£ç ã€star äº†ä»€ä¹ˆé¡¹ç›®ï¼Œæäº¤å’Œç•™è¨€äº†è®®é¢˜éƒ½ä¼šç›´æ¥åœ¨ç¨‹åºåä¸­æé†’ä½ ã€‚ </p>
<p><img src="/uploads/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/15.png" alt=""></p>
<p>æˆ‘å¯¹ä¸€äº›åº“åšäº†åˆ†ç±»ï¼Œæ–¹ä¾¿æŒ‰éœ€æŸ¥æ‰¾ï¼Œåº“æœ‰æ–°çš„æäº¤ä¹Ÿä¼šåœ¨ç¨‹åºåä¸­æé†’ã€‚ </p>
<p><img src="/uploads/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/16.png" alt=""></p>
<p>è¿˜èƒ½æ–¹ä¾¿çš„æŸ¥çœ‹åº“çš„è®®é¢˜ã€‚æ¯”å¦‚åœ¨é˜®ä¸€å³°çš„ã€Šç§‘æŠ€çˆ±å¥½è€…å‘¨åˆŠã€‹çš„è®®é¢˜ä¸­å¯ä»¥çœ‹åˆ°æœ‰å¾ˆå¤šäººæ¨èå’Œè‡ªèäº†ä¸€äº›ä¿¡æ¯ã€‚ä¿ç•™è®®é¢˜æœ‰ä¸€åƒå…­ç™¾å¤šä¸ªã€‚ </p>
<p><img src="/uploads/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/17.png" alt=""></p>
<p>è¿™ä¸ªå…ƒæ—¦å‡æœŸï¼Œæˆ‘åˆæ·»åŠ äº†åšå®¢åŠ¨æ€çš„åŠŸèƒ½ï¼Œå¯ä»¥è·Ÿè¿›ä¸€äº›åšå®¢å†…å®¹çš„æ›´æ–°ã€‚ </p>
<p><img src="/uploads/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/18.png" alt=""></p>
<p>ç”±äº Swift è¯­è¨€çš„ç®€æ´ï¼Œè¿™äº›åº“çš„å…ˆè¿›ï¼Œæœ€è¿‘æœ‰åŒå­¦åšå®éªŒï¼Œ5.5ç‰ˆæœ¬è¿˜æœ‰ç˜¦ä½“ç§¯çš„æ•ˆæœã€‚è¿™æ ·çš„ä¸€ä¸ªå°å†Œå­åº”ç”¨ç¨‹åºç´¯ç§¯å¼€å‘çš„æ—¶é—´ä¸å¤šï¼Œå°±æ˜¯å¾ˆé«˜æ•ˆçš„å˜›ã€‚ç‰¹åˆ«æ˜¯æœ€ååšå®¢åŠ¨æ€è¿™ä¸ªåŠŸèƒ½ï¼Œä¸ƒå¹´å‰æˆ‘ç”¨ Objective-C åšçš„ä¸€ä¸ªRSSé˜…è¯»å™¨è€—è´¹äº†æˆ‘ä¸¤ä¸‰å‘¨çš„æ—¶é—´ã€‚åŒæ ·çš„åŠŸèƒ½ç”¨ Swift è¿™å¥—æ¥åšå…ƒæ—¦å‡æœŸä¸¤å¤©å°±å®Œæˆäº†ã€‚å£°æ˜å¼ UI å“åº”å¼èŒƒå¼é…åˆä¸Š Swift ç®€æ´çš„è¯­æ³•çœŸæ˜¯è›® Cool çš„ã€‚ </p>
<h2 id="åŸºç¡€ç½‘ç»œèƒ½åŠ›"><a href="#åŸºç¡€ç½‘ç»œèƒ½åŠ›" class="headerlink" title="åŸºç¡€ç½‘ç»œèƒ½åŠ›"></a>åŸºç¡€ç½‘ç»œèƒ½åŠ›</h2><p>å°å†Œå­åº”ç”¨ä¼šå¤§é‡ä½¿ç”¨ç½‘ç»œï¼Œå…ˆçœ‹çœ‹æ€ä¹ˆç”¨ Swift Concurrency æ¥åšå§ã€‚ </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">RSSReq</span>(<span class="keyword">_</span> <span class="params">urlStr</span>: <span class="type">String</span>)</span> <span class="keyword">async</span> <span class="keyword">throws</span> -&gt; <span class="type">String</span>? &#123;</span><br><span class="line">  <span class="keyword">guard</span> <span class="keyword">let</span> url <span class="operator">=</span> <span class="type">URL</span>(string: urlStr) <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">fatalError</span>(<span class="string">&quot;wrong url&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> req <span class="operator">=</span> <span class="type">URLRequest</span>(url: url)</span><br><span class="line">  <span class="keyword">let</span> (data, res) <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> <span class="type">URLSession</span>.shared.data(for: req)</span><br><span class="line">  <span class="keyword">guard</span> (res <span class="keyword">as?</span> <span class="type">HTTPURLResponse</span>)<span class="operator">?</span>.statusCode <span class="operator">==</span> <span class="number">200</span> <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">fatalError</span>(<span class="string">&quot;wrong data&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> dataStr <span class="operator">=</span> <span class="type">String</span>(data: data, encoding: .utf8)</span><br><span class="line">  <span class="keyword">return</span> dataStr</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šï¼Œé€šè¿‡ url å¯ä»¥è·å–åˆ° data å’Œ responseï¼Œå’Œå…¶ä»–ç½‘ç»œè¯·æ±‚çš„æ–¹å¼ä¸åŒçš„æ˜¯ï¼Œä½¿ç”¨ await åå°±ä¸ç”¨ç¹ççš„ä»£ç†æˆ–é—­åŒ…æ¥è¿›è¡Œåç»­çš„å¤„ç†ï¼Œä»£ç å˜å¾—æ›´å¥½ç†è§£ï¼Œå³å­—é¢æ„æ€ä¸Šçš„ await åæ‰§è¡Œåé¢çš„è¡Œã€‚ä¸¾ä¸ªä¾‹å­ï¼Œè·å–åšå®¢ RSS æ—¶ï¼Œå¦‚æœå¸Œæœ›å¤„ç†å®Œä¸€ä¸ª RSS åå†å¤„ç†åé¢ä¸€ä¸ª RSSï¼Œä½¿ç”¨ await è¯­æ³•çœ‹èµ·æ¥å°±éå¸¸ç®€æ´æ¸…çˆ½æ˜“äºç†è§£äº†ã€‚ </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Task</span> &#123;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> rssFeed <span class="operator">=</span> <span class="type">SPC</span>.rssFeed() <span class="comment">// è·å–æ‰€æœ‰ rss æºçš„æ¨¡å‹</span></span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> rssFeed &#123;</span><br><span class="line">            <span class="keyword">let</span> str <span class="operator">=</span> <span class="keyword">try</span> <span class="keyword">await</span> <span class="type">RSSReq</span>(r.feedLink)</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> str <span class="operator">=</span> str <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">RSSVM</span>.handleFetchFeed(str: str, rssModel: r)</span><br><span class="line">            <span class="comment">// åœ¨ Main Actor æ›´æ–°é€šçŸ¥æ•°</span></span><br><span class="line">            <span class="keyword">await</span> rssUpdateNotis()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šï¼Œå½“å‡ºç°æ•°æ®è·å–é”™è¯¯å°±è·³è¿‡åé¢é€»è¾‘ç›´æ¥å»è¯·æ±‚ä¸‹ä¸ª RSSï¼Œè·å–æˆåŠŸä¼šæ›´æ–° Main Actor å¤„ç†é€šçŸ¥é€»è¾‘ï¼Œä¸åŒé˜Ÿåˆ—ä¹‹é—´åˆ‡æ¢å°±æ˜¯è¿™ä¹ˆè‡ªç„¶ï¼ŒçŸ­çŸ­å‡ è¡Œä»£ç å°±éƒ½è®²æ¸…æ¥šäº†ã€‚ </p>
<p>Combine æ¥å¤„ç†ç½‘ç»œçš„ä¼˜åŠ¿å°±æ˜¯èƒ½å¤Ÿå°†ç½‘ç»œè¯·æ±‚åˆ°æ•°æ®å¤„ç†ï¼Œæœ€ååˆ°æ•°æ®ç»‘å®šéƒ½è´Ÿè´£äº†ã€‚ä¹Ÿå°±æ˜¯å‘å¸ƒè€…ã€æ“ä½œç¬¦å’Œè®¢é˜…è€…çš„ç»„åˆã€‚ä¸‹é¢æˆ‘é€šè¿‡å¼€å‘æŒ‡å—åŠŸèƒ½çš„è¿‡ç¨‹è¯´æ˜ä¸‹ Combine çš„ç”¨æ³•ã€‚ </p>
<h2 id="æ€ä¹ˆå¼€å‘æŒ‡å—åŠŸèƒ½"><a href="#æ€ä¹ˆå¼€å‘æŒ‡å—åŠŸèƒ½" class="headerlink" title="æ€ä¹ˆå¼€å‘æŒ‡å—åŠŸèƒ½"></a>æ€ä¹ˆå¼€å‘æŒ‡å—åŠŸèƒ½</h2><p>æŒ‡å—çš„åˆ—è¡¨ç»“æ„ä½¿ç”¨çš„æ˜¯ JSONï¼Œæˆ‘æŠŠåˆ—è¡¨çš„æ•°æ®ä¿å­˜åœ¨ä»“åº“çš„è®®é¢˜ä¸­ï¼Œé€šè¿‡ GitHub çš„ REST API è·å–è®®é¢˜è¿›è¡Œå±•ç¤ºï¼Œè¿™æ ·å¯¹äºæŒ‡å—åˆ—è¡¨çš„å†…å®¹ä¿®æ”¹ä¸°å¯Œå¯ä»¥é€šè¿‡ç›´æ¥åœ¨è®®é¢˜ä¸­è¿›è¡Œç¼–è¾‘å³å¯ï¼Œæ— éœ€å‡çº§åº”ç”¨ã€‚ </p>
<p>Combine ç½‘ç»œè¯·æ±‚æˆ‘å†™åœ¨ APIRequest.swift æ–‡ä»¶é‡Œï¼Œä¸»è¦ä»£ç å¦‚ä¸‹ï¼š </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">APISev</span>: <span class="title">APISevType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> rootUrl: <span class="type">URL</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">init</span>(<span class="params">rootUrl</span>: <span class="type">URL</span> <span class="operator">=</span> <span class="type">URL</span>(string: <span class="string">&quot;https://api.github.com&quot;</span>)<span class="operator">!</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.rootUrl <span class="operator">=</span> rootUrl</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">response</span>&lt;<span class="type">Request</span>&gt;(<span class="params">from</span> <span class="params">req</span>: <span class="type">Request</span>)</span> -&gt; <span class="type">AnyPublisher</span>&lt;<span class="type">Request</span>.<span class="type">Res</span>, <span class="type">APISevError</span>&gt; <span class="keyword">where</span> <span class="type">Request</span> : <span class="type">APIReqType</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> path <span class="operator">=</span> <span class="type">URL</span>(string: req.path, relativeTo: rootUrl)<span class="operator">!</span></span><br><span class="line">        <span class="keyword">var</span> comp <span class="operator">=</span> <span class="type">URLComponents</span>(url: path, resolvingAgainstBaseURL: <span class="literal">true</span>)<span class="operator">!</span></span><br><span class="line">        comp.queryItems <span class="operator">=</span> req.qItems</span><br><span class="line">        <span class="keyword">var</span> req <span class="operator">=</span> <span class="type">URLRequest</span>(url: comp.url<span class="operator">!</span>)</span><br><span class="line">        req.addValue(<span class="string">&quot;token <span class="subst">\(SPC.gitHubAccessToken)</span>&quot;</span>, forHTTPHeaderField: <span class="string">&quot;Authorization&quot;</span>)</span><br><span class="line">        req.addValue(<span class="string">&quot;SwiftPamphletApp&quot;</span>, forHTTPHeaderField: <span class="string">&quot;User-Agent&quot;</span>)</span><br><span class="line">        <span class="keyword">let</span> de <span class="operator">=</span> <span class="type">JSONDecoder</span>()</span><br><span class="line">        de.keyDecodingStrategy <span class="operator">=</span> .convertFromSnakeCase</span><br><span class="line">        <span class="keyword">let</span> sch <span class="operator">=</span> <span class="type">DispatchQueue</span>(label: <span class="string">&quot;GitHub API Queue&quot;</span>, qos: .default, attributes: .concurrent)</span><br><span class="line">        <span class="keyword">return</span> <span class="type">URLSession</span>.shared.dataTaskPublisher(for: req)</span><br><span class="line">            .retry(<span class="number">3</span>)</span><br><span class="line">            .subscribe(on: sch)</span><br><span class="line">            .receive(on: sch)</span><br><span class="line">            .map &#123; data, res <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">return</span> data</span><br><span class="line">            &#125;</span><br><span class="line">            .mapError &#123; <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">                <span class="type">APISevError</span>.resError</span><br><span class="line">            &#125;</span><br><span class="line">            .decode(type: <span class="type">Request</span>.<span class="type">Res</span>.<span class="keyword">self</span>, decoder: de)</span><br><span class="line">            .mapError &#123; <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">                <span class="type">APISevError</span>.parseError</span><br><span class="line">            &#125;</span><br><span class="line">            .receive(on: <span class="type">RunLoop</span>.main)</span><br><span class="line">            .eraseToAnyPublisher()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šï¼ŒCombine æœ‰ decode çš„æ“ä½œç¬¦ï¼Œèƒ½å¤Ÿç›´æ¥æŒ‡å®š JSON æ¨¡å‹æ•°æ®ç±»å‹å’Œ JSONDecoder å¯¹è±¡ã€‚è¿˜æœ‰é‡è¯•ã€é˜Ÿåˆ—æŒ‡å®šä»¥åŠæŠ›é”™è¯¯çš„æ“ä½œç¬¦ã€‚ </p>
<p>ä¸€ä¸ªåº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œç›¸åŒçš„è¯·æ±‚ä¼šå‘å¸ƒå¾ˆå¤šæ¬¡ï¼Œéœ€è¦å®šä¹‰ä¸€ä¸ªå‘èµ·è¯·æ±‚çš„ Subjectï¼Œè¿˜æœ‰è¯·æ±‚å®Œæˆå“åº”çš„ Subjectã€‚å®šä¹‰å¦‚ä¸‹ï¼š </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">let</span> apCustomIssuesSj <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">Void</span>, <span class="type">Never</span>&gt;()</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">let</span> resCustomIssuesSj <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">IssueModel</span>, <span class="type">Never</span>&gt;()</span><br></pre></td></tr></table></figure>
<p>apCustomIssuesSj ä¼šå‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œä»£ç å¦‚ä¸‹ï¼š </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> resCustomIssuesSm <span class="operator">=</span> apCustomIssuesSj</span><br><span class="line">    .flatMap &#123; [apiSev] <span class="keyword">in</span></span><br><span class="line">        apiSev.response(from: reqCustomIssues)</span><br><span class="line">            .catch &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] error -&gt; <span class="type">Empty</span>&lt;<span class="type">IssueModel</span>, <span class="type">Never</span>&gt; <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">self</span><span class="operator">?</span>.errSj.send(error)</span><br><span class="line">                <span class="keyword">return</span> .<span class="keyword">init</span>()</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    .share()</span><br><span class="line">    .subscribe(resCustomIssuesSj)</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ .catch é‡ŒerrSj å‘å¸ƒè€…å°±æ˜¯åµŒå¥—å‘å¸ƒè€…ï¼Œ.flatMap ä¼šè®©æ¯æ¬¡è¿”å›éƒ½æ˜¯æ–°å‘å¸ƒè€…ã€‚apiSev.response è¿”å›çš„æ˜¯è¢«ç±»å‹æ“¦é™¤åˆ° AnyPublisher ä¸Šï¼Œè¿™æ ·ä¸åŒç±»å‹çš„å‘å¸ƒè€…èƒ½å¤Ÿè¢« .flatMap å¤„ç†ã€‚é—­åŒ…å†…çš„ .catch å¤„ç†èƒ½åŒºåˆ†å‘å¸ƒè€…ï¼Œä»…å¯¹å½“å‰å‘å¸ƒè€…æœ‰æ•ˆï¼Œä¸ä¼šå½±å“åé¢å‘å¸ƒè€…ï¼Œå¯¼è‡´æ•´ä¸ªç®¡é“è¢«å–æ¶ˆã€‚å‘å¸ƒè€…å¤±è´¥ç±»å‹æ˜¯ Neverï¼Œå¤±è´¥æœ¬èº«ä¼šè¢«è¿è´¯çš„å¤„ç†ã€‚ </p>
<p>.flatMap é™¤äº†ä»å®ƒ map å‡½æ•°é‡Œç”Ÿäº§å‘å¸ƒè€…ï¼Œè¿˜æœ‰ä¸ªå¯é€‰å‚æ•° maxPublishersï¼Œé€šè¿‡è¿™ä¸ªå‚æ•°å¯ä»¥é™åˆ¶ä¸€æ¬¡ç”Ÿäº§çš„æœ€å¤§å‘å¸ƒè€…æ•°é‡ï¼Œä¹Ÿå°±æ˜¯ä½ å¯ä»¥é€šè¿‡ .flatMap å¯¹ç®¡é“ä¸Šæ¸¸çš„å‘å¸ƒè€…è¿›è¡Œåå‹ï¼ˆBackpressureï¼‰ï¼ŒmaxPublishers èƒ½æœ‰æ•ˆçš„èŠ‚æµç®¡é“ï¼ŒæŒ‰ç…§ç®¡é“å†…éƒ¨å®é™…ä¸Šçš„å‘å¸ƒé€Ÿåº¦è¿›è¡Œåå‹ï¼Œè¿™ä¸ªä¹Ÿæ˜¯ Combine ç›¸è¾ƒäº RxSwift æ¥è¯´çš„ä¸€ä¸ªä¼˜åŠ¿ã€‚æ¯”å¦‚å½“ç½‘ç»œè¯·æ±‚å¤šæ—¶ï¼Œä½ å¯ä»¥é€šè¿‡è®¾ç½® .max(1) æ¥å‡è½»è¯·æ±‚å¯¹æœåŠ¡çš„å‹åŠ›ï¼ŒåŒæ—¶è¿˜èƒ½å¤Ÿä¿è¯ç»“æœåˆ°è¾¾çš„é¡ºåºå’Œè¯·æ±‚é¡ºåºçš„ä¸€è‡´ã€‚ </p>
<p>resCustomIssuesSj ä¼šå»å¤„ç†ç½‘ç»œè¯·æ±‚æˆåŠŸçš„æ•°æ®ï¼Œæœ€åé€šè¿‡ .assign å°†å¤„ç†çš„æ•°æ®åˆ†é…ç»™éµå¾ª ObservableObject åè®®ç±»çš„ @Published å±æ€§åŒ…è£…çš„å±æ€§ customIssuesï¼Œç”¨äºå“åº”å¼çš„æ›´æ–° SwiftUI å¸ƒå±€æ•°æ®ã€‚å®ç°ä»£ç å¦‚ä¸‹ï¼š </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> repCustomIssuesSm <span class="operator">=</span> resCustomIssuesSj</span><br><span class="line">    .map(&#123; issueModel <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">let</span> str <span class="operator">=</span> issueModel.body<span class="operator">?</span>.base64Decoded() <span class="operator">??</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">let</span> data: <span class="type">Data</span></span><br><span class="line">        data <span class="operator">=</span> str.data(using: <span class="type">String</span>.<span class="type">Encoding</span>.utf8)<span class="operator">!</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> decoder <span class="operator">=</span> <span class="type">JSONDecoder</span>()</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">try</span> decoder.decode([<span class="type">CustomIssuesModel</span>].<span class="keyword">self</span>, from: data)</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> [<span class="type">CustomIssuesModel</span>]()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .assign(to: \.customIssues, on: <span class="keyword">self</span>)</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šï¼Œä½ ä¼šå‘ç°åœ¨ .map ä¸­è¿˜ä¼šå¯¹æ•°æ®è¿›è¡Œ base64 decodeï¼Œè¿™æ˜¯å› ä¸ºæˆ‘åœ¨ä»“åº“è®®é¢˜ä¸­ä¿å­˜çš„æ˜¯ base64 encode çš„æ•°æ®ï¼Œdecode æˆ JSON æ•°æ®å†ç”¨ JSONDecoder è½¬ä¸º [CustomIssuesModel] æ¨¡å‹ æ•°æ®åˆ†é…ç»™ customIssuesã€‚ </p>
<p>ä½¿ç”¨ SwiftUI å†™çš„æŒ‡å—åˆ—è¡¨è§†å›¾ï¼Œä»£ç å¦‚ä¸‹ï¼š </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">IssuesListFromCustomView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="meta">@StateObject</span> <span class="keyword">var</span> vm: <span class="type">IssueVM</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">ForEach</span>(vm.customIssues) &#123; ci <span class="keyword">in</span></span><br><span class="line">                <span class="type">Section</span> &#123;</span><br><span class="line">                    <span class="type">ForEach</span>(ci.issues) &#123; i <span class="keyword">in</span></span><br><span class="line">                        <span class="type">NavigationLink</span> &#123;</span><br><span class="line">                            <span class="type">IssueView</span>(vm: <span class="type">IssueVM</span>(repoName: <span class="type">SPC</span>.pamphletIssueRepoName, issueNumber: i.number))</span><br><span class="line">                        &#125; label: &#123;</span><br><span class="line">                            <span class="type">Text</span>(i.title)</span><br><span class="line">                                .bold()</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; header: &#123;</span><br><span class="line">                    <span class="type">Text</span>(ci.name).font(.title)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .alert(vm.errMsg, isPresented: <span class="variable">$vm</span>.errHint, actions: &#123;&#125;)</span><br><span class="line">        .onAppear &#123;</span><br><span class="line">            vm.doing(.customIssues)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»£ç ä¸­çš„å±æ€§åŒ…è£… @StateObject ä¼šåœ¨å½“å‰è§†å›¾ç”Ÿå‘½å‘¨æœŸä¸­ä¿æŒ vm è¿™ä¸ªå±æ€§çš„æ•°æ®ï¼Œvm éœ€è¦éµå¾ª ObservableObject åè®®ï¼Œå…¶ @Published å‘å¸ƒå±æ€§çš„å€¼ä¼šè¢« SwiftUI è‡ªåŠ¨è¿›è¡Œç®¡ç†ï¼Œå±æ€§ vm çš„å‘å¸ƒå±æ€§æ•°æ®å˜åŒ–æ—¶ä¼šè‡ªåŠ¨è§¦å‘å¸ƒå±€ä¾æ®æ–°æ•°æ®çš„æ›´æ–°ã€‚ </p>
<p>ä¸Šé¢ä»£ç ä¸­çš„ SwiftUI å†™çš„å¸ƒå±€ç•Œé¢æ•ˆæœå¦‚ä¸‹ï¼š </p>
<p><img src="/uploads/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/19.png" alt=""></p>
<p>ç•Œé¢ä¸»ä½“æ˜¯ List è§†å›¾ï¼Œæ ¹æ® List çš„å®šä¹‰ï¼Œè¦æ±‚çš„è¾“å…¥æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„å†…å…ƒç´ éœ€è¦éµå¾ª Identifiableï¼Œæ¯è¡Œçš„è¿”å›æ˜¯è¢« @ViewBuilder æ ‡è®°çš„ Viewã€‚ForEach æ ¹æ®æ•°ç»„ä¸­çš„å…ƒç´ ä¼šåˆ›å»ºèƒ½å¤Ÿé‡å¤ä½¿ç”¨çš„è§†å›¾ï¼Œæ€§èƒ½æ¥è¿‘å¤§å®¶ç†Ÿæ‚‰çš„ UITableViewï¼Œä½†æ˜¯å†™æ³•ä¸Šç®€æ´çš„ä¸è¦å¤ªå¤šï¼ŒçœŸå®å®Œç¾è§£ç—›ç‚¹æ¡ˆä¾‹ï¼ŒğŸ˜„â¤ï¸ã€‚ </p>
<p>æŒ‡å—çš„å†…å®¹ä¹Ÿä¼šä»¥ markdown æ ¼å¼å­˜åœ¨è®®é¢˜ä¸­ï¼Œé€šè¿‡è°ƒç”¨ GitHub API çš„æ¥å£è¿›è¡ŒæŒ‡å—å†…å®¹çš„è¯»å–ã€‚ä¸€ä¸ªæ¥å£æ˜¯è®®é¢˜æ¥å£ï¼Œè¯·æ±‚ç»“æ„ä½“å®šä¹‰å¦‚ä¸‹ï¼š </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">IssueRequest</span>: <span class="title">APIReqType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">Res</span> <span class="operator">=</span> <span class="type">IssueModel</span></span><br><span class="line">    <span class="keyword">var</span> repoName: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> issueNumber: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> path: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;/repos/<span class="subst">\(repoName)</span>/issues/<span class="subst">\(issueNumber)</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> qItems: [<span class="type">URLQueryItem</span>]<span class="operator">?</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦ä¸€ä¸ªæ˜¯è®®é¢˜ç•™è¨€çš„æ¥å£ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">IssueRequest</span>: <span class="title">APIReqType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">Res</span> <span class="operator">=</span> <span class="type">IssueModel</span></span><br><span class="line">    <span class="keyword">var</span> repoName: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> issueNumber: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> path: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;/repos/<span class="subst">\(repoName)</span>/issues/<span class="subst">\(issueNumber)</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> qItems: [<span class="type">URLQueryItem</span>]<span class="operator">?</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®ç°æ•ˆæœå¦‚ä¸‹å›¾ï¼š </p>
<p><img src="/uploads/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/20.png" alt=""></p>
<p>æŒ‡å—å†…å®¹æ”¾åœ¨è®®é¢˜ä¸­ï¼Œä¹Ÿæ˜¯å¸Œæœ›èƒ½å¤Ÿé€šè¿‡è®®é¢˜ç•™è¨€åŠŸèƒ½ï¼Œè®©åé¦ˆå’Œå¤§å®¶ç»éªŒçš„è¡¥å……è¢«æ›´å¤šäººçœ‹åˆ°ã€‚ </p>
<p>é™¤äº†è¯­æ³•é€ŸæŸ¥çš„å†…å®¹ï¼Œå…³äº Swift çš„ä¸€äº›ç‰¹æ€§ï¼Œä¸“é¢˜ï¼Œè¿˜æœ‰ Combineã€Concurrencyã€SwiftUI è¿™äº›åº“çš„ä½¿ç”¨æŒ‡å—å†…å®¹éƒ½æ˜¯é‡‡ç”¨çš„ GitHub API æ¥å£è¯»å–è®®é¢˜æ–¹å¼è·å–çš„ã€‚ </p>
<p>è¯»å–è®®é¢˜æ¥å£è·å–æŒ‡å—åˆ—è¡¨çš„æ¨¡å¼ï¼Œä¹Ÿç”¨åœ¨äº†å¼€å‘è€…å’Œä»“åº“åŠ¨æ€åˆ—è¡¨ä¸­ã€‚æ¥ä¸‹æ¥æˆ‘è·Ÿä½ è¯´ä¸‹å¼€å‘è€…å’Œä»“åº“åŠ¨æ€æ€ä¹ˆå¼€å‘çš„å§ã€‚ </p>
<h2 id="å¼€å‘è€…å’Œä»“åº“åŠ¨æ€"><a href="#å¼€å‘è€…å’Œä»“åº“åŠ¨æ€" class="headerlink" title="å¼€å‘è€…å’Œä»“åº“åŠ¨æ€"></a>å¼€å‘è€…å’Œä»“åº“åŠ¨æ€</h2><p>æ˜¾ç¤ºå¼€å‘è€…ä¿¡æ¯çš„é¡µé¢ä»£ç åœ¨ UserView.swift é‡Œï¼Œå¼€å‘è€…ä»‹ç»ä¿¡æ¯é¡µé¢å¦‚ä¸‹ï¼š </p>
<p><img src="/uploads/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/21.png" alt=""></p>
<p>ç•Œé¢ä¸­çš„æ•°æ®éƒ½æ¥è‡ª /users/(userName) æ¥å£ï¼Œè·å–æ•°æ®é€»è¾‘åœ¨ UserVM.swift é‡Œã€‚æ•°æ®å¤šï¼Œä½†æƒ…å†µä¸å¤æ‚ï¼Œå¸ƒå±€ä¸Šåªè¦æ³¨æ„è¿›è¡Œæ•°æ®æ˜¯å¦æœ‰çš„åŒºåˆ†å³å¯ï¼Œå¸ƒå±€ä»£ç å¦‚ä¸‹ï¼š </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">HStack</span> &#123;</span><br><span class="line">    <span class="type">VStack</span>(alignment: .leading, spacing: <span class="number">10</span>) &#123;</span><br><span class="line">        <span class="type">HStack</span>() &#123;</span><br><span class="line">            <span class="type">AsyncImageWithPlaceholder</span>(size: .normalSize, url: vm.user.avatarUrl)</span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading, spacing: <span class="number">5</span>) &#123;</span><br><span class="line">                <span class="type">HStack</span> &#123;</span><br><span class="line">                    <span class="type">Text</span>(vm.user.name <span class="operator">??</span> vm.user.login).font(.system(.title))</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;(<span class="subst">\(vm.user.login)</span>)&quot;</span>)</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;è®¢é˜…è€… <span class="subst">\(vm.user.followers)</span> äººï¼Œä»“åº“ <span class="subst">\(vm.user.publicRepos)</span> ä¸ª&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">HStack</span> &#123;</span><br><span class="line">                    <span class="type">ButtonGoGitHubWeb</span>(url: vm.user.htmlUrl, text: <span class="string">&quot;åœ¨ GitHub ä¸Šè®¿é—®&quot;</span>)</span><br><span class="line">                    <span class="keyword">if</span> vm.user.location <span class="operator">!=</span> <span class="literal">nil</span> &#123;</span><br><span class="line">                        <span class="type">Text</span>(<span class="string">&quot;å±…ä½ï¼š<span class="subst">\(vm.user.location <span class="operator">??</span> <span class="string">&quot;&quot;</span>)</span>&quot;</span>).font(.system(.subheadline))</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="comment">// end VStack</span></span><br><span class="line">        &#125; <span class="comment">// end HStack</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> vm.user.bio <span class="operator">!=</span> <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;ç®€ä»‹ï¼š<span class="subst">\(vm.user.bio <span class="operator">??</span> <span class="string">&quot;&quot;</span>)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> vm.user.blog <span class="operator">!=</span> <span class="literal">nil</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> <span class="operator">!</span>vm.user.blog<span class="operator">!</span>.isEmpty &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;åšå®¢ï¼š<span class="subst">\(vm.user.blog <span class="operator">??</span> <span class="string">&quot;&quot;</span>)</span>&quot;</span>)</span><br><span class="line">                    <span class="type">ButtonGoGitHubWeb</span>(url: vm.user.blog <span class="operator">??</span> <span class="string">&quot;&quot;</span>, text: <span class="string">&quot;è®¿é—®&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> vm.user.twitterUsername <span class="operator">!=</span> <span class="literal">nil</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Twitterï¼š&quot;</span>)</span><br><span class="line">                <span class="type">ButtonGoGitHubWeb</span>(url: <span class="string">&quot;https://twitter.com/<span class="subst">\(vm.user.twitterUsername <span class="operator">??</span> <span class="string">&quot;&quot;</span>)</span>&quot;</span>, text: <span class="string">&quot;@<span class="subst">\(vm.user.twitterUsername <span class="operator">??</span> <span class="string">&quot;&quot;</span>)</span>&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="comment">// end HStack</span></span><br><span class="line">    &#125; <span class="comment">// end VStack</span></span><br><span class="line">    <span class="type">Spacer</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äºæ•°æ®æ˜¯å¦å­˜åœ¨ï¼ŒSwiftUI æ˜¯å¯ä»¥ä½¿ç”¨ if æ¥è¿›è¡Œåˆ¤æ–­æ˜¯å¦å±•ç¤ºè§†å›¾çš„ï¼Œè¿™ä¸ªæ¡ä»¶åˆ¤æ–­ä¹Ÿä¼šå­˜åœ¨äºæ•´ä¸ªè§†å›¾ç»“æ„ç±»å‹ä¸­è¢«ç¼–è¯‘ç”Ÿæˆï¼Œå› æ­¤æ›´å¥½çš„æ–¹å¼æ˜¯å°†æ•°æ®åˆ¤æ–­æ”¾åˆ° ViewModifier ä¸­ï¼Œå› ä¸º ViewModifier å¤„ç†æ—¶æœºæ˜¯åœ¨è¿è¡Œæ—¶ï¼Œå¯ä»¥å‡å°‘å¸ƒå±€åˆå§‹åˆ›å»ºé€»è¾‘è¿ç®—ã€‚ </p>
<p>å¼€å‘è€…çš„äº‹ä»¶å’Œæ¥å—äº‹ä»¶éƒ¨åˆ†çš„æ•°æ®å°±æ¯”ä»‹ç»éƒ¨åˆ†å¤æ‚äº›ï¼Œä½¿å¾—ç•Œé¢å˜åŒ–ä¹Ÿå¤šäº›ï¼Œäº‹ä»¶æ¥å£æ˜¯ /users/(userName)/eventsï¼Œæ¥å—äº‹ä»¶æ¥å£æ˜¯ /users/(userName)/received_events ã€‚æ•°æ®çš„å¤æ‚ä½“ç°åœ¨ç±»å‹ä¸Šï¼Œç±»å‹ç§ç±»è¾ƒå¤šï¼Œæˆ‘é‡‡ç”¨çš„æ˜¯ç›´æ¥å¤„ç† payload é‡Œçš„å­—æ®µï¼Œå¦‚æœå…¶ issue.number å­—æ®µä¸ä¸ºç©ºï¼Œé‚£ä¹ˆå°±è¡¨ç¤ºè¿™ä¸ªå¼€å‘è€…äº‹ä»¶æ˜¯å’Œè®®é¢˜ç›¸å…³ï¼Œä¼šæ˜¾ç¤º issue.title æ ‡é¢˜ï¼Œæœ‰å†…å®¹çš„è¯ï¼Œä¹Ÿå°±æ˜¯ issue.body ä¸ä¸ºç©ºï¼Œç»§ç»­æ˜¾ç¤ºè®®é¢˜çš„å†…å®¹ã€‚å¦‚æœå­—æ®µæ˜¯ commentï¼Œå°±è¡¨ç¤ºäº‹ä»¶æ˜¯è®®é¢˜çš„ç•™è¨€ã€‚å¦‚æœå­—æ®µæ˜¯ commitsï¼Œè¡¨ç¤ºéœ€è¦åˆ—å‡ºè¿™ä¸ªäº‹ä»¶ä¸­æ‰€æœ‰çš„ commit æäº¤åŠæ ‡é¢˜å’Œæè¿°ã€‚pullRequest å­—æ®µä¸ä¸ºç©ºå°±æ˜¾ç¤ºè¿™ä¸ª PR çš„æ ‡é¢˜å’Œå†…å®¹æè¿°ã€‚å­—æ®µå¤„ç†é€»è¾‘ä»£ç å®ç°å¦‚ä¸‹ï¼š </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> event.payload.issue<span class="operator">?</span>.number <span class="operator">!=</span> <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> event.payload.issue<span class="operator">?</span>.title <span class="operator">!=</span> <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(event.payload.issue<span class="operator">?</span>.title <span class="operator">??</span> <span class="string">&quot;&quot;</span>).bold()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> event.payload.issue<span class="operator">?</span>.body <span class="operator">!=</span> <span class="literal">nil</span> <span class="operator">&amp;&amp;</span> event.type <span class="operator">!=</span> <span class="string">&quot;IssueCommentEvent&quot;</span> &#123;</span><br><span class="line">        <span class="type">Markdown</span>(<span class="type">Document</span>(event.payload.issue<span class="operator">?</span>.body <span class="operator">??</span> <span class="string">&quot;&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> event.type <span class="operator">==</span> <span class="string">&quot;IssueCommentEvent&quot;</span> <span class="operator">&amp;&amp;</span> event.payload.comment<span class="operator">?</span>.body <span class="operator">!=</span> <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="type">Markdown</span>(<span class="type">Document</span>(event.payload.comment<span class="operator">?</span>.body <span class="operator">??</span> <span class="string">&quot;&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> event.payload.commits <span class="operator">!=</span> <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="type">ListCommits</span>(event: event)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> event.payload.pullRequest <span class="operator">!=</span> <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> event.payload.pullRequest<span class="operator">?</span>.title <span class="operator">!=</span> <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(event.payload.pullRequest<span class="operator">?</span>.title <span class="operator">??</span> <span class="string">&quot;&quot;</span>).bold()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> event.payload.pullRequest<span class="operator">?</span>.body <span class="operator">!=</span> <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="type">Markdown</span>(<span class="type">Document</span>(event.payload.pullRequest<span class="operator">?</span>.body <span class="operator">??</span> <span class="string">&quot;&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> event.payload.description <span class="operator">!=</span> <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="type">Markdown</span>(<span class="type">Document</span>(event.payload.description <span class="operator">??</span> <span class="string">&quot;&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œå¯¹äºä¸å®šæ•°é‡çš„ commit è§†å›¾å†™åœ¨äº†ä¸€ä¸ªå•ç‹¬çš„ ListCommits è§†å›¾ä¸­ã€‚åªè¦æ˜¯éµå¾ªäº† View åè®®ï¼Œå°±å¯ä»¥ä½œä¸ºè‡ªå®šä¹‰è§†å›¾åœ¨å…¶ä»–è§†å›¾ä¸­ç›´æ¥ä½¿ç”¨ã€‚ListCommits ä»£ç å¦‚ä¸‹ï¼š </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ListCommits</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> event: <span class="type">EventModel</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ForEach</span>(event.payload.commits <span class="operator">??</span> [<span class="type">PayloadCommitModel</span>](), id: \.<span class="keyword">self</span>) &#123; c <span class="keyword">in</span></span><br><span class="line">            <span class="type">ButtonGoGitHubWeb</span>(url: <span class="string">&quot;https://github.com/<span class="subst">\(event.repo.name)</span>/commit/<span class="subst">\(c.sha <span class="operator">??</span> <span class="string">&quot;&quot;</span>)</span>&quot;</span>, text: <span class="string">&quot;æäº¤&quot;</span>)</span><br><span class="line">            <span class="type">Text</span>(c.message <span class="operator">??</span> <span class="string">&quot;&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç ä½ ä¼šå‘ç°ä¸€ä¸ª ButtonGoGitHubWebçš„è§†å›¾ï¼Œè¿›å…¥çœ‹ä¼šå‘ç°ç”¨åˆ°äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„ ButtonStyleï¼š </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.buttonStyle(<span class="type">FixAwfulPerformanceStyle</span>())</span><br></pre></td></tr></table></figure>
<p>FixAwfulPerformanceStyle() çš„å®ç°å¦‚ä¸‹ï¼š </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// åˆ—è¡¨åŠ æŒ‰é’®æ€§èƒ½é—®é¢˜ï¼Œéœ€è§‚å¯Ÿå®˜æ–¹åé¢æ˜¯å¦è§£å†³</span></span><br><span class="line"><span class="comment">/// https://twitter.com/fcbunn/status/1259078251340800000</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">FixAwfulPerformanceStyle</span>: <span class="title">ButtonStyle</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeBody</span>(<span class="params">configuration</span>: <span class="keyword">Self</span>.<span class="type">Configuration</span>)</span> -&gt; <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        configuration.label</span><br><span class="line">            .font(.body)</span><br><span class="line">            .padding(<span class="type">EdgeInsets</span>.<span class="keyword">init</span>(top: <span class="number">2</span>, leading: <span class="number">6</span>, bottom: <span class="number">2</span>, trailing: <span class="number">6</span>))</span><br><span class="line">            .foregroundColor(configuration.isPressed <span class="operator">?</span> <span class="type">Color</span>(nsColor: <span class="type">NSColor</span>.selectedControlTextColor) : <span class="type">Color</span>(nsColor: <span class="type">NSColor</span>.controlTextColor))</span><br><span class="line">            .background(configuration.isPressed <span class="operator">?</span> <span class="type">Color</span>(nsColor: <span class="type">NSColor</span>.selectedControlColor) : <span class="type">Color</span>(nsColor: <span class="type">NSColor</span>.controlBackgroundColor))</span><br><span class="line">            .overlay(<span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">6.0</span>).stroke(<span class="type">Color</span>(nsColor: <span class="type">NSColor</span>.lightGray), lineWidth: <span class="number">0.5</span>))</span><br><span class="line">            .clipShape(<span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">6.0</span>))</span><br><span class="line">            .shadow(color: <span class="type">Color</span>.gray, radius: <span class="number">0.5</span>, x: <span class="number">0</span>, y: <span class="number">0.5</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯ç¤¾åŒº <a href="https://github.com/Kam-To">@Kam-To</a> æçš„ä¸€ä¸ª <a href="https://github.com/KwaiAppTeam/SwiftPamphletApp/pull/104">PR</a>ï¼Œæ˜¯è§£çš„ macOS ä¸Šçš„ä¸€ä¸ªæ€§èƒ½é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯åœ¨ List ä¸­ç›´æ¥ä½¿ç”¨ Buttonï¼Œåœ¨åˆ—è¡¨å¿«é€Ÿæ»šåŠ¨æ—¶ï¼Œæµç•…åº¦ä¼šæœ‰æŸä¼¤ï¼ŒåŠ ä¸Šä¸Šé¢çš„ ButtonStyle ä»£ç å°±å¥½äº†ã€‚ </p>
<p><img src="/uploads/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/22.png" alt=""></p>
<p>åŸæ¨è§ <a href="https://twitter.com/fcbunn/status/1259078251340800000">https://twitter.com/fcbunn/status/1259078251340800000</a>ã€‚ </p>
<p>å¼€å‘è€…æ¥å—äº‹ä»¶å’Œäº‹ä»¶ç±»ä¼¼ï¼Œåªæ˜¯ä¼šå¤šæ˜¾ç¤ºäº‹ä»¶çš„ actor å­—æ®µå†…å®¹ï¼Œè¡¨æ˜å¼€å‘è€…æ¥å—çš„æ˜¯è°å‘å‡ºçš„äº‹ä»¶ã€‚äº‹ä»¶ç•Œé¢å¦‚ä¸‹æ‰€ç¤ºï¼š </p>
<p><img src="/uploads/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/23.png" alt=""></p>
<p>ä»“åº“æ•´ä½“å¤„ç†å’Œå¼€å‘è€…ç±»ä¼¼ï¼Œåªæ˜¯å¤šäº†è®®é¢˜å’Œ README å†…å®¹ï¼Œæ•°æ®å¤æ‚åº¦æ¯”å¼€å‘è€…è¦ä½ã€‚æ¥ä¸‹æ¥æˆ‘è¦è·Ÿä½ è¯´çš„æ˜¯å¦‚æœå¼€å‘è€…æˆ–ä»“åº“æœ‰æ–°çš„æäº¤ï¼Œæ€ä¹ˆèƒ½å¤Ÿè·å–åˆ°ï¼Œå¹¶æç¤ºæœ‰æ›´æ–°ã€‚ </p>
<h2 id="åŠ¨æ€æœ‰æ›´æ–°ï¼Œæ€ä¹ˆæé†’çš„"><a href="#åŠ¨æ€æœ‰æ›´æ–°ï¼Œæ€ä¹ˆæé†’çš„" class="headerlink" title="åŠ¨æ€æœ‰æ›´æ–°ï¼Œæ€ä¹ˆæé†’çš„"></a>åŠ¨æ€æœ‰æ›´æ–°ï¼Œæ€ä¹ˆæé†’çš„</h2><p>æˆ‘çš„æ€è·¯æ˜¯é€šè¿‡æœ¬åœ°å®šæ—¶å™¨ï¼Œå®šæœŸè·å–æ•°æ®ï¼Œæœ¬åœ°è®°å½•ä¸Šæ¬¡æµè§ˆçš„ä½ç½®ï¼Œé€šè¿‡å¯¹æ¯”ï¼Œçœ‹æœ‰å¤šå°‘æ–°çš„åŠ¨æ€æ²¡æœ‰æŸ¥çœ‹ï¼Œå¹¶é€šè¿‡ .badge è¿™ä¸ª ViewModifier å’Œ NSApp.dockTile.badgeLabel æ¥è¿›è¡Œç«¯å†…ç«¯å¤–çš„æé†’ã€‚ </p>
<h3 id="å®šæ—¶å™¨"><a href="#å®šæ—¶å™¨" class="headerlink" title="å®šæ—¶å™¨"></a>å®šæ—¶å™¨</h3><p>åœ¨ SwiftUI ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Combine çš„ Timer.publish å‘å¸ƒå™¨æ¥è®¾ç½®ä¸€ä¸ªå®šæ—¶å±æ€§ï¼ŒTimer.publish æŒ‡å®šå¥½æ—¶é—´å‘¨æœŸå’Œé˜Ÿåˆ—æ¨¡å¼ç­‰å‚æ•°ã€‚æ¯”å¦‚è®¾ç½®ä¸€ä¸ªå¼€å‘è€…åŠ¨æ€å®šæ—¶å™¨å±æ€§ï¼Œä»£ç å¦‚ä¸‹ï¼š </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> timerForRepos <span class="operator">=</span> <span class="type">Timer</span>.publish(every: <span class="type">SPC</span>.timerForReposSec, on: .main, in: .common).autoconnect()</span><br></pre></td></tr></table></figure>
<p>ç„¶åå†åœ¨ .onReceive ä¸­æ‰§è¡Œç½‘ç»œæ•°æ®è·å–æ“ä½œï¼Œå°±å¯ä»¥å®šæ—¶è·å–æ•°æ®äº†ã€‚ </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.onReceive(timerForRepos, perform: &#123; time <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> repoName <span class="operator">=</span> appVM.timeForReposEvent() &#123;</span><br><span class="line">        <span class="keyword">let</span> vm <span class="operator">=</span> <span class="type">RepoVM</span>(repoName: repoName)</span><br><span class="line">        vm.doing(.notiRepo)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>è·å–åˆ°çš„æ•°æ®ä¼šè·Ÿæœ¬åœ°å·²ç»å­˜å‚¨çš„æ•°æ®è¿›è¡Œå¯¹æ¯”ã€‚ </p>
<h3 id="æœ¬åœ°å­˜å‚¨"><a href="#æœ¬åœ°å­˜å‚¨" class="headerlink" title="æœ¬åœ°å­˜å‚¨"></a>æœ¬åœ°å­˜å‚¨</h3><p>æœ¬åœ°æ•°æ®å­˜å‚¨ï¼Œæˆ‘ç”¨çš„æ˜¯ SQLite.swiftï¼Œè¿™ä¸ªåº“æ˜¯ä½¿ç”¨ Swift å¯¹ SQLite åšäº†ä¸€å±‚å°è£…ï¼Œä½¿ç”¨å¾ˆç®€ä¾¿ï¼Œåœ¨ DBHandler.swift é‡Œæœ‰æ•°æ®åº“åˆå§‹åŒ–å’Œè¡¨çš„åˆ›å»ºç›¸å…³ä»£ç ï¼ŒDBDevNoti.swift ä¸­çš„ DevsNotiDataHelper æœ‰å¯¹æ•°æ®æ“ä½œçš„ä»£ç ï¼ŒDBDevNoti å®šä¹‰äº†æ•°æ®è¡¨çš„ç»“æ„ã€‚å¦‚ä½•ä½¿ç”¨å¯ä»¥å‚è€ƒ SQLite.swift å®˜æ–¹çš„<a href="https://github.com/stephencelis/SQLite.swift/blob/master/Documentation/Index.md">æŒ‡å—</a>ï¼Œé‡Œé¢è®²å¾—éå¸¸è¯¦ç»†æ¸…æ¥šã€‚ </p>
<p>ç”¨ DB Browser for SQLite åº”ç”¨å¯ä»¥æŸ¥çœ‹æœ¬åœ°çš„æ•°æ®åº“ã€‚ä¸‹é¢æ˜¯ç”¨å®ƒæŸ¥çœ‹è®°å½•çš„ RSS çš„æ•°æ®ï¼Œå¦‚å›¾ï¼š</p>
<p><img src="/uploads/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/29.png" alt=""></p>
<p>æ›´æ–°æœªè¯»æ•°çš„åˆ¤æ–­é€»è¾‘ï¼Œæˆ‘å°åˆ°äº†ä¸€ä¸ªå‡½æ•°é‡Œï¼Œä»£ç å¦‚ä¸‹ï¼š </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">updateDBDevsInfo</span>(<span class="params">ems</span>: [<span class="type">EventModel</span>])</span> &#123;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> f <span class="operator">=</span> <span class="keyword">try</span> <span class="type">DevsNotiDataHelper</span>.find(sLogin: userName) &#123;</span><br><span class="line">            <span class="keyword">var</span> i <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">            <span class="keyword">var</span> lrid <span class="operator">=</span> f.lastReadId</span><br><span class="line">            <span class="keyword">for</span> em <span class="keyword">in</span> ems &#123;</span><br><span class="line">                <span class="keyword">if</span> i <span class="operator">==</span> <span class="number">0</span> &#123;</span><br><span class="line">                    lrid <span class="operator">=</span> em.id</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> em.id <span class="operator">==</span> f.lastReadId &#123;</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                &#125;</span><br><span class="line">                i <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">            i <span class="operator">=</span> f.unRead <span class="operator">+</span> i</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> <span class="keyword">_</span> <span class="operator">=</span> <span class="keyword">try</span> <span class="type">DevsNotiDataHelper</span>.update(i: <span class="type">DBDevNoti</span>(login: userName, lastReadId: lrid, unRead: i))</span><br><span class="line">            &#125; <span class="keyword">catch</span> &#123;&#125;</span><br><span class="line">        &#125; <span class="comment">// end if let f</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;&#125;</span><br><span class="line">&#125; <span class="comment">// end func updateDBDevsInfo</span></span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šé¢ä»£ç æ‰€ç¤ºï¼Œå…¥å‚ ems æ˜¯è·å–åˆ°çš„æœ€æ–°æ•°æ®ï¼Œå…ˆä»æœ¬åœ°æ•°æ®åº“ä¸­å–åˆ°ä¸Šæ¬¡æœ€æ–°çš„é˜…è¯»ç¼–å· lastReadIdï¼Œè¿­ä»£ emsï¼Œå¦‚æœç¬¬ä¸€ä¸ª ems çš„ç¼–å·å°±å’Œæœ¬åœ°æ•°æ®åº“ lastReadId ä¸€æ ·ï¼Œé‚£è¡¨ç¤ºæ— æ–°åŠ¨æ€ï¼Œå¦‚æœæ²¡æœ‰å°±å¼€å§‹è®¡æ•°ï¼Œç›´åˆ°æ‰¾åˆ°ç›¸ç­‰çš„ lastReadId ä½ç½®ï¼Œè®°äº†å¤šå°‘æ•°å°±è¡¨ç¤ºæœ‰å¤šå°‘æ–°åŠ¨æ€ã€‚ </p>
<h3 id="æé†’"><a href="#æé†’" class="headerlink" title="æé†’"></a>æé†’</h3><p>åˆ—è¡¨ã€Sidebar è¿˜æœ‰ macOS ç³»ç»Ÿçš„ Dock ä¸Šéƒ½å¯ä»¥æ˜¾ç¤ºæ–°çŠ¶æ€æ•°çš„æé†’ã€‚åˆ—è¡¨å’Œ Sidebar ç›´æ¥ä½¿ç”¨ .badge ViewModifier å°±å¯ä»¥å±•ç¤ºæœªè¯»æ•°äº†ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š </p>
<p><img src="/uploads/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/24.png" alt=""></p>
<p>Dock æ æç¤ºè®¾ç½®éœ€è¦ç”¨åˆ°ç³»ç»Ÿçš„ NSAppï¼Œä»£ç å¦‚ä¸‹ï¼š </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">NSApp</span>.dockTile.showsApplicationBadge <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line"><span class="type">NSApp</span>.dockTile.badgeLabel <span class="operator">=</span> <span class="string">&quot;<span class="subst">\(count)</span>&quot;</span></span><br></pre></td></tr></table></figure>
<p><img src="/uploads/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/28.png" alt=""></p>
<p>å°å†Œå­é‡Œè¿˜å¯ä»¥æŸ¥çœ‹ Swift ç¤¾åŒºé‡Œåšä¸»ä»¬åšå®¢æ›´æ–°åŠ¨æ€ã€‚æˆ‘æ¥ç€è·Ÿä½ è¯´è¯´æˆ‘æ€ä¹ˆåšçš„ã€‚ </p>
<h2 id="åšå®¢-RSS-æ›´æ–°åŠ¨æ€"><a href="#åšå®¢-RSS-æ›´æ–°åŠ¨æ€" class="headerlink" title="åšå®¢ RSS æ›´æ–°åŠ¨æ€"></a>åšå®¢ RSS æ›´æ–°åŠ¨æ€</h2><p>åšå®¢ RSS çš„æ•°æ®è·å–æˆ‘åœ¨å‰é¢åŸºç¡€ç½‘ç»œèƒ½åŠ›ä¸­å·²ç»è¯´äº†ã€‚æ‰€æœ‰è§£æé€»è¾‘æˆ‘éƒ½å†™åœ¨äº†å·¥ç¨‹ RSSReader/Parser/ ç›®å½•ä¸‹çš„ ParseStandXMLTagTokens.swiftã€ParseStandXMLTags.swiftã€ParseStandXML.swift ä¸‰ä¸ªæ–‡ä»¶ä¸­ï¼Œå®ç°æ€è·¯æˆ‘åœ¨å…ˆå‰<a href="https://ming1016.github.io/2019/12/07/how-to-analyze-startup-time-cost-in-ios/">ã€Šå¦‚ä½•å¯¹ iOS å¯åŠ¨é˜¶æ®µè€—æ—¶è¿›è¡Œåˆ†æã€‹</a>æ–‡ç« çš„â€œä¼˜åŒ–åå¦‚ä½•ä¿æŒï¼Ÿâ€ç« èŠ‚æœ‰è¯¦ç»†è¯´æ˜ã€‚ </p>
<p>æ ¹æ® RSS çš„ XML ç»“æ„ï¼Œå®šä¹‰ Model ç»“æ„å¦‚ä¸‹ï¼š </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">RSSModel</span>: <span class="title">Identifiable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> id <span class="operator">=</span> <span class="type">UUID</span>()</span><br><span class="line">    <span class="keyword">var</span> title <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">var</span> description <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">var</span> feedLink <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">var</span> siteLink <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">var</span> language <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">var</span> lastBuildDate <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">var</span> pubDate <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">var</span> items <span class="operator">=</span> [<span class="type">RSSItemModel</span>]()</span><br><span class="line">    <span class="keyword">var</span> unReadCount <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">RSSItemModel</span>: <span class="title">Identifiable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> id <span class="operator">=</span> <span class="type">UUID</span>()</span><br><span class="line">    <span class="keyword">var</span> guid <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">var</span> title <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">var</span> description <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">var</span> link <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">var</span> pubDate <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">var</span> content <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">var</span> isRead <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ ¹æ®è¿™ä¸ªç»“æ„ï¼Œä¹Ÿä¼šåœ¨æœ¬åœ°æ•°æ®åº“è®¾è®¡å¯¹åº”çš„ä¸¤ä¸ªè¡¨ï¼Œä¸¤ä¸ªè¡¨çš„å¢åˆ æ”¹ä»£ç åˆ†åˆ«åœ¨ DBRSSFeed.swift å’Œ DBRSSItems.swift é‡Œã€‚è¡¨çš„ç»“æ„å’Œ Model çš„ç»“æ„åŸºæœ¬ä¸€è‡´ï¼Œæ–¹ä¾¿å†…å­˜å’Œç£ç›˜è¿›è¡Œåˆ‡æ¢ã€‚æ›´æ–°æé†’é€»è¾‘å’Œå‰é¢è¯´çš„å¼€å‘è€…åŠ¨æ€æ›´æ–°é€»è¾‘åŒºåˆ«åœ¨äºï¼ŒRSS ä½¿ç”¨ isRead æ ‡è®°æœ‰æ²¡æœ‰é˜…è¯»è¿‡ï¼Œç›´æ¥åœ¨æœ¬åœ°æ•°æ®é‡Œ count å‡º isRead å­—æ®µå€¼ä¸º false çš„æ•°é‡å°±æ˜¯éœ€è¦æé†’çš„æ•°ã€‚ </p>
<p>æ–° RSS çš„æ·»åŠ ä¼šå…ˆåœ¨æœ¬åœ°æ•°æ®åº“ä¸­æŸ¥æ‰¾æ˜¯å¦æœ‰å­˜åœ¨ï¼Œä¾æ®çš„æ˜¯æ–‡ç« çš„ urlï¼Œå¦‚æœä¸å­˜åœ¨å°±ä¼šæ·»åŠ åˆ°æ•°æ®åº“ä¸­è®¾ç½®ä¸ºæœªè¯»ä½œä¸ºæé†’ã€‚ </p>
<p>RSS é‡Œæ–‡ç« çš„å†…å®¹æ˜¯ HTMLï¼Œæ˜¾ç¤ºå†…å®¹ä½¿ç”¨çš„æ˜¯ WebKit åº“ï¼Œè¦åœ¨ SwiftUI ä¸­ä½¿ç”¨ï¼Œéœ€è¦å°è£…ä¸‹ï¼Œä»£ç å¦‚ä¸‹ï¼š </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> WebKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">WebUIView</span> : <span class="title">NSViewRepresentable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> html: <span class="type">String</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeNSView</span>(<span class="params">context</span>: <span class="type">Context</span>)</span> -&gt; <span class="keyword">some</span> <span class="type">WKWebView</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">WKWebView</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">updateNSView</span>(<span class="keyword">_</span> <span class="params">nsView</span>: <span class="type">NSViewType</span>, <span class="params">context</span>: <span class="type">Context</span>)</span> &#123;</span><br><span class="line">        nsView.loadHTMLString(html, baseURL: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ•ˆæœå¦‚ä¸‹å›¾ï¼š </p>
<p><img src="/uploads/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/25.png" alt=""></p>
<h2 id="äº‘æ‰“åŒ…"><a href="#äº‘æ‰“åŒ…" class="headerlink" title="äº‘æ‰“åŒ…"></a>äº‘æ‰“åŒ…</h2><p>å·¥ç¨‹å¦‚æœæ˜¯æœ¬åœ°ç¼–è¯‘ï¼Œåœ¨ SwiftPamphletAppConfig.swift çš„ gitHubAccessToken ä¸­æ·»ä¸Š token å°±å¯ä»¥äº†ï¼Œå¦‚æœæƒ³å¿«é€Ÿæ‰“åŒ…ä½¿ç”¨å°å†Œå­ï¼Œä½¿ç”¨Github Action Workflow ç¼–è¯‘ï¼Œæ— éœ€åœ¨æœ¬åœ°æ“ä½œã€ä¹Ÿæ— éœ€å¼€å¯Xcodeè®¾ç½®ä¸ªäººå¼€å‘å¸å·ï¼Œåªéœ€è®¾ç½®personal access token(PAT)åœ¨repositoryè®¾å®šä¸­action secretsï¼Œå¹¶å‘½åä¸ºPATã€‚Frokæ­¤repositoryï¼Œè®¾ç½®PATï¼Œæ‰‹åŠ¨å¯ç”¨actionï¼Œç­‰å€™çº¦3åˆ†é’Ÿå³å¯ä¸‹è½½æ¡£æ¡ˆï¼Œå¾€åä¸“æ¡ˆæ›´æ–°æ—¶ï¼Œåªéœ€fetch and mergeï¼Œactionä¼šè‡ªåŠ¨è¿›è¡Œã€‚éå¸¸æ„Ÿè°¢ç¤¾åŒº <a href="https://github.com/powenn">@powenn</a> å¼€å‘çš„è¿™ä¸ª Github Actionã€‚ </p>
<p><img src="/uploads/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/26.png" alt=""></p>
<p><img src="/uploads/develop-macos-with-swiftui-combine-concurrency-aysnc-await-actor/27.png" alt=""></p>
<h2 id="æ¨èå¯ä»¥å­¦ä¹ çš„å¼€æºä»“åº“"><a href="#æ¨èå¯ä»¥å­¦ä¹ çš„å¼€æºä»“åº“" class="headerlink" title="æ¨èå¯ä»¥å­¦ä¹ çš„å¼€æºä»“åº“"></a>æ¨èå¯ä»¥å­¦ä¹ çš„å¼€æºä»“åº“</h2><p>ä¸ºäº†é¿å…é—­é—¨é€ è½¦ï¼Œå¯ä»¥å¤šå…³æ³¨äº›å¼€æºé¡¹ç›®ï¼Œä»¥ä¸‹è¿™äº›ä»“åº“æ˜¯æˆ‘æ”¾åœ¨å°å†Œå­é‡Œå¯ä»¥å…³æ³¨åˆ°æ›´æ–°åŠ¨æ€çš„é¡¹ç›®ï¼Œè¿™é‡Œä½œä¸ºé™„å½•åˆ—ä¸‹ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨å°å†Œå­é‡ŒæŸ¥çœ‹ã€‚é™¤äº† Swift ä¹Ÿæœ‰äº›éå¸¸æœ‰è¶£çš„é¡¹ç›®ï¼Œå¸Œæœ›å¯ä»¥ä¸°å¯Œåˆ°ä½ çš„å¼€å‘ç”Ÿæ´»ã€‚ </p>
<h3 id="å¥½åº“"><a href="#å¥½åº“" class="headerlink" title="å¥½åº“"></a>å¥½åº“</h3><h4 id="å®˜æ–¹"><a href="#å®˜æ–¹" class="headerlink" title="å®˜æ–¹"></a>å®˜æ–¹</h4><ul>
<li><a href="https://github.com/apple/swift">swift</a></li>
<li><a href="https://github.com/apple/swift-evolution">swift-evolution</a> ææ¡ˆ </li>
<li><a href="https://github.com/llvm/llvm-project">llvm-project</a> ç¼–è¯‘å™¨ </li>
</ul>
<h4 id="æ–°é²œäº‹"><a href="#æ–°é²œäº‹" class="headerlink" title="æ–°é²œäº‹"></a>æ–°é²œäº‹</h4><ul>
<li><a href="https://github.com/SwiftOldDriver/iOS-Weekly">iOS-Weekly</a> è€å¸æœº iOS å‘¨æŠ¥ </li>
<li><a href="https://github.com/matteocrippa/awesome-swift">awesome-swift</a></li>
<li><a href="https://github.com/KwaiAppTeam/SwiftPamphletApp">SwiftPamphletApp</a> æˆ´é“­çš„ Swift å°å†Œå­ </li>
</ul>
<h4 id="å°è£…æ˜“ç”¨åŠŸèƒ½"><a href="#å°è£…æ˜“ç”¨åŠŸèƒ½" class="headerlink" title="å°è£…æ˜“ç”¨åŠŸèƒ½"></a>å°è£…æ˜“ç”¨åŠŸèƒ½</h4><ul>
<li><a href="https://github.com/SwifterSwift/SwifterSwift">SwifterSwift</a> Handy Swift extensions </li>
</ul>
<h4 id="ç½‘ç»œ"><a href="#ç½‘ç»œ" class="headerlink" title="ç½‘ç»œ"></a>ç½‘ç»œ</h4><ul>
<li><a href="https://github.com/Alamofire/Alamofire">Alamofire</a></li>
<li><a href="https://github.com/socketio/socket.io-client-swift">socket.io-client-swift</a></li>
</ul>
<h4 id="å›¾ç‰‡"><a href="#å›¾ç‰‡" class="headerlink" title="å›¾ç‰‡"></a>å›¾ç‰‡</h4><ul>
<li><a href="https://github.com/onevcat/Kingfisher">Kingfisher</a></li>
<li><a href="https://github.com/kean/Nuke">Nuke</a></li>
</ul>
<h4 id="æ–‡å­—å¤„ç†"><a href="#æ–‡å­—å¤„ç†" class="headerlink" title="æ–‡å­—å¤„ç†"></a>æ–‡å­—å¤„ç†</h4><ul>
<li><a href="https://github.com/gonzalezreal/MarkdownUI">MarkdownUI</a></li>
</ul>
<h4 id="åŠ¨ç”»"><a href="#åŠ¨ç”»" class="headerlink" title="åŠ¨ç”»"></a>åŠ¨ç”»</h4><ul>
<li><a href="https://github.com/recherst/kavsoft-swiftui-animations">kavsoft-swiftui-animations</a></li>
</ul>
<h4 id="æŒä¹…åŒ–å­˜å‚¨"><a href="#æŒä¹…åŒ–å­˜å‚¨" class="headerlink" title="æŒä¹…åŒ–å­˜å‚¨"></a>æŒä¹…åŒ–å­˜å‚¨</h4><ul>
<li><a href="https://github.com/stephencelis/SQLite.swift">SQLite.swift</a></li>
<li><a href="https://github.com/groue/GRDB.swift">GRDB.swift</a></li>
<li><a href="https://github.com/realm/realm-cocoa">realm-cocoa</a></li>
</ul>
<h4 id="ç¼–ç¨‹èŒƒå¼"><a href="#ç¼–ç¨‹èŒƒå¼" class="headerlink" title="ç¼–ç¨‹èŒƒå¼"></a>ç¼–ç¨‹èŒƒå¼</h4><ul>
<li><a href="https://github.com/ReactiveX/RxSwift">RxSwift</a> å‡½æ•°å“åº”å¼ç¼–ç¨‹ </li>
<li><a href="https://github.com/pointfreeco/swift-composable-architecture">swift-composable-architecture</a></li>
<li><a href="https://github.com/onmyway133/awesome-ios-architecture">awesome-ios-architecture</a></li>
</ul>
<h4 id="è·¯ç”±"><a href="#è·¯ç”±" class="headerlink" title="è·¯ç”±"></a>è·¯ç”±</h4><ul>
<li><a href="https://github.com/pointfreeco/swiftui-navigation">swiftui-navigation</a></li>
</ul>
<h4 id="é™æ€æ£€æŸ¥"><a href="#é™æ€æ£€æŸ¥" class="headerlink" title="é™æ€æ£€æŸ¥"></a>é™æ€æ£€æŸ¥</h4><ul>
<li><p><a href="https://github.com/realm/SwiftLint">SwiftLint</a></p>
<h4 id="ç³»ç»Ÿèƒ½åŠ›"><a href="#ç³»ç»Ÿèƒ½åŠ›" class="headerlink" title="ç³»ç»Ÿèƒ½åŠ›"></a>ç³»ç»Ÿèƒ½åŠ›</h4></li>
<li><p><a href="https://github.com/kishikawakatsumi/KeychainAccess">KeychainAccess</a></p>
</li>
</ul>
<h4 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h4><ul>
<li><a href="https://github.com/OAuthSwift/OAuthSwift">OAuthSwift</a></li>
<li><a href="https://github.com/p2/OAuth2">OAuth2</a></li>
</ul>
<h4 id="macOSç¨‹åº"><a href="#macOSç¨‹åº" class="headerlink" title="macOSç¨‹åº"></a>macOSç¨‹åº</h4><ul>
<li><a href="https://github.com/serhii-londar/open-source-mac-os-apps">open-source-mac-os-apps</a> å¼€æº macOS ç¨‹åºåˆé›† </li>
<li><a href="https://github.com/Ranchero-Software/NetNewsWire">NetNewsWire</a></li>
<li><a href="https://github.com/overtake/TelegramSwift">TelegramSwift</a></li>
</ul>
<h4 id="æ€§èƒ½å’Œå·¥ç¨‹æ„å»º"><a href="#æ€§èƒ½å’Œå·¥ç¨‹æ„å»º" class="headerlink" title="æ€§èƒ½å’Œå·¥ç¨‹æ„å»º"></a>æ€§èƒ½å’Œå·¥ç¨‹æ„å»º</h4><ul>
<li><a href="https://github.com/tuist/tuist">tuist</a> åˆ›å»ºå’Œç»´æŠ¤ Xcode projects æ–‡ä»¶ </li>
<li><a href="https://github.com/swift-server/vscode-swift">vscode-swift</a> VSCode çš„ Swift æ‰©å±• </li>
</ul>
<h4 id="éŸ³è§†é¢‘"><a href="#éŸ³è§†é¢‘" class="headerlink" title="éŸ³è§†é¢‘"></a>éŸ³è§†é¢‘</h4><ul>
<li><a href="https://github.com/iina/iina">iina</a></li>
<li><a href="https://github.com/shogo4405/HaishinKit.swift">HaishinKit.swift</a> RTMP, HLS </li>
<li><a href="https://github.com/AudioKit/AudioKit">AudioKit</a></li>
</ul>
<h4 id="æœåŠ¡å™¨"><a href="#æœåŠ¡å™¨" class="headerlink" title="æœåŠ¡å™¨"></a>æœåŠ¡å™¨</h4><ul>
<li><a href="https://github.com/vapor/vapor">vapor</a></li>
</ul>
<h3 id="æ¢ç´¢åº“"><a href="#æ¢ç´¢åº“" class="headerlink" title="æ¢ç´¢åº“"></a>æ¢ç´¢åº“</h3><h4 id="SwiftUIæ‰©å±•"><a href="#SwiftUIæ‰©å±•" class="headerlink" title="SwiftUIæ‰©å±•"></a>SwiftUIæ‰©å±•</h4><ul>
<li><a href="https://github.com/SwiftUIX/SwiftUIX">SwiftUIX</a> æ‰©å±• SwiftUI </li>
<li><a href="https://github.com/SDWebImage/SDWebImageSwiftUI">SDWebImageSwiftUI</a></li>
<li><a href="https://github.com/apptekstudios/ASCollectionView">ASCollectionView</a> SwiftUI collection </li>
<li><a href="https://github.com/siteline/SwiftUI-Introspect">SwiftUI-Introspect</a> SwiftUI å¼•å…¥ UIKit </li>
<li><a href="https://github.com/AvdLee/SwiftUIKitView">SwiftUIKitView</a> åœ¨ SwiftUI ä¸­ ä½¿ç”¨ UIKit </li>
</ul>
<h4 id="æ¥å£åº”ç”¨"><a href="#æ¥å£åº”ç”¨" class="headerlink" title="æ¥å£åº”ç”¨"></a>æ¥å£åº”ç”¨</h4><ul>
<li><a href="https://github.com/bpisano/Weather">Weather</a> å¤©æ°”åº”ç”¨ </li>
<li><a href="https://github.com/Dimillian/MovieSwiftUI">MovieSwiftUI</a> ç”µå½± MovieDB åº”ç”¨ </li>
<li><a href="https://github.com/chojnac/NotionSwift">NotionSwift</a></li>
<li><a href="https://github.com/Dimillian/RedditOS">RedditOS</a> SwiftUI å†™çš„ Readditå®¢æˆ·ç«¯ </li>
<li><a href="https://github.com/carson-katri/reddit-swiftui">reddit-swiftui</a> SwiftUI å†™çš„ Readditå®¢æˆ·ç«¯ </li>
<li><a href="https://github.com/Dimillian/SwiftHN">SwiftHN</a> Hacker News é˜…è¯» </li>
<li><a href="https://github.com/tatsuz0u/EhPanda">EhPanda</a></li>
<li><a href="https://github.com/Dimillian/MortyUI">MortyUI</a> GraphQL + SwiftUI å¼€å‘çš„ç‘å…‹å’Œè«è’‚åº”ç”¨ </li>
<li><a href="https://github.com/Finb/V2ex-Swift">V2ex-Swift</a> V2EX å®¢æˆ·ç«¯ </li>
<li><a href="https://github.com/v2er-app/iOS">iOS</a> V2EX å®¢æˆ·ç«¯ </li>
<li><a href="https://github.com/sinaweibosdk/weibo_ios_sdk">weibo_ios_sdk</a></li>
<li><a href="https://github.com/miniLV/MNWeibo">MNWeibo</a> Swift5 + MVVM å¾®åšå®¢æˆ·ç«¯ </li>
<li><a href="https://github.com/nerdishbynature/octokit.swift">octokit.swift</a> Swift API Client for GitHub </li>
<li><a href="https://github.com/GitHawkApp/GitHawk">GitHawk</a> iOS app for GitHub </li>
<li><a href="https://github.com/fangzesheng/free-api">free-api</a></li>
<li><a href="https://github.com/nerdsupremacist/Graphaello">Graphaello</a> SwiftUI ä¸­ä½¿ç”¨ GraphQL çš„å·¥å…· </li>
<li><a href="https://github.com/nerdsupremacist/tmdb">tmdb</a> GraphQL åŒ…è£…ç”µå½±æ•°æ®æ¥å£ </li>
</ul>
<h4 id="macOS"><a href="#macOS" class="headerlink" title="macOS"></a>macOS</h4><ul>
<li><a href="https://github.com/eonist/FileWatcher">FileWatcher</a> macOS ä¸Šç›‘å¬æ–‡ä»¶å˜åŒ– </li>
<li><a href="https://github.com/waylybaye/XcodeCleaner-SwiftUI">XcodeCleaner-SwiftUI</a> æ¸…ç† Xcode </li>
<li><a href="https://github.com/gao-sun/eul">eul</a> SwiftUI å†™çš„ macOS çŠ¶æ€ç›‘æ§å·¥å…· </li>
<li><a href="https://github.com/Dimillian/ACHNBrowserUI">ACHNBrowserUI</a> SwiftUI å†™çš„åŠ¨ç‰©ä¹‹æ£®å°åŠ©æ‰‹ç¨‹åº </li>
<li><a href="https://github.com/lexrus/RegExPlus">RegExPlus</a> æ­£åˆ™è¡¨è¾¾å¼ </li>
</ul>
<h4 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h4><ul>
<li><a href="https://github.com/vinhnx/Clendar">Clendar</a> SwiftUI å†™çš„æ—¥å†åº”ç”¨ </li>
</ul>
<h4 id="æ¸¸æˆ"><a href="#æ¸¸æˆ" class="headerlink" title="æ¸¸æˆ"></a>æ¸¸æˆ</h4><ul>
<li><a href="https://github.com/pointfreeco/isowords">isowords</a> å•è¯æœç´¢æ¸¸æˆ </li>
<li><a href="https://github.com/michelpereira/awesome-games-of-coding">awesome-games-of-coding</a> æ•™ä½ å­¦ç¼–ç¨‹çš„æ¸¸æˆæ”¶é›† </li>
<li><a href="https://github.com/OpenEmu/OpenEmu">OpenEmu</a> è§†é¢‘æ¸¸æˆæ¨¡æ‹Ÿå™¨ </li>
<li><a href="https://github.com/jVirus/swiftui-2048">swiftui-2048</a></li>
<li><a href="https://github.com/chrismaltby/gb-studio">gb-studio</a> æ‹–æ”¾å¼å¤å¤æ¸¸æˆåˆ›å»ºå™¨ </li>
</ul>
<h4 id="æ–°æŠ€æœ¯å±•ç¤º"><a href="#æ–°æŠ€æœ¯å±•ç¤º" class="headerlink" title="æ–°æŠ€æœ¯å±•ç¤º"></a>æ–°æŠ€æœ¯å±•ç¤º</h4><ul>
<li><a href="https://github.com/JakeLin/Moments-SwiftUI">Moments-SwiftUI</a> SwiftUIã€Asyncã€Actor </li>
</ul>
<h4 id="æ–°é²œäº‹-1"><a href="#æ–°é²œäº‹-1" class="headerlink" title="æ–°é²œäº‹"></a>æ–°é²œäº‹</h4><ul>
<li><a href="https://github.com/ruanyf/weekly">weekly</a> ç§‘æŠ€çˆ±å¥½è€…å‘¨åˆŠ </li>
</ul>
<h4 id="èšåˆ"><a href="#èšåˆ" class="headerlink" title="èšåˆ"></a>èšåˆ</h4><ul>
<li><a href="https://github.com/timqian/chinese-independent-blogs">chinese-independent-blogs</a></li>
<li><a href="https://github.com/vlondon/awesome-swiftui">awesome-swiftui</a></li>
<li><a href="https://github.com/ivanvorobei/SwiftUI">SwiftUI</a></li>
<li><a href="https://github.com/kon9chunkit/GitHub-Chinese-Top-Charts">GitHub-Chinese-Top-Charts</a> GitHubä¸­æ–‡æ’è¡Œæ¦œ </li>
<li><a href="https://github.com/onmyway133/awesome-swiftui">awesome-swiftui</a></li>
<li><a href="https://github.com/Juanpe/About-SwiftUI">About-SwiftUI</a> æ±‡æ€» SwiftUI çš„èµ„æ–™ </li>
</ul>
<h4 id="çŸ¥è¯†ç®¡ç†"><a href="#çŸ¥è¯†ç®¡ç†" class="headerlink" title="çŸ¥è¯†ç®¡ç†"></a>çŸ¥è¯†ç®¡ç†</h4><ul>
<li><a href="https://github.com/logseq/logseq">logseq</a> æ›´å¥½çš„çŸ¥è¯†ç®¡ç†å·¥å…· </li>
</ul>
<h4 id="æ€§èƒ½å’Œå·¥ç¨‹æ„å»º-1"><a href="#æ€§èƒ½å’Œå·¥ç¨‹æ„å»º-1" class="headerlink" title="æ€§èƒ½å’Œå·¥ç¨‹æ„å»º"></a>æ€§èƒ½å’Œå·¥ç¨‹æ„å»º</h4><ul>
<li><a href="https://github.com/peripheryapp/periphery">periphery</a> æ£€æµ‹ Swift æ— ç”¨ä»£ç  </li>
<li><a href="https://github.com/nalexn/ViewInspector">ViewInspector</a> SwiftUI Runtime introspection å’Œ å•å…ƒæµ‹è¯• </li>
</ul>
<h4 id="ç½‘ç»œ-1"><a href="#ç½‘ç»œ-1" class="headerlink" title="ç½‘ç»œ"></a>ç½‘ç»œ</h4><ul>
<li><a href="https://github.com/Lojii/Knot">Knot</a> ä½¿ç”¨ SwiftNIO å®ç° HTTPS æŠ“åŒ… </li>
<li><a href="https://github.com/swift-server/async-http-client">async-http-client</a> ä½¿ç”¨ SwiftNIO å¼€å‘çš„ HTTP å®¢æˆ·ç«¯ </li>
<li><a href="https://github.com/kean/Get">Get</a></li>
<li><a href="https://github.com/awesome-selfhosted/awesome-selfhosted">awesome-selfhosted</a> ç½‘ç»œæœåŠ¡åŠä¸Šé¢çš„åº”ç”¨ </li>
<li><a href="https://github.com/daltoniam/Starscream">Starscream</a> WebSocket </li>
<li><a href="https://github.com/shadowsocks/ShadowsocksX-NG">ShadowsocksX-NG</a></li>
<li><a href="https://github.com/carson-katri/swift-request">swift-request</a> å£°æ˜å¼çš„ç½‘ç»œè¯·æ±‚ </li>
</ul>
<h4 id="å›¾å½¢"><a href="#å›¾å½¢" class="headerlink" title="å›¾å½¢"></a>å›¾å½¢</h4><ul>
<li><a href="https://github.com/lludo/SwiftSunburstDiagram">SwiftSunburstDiagram</a> SwiftUI å›¾è¡¨ </li>
</ul>
<h4 id="ç³»ç»Ÿ"><a href="#ç³»ç»Ÿ" class="headerlink" title="ç³»ç»Ÿ"></a>ç³»ç»Ÿ</h4><ul>
<li><a href="https://github.com/spevans/swift-project1">swift-project1</a> Swiftç¼–å†™å†…æ ¸ï¼Œå¯åœ¨ Mac å’Œ PC å¯åŠ¨ </li>
</ul>
<h4 id="Apple"><a href="#Apple" class="headerlink" title="Apple"></a>Apple</h4><ul>
<li><a href="https://github.com/apple/swift-corelibs-foundation">swift-corelibs-foundation</a></li>
<li><a href="https://github.com/apple/swift-package-manager">swift-package-manager</a></li>
<li><a href="https://github.com/apple/swift-markdown">swift-markdown</a></li>
<li><a href="https://github.com/apple/sourcekit-lsp">sourcekit-lsp</a></li>
<li><a href="https://github.com/apple/swift-nio">swift-nio</a></li>
<li><a href="https://github.com/apple/swift-syntax">swift-syntax</a> è§£æã€ç”Ÿæˆã€è½¬æ¢ Swift ä»£ç  </li>
<li><a href="https://github.com/apple/swift-crypto">swift-crypto</a> CryptoKit çš„å¼€æºå®ç° </li>
</ul>
<h4 id="å¾…åˆ†ç±»"><a href="#å¾…åˆ†ç±»" class="headerlink" title="å¾…åˆ†ç±»"></a>å¾…åˆ†ç±»</h4><ul>
<li><a href="https://github.com/public-apis/public-apis">public-apis</a></li>
<li><a href="https://github.com/insidegui/WWDC">WWDC</a></li>
<li><a href="https://github.com/sindresorhus/Actions">Actions</a></li>
<li><a href="https://github.com/trimstray/the-book-of-secret-knowledge">the-book-of-secret-knowledge</a></li>
<li><a href="https://github.com/rossant/awesome-math">awesome-math</a></li>
<li><a href="https://github.com/rakutentech/AltSwiftUI">AltSwiftUI</a> ç±» SwiftUI </li>
<li><a href="https://github.com/gymshark/ios-stack-kit">ios-stack-kit</a> ç±» SwiftUI </li>
<li><a href="https://github.com/OpenCombine/OpenCombine">OpenCombine</a> Combine çš„å¼€æºå®ç° </li>
<li><a href="https://github.com/CombineCommunity/CombineExt">CombineExt</a> å¯¹ Combine çš„è¡¥å…… </li>
<li><a href="https://github.com/ReSwift/ReSwift">ReSwift</a> å•é¡µé¢çŠ¶æ€å’Œæ•°æ®ç®¡ç† </li>
<li><a href="https://github.com/devicekit/DeviceKit">DeviceKit</a> UIDevice æ˜“ç”¨å°è£… </li>
<li><a href="https://github.com/ivanschuetz/SwiftCharts">SwiftCharts</a></li>
<li><a href="https://github.com/nvzqz/FileKit">FileKit</a> æ–‡ä»¶æ“ä½œ </li>
<li><a href="https://github.com/JohnSundell/Files">Files</a> æ–‡ä»¶æ“ä½œ </li>
<li><a href="https://github.com/kylef/PathKit">PathKit</a> æ–‡ä»¶æ“ä½œ </li>
<li><a href="https://github.com/JohnSundell/Publish">Publish</a> é™æ€ç«™ç‚¹ç”Ÿæˆå™¨ </li>
<li><a href="https://github.com/caiyue1993/IceCream">IceCream</a> CloudKit åŒæ­¥ Realm æ•°æ®åº“ </li>
<li><a href="https://github.com/tophat/RichTextView">RichTextView</a></li>
<li><a href="https://github.com/tnantoka/edhita">edhita</a></li>
<li><a href="https://github.com/keitaoouchi/MarkdownView">MarkdownView</a></li>
<li><a href="https://github.com/johnxnguyen/Down">Down</a> fast Markdown </li>
<li><a href="https://github.com/qeude/SwiftDown">SwiftDown</a> Swift å†™çš„å¯æ¢ä¸»é¢˜çš„ Markdown ç¼–è¾‘å™¨ç»„ä»¶ </li>
<li><a href="https://github.com/shibapm/Komondor">Komondor</a> Git Hooks for Swift projects </li>
<li><a href="https://github.com/SwiftGen/SwiftGen">SwiftGen</a> ä»£ç ç”Ÿæˆ </li>
<li><a href="https://github.com/kasketis/netfox">netfox</a> è·å–æ‰€æœ‰ç½‘ç»œè¯·æ±‚ </li>
<li><a href="https://github.com/BohdanOrlov/iOS-Developer-Roadmap">iOS-Developer-Roadmap</a></li>
<li><a href="https://github.com/kickstarter/ios-oss">ios-oss</a></li>
<li><a href="https://github.com/wordpress-mobile/WordPress-iOS">WordPress-iOS</a></li>
<li><a href="https://github.com/josejuanqm/VersaPlayer">VersaPlayer</a></li>
<li><a href="https://github.com/mozilla-mobile/firefox-ios">firefox-ios</a></li>
<li><a href="https://github.com/PostgresApp/PostgresApp">PostgresApp</a></li>
<li><a href="https://github.com/Moya/Moya">Moya</a></li>
<li><a href="https://github.com/Kitura/BlueSocket">BlueSocket</a></li>
<li><a href="https://github.com/rhummelmose/BluetoothKit">BluetoothKit</a></li>
<li><a href="https://github.com/rushisangani/BiometricAuthentication">BiometricAuthentication</a> FaceID or TouchID authentication </li>
<li><a href="https://github.com/krzyzanowskim/CryptoSwift">CryptoSwift</a></li>
<li><a href="https://github.com/timdonnelly/Advance">Advance</a> Physics-based animations </li>
<li><a href="https://github.com/MengTo/Spring">Spring</a> åŠ¨ç”» </li>
<li><a href="https://github.com/jathu/UIImageColors">UIImageColors</a> è·å–å›¾ç‰‡ä¸»æ¬¡é¢œè‰² </li>
<li><a href="https://github.com/BradLarson/GPUImage3">GPUImage3</a> Metal å®ç° </li>
<li><a href="https://github.com/exyte/Macaw">Macaw</a> SVG </li>
<li><a href="https://github.com/efremidze/Magnetic">Magnetic</a> SpriteKitæ°”æ³¡æ”¯æŒSwiftUI </li>
<li><a href="https://github.com/analogcode/Swift-Radio-Pro">Swift-Radio-Pro</a> ç”µå°åº”ç”¨ </li>
<li><a href="https://github.com/suzuki-0000/SKPhotoBrowser">SKPhotoBrowser</a> å›¾ç‰‡æµè§ˆ </li>
<li><a href="https://github.com/raywenderlich/swift-algorithm-club">swift-algorithm-club</a></li>
<li><a href="https://github.com/hyperoslo/Cache">Cache</a></li>
<li><a href="https://github.com/sunshinejr/SwiftyUserDefaults">SwiftyUserDefaults</a></li>
<li><a href="https://github.com/MonitorControl/MonitorControl">MonitorControl</a> äº®åº¦å’Œå£°éŸ³æ§åˆ¶ </li>
<li><a href="https://github.com/kylef/Commander">Commander</a> å‘½ä»¤è¡Œ </li>
<li><a href="https://github.com/ReactiveCocoa/ReactiveCocoa">ReactiveCocoa</a></li>
<li><a href="https://github.com/Carthage/Carthage">Carthage</a></li>
<li><a href="https://github.com/danielgindi/Charts">Charts</a></li>
<li><a href="https://github.com/Quick/Quick">Quick</a> æµ‹è¯•æ¡†æ¶ </li>
<li><a href="https://github.com/bilibili/ijkplayer">ijkplayer</a> æ’­æ”¾å™¨ </li>
<li><a href="https://github.com/schellingb/dosbox-pure">dosbox-pure</a> DOS æ¸¸æˆæ¨¡æ‹Ÿå™¨ </li>
<li><a href="https://github.com/twostraws/HackingWithSwift">HackingWithSwift</a> ç¤ºä¾‹ä»£ç  </li>
<li><a href="https://github.com/glushchenko/fsnotes">fsnotes</a></li>
<li><a href="https://github.com/coteditor/CotEditor">CotEditor</a></li>
<li><a href="https://github.com/JoanKing/JKSwiftExtension">JKSwiftExtension</a> Swiftå¸¸ç”¨æ‰©å±•ã€ç»„ä»¶ã€åè®® </li>
<li><a href="https://github.com/infinum/iOS-Nuts-And-Bolts">iOS-Nuts-And-Bolts</a></li>
<li><a href="https://github.com/gtokman/ExtensionKit">ExtensionKit</a></li>
<li><a href="https://github.com/johnsundell/publish">publish</a> ç”¨ swift æ¥å†™ç½‘ç«™ </li>
<li><a href="https://github.com/mehdihadeli/awesome-software-architecture">awesome-software-architecture</a> è½¯ä»¶æ¶æ„ </li>
<li><a href="https://github.com/NARKOZ/hacker-scripts">hacker-scripts</a> ç¨‹åºå‘˜çš„æ´»éƒ½è®©æœºå™¨å¹²çš„è„šæœ¬ï¼ˆçœŸå®æ•…äº‹ï¼‰ </li>
<li><a href="https://github.com/nalexn/clean-architecture-swiftui">clean-architecture-swiftui</a> å¹²å‡€å®Œæ•´çš„SwiftUI+Combineä¾‹å­ï¼ŒåŒ…å«ç½‘ç»œå’Œå•å…ƒæµ‹è¯•ç­‰ </li>
<li><a href="https://github.com/carekit-apple/CareKit">CareKit</a> ä½¿ç”¨ SwiftUI å¼€å‘å¥åº·ç›¸å…³çš„åº“ </li>
<li><a href="https://github.com/carson-katri/awesome-result-builders">awesome-result-builders</a> Result Builders </li>
<li><a href="https://github.com/Cay-Zhang/SwiftSpeech">SwiftSpeech</a> è‹¹æœè¯­è¨€è¯†åˆ«å°è£…åº“ï¼Œå·²é€‚é… SwiftUI </li>
<li><a href="https://github.com/NextLevel/NextLevel">NextLevel</a> ç›¸æœº </li>
<li><a href="https://github.com/Harley-xk/MaLiang">MaLiang</a> åŸºäº Metal çš„æ¶‚é¸¦ç»˜å›¾åº“ </li>
<li><a href="https://github.com/chaozh/awesome-blockchain-cn">awesome-blockchain-cn</a> åŒºå—é“¾ awesome </li>
<li><a href="https://github.com/RobotsAndPencils/XcodesApp">XcodesApp</a> Xcode å¤šç‰ˆæœ¬å®‰è£… </li>
<li><a href="https://github.com/WeTransfer/Mocker">Mocker</a> Mock Alamofire and URLSession </li>
<li><a href="https://github.com/gre4ixin/ReduxUI">ReduxUI</a> SwiftUI Redux æ¶æ„ </li>
<li><a href="https://github.com/ZeeZide/5GUIs">5GUIs</a> å¯ä»¥åˆ†æç¨‹åºç”¨äº†å“ªäº›åº“ï¼Œç”¨äº†LLVM objdump </li>
<li><a href="https://github.com/pointfreeco/episode-code-samples">episode-code-samples</a></li>
<li><a href="https://github.com/SwiftPackageIndex/PackageList">PackageList</a></li>
<li><a href="https://github.com/sindresorhus/awesome">awesome</a> å†…å®¹å¹¿ </li>
<li><a href="https://github.com/dkhamsing/open-source-ios-apps">open-source-ios-apps</a> å¼€æºçš„å®Œæ•´ App ä¾‹å­ </li>
<li><a href="https://github.com/frzi/Model3DView">Model3DView</a> æ¯«ä¸è´¹åŠ›çš„ä½¿ç”¨ SwiftUI æ¸²æŸ“ 3d models </li>
<li><a href="https://github.com/faisalmemon/ios-crash-dump-analysis-book">ios-crash-dump-analysis-book</a> iOS Crash Dump Analysis Book </li>
<li><a href="https://github.com/exyte/SVGView">SVGView</a> æ”¯æŒ SwiftUI çš„ SVG è§£ææ¸²æŸ“è§†å›¾ </li>
<li><a href="https://github.com/krzysztofzablocki/Sourcery">Sourcery</a> Swift å…ƒç¼–ç¨‹ </li>
<li><a href="https://github.com/jessesquires/TIL">TIL</a> å­¦ä¹ ç¬”è®° </li>
<li><a href="https://github.com/majd/ipatool">ipatool</a> ä¸‹è½½ ipa </li>
<li><a href="https://github.com/JohnSundell/Ink">Ink</a> Markdown è§£æå™¨ </li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å…ˆè¯´ä¸¤å¥åºŸè¯ï¼ˆDonâ€™t-blame-me-about-my-caculationï¼‰&quot;&gt;&lt;a href=&quot;#å…ˆè¯´ä¸¤å¥åºŸè¯ï¼ˆDonâ€™t-blame-me-about-my-caculationï¼‰&quot; class=&quot;headerlink&quot; title=&quot;å…ˆè¯´ä¸¤å¥åºŸè¯ï¼ˆD
    
    </summary>
    
      <category term="Programming" scheme="http://ming1016.github.io/categories/Programming/"/>
    
    
      <category term="Swift" scheme="http://ming1016.github.io/tags/Swift/"/>
    
      <category term="Apple" scheme="http://ming1016.github.io/tags/Apple/"/>
    
  </entry>
  
  <entry>
    <title>æˆ´é“­çš„ Swift å°å†Œå­</title>
    <link href="http://ming1016.github.io/2021/11/23/daiming-swift-pamphlet/"/>
    <id>http://ming1016.github.io/2021/11/23/daiming-swift-pamphlet/</id>
    <published>2021-11-23T08:28:18.000Z</published>
    <updated>2021-12-17T04:09:41.346Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯è¯´æ˜"><a href="#èƒŒæ™¯è¯´æ˜" class="headerlink" title="èƒŒæ™¯è¯´æ˜"></a>èƒŒæ™¯è¯´æ˜</h2><p>è¶Šæ¥è¶Šå¤šåŒå­¦æ‰“ç®—å¼€å§‹ç”¨ Swift æ¥å¼€å‘äº†ï¼Œå¯å¾ˆå¤šäººä»¥å‰éƒ½æ²¡æ¥è§¦è¿‡ Swiftã€‚è¿™ç¯‡å’Œæˆ‘ä»¥å‰æ–‡ç« ä¸åŒçš„æ˜¯ï¼Œæœ¬ç¯‡åªæ˜¯é¢å‘ Swift é›¶åŸºç¡€çš„åŒå­¦ï¼Œå†…å®¹ä¸»è¦æ˜¯ä¸€äº›ç›´æ¥å¯ç”¨çš„å°ä¾‹å­ï¼Œä¾‹å­å¯ä»¥ç›´æ¥åœ¨å·¥ç¨‹ä¸­ç”¨æˆ–è‡ªå·±è°ƒè¯•ç€çœ‹ã€‚</p>
<p>è®°å¾—ä»¥å‰ PHP æœ‰ä¸ª chm çš„æ‰‹å†Œï¼Œå†™çš„å¾ˆç®€å•ï¼Œä½†å¾ˆå…¨ï¼Œæ¯ä¸ªçŸ¥è¯†ç‚¹éƒ½æœ‰ä¾‹å­ï¼Œç¤¾åŒºç‰ˆæ¯ä¸ªçŸ¥è¯†ç‚¹ä¸‹é¢è¿˜æœ‰ç•™è¨€äº’åŠ¨ã€‚å› æ­¤ï¼Œæˆ‘å¼„äº†ä¸ª Swift çš„æ‰‹å†Œï¼Œæ˜¯ä¸ª macOS ç¨‹åºã€‚å»ºè®®ä½¿ç”¨æˆ‘å¼€å‘çš„è¿™ä¸ª macOS ç¨‹åºæ¥æµè§ˆï¼Œä½¿ç”¨æ–¹æ³•æ˜¯ï¼š</p>
<ul>
<li>ä»  <a href="https://github.com/ming1016/SwiftPamphletApp">GitHub - ming1016/SwiftPamphletApp: æˆ´é“­çš„ Swift å°å†Œå­ï¼Œä¸€æœ¬æ´»çš„ Swift æ‰‹å†Œ</a>  ä»“åº“æ‹‰ä»£ç ã€‚</li>
<li>ç„¶ååœ¨ SwiftPamphletAppConfig.swift é‡Œ gitHubAccessToken åŠ å…¥ä½ çš„ GitHub Access Tokenã€‚GitHub Access Token åœ¨  <a href="https://github.com/settings/tokens">Personal Access Tokens</a>  è¿™é‡Œè·å–ï¼Œscope å‹¾ä¸Š repo å’Œ userã€‚</li>
<li>ä½¿ç”¨Xcodeç¼–è¯‘ç”Ÿæˆè¿™ä¸ªæ‰‹å†Œç¨‹åºã€‚Xcode å’Œ macOS éƒ½éœ€è¦å‡åˆ°æœ€æ–°ç‰ˆï¼Œå¦‚æœé‡åˆ° swift package ä¸‹è½½ä¸ä¸‹æ¥çš„æƒ…å†µï¼Œå‚çœ‹è¿™ä¸ªè®®é¢˜æ¥è§£å†³ï¼š<a href="https://github.com/ming1016/SwiftPamphletApp/issues/88">è¯·é—®markdownuiä¸€ç›´æ›´æ–°ä¸ä¸‹æ¥æ˜¯ä»€ä¹ˆåŸå›  Â· Issue #88 Â· ming1016/SwiftPamphletApp Â· GitHub</a></li>
</ul>
<p>æˆªå›¾å¦‚ä¸‹ï¼š<br><img src="/uploads/daiming-swift-pamphlet/01.png" alt=""><br><img src="/uploads/daiming-swift-pamphlet/02.png" alt=""><br><img src="/uploads/daiming-swift-pamphlet/03.png" alt=""><br><img src="/uploads/daiming-swift-pamphlet/04.png" alt=""><br><img src="/uploads/daiming-swift-pamphlet/05.png" alt=""><br><img src="/uploads/daiming-swift-pamphlet/06.png" alt=""><br><img src="/uploads/daiming-swift-pamphlet/07.png" alt=""></p>
<p>è¿™ä¸ªç¨‹åºæ˜¯Swiftå†™çš„ï¼ŒæŒ‰ç…§å£°æ˜å¼UIï¼Œå“åº”å¼ç¼–ç¨‹èŒƒå¼å¼€å‘çš„ï¼Œæºç ä¹Ÿå¯ä»¥çœ‹çœ‹ã€‚ä¸å…¶è®²ä¸€å †ï¼Œä¸å¦‚è°ƒç€è¯•ã€‚</p>
<p>ä¸‹é¢æ˜¯æ–‡æœ¬å†…å®¹ã€‚æ³¨ï¼šä»£ç ä¸­ç®€åŒ–å˜é‡åæ˜¯ä¸ºäº†èƒ½æ›´å¿«é€Ÿå…³æ³¨åˆ°è¯­è¨€ç”¨æ³•ã€‚</p>
<h2 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h2><h3 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h3><h4 id="å˜é‡-let-var"><a href="#å˜é‡-let-var" class="headerlink" title="å˜é‡ let, var"></a>å˜é‡ let, var</h4><p>å˜é‡æ˜¯å¯å˜çš„ï¼Œä½¿ç”¨varä¿®é¥°ï¼Œå¸¸é‡æ˜¯ä¸å¯å˜çš„ï¼Œä½¿ç”¨letä¿®é¥°ã€‚ç±»ã€ç»“æ„ä½“å’Œæšä¸¾é‡Œçš„å˜é‡æ˜¯å±æ€§ã€‚<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> v1:<span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;hi&quot;</span> <span class="comment">// æ ‡æ³¨ç±»å‹</span></span><br><span class="line"><span class="keyword">var</span> v2 <span class="operator">=</span> <span class="string">&quot;ç±»å‹æ¨å¯¼&quot;</span></span><br><span class="line"><span class="keyword">let</span> l1 <span class="operator">=</span> <span class="string">&quot;æ ‡é¢˜&quot;</span> <span class="comment">// å¸¸é‡</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">a</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> p1 <span class="operator">=</span> <span class="number">3</span></span><br><span class="line">    <span class="keyword">var</span> p2: <span class="type">Int</span> &#123;</span><br><span class="line">        p1 <span class="operator">*</span> <span class="number">3</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å±æ€§æ²¡æœ‰setå¯ä»¥çœç•¥getï¼Œå¦‚æœæœ‰setéœ€åŠ getã€‚å˜é‡è®¾ç½®å‰é€šè¿‡willSetè®¿é—®åˆ°ï¼Œå˜é‡è®¾ç½®åé€šè¿‡didSetè®¿é—®ã€‚</p>
<h4 id="æ‰“å°-print-â€œâ€"><a href="#æ‰“å°-print-â€œâ€" class="headerlink" title="æ‰“å° print(â€œâ€)"></a>æ‰“å° print(â€œâ€)</h4><p>æ§åˆ¶å°æ‰“å°å€¼<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;hi&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> i <span class="operator">=</span> <span class="number">14</span></span><br><span class="line"><span class="built_in">print</span>(i)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;9æœˆ<span class="subst">\(i)</span>æ˜¯å°æŸ æª¬çš„ç”Ÿæ—¥&quot;</span>)</span><br></pre></td></tr></table></figure></p>
<h4 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š //"></a>æ³¨é‡Š //</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å•è¡Œæ³¨é‡Š</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">å¤šè¡Œæ³¨é‡Šç¬¬ä¸€è¡Œã€‚</span></span><br><span class="line"><span class="comment">å¤šè¡Œæ³¨é‡Šç¬¬äºŒè¡Œã€‚</span></span><br><span class="line"><span class="comment">*/</span> </span><br><span class="line"><span class="comment">// MARK: ä¼šåœ¨minimapä¸Šå±•ç¤º</span></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> å¾…åš</span></span><br><span class="line"><span class="comment">// <span class="doctag">FIXME:</span> å¾…ä¿®å¤</span></span><br></pre></td></tr></table></figure>
<h4 id="å¯é€‰"><a href="#å¯é€‰" class="headerlink" title="å¯é€‰ ?, !"></a>å¯é€‰ ?, !</h4><p>å¯èƒ½ä¼šæ˜¯ nil çš„å˜é‡å°±æ˜¯å¯é€‰å˜é‡ã€‚å½“å˜é‡ä¸º nil é€šè¿‡??æ“ä½œç¬¦å¯ä»¥æä¾›ä¸€ä¸ªé»˜è®¤å€¼ã€‚<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> o: <span class="type">Int</span>? <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"><span class="keyword">let</span> i <span class="operator">=</span> o <span class="operator">??</span> <span class="number">0</span></span><br></pre></td></tr></table></figure></p>
<h4 id="é—­åŒ…"><a href="#é—­åŒ…" class="headerlink" title="é—­åŒ…"></a>é—­åŒ…</h4><p>é—­åŒ…ä¹Ÿå¯ä»¥å«åš lambdaï¼Œæ˜¯åŒ¿åå‡½æ•°ï¼Œå¯¹åº” OC çš„ blockã€‚<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a1 <span class="operator">=</span> [<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>].sorted(by: &#123; (l: <span class="type">Int</span>, r: <span class="type">Int</span>) -&gt; <span class="type">Bool</span> <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">return</span> l <span class="operator">&lt;</span> r</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// å¦‚æœé—­åŒ…æ˜¯å”¯ä¸€çš„å‚æ•°å¹¶åœ¨è¡¨è¾¾å¼æœ€åå¯ä»¥ä½¿ç”¨ç»“å°¾é—­åŒ…è¯­æ³•ï¼Œå†™æ³•ç®€åŒ–ä¸º</span></span><br><span class="line"><span class="keyword">let</span> a2 <span class="operator">=</span> [<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>].sorted &#123; (l: <span class="type">Int</span>, r: <span class="type">Int</span>) -&gt; <span class="type">Bool</span> <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">return</span> l <span class="operator">&lt;</span> r</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å·²çŸ¥ç±»å‹å¯ä»¥çœç•¥</span></span><br><span class="line"><span class="keyword">let</span> a3 <span class="operator">=</span> [<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>].sorted &#123; l, r <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">return</span> l <span class="operator">&lt;</span> r</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é€šè¿‡ä½ç½®æ¥ä½¿ç”¨é—­åŒ…çš„å‚æ•°ï¼Œæœ€åç®€åŒ–å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="keyword">let</span> a4 <span class="operator">=</span> [<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>].sorted &#123; <span class="variable">$0</span> <span class="operator">&lt;</span> <span class="variable">$1</span> &#125;</span><br><span class="line"><span class="built_in">print</span>(a)</span><br></pre></td></tr></table></figure></p>
<p>å‡½æ•°ä¹Ÿæ˜¯é—­åŒ…çš„ä¸€ç§ï¼Œå‡½æ•°çš„å‚æ•°ä¹Ÿå¯ä»¥æ˜¯é—­åŒ…ã€‚@escaping è¡¨ç¤ºé€ƒé€¸é—­åŒ…ï¼Œé€ƒé€¸é—­åŒ…æ˜¯å¯ä»¥åœ¨å‡½æ•°è¿”å›ä¹‹åç»§ç»­è°ƒç”¨çš„ã€‚@autoclosure è¡¨ç¤ºè‡ªåŠ¨é—­åŒ…ï¼Œå¯ä»¥ç”¨æ¥çœç•¥èŠ±æ‹¬å·ã€‚</p>
<h4 id="å‡½æ•°-func"><a href="#å‡½æ•°-func" class="headerlink" title="å‡½æ•° func"></a>å‡½æ•° func</h4><p>å‡½æ•°å¯ä»¥ä½œä¸ºå¦ä¸€ä¸ªå‡½æ•°çš„å‚æ•°ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå¦ä¸€ä¸ªå‡½æ•°çš„è¿”å›ã€‚å‡½æ•°æ˜¯ç‰¹æ®Šçš„é—­åŒ…ï¼Œåœ¨ç±»ã€ç»“æ„ä½“å’Œæšä¸¾ä¸­æ˜¯æ–¹æ³•ã€‚<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸ºå‚æ•°è®¾ç½®é»˜è®¤å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span>(<span class="params">p</span>: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;p&quot;</span>)</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="string">&quot;p is <span class="subst">\(p)</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å‡½æ•°ä½œä¸ºå‚æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f2</span>(<span class="params">fn</span>: (<span class="type">String</span>) -&gt; <span class="type">String</span>, <span class="params">p</span>: <span class="type">String</span>)</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fn(p)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(f2(fn:f1, p: <span class="string">&quot;d&quot;</span>)) <span class="comment">// p is d</span></span><br><span class="line"><span class="comment">// å‡½æ•°ä½œä¸ºè¿”å›å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f3</span>(<span class="params">p</span>: <span class="type">String</span>)</span> -&gt; (<span class="type">String</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> f1</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(f3(p: <span class="string">&quot;yes&quot;</span>)(<span class="string">&quot;no&quot;</span>)) <span class="comment">// p is no</span></span><br></pre></td></tr></table></figure></p>
<p>å‡½æ•°å¯ä»¥è¿”å›å¤šä¸ªå€¼ï¼Œå‡½æ•°æ˜¯å¯ä»¥åµŒå¥—çš„ï¼Œä¹Ÿå°±æ˜¯å‡½æ•°é‡Œå†…å¯ä»¥å®šä¹‰å‡½æ•°ï¼Œå‡½æ•°å†…å®šä¹‰çš„å‡½æ•°å¯ä»¥è®¿é—®è‡ªå·±ä½œç”¨åŸŸå¤–å‡½æ•°å†…çš„å˜é‡ã€‚inout è¡¨ç¤ºçš„æ˜¯è¾“å…¥è¾“å‡ºå‚æ•°ï¼Œå‡½æ•°å¯ä»¥åœ¨å‡½æ•°å†…æ”¹å˜è¾“å…¥è¾“å‡ºå‚æ•°ã€‚defer æ ‡è¯†çš„ä»£ç å—ä¼šåœ¨å‡½æ•°è¿”å›ä¹‹å‰æ‰§è¡Œã€‚</p>
<h4 id="è®¿é—®æ§åˆ¶"><a href="#è®¿é—®æ§åˆ¶" class="headerlink" title="è®¿é—®æ§åˆ¶"></a>è®¿é—®æ§åˆ¶</h4><p>åœ¨ Xcode é‡Œçš„ target å°±æ˜¯æ¨¡å—ï¼Œä½¿ç”¨ import å¯å¯¼å…¥æ¨¡å—ã€‚æ¨¡å—å†…åŒ…å«æºæ–‡ä»¶ï¼Œæ¯ä¸ªæºæ–‡ä»¶é‡Œå¯ä»¥æœ‰å¤šä¸ªç±»ã€ç»“æ„ä½“ã€æšä¸¾å’Œå‡½æ•°ç­‰å¤šç§ç±»å‹ã€‚è®¿é—®çº§åˆ«å¯ä»¥é€šè¿‡ä¸€äº›å…³é”®å­—æè¿°ï¼Œåˆ†ä¸ºå¦‚ä¸‹å‡ ç§ï¼š</p>
<ul>
<li>openï¼šåœ¨æ¨¡å—å¤–å¯ä»¥è°ƒç”¨å’Œç»§æ‰¿ã€‚</li>
<li>publicï¼šåœ¨æ¨¡å—å¤–å¯è°ƒç”¨ä¸å¯ç»§æ‰¿ï¼Œopen åªé€‚ç”¨ç±»å’Œç±»æˆå‘˜ã€‚</li>
<li>internalï¼šé»˜è®¤çº§åˆ«ï¼Œæ¨¡å—å†…å¯è·¨æºæ–‡ä»¶è°ƒç”¨ï¼Œæ¨¡å—å¤–ä¸å¯è°ƒç”¨ã€‚</li>
<li>fileprivateï¼šåªèƒ½åœ¨æºæ–‡ä»¶å†…è®¿é—®ã€‚</li>
<li>privateï¼šåªèƒ½åœ¨æ‰€åœ¨çš„ä½œç”¨åŸŸå†…è®¿é—®ã€‚<br>é‡å†™ç»§æ‰¿ç±»çš„æˆå‘˜ï¼Œå¯ä»¥è®¾ç½®æˆå‘˜æ¯”çˆ¶ç±»çš„è¿™ä¸ªæˆå‘˜æ›´é«˜çš„è®¿é—®çº§åˆ«ã€‚Setter çš„çº§åˆ«å¯ä»¥ä½äºå¯¹åº”çš„ Getter çš„çº§åˆ«ï¼Œæ¯”å¦‚è®¾ç½® Setter è®¿é—®çº§åˆ«ä¸º privateï¼Œå¯ä»¥åœ¨å±æ€§ä½¿ç”¨ private(set) æ¥ä¿®é¥°ã€‚</li>
</ul>
<h3 id="ç±»å‹"><a href="#ç±»å‹" class="headerlink" title="ç±»å‹"></a>ç±»å‹</h3><h4 id="æ•°å­—-Int-Float"><a href="#æ•°å­—-Int-Float" class="headerlink" title="æ•°å­— Int, Float"></a>æ•°å­— Int, Float</h4><p>æ•°å­—çš„ç±»å‹æœ‰Intã€Floatå’ŒDouble<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Int</span></span><br><span class="line"><span class="keyword">let</span> i1 <span class="operator">=</span> <span class="number">100</span></span><br><span class="line"><span class="keyword">let</span> i2 <span class="operator">=</span> <span class="number">22</span></span><br><span class="line"><span class="built_in">print</span>(i1 <span class="operator">/</span> i2) <span class="comment">//å››èˆäº”å…¥å¾—4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Float</span></span><br><span class="line"><span class="keyword">let</span> f1: <span class="type">Float</span> <span class="operator">=</span> <span class="number">100.0</span></span><br><span class="line"><span class="keyword">let</span> f2: <span class="type">Float</span> <span class="operator">=</span> <span class="number">22.0</span></span><br><span class="line"><span class="built_in">print</span>(f1 <span class="operator">/</span> f2) <span class="comment">// 4.5454545</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Double</span></span><br><span class="line"><span class="keyword">let</span> d1: <span class="type">Double</span> <span class="operator">=</span> <span class="number">100.0</span></span><br><span class="line"><span class="keyword">let</span> d2: <span class="type">Double</span> <span class="operator">=</span> <span class="number">22.0</span></span><br><span class="line"><span class="built_in">print</span>(d1 <span class="operator">/</span> d2) <span class="comment">// 4.545454545454546</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å­—é¢é‡</span></span><br><span class="line"><span class="built_in">print</span>(<span class="type">Int</span>(<span class="number">0b10101</span>)) <span class="comment">// 0b å¼€å¤´æ˜¯äºŒè¿›åˆ¶ </span></span><br><span class="line"><span class="built_in">print</span>(<span class="type">Int</span>(<span class="number">0x00afff</span>)) <span class="comment">// 0x å¼€å¤´æ˜¯åå…­è¿›åˆ¶</span></span><br><span class="line"><span class="built_in">print</span>(<span class="number">2.5e4</span>) <span class="comment">// 2.5x10^4 åè¿›åˆ¶ç”¨ e</span></span><br><span class="line"><span class="built_in">print</span>(<span class="number">0xAp2</span>) <span class="comment">// 10*2^2  åå…­è¿›åˆ¶ç”¨ p</span></span><br><span class="line"><span class="built_in">print</span>(<span class="number">2_000_000</span>) <span class="comment">// 2000000</span></span><br></pre></td></tr></table></figure></p>
<h4 id="å¸ƒå°”æ•°-Bool"><a href="#å¸ƒå°”æ•°-Bool" class="headerlink" title="å¸ƒå°”æ•° Bool"></a>å¸ƒå°”æ•° Bool</h4><p>å¸ƒå°”æ•°æœ‰ true å’Œ false ä¸¤ç§å€¼ï¼Œè¿˜æœ‰ä¸€ä¸ªèƒ½å¤Ÿåˆ‡æ¢è¿™ä¸¤ä¸ªå€¼çš„ toggle æ–¹æ³•ã€‚<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> b <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">b.toggle() <span class="comment">// true</span></span><br><span class="line">b.toggle() <span class="comment">// false</span></span><br></pre></td></tr></table></figure></p>
<h4 id="å…ƒç»„-a-b-c"><a href="#å…ƒç»„-a-b-c" class="headerlink" title="å…ƒç»„ (a, b, c)"></a>å…ƒç»„ (a, b, c)</h4><p>å…ƒç»„é‡Œçš„å€¼ç±»å‹å¯ä»¥æ˜¯ä¸åŒçš„ã€‚å…ƒç»„å¯ä»¥çœ‹æˆæ˜¯åŒ¿åç»“æ„ä½“ã€‚<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> t1 <span class="operator">=</span> (p1: <span class="number">1</span>, p2: <span class="string">&quot;two&quot;</span>, p3: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line"><span class="built_in">print</span>(t1.p1)</span><br><span class="line"><span class="built_in">print</span>(t1.p3)</span><br><span class="line"><span class="comment">// ç±»å‹æ¨å¯¼</span></span><br><span class="line"><span class="keyword">let</span> t2 <span class="operator">=</span> (<span class="number">1</span>, <span class="string">&quot;two&quot;</span>, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line"><span class="comment">// é€šè¿‡ä¸‹æ ‡è®¿é—®</span></span><br><span class="line"><span class="built_in">print</span>(t2.<span class="number">1</span>) <span class="comment">// two</span></span><br><span class="line"><span class="comment">// åˆ†è§£å…ƒç»„</span></span><br><span class="line"><span class="keyword">let</span> (dp1, dp2, <span class="keyword">_</span>) <span class="operator">=</span> t2</span><br><span class="line"><span class="built_in">print</span>(dp1)</span><br><span class="line"><span class="built_in">print</span>(dp2)</span><br></pre></td></tr></table></figure></p>
<h4 id="å­—ç¬¦ä¸²"><a href="#å­—ç¬¦ä¸²" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s1 <span class="operator">=</span> <span class="string">&quot;Hi! This is a string. Cool?&quot;</span></span><br><span class="line"><span class="comment">/// è½¬ä¹‰çˆ¶\nè¡¨ç¤ºæ¢è¡Œã€‚</span></span><br><span class="line"><span class="comment">/// å…¶å®ƒè½¬ä¹‰å­—ç¬¦æœ‰ \0 ç©ºå­—ç¬¦)ã€\t æ°´å¹³åˆ¶è¡¨ç¬¦ ã€\n æ¢è¡Œç¬¦ã€\r å›è½¦ç¬¦</span></span><br><span class="line"><span class="keyword">let</span> s2 <span class="operator">=</span> <span class="string">&quot;Hi!<span class="subst">\n</span>This is a string. Cool?&quot;</span></span><br><span class="line"><span class="comment">// å¤šè¡Œ</span></span><br><span class="line"><span class="keyword">let</span> s3 <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Hi!</span></span><br><span class="line"><span class="string">This is a string.</span></span><br><span class="line"><span class="string">Cool?</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment">// é•¿åº¦</span></span><br><span class="line"><span class="built_in">print</span>(s3.count)</span><br><span class="line"><span class="built_in">print</span>(s3.isEmpty)</span><br><span class="line"><span class="comment">// æ‹¼æ¥</span></span><br><span class="line"><span class="built_in">print</span>(s3 <span class="operator">+</span> <span class="string">&quot;<span class="subst">\n</span>Sure!&quot;</span>)</span><br><span class="line"><span class="comment">// å­—ç¬¦ä¸²ä¸­æ’å…¥å˜é‡</span></span><br><span class="line"><span class="keyword">let</span> i <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Today is good day, double <span class="subst">\(i)</span><span class="subst">\(i)</span>!&quot;</span>)</span><br><span class="line"><span class="comment">/// éå†å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">/// è¾“å‡ºï¼š</span></span><br><span class="line"><span class="comment">/// o</span></span><br><span class="line"><span class="comment">/// n</span></span><br><span class="line"><span class="comment">/// e</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> <span class="string">&quot;one&quot;</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(c)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æŸ¥æ‰¾</span></span><br><span class="line"><span class="built_in">print</span>(s3.lowercased().contains(<span class="string">&quot;cool&quot;</span>)) <span class="comment">// true</span></span><br><span class="line"><span class="comment">// æ›¿æ¢</span></span><br><span class="line"><span class="keyword">let</span> s4 <span class="operator">=</span> <span class="string">&quot;one is two&quot;</span></span><br><span class="line"><span class="keyword">let</span> newS4 <span class="operator">=</span> s4.replacingOccurrences(of: <span class="string">&quot;two&quot;</span>, with: <span class="string">&quot;one&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(newS4)</span><br><span class="line"><span class="comment">// åˆ é™¤ç©ºæ ¼å’Œæ¢è¡Œ</span></span><br><span class="line"><span class="keyword">let</span> s5 <span class="operator">=</span> <span class="string">&quot; Simple line. <span class="subst">\n</span><span class="subst">\n</span>  &quot;</span></span><br><span class="line"><span class="built_in">print</span>(s5.trimmingCharacters(in: .whitespacesAndNewlines))</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ‡å‰²æˆæ•°ç»„</span></span><br><span class="line"><span class="keyword">let</span> s6 <span class="operator">=</span> <span class="string">&quot;one/two/three&quot;</span></span><br><span class="line"><span class="keyword">let</span> a <span class="operator">=</span> s6.components(separatedBy: <span class="string">&quot;/&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(a) <span class="comment">// [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]</span></span><br></pre></td></tr></table></figure>
<p>Unicodeã€Character å’Œ SubString ç­‰å†…å®¹å‚è§å®˜æ–¹å­—ç¬¦ä¸²æ–‡æ¡£ï¼š <a href="https://docs.swift.org/swift-book/LanguageGuide/StringsAndCharacters.html">Strings and Characters â€” The Swift Programming Language (Swift 5.1)</a> </p>
<h4 id="æšä¸¾"><a href="#æšä¸¾" class="headerlink" title="æšä¸¾"></a>æšä¸¾</h4><p>Swiftçš„æšä¸¾æœ‰ç±»çš„ä¸€äº›ç‰¹æ€§ï¼Œæ¯”å¦‚è®¡ç®—å±æ€§ã€å®ä¾‹æ–¹æ³•ã€æ‰©å±•ã€éµå¾ªåè®®ç­‰ç­‰ã€‚<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">E1</span>:<span class="title">String</span>, <span class="title">CaseIterable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> e1, e2 <span class="operator">=</span> <span class="string">&quot;12&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å…³è”å€¼</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">E2</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> e1([<span class="type">String</span>])</span><br><span class="line">    <span class="keyword">case</span> e2(<span class="type">Int</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> e1 <span class="operator">=</span> <span class="type">E2</span>.e1([<span class="string">&quot;one&quot;</span>,<span class="string">&quot;two&quot;</span>])</span><br><span class="line"><span class="keyword">let</span> e2 <span class="operator">=</span> <span class="type">E2</span>.e2(<span class="number">3</span>)</span><br><span class="line"><span class="keyword">switch</span> e1 &#123;</span><br><span class="line"><span class="keyword">case</span> .e1(<span class="keyword">let</span> array):</span><br><span class="line">    <span class="built_in">print</span>(array)</span><br><span class="line"><span class="keyword">case</span> .e2(<span class="keyword">let</span> int):</span><br><span class="line">    <span class="built_in">print</span>(int)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(e2)</span><br><span class="line"><span class="comment">// åŸå§‹å€¼</span></span><br><span class="line"><span class="built_in">print</span>(<span class="type">E1</span>.e1.rawValue)</span><br><span class="line"><span class="comment">// éµå¾ª CaseIterable åè®®å¯è¿­ä»£</span></span><br><span class="line"><span class="keyword">for</span> ie <span class="keyword">in</span> <span class="type">E1</span>.allCases &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;show <span class="subst">\(ie)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é€’å½’æšä¸¾</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">RE</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> v(<span class="type">String</span>)</span><br><span class="line">    <span class="keyword">indirect</span> <span class="keyword">case</span> node(l:<span class="type">RE</span>, r:<span class="type">RE</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> lNode <span class="operator">=</span> <span class="type">RE</span>.v(<span class="string">&quot;left&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> rNode <span class="operator">=</span> <span class="type">RE</span>.v(<span class="string">&quot;right&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> pNode <span class="operator">=</span> <span class="type">RE</span>.node(l: lNode, r: rNode)</span><br><span class="line"><span class="keyword">switch</span> pNode &#123;</span><br><span class="line"><span class="keyword">case</span> .v(<span class="keyword">let</span> string):</span><br><span class="line">    <span class="built_in">print</span>(string)</span><br><span class="line"><span class="keyword">case</span> .node(<span class="keyword">let</span> l, <span class="keyword">let</span> r):</span><br><span class="line">    <span class="built_in">print</span>(l,r)</span><br><span class="line">    <span class="keyword">switch</span> l &#123;</span><br><span class="line">    <span class="keyword">case</span> .v(<span class="keyword">let</span> string):</span><br><span class="line">        <span class="built_in">print</span>(string)</span><br><span class="line">    <span class="keyword">case</span> .node(<span class="keyword">let</span> l, <span class="keyword">let</span> r):</span><br><span class="line">        <span class="built_in">print</span>(l, r)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">switch</span> r &#123;</span><br><span class="line">    <span class="keyword">case</span> .v(<span class="keyword">let</span> string):</span><br><span class="line">        <span class="built_in">print</span>(string)</span><br><span class="line">    <span class="keyword">case</span> .node(<span class="keyword">let</span> l, <span class="keyword">let</span> r):</span><br><span class="line">        <span class="built_in">print</span>(l, r)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="æ³›å‹"><a href="#æ³›å‹" class="headerlink" title="æ³›å‹"></a>æ³›å‹</h4><p>æ³›å‹å¯ä»¥å‡å°‘é‡å¤ä»£ç ï¼Œæ˜¯ä¸€ç§æŠ½è±¡çš„è¡¨è¾¾æ–¹å¼ã€‚where å…³é”®å­—å¯ä»¥å¯¹æ³›å‹åšçº¦æŸã€‚<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fn</span>&lt;<span class="type">T</span>&gt;(<span class="params">p</span>: <span class="type">T</span>)</span> -&gt; [<span class="type">T</span>] &#123;</span><br><span class="line">    <span class="keyword">var</span> r <span class="operator">=</span> [<span class="type">T</span>]()</span><br><span class="line">    r.append(p)</span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(fn(p: <span class="string">&quot;one&quot;</span>))</span><br><span class="line"><span class="comment">// ç»“æ„ä½“</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S1</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> arr <span class="operator">=</span> [<span class="type">T</span>]()</span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">add</span>(<span class="keyword">_</span> <span class="params">p</span>: <span class="type">T</span>)</span> &#123;</span><br><span class="line">        arr.append(p)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> s <span class="operator">=</span> <span class="type">S1</span>(arr: [<span class="string">&quot;zero&quot;</span>])</span><br><span class="line">s.add(<span class="string">&quot;one&quot;</span>)</span><br><span class="line">s.add(<span class="string">&quot;two&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(s.arr) <span class="comment">// [&quot;zero&quot;, &quot;one&quot;, &quot;two&quot;]</span></span><br></pre></td></tr></table></figure></p>
<p>å…³è”ç±»å‹<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">pc</span> </span>&#123;</span><br><span class="line">    <span class="keyword">associatedtype</span> <span class="type">T</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">add</span>(<span class="keyword">_</span> <span class="params">p</span>: <span class="type">T</span>)</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S2</span>: <span class="title">pc</span> </span>&#123;</span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">T</span> <span class="operator">=</span> <span class="type">String</span> <span class="comment">// ç±»å‹æ¨å¯¼ï¼Œå¯çœç•¥</span></span><br><span class="line">    <span class="keyword">var</span> strs <span class="operator">=</span> [<span class="type">String</span>]()</span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">add</span>(<span class="keyword">_</span> <span class="params">p</span>: <span class="type">String</span>)</span> &#123;</span><br><span class="line">        strs.append(p)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="ä¸é€æ˜ç±»å‹"><a href="#ä¸é€æ˜ç±»å‹" class="headerlink" title="ä¸é€æ˜ç±»å‹"></a>ä¸é€æ˜ç±»å‹</h4><p>ä¸é€æ˜ç±»å‹ä¼šéšè—ç±»å‹ï¼Œè®©ä½¿ç”¨è€…æ›´å…³æ³¨åŠŸèƒ½ã€‚ä¸é€æ˜ç±»å‹å’Œåè®®å¾ˆç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯ä¸é€æ˜æ¯”åè®®é™å®šçš„è¦å¤šï¼Œåè®®èƒ½å¤Ÿå¯¹åº”æ›´å¤šç±»å‹ã€‚<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">f</span>()</span> -&gt; <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S1</span>: <span class="title">P</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">f</span>()</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;one<span class="subst">\n</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S2</span>&lt;<span class="title">T</span>: <span class="title">P</span>&gt;: <span class="title">P</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p: <span class="type">T</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">f</span>()</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> p.f() <span class="operator">+</span> <span class="string">&quot;two<span class="subst">\n</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S3</span>&lt;<span class="title">T1</span>: <span class="title">P</span>, <span class="title">T2</span>: <span class="title">P</span>&gt;: <span class="title">P</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p1: <span class="type">T1</span></span><br><span class="line">    <span class="keyword">var</span> p2: <span class="type">T2</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">f</span>()</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> p1.f() <span class="operator">+</span> p2.f() <span class="operator">+</span> <span class="string">&quot;three<span class="subst">\n</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">someP</span>()</span> -&gt; <span class="keyword">some</span> <span class="type">P</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">S3</span>(p1: <span class="type">S1</span>(), p2: <span class="type">S2</span>(p: <span class="type">S1</span>()))</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> r <span class="operator">=</span> someP()</span><br><span class="line"><span class="built_in">print</span>(r.f())</span><br></pre></td></tr></table></figure></p>
<h4 id="ç±»å‹è½¬æ¢"><a href="#ç±»å‹è½¬æ¢" class="headerlink" title="ç±»å‹è½¬æ¢"></a>ç±»å‹è½¬æ¢</h4><p>ä½¿ç”¨ is å…³é”®å­—è¿›è¡Œç±»å‹åˆ¤æ–­ï¼Œ ä½¿ç”¨ as å…³é”®å­—æ¥è½¬æ¢æˆå­ç±»ã€‚<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">S0</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">S1</span>: <span class="title">S0</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">S2</span>: <span class="title">S0</span> </span>&#123;&#125;</span><br><span class="line"><span class="keyword">var</span> a <span class="operator">=</span> [<span class="type">S0</span>]()</span><br><span class="line">a.append(<span class="type">S1</span>())</span><br><span class="line">a.append(<span class="type">S2</span>())</span><br><span class="line"><span class="keyword">for</span> e <span class="keyword">in</span> a &#123;</span><br><span class="line">    <span class="comment">// ç±»å‹åˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span> e <span class="keyword">is</span> <span class="type">S1</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Type is S1&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> e <span class="keyword">is</span> <span class="type">S2</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Type is S2&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ as å…³é”®å­—è½¬æ¢æˆå­ç±»</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> s1 <span class="operator">=</span> e <span class="keyword">as?</span> <span class="type">S1</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;As S1 <span class="subst">\(s1)</span>&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> s2 <span class="operator">=</span> e <span class="keyword">as?</span> <span class="type">S2</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;As S2 <span class="subst">\(s2)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="ç±»å’Œç»“æ„ä½“"><a href="#ç±»å’Œç»“æ„ä½“" class="headerlink" title="ç±»å’Œç»“æ„ä½“"></a>ç±»å’Œç»“æ„ä½“</h3><h4 id="ç±»"><a href="#ç±»" class="headerlink" title="ç±»"></a>ç±»</h4><p>ç±»å¯ä»¥å®šä¹‰å±æ€§ã€æ–¹æ³•ã€æ„é€ å™¨ã€ä¸‹æ ‡æ“ä½œã€‚ç±»ä½¿ç”¨æ‰©å±•æ¥æ‰©å±•åŠŸèƒ½ï¼Œéµå¾ªåè®®ã€‚ç±»è¿˜ä»¥ç»§æ‰¿ï¼Œè¿è¡Œæ—¶æ£€æŸ¥å®ä¾‹ç±»å‹ã€‚<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</span><br><span class="line">     <span class="keyword">var</span> p: <span class="type">String</span></span><br><span class="line">     <span class="function"><span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">p</span>: <span class="type">String</span>)</span> &#123;</span><br><span class="line">         <span class="keyword">self</span>.p <span class="operator">=</span> p</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="comment">// ä¸‹æ ‡æ“ä½œ</span></span><br><span class="line">     <span class="function"><span class="keyword">subscript</span>(<span class="params">s</span>: <span class="type">String</span>)</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">         <span class="keyword">get</span> &#123;</span><br><span class="line">             <span class="keyword">return</span> p <span class="operator">+</span> s</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">set</span> &#123;</span><br><span class="line">             p <span class="operator">=</span> s <span class="operator">+</span> newValue</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">let</span> c <span class="operator">=</span> <span class="type">C</span>(<span class="string">&quot;hi&quot;</span>)</span><br><span class="line"> <span class="built_in">print</span>(c.p)</span><br><span class="line"> <span class="built_in">print</span>(c[<span class="string">&quot; ming&quot;</span>])</span><br><span class="line"> c[<span class="string">&quot;k&quot;</span>] <span class="operator">=</span> <span class="string">&quot;v&quot;</span></span><br><span class="line"> <span class="built_in">print</span>(c.p)</span><br></pre></td></tr></table></figure></p>
<h4 id="ç»“æ„ä½“"><a href="#ç»“æ„ä½“" class="headerlink" title="ç»“æ„ä½“"></a>ç»“æ„ä½“</h4><p>ç»“æ„ä½“æ˜¯å€¼ç±»å‹ï¼Œå¯ä»¥å®šä¹‰å±æ€§ã€æ–¹æ³•ã€æ„é€ å™¨ã€ä¸‹æ ‡æ“ä½œã€‚ç»“æ„ä½“ä½¿ç”¨æ‰©å±•æ¥æ‰©å±•åŠŸèƒ½ï¼Œéµå¾ªåè®®ã€‚<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p1: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">var</span> p2: <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">S</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">f</span>()</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> p1 <span class="operator">+</span> <span class="type">String</span>(p2)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> s <span class="operator">=</span> <span class="type">S</span>(p2: <span class="number">1</span>)</span><br><span class="line">s.p1 <span class="operator">=</span> <span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="built_in">print</span>(s.f()) <span class="comment">// 11</span></span><br></pre></td></tr></table></figure></p>
<h4 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h4><p>ç±»ã€ç»“æ„ä½“æˆ–æšä¸¾é‡Œçš„å˜é‡å¸¸é‡å°±æ˜¯ä»–ä»¬çš„å±æ€§ã€‚<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> sp <span class="operator">=</span> <span class="string">&quot;ç±»å‹å±æ€§&quot;</span> <span class="comment">// ç±»å‹å±æ€§é€šè¿‡ç±»å‹æœ¬èº«è®¿é—®ï¼Œéå®ä¾‹è®¿é—®</span></span><br><span class="line">    <span class="keyword">var</span> p1: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">var</span> p2: <span class="type">Int</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">    <span class="comment">// cp æ˜¯è®¡ç®—å±æ€§</span></span><br><span class="line">    <span class="keyword">var</span> cp: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> p2 <span class="operator">*</span> <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            p2 <span class="operator">=</span> newValue <span class="operator">+</span> <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åªæœ‰ getter çš„æ˜¯åªè¯»è®¡ç®—å±æ€§</span></span><br><span class="line">    <span class="keyword">var</span> rcp: <span class="type">Int</span> &#123;</span><br><span class="line">        p2 <span class="operator">*</span> <span class="number">4</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="type">S</span>.sp)</span><br><span class="line"><span class="built_in">print</span>(<span class="type">S</span>().cp) <span class="comment">// 2</span></span><br><span class="line"><span class="keyword">var</span> s <span class="operator">=</span> <span class="type">S</span>()</span><br><span class="line">s.cp <span class="operator">=</span> <span class="number">3</span></span><br><span class="line"><span class="built_in">print</span>(s.p2) <span class="comment">// 5</span></span><br><span class="line"><span class="built_in">print</span>(<span class="type">S</span>().rcp) <span class="comment">// 4</span></span><br></pre></td></tr></table></figure></p>
<p>willSet å’Œ didSet æ˜¯å±æ€§è§‚å¯Ÿå™¨ï¼Œå¯ä»¥åœ¨å±æ€§å€¼è®¾ç½®å‰åæ’å…¥è‡ªå·±çš„é€»è¾‘å¤„ç†ã€‚</p>
<h4 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">E</span>: <span class="title">String</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> one, two, three</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">showRawValue</span>()</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(rawValue)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> e <span class="operator">=</span> <span class="type">E</span>.three</span><br><span class="line">e.showRawValue() <span class="comment">// three</span></span><br><span class="line"><span class="comment">// å¯å˜çš„å®ä¾‹æ–¹æ³•ï¼Œä½¿ç”¨ mutating æ ‡è®°</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p: <span class="type">String</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">addFullStopForP</span>()</span> &#123;</span><br><span class="line">        p <span class="operator">+=</span> <span class="string">&quot;.&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> s <span class="operator">=</span> <span class="type">S</span>(p: <span class="string">&quot;hi&quot;</span>)</span><br><span class="line">s.addFullStopForP()</span><br><span class="line"><span class="built_in">print</span>(s.p)</span><br><span class="line"><span class="comment">// ç±»æ–¹æ³•</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">cf</span>() </span>&#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ç±»æ–¹æ³•&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>staticå’Œclasså…³é”®å­—ä¿®é¥°çš„æ–¹æ³•ç±»ä¼¼ OC çš„ç±»æ–¹æ³•ã€‚static å¯ä»¥ä¿®é¥°å­˜å‚¨å±æ€§ï¼Œè€Œ class ä¸èƒ½ï¼›class ä¿®é¥°çš„æ–¹æ³•å¯ä»¥ç»§æ‰¿ï¼Œè€Œ static ä¸èƒ½ã€‚åœ¨åè®®ä¸­éœ€ç”¨ static æ¥ä¿®é¥°ã€‚</p>
<h4 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h4><p>ç±»èƒ½ç»§æ‰¿å¦ä¸€ä¸ªç±»ï¼Œç»§æ‰¿å®ƒçš„æ–¹æ³•ã€å±æ€§ç­‰ã€‚<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç±»ç»§æ‰¿</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C1</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p1: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> cp1: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> p1 <span class="operator">+</span> <span class="string">&quot; like ATM&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            p1 <span class="operator">=</span> p1 <span class="operator">+</span> newValue</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">init</span>(<span class="params">p1</span>: <span class="type">String</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.p1 <span class="operator">=</span> p1</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">sayHi</span>()</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Hi! <span class="subst">\(p1)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C2</span>: <span class="title">C1</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p2: <span class="type">String</span></span><br><span class="line">    <span class="function"><span class="keyword">init</span>(<span class="params">p2</span>: <span class="type">String</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.p2 <span class="operator">=</span> p2</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(p1: p2 <span class="operator">+</span> <span class="string">&quot;&#x27;s father&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">C2</span>(p2: <span class="string">&quot;Lemon&quot;</span>).sayHi() <span class="comment">// Hi! Lemon&#x27;s father</span></span><br><span class="line"><span class="comment">// é‡å†™çˆ¶ç±»æ–¹æ³•</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C3</span>: <span class="title">C2</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">sayHi</span>()</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Hi! <span class="subst">\(p2)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">C3</span>(p2: <span class="string">&quot;Lemon&quot;</span>).sayHi() <span class="comment">// Hi! Lemon</span></span><br><span class="line"><span class="comment">// é‡å†™è®¡ç®—å±æ€§</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C4</span>: <span class="title">C1</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> cp1: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> p1 <span class="operator">+</span> <span class="string">&quot; like Out of the blade&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            p1 <span class="operator">=</span> p1 <span class="operator">+</span> newValue</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="type">C1</span>(p1: <span class="string">&quot;Lemon&quot;</span>).cp1)### <span class="comment">// Lemon like ATM</span></span><br><span class="line"><span class="built_in">print</span>(<span class="type">C4</span>(p1: <span class="string">&quot;Lemon&quot;</span>).cp1)### <span class="comment">// Lemon like</span></span><br><span class="line"><span class="type">Out</span> of the blade</span><br></pre></td></tr></table></figure></p>
<p>é€šè¿‡ final å…³é”®å­—å¯ä»¥é˜²æ­¢ç±»è¢«ç»§æ‰¿ï¼Œfinal è¿˜å¯ä»¥ç”¨äºå±æ€§å’Œæ–¹æ³•ã€‚ä½¿ç”¨ super å…³é”®å­—æŒ‡ä»£çˆ¶ç±»ã€‚</p>
<h3 id="å‡½æ•°å¼"><a href="#å‡½æ•°å¼" class="headerlink" title="å‡½æ•°å¼"></a>å‡½æ•°å¼</h3><h4 id="map"><a href="#map" class="headerlink" title="map"></a>map</h4><p>map å¯ä»¥ä¾æ¬¡å¤„ç†æ•°ç»„ä¸­å…ƒç´ ï¼Œå¹¶è¿”å›ä¸€ä¸ªå¤„ç†åçš„æ–°æ•°ç»„ã€‚<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a1 <span class="operator">=</span> [<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>]</span><br><span class="line"><span class="keyword">let</span> a2 <span class="operator">=</span> a1.map &#123;</span><br><span class="line">    <span class="string">&quot;<span class="subst">\(<span class="variable">$0</span>)</span>2&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(a2) <span class="comment">// [&quot;a2&quot;, &quot;b2&quot;, &quot;c2&quot;]</span></span><br></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨ compactMap å¯ä»¥è¿‡æ»¤ nil çš„å…ƒç´ ã€‚flatMap ä¼šå°†å¤šä¸ªæ•°ç»„åˆæˆä¸€ä¸ªæ•°ç»„è¿”å›ã€‚</p>
<h4 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h4><p>æ ¹æ®æŒ‡å®šæ¡ä»¶è¿”å›<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a1 <span class="operator">=</span> [<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;call my name&quot;</span>]</span><br><span class="line"><span class="keyword">let</span> a2 <span class="operator">=</span> a1.filter &#123;</span><br><span class="line">    <span class="variable">$0</span>.prefix(<span class="number">1</span>) <span class="operator">==</span> <span class="string">&quot;c&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(a2) <span class="comment">// [&quot;c&quot;, &quot;call my name&quot;]</span></span><br></pre></td></tr></table></figure></p>
<h4 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h4><p>reduce å¯ä»¥å°†è¿­ä»£ä¸­è¿”å›çš„ç»“æœç”¨äºä¸‹ä¸ªè¿­ä»£ä¸­ï¼Œå¹¶ï¼Œè¿˜èƒ½è®©ä½ è®¾ä¸ªåˆå§‹å€¼ã€‚<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a1 <span class="operator">=</span> [<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;call my name.&quot;</span>, <span class="string">&quot;get it?&quot;</span>]</span><br><span class="line"><span class="keyword">let</span> a2 <span class="operator">=</span> a1.reduce(<span class="string">&quot;Hey u,&quot;</span>, &#123; partialResult, s <span class="keyword">in</span></span><br><span class="line">    <span class="comment">// partialResult æ˜¯å‰é¢è¿”å›çš„å€¼ï¼Œs æ˜¯éå†åˆ°å½“å‰çš„å€¼</span></span><br><span class="line">    partialResult <span class="operator">+</span> <span class="string">&quot; <span class="subst">\(s)</span>&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">print</span>(a2) <span class="comment">// Hey u, a b c call my name. get it?</span></span><br></pre></td></tr></table></figure></p>
<h4 id="sorted"><a href="#sorted" class="headerlink" title="sorted"></a>sorted</h4><p>æ’åº<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç±»å‹éµå¾ª Comparable</span></span><br><span class="line"><span class="keyword">let</span> a1 <span class="operator">=</span> [<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;call my name.&quot;</span>, <span class="string">&quot;get it?&quot;</span>]</span><br><span class="line"><span class="keyword">let</span> a2 <span class="operator">=</span> a1.sorted()</span><br><span class="line"><span class="keyword">let</span> a3 <span class="operator">=</span> a1.sorted(by: <span class="operator">&gt;</span>)</span><br><span class="line"><span class="keyword">let</span> a4 <span class="operator">=</span> a1.sorted(by: <span class="operator">&lt;</span>)</span><br><span class="line"><span class="built_in">print</span>(a2) <span class="comment">// a b c call my name. get it?</span></span><br><span class="line"><span class="built_in">print</span>(a3) <span class="comment">// [&quot;get it?&quot;, &quot;call my name.&quot;, &quot;c&quot;, &quot;b&quot;, &quot;a&quot;]</span></span><br><span class="line"><span class="built_in">print</span>(a4) <span class="comment">// [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;call my name.&quot;, &quot;get it?&quot;]</span></span><br><span class="line"><span class="comment">// ç±»å‹ä¸éµå¾ª Comparable</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> s: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> i: <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a5 <span class="operator">=</span> [<span class="type">S</span>(s: <span class="string">&quot;a&quot;</span>, i: <span class="number">0</span>), <span class="type">S</span>(s: <span class="string">&quot;b&quot;</span>, i: <span class="number">1</span>), <span class="type">S</span>(s: <span class="string">&quot;c&quot;</span>, i: <span class="number">2</span>)]</span><br><span class="line"><span class="keyword">let</span> a6 <span class="operator">=</span> a5</span><br><span class="line">    .sorted &#123; l, r <span class="keyword">in</span></span><br><span class="line">        l.i <span class="operator">&gt;</span> r.i</span><br><span class="line">    &#125;</span><br><span class="line">    .map &#123;</span><br><span class="line">        <span class="variable">$0</span>.i</span><br><span class="line">    &#125;</span><br><span class="line"><span class="built_in">print</span>(a6) <span class="comment">// [2, 1, 0]</span></span><br></pre></td></tr></table></figure></p>
<h3 id="æ§åˆ¶æµ"><a href="#æ§åˆ¶æµ" class="headerlink" title="æ§åˆ¶æµ"></a>æ§åˆ¶æµ</h3><h4 id="If-If-let-If-case-let"><a href="#If-If-let-If-case-let" class="headerlink" title="If  If let  If case let"></a>If <em> If let </em> If case let</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// if</span></span><br><span class="line"><span class="keyword">let</span> s <span class="operator">=</span> <span class="string">&quot;hi&quot;</span></span><br><span class="line"><span class="keyword">if</span> s.isEmpty &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;String is Empty&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;String is <span class="subst">\(s)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä¸‰å…ƒæ¡ä»¶</span></span><br><span class="line">s.isEmpty <span class="operator">?</span> <span class="built_in">print</span>(<span class="string">&quot;String is Empty again&quot;</span>) : <span class="built_in">print</span>(<span class="string">&quot;String is <span class="subst">\(s)</span> again&quot;</span>)</span><br><span class="line"><span class="comment">// if let-else</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span>(<span class="params">s</span>: <span class="type">String</span>?)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> s1 <span class="operator">=</span> s &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;s1 is <span class="subst">\(s1)</span>&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;s1 is nothing&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// nil-coalescing</span></span><br><span class="line">    <span class="keyword">let</span> s2 <span class="operator">=</span> s <span class="operator">??</span> <span class="string">&quot;nothing&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;s2 is <span class="subst">\(s2)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">f(s: <span class="string">&quot;something&quot;</span>)</span><br><span class="line">f(s: <span class="literal">nil</span>)</span><br><span class="line"><span class="comment">// if case let</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">E</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> c1(<span class="type">String</span>)</span><br><span class="line">    <span class="keyword">case</span> c2([<span class="type">String</span>])</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">des</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> .c1(<span class="keyword">let</span> string):</span><br><span class="line">            <span class="built_in">print</span>(string)</span><br><span class="line">        <span class="keyword">case</span> .c2(<span class="keyword">let</span> array):</span><br><span class="line">            <span class="built_in">print</span>(array)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">E</span>.c1(<span class="string">&quot;enum c1&quot;</span>).des()</span><br><span class="line"><span class="type">E</span>.c2([<span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>, <span class="string">&quot;three&quot;</span>]).des()</span><br></pre></td></tr></table></figure>
<h4 id="Guard-guard-guard-let"><a href="#Guard-guard-guard-let" class="headerlink" title="Guard guard, guard let"></a>Guard guard, guard let</h4><p>æ›´å¥½åœ°å¤„ç†å¼‚å¸¸æƒ…å†µ<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// guard</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span>(<span class="params">p</span>: <span class="type">String</span>)</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> p.isEmpty <span class="operator">!=</span> <span class="literal">true</span> <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Empty string.&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;String <span class="subst">\(p)</span> is not empty.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(f1(p: <span class="string">&quot;&quot;</span>)) <span class="comment">// Empty string.</span></span><br><span class="line"><span class="built_in">print</span>(f1(p: <span class="string">&quot;lemon&quot;</span>)) <span class="comment">// String lemon is not empty.</span></span><br><span class="line"><span class="comment">// guard let</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f2</span>(<span class="params">p1</span>: <span class="type">String</span>?)</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> p2 <span class="operator">=</span> p1 <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Nil.&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;String <span class="subst">\(p2)</span> is not nil.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(f2(p1: <span class="literal">nil</span>)) <span class="comment">// Nil.</span></span><br><span class="line"><span class="built_in">print</span>(f2(p1: <span class="string">&quot;lemon&quot;</span>)) <span class="comment">// String lemon is not nil.</span></span><br></pre></td></tr></table></figure></p>
<h4 id="For-in"><a href="#For-in" class="headerlink" title="For-in"></a>For-in</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a <span class="operator">=</span> [<span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>, <span class="string">&quot;three&quot;</span>]</span><br><span class="line"><span class="keyword">for</span> str <span class="keyword">in</span> a &#123;</span><br><span class="line">    <span class="built_in">print</span>(str)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä½¿ç”¨ä¸‹æ ‡èŒƒå›´</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span><span class="number">10</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä½¿ç”¨ enumerated</span></span><br><span class="line"><span class="keyword">for</span> (i, str) <span class="keyword">in</span> a.enumerated() &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ç¬¬<span class="subst">\(i <span class="operator">+</span> <span class="number">1</span>)</span>ä¸ªæ˜¯:<span class="subst">\(str)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// for in where</span></span><br><span class="line"><span class="keyword">for</span> str <span class="keyword">in</span> a <span class="keyword">where</span> str.prefix(<span class="number">1</span>) <span class="operator">==</span> <span class="string">&quot;t&quot;</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(str)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å­—å…¸ for inï¼Œéå†æ˜¯æ— åºçš„</span></span><br><span class="line"><span class="keyword">let</span> dic <span class="operator">=</span> [</span><br><span class="line">    <span class="string">&quot;one&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&quot;two&quot;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&quot;three&quot;</span>: <span class="number">3</span></span><br><span class="line">]</span><br><span class="line"><span class="keyword">for</span> (k, v) <span class="keyword">in</span> dic &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;key is <span class="subst">\(k)</span>, value is <span class="subst">\(v)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// stride</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">stride</span>(from: <span class="number">10</span>, through: <span class="number">0</span>, by: <span class="operator">-</span><span class="number">2</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> 10</span></span><br><span class="line"><span class="comment"> 8</span></span><br><span class="line"><span class="comment"> 6</span></span><br><span class="line"><span class="comment"> 4</span></span><br><span class="line"><span class="comment"> 2</span></span><br><span class="line"><span class="comment"> 0</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>
<h4 id="While-while-repeat-while"><a href="#While-while-repeat-while" class="headerlink" title="While while, repeat-while"></a>While while, repeat-while</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// while</span></span><br><span class="line"><span class="keyword">var</span> i1 <span class="operator">=</span> <span class="number">10</span></span><br><span class="line"><span class="keyword">while</span> i1 <span class="operator">&gt;</span> <span class="number">0</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;positive even number <span class="subst">\(i1)</span>&quot;</span>)</span><br><span class="line">    i1 <span class="operator">-=</span> <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// repeat while</span></span><br><span class="line"><span class="keyword">var</span> i2 <span class="operator">=</span> <span class="number">10</span></span><br><span class="line"><span class="keyword">repeat</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;positive even number <span class="subst">\(i2)</span>&quot;</span>)</span><br><span class="line">    i2 <span class="operator">-=</span> <span class="number">2</span></span><br><span class="line">&#125; <span class="keyword">while</span> i2 <span class="operator">&gt;</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ break ç»“æŸéå†ï¼Œä½¿ç”¨ continue è·³è¿‡å½“å‰ä½œç”¨åŸŸï¼Œç»§ç»­ä¸‹ä¸ªå¾ªç¯</p>
<h4 id="Switch"><a href="#Switch" class="headerlink" title="Switch"></a>Switch</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span>(<span class="params">pa</span>: <span class="type">String</span>, <span class="params">t</span>:(<span class="type">String</span>, <span class="type">Int</span>))</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> p1 <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> p2 <span class="operator">=</span> <span class="number">10</span></span><br><span class="line">    <span class="keyword">switch</span> pa &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;one&quot;</span>:</span><br><span class="line">        p1 <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;two&quot;</span>:</span><br><span class="line">        p1 <span class="operator">=</span> <span class="number">2</span></span><br><span class="line">        <span class="keyword">fallthrough</span> <span class="comment">// ç»§ç»­åˆ°ä¸‹ä¸ª case ä¸­</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        p2 <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;p1 is <span class="subst">\(p1)</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;p2 is <span class="subst">\(p2)</span>&quot;</span>)</span><br><span class="line">    <span class="comment">// å…ƒç»„</span></span><br><span class="line">    <span class="keyword">switch</span> t &#123;</span><br><span class="line">    <span class="keyword">case</span> (<span class="string">&quot;0&quot;</span>, <span class="number">0</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;zero&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> (<span class="string">&quot;1&quot;</span>, <span class="number">1</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;one&quot;</span>)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;no&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">f1(pa: <span class="string">&quot;two&quot;</span>, t:(<span class="string">&quot;1&quot;</span>, <span class="number">1</span>))</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> p1 is 2</span></span><br><span class="line"><span class="comment"> p2 is 0</span></span><br><span class="line"><span class="comment"> one</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// æšä¸¾</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">E</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> one, two, three, unknown(<span class="type">String</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f2</span>(<span class="params">pa</span>: <span class="type">E</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> p: <span class="type">String</span></span><br><span class="line">    <span class="keyword">switch</span> pa &#123;</span><br><span class="line">    <span class="keyword">case</span> .one:</span><br><span class="line">        p <span class="operator">=</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">    <span class="keyword">case</span> .two:</span><br><span class="line">        p <span class="operator">=</span> <span class="string">&quot;2&quot;</span></span><br><span class="line">    <span class="keyword">case</span> .three:</span><br><span class="line">        p <span class="operator">=</span> <span class="string">&quot;3&quot;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> .unknown(u) <span class="keyword">where</span> <span class="type">Int</span>(u) <span class="operator">??</span> <span class="number">0</span> <span class="operator">&gt;</span> <span class="number">0</span> : <span class="comment">// æšä¸¾å…³è”å€¼ï¼Œä½¿ç”¨ where å¢åŠ æ¡ä»¶</span></span><br><span class="line">        p <span class="operator">=</span> u</span><br><span class="line">    <span class="keyword">case</span> .unknown(<span class="keyword">_</span>):</span><br><span class="line">        p <span class="operator">=</span> <span class="string">&quot;negative number&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">print</span>(p)</span><br><span class="line">&#125;</span><br><span class="line">f2(pa: <span class="type">E</span>.one) <span class="comment">// 1</span></span><br><span class="line">f2(pa: <span class="type">E</span>.unknown(<span class="string">&quot;10&quot;</span>)) <span class="comment">// 10</span></span><br><span class="line">f2(pa: <span class="type">E</span>.unknown(<span class="string">&quot;-10&quot;</span>)) <span class="comment">// negative number</span></span><br></pre></td></tr></table></figure>
<h3 id="é›†åˆ"><a href="#é›†åˆ" class="headerlink" title="é›†åˆ"></a>é›†åˆ</h3><h4 id="æ•°ç»„-1-2-3"><a href="#æ•°ç»„-1-2-3" class="headerlink" title="æ•°ç»„ [1, 2, 3]"></a>æ•°ç»„ [1, 2, 3]</h4><p>æ•°ç»„æ˜¯æœ‰åºé›†åˆ<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a0: [<span class="type">Int</span>] <span class="operator">=</span> [<span class="number">1</span>, <span class="number">10</span>]</span><br><span class="line">a0.append(<span class="number">2</span>)</span><br><span class="line">a0.remove(at: <span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(a0) <span class="comment">// [10, 2]</span></span><br><span class="line"><span class="keyword">let</span> a1 <span class="operator">=</span> [<span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>, <span class="string">&quot;three&quot;</span>]</span><br><span class="line"><span class="keyword">let</span> a2 <span class="operator">=</span> [<span class="string">&quot;three&quot;</span>, <span class="string">&quot;four&quot;</span>]</span><br><span class="line"><span class="comment">// æ‰¾ä¸¤ä¸ªé›†åˆçš„ä¸åŒ</span></span><br><span class="line"><span class="keyword">let</span> dif <span class="operator">=</span> a1.difference(from: a2) <span class="comment">// swiftçš„ diffing ç®—æ³•åœ¨è¿™ http://www.xmailserver.org/diff2.pdf swiftå®ç°åœ¨  swift/stdlib/public/core/Diffing.swift</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> dif &#123;</span><br><span class="line">    <span class="keyword">switch</span> c &#123;</span><br><span class="line">    <span class="keyword">case</span> .remove(<span class="keyword">let</span> o, <span class="keyword">let</span> e, <span class="keyword">let</span> a):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;offset:<span class="subst">\(o)</span>, element:<span class="subst">\(e)</span>, associatedWith:<span class="subst">\(String(describing: a))</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> .insert(<span class="keyword">let</span> o, <span class="keyword">let</span> e, <span class="keyword">let</span> a):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;offset:<span class="subst">\(o)</span>, element:<span class="subst">\(e)</span>, associatedWith:<span class="subst">\(String(describing: a))</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> remove offset:1, element:four, associatedWith:nil</span></span><br><span class="line"><span class="comment"> insert offset:0, element:one, associatedWith:nil</span></span><br><span class="line"><span class="comment"> insert offset:1, element:two, associatedWith:nil</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> a3 <span class="operator">=</span> a2.applying(dif) <span class="operator">??</span> [] <span class="comment">// å¯ä»¥ç”¨äºæ·»åŠ åˆ é™¤åŠ¨ç”»</span></span><br><span class="line"><span class="built_in">print</span>(a3) <span class="comment">// [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]</span></span><br></pre></td></tr></table></figure></p>
<h4 id="Sets-Set"><a href="#Sets-Set" class="headerlink" title="Sets Set"></a>Sets Set<Int></h4><p>Set æ˜¯æ— åºé›†åˆï¼Œå…ƒç´ å”¯ä¸€<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s0: <span class="type">Set</span>&lt;<span class="type">Int</span>&gt; <span class="operator">=</span> [<span class="number">2</span>, <span class="number">4</span>]</span><br><span class="line"><span class="keyword">let</span> s1: <span class="type">Set</span> <span class="operator">=</span> [<span class="number">2</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">8</span>]</span><br><span class="line"><span class="keyword">let</span> s2: <span class="type">Set</span> <span class="operator">=</span> [<span class="number">7</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">10</span>]</span><br><span class="line"><span class="keyword">let</span> s3 <span class="operator">=</span> s1.union(s2) <span class="comment">// åˆé›†</span></span><br><span class="line"><span class="keyword">let</span> s4 <span class="operator">=</span> s1.intersection(s2) <span class="comment">// äº¤é›†</span></span><br><span class="line"><span class="keyword">let</span> s5 <span class="operator">=</span> s1.subtracting(s2) <span class="comment">// éäº¤é›†éƒ¨åˆ†</span></span><br><span class="line"><span class="keyword">let</span> s6 <span class="operator">=</span> s1.symmetricDifference(s2) <span class="comment">// éäº¤é›†çš„åˆé›†</span></span><br><span class="line"><span class="built_in">print</span>(s3) <span class="comment">// [4, 2, 1, 7, 3, 10, 8, 9, 6, 5]</span></span><br><span class="line"><span class="built_in">print</span>(s4) <span class="comment">// [10]</span></span><br><span class="line"><span class="built_in">print</span>(s5) <span class="comment">// [8, 4, 2, 6]</span></span><br><span class="line"><span class="built_in">print</span>(s6) <span class="comment">// [9, 1, 3, 4, 5, 2, 6, 8, 7]</span></span><br><span class="line"><span class="comment">// s0 æ˜¯å¦è¢« s1 åŒ…å«</span></span><br><span class="line"><span class="built_in">print</span>(s0.isSubset(of: s1)) <span class="comment">// true</span></span><br><span class="line"><span class="comment">// s1 æ˜¯å¦åŒ…å«äº† s0</span></span><br><span class="line"><span class="built_in">print</span>(s1.isSuperset(of: s0)) <span class="comment">// true</span></span><br><span class="line"><span class="keyword">let</span> s7: <span class="type">Set</span> <span class="operator">=</span> [<span class="number">3</span>, <span class="number">5</span>]</span><br><span class="line"><span class="comment">// s0 å’Œ s7 æ˜¯å¦æœ‰äº¤é›†</span></span><br><span class="line"><span class="built_in">print</span>(s0.isDisjoint(with: s7)) <span class="comment">// true</span></span><br><span class="line"><span class="comment">// å¯å˜ Set</span></span><br><span class="line"><span class="keyword">var</span> s8: <span class="type">Set</span> <span class="operator">=</span> [<span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>]</span><br><span class="line">s8.insert(<span class="string">&quot;three&quot;</span>)</span><br><span class="line">s8.remove(<span class="string">&quot;one&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(s8) <span class="comment">// [&quot;two&quot;, &quot;three&quot;]</span></span><br></pre></td></tr></table></figure></p>
<h4 id="å­—å…¸"><a href="#å­—å…¸" class="headerlink" title="å­—å…¸ [:]"></a>å­—å…¸ [:]</h4><p>å­—å…¸æ˜¯æ— åºé›†åˆï¼Œé”®å€¼å¯¹åº”ã€‚<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> d <span class="operator">=</span> [</span><br><span class="line">    <span class="string">&quot;k1&quot;</span>: <span class="string">&quot;v1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;k2&quot;</span>: <span class="string">&quot;v2&quot;</span></span><br><span class="line">]</span><br><span class="line">d[<span class="string">&quot;k3&quot;</span>] <span class="operator">=</span> <span class="string">&quot;v3&quot;</span></span><br><span class="line">d[<span class="string">&quot;k4&quot;</span>] <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"><span class="built_in">print</span>(d) <span class="comment">// [&quot;k2&quot;: &quot;v2&quot;, &quot;k3&quot;: &quot;v3&quot;, &quot;k1&quot;: &quot;v1&quot;]</span></span><br><span class="line"><span class="keyword">for</span> (k, v) <span class="keyword">in</span> d &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;key is <span class="subst">\(k)</span>, value is <span class="subst">\(v)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> key is k1, value is v1</span></span><br><span class="line"><span class="comment"> key is k2, value is v2</span></span><br><span class="line"><span class="comment"> key is k3, value is v3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">if</span> d.isEmpty <span class="operator">==</span> <span class="literal">false</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(d.count) <span class="comment">// 3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="æ“ä½œç¬¦"><a href="#æ“ä½œç¬¦" class="headerlink" title="æ“ä½œç¬¦"></a>æ“ä½œç¬¦</h3><h4 id="èµ‹å€¼"><a href="#èµ‹å€¼" class="headerlink" title="èµ‹å€¼ =, +=. -=, *=, /="></a>èµ‹å€¼ =, +=. -=, *=, /=</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> i1 <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">var</span> i2 <span class="operator">=</span> i1</span><br><span class="line">i2 <span class="operator">=</span> <span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(i2) <span class="comment">// 2</span></span><br><span class="line">i2 <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(i2) <span class="comment">// 3</span></span><br><span class="line">i2 <span class="operator">-=</span> <span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(i2) <span class="comment">// 1</span></span><br><span class="line">i2 <span class="operator">*=</span> <span class="number">10</span></span><br><span class="line"><span class="built_in">print</span>(i2) <span class="comment">// 10</span></span><br><span class="line">i2 <span class="operator">/=</span> <span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(i2) <span class="comment">// 5</span></span><br></pre></td></tr></table></figure>
<h4 id="è®¡ç®—ç¬¦"><a href="#è®¡ç®—ç¬¦" class="headerlink" title="è®¡ç®—ç¬¦ +, -, *, /, %"></a>è®¡ç®—ç¬¦ +, -, *, /, %</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> i1 <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> i2 <span class="operator">=</span> i1</span><br><span class="line"><span class="built_in">print</span>((i1 <span class="operator">+</span> i2 <span class="operator">-</span> <span class="number">1</span>) <span class="operator">*</span> <span class="number">10</span> <span class="operator">/</span> <span class="number">2</span> <span class="operator">%</span> <span class="number">3</span>) <span class="comment">// 2</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;i&quot;</span> <span class="operator">+</span> <span class="string">&quot;1&quot;</span>) <span class="comment">// i1</span></span><br><span class="line"><span class="comment">// ä¸€å…ƒè¿ç®—ç¬¦</span></span><br><span class="line"><span class="built_in">print</span>(<span class="operator">-</span>i1) <span class="comment">// -1</span></span><br></pre></td></tr></table></figure>
<h4 id="æ¯”è¾ƒè¿ç®—ç¬¦-gt"><a href="#æ¯”è¾ƒè¿ç®—ç¬¦-gt" class="headerlink" title="æ¯”è¾ƒè¿ç®—ç¬¦ ==, &gt;"></a>æ¯”è¾ƒè¿ç®—ç¬¦ ==, &gt;</h4><p>éµå¾ª Equatable åè®®å¯ä»¥ä½¿ç”¨ == å’Œ != æ¥åˆ¤æ–­æ˜¯å¦ç›¸ç­‰<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="number">1</span> <span class="operator">&gt;</span> <span class="number">2</span>) <span class="comment">// false</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span>: <span class="title">Equatable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p1: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> p2: <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> s1 <span class="operator">=</span> <span class="type">S</span>(p1: <span class="string">&quot;one&quot;</span>, p2: <span class="number">1</span>)</span><br><span class="line"><span class="keyword">let</span> s2 <span class="operator">=</span> <span class="type">S</span>(p1: <span class="string">&quot;two&quot;</span>, p2: <span class="number">2</span>)</span><br><span class="line"><span class="keyword">let</span> s3 <span class="operator">=</span> <span class="type">S</span>(p1: <span class="string">&quot;one&quot;</span>, p2: <span class="number">2</span>)</span><br><span class="line"><span class="keyword">let</span> s4 <span class="operator">=</span> <span class="type">S</span>(p1: <span class="string">&quot;one&quot;</span>, p2: <span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(s1 <span class="operator">==</span> s2) <span class="comment">// false</span></span><br><span class="line"><span class="built_in">print</span>(s1 <span class="operator">==</span> s3) <span class="comment">// false</span></span><br><span class="line"><span class="built_in">print</span>(s1 <span class="operator">==</span> s4) <span class="comment">// true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><br>ç±»éœ€è¦å®ç° == å‡½æ•°<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>: <span class="title">Equatable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p1: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> p2: <span class="type">Int</span></span><br><span class="line">    <span class="function"><span class="keyword">init</span>(<span class="params">p1</span>: <span class="type">String</span>, <span class="params">p2</span>: <span class="type">Int</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.p1 <span class="operator">=</span> p1</span><br><span class="line">        <span class="keyword">self</span>.p2 <span class="operator">=</span> p2</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">==</span> (<span class="params">l</span>: <span class="type">C</span>, <span class="params">r</span>: <span class="type">C</span>)</span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> l.p1 <span class="operator">==</span> r.p1 <span class="operator">&amp;&amp;</span> l.p2 <span class="operator">==</span> r.p2</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> c1 <span class="operator">=</span> <span class="type">C</span>(p1: <span class="string">&quot;one&quot;</span>, p2: <span class="number">1</span>)</span><br><span class="line"><span class="keyword">let</span> c2 <span class="operator">=</span> <span class="type">C</span>(p1: <span class="string">&quot;one&quot;</span>, p2: <span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(c1 <span class="operator">==</span> c2)</span><br></pre></td></tr></table></figure></p>
<h4 id="ä¸‰å…ƒ"><a href="#ä¸‰å…ƒ" class="headerlink" title="ä¸‰å…ƒ  ?  : _"></a>ä¸‰å…ƒ <em> ? </em> : _</h4><p>ç®€åŒ– if else å†™æ³•<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// if else</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span>(<span class="params">p</span>: <span class="type">Int</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> p <span class="operator">&gt;</span> <span class="number">0</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;positive number&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;negative number&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä¸‰å…ƒ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f2</span>(<span class="params">p</span>: <span class="type">Int</span>)</span> &#123;</span><br><span class="line">    p <span class="operator">&gt;</span> <span class="number">0</span> <span class="operator">?</span> <span class="built_in">print</span>(<span class="string">&quot;positive number&quot;</span>) : <span class="built_in">print</span>(<span class="string">&quot;negative number&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">f1(p: <span class="number">1</span>)</span><br><span class="line">f2(p: <span class="number">1</span>)</span><br></pre></td></tr></table></figure></p>
<h4 id="Nil-coalescing"><a href="#Nil-coalescing" class="headerlink" title="Nil-coalescing ??"></a>Nil-coalescing ??</h4><p>ç®€åŒ– if let else å†™æ³•<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// if else</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span>(<span class="params">p</span>: <span class="type">Int</span>?)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> i <span class="operator">=</span> p &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;p have value is <span class="subst">\(i)</span>&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;p is nil, use defalut value&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä½¿ç”¨ ??</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f2</span>(<span class="params">p</span>: <span class="type">Int</span>?)</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> i <span class="operator">=</span> p <span class="operator">??</span> <span class="number">0</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;p is <span class="subst">\(i)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="èŒƒå›´-aâ€¦b"><a href="#èŒƒå›´-aâ€¦b" class="headerlink" title="èŒƒå›´ aâ€¦b"></a>èŒƒå›´ aâ€¦b</h4><p>ç®€åŒ–çš„å€¼èŒƒå›´è¡¨è¾¾æ–¹å¼ã€‚<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°é—­èŒƒå›´</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">...</span><span class="number">10</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åŠå¼€èŒƒå›´</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span><span class="number">10</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="é€»è¾‘-amp-amp"><a href="#é€»è¾‘-amp-amp" class="headerlink" title="é€»è¾‘ !, &amp;&amp;, !!"></a>é€»è¾‘ !, &amp;&amp;, !!</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> i1 <span class="operator">=</span> <span class="operator">-</span><span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> i2 <span class="operator">=</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">if</span> i1 <span class="operator">!=</span> i2 <span class="operator">&amp;&amp;</span> (i1 <span class="operator">&lt;</span> <span class="number">0</span> <span class="operator">||</span> i2 <span class="operator">&lt;</span> <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;i1 and i2 not equal, and one of them is negative number.&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æ’ç­‰"><a href="#æ’ç­‰" class="headerlink" title="æ’ç­‰ ===, !=="></a>æ’ç­‰ ===, !==</h4><p>æ’ç­‰è¿”å›æ˜¯å¦å¼•ç”¨äº†ç›¸åŒå®ä¾‹ã€‚<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p: <span class="type">String</span></span><br><span class="line">    <span class="function"><span class="keyword">init</span>(<span class="params">p</span>: <span class="type">String</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.p <span class="operator">=</span> p</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> c1 <span class="operator">=</span> <span class="type">C</span>(p: <span class="string">&quot;one&quot;</span>)<span class="keyword">let</span> c2 <span class="operator">=</span> <span class="type">C</span>(p: <span class="string">&quot;one&quot;</span>)<span class="keyword">let</span> c3 <span class="operator">=</span> c1</span><br><span class="line"><span class="built_in">print</span>(c1 <span class="operator">===</span> c2) <span class="comment">// false</span></span><br><span class="line"><span class="built_in">print</span>(c1 <span class="operator">===</span> c3) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">print</span>(c1 <span class="operator">!==</span> c2) <span class="comment">// true</span></span><br></pre></td></tr></table></figure></p>
<h4 id="è¿ç®—ç¬¦"><a href="#è¿ç®—ç¬¦" class="headerlink" title="è¿ç®—ç¬¦"></a>è¿ç®—ç¬¦</h4><p>ä½è¿ç®—ç¬¦<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> i1: <span class="type">UInt8</span> <span class="operator">=</span> <span class="number">0b00001111</span></span><br><span class="line"><span class="keyword">let</span> i2 <span class="operator">=</span> <span class="operator">~</span>i1 <span class="comment">// Bitwise NOT Operatorï¼ˆæŒ‰ä½å–åè¿ç®—ç¬¦ï¼‰ï¼Œå–å</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> i3: <span class="type">UInt8</span> <span class="operator">=</span> <span class="number">0b00111111</span></span><br><span class="line"><span class="keyword">let</span> i4 <span class="operator">=</span> i1 <span class="operator">&amp;</span> i3 <span class="comment">// Bitwise AND Operatorï¼ˆæŒ‰ä½ä¸è¿ç®—ç¬¦ï¼‰ï¼Œéƒ½ä¸º1æ‰æ˜¯1</span></span><br><span class="line"><span class="keyword">let</span> i5 <span class="operator">=</span> i1 <span class="operator">|</span> i3 <span class="comment">// Bitwise OR Operatorï¼ˆæŒ‰ä½æˆ–è¿ç®—ç¬¦ï¼‰ï¼Œæœ‰ä¸€ä¸ª1å°±æ˜¯1</span></span><br><span class="line"><span class="keyword">let</span> i6 <span class="operator">=</span> i1 <span class="operator">^</span> i3 <span class="comment">// Bitwise XOR Operatorï¼ˆæŒ‰ä½å¼‚æˆ–è¿ç®—ç¬¦ï¼‰ï¼Œä¸åŒä¸º1ï¼Œç›¸åŒä¸º0</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(i1,i2,i3,i4,i5,i6)</span><br><span class="line"><span class="comment">// &lt;&lt; æŒ‰ä½å·¦ç§»ï¼Œ&gt;&gt; æŒ‰ä½å³ç§»</span></span><br><span class="line"><span class="keyword">let</span> i7 <span class="operator">=</span> i1 <span class="operator">&lt;&lt;</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> i8 <span class="operator">=</span> i1 <span class="operator">&gt;&gt;</span> <span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(i7,i8)</span><br></pre></td></tr></table></figure></p>
<p>æº¢å‡ºè¿ç®—ç¬¦ï¼Œæœ‰ &amp;+ã€&amp;- å’Œ &amp;*</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i1 <span class="operator">=</span> <span class="type">Int</span>.max</span><br><span class="line"><span class="built_in">print</span>(i1) <span class="comment">// 9223372036854775807</span></span><br><span class="line">i1 <span class="operator">=</span> i1 <span class="operator">&amp;+</span> <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(i1) <span class="comment">// -9223372036854775808</span></span><br><span class="line">i1 <span class="operator">=</span> i1 <span class="operator">&amp;+</span> <span class="number">10</span></span><br><span class="line"><span class="built_in">print</span>(i1) <span class="comment">// -9223372036854775798</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> i2 <span class="operator">=</span> <span class="type">UInt</span>.max</span><br><span class="line">i2 <span class="operator">=</span> i2 <span class="operator">&amp;+</span> <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(i2) <span class="comment">// 0</span></span><br></pre></td></tr></table></figure>
<p>è¿ç®—ç¬¦å‡½æ•°åŒ…æ‹¬å‰ç¼€è¿ç®—ç¬¦ã€åç¼€è¿ç®—ç¬¦ã€å¤åˆèµ‹å€¼è¿ç®—ç¬¦ä»¥åŠç­‰ä»·è¿ç®—ç¬¦ã€‚å¦ï¼Œè¿˜å¯ä»¥è‡ªå®šä¹‰è¿ç®—ç¬¦ï¼Œæ–°çš„è¿ç®—ç¬¦è¦ç”¨ operator å…³é”®å­—è¿›è¡Œå®šä¹‰ï¼ŒåŒæ—¶è¦æŒ‡å®š prefixã€infix æˆ–è€… postfix ä¿®é¥°ç¬¦ã€‚</p>
<h2 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h2><h3 id="æ¨¡å¼"><a href="#æ¨¡å¼" class="headerlink" title="æ¨¡å¼"></a>æ¨¡å¼</h3><h4 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼"></a>å•ä¾‹æ¨¡å¼</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> shared <span class="operator">=</span> <span class="type">S</span>()</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">init</span>()</span> &#123;</span><br><span class="line">        <span class="comment">// é˜²æ­¢å®ä¾‹åˆå§‹åŒ–</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ç³»ç»Ÿ"><a href="#ç³»ç»Ÿ" class="headerlink" title="ç³»ç»Ÿ"></a>ç³»ç»Ÿ</h3><h4 id="ç‰ˆæœ¬å…¼å®¹"><a href="#ç‰ˆæœ¬å…¼å®¹" class="headerlink" title="ç‰ˆæœ¬å…¼å®¹"></a>ç‰ˆæœ¬å…¼å®¹</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç‰ˆæœ¬</span></span><br><span class="line"><span class="keyword">@available</span>(<span class="keyword">iOS</span> <span class="number">15</span>, <span class="operator">*</span>)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span>()</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç‰ˆæœ¬æ£€æŸ¥</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">#available</span>(<span class="keyword">iOS</span> <span class="number">15</span>, <span class="keyword">macOS</span> <span class="number">12</span>, <span class="operator">*</span>) &#123;</span><br><span class="line">    f()</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// nothing happen</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Codable"><a href="#Codable" class="headerlink" title="Codable"></a>Codable</h3><h4 id="JSON-æ²¡æœ‰-id-å­—æ®µ"><a href="#JSON-æ²¡æœ‰-id-å­—æ®µ" class="headerlink" title="JSON æ²¡æœ‰ id å­—æ®µ"></a>JSON æ²¡æœ‰ id å­—æ®µ</h4><p>å¦‚æœSwiftUIè¦æ±‚æ•°æ®Modeléƒ½æ˜¯éµå¾ªIdentifiableåè®®çš„ï¼Œè€Œæœ‰çš„jsonæ²¡æœ‰idè¿™ä¸ªå­—æ®µï¼Œå¯ä»¥ä½¿ç”¨æ‰©å±•structçš„æ–¹å¼è§£å†³ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class"><span class="title">CommitModel</span>: <span class="title">Decodable</span>, <span class="title">Hashable</span> </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> sha: <span class="type">String</span></span><br><span class="line">	<span class="keyword">var</span> author: <span class="type">AuthorModel</span></span><br><span class="line">	<span class="keyword">var</span> commit: <span class="type">CommitModel</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">CommitModel</span>: <span class="title">Identifiable</span> </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> id: <span class="type">String</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> sha</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="ç¼–ç¨‹èŒƒå¼"><a href="#ç¼–ç¨‹èŒƒå¼" class="headerlink" title="ç¼–ç¨‹èŒƒå¼"></a>ç¼–ç¨‹èŒƒå¼</h2><h3 id="Combineå“åº”å¼ç¼–ç¨‹èŒƒå¼"><a href="#Combineå“åº”å¼ç¼–ç¨‹èŒƒå¼" class="headerlink" title="Combineå“åº”å¼ç¼–ç¨‹èŒƒå¼"></a>Combineå“åº”å¼ç¼–ç¨‹èŒƒå¼</h3><h4 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h4><p>WWDC 2019è‹¹æœæ¨å‡ºCombineï¼ŒCombineæ˜¯ä¸€ç§å“åº”å¼ç¼–ç¨‹èŒƒå¼ï¼Œé‡‡ç”¨å£°æ˜å¼çš„Swift APIã€‚å®˜æ–¹æ–‡æ¡£é“¾æ¥  <a href="https://developer.apple.com/documentation/combine">Combine | Apple Developer Documentation</a> ã€‚è¿˜æœ‰  <a href="https://heckj.github.io/swiftui-notes/">Using Combine</a>  è¿™é‡Œæœ‰å¤§é‡ä½¿ç”¨ç¤ºä¾‹ï¼Œå†…å®¹è¾ƒå…¨ã€‚å®˜æ–¹è®¨è®ºCombineçš„è®ºå›  <a href="https://forums.swift.org/tag/combine">Topics tagged combine</a> ã€‚StackOverflowä¸Šç›¸å…³é—®é¢˜  <a href="https://stackoverflow.com/questions/tagged/combine">Newest â€˜combineâ€™ Questions</a> ã€‚</p>
<p>WWDCä¸Šå…³äºCombineçš„Sessionå¦‚ä¸‹ï¼š</p>
<ul>
<li><a href="https://developer.apple.com/videos/play/wwdc2019/722/">Introducing Combine</a> </li>
<li><a href="https://developer.apple.com/videos/play/wwdc2019/721/">Combine in Practice</a> </li>
</ul>
<p>å’ŒCombineç›¸å…³çš„Sessionï¼š</p>
<ul>
<li><a href="https://developer.apple.com/videos/play/wwdc2019/415/">Modern Swift API Design</a> </li>
<li><a href="https://developer.apple.com/videos/play/wwdc2019/226">Data Flow Through SwiftUI</a> </li>
<li><a href="https://developer.apple.com/videos/play/wwdc2019/711">Introducing Combine and Advances in Foundation</a> </li>
<li><a href="https://developer.apple.com/videos/play/wwdc2019/712/">Advances in Networking, Part 1</a> </li>
<li><a href="https://developer.apple.com/videos/play/wwdc2019/610/">Building Collaborative AR Experiences</a> </li>
<li><a href="https://developer.apple.com/videos/play/wwdc2019/223/">Expanding the Sensory Experience with Core Haptics</a> </li>
</ul>
<p>ä¹Ÿå°±æ˜¯ä½ å†™ä»£ç ä¸åŒäºä»¥å¾€å‘½ä»¤å¼çš„æè¿°å¦‚ä½•å¤„ç†æ•°æ®ï¼Œè€Œæ˜¯è¦å»æè¿°å¥½æ•°æ®ä¼šç»è¿‡å“ªäº›é€»è¾‘è¿ç®—å¤„ç†ã€‚è¿™æ ·ä»£ç æ›´å¥½ç»´æŠ¤ï¼Œå¯ä»¥æœ‰æ•ˆçš„å‡å°‘åµŒå¥—é—­åŒ…ä»¥åŠåˆ†æ•£çš„å›è°ƒç­‰ä½¿å¾—ä»£ç ç»´æŠ¤éº»çƒ¦çš„è‹¦æ¼ã€‚</p>
<p>å£°æ˜å¼å’Œè¿‡ç¨‹æ—¶åŒºåˆ«å¯è§å¦‚ä¸‹ä»£ç ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ‰€æœ‰æ•°ç›¸åŠ </span></span><br><span class="line"><span class="comment">// å‘½ä»¤å¼æ€ç»´</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum1</span>(<span class="params">arr</span>: [<span class="type">Int</span>])</span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> sum: <span class="type">Int</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> v <span class="keyword">in</span> arr &#123;</span><br><span class="line">    sum <span class="operator">+=</span> v</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å£°æ˜å¼æ€ç»´</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum2</span>(<span class="params">arr</span>: [<span class="type">Int</span>])</span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> arr.reduce(<span class="number">0</span>, <span class="operator">+</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Combineä¸»è¦ç”¨æ¥å¤„ç†å¼‚æ­¥çš„äº‹ä»¶å’Œå€¼ã€‚è‹¹æœUIæ¡†æ¶éƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸Šè¿›è¡ŒUIæ›´æ–°ï¼ŒCombineé€šè¿‡Publisherçš„receiveè®¾ç½®å›ä¸»çº¿ç¨‹æ›´æ–°UIä¼šéå¸¸çš„ç®€å•ã€‚</p>
<p>å·²æœ‰çš„RxSwiftå’ŒReactiveSwiftæ¡†æ¶å’ŒCombineçš„æ€è·¯å’Œç”¨æ³•ç±»ä¼¼ã€‚</p>
<p>Combine çš„ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µ</p>
<ul>
<li>å‘å¸ƒè€…</li>
<li>è®¢é˜…è€…</li>
<li>æ“ä½œç¬¦</li>
</ul>
<p>ç®€å•ä¸¾ä¸ªå‘å¸ƒæ•°æ®å’Œç±»å±æ€§ç»‘å®šçš„ä¾‹å­ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> pA <span class="operator">=</span> <span class="type">Just</span>(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="keyword">_</span> <span class="operator">=</span> pA.sink &#123; v <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;pA is: <span class="subst">\(v)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> pB <span class="operator">=</span> [<span class="number">7</span>,<span class="number">90</span>,<span class="number">16</span>,<span class="number">11</span>].publisher</span><br><span class="line"><span class="keyword">let</span> <span class="keyword">_</span> <span class="operator">=</span> pB</span><br><span class="line">    .sink &#123; v <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;pB: <span class="subst">\(v)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> p: <span class="type">Int</span> <span class="operator">=</span> <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;property update to <span class="subst">\(p)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> o <span class="operator">=</span> <span class="type">AClass</span>()</span><br><span class="line"><span class="keyword">let</span> <span class="keyword">_</span> <span class="operator">=</span> pB.assign(to: \.p, on: o)</span><br></pre></td></tr></table></figure></p>
<h4 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h4><h5 id="ç½‘ç»œè¯·æ±‚"><a href="#ç½‘ç»œè¯·æ±‚" class="headerlink" title="ç½‘ç»œè¯·æ±‚"></a>ç½‘ç»œè¯·æ±‚</h5><p>ç½‘ç»œURLSession.dataTaskPublisherä½¿ç”¨ä¾‹å­å¦‚ä¸‹ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> req <span class="operator">=</span> <span class="type">URLRequest</span>(url: <span class="type">URL</span>(string: <span class="string">&quot;http://www.starming.com&quot;</span>)<span class="operator">!</span>)</span><br><span class="line"><span class="keyword">let</span> dpPublisher <span class="operator">=</span> <span class="type">URLSession</span>.shared.dataTaskPublisher(for: req)</span><br></pre></td></tr></table></figure></p>
<p>ä¸€ä¸ªè¯·æ±‚Githubæ¥å£å¹¶å±•ç¤ºç»“æœçš„ä¾‹å­<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// CombineSearchAPI.swift</span></span><br><span class="line"><span class="comment">// SwiftOnly (iOS)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by Ming Dai on 2021/11/4.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CombineSearchAPI</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">GithubSearchView</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: Github View</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">GithubSearchView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="keyword">var</span> str: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;Swift&quot;</span></span><br><span class="line">  <span class="meta">@StateObject</span> <span class="keyword">var</span> ss: <span class="type">SearchStore</span> <span class="operator">=</span> <span class="type">SearchStore</span>()</span><br><span class="line">  <span class="meta">@State</span> <span class="keyword">var</span> repos: [<span class="type">GithubRepo</span>] <span class="operator">=</span> []</span><br><span class="line">  <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">NavigationView</span> &#123;</span><br><span class="line">      <span class="type">List</span> &#123;</span><br><span class="line">        <span class="type">TextField</span>(<span class="string">&quot;è¾“å…¥ï¼š&quot;</span>, text: <span class="variable">$str</span>, onCommit: fetch)</span><br><span class="line">        <span class="type">ForEach</span>(<span class="keyword">self</span>.ss.repos) &#123; repo -&gt; <span class="type">GithubRepoCell</span> <span class="keyword">in</span></span><br><span class="line">          <span class="type">GithubRepoCell</span>(repo: repo)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      .navigationTitle(<span class="string">&quot;æœç´¢&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .onAppear(perform: fetch)</span><br><span class="line">  &#125;</span><br><span class="line">   </span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">fetch</span>()</span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.ss.search(str: <span class="keyword">self</span>.str)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">GithubRepoCell</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> repo: <span class="type">GithubRepo</span></span><br><span class="line">  <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">VStack</span>(alignment: .leading, spacing: <span class="number">20</span>) &#123;</span><br><span class="line">      <span class="type">Text</span>(<span class="keyword">self</span>.repo.name)</span><br><span class="line">      <span class="type">Text</span>(<span class="keyword">self</span>.repo.description)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: Github Service</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">GithubRepo</span>: <span class="title">Decodable</span>, <span class="title">Identifiable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> id: <span class="type">Int</span></span><br><span class="line">  <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">  <span class="keyword">let</span> description: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">GithubResp</span>: <span class="title">Decodable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> items: [<span class="type">GithubRepo</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">GithubSearchManager</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">search</span>(<span class="params">str</span>: <span class="type">String</span>)</span> -&gt; <span class="type">AnyPublisher</span>&lt;<span class="type">GithubResp</span>, <span class="type">Never</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">var</span> urlComponents <span class="operator">=</span> <span class="type">URLComponents</span>(string: <span class="string">&quot;https://api.github.com/search/repositories&quot;</span>) <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">preconditionFailure</span>(<span class="string">&quot;é“¾æ¥æ— æ•ˆ&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    urlComponents.queryItems <span class="operator">=</span> [<span class="type">URLQueryItem</span>(name: <span class="string">&quot;q&quot;</span>, value: str)]</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> url <span class="operator">=</span> urlComponents.url <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">preconditionFailure</span>(<span class="string">&quot;é“¾æ¥æ— æ•ˆ&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> sch <span class="operator">=</span> <span class="type">DispatchQueue</span>(label: <span class="string">&quot;API&quot;</span>, qos: .default, attributes: .concurrent)</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">return</span> <span class="type">URLSession</span>.shared</span><br><span class="line">      .dataTaskPublisher(for: url)</span><br><span class="line">      .receive(on: sch)</span><br><span class="line">      .tryMap(&#123; element -&gt; <span class="type">Data</span> <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="type">String</span>(decoding: element.data, as: <span class="type">UTF8</span>.<span class="keyword">self</span>))</span><br><span class="line">        <span class="keyword">return</span> element.data</span><br><span class="line">      &#125;)</span><br><span class="line">      .decode(type: <span class="type">GithubResp</span>.<span class="keyword">self</span>, decoder: <span class="type">JSONDecoder</span>())</span><br><span class="line">      .catch &#123; <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">        <span class="type">Empty</span>().eraseToAnyPublisher()</span><br><span class="line">      &#125;</span><br><span class="line">      .eraseToAnyPublisher()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">SearchStore</span>: <span class="title">ObservableObject</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Published</span> <span class="keyword">var</span> query: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="meta">@Published</span> <span class="keyword">var</span> repos: [<span class="type">GithubRepo</span>] <span class="operator">=</span> []</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> searchManager: <span class="type">GithubSearchManager</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> cancellable <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line">   </span><br><span class="line">  <span class="function"><span class="keyword">init</span>(<span class="params">searchManager</span>: <span class="type">GithubSearchManager</span> <span class="operator">=</span> <span class="type">GithubSearchManager</span>())</span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.searchManager <span class="operator">=</span> searchManager</span><br><span class="line">    <span class="variable">$query</span></span><br><span class="line">      .debounce(for: .milliseconds(<span class="number">500</span>), scheduler: <span class="type">RunLoop</span>.main)</span><br><span class="line">      .flatMap &#123; query -&gt; <span class="type">AnyPublisher</span>&lt;[<span class="type">GithubRepo</span>], <span class="type">Never</span>&gt; <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">return</span> searchManager.search(str: query)</span><br><span class="line">          .map &#123;</span><br><span class="line">            <span class="variable">$0</span>.items</span><br><span class="line">          &#125;</span><br><span class="line">          .eraseToAnyPublisher()</span><br><span class="line">      &#125;</span><br><span class="line">      .receive(on: <span class="type">DispatchQueue</span>.main)</span><br><span class="line">      .assign(to: \.repos, on: <span class="keyword">self</span>)</span><br><span class="line">      .store(in: <span class="operator">&amp;</span>cancellable)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">search</span>(<span class="params">str</span>: <span class="type">String</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.query <span class="operator">=</span> str</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æŠ½è±¡åŸºç¡€ç½‘ç»œèƒ½åŠ›ï¼Œæ–¹ä¾¿æ‰©å±•ï¼Œä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// CombineAPI.swift</span></span><br><span class="line"><span class="comment">// SwiftOnly (iOS)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by Ming Dai on 2021/11/4.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CombineAPI</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">RepListView</span>(vm: .<span class="keyword">init</span>())</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">RepListView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">  <span class="meta">@ObservedObject</span> <span class="keyword">var</span> vm: <span class="type">RepListVM</span></span><br><span class="line">   </span><br><span class="line">  <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">NavigationView</span> &#123;</span><br><span class="line">      <span class="type">List</span>(vm.repos) &#123; rep <span class="keyword">in</span></span><br><span class="line">        <span class="type">RepListCell</span>(rep: rep)</span><br><span class="line">      &#125;</span><br><span class="line">      .alert(isPresented: <span class="variable">$vm</span>.isErrorShow) &#123; () -&gt; <span class="type">Alert</span> <span class="keyword">in</span></span><br><span class="line">        <span class="type">Alert</span>(title: <span class="type">Text</span>(<span class="string">&quot;å‡ºé”™äº†&quot;</span>), message: <span class="type">Text</span>(vm.errorMessage))</span><br><span class="line">      &#125;</span><br><span class="line">      .navigationBarTitle(<span class="type">Text</span>(<span class="string">&quot;ä»“åº“&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    .onAppear &#123;</span><br><span class="line">      vm.apply(.onAppear)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">RepListCell</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="keyword">var</span> rep: <span class="type">RepoModel</span></span><br><span class="line">  <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">HStack</span>() &#123;</span><br><span class="line">      <span class="type">VStack</span>() &#123;</span><br><span class="line">        <span class="type">AsyncImage</span>(url: <span class="type">URL</span>(string: rep.owner.avatarUrl <span class="operator">??</span> <span class="string">&quot;&quot;</span>), content: &#123; image <span class="keyword">in</span></span><br><span class="line">          image</span><br><span class="line">            .resizable()</span><br><span class="line">            .aspectRatio(contentMode: .fit)</span><br><span class="line">            .frame(width: <span class="number">100</span>, height: <span class="number">100</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        placeholder: &#123;</span><br><span class="line">          <span class="type">ProgressView</span>()</span><br><span class="line">            .frame(width: <span class="number">100</span>, height: <span class="number">100</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;<span class="subst">\(rep.owner.login)</span>&quot;</span>)</span><br><span class="line">          .font(.system(size: <span class="number">10</span>))</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">VStack</span>(alignment: .leading, spacing: <span class="number">10</span>) &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;<span class="subst">\(rep.name)</span>&quot;</span>)</span><br><span class="line">          .font(.title)</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;<span class="subst">\(rep.stargazersCount)</span>&quot;</span>)</span><br><span class="line">          .font(.title3)</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;<span class="subst">\(String(describing: rep.description <span class="operator">??</span> <span class="string">&quot;&quot;</span>))</span>&quot;</span>)</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;<span class="subst">\(String(describing: rep.language <span class="operator">??</span> <span class="string">&quot;&quot;</span>))</span>&quot;</span>)</span><br><span class="line">          .font(.title3)</span><br><span class="line">      &#125;</span><br><span class="line">      .font(.system(size: <span class="number">14</span>))</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: Repo View Model</span></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">RepListVM</span>: <span class="title">ObservableObject</span>, <span class="title">UnidirectionalDataFlowType</span> </span>&#123;</span><br><span class="line">  <span class="keyword">typealias</span> <span class="type">InputType</span> <span class="operator">=</span> <span class="type">Input</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> cancellables: [<span class="type">AnyCancellable</span>] <span class="operator">=</span> []</span><br><span class="line">   </span><br><span class="line">  <span class="comment">// Input</span></span><br><span class="line">  <span class="class"><span class="keyword">enum</span> <span class="title">Input</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> onAppear</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">apply</span>(<span class="keyword">_</span> <span class="params">input</span>: <span class="type">Input</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> input &#123;</span><br><span class="line">    <span class="keyword">case</span> .onAppear:</span><br><span class="line">      onAppearSubject.send(())</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> onAppearSubject <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">Void</span>, <span class="type">Never</span>&gt;()</span><br><span class="line">   </span><br><span class="line">  <span class="comment">// Output</span></span><br><span class="line">  <span class="meta">@Published</span> <span class="keyword">private(set)</span> <span class="keyword">var</span> repos: [<span class="type">RepoModel</span>] <span class="operator">=</span> []</span><br><span class="line">  <span class="meta">@Published</span> <span class="keyword">var</span> isErrorShow <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">  <span class="meta">@Published</span> <span class="keyword">var</span> errorMessage <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="meta">@Published</span> <span class="keyword">private(set)</span> <span class="keyword">var</span> shouldShowIcon <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">   </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> resSubject <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">SearchRepoModel</span>, <span class="type">Never</span>&gt;()</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> errSubject <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">APISevError</span>, <span class="type">Never</span>&gt;()</span><br><span class="line">   </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> apiSev: <span class="type">APISev</span></span><br><span class="line">   </span><br><span class="line">  <span class="function"><span class="keyword">init</span>(<span class="params">apiSev</span>: <span class="type">APISev</span> <span class="operator">=</span> <span class="type">APISev</span>())</span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.apiSev <span class="operator">=</span> apiSev</span><br><span class="line">    bindInputs()</span><br><span class="line">    bindOutputs()</span><br><span class="line">  &#125;</span><br><span class="line">   </span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">bindInputs</span>()</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> req <span class="operator">=</span> <span class="type">SearchRepoRequest</span>()</span><br><span class="line">    <span class="keyword">let</span> resPublisher <span class="operator">=</span> onAppearSubject</span><br><span class="line">      .flatMap &#123; [apiSev] <span class="keyword">in</span></span><br><span class="line">        apiSev.response(from: req)</span><br><span class="line">          .catch &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] error -&gt; <span class="type">Empty</span>&lt;<span class="type">SearchRepoModel</span>, <span class="type">Never</span>&gt; <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span><span class="operator">?</span>.errSubject.send(error)</span><br><span class="line">            <span class="keyword">return</span> .<span class="keyword">init</span>()</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">let</span> resStream <span class="operator">=</span> resPublisher</span><br><span class="line">      .share()</span><br><span class="line">      .subscribe(resSubject)</span><br><span class="line">     </span><br><span class="line">    <span class="comment">// å…¶å®ƒå¼‚æ­¥äº‹ä»¶ï¼Œæ¯”å¦‚æ—¥å¿—ç­‰æ“ä½œéƒ½å¯ä»¥åšæˆStreamåŠ åˆ°ä¸‹é¢æ•°ç»„å†…ã€‚</span></span><br><span class="line">    cancellables <span class="operator">+=</span> [resStream]</span><br><span class="line">  &#125;</span><br><span class="line">   </span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">bindOutputs</span>()</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> repStream <span class="operator">=</span> resSubject</span><br><span class="line">      .map &#123;</span><br><span class="line">        <span class="variable">$0</span>.items</span><br><span class="line">      &#125;</span><br><span class="line">      .assign(to: \.repos, on: <span class="keyword">self</span>)</span><br><span class="line">    <span class="keyword">let</span> errMsgStream <span class="operator">=</span> errSubject</span><br><span class="line">      .map &#123; error -&gt; <span class="type">String</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">switch</span> error &#123;</span><br><span class="line">        <span class="keyword">case</span> .resError: <span class="keyword">return</span> <span class="string">&quot;network error&quot;</span></span><br><span class="line">        <span class="keyword">case</span> .parseError: <span class="keyword">return</span> <span class="string">&quot;parse error&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      .assign(to: \.errorMessage, on: <span class="keyword">self</span>)</span><br><span class="line">    <span class="keyword">let</span> errStream <span class="operator">=</span> errSubject</span><br><span class="line">      .map &#123; <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">        <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">      .assign(to: \.isErrorShow, on: <span class="keyword">self</span>)</span><br><span class="line">    cancellables <span class="operator">+=</span> [repStream,errStream,errMsgStream]</span><br><span class="line">  &#125;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">UnidirectionalDataFlowType</span> </span>&#123;</span><br><span class="line">  <span class="keyword">associatedtype</span> <span class="type">InputType</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">apply</span>(<span class="keyword">_</span> <span class="params">input</span>: <span class="type">InputType</span>)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: Repo Request and Models</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SearchRepoRequest</span>: <span class="title">APIReqType</span> </span>&#123;</span><br><span class="line">  <span class="keyword">typealias</span> <span class="type">Res</span> <span class="operator">=</span> <span class="type">SearchRepoModel</span></span><br><span class="line">   </span><br><span class="line">  <span class="keyword">var</span> path: <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;/search/repositories&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> qItems: [<span class="type">URLQueryItem</span>]<span class="operator">?</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">      .<span class="keyword">init</span>(name: <span class="string">&quot;q&quot;</span>, value: <span class="string">&quot;Combine&quot;</span>),</span><br><span class="line">      .<span class="keyword">init</span>(name: <span class="string">&quot;order&quot;</span>, value: <span class="string">&quot;desc&quot;</span>)</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SearchRepoModel</span>: <span class="title">Decodable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> items: [<span class="type">RepoModel</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">RepoModel</span>: <span class="title">Decodable</span>, <span class="title">Hashable</span>, <span class="title">Identifiable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> id: <span class="type">Int64</span></span><br><span class="line">  <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">  <span class="keyword">var</span> fullName: <span class="type">String</span></span><br><span class="line">  <span class="keyword">var</span> description: <span class="type">String</span>?</span><br><span class="line">  <span class="keyword">var</span> stargazersCount: <span class="type">Int</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">  <span class="keyword">var</span> language: <span class="type">String</span>?</span><br><span class="line">  <span class="keyword">var</span> owner: <span class="type">OwnerModel</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">OwnerModel</span>: <span class="title">Decodable</span>, <span class="title">Hashable</span>, <span class="title">Identifiable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> id: <span class="type">Int64</span></span><br><span class="line">  <span class="keyword">var</span> login: <span class="type">String</span></span><br><span class="line">  <span class="keyword">var</span> avatarUrl: <span class="type">String</span>?</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: API Request Fundation</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">APIReqType</span> </span>&#123;</span><br><span class="line">  <span class="keyword">associatedtype</span> <span class="type">Res</span>: <span class="type">Decodable</span></span><br><span class="line">  <span class="keyword">var</span> path: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">  <span class="keyword">var</span> qItems: [<span class="type">URLQueryItem</span>]<span class="operator">?</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">APISevType</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">response</span>&lt;<span class="type">Request</span>&gt;(<span class="params">from</span> <span class="params">req</span>: <span class="type">Request</span>)</span> -&gt; <span class="type">AnyPublisher</span>&lt;<span class="type">Request</span>.<span class="type">Res</span>, <span class="type">APISevError</span>&gt; <span class="keyword">where</span> <span class="type">Request</span>: <span class="type">APIReqType</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">APISev</span>: <span class="title">APISevType</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">let</span> rootUrl: <span class="type">URL</span></span><br><span class="line">  <span class="function"><span class="keyword">init</span>(<span class="params">rootUrl</span>: <span class="type">URL</span> <span class="operator">=</span> <span class="type">URL</span>(string: <span class="string">&quot;https://api.github.com&quot;</span>)<span class="operator">!</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.rootUrl <span class="operator">=</span> rootUrl</span><br><span class="line">  &#125;</span><br><span class="line">   </span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">response</span>&lt;<span class="type">Request</span>&gt;(<span class="params">from</span> <span class="params">req</span>: <span class="type">Request</span>)</span> -&gt; <span class="type">AnyPublisher</span>&lt;<span class="type">Request</span>.<span class="type">Res</span>, <span class="type">APISevError</span>&gt; <span class="keyword">where</span> <span class="type">Request</span> : <span class="type">APIReqType</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> path <span class="operator">=</span> <span class="type">URL</span>(string: req.path, relativeTo: rootUrl)<span class="operator">!</span></span><br><span class="line">    <span class="keyword">var</span> comp <span class="operator">=</span> <span class="type">URLComponents</span>(url: path, resolvingAgainstBaseURL: <span class="literal">true</span>)<span class="operator">!</span></span><br><span class="line">    comp.queryItems <span class="operator">=</span> req.qItems</span><br><span class="line">    <span class="built_in">print</span>(comp.url<span class="operator">?</span>.description <span class="operator">??</span> <span class="string">&quot;url wrong&quot;</span>)</span><br><span class="line">    <span class="keyword">var</span> req <span class="operator">=</span> <span class="type">URLRequest</span>(url: comp.url<span class="operator">!</span>)</span><br><span class="line">    req.addValue(<span class="string">&quot;application/json&quot;</span>, forHTTPHeaderField: <span class="string">&quot;Content-Type&quot;</span>)</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">let</span> de <span class="operator">=</span> <span class="type">JSONDecoder</span>()</span><br><span class="line">    de.keyDecodingStrategy <span class="operator">=</span> .convertFromSnakeCase</span><br><span class="line">    <span class="keyword">return</span> <span class="type">URLSession</span>.shared.dataTaskPublisher(for: req)</span><br><span class="line">      .map &#123; data, res <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="type">String</span>(decoding: data, as: <span class="type">UTF8</span>.<span class="keyword">self</span>))</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line">      &#125;</span><br><span class="line">      .mapError &#123; <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">        <span class="type">APISevError</span>.resError</span><br><span class="line">      &#125;</span><br><span class="line">      .decode(type: <span class="type">Request</span>.<span class="type">Res</span>.<span class="keyword">self</span>, decoder: de)</span><br><span class="line">      .mapError(<span class="type">APISevError</span>.parseError)</span><br><span class="line">      .receive(on: <span class="type">RunLoop</span>.main)</span><br><span class="line">      .eraseToAnyPublisher()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">APISevError</span>: <span class="title">Error</span> </span>&#123;</span><br><span class="line">  <span class="keyword">case</span> resError</span><br><span class="line">  <span class="keyword">case</span> parseError(<span class="type">Error</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h5 id="KVO"><a href="#KVO" class="headerlink" title="KVO"></a>KVO</h5><p>ä¾‹å­å¦‚ä¸‹ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">KVOObject</span>: <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">  <span class="keyword">@objc</span> <span class="keyword">dynamic</span> <span class="keyword">var</span> intV: <span class="type">Int</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">  <span class="keyword">@objc</span> <span class="keyword">dynamic</span> <span class="keyword">var</span> boolV: <span class="type">Bool</span> <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> o <span class="operator">=</span> <span class="type">KVOObject</span>()</span><br><span class="line"><span class="keyword">let</span> <span class="keyword">_</span> <span class="operator">=</span> o.publisher(for: \.intV)</span><br><span class="line">  .sink &#123; v <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;value : <span class="subst">\(v)</span>&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<h5 id="é€šçŸ¥"><a href="#é€šçŸ¥" class="headerlink" title="é€šçŸ¥"></a>é€šçŸ¥</h5><p>ä½¿ç”¨ä¾‹å­å¦‚ä¸‹ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Notification</span>.<span class="title">Name</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> noti <span class="operator">=</span> <span class="type">Notification</span>.<span class="type">Name</span>(<span class="string">&quot;nameofnoti&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> notiPb <span class="operator">=</span> <span class="type">NotificationCenter</span>.default.publisher(for: .noti, object: <span class="literal">nil</span>)</span><br><span class="line">        .sink &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="variable">$0</span>)</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></p>
<p>é€€åˆ°åå°æ¥å—é€šçŸ¥çš„ä¾‹å­å¦‚ä¸‹ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> storage <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line">   </span><br><span class="line">  <span class="function"><span class="keyword">init</span>()</span> &#123;</span><br><span class="line">    <span class="type">NotificationCenter</span>.default.publisher(for: <span class="type">UIWindowScene</span>.didEnterBackgroundNotification)</span><br><span class="line">      .sink &#123; <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;enter background&quot;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      .store(in: <span class="operator">&amp;</span><span class="keyword">self</span>.storage)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h5 id="Timer"><a href="#Timer" class="headerlink" title="Timer"></a>Timer</h5><p>ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> timePb <span class="operator">=</span> <span class="type">Timer</span>.publish(every: <span class="number">1.0</span>, on: <span class="type">RunLoop</span>.main, in: .default)</span><br><span class="line"><span class="keyword">let</span> timeSk <span class="operator">=</span> timePb.sink &#123; r <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;r is <span class="subst">\(r)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> cPb <span class="operator">=</span> timePb.connect()</span><br></pre></td></tr></table></figure></p>
<h5 id="SwiftUI"><a href="#SwiftUI" class="headerlink" title="SwiftUI"></a>SwiftUI</h5><p>ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">aView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> currentVl <span class="operator">=</span> <span class="string">&quot;vl&quot;</span></span><br><span class="line">  <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">Text</span>(<span class="string">&quot;string is <span class="subst">\(currentVl)</span>&quot;</span>)</span><br><span class="line">      .onReceive(currentPublisher) &#123; newVl <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">self</span>.currentVl <span class="operator">=</span> newVl</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="åº“çš„é€‰æ‹©ä¸ä½¿ç”¨è¯´æ˜"><a href="#åº“çš„é€‰æ‹©ä¸ä½¿ç”¨è¯´æ˜" class="headerlink" title="åº“çš„é€‰æ‹©ä¸ä½¿ç”¨è¯´æ˜"></a>åº“çš„é€‰æ‹©ä¸ä½¿ç”¨è¯´æ˜</h2><h3 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h3><p> <a href="https://github.com/stephencelis/SQLite.swift">GitHub - stephencelis/SQLite.swift: A type-safe, Swift-language layer over SQLite3.</a><br> <a href="https://github.com/groue/GRDB.swift">GitHub - groue/GRDB.swift: A toolkit for SQLite databases, with a focus on application development</a> </p>
<h2 id="ä»£ç è§„èŒƒ"><a href="#ä»£ç è§„èŒƒ" class="headerlink" title="ä»£ç è§„èŒƒ"></a>ä»£ç è§„èŒƒ</h2><p>å‚è€ƒï¼š</p>
<ul>
<li><a href="https://google.github.io/swift/">Swift Style Guide</a> </li>
</ul>
<p>å¤šç”¨é™æ€ç‰¹æ€§ã€‚swift åœ¨ç¼–è¯‘æœŸé—´æ‰€åšçš„ä¼˜åŒ–æ¯” OC è¦å¤šï¼Œè¿™æ˜¯ç”±äºä»–çš„é™æ€æ´¾å‘ã€æ³›å‹ç‰¹åŒ–ã€å†™æ—¶å¤åˆ¶è¿™äº›é™æ€ç‰¹æ€§å†³å®šçš„ã€‚å¦å¤–é€šè¿‡ final  å’Œ private è¿™æ ·çš„è¡¨ç¤ºå¯å°†åŠ¨æ€ç‰¹æ€§è½¬åŒ–ä¸ºé™æ€æ–¹å¼ï¼Œç¼–è¯‘å¼€å¯ WMO å¯ä»¥è‡ªåŠ¨æ¨å¯¼å‡ºå“ªäº›åŠ¨æ€æ´¾å‘å¯è½¬åŒ–ä¸ºé™æ€æ´¾å‘ã€‚</p>
<p>å¦‚ä½•é¿å…å´©æºƒï¼Ÿ</p>
<ul>
<li>å­—å…¸ï¼šç”¨ç»“æ„ä½“æ›¿ä»£</li>
<li>Anyï¼šå¯ç”¨æ³›å‹æˆ–å…³è”å…³è”ç±»å‹æ›¿ä»£</li>
<li>as? ï¼šå°‘ç”¨ AnyObjectï¼Œå¤šç”¨æ³›å‹æˆ–ä¸é€æ˜ç±»å‹</li>
<li>!ï¼šè¦å°‘ç”¨</li>
</ul>
<p>å¥½çš„å®è·µï¼Ÿ</p>
<ul>
<li>å°‘ç”¨ç»§æ‰¿ï¼Œå¤šç”¨ protocol</li>
<li>å¤šç”¨ extension å¯¹è‡ªå·±ä»£ç è¿›è¡Œç®¡ç†</li>
</ul>
<h2 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h2><h3 id="å¼€æºä¾‹å­"><a href="#å¼€æºä¾‹å­" class="headerlink" title="å¼€æºä¾‹å­"></a>å¼€æºä¾‹å­</h3><ul>
<li><a href="https://github.com/adamayoung/Movies">GitHub - adamayoung/Movies: Movies and TV Shows App for iOS, iPadOS, watchOS and macOS</a>  ä½¿ç”¨äº†SwiftUIå’ŒCombineï¼Œç”µå½±æ•°æ®ä½¿ç”¨çš„æ˜¯ <a href="https://www.themoviedb.org/">The Movie Database (TMDB)</a> çš„API</li>
</ul>
<h2 id="macoOS"><a href="#macoOS" class="headerlink" title="macoOS"></a>macoOS</h2><p>å®˜æ–¹æä¾›çš„ä¸¤ä¸ªä¾‹å­ï¼Œ <a href="https://developer.apple.com/tutorials/swiftui/creating-a-macos-app">Creating a macOS App</a> ï¼Œ <a href="https://developer.apple.com/documentation/swiftui/building_a_great_mac_app_with_swiftui">Building a Great Mac App with SwiftUI</a>  ï¼ˆæœ‰tableå’Œ<br>LazyVGridçš„ç”¨æ³•ï¼‰ã€‚</p>
<p>ä¸‰æ ç»“æ„æ¶å­æ­å»ºï¼Œä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SwiftPamphletApp</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span> &#123;</span><br><span class="line">            <span class="type">SPSidebar</span>()</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;ç¬¬äºŒæ &quot;</span>)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;ç¬¬ä¸‰æ &quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .navigationTitle(<span class="string">&quot;Swift å°å†Œå­&quot;</span>)</span><br><span class="line">        .toolbar &#123;</span><br><span class="line">            <span class="type">ToolbarItem</span>(placement: <span class="type">ToolbarItemPlacement</span>.navigation) &#123;</span><br><span class="line">                </span><br><span class="line">                <span class="type">Button</span> &#123;</span><br><span class="line">                    <span class="type">NSApp</span>.keyWindow<span class="operator">?</span>.firstResponder<span class="operator">?</span>.tryToPerform(#selector(<span class="type">NSSplitViewController</span>.toggleSidebar(<span class="keyword">_</span>:)), with: <span class="literal">nil</span>)</span><br><span class="line">                &#125; label: &#123;</span><br><span class="line">                    <span class="type">Label</span>(<span class="string">&quot;Sidebar&quot;</span>, systemImage: <span class="string">&quot;sidebar.left&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SPSidebar</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span> &#123;</span><br><span class="line">            <span class="type">Section</span>(<span class="string">&quot;ç¬¬ä¸€ç»„&quot;</span>) &#123;</span><br><span class="line">                <span class="type">NavigationLink</span>(<span class="string">&quot;ç¬¬ä¸€é¡¹&quot;</span>, destination: <span class="type">SPList</span>(title: <span class="string">&quot;åˆ—è¡¨1&quot;</span>))</span><br><span class="line">                    .badge(<span class="number">3</span>)</span><br><span class="line">                <span class="type">NavigationLink</span>(<span class="string">&quot;ç¬¬äºŒé¡¹&quot;</span>, destination: <span class="type">SPList</span>(title: <span class="string">&quot;åˆ—è¡¨2&quot;</span>))</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">Section</span>(<span class="string">&quot;ç¬¬äºŒç»„&quot;</span>) &#123;</span><br><span class="line">                <span class="type">NavigationLink</span>(<span class="string">&quot;ç¬¬ä¸‰é¡¹&quot;</span>, destination: <span class="type">SPList</span>(title: <span class="string">&quot;åˆ—è¡¨3&quot;</span>))</span><br><span class="line">                <span class="type">NavigationLink</span>(<span class="string">&quot;ç¬¬å››é¡¹&quot;</span>, destination: <span class="type">SPList</span>(title: <span class="string">&quot;åˆ—è¡¨4&quot;</span>))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .listStyle(<span class="type">SidebarListStyle</span>())</span><br><span class="line">        .frame(minWidth: <span class="number">160</span>)</span><br><span class="line">        .toolbar &#123;</span><br><span class="line">            <span class="type">ToolbarItem</span> &#123;</span><br><span class="line">                <span class="type">Menu</span> &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">                &#125; label: &#123;</span><br><span class="line">                    <span class="type">Label</span>(<span class="string">&quot;Label&quot;</span>, systemImage: <span class="string">&quot;slider.horizontal.3&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SPList</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> title: <span class="type">String</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> searchText: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">List</span>(<span class="number">0</span><span class="operator">..&lt;</span><span class="number">3</span>) &#123; i <span class="keyword">in</span></span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;å†…å®¹<span class="subst">\(i)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .toolbar(content: &#123;</span><br><span class="line">            <span class="type">Button</span> &#123;</span><br><span class="line">                <span class="comment">//</span></span><br><span class="line">            &#125; label: &#123;</span><br><span class="line">                <span class="type">Label</span>(<span class="string">&quot;Add&quot;</span>, systemImage: <span class="string">&quot;plus&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br><span class="line">        .navigationTitle(title)</span><br><span class="line">        .navigationSubtitle(<span class="string">&quot;å‰¯æ ‡é¢˜&quot;</span>)</span><br><span class="line">        .searchable(text: <span class="variable">$searchText</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š<br><img src="/uploads/daiming-swift-pamphlet/08.png" alt=""></p>
<p>æ‰“å¼€æµè§ˆå™¨æ˜¾ç¤ºæŒ‡å®šç½‘é¡µçš„ä»£ç <br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">NSWorkspace</span>.shared.open(<span class="type">URL</span>(string: <span class="string">&quot;https://github.com/ming1016&quot;</span>)<span class="operator">!</span>)</span><br></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;èƒŒæ™¯è¯´æ˜&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯è¯´æ˜&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯è¯´æ˜&quot;&gt;&lt;/a&gt;èƒŒæ™¯è¯´æ˜&lt;/h2&gt;&lt;p&gt;è¶Šæ¥è¶Šå¤šåŒå­¦æ‰“ç®—å¼€å§‹ç”¨ Swift æ¥å¼€å‘äº†ï¼Œå¯å¾ˆå¤šäººä»¥å‰éƒ½æ²¡æ¥è§¦è¿‡ Swiftã€‚è¿™ç¯‡å’Œæˆ‘ä»¥å‰æ–‡ç« ä¸åŒçš„æ˜¯ï¼Œæœ¬ç¯‡åªæ˜¯é¢å‘ S
    
    </summary>
    
      <category term="Programming" scheme="http://ming1016.github.io/categories/Programming/"/>
    
    
      <category term="iOS" scheme="http://ming1016.github.io/tags/iOS/"/>
    
      <category term="Swift" scheme="http://ming1016.github.io/tags/Swift/"/>
    
      <category term="Apple" scheme="http://ming1016.github.io/tags/Apple/"/>
    
  </entry>
  
  <entry>
    <title>æˆ‘å†™æŠ€æœ¯æ–‡ç« çš„ä¸€ç‚¹å¿ƒå¾—</title>
    <link href="http://ming1016.github.io/2021/07/24/my-little-idea-about-writing-technical-article/"/>
    <id>http://ming1016.github.io/2021/07/24/my-little-idea-about-writing-technical-article/</id>
    <published>2021-07-23T21:52:45.000Z</published>
    <updated>2021-07-23T22:32:51.582Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>éå¸¸æ„Ÿè°¢å¤§å®¶æŠ½å‡ºç”Ÿå‘½ä¸­å®è´µçš„ä¸€æ®µæ—¶é—´æ¥å¬æˆ‘æ¥ä¸‹æ¥çš„ä¸€å¤§æ®µå…³äºå†™æ–‡ç« é‚£äº›äº‹çš„å” å¨ã€‚å†™æ–‡ç« çš„å¥½å¤„çœ‹çœ‹<a href="https://movie.douban.com/subject/30228394/">ã€Šè§‰é†’å¹´ä»£ã€‹</a>å°±çŸ¥é“äº†ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« æˆ‘ä¸ä¼šå†™ä¸€äº›å¸¸è¯´çš„æŠ€å·§ï¼Œæ¯”å¦‚æ–‡ç« çš„å†…å®¹å‰åè¦æœ‰é€»è¾‘å…³ç³»ï¼Œå†…å®¹ä¹‹é—´æœ‰å…³è”ã€‚æ‰€è®²çŸ¥è¯†å‰åçš„å±‚æ¬¡è¦å¹³ï¼Œä¸è¦åœ¨æŸä¸ªéƒ¨åˆ†æŒ–æ˜è¿‡æ·±ã€‚å†™ä½œè¿‡ç¨‹ä¸­ç‰¢ç‰¢æŠ“ä½è¦è¡¨è¾¾çš„å†…å®¹ï¼Œä¸è¦è¿‡äºåç¦»ä¸»é¢˜ã€‚ç±»ä¼¼è¿™æ ·çš„æŠ€å·§ä¸ä¼šè¯´ã€‚éƒ½è¯´ä¸€æµçš„äººè®¨è®ºæ€æƒ³ã€æ™®é€šäººè®¨è®ºäº‹æƒ…ã€ä¸‰æµçš„äººè®¨è®ºäººï¼Œé‚£ä¹ˆä¸ºäº†æé«˜æ–‡ç« é«˜åº¦ï¼Œé™¤äº†è¯´äº›äº‹æƒ…ï¼Œæˆ‘è¿˜æ‰“ç®—åŠ äº›æ€æƒ³çš„å†…å®¹ã€‚</p>
<p>å¤§å®¶éƒ½ä¹ æƒ¯å»é˜…è¯»ä»–äººäººç”Ÿä½“éªŒæ¥ä½“éªŒä¸ä¸€æ ·çš„äººç”Ÿï¼Œè¿™æ ·çš„æ–¹å¼å’Œè¯„å¤´è®ºè¶³ä¸€æ ·ç®€å•èˆ’æœï¼Œè½»æ¾çˆ½å¿«ã€‚è€Œä¸»åŠ¨å»å¯¹è‡ªå·±æ€æƒ³è¿›è¡Œç ”ç©¶å’Œå¼€å‘ï¼Œé€šè¿‡å†™ä½œè¾“å‡ºè‡ªå·±ç‹¬ç‰¹çš„ç»å†å’Œæ€è€ƒå´æ˜¯å›°éš¾ä¸”éš¾å—çš„ï¼Œä½†è¿™æ ·ä»0åˆ°1å’Œä»0åˆ°10çš„åˆ›é€ è¿‡ç¨‹è·å¾—çš„ä¹è¶£å´æ˜¯å‰è€…çš„ç™¾å€ç”šè‡³æ›´å¤šï¼Œè¿™èƒŒåæ‰€éµå¾ªçš„åŸåˆ™æ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</p>
<p>æ¯ä¸ªå¿ƒå¾—éƒ½ä¼šåŸºäºæŸäº›åŸåˆ™ï¼Œä»¥è‡³äºæ€è·¯ä¸ä¼šæ•£æ¶ï¼Œè€Œæ‰€æœ‰çš„åŸåˆ™éƒ½æ— æ³•è¿èƒŒç‰©çƒ­åŠ›å­¦ç¬¬äºŒå®šå¾‹ï¼Œä¹Ÿå°±æ˜¯ç†µå¢å®šå¾‹(å¼ºçƒˆå»ºè®®å…ˆçœ‹çŸ¥ä¹<a href="https://zhuanlan.zhihu.com/p/72896309">è¿™ç¯‡</a>ä»‹ç»)ã€‚å°±è¿è¿›åŒ–è®ºéƒ½æ˜¯éµå¾ªç†µå¢å®šå¾‹ã€‚</p>
<p>å¯¹äºå†™ä½œçš„å¿ƒå¾—æˆ‘æç‚¼å‡ºç‹¬ç‰¹æ€§ã€çœŸå®æ„Ÿã€æ•…äº‹æ€§å’Œæ–°æ„å››ä¸ªç‚¹ï¼Œå…¶ä¸­çš„ç‹¬ç‰¹æ€§å’Œæ–°æ„éƒ½æ˜¯é€†ç€ç†µå¢çš„è¿‡ç¨‹ï¼Œå…¶è¿‡ç¨‹æ˜¯éå¸¸éš¾å—ç…ç†¬çš„ï¼Œå¯èƒ½åšäº†å¤§é‡ä»˜å‡ºä¹Ÿæ²¡ç»“æœï¼Œå› ä¸ºé€†ç†µå¢æ˜¯éçº¿æ€§çš„ï¼Œæ— æ³•é¢„æµ‹çš„ï¼Œåªæœ‰åœ¨å¶ç„¶çš„æœºä¼šæ‰ä¼šæœ‰å¼€æŒ‚çš„æ„Ÿè§‰ã€‚å¯¹äºçœŸå®æ„Ÿå’Œæ•…äº‹æ€§å±äºçº¿æ€§ç§¯ç´¯ï¼Œå’Œé˜…è¯»åˆ«äººçš„æ–‡ç« ä¸€æ ·ï¼Œæ˜¯å¾ˆå®¹æ˜“åšåˆ°çš„äº‹æƒ…ï¼Œéƒ½æ˜¯ç†µå¢è¿‡ç¨‹ï¼Œæœ‰å¿…è¦ï¼Œå®¹æ˜“çœ‹åˆ°ç»“æœï¼Œä½†ä¼šæœ‰å†…è€—ï¼Œå¦‚æœæ²¡æœ‰æ›´å¤šç‹¬ç‰¹æ€§çš„ç»å†æ¥é€†ç†µï¼Œå¯è¾“å‡ºçš„å†…å®¹ä¼šè¶Šæ¥è¶Šæ··ä¹±ï¼Œè½åï¼Œæ¸æ¸æ— ç”¨ã€‚å› æ­¤ç‹¬ç‰¹æ€§ã€çœŸå®æ„Ÿã€æ•…äº‹æ€§å’Œæ–°æ„è¿™å››ä¸ªç‚¹ä¹‹é—´éœ€è¦å¹³è¡¡ä¸æ¼”è¿›ï¼Œæ‰èƒ½å¤Ÿä¿æŒè¿›åŒ–çš„æ´»åŠ›ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘å°±è¯¦ç»†å±•å¼€æ¥è·Ÿä½ è¯´è¯´ç‹¬ç‰¹æ€§ã€çœŸå®æ„Ÿã€æ•…äº‹æ€§å’Œæ–°æ„å››ä¸ªç‚¹ï¼Œé€šè¿‡æˆ‘ä»¥å‰å†™çš„ä¸€äº›æ–‡ç« æ¥è¯¦ç»†è¯´æ˜ã€‚å¦‚æœä½ è¿˜ä¸çŸ¥é“å¦‚ä½•ä¸‹ç¬”ï¼Œæˆ‘è¿˜ä¼šä»‹ç»ä¸€ä¸ªå®¹æ˜“ç€æ‰‹å»åšè®°å½•å’Œåˆ†äº«è¾“å‡ºçš„æ–¹æ³•æ­¥éª¤ï¼Œæœ€åä¼šä»å¤´åˆ°å°¾ä¸¾ä¸ªä¾‹å­æŒ‰ç…§å‰é¢ä»‹ç»çš„æ­¥éª¤æ¼”ç¤ºå¦‚ä½•å†™å®Œä¸€ç¯‡æŠ€æœ¯æ–‡ç« ã€‚ç‰¹åˆ«æ˜¯é‚£äº›é€†ç†µçš„è¿‡ç¨‹ï¼Œè®©ä½ èƒ½å¤Ÿå¤šäº›ä½“æ„Ÿã€‚</p>
<h2 id="å››ä¸ªç‚¹"><a href="#å››ä¸ªç‚¹" class="headerlink" title="å››ä¸ªç‚¹"></a>å››ä¸ªç‚¹</h2><p>å…ˆåˆ†åˆ«ä»‹ç»ä¸‹è¿™å››ä¸ªç‚¹ã€‚</p>
<h3 id="ç‹¬ç‰¹æ€§"><a href="#ç‹¬ç‰¹æ€§" class="headerlink" title="ç‹¬ç‰¹æ€§"></a>ç‹¬ç‰¹æ€§</h3><p>ç‹¬ç‰¹æ€§ä¹Ÿå°±æ˜¯è‡ªå·±çš„ç»å†å’Œä½“éªŒï¼Œè¿™ä¸ªæ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œæ–‡ç« çš„å†…å®¹å¦‚æœæœ‰æ›´å¤šçš„ä¸ªäººç»å†ï¼Œä½œä¸ºè¯»è€…ä¹Ÿå°±èƒ½å¤Ÿä½“éªŒåˆ°æ›´å¤šçš„ç”Ÿæ´»ã€‚</p>
<p>è¡Œä¸‡é‡Œè·¯ï¼Œå¤šå»åšä¸åŒäº‹æƒ…ï¼Œå¤šå°è¯•ä¸åŒæ–¹æ³•ï¼Œä¹Ÿå°±èƒ½å¤Ÿè·å–åˆ°æ›´å¤šçš„ç»å†ã€‚ç‹¬ç‰¹æ€§æ˜¯å†…å®¹ä¸­æœ€é‡è¦çš„éƒ¨åˆ†ï¼Œå¦‚æœè¿™å››ç‚¹é‡è¦æ€§å…±åˆ†åå±‚çš„è¯ï¼Œæˆ‘è®¤ä¸ºç‹¬ç‰¹æ€§å°±å¯ä»¥å åˆ°å…­å±‚ã€‚</p>
<h3 id="çœŸå®æ„Ÿ"><a href="#çœŸå®æ„Ÿ" class="headerlink" title="çœŸå®æ„Ÿ"></a>çœŸå®æ„Ÿ</h3><p>è®°å¾—ä¸€ä¸ªç¾å‰§ç¼–å‰§åˆ†äº«è¿‡ä»–å†™ç¼–å‰§çš„ç»éªŒï¼Œå…¶ä¸­æåˆ°è¦å†™çš„é¢˜æï¼Œä»–è‡³å°‘ä¼šèŠ±ä¸Šä¸€å¹´ä»¥ä¸Šçš„æ—¶é—´å»æ”¶é›†å’Œæ•´ç†ç›¸å…³èµ„æ–™ã€‚ä»–è®¤ä¸ºåªæœ‰æŠŠé¢˜æç›¸å…³ç»†èŠ‚éƒ½åƒé€äº†ï¼Œç¼–æ’åˆ°å‰§é‡Œï¼Œè§‚ä¼—æ‰ä¼šæ„Ÿè§‰æ›´çœŸå®ï¼Œä»£å…¥æ„Ÿæ‰ä¼šå¼ºï¼Œèº«åŒæ„Ÿå—æ‰ä¼šæœ‰å…±é¸£ã€‚å¦‚æœè§‚ä¼—æ„Ÿåˆ°å‡ï¼Œæ„Ÿè§‰ä¸åˆ°ç”¨å¿ƒï¼Œé‚£ä»–æ€ä¹ˆä¼šå»äº†è§£ä½ æƒ³è¡¨è¾¾çš„å†…å®¹å‘¢ã€‚</p>
<p>å› æ­¤çœŸå®æ„Ÿæ˜¯è¡¨è¾¾å†…å®¹çš„åŸºç¡€ï¼Œè€Œä¸”æ˜¯æœ€è´¹æ—¶çš„ã€‚ç›¸è¾ƒäºç‹¬ç‰¹çš„ä¸ªäººç»å†ï¼ŒçœŸå®æ„Ÿæ˜¯éœ€è¦èŠ±è´¹å¤§é‡æ—¶é—´å»è°ƒç ”ä½œè€…ä»¥å‰ä¸äº†è§£çš„ä¸œè¥¿ã€‚è€Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿæ˜¯äº†è§£åˆ«äººç»å†çš„è¿‡ç¨‹ï¼Œå¯ä»¥å­¦ä¹ åˆ°å¾ˆå¤šä»¥å‰ä¸çŸ¥é“çš„äº‹æƒ…ã€‚</p>
<p>çœŸå®æ„Ÿæ˜¯å¯¹ç‹¬ç‰¹æ€§çš„æ‰©å……ï¼Œæ˜¯ä¸°å¯Œå’ŒæŒ–æ˜æ²‰æ·€ç‹¬ç‰¹æ€§çš„ï¼Œå¯ä»¥å åˆ°ä¸¤å±‚ï¼Œåé¢çš„æ•…äº‹æ€§å’Œæ–°æ„å„å ä¸€å±‚ã€‚</p>
<h3 id="æ•…äº‹æ€§"><a href="#æ•…äº‹æ€§" class="headerlink" title="æ•…äº‹æ€§"></a>æ•…äº‹æ€§</h3><p>æˆ‘å¾ˆå–œæ¬¢é‡‘åº¸çš„å°è¯´ï¼Œç‰¹åˆ«æ˜¯å°„é›•è‹±é›„ä¼ ã€ç¥é›•ä¾ ä¾£å’Œå€šå¤©å± é¾™è®°è¿™ä¸‰éƒ¨ï¼Œèµ·åˆå¯¹é‡‘åº¸å…¶å®ƒå°è¯´å…´è¶£ä¸å¤§ï¼Œä¹Ÿå¯èƒ½æ‹çš„ç”µè§†å‰§ä¸æ˜¯æˆ‘çš„èœã€‚åæ¥æŠ±ç€çˆ±å±‹åŠä¹Œçš„æ€åº¦ï¼Œæˆ‘å°è¯•ç€æ‰“å¼€ç¬‘å‚²æ±Ÿæ¹–å°è¯´çš„å¼€å¤´å¼€å§‹è¯»ï¼Œä¸€ä¸‹å­å°±è¢«å¸å¼•è¿›å»äº†ã€‚ä¸å¾—ä¸ä½©æœé‡‘åº¸å†™æ•…äº‹çš„èƒ½åŠ›ï¼Œå¤ªå¼ºå¤§äº†ã€‚æ•…äº‹ä¸€å¼€å§‹åˆ¶é€ äº†ä¸€ä¸ªä»¤äººæ— æ³•è§£é‡Šçš„æ¡ˆä»¶ï¼Œä½ ä¼šéå¸¸å¥½å¥‡çš„ä¸€ç›´çœ‹ä¸‹å»ï¼Œå¾ˆæƒ³çŸ¥é“åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆã€‚å°è¯´éƒ½è¿›è¡Œäº†å¾ˆé•¿çš„éƒ¨åˆ†ä»¤ç‹å†²æ‰å‡ºç°ï¼Œä¸»è§’å‡ºç°å‰è¿˜èƒ½å¸å¼•ä½ çœ‹ä¸‹å»ï¼Œå¯è§é‡‘åº¸è®²æ•…äº‹èƒ½åŠ›æœ‰å¤šå‰å®³ã€‚</p>
<p>è‡ªä»è¿·ä¸Šé‡‘åº¸çš„å°è¯´åï¼Œæˆ‘ä¹Ÿä¼šè¯•ç€å†™äº›å°æ•…äº‹ï¼ŒåŒæ ·æˆ‘ä¼šæ³¨é‡æŠŠä¸€äº›è‡ªèº«ç‹¬ç‰¹çš„ç»å†ç©¿æ’åˆ°å†™çš„å°æ•…äº‹é‡Œï¼Œè¿™äº›æ•…äº‹æˆ‘å‘åˆ°äº†æˆ‘çš„åšå®¢ä¸Šï¼Œæœ‰<a href="https://ming1016.github.io/2019/06/19/white-dragon-class/">ç™½é¾™ç­</a>ã€<a href="https://ming1016.github.io/2016/04/04/tenth-middle-school/">åä¸­</a>ã€<a href="https://ming1016.github.io/2018/01/04/baimi/">ç™½èŠˆ</a>å’Œ<a href="https://ming1016.github.io/2018/01/04/huaye/">èŠ±é‡</a></p>
<p>æ•…äº‹æ€§æ˜¯ä¸€ç§æŠ€å·§ï¼Œæ˜¯çº¿æ€§çš„ï¼Œå¾ˆå®¹æ˜“é€šè¿‡å¤§é‡ç§¯ç´¯æŒæ¡å¥½ï¼Œæœ€ç»ˆæ˜¯å¥½æ˜¯å·®è¿˜æ˜¯å¼ºä¾èµ–äºç‹¬ç‰¹æ€§å’ŒçœŸå®æ„Ÿã€‚</p>
<h3 id="æ–°æ„"><a href="#æ–°æ„" class="headerlink" title="æ–°æ„"></a>æ–°æ„</h3><p>æ–°æ„è¿™ä¸ªç‚¹éå¸¸å…³é”®å’Œé‡è¦ï¼Œä¹Ÿæ˜¯æ¼”è¿›çš„é‡è¦å› ç´ ï¼Œä½ ä»”ç»†æƒ³æƒ³çœ‹ï¼Œå¾ˆå¤šæ·±åº¦é«˜çš„æ–‡ç« å…¶å®åº•å±‚çŸ¥è¯†éƒ½æ˜¯å·®ä¸å¤šçš„ï¼Œèƒ½å¤ŸçœŸæ­£æœ‰ç¿»å¤©è¦†åœ°çªè¿›çš„æŠ€æœ¯æ¼”è¿›ä¸ä¼šå¾ˆé¢‘ç¹ï¼Œè€Œä¸”è¿™äº›æŠ€æœ¯å¾€å¾€éƒ½åœ¨ç¡¬ä»¶å‚å•†å’Œå®éªŒå®¤ä¸­äº§ç”Ÿå‡ºæ¥ã€‚å¯¹äºå·²æœ‰åº•å±‚çŸ¥è¯†çš„è¾“å‡ºåŒºåˆ«åªæ˜¯åº”ç”¨åœºæ™¯å’Œç»„åˆè¿ç”¨æŠ€å·§ä¸Šæœ‰åŒºåˆ«ï¼Œç²¾å½©çš„å‘æ˜å’Œæ•ˆæœå¥‡ä½³çš„æ”¶ç›Šä¹Ÿèƒ½å¤Ÿè·å¾—æŒå£°ã€‚å› æ­¤æŠ€æœ¯çŸ¥è¯†å’Œç»éªŒè¾“å‡ºçš„å½¢å¼ä¹Ÿéå¸¸é‡è¦å’Œå…³é”®ï¼Œå¦‚æœæ²¡æœ‰æ–°æ„ï¼Œå¤§å®¶åŠ¿å¿…ä¼šå¯¹é‚£äº›çŸ¥è¯†æ„Ÿè§‰åˆ°ç–²å€¦ï¼Œæ²¡äººçœ‹ï¼Œå†™ä½œä¹Ÿå°±æ²¡æœ‰äº†åŠ¨åŠ›ã€‚</p>
<p>å…³äºæ–°æ„å¯ä»¥çœ‹åˆ°æ·˜ç³»å…¬ä¼—å·æœ€è¿‘ä½¿ç”¨äº†è§†é¢‘çš„æ–¹å¼æ¥è®²ä»–ä»¬çš„æŠ€æœ¯ï¼Œçœ‹èµ·æ¥å°±å¾ˆæœ‰è¶£ã€‚è¿™æ–¹é¢åªæœ‰ä½ æƒ³ä¸åˆ°ï¼Œæ²¡æœ‰ä½ åšä¸åˆ°ï¼Œæ‰“å¼€è„‘å£³ï¼Œå……åˆ†å‘æŒ¥æƒ³è±¡å§ã€‚</p>
<p>æ–°æ„ä¹‹æ‰€ä»¥åªå ä¸€å±‚ï¼Œå› ä¸ºæ–°æ„è·å¾—æˆåŠŸçš„æ¦‚ç‡è¾ƒä½ï¼Œæ˜¯éçº¿æ€§çš„ï¼Œå› æ­¤éœ€è¦ä¸æ–­å»å°è¯•ä¸åŒçš„æ–¹å¼ã€‚éœ€è¦ä¾èµ–å¤©æ—¶åœ°åˆ©äººå’Œä»¥åŠå‰ä¸‰ä¸ªç‚¹éƒ½åšçš„è¶³å¤Ÿå¥½äº†ï¼Œæ–°æ„æ‰ä¼šå–å¾—éå¸¸å¥½çš„æ•ˆæœã€‚</p>
<h2 id="æˆ‘ä»¥å‰çš„æ–‡ç« "><a href="#æˆ‘ä»¥å‰çš„æ–‡ç« " class="headerlink" title="æˆ‘ä»¥å‰çš„æ–‡ç« "></a>æˆ‘ä»¥å‰çš„æ–‡ç« </h2><p>å‰é¢è®²äº†å››ä¸ªæˆ‘è§‰å¾—å†™æŠ€æœ¯æ–‡ç« æœ€é‡è¦çš„ç‚¹ï¼Œåªæ˜¯è¯´äº†ä¸‹ç†è®ºä¸Šçš„é€»è¾‘ï¼Œä½“æ„Ÿè¿˜ä¸å¤Ÿå¼ºï¼Œä¸‹é¢æˆ‘ç»“åˆæˆ‘ä»¥å‰å†™çš„æ–‡ç« æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹è¿™äº›æ–‡ç« èƒŒåé‚£äº›ç‹¬ç‰¹çš„ç»å†å§ã€‚</p>
<h3 id="Aç«™-çš„-Swift-å®è·µ"><a href="#Aç«™-çš„-Swift-å®è·µ" class="headerlink" title="Aç«™ çš„ Swift å®è·µ"></a>Aç«™ çš„ Swift å®è·µ</h3><p>ã€ŠAç«™ çš„ Swift å®è·µã€‹<a href="https://mp.weixin.qq.com/s/rUZ8RwhWf4DWAa5YHHynsQ">ä¸Š</a>ã€<a href="https://mp.weixin.qq.com/s/EIPHLdxBMb5MiRDDfxzJtA">ä¸‹</a>ï¼Œå½“æ—¶å‘è¿™ç¯‡æ–‡ç« æ—¶ï¼Œå…³äº Swift å®è·µçš„æ–‡ç« ä¹Ÿæœ‰å¾ˆå¤šï¼Œéƒ½æ˜¯å„å‚è‡ªèº«å®è·µç»éªŒï¼Œå¯¹äºç‹¬ç‰¹æ€§è¿™ä¸ªç‚¹ï¼Œå¼€å§‹æƒ³ç€æŠŠ A ç«™åšè¿‡çš„äº‹æƒ…è¯´æ¸…æ¥šå°±å¯ä»¥äº†ï¼Œä½†æ˜¯å¾ˆå¤šçš„ç»éªŒå’Œåšçš„äº‹æƒ…å’Œå…¶ä»–å‚åšçš„å·®ä¸å¤šï¼Œè¿™æ ·å†™å‡ºæ¥ä¼šæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ï¼Œæ‰€ä»¥éœ€è¦ç€é‡è¯´ä¸‹åšçš„å’Œåˆ«äººä¸ä¸€æ ·çš„äº‹æƒ…ã€‚Aç«™æ¯”è¾ƒæœ‰ç‰¹è‰²çš„æ˜¯æ–‡ç« é‡Œæåˆ°çš„Aç«™è‡ªç ”çš„å£°æ˜å¼ UI Ysera æ¡†æ¶ï¼Œè¿™ä¸ªæ˜¯åˆ«äººæ²¡æœ‰çš„ï¼Œå¹¶ä¸”ç”±äº Ysera æ¡†æ¶å¸¦æ¥äº†å’Œ SwiftUI ç±»ä¼¼çš„ä¼˜é›…ç®€æ´ï¼Œæå‡äº†æ•´ä½“å¼€å‘çš„æ•ˆç‡å’Œä½“éªŒã€‚ç”±äº A ç«™å¾ˆæ—©å°±è¿›å…¥äº† Swift å¼€å‘æ¨¡å¼ï¼Œå¹¶ä¸”å·²æœ‰å°†è¿‘ä¸€åŠä¸šåŠ¡ä½¿ç”¨äº† Swift å¼€å‘ï¼Œæ‰€ä»¥ A ç«™ç›¸è¾ƒå…¶å®ƒå‚èµ°å¾—æ›´å¿«äº›ï¼Œå¯¹äº Swift æ–°ç‰¹æ€§è¿ç”¨çš„ä¹Ÿæ›´å¹¿ï¼Œæ¯”å¦‚å¯¹äº Property Wrapper çš„å¹¿æ³›åº”ç”¨ï¼Œä½¿å¾—ä»£ç å¤æ‚åº¦éª¤ç„¶é™ä½ã€‚èµ°å¾—æ›´è¿œè¿˜è¡¨ç°åœ¨ Module åŒ–ä¸Šï¼ŒA ç«™å¤§åŠ Pod éƒ½å®Œæˆäº† Module åŒ–ï¼Œè¿™æ–¹é¢çš„ç»éªŒä¹Ÿå¾ˆå¤šã€‚</p>
<p>æœ‰äº†ç‹¬ç‰¹æ€§ï¼Œä¸ºäº†èƒ½å¤Ÿè®©é˜…è¯»çš„äººæ›´æœ‰ä½“æ„Ÿï¼Œéœ€è¦å¯¹ä¸€äº›æŠ€æœ¯ç‚¹è¿›è¡Œè¿›ä¸€æ­¥çš„æè¿°ï¼Œä½¿å¾—æ–‡ç« ä¸€æ–¹é¢èƒ½å¤Ÿè®©è‡ªå·±å¾—åˆ°çŸ¥è¯†çš„æ€»ç»“æ²‰æ·€ï¼Œè¿˜èƒ½å¤Ÿå¯¹ä»–äººæœ‰ç”¨ã€‚è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯åœ¨æ··ç¼–çš„å†…åœ¨åŸç†ä¸Šè¿›è¡Œäº†å‰–æï¼Œè¿™æ¯”åªæè¿°è§£å†³æ··ç¼–é—®é¢˜è¿‡ç¨‹è¦æ›´åŠ é€šç”¨äº›ï¼ŒåŒæ—¶ä¹Ÿèƒ½èµ·åˆ°æˆäººä»¥æ¸”çš„ç›®çš„ã€‚ä½†æŒæ¡åŸç†å°±éœ€è¦å»å­¦ä¹ å’Œæç‚¼ç›¸å…³çŸ¥è¯†ï¼Œæ‰€ä¸‹çš„åŠŸå¤«ä¹Ÿæ›´å¤§äº›ã€‚å¦å¤–é‡‡ç”¨ Swift çš„è¯ï¼Œè¿˜æœ‰ä¸ªç»•ä¸è¿‡å»çš„æ‹…å¿§ç‚¹éœ€è¦é¢å¯¹ï¼Œè¿™å°±æ˜¯ Swift çš„åŠ¨æ€æ€§ï¼ŒSwift è¿™æ–¹é¢ç”±äºåœ¨ Swift æ ¸å¿ƒå›¢é˜Ÿå·¥ä½œä¼˜å…ˆçº§ä¸­è¾ƒä½ï¼Œç›¸è¾ƒäº OC è¦å¼±å’Œä¸æˆç†Ÿå¾ˆå¤šã€‚æ‰€ä»¥å…³äºåŠ¨æ€åŒ–å°±è¦è¯´æ¸…æ¥šï¼Œè¯´çš„å…¨é¢ç‚¹ï¼Œæœ€å¥½æ˜¯èƒ½å¤Ÿè‡ªå·±è¿›è¡Œå®éªŒå»éªŒè¯ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šå¾€å¾€æ¯ç‡¥æ¼«é•¿ï¼Œéœ€è¦è¾ƒå¤§çš„çƒ­æƒ…æ‰èƒ½å¤Ÿå®Œæˆã€‚</p>
<p>å…³äºæ•…äº‹æ€§ï¼Œæ•…äº‹æ€§å¾€å¾€æ˜¯ç”¨æ¥å¼•å…¥è¯»è¿›å»çš„ä¸€ç§åŠæ³•ï¼ŒA ç«™çš„ Swift å®è·µè¿™ç¯‡æ–‡ç« çš„å¼€å¤´é€šè¿‡è®²è¿°ä½¿ç”¨ Swift çš„å¿…è¦æ€§ã€A ç«™ä¸ºä¹‹ä»˜å‡ºçš„åŠªåŠ›å’Œæ”¶è·ã€Swift è¯­è¨€çš„æ¼”è¿›çš„è¿‡ç¨‹çš„æ–¹å¼å°½é‡é¿å¼€å…·ä½“æŠ€æœ¯æè¿°ï¼Œè€Œæ˜¯ä½¿ç”¨é€šä¿—æ˜“æ‡‚çš„æè¿°è®©è¯»çš„äººå¯ä»¥è¢«è½»æ¾å¸¦å…¥åˆ°æ–‡ç« ä¸­æ¥ã€‚</p>
<h3 id="æ·±å…¥å‰–æAuto-Layoutï¼Œåˆ†æiOSå„ç‰ˆæœ¬æ–°å¢ç‰¹æ€§"><a href="#æ·±å…¥å‰–æAuto-Layoutï¼Œåˆ†æiOSå„ç‰ˆæœ¬æ–°å¢ç‰¹æ€§" class="headerlink" title="æ·±å…¥å‰–æAuto Layoutï¼Œåˆ†æiOSå„ç‰ˆæœ¬æ–°å¢ç‰¹æ€§"></a>æ·±å…¥å‰–æAuto Layoutï¼Œåˆ†æiOSå„ç‰ˆæœ¬æ–°å¢ç‰¹æ€§</h3><p><a href="https://ming1016.github.io/2015/11/03/deeply-analyse-autolayout/">ã€Šæ·±å…¥å‰–æAuto Layoutï¼Œåˆ†æiOSå„ç‰ˆæœ¬æ–°å¢ç‰¹æ€§ã€‹</a>ã€‚å†™è¿™ä¸ªæ–‡ç« ä¹Ÿæ˜¯æœ‰ç€ä¸€æ®µä¸åŒå¯»å¸¸çš„ç»å†ã€‚é‚£æ—¶åˆšåˆ°å…¬å¸ï¼Œæ‰€æœ‰å¸ƒå±€éƒ½è¿˜æ˜¯ä½¿ç”¨çš„ frame æ–¹å¼ï¼Œè€Œ Auto Layout è‹¹æœå…¬å¸æ‰æ¨å‡ºä¸ä¹…ï¼Œåœ¨å¦ä¸€ä½è·Ÿæˆ‘ä¸€æ ·æ–°è¿›å…¬å¸ç†Ÿæ‚‰ Auto Layout åŒäº‹çš„æ€‚æ¿ä¸‹ï¼Œæˆ‘æ‰“ç®—åœ¨æ”¹ç‰ˆéœ€æ±‚ä¸­ä½¿ç”¨ Auto Layout æ¥æ›¿æ¢åŸæœ‰å¸ƒå±€æ–¹å¼ã€‚ä½†åœ¨éœ€æ±‚å¼€å‘åˆšå¼€å§‹æ—¶ï¼Œé‚£ä½ç†Ÿæ‚‰ Auto Layout çš„æ–°åŒäº‹çªç„¶ç¦»èŒäº†ï¼Œæˆ‘æ„Ÿè§‰å¤±å»äº†æ´æ‰‹ï¼Œä½†æ˜¯æˆ‘è®¤å¯äº†è¿™ä¸ªæŠ€æœ¯ï¼Œè¿˜æ˜¯åšæŒä½¿ç”¨å®ƒã€‚æœŸé—´ç¢°åˆ°çš„è‹¦éš¾æ— æ•°ï¼Œå¸ƒå±€æ€è·¯å¸¦æ¥äº†å¾ˆå¤šå¼€å‘æ–¹å¼çš„æ”¹å˜ï¼Œè¿˜æœ‰åŠ¨ç”»çš„ç»“åˆä¼šå‡ºç°çš„å„ç§æ•ˆæœä¸ä¸€è‡´ï¼Œå…¶é—´å…¬å¸è€å‘˜å·¥è¿˜ä¸æ–­åŠæˆ‘è¿˜æ˜¯èµ°è€è·¯æ¯”è¾ƒç¨³å¦¥ã€‚æ”¹ç‰ˆå®Œåå¤§éƒ¨åˆ†ä¸»æµç¨‹ï¼ŒåŒ…æ‹¬é¦–é¡µå‘å•ã€ç­‰å¾…é¡µã€æ¥å•è¿›è¡Œé¡µéƒ½è¢«æ”¹é€ æˆ Auto Layoutã€‚</p>
<p>æ›´å›°éš¾çš„äº‹æƒ…è¿˜åœ¨åé¢å‘¢ï¼Œæµ‹è¯•æœŸé—´å‘ç°åœ¨ iOS6 ä¸Šä¼šå‡ºç°å„ç§å´©æºƒã€é¡µé¢å¸ƒå±€æ··ä¹±ã€åŠ¨ç”»æ•ˆæœä¸ä¸€è‡´ç­‰é—®é¢˜ï¼Œæˆ‘çš„ Bug å§‹ç»ˆä¿æŒåœ¨ Bug åˆ—è¡¨å‰åé¡µã€‚æ”¹ Bug é‚£äº›å¤©ï¼Œæ™šä¸Šè°ƒçš„çœ¼å‘ç–¼ï¼Œæ·±å¤œæƒ³çš„éš¾å…¥çœ ã€‚çº¿ä¸‹ Bug æ”¹å®Œï¼Œä¸Šçº¿åæ‰æ˜¯å™©æ¢¦çš„å¼€å§‹ï¼Œå½“æ—¶æˆ‘ä»¬ App çš„ iOS6 ç”¨æˆ·ä¾æ—§å¾ˆå¤šï¼Œäºæ˜¯å¾ˆå¤šå¶ç°å´©æºƒè¢«æ”¾å¤§äº†ï¼Œæˆ‘çš„å´©æºƒé—®é¢˜ä¸€ç›´æ’åœ¨ Top1ï¼Œè™½ç„¶æˆ‘å¾ˆå¿«æ‰¾åˆ°äº†æ”¹å¥½çš„åŠæ³•ï¼Œä½†æ˜¯å¯¹äºè¿™å‡ ä¸ªå¶ç°çš„é—®é¢˜è¿˜éœ€è¦ä¸€ä¸ªå¯é å¯ä¿¡æœçš„è§£é‡Šï¼Œè¿™æ ·åé¢æ‰èƒ½å¤Ÿè®©å¤§å®¶æ”¾å¿ƒä½¿ç”¨ Auto Layoutã€‚è¿˜è®°å¾—å½“æ—¶å‘¨æœ«ååœ¨å¾—å®å¤§å¦çª—æˆ·è¾¹çš„å·¥ä½ä¸Šï¼Œåœ¨æŸ¥å®Œå’Œè¯•å®Œæ‰€æœ‰èµ„æ–™åä¾ç„¶æ— æœæ—¶çš„æ— åŠ›æ„Ÿã€‚æœ¬æƒ³ç€æ”¹å›ä»¥å‰çš„ frame å¸ƒå±€ç®—äº†ï¼Œååˆè§‰ä¸ç”˜ã€‚ä¸‹å‡ ä¸ªå‘¨æœ«è·‘åˆ°å„å¤§å›¾ä¹¦é¦†æŸ¥çœ‹æ‰€æœ‰æ¶‰æœ‰ Auto Layout çš„ä¹¦ï¼Œä¹Ÿæ˜¯é‚£ä¸ªæ—¶å€™äº†è§£åˆ°äº† VFL è¯­è¨€ã€‚çš‡å¤©ä¸è´Ÿæœ‰å¿ƒäººï¼ŒWWDC å¼€å§‹äº†ï¼Œå…¶ä¸­æœ‰ä¸ª Session å« Mysteries of Auto Layoutï¼Œåˆ†ä¸º<a href="https://developer.apple.com/videos/play/wwdc2015-218/">ä¸Š</a>ã€<a href="https://developer.apple.com/videos/play/wwdc2015-219/">ä¸‹</a>ä¸¤ä¸ªéƒ¨åˆ†ï¼ŒæŠŠ Auto Layout çš„åŸç†è®²å¾—éå¸¸é€å½»äº†ï¼Œè‡³æ­¤ï¼Œé€è¿‡åŸç†æˆ‘ä¹Ÿæ‰¾åˆ°äº†é—®é¢˜çš„æ ¹å› ï¼Œå¹¶æŠŠä»–ä»¬è®°å½•åœ¨äº†æ–‡ç« ä¸­ã€‚è¿™éƒ¨åˆ†å†…å®¹æˆ‘è¿˜åœ¨ä¸€ä¸ªæ²™é¾™åšäº†åˆ†äº«ï¼Œä¸‹é¢æ˜¯å½“æ—¶åˆ†äº«çš„ Auto Layout çš„åŸç†éƒ¨åˆ†çš„å†…å®¹ï¼š</p>
<p><img src="/uploads/my-little-idea-about-writing-technical-article/1.PNG" alt=""></p>
<p>å®Œæ•´å¹»ç¯ç‰‡å‚çœ‹<a href="https://ming1016.github.io/2021/07/13/deeply-analyse-autolayout-slides/">è¿™é‡Œ</a>ã€‚</p>
<p>è¿™äº›ç»éªŒçš„æ€»ç»“åœ¨å½“æ—¶æ˜¯éå¸¸æ–°çš„ï¼Œå› ä¸ºå®˜æ–¹ä¹Ÿæ˜¯åˆšå…¬å¸ƒå‡ºå…¶å†…éƒ¨çš„åŸç†ï¼Œæ²¡æœ‰äººèƒ½å¤Ÿæ›´æ—©çš„çŸ¥é“è¿™äº›ä¿¡æ¯ï¼Œä¼°è®¡ä¹Ÿå¾ˆå°‘æœ‰äººä¼šè€ƒç©¶è¿™ä¹ˆå¤šã€‚æœ‰äº†è¿™äº›ç”±äºä¸€ç›´åšæŒä¸‹æ¥å»æ‰¾æ ¹å› çš„ç»å†æ‰ä½¿å¾—æ–‡ç« æœ‰äº†ç‹¬ç‰¹æ€§ã€‚</p>
<p>å½“ç„¶ï¼Œæ·±å…¥å‰–æ Auto Layout è¿™ç¯‡æ–‡ç« ä¹ŸåŠ äº† Auto Layout çš„å†å²ã€ç”Ÿå‘½å‘¨æœŸã€VFL è¯­è¨€çš„ä»‹ç»ç”¨æ¥ä¸°å¯Œå†…å®¹çš„å¹¿åº¦ï¼Œä»¥æå‡çœŸå®æ„Ÿï¼Œä½†ä½ ä¼šå‘ç°ç‹¬ç‰¹æ€§åœ¨è¿™é‡Œæ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚</p>
<p>å¦å¤–ï¼Œåœ¨æŸ¥æ‰¾å´©æºƒé—®é¢˜æ ¹å› æ—¶ï¼Œæ²¡æœ‰æ”¾å¼ƒï¼Œä¸€ç›´åšæŒçš„å»æ‰¾ç­”æ¡ˆçš„è¿‡ç¨‹ä¹Ÿè®©æˆ‘éš¾å¿˜ã€‚ç»å¸¸ä¼šå¬è¯´åˆ°è¦å»æ‰¾è‡ªå·±çƒ­çˆ±çš„äº‹æƒ…ï¼Œéµå¾ªè‡ªå·±æ‰€æƒ³ã€‚è€Œå®é™…ä¸Šæ˜¯é‚£ä»¶çƒ­çˆ±çš„äº‹æƒ…æ˜¯ä½ æ„¿æ„èŠ±å¾ˆä¹…ç”šè‡³å¾ˆå¤šå¹´éœ€è¦å…‹æœç—›è‹¦ï¼Œè¿˜èƒ½å¤Ÿç»§ç»­å¿è€ï¼Œèƒ½å¿ä»–äººæ‰€ä¸èƒ½å¿ï¼Œèµ¢è¿‡ä»–äººä¸æ˜¯é çš„çƒ­çˆ±å’Œèƒ½åŠ›ï¼Œè€Œæ˜¯åœ¨ä¸‡èˆ¬è‰°éš¾ï¼Œåˆ«äººéƒ½æ”¾å¼ƒè€Œä½ åšæŒä¸‹æ¥æ‰èµ¢çš„ã€‚å·´è²ç‰¹21å¹´èµ„äº§5000äº¿ç¾å…ƒï¼Œå…¶ä¸­4997äº¿ç¾å…ƒæ˜¯50å²ä¹‹åèµšåˆ°çš„ï¼Œå¦‚æœ49å²é‚£å¹´ä»–å°±ä¸ç»§ç»­åšäº†ï¼Œé‚£ä¹ˆä»–å°±ä¸ä¼šæœ‰ä»Šå¹´è¿™æ ·å·¨å¤§çš„è´¢å¯Œï¼Œå°±ä¸ä¼šæ˜¾ç¤ºå·¨å¤§çš„å¤åˆ©æ•ˆåº”ã€‚</p>
<p>åæ¥æˆ‘è¿˜å‘ç°ï¼Œä¸æ–­åšæŒçš„ä¸€ä¸ªçªé—¨å°±æ˜¯å»åº†ç¥å¤§ç›®æ ‡æ–¹å‘ä¸Šçš„æ¯ä¸ªå°å°çš„æˆåŠŸï¼ŒæŠŠè¿™ä¸ªå°å°çš„æˆåŠŸå½“æˆæœ€åçš„æˆå°±é‚£æ ·å»åº†ç¥ã€‚</p>
<h3 id="åˆ¶ä½œä¸€ä¸ªç±»ä¼¼è‹¹æœVFL-Visual-Format-Language-çš„æ ¼å¼åŒ–è¯­è¨€æ¥æè¿°ç±»ä¼¼UIStackViewé‚£ç§å¸ƒå±€æ€è·¯ï¼Œå¹¶è§£æç”Ÿæˆé¡µé¢"><a href="#åˆ¶ä½œä¸€ä¸ªç±»ä¼¼è‹¹æœVFL-Visual-Format-Language-çš„æ ¼å¼åŒ–è¯­è¨€æ¥æè¿°ç±»ä¼¼UIStackViewé‚£ç§å¸ƒå±€æ€è·¯ï¼Œå¹¶è§£æç”Ÿæˆé¡µé¢" class="headerlink" title="åˆ¶ä½œä¸€ä¸ªç±»ä¼¼è‹¹æœVFL(Visual Format Language)çš„æ ¼å¼åŒ–è¯­è¨€æ¥æè¿°ç±»ä¼¼UIStackViewé‚£ç§å¸ƒå±€æ€è·¯ï¼Œå¹¶è§£æç”Ÿæˆé¡µé¢"></a>åˆ¶ä½œä¸€ä¸ªç±»ä¼¼è‹¹æœVFL(Visual Format Language)çš„æ ¼å¼åŒ–è¯­è¨€æ¥æè¿°ç±»ä¼¼UIStackViewé‚£ç§å¸ƒå±€æ€è·¯ï¼Œå¹¶è§£æç”Ÿæˆé¡µé¢</h3><p><a href="https://ming1016.github.io/2016/07/21/assembleview/">è¿™ç¯‡æ–‡ç« </a> è¯ç”Ÿçš„åŸå› æ˜¯æˆ‘å†™äº†ä¸€ä¸ªè§†å›¾å¸ƒå±€çš„åº“ AssembleViewï¼Œé€šè¿‡è¿™ç¯‡æ–‡ç« åšäº†ä¸€ä¸ªè®°å½•ã€‚è¿™ç¯‡çš„ç‹¬ç‰¹æ€§åœ¨äºæ–‡ç« èƒŒåæˆ‘ç‰¹æ®Šçš„ç»å†ã€‚é¦–å…ˆå†™ AssembleView çš„èµ·å› åœ¨äºä¹‹å‰å¤§åŠå¹´æˆ‘ä½¿ç”¨è‡ªåŠ¨å¸ƒå±€å†™äº†å¤§é‡çš„é¡µé¢å’Œä¸€äº›åŠ¨ç”»ï¼Œè™½ç„¶æœ‰æ¯”ç³»ç»Ÿæ›´åŠ ç®€åŒ–çš„ Masonry åº“å¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯å¯¹äºå¾ˆæ—©ä»¥å‰å†™è¿‡ H5 é¡µé¢çš„æˆ‘æ¥è¯´æ— è®ºæ˜¯ä»å¸ƒå±€æ€è·¯è¿˜æœ‰ç¼–å†™ä½“éªŒä¸Šï¼ŒMasonry ä¾æ—§å·®çš„å¾ˆè¿œã€‚è‹¹æœä¸ºè‡ªåŠ¨å¸ƒå±€å‘æ˜çš„ç®€æ´ VFL è¯­è¨€å´æ²¡èƒ½ç”¨åœ¨æ›´åŠ å…ˆè¿›çš„ UIStackView å¸ƒå±€æ€è·¯ä¸Šï¼Œäºæ˜¯åœ¨ä¸€æ¬¡ä¸­åˆåƒé¥­æ•£æ­¥çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘çªç„¶æœ‰äº†æŠŠ VFL è¯­è¨€å’Œ UIStackView å¸ƒå±€ç»“åˆèµ·æ¥çš„æƒ³æ³•ï¼ŒåŒæ—¶è¿˜æƒ³å¥½äº†åå­—ï¼Œå«åš AssembleViewï¼Œä¹Ÿå°±æ˜¯ç»„è£…çš„è§†å›¾çš„æ„æ€ï¼Œå¿ƒåŠ¨ä¸å¦‚è¡ŒåŠ¨ï¼Œåœ¨æ¥ä¸‹æ¥çš„ä¸€ä¸ªéœ€æ±‚å‘¨æœŸä¸­ï¼Œæˆ‘å°±ç€æ‰‹ä¸€è¾¹å¼€å‘ AssembleView ä¸€è¾¹å¼€å‘éœ€æ±‚ã€‚æ¯ä¸ªéœ€æ±‚åªæœ‰ä¸€å‘¨çš„å¼€å‘æ—¶é—´ï¼Œå½“æ—¶éœ€æ±‚åªæ˜¯æ›´æ–°è¯„ä»·çš„å‡ ä¸ªå°é¡µé¢éƒ¨ä»¶ï¼Œä½†ä¸ºäº†å°† AssembleView è¿ç”¨è¿›æ¥ï¼Œæˆ‘æŠŠæ•´ä¸ªè¯„ä»·é¡µé¢å’ŒåŠŸèƒ½è¿›è¡Œäº†é‡å†™ï¼ŒåŒ…æ‹¬æ ‡ç­¾äº‘ç­‰å¤æ‚å¸ƒå±€é‡‡ç”¨æ–°åº“çš„é‡å†™ã€‚è€Œè¿™æ ·çš„å·¥ä½œé‡ä»…åœ¨ä¸€å‘¨å†…å®Œæˆäº†ã€‚</p>
<p>çŸ­æ—¶é—´å®Œæˆ AssembleView å¹¶åº”ç”¨åˆ°äº§å“ä¸­ï¼Œå¾—ç›Šäº Deadline çš„é™åˆ¶ï¼Œè®¾ç½®æ—¶é—´èŠ‚ç‚¹ï¼Œæ²¡æœ‰æ—¶é—´èŠ‚ç‚¹çš„ç›®æ ‡é‚£å°±æ˜¯æ¢¦æƒ³ï¼Œæœ‰äº†æ—¶é—´èŠ‚ç‚¹ä¼šè®©ä½ ä¿æŒä¸€æ®µæ—¶é—´ä¸“æ³¨ï¼Œåœ¨é™åˆ¶çš„æ—¶é—´é‡Œï¼Œä½ æ²¡æ³•å»æŠŠäº‹æƒ…åšåˆ°æ–¹æ–¹é¢é¢éƒ½å¥½ï¼Œå› æ­¤æ‰ä¼šæ¿€å‘ä½ ï¼Œè®©ä½ å‘æŒ¥è‡ªèº«çš„ç‹¬ç‰¹æ€§ï¼Œå’Œåˆ«çš„ä¸åŒï¼Œå…¶å®è¿™ç§ç‹¬ç‰¹ä¼šè®©è¿™ä»¶äº‹æƒ…å®Œæˆçš„æ›´æœ‰ä»·å€¼ã€‚ä¸è¦è¯•ç€åšæœ€å¥½çš„ï¼Œè€Œæ˜¯åŠ›æ±‚åšä¸ä¼—ä¸åŒçš„ã€‚ä¸ä¼—ä¸åŒæ„å‘³ç€åˆ›æ–°ï¼Œç”»è‰å›¾å’Œä¸‹ç¬”å†™ç¨¿å­éƒ½æ˜¯åˆ›é€ çš„æ–¹å¼ï¼Œè¿™äº›è¿‡ç¨‹ä¸è¦å»åšé›•ç¢ã€æ£€æŸ¥ã€å–èˆã€åæ€è¿™æ ·çš„äº‹æƒ…ï¼Œè€Œæ˜¯é‡Šæ”¾è‡ªå·±çš„æœ¬èƒ½ï¼Œå»è‡ªç”±çš„å‘æŒ¥è‡ªå·±çš„ç§¯ç´¯å’Œæ²‰æ·€ã€‚è‰ºæœ¯æ€»æ˜¯æ¥è‡ªä¸å®Œç¾ï¼Œå§‹äºæ‚ä¹±ã€‚</p>
<p>æœ‰äº†è¿™æ ·éåŒå¯»å¸¸çš„ç»å†ï¼Œä½¿å¾—è¿™ç¯‡æ–‡ç« æœ¬èº«ç‹¬ç‰¹æ€§çš„æ„ä¹‰æ›´å¤§äº†ã€‚è®°å½•å¹¶åˆ†äº«ï¼Œèƒ½å¤Ÿè·å¾—åšç€åŒæ ·äº‹æƒ…äººçš„å…±é¸£ã€‚</p>
<p>AssembleView æœ¬èº«å°±æ˜¯å…¨æ–°ï¼Œå› æ­¤ä»å¤´åˆ°å°¾éƒ½æ˜¯æ–°æ„ã€‚</p>
<p>å½“æ—¶å†™è¿™ä¸ªåº“ä¹Ÿæ˜¯ä¸ºäº†èƒ½å¤Ÿæé«˜å®Œæˆéœ€æ±‚å’Œç»´æŠ¤éœ€æ±‚çš„æ—¶é—´ï¼Œæœ‰äº†ç²¾åŠ›æ‰èƒ½å¤Ÿåšæ›´æœ‰è¶£æœ‰æ„ä¹‰çš„äº‹æƒ…å˜›ã€‚äº”å¹´åï¼Œè‹¹æœç»ˆäºå°† VFL è¿™ç§ DSL è¯­è¨€è¿ç”¨ Swift å¼ºå¤§çš„ ResultBuilder å’Œä¸é€æ˜ç±»å‹ç­‰ç‰¹æ€§è¿›è¡Œäº†æ›´å¥½åœ°å®Œå–„ï¼Œé…åˆ Property Wrapper å’Œ Combine è¿˜æ— ç¼è¡”æ¥äº†å…ˆè¿›çš„æ•°æ®æµæ¶æ„ï¼Œæ¨å‡ºäº† SwiftUIã€‚</p>
<h3 id="æ·±å…¥å‰–æ-JavaScriptCore"><a href="#æ·±å…¥å‰–æ-JavaScriptCore" class="headerlink" title="æ·±å…¥å‰–æ JavaScriptCore"></a>æ·±å…¥å‰–æ JavaScriptCore</h3><p><a href="https://ming1016.github.io/2018/04/21/deeply-analyse-javascriptcore/">ã€Šæ·±å…¥å‰–æ JavaScriptCoreã€‹</a> è¿™ç¯‡æ–‡ç« è¦è¯´ç‹¬ç‰¹æ€§ï¼Œé‚£å°±æ˜¯å¯¹ JavaScript è¯­è¨€çš„å¥½å¥‡å¿ƒã€‚æˆ‘å¾ˆæ—©å°±å¼€å§‹ä½¿ç”¨ JavaScript æ¥å¼€å‘ç½‘ç«™ï¼Œå·¥ä½œå’Œä¸ªäººç½‘ç«™çš„å‰ç«¯éƒ½æ˜¯ä¾èµ–äºè¿™é—¨è¯­è¨€ï¼Œå…¶å®çŸ¥æƒ…äººéƒ½çŸ¥é“ï¼Œé€‰æ‹© JavaScript ä¹Ÿæ˜¯æ²¡æœ‰é€‰æ‹©çš„é€‰æ‹©ã€‚å¹´è½»æ—¶åªé¡¾ç€ä½¿ç”¨æŠ€æœ¯å»åšä¸œè¥¿ï¼Œä¹Ÿåšäº†è‡ªå·±è§‰å¾—éå¸¸æœ‰è¶£çš„ç¨‹åºï¼Œæ»¡è¶³æ„Ÿåè¶³ï¼Œç°åœ¨è½¬å‘å¯¹å…¶èƒŒåçš„æœºåˆ¶æŠ€æœ¯å¥½å¥‡å’Œæ„Ÿå…´è¶£äº†ã€‚è¿˜æœ‰ä¸€ä¸ªè¿«ä½¿è‡ªå·±å»äº†è§£ JavaScript å¼•æ“çš„åŸå› æ˜¯å·¥ä½œä¸­åšåŠ¨æ€é¡µé¢æ—¶éœ€è¦ç”¨åˆ°å¯¹ä¸šåŠ¡é€»è¾‘çš„è§£é‡Šæ‰§è¡Œå¤„ç†ã€‚ä¸ºäº†é¿å…ä½¿ç”¨ä¸­å‡ºäº†é—®é¢˜ä¼šä¸€è„¸æ‡µï¼Œæ·±å…¥äº†è§£å®ƒæ˜¾å¾—å¾ˆæœ‰å¿…è¦ã€‚</p>
<p>å…‰æœ‰æƒ³æ³•æ˜¯æ²¡æœ‰ä¸€ç‚¹ç”¨çš„ï¼ŒJavaScriptCore å…¶å®éå¸¸çš„åºå¤§ä¸”å¤æ‚ï¼Œå½“æ—¶èƒ½æ‰¾åˆ°çš„å¤§éƒ¨åˆ†èµ„æ–™éƒ½æ˜¯ Bridge å’Œ RN çš„è¿ç”¨ï¼Œå¥½åœ¨å¼€æºäº†ï¼Œäº†è§£å†…éƒ¨çš„è¯è¿˜å¯ä»¥æ‹‰ä»£ç æ¥çœ‹ã€‚ä½†æ˜¯ç›´æ¥åŸ‹è¿›å»çœ‹ä»£ç ï¼Œä»£ç é‡æ¯”è¾ƒå¤§ï¼Œå¾ˆå®¹æ˜“ miss æ‰å…¶ç²¾å¦™ä¹‹å¤„ã€‚å¥½åœ¨å‘ç°äº† JavaScriptCore é¡¹ç›®æ ¸å¿ƒå¼€å‘è€… Filip Pizloï¼Œé€šè¿‡ä»–çš„<a href="http://www.filpizlo.com/">ä¸ªäººç½‘ç«™</a>æ‰¾åˆ°äº†å¤§é‡ JavaScriptCore çš„ä¸€æ‰‹èµ„æ–™ï¼Œæ²¡æ—¥æ²¡å¤œçš„å•ƒå†…å®¹ï¼ŒåŒæ—¶è¿˜è¯•ç€åŠ¨æ‰‹å»å®ç°ä¸€äº›æŠ€æœ¯ç»†èŠ‚ï¼Œæœ€ç»ˆäº†è§£å’Œå­¦ä¹ äº†å¾ˆå¤šè§£é‡Šå™¨ã€è™šæœºç›¸å…³çŸ¥è¯†ã€‚è·å–ä¸€æ ·ä¸œè¥¿å¸¦æ¥çš„æ»¡è¶³æ„Ÿæ˜¯æ²¡æœ‰è·å–ç»éªŒå¸¦æ¥çš„æ»¡è¶³æ„Ÿæ›´æ·±åˆ»ã€‚æˆ‘æŠŠå­¦åˆ°çš„è¿™äº›ç»éªŒéƒ½è®°å½•åœ¨äº†è¿™ç¯‡æ–‡ç« ä¸­ï¼Œè¿™ä½¿å¾—æ–‡ç« çš„ç‹¬ç‰¹æ€§æ›´åŠ æ·±åˆ»ï¼ŒçœŸå®æ„Ÿè¾¾åˆ°äº†æ»¡æ£šã€‚</p>
<h3 id="æ·±å…¥å‰–æ-JavaScript-ç¼–è¯‘å™¨-è§£é‡Šå™¨å¼•æ“-QuickJS-å¤šäº†è§£äº›-JavaScript-è¯­è¨€"><a href="#æ·±å…¥å‰–æ-JavaScript-ç¼–è¯‘å™¨-è§£é‡Šå™¨å¼•æ“-QuickJS-å¤šäº†è§£äº›-JavaScript-è¯­è¨€" class="headerlink" title="æ·±å…¥å‰–æ JavaScript ç¼–è¯‘å™¨/è§£é‡Šå™¨å¼•æ“ QuickJS - å¤šäº†è§£äº› JavaScript è¯­è¨€"></a>æ·±å…¥å‰–æ JavaScript ç¼–è¯‘å™¨/è§£é‡Šå™¨å¼•æ“ QuickJS - å¤šäº†è§£äº› JavaScript è¯­è¨€</h3><p>å¯¹äº JavaScript å¼•æ“ï¼Œæˆ‘å…ˆå‰å°±çœ‹äº† JavaScriptCoreï¼Œä¸ºå•¥è¿˜è¦å†å»çœ‹ QuickJS è¿™ä¸ªè½»é‡çš„ JavaScript å¼•æ“å‘¢ã€‚å†™<a href="https://ming1016.github.io/2021/02/21/deeply-analyse-quickjs/">è¿™ç¯‡æ–‡ç« </a>åŠ¨åŠ›ä¸»è¦è¿˜æ˜¯å¯¹QuickJSå¦‚ä½•ä½¿ç”¨ç²¾ç®€é«˜æ•ˆçš„ä»£ç å®ç°äº†é‚£ä¹ˆå¤æ‚åŠŸèƒ½ï¼Œè¿˜æœ‰æé«˜çš„æ€§èƒ½ã€‚QuickJS åŸºæœ¬æ˜¯ä»å¤´çœ‹åˆ°å°¾ï¼Œä¸€ç‚¹ä¸€ç‚¹çš„åˆ†æï¼Œæ•´ä¸ªè¿‡ç¨‹ä¹Ÿéƒ½è®°å½•äº†ä¸‹æ¥ã€‚ä½†æ˜¯æˆ‘è§‰å¾—è®°å½•æºç çš„åˆ†æè¿˜ä¸å¤Ÿï¼Œè™½ç„¶è¿™äº›åˆ†æä½¿å¾—æ–‡ç« çš„çœŸå®æ„Ÿå¾ˆé«˜ï¼Œå‰ææ˜¯è¯»çš„äººä¹Ÿä¼šåŸ‹è¿›ä»£ç é‡Œã€‚ä¸ºäº†æé«˜æ–‡ç« çš„ç‹¬ç‰¹æ€§å’Œæ•…äº‹æ€§ï¼Œæˆ‘åœ¨æ–‡ç« å¼€å¤´åŠ å…¥äº†ä¸€äº› JavaScript çš„ä¸€äº›èƒŒæ™¯å†…å®¹ï¼Œè¿˜æœ‰äº›å½“å¹´ä½¿ç”¨å‰ç«¯æŠ€æœ¯çš„ä½“ä¼šå’Œç»éªŒã€‚</p>
<p>åªçœ‹ä»£ç ä¸å»ä¿®æ”¹å’Œè°ƒè¯•ï¼Œå¾€å¾€ä¼šå¾ˆæ¯ç‡¥ï¼Œæˆ‘åœ¨åˆ†æä»£ç å‰ï¼Œä¹Ÿå†™äº†äº›å’Œ QuickJS å·¥ç¨‹é…ç½® makefile ç›¸å…³çš„å†…å®¹ï¼Œå¹¶ä»¥ QuickJS æœ¬èº«çš„ makefile çš„ç”¨æ³•è¿›è¡Œä¸¾ä¾‹è¯´æ˜ã€‚å¦å¤–è¿˜æ‰‹æŠŠæ‰‹è¯´æ˜äº†æ€ä¹ˆç”¨ Xcode æ¥ç¼–è¯‘å®‰è£…è°ƒè¯• QuickJS ä»£ç ï¼Œè¿™äº›éƒ½æ˜¯æ¯”è¾ƒç‹¬ç‰¹çš„å†…å®¹ã€‚QuickJS çš„æ ¸å¿ƒä»£ç åŸºæœ¬éƒ½å†™åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œé˜…è¯»åˆ†ææ—¶éœ€è¦éå¸¸çš„ä¸“æ³¨ï¼Œå¦‚æœä¸ä¸“æ³¨ï¼Œå¯èƒ½è¿™ç¯‡æ–‡ç« ä¹Ÿå°±æ²¡æ³•å†™å®Œã€‚å¦‚æœä½ èŠ±å¤§é‡æ—¶é—´åœ¨å®¶ç©æ¸¸æˆã€çœ‹ç”µè§†å‰§å’Œåˆ·çŸ­è§†é¢‘ï¼Œè€Œä¸å·¥ä½œï¼Œé‚£ä¹ˆå°±ä¼šæœ‰å±æœºæ„Ÿå’Œè´Ÿç½ªæ„Ÿã€‚ä½†æ˜¯å¦‚æœä¼šå»å·¥ä½œï¼Œä½†æ˜¯æœŸé—´æ€»ä¼šæ‰¾ç€é—´éš™å»åšå…¶ä»–äº‹æƒ…ï¼Œåˆ·åˆ·å¾®åšï¼Œçœ‹çœ‹æœ‹å‹åœˆï¼Œç…ç…æ–°é—»ä»€ä¹ˆçš„ï¼Œé‚£å°±ä¸ä¼šæœ‰è´Ÿç½ªæ„Ÿï¼Œå› ä¸ºä½ ä¼šè§‰å¾—ä½ è¿˜æ˜¯åœ¨å·¥ä½œç€å‘¢ã€‚æ²¡å…¨åŠ›å»å·¥ä½œï¼Œè€Œåœ¨å‡è£…å·¥ä½œç€ï¼Œå¯æ¯”å®Œå…¨ä¸å·¥ä½œçš„å±å®³æ›´å¤§ã€‚ä¸€å¿ƒä¸€æ„çš„é•¿æ—¶é—´å»åšå·¥ä½œå¤–çš„äº‹æƒ…ï¼Œåè€Œèƒ½å¤Ÿå¼€çœ¼ç•Œæ‰©è§†é‡ï¼Œä»è€Œåå“ºå·¥ä½œï¼Œå·¥ä½œçš„æ›´å¥½æ›´å¼€å¿ƒã€‚æ–°æ—¶ä»£å°±ä¼šæœ‰æ–°æœºä¼šï¼ŒåŒæ—¶ä¹Ÿä¼šæœ‰æ–°çš„è¦æ±‚ï¼Œæ¯”å¦‚çŸ¥è¯†çš„è·å–ä»å•ä¸€æ„Ÿå®˜æ–¹å¼å˜æˆäº†åŠ¨æ€çš„ï¼Œå¤šæ„Ÿå®˜çš„æ–¹å¼ã€‚ä»¥å‰åªæ˜¯æ–‡å­—å’Œå›¾ç‰‡çš„ä¹¦å’Œåšå®¢ï¼Œæ–°æ—¶ä»£å°±æ˜¯è§†é¢‘ã€ç›´æ’­å’Œæ’­å®¢ï¼Œæ–°æ—¶ä»£ä½ æœ‰æ›´å¤šæ–¹å¼å‡ºç°åœ¨å¤§å®¶é¢å‰ï¼Œå‡ºç°çš„æ›´å¤šå°±ä»£è¡¨äº†æˆåŠŸã€‚æœªæ¥ä¼šæœ‰æ›´å¤šæ„Ÿå®˜æ–¹å¼ï¼Œè€Œä¸”æ›´åŠ çš„æ™ºèƒ½ã€‚è·å–çŸ¥è¯†çš„é—¨æ§›ä½äº†ï¼Œäººç¾¤ä¹Ÿå°±æ›´å¹¿äº†ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºæ–°çš„æœºä¼šæ›´å¤§äº†ï¼Œä¿æŒä¸“æ³¨ä¸è®¾é™å»æ„Ÿå—æ–°æ—¶ä»£ï¼Œå¯¹è‡ªå·±ä¸æ–­åšå‡ºæ–°çš„è¦æ±‚ï¼Œå°±ä¼šæœ‰æ–°çš„æœºä¼šã€‚</p>
<h3 id="æ·±å…¥å‰–æ-iOS-ç¼–è¯‘-Clang-LLVM"><a href="#æ·±å…¥å‰–æ-iOS-ç¼–è¯‘-Clang-LLVM" class="headerlink" title="æ·±å…¥å‰–æ iOS ç¼–è¯‘ Clang / LLVM"></a>æ·±å…¥å‰–æ iOS ç¼–è¯‘ Clang / LLVM</h3><p>å†™<a href="https://ming1016.github.io/2017/03/01/deeply-analyse-llvm/">è¿™ç¯‡æ–‡ç« </a>çš„åŸå› ä¸»è¦æ¥è‡ªåœ¨å…¬å¸åšçš„ App å®‰è£…åŒ…ä½“ç§¯ç˜¦èº«çš„äº‹æƒ…ï¼Œç»è¿‡å„ç§å·¥å…·ä½¿ç”¨å’Œåˆ†æåï¼Œæ€»æ˜¯æ‰¾ä¸åˆ°çªç ´å£ã€‚éœ€æ±‚è¿˜åœ¨ä¸æ–­å åŠ ï¼Œä¹Ÿæ²¡æœ‰å¥½çš„æ€è·¯ã€‚å½“ä½ é‡åˆ°å›°éš¾æ—¶ï¼Œåšä¸æˆçš„äººæ‰ä¼šå‘Šè¯‰ä½ ä½ ä¹Ÿåšä¸æˆï¼Œå¦‚æœä½ çœŸçš„æƒ³åšæˆï¼Œæœ‰è¿™ä¸ªç†æƒ³å°±è¦è‡ªå·±å»å®ˆæŠ¤ä»–ã€‚é‡åˆ°å›°éš¾ç¦»æˆåŠŸæ‰ä¼šæ›´æ¥è¿‘ã€‚é‚£äº›å›°éš¾æ¥è‡ªäºæœ‰é™çš„èµ„æºï¼Œæ¯”å¦‚æ²¡äººã€æ²¡é’±ç­‰ï¼Œä½†æ˜¯æ­£æ˜¯ç”±äºè¿™äº›èµ„æºçš„é™åˆ¶ï¼Œæ‰ä¼šè¿«ä½¿ä½ å»åˆ›æ–°ï¼Œä½ ä¼šé€šè¿‡è‡ªå·±çš„çƒ­æƒ…è¿˜æœ‰æ¯…åŠ›æ¥å¯»æ‰¾ç‹¬ç‰¹æ›´æœ‰æ•ˆçš„æ–¹æ³•ï¼Œæ‰€ä»¥ç”±äºæœ‰é™èµ„æºå¸¦æ¥çš„å›°éš¾æ‰ä¼šè®©ä½ å»çªç ´ã€æ€å˜å’Œè¿›å–ã€‚</p>
<p>å°±åœ¨ç™¾èˆ¬æ— å¥ˆï¼Œå„ç§èµ„æºæ¡ä»¶å—é™çš„æƒ…å†µä¸‹ã€‚æˆ‘æƒ³ç€çœ‹èƒ½ä¸èƒ½æŠŠéœ€è¦ç¹çæ‰‹åŠ¨æ£€æŸ¥çš„åŠ¨ä½œè¯•ç€å†™æˆç¨‹åºè‡ªåŠ¨å®Œæˆã€‚äºæ˜¯æˆ‘ç”¨ä¸€ä¸ªå‘¨æœ«å¼€å‘äº†æŸ¥æ‰¾æ— ç”¨æ–¹æ³•å·¥å…·ï¼Œèƒ½å¤Ÿè‡ªåŠ¨æŸ¥æ‰¾å‡ºå·¥ç¨‹ä¸­æ²¡æœ‰ç”¨åˆ°çš„æ–¹æ³•ï¼Œä¹Ÿå…¼é¡¾äº†æˆ‘ä»¬å·¥ç¨‹çš„ä¸€äº›è¿è¡Œæ—¶è°ƒç”¨çš„æ–¹æ³•æ£€æŸ¥ã€‚è¿™æ ·é‡å¤ç¹é‡çš„æ£€æŸ¥å·¥ä½œå°±å˜å¾—è½»æ¾äº†å¾ˆå¤šã€‚</p>
<p>å·¥å…·å¼€å‘å®Œåï¼Œæˆ‘å‘ç°è¿™å·¥å…·çš„å®ç°å¹¶æ— ç›¸å…³æˆç†Ÿç†è®ºæ¥è¿›è¡Œæ”¯æŒï¼Œä»¥åæ€ä¹ˆå®Œå–„å’Œä¼˜åŒ–è¿™ä¸ªå·¥å…·ä¹Ÿæ²¡æœ‰ä¸€ç‚¹æ€è·¯ã€‚ä¸ºæ­¤æˆ‘è¿˜è‹¦æ¼äº†è›®ä¹…çš„ã€‚</p>
<p>ç»è¿‡ä¸€ä½åŒäº‹æé†’ï¼Œè¯´å¤§å­¦æœ‰é—¨ç¼–è¯‘åŸç†çš„è¯¾é‡Œé¢å°±æœ‰è®²æ€ä¹ˆåˆ†æä»£ç çš„ï¼Œäºæ˜¯æˆ‘å°±å¼€å§‹é’ˆå¯¹æ€§çš„ç¿»é˜…ç›¸å…³èµ„æ–™ã€‚äºæ˜¯ä¹ï¼Œæˆ‘å‘ç°äº†ä¸€ç‰‡è“æµ·ï¼Œè¿™é‡Œé¢æ¶‰åŠåˆ°çš„æŠ€æœ¯ä¸å…‰æ˜¯åˆ†æä»£ç ï¼Œè¿˜æœ‰å¾ˆå¤šä»¥å‰ä¸äº†è§£çš„ç¨‹åºæ€ä¹ˆè·‘èµ·æ¥çš„ç»†èŠ‚ï¼Œè¿™é‡Œçš„çŸ¥è¯†å°±åƒå¯ä»¥æ— é™é€’å½’çš„æ ‘ï¼Œèƒ½å¤Ÿå°†ä½ æ‰€æœ‰æ—¶é—´éƒ½åæ²¡ã€‚è¿™ç¯‡æ–‡ç« æˆ‘æ›´æ–°æ·»åŠ å†…å®¹çš„æ¬¡æ•°ä¸ä¸‹åæ¬¡ï¼Œæ¯å½“getåˆ°äº†æ–°çš„ä¸œè¥¿éƒ½å¿ä¸ä½è®°å½•ä¸‹æ¥ã€‚è¿™æœŸé—´åŠ¨æ‰‹å»å®è·µä¸€äº›çŸ¥è¯†ç‚¹ï¼Œä¹Ÿé‡åˆ°å¾ˆå¤šé—®é¢˜ï¼Œè§£å†³è¿™äº›é—®é¢˜çš„è¿‡ç¨‹ï¼Œå¯¹ç›¸å…³çŸ¥è¯†ç†è§£å°±æ›´æ·±å…¥äº†ã€‚åæ¥åœ¨17å¹´çš„@Swift å¤§ä¼šä¸Šè¿˜åšäº† LLVM ç›¸å…³å†…å®¹çš„åˆ†äº«ï¼Œä¸‹å›¾æ˜¯å…¶ä¸­ä¸€å¼  Slideã€‚</p>
<p><img src="/uploads/my-little-idea-about-writing-technical-article/2.png" alt=""></p>
<p>å®Œæ•´å¹»ç¯ç‰‡å‚çœ‹<a href="https://ming1016.github.io/2017/05/27/slides-of-learn-what-interesting-things-you-can-do-with-iOS-compilation/">è¿™é‡Œ</a></p>
<h3 id="æ·±å…¥å‰–æ-WebKit"><a href="#æ·±å…¥å‰–æ-WebKit" class="headerlink" title="æ·±å…¥å‰–æ WebKit"></a>æ·±å…¥å‰–æ WebKit</h3><p>ä¸ºäº†å®Œæˆç½‘é¡µåˆ°åŸç”Ÿä»£ç çš„è½¬æ¢ï¼Œæˆ‘å¼€å§‹å­¦ä¹  Web çš„æ ‡å‡†ï¼Œè€Œ WebKit æ˜¯è‹¹æœå…¬å¸å¯¹ Web æ ‡å‡†å®ç°ï¼ŒV8å’Œ Flutter æ¸²æŸ“æŠ€æœ¯çš„æºå¤´ï¼ŒWebKit çš„å­¦ä¹ èƒ½å¤Ÿè®©æˆ‘æ›´å®Œæ•´çš„äº†è§£ç½‘é¡µä»è¯·æ±‚åˆ°å¸ƒå±€å†åˆ°æ¸²æŸ“çš„æµç¨‹å’Œä½¿ç”¨çš„ç›¸å…³æŠ€æœ¯ã€‚<a href="https://ming1016.github.io/2017/10/11/deeply-analyse-webkit/">WebKitçš„è¿™ç¯‡æ–‡ç« </a>æˆ‘ç½—åˆ—äº†å¤§é‡çš„ Web è§„èŒƒèµ„æ–™ï¼Œç”±äº WebKit éå¸¸çš„åºå¤§ï¼Œæ¶æ„ä¹Ÿå¾ˆå¤æ‚ï¼Œæ–‡ç« é‡Œå¯¹æ¶æ„ä¹Ÿè¿›è¡Œäº†è¯¦ç»†çš„è¯´æ˜ï¼Œå¯¹æºç çš„ç»“æ„åšäº†è¯¦ç»†çš„è¯´æ˜ã€‚å…¨æ–‡æŒ‰ç…§ä¸€ä¸ªé¡µé¢ä»è¯·æ±‚åˆ°æœ€ç»ˆæ¸²æŸ“çš„æµç¨‹é¡ºåºï¼Œä¾æ¬¡å¯¹å…¶å…³é”®ç¯èŠ‚é‡Œå¯¹åº”æºä»£ç å’ŒåŸç†è¿›è¡Œäº†è¯¦ç»†çš„è¯´æ˜ã€‚å®Œæˆè¿™ç¯‡èŠ±è´¹æ—¶é—´å·¨å¤§ï¼Œä»£ç åŸºæœ¬è¯»äº†ä¸ªéã€‚ä¹‹åæˆ‘å¯¹äºå‰ç«¯æŠ€æœ¯æœ‰äº†æ›´æ·±çš„ç†è§£ï¼Œç‰¹åˆ«æ˜¯é¡µé¢å¼‚æ­¥åŠ è½½çš„æµç¨‹å’Œå¸ƒå±€åŸç†ã€‚</p>
<p>æ„Ÿè§‰è¿™ç¯‡å®Œå…¨é çš„æ˜¯å¯¹å‰ç«¯æŠ€æœ¯çš„çƒ­æƒ…å®Œæˆçš„ã€‚æ‰‹å†¢æ²»è™«è¯´è¿‡ï¼Œé‚£äº›æŠ•ç¨¿çš„äººï¼Œéƒ½æ˜¯çƒ­çˆ±ç€æ¼«ç”»ï¼ŒæŠŠç”»å‡ºä¸€éƒ¨ä½œå“ä½œä¸ºè‡ªå·±ç”Ÿå‘½æ„ä¹‰çš„äººã€‚æ‰€ä»¥ä»–ä»¬æ‰èƒ½è·å¾—æˆåŠŸï¼Œæˆä¸ºé©¬æ‹‰æ¾é‡Œè·‘åˆ°æœ€åçš„äººã€‚çƒ­æƒ…å¯ä»¥å¢åŠ 25ä¸ª IQ å€¼ã€‚å¦‚æœä¸€ä¸ªäººä»¿ä½›å¼€æ‚Ÿäº†çš„é«˜åƒ§ï¼Œå¤±å»ä»»ä½•æ¬²æ±‚ã€æ„¿æœ›ã€ä¸ç”˜ã€çƒ¦æ¨ä¸ä¼¤ç—›ï¼Œé‚£ä¹ˆå³ä½¿ä»–å»ç”»æ¼«ç”»ï¼Œå³ä½¿åŸºå› å†å¥½ï¼Œå¤©èµ‹å†é«˜ï¼Œä¹Ÿåªä¼šç”»æˆä½›æ•™çš„ç¦…ç”»ç½¢äº†ã€‚åœ¨æ¯”å°”.å¸ƒè±æ£®åœ¨ã€Šäººä½“ç®€å²ã€‹è¿™æœ¬ä¹¦ä¸­æåˆ°ä¸€ä¸ªé•œå­ç›¸å…³çš„å®éªŒï¼Œå®éªŒæ¥è‡ªä¸€åé˜²ç¢çœ¼é•œå•†äººï¼Œåœ¨1980å¹´åˆ›åŠäº†èƒšç§ç²¾é€‰æ‹©åº“ï¼ˆRepository for Germinal Choiceï¼‰ï¼Œè¿™ä¸ªç²¾å­åº“åªæœ‰è¯ºè´å°”è·å¥–è€…å’Œå…¶ä»–æ°å‡ºçŸ¥è¯†æƒå¨çš„é•œå­ã€‚ä»–æƒ³çš„æ˜¯èƒ½å¤Ÿæä¾›æœ€å¥½çš„ç²¾å­ç”Ÿå‡ºå¤©æ‰å©´å„¿ï¼Œç»“æœæ˜¯åœ¨å‡ºç”Ÿçš„200åå„¿ç«¥é‡Œï¼Œæ²¡æœ‰ä¸€ä¸ªæ°å‡ºå¤©æ‰ï¼Œç”šè‡³è¿ä¸€ä¸ªçœ¼é•œå·¥ç¨‹å¸ˆéƒ½æ²¡èƒ½é€ å‡ºæ¥ï¼Œå¯è§å¯¹åšçš„äº‹æƒ…æœ‰çƒ­æƒ…æ›´åŠ é‡è¦ï¼Œè€Œä¸ä»…ä»…åªè¦åŸºå› å¥½å°±è¡Œã€‚</p>
<h3 id="æ·±å…¥å‰–æ-iOS-æ€§èƒ½ä¼˜åŒ–"><a href="#æ·±å…¥å‰–æ-iOS-æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="æ·±å…¥å‰–æ iOS æ€§èƒ½ä¼˜åŒ–"></a>æ·±å…¥å‰–æ iOS æ€§èƒ½ä¼˜åŒ–</h3><p><a href="https://ming1016.github.io/2017/06/20/deeply-ios-performance-optimization/">æ€§èƒ½è¿™ç¯‡</a>æœ€é‡è¦çš„æ˜¯ç‹¬ç‰¹æ€§ï¼Œå¼€å§‹åªæ˜¯é’ˆå¯¹æ—¥å¸¸å¼€å‘æ€§èƒ½éœ€è¦æ³¨æ„çš„ä¸€äº›ç‚¹è¿›è¡Œäº†å½’çº³æ€»ç»“ï¼Œåæ¥éœ€è¦å¯¹å¯åŠ¨é¡¹è¿›è¡Œåˆ†æï¼Œäºæ˜¯åšäº†åˆ†æçš„å·¥å…·ï¼Œå…¶é—´æˆ‘æ— æ„å¤šæŸ¥çœ‹äº†ä¸‹ thread_basic_info_t è¿™ä¸ªç»“æ„ä½“é‡Œçš„å­—æ®µï¼Œå‘ç°äº† cpu_usageï¼Œè§‰å¾—æ—¥åå¿…æœ‰ç”¨ï¼Œäºæ˜¯ç•™äº†ä¸ªå¿ƒçœ¼ã€‚åæ¥è´Ÿè´£æ€§èƒ½çš„åŒå­¦çœ‹äº†æˆ‘çš„è¿™ç¯‡æ–‡ç« ï¼Œè·‘æ¥æ‰¾æˆ‘ï¼Œè·Ÿæˆ‘è¯´ App è¿ç»­å‡ ä¸ªç‰ˆæœ¬éƒ½æœ‰çº¿ä¸Šåé¦ˆè€—ç”µå¤ªå¤§ï¼Œä»–ä»¬è‡ªå·±ä¹Ÿå¾ˆå®¹æ˜“å¤ç°å‡ºæ¥ã€‚è¿™å‡ ä¸ªç‰ˆæœ¬è°ƒæ•´äº†å®šä½é¢‘ç‡ï¼Œæ’æŸ¥äº†å„ç§æ€€ç–‘çš„ç‚¹ï¼Œç”µé‡æ¶ˆè€—ä¾ç„¶å¾ˆå¤§ã€‚èµ·åˆæˆ‘ä¹Ÿæ²¡æœ‰æ€è·¯ï¼Œinstruments ä¹Ÿçœ‹ä¸å‡ºé—®é¢˜æ¥ï¼Œäºæ˜¯æˆ‘ä½¿ç”¨åˆ†æå¯åŠ¨é¡¹çš„æ–¹æ³•ï¼ŒæŸ¥çœ‹è¿è¡Œä¸­æ–¹æ³•è°ƒç”¨æ¬¡æ•°ï¼Œæ’åºæ¥çœ‹è°è°ƒç”¨çš„é¢‘ç¹ï¼Œåæ¥å‘ç°è°ƒç”¨é¢‘ç¹çš„æ–¹æ³•æ•°é‡å¤ªå¤šå¾ˆéš¾æ’æŸ¥å®šä½ã€‚</p>
<p>è¿™æ—¶å…ˆå‰ç•™æ„çš„ cpu_usage å­—æ®µèµ·æ¥å…³é”®çš„ä½œç”¨ï¼Œé€šè¿‡å®šæ—¶åˆ·æ–°è·å–çº¿ç¨‹ä¸­ CPU ä½¿ç”¨æƒ…å†µï¼Œè¿ç»­é«˜ä½¿ç”¨å°±æªå‡ºè¯¦ç»†çº¿ç¨‹å †æ ˆï¼Œåæ¥å°èŒƒå›´ç°åº¦ä¸Šçº¿æ£€æµ‹ï¼Œç›´æ¥å®šä½åˆ°äº†é—®é¢˜çš„å †æ ˆï¼Œå¾ˆå¿«çš„è§£å†³äº†è¿™ä¸ªå¤§éš¾é¢˜ã€‚è€Œä¸”æœ‰äº†è¿™ä¸ªæ‰‹æ®µï¼Œåé¢ä¹Ÿæœ‰äº†åº•æ°”ï¼Œåœ¨é‡åˆ°é—®é¢˜ä¹Ÿä¸ä¼šæ…Œäº†ï¼Œè€Œä¸”çº¿ä¸‹ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•è¿›è¡Œå‹åŠ›æµ‹è¯•ï¼Œä»¥å…æŠŠé—®é¢˜å¸¦åˆ°äº†çº¿ä¸Šã€‚è¿™ä¸ªæ–¹æ¡ˆä¹Ÿæ›´æ–°è®°å½•åˆ°äº†æ–‡ç« ä¸­ï¼Œæœ‰äº†è¿™ä¸ªä¸å¯»å¸¸çš„ç»å†ï¼Œæ–‡ç« ä¹Ÿå°±æœ‰äº†å¾ˆå¼ºçš„ç‹¬ç‰¹æ€§ã€‚</p>
<h3 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h3><p>å…³äºå¯åŠ¨æˆ‘å†™äº†ä¸¤ç¯‡æ–‡ç« ã€‚ç¬¬ä¸€ç¯‡æ˜¯<a href="https://ming1016.github.io/2019/12/07/how-to-analyze-startup-time-cost-in-ios/">ã€Šå¦‚ä½•å¯¹ iOS å¯åŠ¨é˜¶æ®µè€—æ—¶è¿›è¡Œåˆ†æã€‹</a>ï¼Œå¦ä¸€ç¯‡æ˜¯<a href="https://ming1016.github.io/2020/12/18/thinking-in-how-to-speed-up-app/">ã€ŠApp å¯åŠ¨æé€Ÿå®è·µå’Œä¸€äº›æƒ³æ³•ã€‹</a>ã€‚è¯´èµ·è¿™ä¸¤ç¯‡çš„ç‹¬ç‰¹æ€§ï¼Œé‚£ç»å¯¹æ˜¯ç‹¬ä¸€æ— äºŒã€‚æˆ‘è´Ÿè´£çš„è¿™åœºè¡€æ·‹æ·‹çš„æˆ˜å½¹çœŸå¯ä»¥è¯´æ˜¯æ¯•ç”Ÿéš¾å¿˜ã€‚é¡¹ç›®èµ·å› ä¸ç”¨çŒœä¹Ÿå¯ä»¥æƒ³åˆ°ï¼Œå¯åŠ¨é€Ÿåº¦æŒç»­åŠ£åŒ–ï¼Œå¯¼è‡´ç”¨æˆ·ä½“éªŒå˜å·®ï¼Œè½åå¯¹æ‰‹ä¸€å€ï¼Œæé€Ÿå›°éš¾é‡é‡ã€‚ä¸´å±å—å‘½ï¼Œå½“æ—¶æƒ³åˆ°çš„åªæœ‰ä¸€ä¸ªå­—ï¼Œé‚£å°±æ˜¯å¹²ã€‚</p>
<p>å¼€å§‹æœ€éš¾çš„è¿˜æ˜¯å®šæ–¹å‘å’Œå®šç­–ç•¥ä»¥åŠå†³ç­–ã€‚æ˜ç¡®äº†æ•´ä½“çš„æ€è·¯ï¼Œæ‰€æœ‰ä»»åŠ¡å°±å¼€å§‹å¹¶è¡Œè·‘èµ·æ¥äº†ã€‚ç”±äºé¡¹ç›®çš„é‡è¦æ€§ä¸è¨€è€Œå–»ï¼Œå› æ­¤æŠ•å…¥èµ„æºå·¨å¤§ï¼Œä¸å…‰æ˜¯æˆ‘çš„äººéƒ½å‚ä¸äº†è¿›æ¥ï¼Œè¿˜æœ‰å¾ˆå¤šå…¶ä»–å›¢é˜Ÿä¹Ÿä¸€èµ·åŠ å…¥ã€‚åœä¸‹æ‰€æœ‰æ‰‹ä¸Šä½ä¼˜äº‹æƒ…ï¼Œæ¡ç´§æ‹³å¤´å…¨åŠ›æ‰“èµ¢å…³é”®æˆ˜å½¹ã€‚è¦çš„å°±æ˜¯èƒ½å¤Ÿé€Ÿæˆ˜é€Ÿå†³ï¼Œä¸€æ—¦æ‹–å»¶ï¼Œä¸å…‰æ˜¯å£«æ°”æ²¡äº†ï¼Œç»“æœæ²¡è¾¾æˆï¼Œè¿˜ä¼šç•™ä¸‹ä¸€å †çƒ‚æ‘Šå­éš¾æœ‰èµ„æºå»æ¸…ç†ã€‚</p>
<p>ç”±äºåˆæœŸè°‹åˆ’çš„æ–¹æ¡ˆå…¨é¢ã€ç¨ å¯†ä»¥åŠæœ‰æ•ˆï¼Œå¤šä¸ªå›¢é˜Ÿé€šåŠ›åˆä½œé…åˆå¥‡ä½³ï¼Œä½¿å¾—åœ¨ä¸‰å‘¨å†…è¶…é¢„æœŸè¾¾æˆäº†ç›®æ ‡ï¼Œä¸å…‰æ˜¯é¢†å…ˆäº†å¯¹æ‰‹ä¸€å€ï¼Œè¿˜æ¯”å¤§éƒ¨åˆ†å¤´éƒ¨ App éƒ½è¦å¿«ã€‚è¿™ä¸‰å‘¨è¯´é•¿ä¸é•¿ï¼Œè¯´çŸ­ä¹Ÿä¸çŸ­ï¼Œå¤§é‡çš„å¼€å‘ã€è°ƒè¯•ã€å·¥å…·è®¾è®¡å¼€å‘ã€æ•°æ®åˆ†æã€æ£€æµ‹å’ŒéªŒè¯å·¥ä½œé›†ä¸­å¼çš„è¿›è¡Œï¼Œå¯¹ä½“åŠ›å’Œè„‘åŠ›éƒ½æ˜¯æå¤§çš„æŒ‘æˆ˜ï¼Œä¸”å‹åŠ›å·¨å¤§ã€‚</p>
<p>ç¬¬ä¸€ç¯‡è®°å½•äº†å‰æœŸçš„ç­–åˆ’å†…å®¹ä»¥åŠä¸€äº›ææ•ˆå·¥å…·çš„å¼€å‘è¿‡ç¨‹ã€‚å¯¹è¿™ä¸‰å‘¨å¹²çš„äº‹æƒ…è¿›è¡Œäº†æ²‰æ·€ï¼Œæ²‰æ·€çš„æ˜¯ä¸€æ¬¡ç‹¬ç‰¹çš„æˆåŠŸç»éªŒã€‚ç¬¬äºŒç¯‡æ˜¯åœ¨ä¸€å¹´åå†™çš„ï¼Œæ›´å¤šçš„æ˜¯è®°å½•äº†è¿™ä¸€å¹´æˆ‘å¯¹å¯åŠ¨è¿™ä»¶äº‹æƒ…çš„æ€è€ƒï¼Œä¸€å¹´æ—¶é—´çš„ç»å†ä¹Ÿå¾ˆå¤šï¼Œè¿˜ä¸»è´Ÿè´£è¿‡åŒ…ä½“ç§¯çš„é¡¹ç›®ï¼Œæ‰€ä»¥å†…å®¹å°±æ˜¾å¾—æ›´åŠ ä¸°å¯Œäº†äº›ï¼Œæœ‰è®°å½•äº›å¯¹æ€§èƒ½å’Œè°ƒè¯•å·¥å…·çš„ç ”ç©¶ã€‚</p>
<p>ç¬¬äºŒç¯‡æ–‡ç« é‡Œæˆ‘æåˆ°æˆ‘å‘ç°äº†ä¸€ä¸ªå®è—ç”·å­©<a href="https://eisel.me/">Michael Eisel</a>ï¼Œå‘ç°äº†å¾ˆå¤šäºŒæ‰‹èµ„æ–™éƒ½æ˜¯æºè‡ªä»–çš„åšå®¢ã€‚å¦å¤–ç”±äºè¿™ä¸€å¹´ä¹Ÿå‘ç°äº†æ€§èƒ½é˜²åŠ£åŒ–ä¸­ï¼Œè‡ªåŠ¨åŒ–åˆ†æå·¥å…·å’Œèƒ½åŠ›ç›¸å…³æŠ€æœ¯äº†è§£çš„ä¸å¤Ÿæ·±å…¥ã€‚äºæ˜¯ä¸“é—¨å»æ¢ç´¢äº†ä¸‹è¿™æ–¹é¢çš„æƒ…å†µã€‚å¯¹äºç›®å‰ä¸ºäº†ä¿æŒåŒç«¯ä¸€ç›´ libimobiledeviceï¼Œæˆ‘å‘ç°äº† Facebook ä¸“é—¨é’ˆå¯¹è‹¹æœç³»ç»Ÿå¼€å‘çš„ idbï¼Œidb åšæ³•æ˜æ˜¾æ›´èªæ˜äº›ã€‚</p>
<p>è¿™äº›æ¢ç©¶çš„è¿‡ç¨‹è‡³å°‘æ˜¯ç‹¬ç‰¹çš„ã€‚æ›´ç‹¬ç‰¹çš„åœ°æ–¹æ˜¯æ–‡ä¸­å†™çš„é‚£ä¸ªAåº“å¤šçº¿ç¨‹é—®é¢˜çš„æ’æŸ¥ç»å†ã€‚ç—›è‹¦çš„ç»å†æˆ‘å·²åœ¨æ–‡ä¸­æ¸…æ™°è¯¦ç»†çš„è®°å½•äº†ï¼Œå†æ—¶ä¸‰å¤©ä¸‰å¤œï¼Œå½“å¤§å®¶è¯•å®Œæ‰€æœ‰æƒ…å†µï¼Œå£«æ°”å…¨æ— æ—¶ï¼Œæ‰æŸ³æš—èŠ±æ˜åˆä¸€æ‘ã€‚å…¨å› è‹¹æœçš„ä¸€ä¸ª bugã€‚ç»å†è¿™ä¹ˆä¸€é­ï¼Œå¯¹äº GCD çš„é˜Ÿåˆ—æ’æŸ¥å®šä½é—®é¢˜éš¾è¿™ç‚¹ï¼Œæˆ‘çœ‹å›½å¤–å¯¹ iOS å¹¶å‘å¼€å‘æ–¹å¼åæ§½çš„å£°éŸ³ä¹Ÿå¾ˆå¤§ï¼Œäºæ˜¯æˆ‘å¾ˆæƒ³äº†è§£å¤šçº¿ç¨‹é—®é¢˜è‹¹æœæœªæ¥ä¼šæ€ä¹ˆå¤„ç†ã€‚è¿™å°±æœ‰äº†æ–‡ä¸­ Swift å¹¶å‘ææ¡ˆéƒ¨åˆ†çš„åˆ†æã€‚å½“æ—¶è¿™ä»½ææ¡ˆè¿˜æœªè¿›å…¥æ­£å¼æµç¨‹ï¼ˆç°åœ¨å·²ç»åœ¨ Swift 5.5æ­£å¼å‘å¸ƒäº†ï¼‰ï¼Œæœªæ¥å¹¶ä¸æ˜æœ—ï¼Œæˆ‘ä¹Ÿæ‹…å¿ƒä¼šé—æ¼å…³é”®ä¿¡æ¯ï¼Œäºæ˜¯å¯¹æ¶‰åŠç›¸å…³çš„ææ¡ˆéƒ½è¿›è¡Œäº†é˜…è¯»ï¼ŒåŒ…æ‹¬é‚£äº›ææ¡ˆä¸‹æ‰€æœ‰çš„è¯„è®ºä¹Ÿéƒ½çœ‹äº†ã€‚</p>
<p>è¿™ä¸¤ç¯‡æ–‡ç« è·¨è¶Šäº†æ•´æ•´ä¸€å¹´æ—¶é—´ï¼Œè¿™ä¸€å¹´æœŸé—´æˆ‘åŸºæœ¬æ²¡æœ‰å†™å…¶ä»–çš„æ–‡ç« ï¼Œä½†æ˜¯å´æ²‰æ·€äº†å¾ˆå¤šï¼Œæ‰€ä»¥ç¬¬äºŒç¯‡å®é™…ä¸Šå¯å†™çš„å†…å®¹éå¸¸å¤šï¼Œä¸€å£æ°”æŒ‘ç€é‡ç‚¹çš„è¯´äº†ä¸€å¤§ç¯‡åï¼Œè¿˜åˆ å‡äº†å¤§é‡å†…å®¹ã€‚å†™å®Œç¬¬äºŒç¯‡æˆ‘æ„Ÿè§‰åˆ°åŒ–ç¹ä¸ºç®€çš„å·¨å¤§å¥½å¤„ã€‚è‡ªå·±åšçš„è®°å½•ã€ç´ æå’Œèµ„æ–™å¾€å¾€éƒ½æ˜¯å¤§é‡çš„ï¼Œæ·±ç©¶ä¸‹å»éƒ½æ˜¯æ— ç©·æ— å°½çš„æ„Ÿè§‰ã€‚å› æ­¤éœ€è¦ä»ä¸­æç‚¼å‡ºè‡ªå·±çš„è§‚ç‚¹ã€‚ä»é‚£ä¹ˆå¤šå†…å®¹ä¸­æç‚¼å‡ºè§‚ç‚¹æ˜¯éœ€è¦è¶³å¤Ÿçš„ä¼‘æ¯å’Œæ”¾æ¾ï¼Œè®©ä½ çš„æ½œæ„è¯†ä¸»åŠ¨æ¥å¸®åŠ©ä½ ã€‚è¿™äº›ä¼‘æ¯å’Œæ”¾æ¾ä¹Ÿå¯ä»¥æ˜¯åœ¨æ—¥å¸¸çš„è¡Œä¸ºä¸­ï¼Œæ¯”å¦‚æ´—æ¾¡ã€å»è¶…å¸‚ä¹°ä¸œè¥¿ã€éª‘è‡ªè¡Œè½¦ã€èµ°è·¯ã€é”»ç‚¼ã€åƒé¥­å’Œç¡è§‰ç­‰ï¼Œç‰¹åˆ«æ˜¯èµ°è·¯å’Œç¡è§‰æŒç»­æ—¶é—´é•¿ï¼Œæœ€å®¹æ˜“è¿›å…¥æ·±åº¦æ€è€ƒã€‚ä¸æ–­ç»™è‡ªå·±æé—®é¢˜è¿›è€Œæ›´å¤§é‡çš„é˜…è¯»æ‰¾ç­”æ¡ˆï¼Œæ€è€ƒå†…åœ¨é€»è¾‘å’Œè”ç³»ã€‚å‘æ•£çš„æ‰¾ï¼Œä¸“æ³¨çš„æ”¶æ•›æå–è§‚ç‚¹ï¼Œè¿™æ ·çš„è§‚ç‚¹æ˜¯ç”¨é’±ä¹°ä¸åˆ°çš„ã€‚</p>
<p>é€šè¿‡å¤§ç™½è¯è®²æ¸…æ¥šï¼Œåˆ†äº«å‡ºå»ï¼Œè¿™æ ·çš„è§‚ç‚¹åœ¨ä»–äººæ¥æ”¶æ—¶æ˜¯è‡ªç„¶åœ°ï¼Œæ„è¯†ä¸åˆ°å…¶èƒŒåæ‰€èŠ±çš„æ—¶é—´å’ŒåŠŸå¤«ï¼Œè¿™å°±è·Ÿä¼˜ç§€çš„ App ä¸€æ ·ï¼Œç”¨èµ·æ¥æ˜¯é‚£ä¹ˆç®€å•æœ‰æ•ˆï¼Œä¸æ¯«ä¸æ‹–æ³¥å¸¦æ°´ï¼Œç”¨æˆ·ä¹Ÿæ„è¯†ä¸åˆ°å¼€å‘ App æ‰€ä»˜å‡ºçš„è„‘åŠ¨ã€‚è¿™ç§åŒ–ç¹ä¸ºç®€çš„è¿‡ç¨‹ä¹Ÿæ˜¯å°†æ— åºæ‚ä¹±çš„ä¸œè¥¿æ¸…ç†æ‰ï¼Œè®©ä½ å®è´µç²¾ç‚¼çš„æ€æƒ³èƒ½å¤Ÿæœ‰åœ°æ–¹å­˜æ”¾ã€‚</p>
<p>çŒç¯®é«˜æ‰‹ä¸­æµå·æ«æ‰“ç¯®çƒè¡Œäº‘æµæ°´ï¼Œå¤©èµ‹å¼‚ç¦€ã€‚èƒŒåçš„åŠªåŠ›è°åˆèƒ½çŸ¥æ™“ã€‚æˆ‘å°è±¡æœ€æ·±çš„ä¸€æ®µæ˜¯æ¨±æœ¨èŠ±é“ä¸ºäº†å–å¾—æ™´å­èŠ³å¿ƒï¼Œä½†å§‹ç»ˆæŠ€ä¸å¦‚æµå·æ«ï¼Œæ€»ä»¥ä¸ºæ˜¯å¤©èµ‹ä¸å¤Ÿã€‚ä¸€å¤©æ™šä¸Šæ¨±æœ¨èŠ±é“å¾ˆæ™šæ¥åˆ°ç¯®çƒé¦†ï¼Œå‘ç°æµå·æ«è¿˜åœ¨è‹¦ç»ƒï¼Œæ‰å‘ç°åŸæ¥ç™½å¤©çœ‹èµ·æ¥æ‡’æ•£å‚²æ…¢çš„æµå·æ«åŸæ¥æ¯”è°éƒ½è¦åˆ»è‹¦ï¼Œç®€å•è½»æ¾ä»æ¥éƒ½ä¸æ˜¯å»‰ä»·çš„ã€‚</p>
<p>å¯¹äºåˆ†äº«ï¼Œæœ‰æ™ºæ…§çš„äººéƒ½æ‡‚å¾—ç»™äºˆè¶Šå¤šæ”¶è·è¶Šå¤§ã€‚å‹æƒ…æ¯”é‡‘é’±ä»·å€¼æ›´é«˜ï¼Œå°±å¥½åƒæœ‰ä¸€ä¸ªå¼€ç”µå½±å…¬å¸çš„æœ‹å‹æ¯”æ‹¥æœ‰ä¸€å®¶ç”µå½±å…¬å¸è¦å¥½ã€‚åˆ†äº«ä¸æ˜¯è¦å¾—åˆ°ä»–äººçš„è®¤å¯ï¼Œå¦‚æœä½ çŸ¥é“è¿™ç‚¹ï¼Œä½ æ‹¥æœ‰çš„èƒ½é‡å°±æ˜¯æ— ç©·çš„ï¼ŒåŠ›é‡ä¹Ÿæ˜¯æ— æ•Œçš„ã€‚</p>
<h2 id="æ²¡æ€ä¹ˆå†™è¿‡ï¼Œé‚£ä¸‹ä¸€æ­¥æ€ä¹ˆè¡ŒåŠ¨"><a href="#æ²¡æ€ä¹ˆå†™è¿‡ï¼Œé‚£ä¸‹ä¸€æ­¥æ€ä¹ˆè¡ŒåŠ¨" class="headerlink" title="æ²¡æ€ä¹ˆå†™è¿‡ï¼Œé‚£ä¸‹ä¸€æ­¥æ€ä¹ˆè¡ŒåŠ¨"></a>æ²¡æ€ä¹ˆå†™è¿‡ï¼Œé‚£ä¸‹ä¸€æ­¥æ€ä¹ˆè¡ŒåŠ¨</h2><p>çœ‹åˆ°è¿™é‡Œï¼Œä½ ä¸€å®šä¼šæƒ³â€œçœ‹ä½ è¯´äº†é‚£ä¹ˆå¤šï¼Œä½†æˆ‘åŒæ‰‹æ”¾åœ¨é”®ç›˜å‰ï¼Œè„‘è¢‹è¿˜æ˜¯ä¸€ç‰‡ç©ºç™½ï¼Œæ— ä»ä¸‹æ‰‹â€ã€‚</p>
<p>å¦‚æœæƒ³å¸®å…¶ä»–äººï¼Œè®©ä»–çœŸçš„åŠ¨æ‰‹å»åšäº›ä»€ä¹ˆäº‹æƒ…ï¼Œå…¶å®æ›´åº”è¯¥æ˜¯è¦è®©åšè¿™ä»¶äº‹æƒ…å˜å¾—å®¹æ˜“å¾ˆå¤šå€ï¼Œä½†æ–¹å‘æ˜¯ä¸€æ ·çš„ï¼Œè¿™æ ·ä¸‹æ¬¡ä»–å°±æ›´å¥½æ¥å—äº›ã€‚äº’è”ç½‘å¼€å§‹å‘å¸ƒå†…å®¹é—¨æ§›é«˜ï¼Œåæ¥æœ‰äº†å¾®åšå’Œæœ‹å‹åœˆè¿™ç§èƒ½å¤Ÿä¸€å¥è¯å°±å¿«é€Ÿå‘å¸ƒå‡ºå»çš„äº§å“åï¼Œå¤§å®¶å‘å†…å®¹å°±æ¯”ä»¥å‰æ›´å¤šäº†ã€‚å»è¯»èµ„æ–™å’Œæ–‡ç« ï¼Œå¯ä»¥æ‡‚æ›´å¤šçš„çŸ¥è¯†ï¼Œè‡ªèº«èƒ½åŠ›è¿˜æ˜¯éœ€è¦é€šè¿‡ç»ƒä¹ æ‰èƒ½å¤Ÿæœ‰æå‡ã€‚æƒ³æŠŠäº‹æƒ…åšå¥½ï¼Œè¿˜æ˜¯éœ€è¦å»åšã€‚</p>
<p>å› æ­¤ä½ åº”è¯¥æ›´é‡è§†åŠ¨æ‰‹å†™ï¼Œå¦‚æœä½ ä¸çŸ¥é“å¦‚ä½•å†™ï¼Œå¯èƒ½å°±ä¸çŸ¥é“å¦‚ä½•æ€è€ƒã€‚æœ‰å›é€†å’Œé€†å‘æ€ç»´çš„äººå¸¸å¸¸æ˜¯çˆ±é—®é—®é¢˜çš„äººï¼Œçˆ±è‡ªé—®çˆ±æ€è€ƒï¼Œå¯¹é‚£äº›å·²ç»å…±è¯†æ­£åœ¨è¿ä½œçš„äº‹ç‰©æå‡ºç–‘é—®ï¼Œå¯»æ‰¾å’Œå…³æ³¨ç­”æ¡ˆï¼Œè¿™æ ·æ‰ä¼šæœ‰æ‰“ç ´ç°çŠ¶çš„æ„è¯†ã€‚ä¸€äº›äººå°æ—¶å€™å°±èƒ½çœ‹åˆ°æœ‰è¿™æ ·çš„ç‰¹ç‚¹ï¼Œå› æ­¤åœ¨åˆ«äººæ•™ä½ æ€æ ·æ€æ ·åšæ—¶ï¼Œä¸è¦å¤ªå½“å›äº‹ï¼Œç›¸ä¿¡è‡ªå·±å®è·µå‡ºæ¥çš„ç­”æ¡ˆã€‚å¤šå¬ä½ å–œæ¬¢äººè¯´è¯ï¼Œå¤šå€¾å¬ï¼Œä¸æ–­é—®è¿˜æœ‰æ²¡æƒ³è¯´çš„ã€‚</p>
<p>è¿˜è¦ä»å„ç§ç±»å‹äººé‚£å­¦ä¹ ï¼Œç”šè‡³æ˜¯å’Œä½ è§‚ç‚¹ä¸åŒçš„äººã€‚å› ä¸ºåœ¨æ¯ä¸ªäººåšæŒçš„æ€æƒ³é‡Œï¼Œéƒ½ä¼šæœ‰ä»–è‡ªå·±ç‹¬ç‰¹çš„ç»å†å’Œå®è·µæ€»ç»“æ¥çš„ç»“è®ºã€‚é€šè¿‡ä»–ä»¬çš„ç»“è®ºï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå·±å»å®è·µå’ŒéªŒè¯å½¢æˆè‡ªå·±çš„è§‚ç‚¹ï¼Œè¿™æ ·å°±ä¼šæœ‰å¤åˆ©æ•ˆåº”ã€‚åšçš„ç»“æœå…¶å®å¹¶ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯åœ¨åšçš„è¿‡ç¨‹ä¸­ï¼Œä½ è‡ªå·±æœ‰æ²¡æœ‰å˜å¾—æ›´å¥½ã€‚</p>
<p>ä½ è¯´çš„è¯ï¼Œä½ çš„è§‚ç‚¹ï¼Œä½ çš„è¯„è®ºéƒ½ä¸èƒ½ä»£è¡¨ä½ ï¼Œè€Œæ˜¯ä½ æ‰€åšçš„äº‹æƒ…ï¼ŒèŠ±äº†å¾ˆå¤šæ—¶é—´åšçš„äº‹æƒ…é‚£æ‰æ˜¯ä½ ã€‚æ”¹å˜ä¸€ä¸ªäººçš„è¡Œä¸ºæ¥æ”¹å˜æ€ç»´ï¼Œæ¯”æ”¹å˜ä¸€ä¸ªäººçš„æ€ç»´æ¥æ”¹å˜è¡Œä¸ºè¦å®¹æ˜“çš„å¤šå¾ˆå¤šã€‚</p>
<p>å› æ­¤ï¼Œå…‰çœ‹å…‰å¬ä¸åŠ¨æ‰‹å†™æ˜¯æ²¡ç”¨çš„ã€‚é‚£è¡ŒåŠ¨èµ·æ¥çš„è¯ï¼Œæ€ä¹ˆåšæ›´å¥½äº›å‘¢ï¼Ÿ</p>
<h3 id="å››ä¸ªæ­¥éª¤"><a href="#å››ä¸ªæ­¥éª¤" class="headerlink" title="å››ä¸ªæ­¥éª¤"></a>å››ä¸ªæ­¥éª¤</h3><p>ç¬¬ä¸€æ­¥ï¼Œé›¶æ•£çš„æƒ³æ³•ã€å·¥ä½œå†…å®¹å’Œçœ‹åˆ°çš„å¥½çš„æŠ€æœ¯èµ„æ–™åŠæ—¶è®°å½•ï¼Œå…ˆæŒ‰ç…§æ—¶é—´è½´çš„æ–¹å¼è®°å½•ã€‚è¿™ä¸€æ­¥æ˜¯å¾ˆå®¹æ˜“æ“ä½œçš„ï¼Œå‡ ä¹ä¸ç”¨è´¹è„‘ï¼Œåªéœ€è¦æœºæ¢°çš„åšè®°å½•å°±è¡Œï¼Œä¹Ÿä¸ç”¨è€ƒè™‘å…ˆå‰æåˆ°å››ä¸ªç‚¹é‡Œä»»ä½•ä¸€ä¸ªã€‚</p>
<p>ç¬¬äºŒæ­¥ï¼Œå¯¹äºè®°å½•çš„å†…å®¹è¿›è¡Œåˆ†ç±»ï¼Œå¼€å§‹ç²’åº¦å¯ä»¥ç²—ä¸€ç‚¹ï¼Œæ¯”å¦‚æ€§èƒ½ã€æ¶æ„ã€æ„å»ºã€ç¼–ç¨‹è¯­è¨€ã€ç®¡ç†ã€æˆé•¿ã€æ—…è¡Œå’Œç§‘æŠ€ç­‰ï¼Œæ ¹æ®è‡ªèº«å…´è¶£ç‚¹å’ŒæœŸæœ›å‘å±•æ–¹å‘æ¥å°±å¥½ã€‚</p>
<p>ç¬¬ä¸‰æ­¥ï¼Œåšå®Œä¸€ä¸ªé¡¹ç›®ï¼Œæˆ–è€…æƒ³å¯¹å…ˆå‰åšçš„äº‹æƒ…è¿›è¡Œæ€»ç»“æ—¶ï¼Œå…ˆä¸€å£æ°”å¿«é€Ÿå†™å‡ºæƒ³è¡¨è¾¾çš„å†…å®¹å‡ºæ¥ï¼Œè¿™æ—¶å†™çš„å†…å®¹ä½“ç°å‡ºç‹¬ç‰¹æ€§ï¼Œæ­å¥½éª¨æ¶ã€‚ç„¶åé’ˆå¯¹å†™çš„å†…å®¹ä¸­çš„ä¸€äº›æŠ€æœ¯ç‚¹ï¼Œè¿›è¡ŒçœŸå®æ„Ÿçš„å®Œå–„ã€‚çœŸå®æ„Ÿçš„å®Œå–„æ˜¯éœ€è¦å¾ˆå¤šç´ æå’Œèµ„æ–™çš„ï¼Œè¿™æ—¶åœ¨ç¬¬ä¸€æ­¥å’Œç¬¬äºŒæ­¥åšçš„å·¥ä½œå’Œç§¯ç´¯å°±èƒ½å¤Ÿæ´¾ä¸Šç”¨åœºäº†ã€‚æ‰¾åˆ°ç›¸å…³å¤§åˆ†ç±»è¿›è¡Œç»†åˆ†æ¥è¡¥å……æ–‡ç« çš„è¡€è‚‰ã€‚</p>
<p>ç¬¬å››æ­¥ï¼Œä¹Ÿæ˜¯æœ€åä¸€æ­¥ï¼Œå¯ä»¥å……åˆ†å‘æŒ¥è‡ªå·±è½¯å®åŠ›å’Œåˆ›é€ åŠ›ï¼Œé€šè¿‡æ•…äº‹æ€§å’Œæ–°æ„æ¥æŠ«ä¸Šæ–‡ç« çš„çš®è‚¤ï¼Œè®©æ–‡ç« èƒ½å¤Ÿçœ‹èµ·æ¥æ›´åŠ å®Œæ•´å’Œå¸å¼•äººï¼Œæé«˜é˜…è¯»çš„ä½“éªŒã€‚</p>
<p>å®Œæ•´å®Œæˆè¿™å››ä¸ªæ­¥éª¤å¹¶ä¸å®¹æ˜“ï¼Œç»å¸¸å°±ä¼šå› ä¸ºæƒ°æ€§åŠé€”è€ŒåºŸã€‚è¿™æ—¶å°±éœ€è¦ push è‡ªå·±ä¸€æŠŠï¼Œæ–¹æ³•çš„è¯ï¼Œæˆ‘è¿™è¾¹çš„ç»éªŒå°±æ˜¯å®šç›®æ ‡ï¼Œå®šæ—¶é—´èŠ‚ç‚¹ã€‚æ¯”å¦‚å®šå¥½ä¸€ä¸ªå¯¹å¤–åˆ†äº«çš„æ—¶é—´ï¼Œè¿™æ ·ç›®æ ‡æ€§æ›´å¼ºï¼ŒåŒæ—¶ä¹Ÿæœ‰äº†çº¦æŸå’Œè´£ä»»ï¼Œè‡ªå·±çš„æƒ°æ€§åœ¨è¿™ä¸€æ®µæ—¶é—´å†…å°±èƒ½å¤Ÿå¾—åˆ°å¾ˆå¥½çš„æ¶ˆå‡ã€‚</p>
<p>ä¸ºäº†è¾¾æˆç›®çš„ï¼Œå½»åº•ç†æ¸…ä½ æƒ³è¦å•¥ï¼Œè¿˜éœ€è¦æ¸…ç©ºå¹²æ‰°ï¼Œæ–¹æ³•å¾ˆç®€å•ï¼Œé™¤äº†å½“å‰æœ€é‡è¦çš„äº‹æƒ…ï¼Œå…¶å®ƒæ‰€æœ‰å¾…åšäº‹æƒ…éƒ½è®°åœ¨å¤‡å¿˜å½•é‡Œä»¥ä¾¿è¿½è¸ªé˜²æ­¢é—æ¼ã€‚å®Œæˆå½“å‰äº‹æƒ…åï¼Œå†å»æŸ¥çœ‹å¤‡å¿˜å½•ï¼Œç„¶åå®šæ–°ç›®æ ‡æ–°è®¡åˆ’ã€‚</p>
<p>å®Œæˆæ–‡ç« åå¯ä»¥é€šè¿‡ä¸‹é¢å…«ä¸ªé—®é¢˜æ¥æ£€æŸ¥ä¸‹æ–‡ç« çš„å®Œæˆåº¦ã€‚</p>
<ol>
<li>æˆ‘ä¸ºä»€ä¹ˆåšè¿™ä»¶äº‹ï¼Ÿ</li>
<li>è°å·²ç»åšäº†ï¼Ÿä»–ä»¬éƒ½æ˜¯æ€ä¹ˆåšçš„ï¼Ÿæ•ˆæœæ€æ ·ï¼Ÿ</li>
<li>æˆ‘å’Œä»–ä»¬åšçš„ä¸ä¸€æ ·åœ¨å“ªï¼Ÿæ€ä¹ˆæƒ³åˆ°çš„ï¼Ÿèƒ½è¯¦ç»†å…·ä½“è¯´å‡ºæ¶‰åŠç›¸å…³çŸ¥è¯†ç‚¹å—ï¼Ÿï¼ˆâ­ï¸é‡ç‚¹ï¼Œå†™å¥½äº†çš„è¯ï¼Œå…¶ä»–é—®é¢˜å¯æœ‰å¯æ— ï¼‰</li>
<li>æˆ‘ç¢°åˆ°äº†ä»€ä¹ˆå›°éš¾ï¼Ÿ</li>
<li>æˆ‘æ€ä¹ˆè§£å†³çš„ï¼Ÿ</li>
<li>åšçš„æœ‰äº®ç‚¹å—ï¼Ÿä¸ºä»€ä¹ˆæ˜¯äº®ç‚¹ï¼Ÿ</li>
<li>åšå®Œåæ•ˆæœæ˜¯æ€æ ·çš„ï¼Ÿè¶…é¢„æœŸåœ°æ–¹åœ¨å“ªï¼Ÿ</li>
<li>ä»¥åè¿˜æœ‰è®¡åˆ’æ‰“ç®—å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</li>
</ol>
<h3 id="æ‰€ç”¨è½¯ä»¶"><a href="#æ‰€ç”¨è½¯ä»¶" class="headerlink" title="æ‰€ç”¨è½¯ä»¶"></a>æ‰€ç”¨è½¯ä»¶</h3><p>ä¸‹é¢æ˜¯æˆ‘å†™æ–‡ç« ä¼šç”¨åˆ°çš„ä¸€äº›è½¯ä»¶ï¼Œä»¥åŠæˆ‘å…³æ³¨å’Œç”¨åˆ°çš„ä¸€äº›ç‰¹æ€§ï¼š</p>
<p>ç³»ç»Ÿè‡ªå¸¦å¤‡å¿˜å½•</p>
<ul>
<li>é›¶æ•£æƒ³æ³•å’Œçµæ„Ÿè®°å½•</li>
<li>å¾…åšäº‹é¡¹è®°å½•ï¼ˆä¸€ä¸ªä¸€ä¸ªç›´æ¥åˆ æ‰çš„æ„Ÿè§‰ä¸é”™ï¼‰</li>
<li>èšç„¦æƒ³æ³•æ€è·¯ï¼Œä¸ç”¨å»è€ƒè™‘åˆ†ç±»æ•´ç†ç­‰</li>
</ul>
<p><a href="https://bear.app/cn/">ç†ŠæŒè®°</a></p>
<ul>
<li>æœ¬åœ°æ–‡æ¡£ç®¡ç†ï¼ˆå¤šè®¾å¤‡åŒæ­¥æ”¶è´¹ï¼‰</li>
<li>æ ‡ç­¾ç³»ç»Ÿç®€åŒ–åˆ†ç±»</li>
</ul>
<p><a href="https://www.notion.so/">Notion</a></p>
<ul>
<li>åœ¨çº¿æ–‡æ¡£ç®¡ç†</li>
<li>æ•°æ®åº“æ–¹å¼ç®¡ç†ï¼Œåˆ†ç±»ã€æ£€ç´¢å’Œæ’åº</li>
<li>å­—æ®µè‡ªå®šä¹‰æ·»åŠ ï¼Œæ¯”å¦‚æ ‡ç­¾ã€ç±»åˆ«ã€é“¾æ¥ã€æ ‡é¢˜ç­‰ç­‰éƒ½å¯ä»¥è‡ªå®šä¹‰</li>
<li>åŸºäºæ•°æ®åº“å’Œè‡ªå®šä¹‰å­—æ®µå¯ç”Ÿæˆçœ‹æ¿ã€æ—¶é—´è½´ã€æ—¥å†ã€åˆ—è¡¨ã€è¡¨æ ¼ã€ç½‘æ ¼ç­‰ä¸åŒè§†å›¾æ ·å¼æŸ¥çœ‹ã€‚</li>
<li>æœ‰chromeæ’ä»¶</li>
</ul>
<p><a href="https://code.visualstudio.com/">VS Code</a></p>
<ul>
<li>æœ¬åœ°æ–‡æ¡£ç®¡ç†ï¼ˆæ–‡ä»¶å¤¹ï¼ŒGitæ”¯æŒå¯å¤šç«¯åŒæ­¥ï¼‰</li>
<li>Markdown æ’ä»¶æ”¯æŒï¼ˆMarkdown All in Oneã€Pangu-Markdownã€Markdown Preview Enhancedã€Word Count CJKï¼‰</li>
</ul>
<p><a href="https://obsidian.md/">Obsidian</a></p>
<ul>
<li>æœ¬åœ°æ–‡æ¡£ç®¡ç†ï¼ˆæ–‡ä»¶å¤¹ï¼‰</li>
<li>MarkdownåŸç”Ÿæ”¯æŒ</li>
<li>æ’ä»¶ç³»ç»Ÿï¼Œæ¯”å¦‚æœ‰å¤§çº²å’Œçœ‹æ¿ç­‰æ’ä»¶å¯ç”¨</li>
<li>åŒå‘é“¾æ¥ä¸å…³ç³»å›¾è°±</li>
</ul>
<p><a href="https://procreate.art/cn">Procreate</a></p>
<ul>
<li>å¯ä»¥æŠŠåœ¨çº¸ä¸Šçš„è‰å›¾é…ä¸Šé¢œè‰²</li>
</ul>
<p>è½¯ä»¶ä½¿ç”¨ä¸Šï¼Œæˆ‘ä¼šé€šè¿‡å¤‡å¿˜å½•æˆ–ç†ŠæŒè®°å¿«é€Ÿè®°å½•ä¸€äº›ç´ æå’Œæƒ³æ³•ï¼Œå®šæœŸæŒªåˆ° Notion é‡Œï¼Œæˆ‘æ˜¯æŠŠ Notion å½“åšä¸€ä¸ªå¤§ä»“åº“ï¼Œå†™ä½œçš„ç¬¬äºŒé˜¶æ®µæ•´ç†åˆ†ç±»æˆ‘å°±æ˜¯åœ¨ Notion ä¸­å®Œæˆçš„ï¼Œå……åˆ†åˆ©ç”¨ Notion çš„è‡ªå®šä¹‰å­—æ®µèƒ½åŠ›ï¼Œå¯¹æ‰€æœ‰èµ„æ–™è¿›è¡Œå„ç§ç»´åº¦åˆ’åˆ†å’Œå½’æ¡£ã€‚å¼€å§‹å†™æ–‡ç« æ—¶ï¼ŒåˆæœŸä¼šç”¨ VS Code æ¥å†™ï¼Œå¦‚æœæ–‡ç« å†™é•¿äº†å°±ä¼šæ‰“å¼€ Obsidian æ¥ç»§ç»­å†™ï¼Œä¸»è¦æ˜¯ Obsidian çš„å¤§çº²æ•ˆæœæ¯”è¾ƒå¥½äº›ã€‚æœ€åæ–‡ç« çš„é…å›¾æˆ‘ä¼šä½¿ç”¨ Procreate æ¥ç”»ï¼Œé‡Œé¢æœ‰è¾…åŠ©çº¿ï¼Œæ‰“å¼€åå¯ä»¥å¾ˆæ–¹ä¾¿åšå‚ç…§ï¼Œå†™å›¾ä¸­æ–‡å­—å°±ä¸å®¹æ˜“åäº†ã€‚</p>
<p>å·¥å…·åªæ˜¯å·¥å…·ï¼Œè®°å½•çš„å†…å®¹å’Œè‡ªå·±çš„æ€æƒ³æ‰æ˜¯æ ¸å¿ƒã€‚æˆ‘ç°åœ¨è¯»ä¹¦è¿˜æ˜¯å–œæ¬¢åœ¨çº¸ä¸Šå†™ç¬”è®°ï¼Œç‰¹åˆ«æœ‰æ„Ÿè§¦çš„æ‰ä¼šæç‚¼ä¸€äº›è§‚ç‚¹æ•²åˆ°å¤‡å¿˜å½•ä¸­ï¼Œæ¯”å¦‚æˆ‘çœ‹äº†ç½‘é£ï¼ˆNexflixï¼‰çš„<a href="https://book.douban.com/subject/35102294/">ã€Šä¸æ‹˜ä¸€æ ¼ã€‹</a>åæç‚¼äº†ä¸€äº›è§‚ç‚¹åšäº†è®°å½•ï¼Œç¬”è®°å¦‚ä¸‹ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">åˆ¶åº¦éƒ½æ˜¯å›´ç»•ç€æ€ä¹ˆä¸é˜»ç¢æ‰€è¦çš„äººå‘æŒ¥ã€‚æ¯”å¦‚å‡æœŸè‡ªç”±å®‰æ’ã€æ— å®¡æ‰¹ã€å†³ç­–æƒéè‡ªä¸Šè€Œä¸‹ï¼Œè€Œæ˜¯åœ¨è®¤è¯†ä¸€è‡´æƒ…å†µä¸‹æ¾æ•£è€¦åˆã€‚</span><br><span class="line"></span><br><span class="line">è¦å’Œä¸è¦ä»€ä¹ˆæ ·çš„äººå‘¢ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ä¸è¦çš„äººï¼š</span><br><span class="line"></span><br><span class="line">ä¸äººç›¸å¤„å¥½ï¼Œä½†èƒ½åŠ›å¹³å¹³</span><br><span class="line">å·¥ä½œç‹‚ï¼Œç¼ºå°‘åˆ¤æ–­åŠ›</span><br><span class="line">å¤©èµ„å¥½ï¼Œè¡ŒåŠ¨åŠ›å¼ºï¼Œä½†æ‚²è§‚ã€ç‰¢éªš</span><br><span class="line">æœ‰æ‰åçš„æ··è›‹ï¼š</span><br><span class="line">ç‰¹å¾</span><br><span class="line">å¬åˆ°èµç¾å°±è‡ªè§‰ä¼˜ç§€</span><br><span class="line">å¯¹æƒ³æ³•ä¸æ˜æ™ºçš„äººï¼Œä¼šè¿›è¡Œå˜²ç¬‘</span><br><span class="line">ä¼šä¾®è¾±å¤©èµ‹ä¸å¦‚è‡ªå·±çš„äºº</span><br><span class="line">è¡¨ç°</span><br><span class="line">å–œæ¬¢ä¼šä¸Šæ…·æ…¨é™ˆè¯ï¼Œé‡å¤è¡¨è¾¾è‡ªå·±è§‚ç‚¹</span><br><span class="line">å¦‚æ²¡æŠ“ä½ä»–çš„è¦ç‚¹ï¼Œä¼šæ‰“æ–­åˆ«äººçš„è¯</span><br><span class="line">åˆ«äººå‘è¨€ï¼Œä¸èµåŒæ—¶ä¼šä¸å¬ï¼Œåšè‡ªå·±çš„äº‹æƒ…</span><br><span class="line">åˆ«äººå•°å—¦ï¼Œæ²¡æŠ“ä½è¦ç‚¹ï¼Œç«‹åˆ»æ‰“æ–­</span><br><span class="line">æ€»æƒ³ç€æ€ä¹ˆåšæ‰èƒ½è¡¨ç°å¥½ï¼Œå¾—å¥–é‡‘ï¼Œç¼ºå°‘å¼€æ”¾çš„è®¤çŸ¥ç©ºé—´</span><br><span class="line"></span><br><span class="line">ä¸ºä»€ä¹ˆï¼šç®¡ç†èŠ±è´¹ç²¾åŠ›å¤šï¼Œè®¨è®ºè´¨é‡ä½ï¼Œä¼šæ’æŒ¤å“è¶Šå‘˜å·¥ã€‚</span><br><span class="line"></span><br><span class="line">è¦çš„äººï¼š</span><br><span class="line"></span><br><span class="line">éå‡¡åˆ›é€ åŠ›ã€å·¥ä½œå‡ºè‰²ï¼ˆå®Œæˆç¹é‡ä»»åŠ¡ï¼‰ã€åˆä½œå¥½</span><br><span class="line">åœ¨æ”¾æ¾çŠ¶æ€ä¸‹ï¼Œä¼šçµå…‰ä¹ç°</span><br><span class="line">å…¬å¸åˆ©ç›Šè‡³ä¸Š</span><br><span class="line">è‡ªè§‰è¿½æ±‚æˆåŠŸï¼Œæ— è®ºæ˜¯å¦æœ‰å¥–é‡‘ï¼ˆå·²ç»™äºˆèƒ½åŠ›åŒ¹é…å¸‚åœºæœ€é«˜ä»·ï¼‰</span><br><span class="line">å½“æŸä¸€å›ºå®šæ€ç»´é‡åˆ°ç“¶é¢ˆæ—¶ï¼Œä»–æ€»æœ‰åŠæ³•æ‘†è„±ç“¶é¢ˆï¼Œæˆ–å°è¯•ä¸åŒè§’åº¦çœ‹å¾…é—®é¢˜</span><br><span class="line">åœ¨æœ‰æ‰èƒ½ï¼Œå—çˆ±æˆ´çš„å‰æä¸‹ï¼Œè‡ªå·±çŠ¯é”™å¤§å£°è¯´ï¼ŒæˆåŠŸå°å£°è¯´ï¼Œè®©äººæ„Ÿè§‰äº²è¿‘ã€çœŸè¯šå’Œä½“è´´ã€‚</span><br><span class="line">æœ‰è‰¯å¥½çš„åˆ¤æ–­åŠ›</span><br><span class="line"></span><br><span class="line">ä¸ºä»€ä¹ˆï¼šä¼˜ç§€çš„äººæ¿€åŠ±å…¶ä»–ä¼˜ç§€çš„äººï¼Œå‡ºè‰²æˆæœæ„ŸæŸ“æ›´å¤šäººæ‰ã€‚</span><br><span class="line"></span><br><span class="line">åªæœ‰å…¬å¸é‡Œçš„å‘˜å·¥éƒ½æ˜¯ä¸Šé¢æåˆ°çš„è¦çš„äººæ—¶ï¼Œå…¬å¸çš„å¯†åº¦æ‰é«˜ã€‚è¿™æ ·çš„å…¬å¸ä¸æ˜¯å®¶åº­è€Œæ˜¯ä¸“ä¸šè¿åŠ¨é˜Ÿï¼Œè¿åŠ¨é˜Ÿè¿½æ±‚å“è¶Šï¼Œæ¯ä¸ªä½ç½®éƒ½æ˜¯æœ€ä½³äººé€‰ï¼›è®­ç»ƒå°±æ˜¯ä¸ºäº†èƒœåˆ©ï¼Œå¤§å®¶éƒ½èƒ½ç»™äºˆå’Œæ¥å—åé¦ˆï¼›æˆç»©è¦å¥½ï¼Œä¸èƒ½åªç”¨åŠªåŠ›å°±å¤Ÿäº†ã€‚</span><br><span class="line"></span><br><span class="line">ä¹¦ä¸­è¯¦ç»†ä»‹ç»äº†ç½‘é£çš„åˆ¶åº¦ç”±æ¥ï¼Œå¤§é‡å‘˜å·¥çš„å®é™…æ¡ˆä¾‹ï¼Œç¢°åˆ°äº†é—®é¢˜å¦‚ä½•å®Œå–„äº†åˆ¶åº¦ã€‚éå¸¸å…¨é¢è¿›è¡Œäº†åˆ¶åº¦ä»‹ç»ï¼Œç”šè‡³åŒ…å«äº†è¿›è¡Œåˆ›æ–°çš„å‡ ä¸ªæ­¥éª¤çš„è¯¦ç»†è¯´æ˜ï¼Œè¿˜æœ‰ç½‘é£åˆ›å§‹äººé‡Œå¾·æ˜¯å¦‚ä½•åšåˆ°è®©å¤§å®¶è®¤è¯†ä¸€è‡´çš„ã€‚</span><br><span class="line"></span><br><span class="line">æœ€åæ˜¯ä¹¦ä¸­å¼•ç”¨çš„å°ç‹å­é‚£æ®µï¼š</span><br><span class="line">å¦‚æœä½ æƒ³é€ è‰˜èˆ¹ï¼Œ</span><br><span class="line">ä¸è¦è€å‚¬äººå»é‡‡æœ¨ï¼Œ</span><br><span class="line">å¿™ç€åˆ†é…å·¥ä½œ</span><br><span class="line">å’Œå‘å·æ–½ä»¤ã€‚</span><br><span class="line">è€Œæ˜¯è¦æ¿€èµ·ä»–ä»¬</span><br><span class="line">å¯¹æµ©ç€šæ— å çš„</span><br><span class="line">å¤§æµ·çš„å‘å¾€ã€‚</span><br></pre></td></tr></table></figure></p>
<h2 id="ä¸¾ä¸ªä¾‹å­ï¼Œæ€ä¹ˆå†™è¿™æ¬¡WWDC21çš„è§é—»æ–‡ç« "><a href="#ä¸¾ä¸ªä¾‹å­ï¼Œæ€ä¹ˆå†™è¿™æ¬¡WWDC21çš„è§é—»æ–‡ç« " class="headerlink" title="ä¸¾ä¸ªä¾‹å­ï¼Œæ€ä¹ˆå†™è¿™æ¬¡WWDC21çš„è§é—»æ–‡ç« "></a>ä¸¾ä¸ªä¾‹å­ï¼Œæ€ä¹ˆå†™è¿™æ¬¡WWDC21çš„è§é—»æ–‡ç« </h2><p>å…‰è¯´ä¸ç»ƒï¼Œè¿™æ ·ä¸å¥½å§ï¼Œé‚£å°±ç°ä¸¾ä¸ªä¾‹å­ï¼Œçœ‹çœ‹æ€ä¹ˆæŒ‰ç…§ä¸Šé¢çš„å››ä¸ªæ­¥éª¤ä¸€æ­¥ä¸€æ­¥å†™ä¸€ç¯‡æŠ€æœ¯æ–‡ç« ã€‚é‚£å°±ä»¥ç°åœ¨åˆšå¼€å®Œçš„ WWDC21 ä¸ºä¸»é¢˜ï¼Œå†™ä¸ªã€ŠWWDC21æˆ‘çš„è§é—»ã€‹å§ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬å…ˆåšç¬¬ä¸€æ­¥ï¼Œä» WWDC21 å¼€å§‹ï¼Œæˆ‘å°±å°†æˆ‘çœ‹åˆ°çš„ä¿¡æ¯ã€è¿˜æœ‰çœ‹æ„Ÿå…´è¶£ Session ä¸­æœ‰ç”¨çš„ç‚¹éƒ½è®°å½•äº†ä¸‹æ¥ï¼Œåªè€ƒè™‘æ˜¯å¦è¦è®°ï¼ŒäºŒä¸è€ƒè™‘å…¶å®ƒä»»ä½•äº‹æƒ…ã€‚ä½ å¯ä»¥çœ‹æˆ‘<a href="https://ming1016.github.io/2021/06/08/wwdc2021-day1-note/">WWDC21ç¬¬ä¸€å¤©çš„è®°å½•</a>ï¼Œæˆ‘å°†å…¶å‘åˆ°äº†æˆ‘çš„åšå®¢å’Œå…¬ä¼—å·ä¸Šã€‚åé¢å‡ å¤©æˆ‘ä¹Ÿä¸æ–­çš„æ”¶é›†è®°å½•ç€é›¶ç¢çš„ä¿¡æ¯ã€‚ç„¶åå¯¹è¿™äº›è®°å½•è¿›è¡Œåˆ†ç±»ã€‚æ¥ä¸‹æ¥å†å¼€å§‹å†…å®¹çš„æ’°å†™ã€‚</p>
<p>å†™ WWDC21 è§é—»å½•ï¼Œä½ å¯ä»¥å…ˆæƒ³æƒ³ç€ä½ æƒ³è¦ä»€ä¹ˆå†…å®¹ï¼Œæœ‰æ²¡äººæä¾›ï¼Œæœ‰çš„è¯å¯ä»¥ç›´æ¥é“¾è¿‡æ¥ï¼Œæ²¡æœ‰çš„è¯å¯ä»¥è‡ªå·±å»ä½“ä¼šï¼Œå»æƒ³ï¼Œå»ç»å†ï¼Œç„¶ååˆ†äº«å‡ºæ¥ã€‚</p>
<p>æˆ‘ä¼šå…ˆå†™ä¸ªæ€»è§ˆï¼Œå†…å®¹å¦‚ä¸‹ã€‚</p>
<h3 id="æ€»è§ˆ"><a href="#æ€»è§ˆ" class="headerlink" title="æ€»è§ˆ"></a>æ€»è§ˆ</h3><p>WWDC21 å®˜æ–¹é€šè¿‡ä¸€ä¸ªé¡µé¢æ±‡æ€»äº†å‘å¸ƒçš„æ–°æŠ€æœ¯ï¼Œè¯¦è§<a href="https://developer.apple.com/documentation/new-technologies-wwdc21">è¿™é‡Œ</a>ã€‚WWDC21 é‡Œçš„ä»£ç èŒƒä¾‹å®˜æ–¹éƒ½æœ‰æä¾›å’Œæ±‡æ€»ï¼Œè¯¦è§<a href="https://developer.apple.com/sample-code">è¿™é‡Œ</a>ã€‚WWDC21 æœŸé—´è‹¹æœä¹Ÿ<a href="https://developer.apple.com/wwdc21/beyond-wwdc/">åˆ—å‡ºäº†</a>è‹¹æœå…¬å¸ä¹‹å¤–å›´ç»• WWDC å…¶å®ƒç»„ç»‡çš„å­¦ä¹ ã€äº¤æµå’Œå¨±ä¹çš„æ´»åŠ¨ã€‚</p>
<p>å¦‚æœæ²¡æœ‰å¤ªå¤šæ—¶é—´çœ‹ Session è§†é¢‘ï¼Œä¹Ÿå¯ä»¥ç›´æ¥çœ‹å…¶ä»–äººçš„ç¬”è®°ï¼Œå›½å¤–æœ‰<a href="https://www.wwdcnotes.com/">WWDC NOTES</a>ï¼Œå›½å†…æœ‰è€å¸æœºæŠ€æœ¯å‘¨åˆŠçš„<a href="https://xiaozhuanlan.com/wwdc21">WWDC21 å†…å‚</a>ã€‚å¾€å±Šå†…å®¹ä¹Ÿæœ‰äººåšäº†<a href="https://github.com/Juanpe/About-SwiftUI">æ±‡æ€»</a></p>
<p>ç®€å•ç¬”è®°å¯ä»¥æŸ¥ç¼ºè¡¥æ¼ï¼ŒAlejandro Martinez åœ¨è¿™ç¯‡æ–‡ç« <a href="https://alejandromp.com/blog/wwdc21-notes/">WWDC21 notes</a>ä¸­å¯¹å„ç§ä¸»é¢˜åšäº†ç®€å•çš„è®°å½•ï¼Œåˆ—å‡ºäº†å…³é”®å­—æ–¹ä¾¿æ£€ç´¢ã€‚</p>
<h3 id="Sessionæ¨è"><a href="#Sessionæ¨è" class="headerlink" title="Sessionæ¨è"></a>Sessionæ¨è</h3><p>å…¨éƒ¨ Sessionï¼Œåœ¨<a href="https://developer.apple.com/videos/wwdc2021/">è¿™é‡Œ</a>æŸ¥çœ‹ã€‚è¿™é‡Œæœ‰ä»½<a href="https://useyourloaf.com/blog/wwdc-2021-viewing-guide/">æ¨èæ¸…å•</a>ã€‚æˆ‘ä¹Ÿåˆ—äº†ä¸‹æˆ‘å…³æ³¨çš„ Sessionã€‚å¦‚ä¸‹ï¼š</p>
<p>SwiftUI ç›¸å…³ Sessionï¼š</p>
<ul>
<li><a href="https://developer.apple.com/videos/play/wwdc2021/10018/">Whatâ€™s new in SwiftUI</a>ï¼šåŒ…æ‹¬äº†æ‰€æœ‰SwiftUIè¿™æ¬¡çš„æ›´æ–°å†…å®¹ä»‹ç»ã€‚</li>
<li><a href="https://developer.apple.com/videos/play/wwdc2021/10021/">Add rich graphics to your SwiftUI app</a>ï¼šå†…å®¹åŒ…æ‹¬å®‰å…¨åŒºåŸŸã€æè´¨åŒ…ã€ç”»å¸ƒAPIç­‰ã€‚</li>
<li><a href="https://developer.apple.com/videos/play/wwdc2021/10176/">Craft search experiences in SwiftUI</a>ï¼š.searchableä¿®é¥°ç¬¦çš„ä½¿ç”¨ã€‚</li>
<li><a href="https://developer.apple.com/videos/play/wwdc2021/10023/">Direct and reflect focus in SwiftUI</a>ï¼šå…³äºç§»åŠ¨ç„¦ç‚¹çš„ä½¿ç”¨ã€‚</li>
<li><a href="https://developer.apple.com/videos/play/wwdc2021/10062/">SwiftUI on the Mac: Build the fundamentals</a>ï¼šå†…å®¹æ˜¯ä¸€æ­¥ä¸€æ­¥æ„å»ºä¸€ä¸ªmacOSåº”ç”¨ã€‚</li>
<li><a href="https://developer.apple.com/videos/play/wwdc2021/10289/">SwiftUI on the Mac: The finishing touches</a>ï¼šå±•ç¤ºå¦‚ä½•é€šè¿‡è®¾ç½®è®©äººä»¬çµæ´»å®šåˆ¶ä¸€ä¸ªåº”ç”¨ç¨‹åºã€‚</li>
<li><a href="https://developer.apple.com/videos/play/wwdc2021/10022/">Demystify SwiftUI</a>ï¼šä»‹ç»äº†SwiftUIçš„ä¸‰ä¸ªæ ¸å¿ƒIdentityã€Lifetimeå’ŒDependenciesã€‚</li>
<li><a href="https://developer.apple.com/videos/play/wwdc2021/10019/">Discover concurrency in SwiftUI</a>ï¼šå±•ç¤ºå¹¶å‘å·¥ä½œæµå¦‚ä½•å’ŒSwiftUIæ•°æ®æµè¿›è¡Œç»“åˆã€‚</li>
<li><a href="https://developer.apple.com/videos/play/wwdc2021/10349/">SF Symbols in SwiftUI</a>ï¼šå®šä¹‰Symbolsçš„å¤§å°ï¼Œæ˜¾ç¤ºä¸åŒå˜ä½“ä»¥åŠSymbolsç€è‰²ã€‚</li>
</ul>
<p>Swift Concurrency ç›¸å…³ Sessionï¼š</p>
<ul>
<li><a href="https://developer.apple.com/videos/play/wwdc2021/10132/">Meet async/await in Swift</a>ï¼šäº†è§£ async/await å¼€å‘æ¨¡å¼ã€‚</li>
<li><a href="https://developer.apple.com/videos/play/wwdc2021/10134/">Explore structured concurrency in Swift</a>ï¼šå†…å®¹åŒ…æ‹¬åˆ›å»ºä¸åŒç±»å‹å¹¶å‘ä»»åŠ¡ï¼Œå¦‚ä½•åˆ›å»ºä»»åŠ¡ç»„ï¼Œå¦‚ä½•å–æ¶ˆæ­£åœ¨è¿›è¡Œçš„ä»»åŠ¡ã€‚</li>
<li><a href="https://developer.apple.com/videos/play/wwdc2021/10133/">Protect mutable state with Swift actors</a>ï¼šå†…å®¹æœ‰å¦‚ä½•ä½¿ç”¨Swift actorsç»„ç»‡èµ„æºç«äº‰ï¼Œactorså¦‚ä½•å·¥ä½œç­‰ã€‚</li>
<li><a href="https://developer.apple.com/videos/play/wwdc2021/10254/">Swift concurrency: Behind the scenes</a>ï¼šäº†è§£æ›´å¤šSwiftå¹¶å‘çš„ç»†èŠ‚ï¼Œæ›´å®‰å…¨çš„æ•°æ®ç«äº‰å’Œå¤„ç†çº¿ç¨‹çˆ†ç‚¸ï¼Œå’ŒGCDçš„ä¸åŒï¼Œçº¿ç¨‹æ¨¡å‹æ€ä¹ˆå·¥ä½œç­‰ã€‚å€¼å¾—çœ‹å¤šéã€‚</li>
<li><a href="https://developer.apple.com/videos/play/wwdc2021/10194/">Swift concurrency: Update a sample app</a>ï¼šä»‹ç»async/awaitã€actorså’Œcontinuationåœ¨ç°å®å·¥ä½œä¸­çš„ç»éªŒ</li>
<li><a href="https://developer.apple.com/videos/play/wwdc2021/10058/">Meet AsyncSequence</a>ï¼šæµå¼ä¼ è¾“æ•°æ®ã€‚</li>
<li><a href="https://developer.apple.com/videos/play/wwdc2021/10095/">Use async/await with URLSession</a>ï¼šURLSessionä¸­æ€ä¹ˆä½¿ç”¨async/awaitå’ŒAsyncSequenceã€‚</li>
</ul>
<p>DocCï¼š</p>
<ul>
<li><a href="https://developer.apple.com/videos/play/wwdc2021/10166">Meet DocC documentation in Xcode</a>ï¼šäº†è§£å¦‚ä½•ä½¿ç”¨DocCï¼Œå¦‚ä½•ç”ŸæˆDocCæ¡£æ¡ˆï¼Œå¹¶è®©ä»–ä»¬æ˜¾ç¤ºåœ¨æ–‡æ¡£æµè§ˆå™¨ä¸­ã€‚</li>
<li><a href="https://developer.apple.com/videos/play/wwdc2021/10236">Host and automate your DocC documentation</a>ï¼šå¦‚ä½•é€šè¿‡è‡ªå·±çš„æœåŠ¡å™¨æ‰˜ç®¡DocCï¼Œè‡ªåŠ¨æ„å»ºå’Œåˆ†å‘DocCæ¡£æ¡ˆã€‚</li>
<li><a href="https://developer.apple.com/videos/play/wwdc2021/10167">Elevate your DocC documentation in Xcode</a>ï¼šä»‹ç»å†™æ–‡æ¡£çš„æœ€ä½³å®è·µã€‚</li>
<li><a href="https://developer.apple.com/videos/play/wwdc2021/10235">Build interactive tutorials using DocC</a>ï¼šç¼–å†™äº¤äº’æ•™ç¨‹ã€‚</li>
</ul>
<p>å…¶å®ƒæ„Ÿå…´è¶£çš„ Sessionï¼š</p>
<ul>
<li><a href="https://developer.apple.com/videos/play/wwdc2021/10253/">Write a DSL in Swift using result builders</a>ï¼šä½¿ç”¨ result builders æ¥åˆ›å»ºDSLï¼Œæ˜¯ä»£ç æ›´å®¹æ˜“é˜…è¯»å’Œç»´æŠ¤ã€‚</li>
<li><a href="https://developer.apple.com/videos/play/wwdc2021/10076/">Create 3D models with Object Capture</a>ï¼šæ•è·ç°å®å¯¹è±¡ï¼Œç”Ÿæˆ3Dæ¨¡å‹ã€‚</li>
<li><a href="https://developer.apple.com/videos/play/wwdc2021/10097/">Whatâ€™s new in SF Symbols</a>ï¼šSF Symbolsçš„æ›´æ–°ã€‚ä»‹ç»å¦‚ä½•è®©è‡ªå®šä¹‰ç¬¦å·æ”¯æŒå•è‰²ã€åˆ†å±‚ã€è°ƒè‰²æ¿å’Œå¤šè‰²æ¸²æŸ“æ¨¡å¼ã€‚</li>
<li><a href="https://developer.apple.com/videos/play/wwdc2021/10288/">Explore the SF Symbols 3 app</a>ï¼šSF Symbolsåº”ç”¨ç¨‹åºçš„æ›´æ–°ã€‚</li>
<li><a href="https://developer.apple.com/videos/play/wwdc2021/10250/">Create custom symbols</a>ï¼šåˆ›å»ºè‡ªå®šä¹‰symbolsã€‚</li>
<li><a href="https://developer.apple.com/videos/play/wwdc2021/10181/">Ultimate application performance survival guide</a>ï¼šå…³äºæ€§èƒ½ä¼˜åŒ–çš„è¯é¢˜ï¼Œå†…å®¹åŒ…æ‹¬æ€§èƒ½ç›¸å…³å·¥å…·ã€æŒ‡æ ‡å’ŒèŒƒå¼ã€‚ä¼šæ¶‰åŠåˆ°Instrumentsã€XCTestã€MetricKitç­‰ç­‰æŠ€æœ¯å’Œå·¥å…·ã€‚iOS 15çš„åŠ¨æ€é“¾æ¥å™¨åšäº†ä¼˜åŒ–èƒ½å¤Ÿå¯åŠ¨æé€Ÿå¹¶å‡å°‘SwiftäºŒè¿›åˆ¶å¤§å°ã€‚å¯ä»¥å‚çœ‹<a href="https://medium.com/geekculture/how-ios-15-makes-your-app-launch-faster-51cf0aa6c520">è¿™ç¯‡æ–‡ç« </a></li>
<li><a href="https://developer.apple.com/videos/play/wwdc2021/10211/">Symbolication: Beyond the basics</a>ï¼šä»‹ç»ç¬¦å·åŒ–çš„è¿‡ç¨‹ã€‚</li>
<li><a href="https://developer.apple.com/videos/play/wwdc2021/10256/">Meet the Swift Algorithms and Collections packages</a>ï¼šè®²çš„é€šä¿—æ˜“æ‡‚ã€‚</li>
</ul>
<h3 id="Swift-çš„ä¸€äº›æ›´æ–°"><a href="#Swift-çš„ä¸€äº›æ›´æ–°" class="headerlink" title="Swift çš„ä¸€äº›æ›´æ–°"></a>Swift çš„ä¸€äº›æ›´æ–°</h3><p>Paul Hudson çš„è¿™ç¯‡<a href="https://www.hackingwithswift.com/articles/233/whats-new-in-swift-5-5">Whatâ€™s new in Swift 5.5?</a> å·²ç»æŠŠè¿™äº›æ›´æ–°è¯´çš„éå¸¸è¯¦ç»†äº†ï¼Œæ¯ä¸ªæ›´æ–°ç‚¹éƒ½æœ‰å¯¹åº”çš„ä¾‹å­å¯ä»¥è¯•ã€‚ä»Šå¹´è‹¹æœå…¬å¸æ¨å‡º AttributedString ç”¨æ¥æ›¿ä»£ OC æ—¶ä»£çš„ NSAttributedStringã€‚AttributedString æ˜¯å€¼ç±»å‹ï¼Œå¯ä»¥ç›´æ¥åœ¨ SwiftUI çš„ Text é‡Œä½¿ç”¨ã€‚AttributedString è¿˜æ”¯æŒç®€å•çš„ Markdown è¯­æ³•ï¼ŒMarkdown å•è¡Œæ²¡é—®é¢˜ï¼Œå¤šè¡ŒåŠŸèƒ½å—é™ã€‚</p>
<p>DocC æ˜¯é€šè¿‡ Xcode ç¼–è¯‘åç”Ÿæˆçš„æ–‡æ¡£ï¼Œä½¿ç”¨ Product -&gt; Build Documentation å°±ä¼šç”ŸæˆDocCã€‚åœ¨å‡½æ•°æ¥å£ä»£ç ä¸Šä½¿ç”¨ Shift+Cmd+A å¿«æ·é”®å°±ä¼šåˆ›å»ºæ–‡æ¡£æ¨¡æ¿ï¼Œæœ‰å‚æ•°å’Œè¿”å›å€¼çš„è¯ä¹Ÿä¼šå°†å…¶æå–å‡ºæ¥ï¼ŒåŒ…æ‹¬å‚æ•°ç±»å‹ç­‰ï¼Œå¹¶ç”Ÿæˆæ ‡å‡†æ–‡æ¡£æ ¼å¼ï¼Œæ–¹ä¾¿ä½ è¿›è¡Œå†…å®¹ç¼–å†™ã€‚åŸºæœ¬ Markdown è¯­æ³•æ˜¯æ”¯æŒçš„ã€‚è¯¦ç»†çš„ä»‹ç»å¯ä»¥çœ‹å‰é¢åˆ—å‡ºçš„å®˜æ–¹ Sessionï¼Œæˆ–è€…çœ‹è¿™ç¯‡æ–‡ç« <a href="https://www.hackingwithswift.com/articles/238/how-to-document-your-project-with-docc">How to document your project with DocC</a>ã€‚</p>
<h3 id="ä»Šå¹´é‡å¤´æˆ-Swift-Concurrency"><a href="#ä»Šå¹´é‡å¤´æˆ-Swift-Concurrency" class="headerlink" title="ä»Šå¹´é‡å¤´æˆ Swift Concurrency"></a>ä»Šå¹´é‡å¤´æˆ Swift Concurrency</h3><p>ABI ç¨³å®šåï¼ŒSwift çš„æ ¸å¿ƒå›¢é˜Ÿå¯ä»¥å¼€å§‹å…³æ³¨ Swift è¯­è¨€ä¸€ç›´ç¼ºå¤±çš„åŸç”Ÿå¹¶å‘èƒ½åŠ›äº†ã€‚æœ€åˆæ˜¯ç”±<a href="https://twitter.com/clattner_llvm">Chris Lattner</a>åœ¨17å¹´å‘çš„<a href="https://gist.github.com/lattner/31ed37682ef1576b16bca1432ea9f782">Swiftå¹¶å‘å®£è¨€</a>ï¼Œä»æ­¤å¼€é˜”äº†å¤§å®¶çš„çœ¼ç•Œã€‚åæ¥ Swift Evolution ç¤¾åŒºè®¨è®ºäº†åå‡ ä¸ªææ¡ˆï¼Œå‡ åä¸ªæ–¹æ¡ˆï¼Œä»¥åŠå‡ ç™¾é¡µçš„è®¾è®¡æ–‡ä»¶ï¼Œåšäº†å¤§é‡çš„æ”¹è¿›ï¼Œç¤¾åŒºä¸­ç”¨æˆ·ç§¯æçš„å‚ä¸åé¦ˆï¼ŒChris ä¹Ÿä¸€ç›´åœ¨ Evolution ä¸­ç§¯æçš„å‚ä¸è®¾è®¡ã€‚</p>
<p>Swift Concurrency çš„å®ç°ç”¨äº†<a href="https://llvm.org/docs/Coroutines.html">LLVMçš„åç¨‹</a>æŠŠ async/await å‡½æ•°è½¬æ¢ä¸ºåŸºäºå›è°ƒçš„ä»£ç ï¼Œè¿™ä¸ªè¿‡ç¨‹å‘ç”Ÿåœ¨ç¼–è¯‘åæœŸï¼Œè¿™ä¸ªé˜¶æ®µä½ çš„ä»£ç éƒ½æ²¡æ³•è¾¨è¯†äº†ã€‚å¼‚æ­¥çš„å‡½æ•°è¢«å®ç°ä¸º coroutinesï¼Œåœ¨æ¯æ¬¡å¼‚æ­¥è°ƒç”¨æ—¶ï¼Œå‡½æ•°è¢«åˆ†å‰²æˆå¯è°ƒç”¨çš„å‡½æ•°éƒ¨åˆ†å’Œåé¢æ¢å¤çš„éƒ¨åˆ†ã€‚coroutine æ‹†åˆ†çš„è¿‡ç¨‹å‘ç”Ÿåœ¨ç”ŸæˆLLVM IRé˜¶æ®µã€‚Swiftä½¿ç”¨äº†å“ªäº›å¸¦æœ‰è‡ªå®šä¹‰è°ƒç”¨çº¦å®šçš„å‡½æ•°ä¿è¯å°¾éƒ¨è°ƒç”¨ï¼Œå¹¶ä¸“é—¨ä¸ºSwiftè¿›è¡Œäº†è°ƒæ•´ã€‚</p>
<p>Swift Concurrency ä¸æ˜¯å»ºç«‹åœ¨ GCD ä¸Šï¼Œè€Œæ˜¯ä½¿ç”¨çš„ä¸€ä¸ªå…¨æ–°çš„çº¿ç¨‹æ± ã€‚GCD ä¸­å¯åŠ¨é˜Ÿåˆ—å·¥ä½œä¼šå¾ˆå¿«åœ¨æèµ·çº¿ç¨‹ï¼Œä¸€ä¸ªé˜Ÿåˆ—é˜»å¡äº†çº¿ç¨‹ï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªæ–°çº¿ç¨‹ã€‚åŸºäºè¿™ç§æœºåˆ¶ GCD çº¿ç¨‹æ•°å¾ˆå®¹æ˜“æ¯” CPU æ ¸å¿ƒæ•°é‡å¤šï¼Œçº¿ç¨‹å¤šäº†ï¼Œçº¿ç¨‹å°±ä¼šæœ‰å¤§é‡çš„è°ƒåº¦å¼€é”€ï¼Œå¤§é‡çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä¼šä½¿ CPU è¿è¡Œæ•ˆç‡é™ä½ã€‚è€Œ Swift Concurrency çš„çº¿ç¨‹æ•°é‡ä¸ä¼šè¶…è¿‡ CPU å†…æ ¸ï¼Œå°†ä¸Šä¸‹æ–‡åˆ‡æ¢æ”¾åˆ°åŒä¸€ä¸ªçº¿ç¨‹ä¸­å»åšã€‚ä¸ºäº†å®ç°çº¿ç¨‹ä¸è¢«é˜»å¡ï¼Œéœ€è¦é€šè¿‡è¯­è¨€ç‰¹æ€§æ¥åšã€‚åšæ³•æ˜¯ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªå †æ ˆè®°å½•å‡½æ•°è°ƒç”¨æƒ…å†µï¼Œä¸€ä¸ªå‡½æ•°å ä¸€ä¸ªå¸§ã€‚å‡½æ•°è¿”å›åï¼Œè¿™ä¸ªå‡½æ•°æ‰€å çš„å¸§å°±ä¼šä»å †æ ˆå¼¹å‡ºã€‚await çš„ async å‡½æ•°è¢«ä½œä¸ºå¼‚æ­¥å¸§ä¿å­˜åœ¨å †ä¸Šç­‰å¾…æ¢å¤ï¼Œè€Œä¸é˜»ç¢å…¶å®ƒå‡½æ•°å…¥æ ˆæ‰§è¡Œã€‚åœ¨ await åè¿è¡Œçš„ä»£ç å« continuationï¼Œcontinuation ä¼šåœ¨è¦æ¢å¤æ—¶æ”¾å›åˆ°çº¿ç¨‹çš„å †æ ˆé‡Œã€‚å¼‚æ­¥å¸§ä¼šæ ¹æ®éœ€è¦æ”¾å›æ ˆä¸Šã€‚åœ¨ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ä¸­è°ƒç”¨åŒæ­¥ä»£ç å°†æ·»åŠ å¸§åˆ°çº¿ç¨‹çš„å †æ ˆä¸­ã€‚è¿™æ ·çº¿ç¨‹å°±èƒ½å¤Ÿä¸€ç›´å‘å‰è·‘ï¼Œè€Œä¸ç”¨åˆ›å»ºæ›´å¤šçº¿ç¨‹å‡å°‘è°ƒåº¦ã€‚</p>
<p>Douglas åœ¨ Swift è®ºå›é‡Œå‘çš„ Swift Concurrency ä¸‹ä¸ªç‰ˆæœ¬çš„è§„åˆ’è´´ <a href="https://forums.swift.org/t/concurrency-in-swift-5-and-6/49337">Concurrency in Swift 5 and 6</a>ï¼Œè®ºå›é‡Œè¿˜æœ‰ä¸€ä¸ªå¸–å­æ˜¯ä¸“é—¨ç”¨æ¥<a href="https://forums.swift.org/t/swift-concurrency-feedback-wanted/49336">å¾é›†Swift Concurrencyæ„è§</a>çš„ï¼Œå¸–å­æœ¬èº«åˆ—å‡ºäº† Swift Concurrency ç›¸å…³çš„æ‰€æœ‰ææ¡ˆï¼Œä¹Ÿæå‡ºæ¬¢è¿æœ‰æ–°ææ¡ˆå‘å‡ºæ¥ï¼Œé™¤äº†è¿™äº›ææ¡ˆå¯ä»¥çœ‹å¤–ï¼Œå¸–å­å›å¤ç›®å‰å·²ç»è¿‡ç™¾ï¼Œéå¸¸çƒ­é—¹ï¼Œå¯ä»¥çœ‹å‡ºå¤§å®¶å¯¹ Swift Concurrency çš„å…³æ³¨åº¦ç›¸å½“çš„é«˜ã€‚</p>
<p>éå¸¸å¤šçš„äººå‚ä¸äº† Swift Concurrency æ‰ä½¿å…¶çœ‹èµ·æ¥å’Œç”¨èµ·æ¥é‚£ä¹ˆç®€å•ã€‚Doug Gregor åœ¨å‚ä¸ John Sundell çš„æ’­å®¢åï¼Œå‘äº†å¾ˆå¤šæ¡æ¨èŠ Swift Concurrencyï¼Œå¯ä»¥çœ‹åˆ°å‚ä¸çš„äººéå¸¸å¤šï¼Œå¯è§èƒŒåä»˜å‡ºçš„åŠªåŠ›æœ‰å¤šå¤§ã€‚ä¸‹é¢æˆ‘æ±‡æ€»äº† Doug Gregor åœ¨æ¨ä¸Šå‘çš„ä¸€äº›ä¿¡æ¯ï¼Œä½ é€šè¿‡è¿™äº›ä¿¡æ¯ä¹Ÿå¯ä»¥äº†è§£ Swift Concurrency å¹•åä¿¡æ¯ï¼Œæ‰€åšçš„äº‹å’Œè´Ÿè´£çš„äººã€‚</p>
<p><a href="https://twitter.com/pathofshrines">@pathofshrines</a>æ˜¯ Swift Concurrency æ•´ä½“æ¶æ„å¸ˆï¼ŒåŒ…æ‹¬ä½çº§åˆ«è¿è¡Œæ—¶å’Œç¼–è¯‘å™¨ç›¸å…³ç»†èŠ‚ã€‚<a href="https://twitter.com/illian">@illian</a>æ˜¯ async sequencesã€stream å’Œ Fundation çš„è´Ÿè´£äººã€‚<a href="https://twitter.com/optshiftk">@optshiftk</a>å¯¹ UI å’Œå¹¶å‘äº¤äº’çš„æå¥½çš„æ´å¯ŸåŠ›å¸¦æ¥äº†å¾ˆæ£’çš„ async æ¥å£ï¼Œ<a href="https://twitter.com/phausler">@phausler</a>å¸¦æ¥äº† async sequencesã€‚Arnold Schwaighoferã€<a href="https://twitter.com/neightchan">@neightchan</a>ã€<a href="https://twitter.com/typesanitizer">@typesanitizer</a>è¿˜æœ‰ Tim Northover å®ç°äº† async calling conventionã€‚</p>
<p><a href="https://twitter.com/ktosopl">@ktosopl</a>æœ‰å¾ˆæ·±åšçš„ actorã€åˆ†å¸ƒå¼è®¡ç®—å’Œ Swift-on-Server ç»éªŒï¼Œå¸¦æ¥äº† actor ç³»ç»Ÿã€‚Erik Eckstein ä¸º async å‡½æ•°å’Œactorså»ºç«‹äº†å…³é”®çš„ä¼˜åŒ–å’ŒåŠŸèƒ½ã€‚</p>
<p>SwiftUIæ˜¯<a href="https://twitter.com/ricketson_">@ricketson_</a>å’Œ<a href="https://twitter.com/luka_bernardi">@luka_bernardi</a>å®Œæˆçš„asyncæ¥å£ã€‚async I/Oçš„æ¥å£æ˜¯<a href="https://twitter.com/Catfish_Man">@Catfish_Man</a>å®Œæˆçš„ã€‚<a href="https://twitter.com/slava_pestov">@slava_pestov</a>å¤„ç†äº† Swift æ³›å‹é—®é¢˜ï¼Œè¿˜æŒ‡å¯¼å…¶ä»–äººç¼–è¯‘å™¨å®ç°çš„ç»†èŠ‚ã€‚async é‡æ„å·¥å…·æ˜¯Ben Barham åšçš„ã€‚å¤§é‡ä»£ç ç§»æ¤åˆ° async æ˜¯ç”±<a href="https://twitter.com/AirspeedSwift">@AirspeedSwift</a>é¢†å¯¼ï¼Œç”± Angela Laarï¼ŒClack Coleï¼ŒNicole Jacques å’Œ<a href="https://twitter.com/mishaldshah">@mishaldshah</a>å…±åŒå®Œæˆçš„ã€‚</p>
<p><a href="https://twitter.com/lorentey">@lorentey</a>è´Ÿè´£ Swift æ¥å£çš„æ”¹è¿›ã€‚<a href="https://twitter.com/jckarter">@jckarter</a>æœ‰ç€æ•é”çš„è¯­è¨€è®¾è®¡æ´å¯ŸåŠ›ï¼Œå¸¦æ¥äº†è¯­è¨€è®¾è®¡ç»éªŒå’Œç¼–è¯‘å™¨åŠè¿è¡Œæ—¶å®ç°æŠ€èƒ½ã€‚<a href="https://twitter.com/mikeash">@mikeash</a> ä¹Ÿå‚ä¸äº†è¿è¡Œæ—¶å¼€å‘ä¸­ã€‚æ“ä½œç³»ç»Ÿçš„é›†æˆæ˜¯<a href="https://twitter.com/rokhinip">@rokhinip</a>å®Œæˆçš„ï¼Œ<a href="https://twitter.com/chimz">@chimz</a>æä¾›äº†å…³äº Dispatch å’Œ OS å¾ˆå¥½çš„å»ºè®®ï¼ŒPavel Yaskevich å’Œ<br><a href="">@hollyborla</a>è¿›è¡Œäº†å¹¶å‘æ‰€éœ€è¦å…³é”®ç±»å‹æ£€æŸ¥å™¨çš„æ”¹è¿›ã€‚<a href="https://twitter.com/kastiglione">@kastiglione</a>ã€Adrian Prantlå’Œ<a href="https://twitter.com/fred_riss">@fred_riss</a>å®ç°äº†è°ƒè¯•ã€‚<a href="https://twitter.com/etcwilde">@etcwilde</a>å’Œ<a href="https://twitter.com/call1cc">@call1cc</a>å®ç°äº†è¯­ä¹‰æ¨¡å‹ä¸­çš„é‡è¦éƒ¨åˆ†ã€‚</p>
<p><a href="https://twitter.com/evonox">@evonox</a>è´Ÿè´£äº†æœåŠ¡å™¨Linux çš„æ”¯æŒã€‚<a href="https://twitter.com/compnerd">@compnerd</a>å°† Swift Concurrency ç§»æ¤åˆ°äº† Windowsã€‚</p>
<p>Swift Concurrency æ¨¡å‹ç®€å•ï¼Œç»†èŠ‚éƒ½è¢«éšè—äº†ï¼Œæ¯” Kotlin å’Œ C++çš„ Coroutine æ¥å£è¦ç®€æ´å¾ˆå¤šã€‚æ¯”å¦‚ Task æ¥å£å½¢å¼å°±å¾ˆç®€æ´ã€‚Swift Concurrency å¤§ä½“å¯åˆ†ä¸º async/awaitã€Async Sequencesã€ç»“æ„åŒ–å¹¶å‘å’Œ  Actorsã€‚ä¸‹é¢å±•å¼€è¯´ä¸‹ã€‚</p>
<h4 id="async-await"><a href="#async-await" class="headerlink" title="async/await"></a>async/await</h4><p>é€šè¿‡ç±»ä¼¼ throws è¯­æ³•çš„ async æ¥æŒ‡å®šå‡½æ•°ä¸ºå¼‚æ­¥å‡½æ•°ï¼Œå¼‚æ­¥å‡½æ•°æ‰èƒ½å¤Ÿä½¿ç”¨ awaitï¼Œä½¿ç”¨å¼‚æ­¥å‡½æ•°è¦ç”¨ awaitã€‚await ä¿®é¥°åœ¨ suspension point æ—¶å½“å‰çº¿ç¨‹å¯ä»¥è®©ç»™å…¶å®ƒä»»åŠ¡æ‰§è¡Œï¼Œè€Œä¸ç”¨é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç­‰ await åé¢çš„å‡½æ•°æ‰§è¡Œå®Œæˆå†å›æ¥ç»§ç»­æ‰§è¡Œï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯å›æ¥æ‰§è¡Œä¸ä¸€å®šæ˜¯åœ¨ç¦»å¼€æ—¶çš„çº¿ç¨‹ä¸Šã€‚async/await ææ¡ˆæ˜¯<a href="https://github.com/apple/swift-evolution/blob/main/proposals/0296-async-await.md">SE-0296</a>ã€‚å¦‚æœæƒ³æŠŠç°æœ‰çš„å¼‚æ­¥å¼€å‘å¸¦åˆ° async/await ä¸–ç•Œï¼Œè¯·ä½¿ç”¨ withCheckedThrowingContinuationã€‚</p>
<p>async/await è¿˜æœ‰ä¸€ä¸ªéå¸¸æ˜æ˜¾çš„å¥½å¤„ï¼Œå°±æ˜¯ä¸ä¼šå†æœ‰[weak self] dance äº†ã€‚</p>
<h4 id="Async-Sequences"><a href="#Async-Sequences" class="headerlink" title="Async Sequences"></a>Async Sequences</h4><p>AsyncSequence çš„ä½¿ç”¨æ–¹å¼æ˜¯ for-await-in å’Œ for-try-await-inï¼Œç³»ç»Ÿæä¾›äº†ä¸€äº›æ¥å£ï¼Œå¦‚ä¸‹ï¼š</p>
<ul>
<li>FileHandle.standardInput.bytes.lines</li>
<li>URL.lines </li>
<li>URLSession.shared.data(from: URL)</li>
<li>let (localURL, _ ) = try await session.download(from: url) ä¸‹è½½å’Œgetè¯·æ±‚æ•°æ®åŒºåˆ«æ˜¯éœ€è¦è¾¹è¯·æ±‚è¾¹å­˜å‚¨æ•°æ®ä»¥å‡å°‘å†…å­˜å ç”¨</li>
<li>let (responseData, response) = try await session.upload(for: request, from: data)</li>
<li>URLSession.shared.bytes(from: URL)</li>
<li>NotificationCenter.default.notifications</li>
</ul>
<h4 id="ç»“æ„åŒ–å¹¶å‘"><a href="#ç»“æ„åŒ–å¹¶å‘" class="headerlink" title="ç»“æ„åŒ–å¹¶å‘"></a>ç»“æ„åŒ–å¹¶å‘</h4><p>ä½¿ç”¨è¿™äº›æ¥å£å¯ä»¥ä¸€è¾¹æ¥æ”¶æ•°æ®ä¸€è¾¹è¿›è¡Œæ˜¾ç¤ºï¼ŒAsyncSequence çš„ææ¡ˆæ˜¯<a href="https://github.com/apple/swift-evolution/blob/main/proposals/0298-asyncsequence.md">SE-0298</a>ï¼ˆSwift 5.5å¯ç”¨ï¼‰ã€‚AsyncStream æ˜¯åˆ›å»ºè‡ªå·±å¼‚æ­¥åºåˆ—çš„æœ€ç®€å•çš„æ–¹æ³•ï¼Œå¤„ç†è¿­ä»£ã€å–æ¶ˆå’Œç¼“å†²ã€‚AsyncStream æ­£åœ¨è·¯ä¸Šï¼Œææ¡ˆæ˜¯<a href="https://github.com/apple/swift-evolution/blob/main/proposals/0314-async-stream.md">SE-0314</a>ã€‚</p>
<p>Task ä¸ºä¸€ç»„å¹¶å‘ä»»åŠ¡åˆ›å»ºä¸€ä¸ªè¿è¡Œç¯å¢ƒï¼Œasync let å¯ä»¥è®©ä»»åŠ¡å¹¶å‘æ‰§è¡Œï¼Œç»“æ„åŒ–å¹¶å‘ï¼ˆStructured concurrencyï¼Œææ¡ˆåœ¨è·¯ä¸Š<a href="https://github.com/apple/swift-evolution/blob/main/proposals/0304-structured-concurrency.md">SE-0304</a>ï¼‰withTaskGroup ä¸­ group.async å¯ä»¥å°†å¹¶å‘ä»»åŠ¡è¿›è¡Œåˆ†ç»„ã€‚</p>
<h4 id="Actors"><a href="#Actors" class="headerlink" title="Actors"></a>Actors</h4><p>æˆ‘ä»¬å†™çš„ç¨‹åºä¼šåœ¨è¿›ç¨‹ä¸­è¢«æ‹†æˆä¸€ä¸ªä¸€ä¸ªå°æŒ‡ä»¤ï¼Œè¿™äº›æŒ‡ä»¤ä¼šåœ¨æŸåˆ»ä¼šä¸€ä¸ªæ¥ä¸€ä¸ªåŒæ­¥çš„æˆ–è€…å¹¶å‘çš„æ‰§è¡Œã€‚ç³»ç»Ÿä¼šç”¨å¤šä¸ªçº¿ç¨‹æ‰§è¡Œå¹¶è¡Œçš„ä»»åŠ¡ï¼Œæ‰§è¡Œé¡ºåºæ˜¯è°ƒåº¦å™¨æ¥ç®¡ç†çš„ï¼Œç°ä»£å¤šæ ¸å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªçº¿ç¨‹ï¼Œå½“ä¸€ä¸ªèµ„æºåœ¨å¤šä¸ªçº¿ç¨‹ä¸ŠåŒæ—¶è¢«æ›´æ”¹æ—¶å°±ä¼šå‡ºé—®é¢˜ã€‚å¹¶å‘ä»»åŠ¡å¯¹æ•°æ®èµ„æºæ“ä½œå®¹æ˜“é€ æˆæ•°æ®ç«äº‰ï¼Œä»¥å‰éœ€è¦æ‰‹åŠ¨æ”¾åˆ°ä¸²è¡Œé˜Ÿåˆ—ã€ä½¿ç”¨é”ã€è°ƒåº¦å±éšœæˆ– Atomics çš„æ–¹å¼æ¥é¿å…ã€‚ä»¥å‰å¤„ç†å®¹æ˜“å¯¼è‡´æ˜‚è´µçš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè¿‡å¤šçº¿ç¨‹å®¹æ˜“å¯¼è‡´çº¿ç¨‹çˆ†ç‚¸ï¼Œå®¹æ˜“æ„å¤–é˜»æ–­çº¿ç¨‹å¯¼è‡´åé¢ä»£ç æ²¡æ³•æ‰§è¡Œï¼Œå¤šä»»åŠ¡ç›¸äº’çš„ç­‰å¾…é€ æˆäº†æ­»é”ï¼Œblock å’Œå†…å­˜å¼•ç”¨å®¹æ˜“å‡ºé”™ç­‰ç­‰é—®é¢˜ã€‚</p>
<p>ç°åœ¨ Swift Concurrency å¯ä»¥é€šè¿‡ actor æ¥åˆ›å»ºä¸€ä¸ªåŒºåŸŸï¼Œåœ¨è¿™ä¸ªåŒºåŸŸä¼šè‡ªåŠ¨è¿›è¡Œæ•°æ®å®‰å…¨ä¿æŠ¤ï¼Œä¿è¯ä¸€å®šæ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®é‡Œé¢æ•°æ®ï¼Œé˜²æ­¢æ•°æ®ç«äº‰ã€‚actor å†…éƒ¨å¯¹æˆå‘˜è®¿é—®æ˜¯åŒæ­¥çš„ï¼Œæˆå‘˜é»˜è®¤æ˜¯éš”ç¦»çš„ï¼Œactor å¤–éƒ¨å¯¹ actor å†…æˆå‘˜çš„è®¿é—®åªèƒ½æ˜¯å¼‚æ­¥çš„ï¼Œéšå¼åŒæ­¥ä»¥é˜²æ­¢æ•°æ®ç«äº‰ã€‚MainActor ç»§æ‰¿è‡ªèƒ½ç¡®ä¿å…¨å±€å”¯ä¸€å®ä¾‹çš„ GlobalActorï¼Œä¿è¯ä»»åŠ¡åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œè¿™æ ·ä½ å°±å¯ä»¥æŠ›å¼ƒæ‰åœ¨ä½ çš„ ViewModel é‡Œå†™ DispatchQueue.main.async äº†ã€‚</p>
<p>Actors çš„æ¦‚å¿µé€šå¸¸è¢«ç”¨äºåˆ†å¸ƒå¼è®¡ç®—ï¼ŒActor æ¨¡å‹å‚çœ‹<a href="https://en.wikipedia.org/wiki/Actor_model">Wikipedia</a>é‡Œçš„è¯¦ç»†è§£é‡Šï¼ŒSwift ä¸­çš„å®ç°æ•ˆæœä¹Ÿéå¸¸çš„ç†æƒ³ã€‚Actors çš„ææ¡ˆ<a href="https://github.com/apple/swift-evolution/blob/main/proposals/0306-actors.md">SE-0306</a>å·²åœ¨ Swift 5.5è½å®ã€‚</p>
<p>å¾ˆå¤šè¯­è¨€éƒ½æ”¯æŒ actors è¿˜æœ‰ async/awaitï¼Œå®ç°çš„æ–¹å¼ä¹Ÿç±»ä¼¼ï¼Œactor ä½¿ç”¨çš„ä¸æ˜¯é”ï¼Œè€Œæ˜¯ç”¨çš„ async/await è¿™æ ·èƒ½å¤Ÿåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­åˆ‡æ¢ä¸Šä¸‹æ–‡æ¥é¿å…çº¿ç¨‹ç©ºé—²çš„çº¿ç¨‹æ¨¡å‹ã€‚actor è¿˜åˆ©ç”¨ç¼–è¯‘å™¨ï¼Œæå‰åšä¼šå¼•èµ·å¹¶å‘é—®é¢˜çš„æ£€æŸ¥ã€‚</p>
<p>actor æ˜¯éµå¾ª Sendable åè®®çš„ï¼Œåªæœ‰ç»“æ„ä½“å’Œ final ç±»æ‰èƒ½å¤Ÿéµå¾ª Sendableï¼Œç»§æ‰¿äº Sendable åè®®çš„ Excutor åè®®è¡¨ç¤ºæ–¹æ³•æœ¬èº«ï¼ŒSerialExecutor è¡¨ç¤ºä»¥ä¸²è¡Œæ–¹å¼æ‰§è¡Œã€‚actor ä½¿ç”¨ C++å†™çš„ï¼Œæºç åœ¨<a href="https://github.com/apple/swift/blob/main/stdlib/public/Concurrency/Actor.cpp">è¿™é‡Œ</a>ï¼Œå¯ä»¥çœ‹åˆ° actor ä¸»è¦æ˜¯é€šè¿‡æ§åˆ¶å„ä¸ª job æ‰§è¡Œçš„çŠ¶æ€çš„ç®¡ç†å™¨ã€‚job æ‰§è¡Œä¼˜å…ˆçº§æ¥è‡ª Task å¯¹è±¡ï¼Œæ’é˜Ÿæ—¶éœ€è¦ç¡®ä¿é«˜ä¼˜ job å…ˆè¢«æ‰§è¡Œã€‚å…¨å±€ Executor ç”¨æ¥ä¸º job æ’é˜Ÿï¼Œé€šçŸ¥ actor æ‹¥æœ‰æˆ–è€…æ”¾å¼ƒçº¿ç¨‹ï¼Œå®ç°åœ¨<a href="https://github.com/apple/swift/blob/main/stdlib/public/Concurrency/GlobalExecutor.cpp">è¿™é‡Œ</a>ã€‚ç”±äºç­‰å¾…è€Œæ”¾å¼ƒå½“å‰çº¿ç¨‹è®©å…¶ä»– actor æ‰§è¡Œçš„ actorï¼Œåœ¨æ”¶åˆ°å…¨å±€ Executor åˆ›å»ºä¸€ä¸ªæ–°çš„ job çš„é€šçŸ¥ï¼Œä½¿å…¶å¯ä»¥è¿›å…¥ä¸€ä¸ªå¯èƒ½ä¸åŒçº¿ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯å¹¶å‘æ¨¡å‹ä¸­æè¿°çš„ Actor Reentrancyã€‚</p>
<h4 id="Swift-Concurrencyç›¸å…³ææ¡ˆé›†åˆ"><a href="#Swift-Concurrencyç›¸å…³ææ¡ˆé›†åˆ" class="headerlink" title="Swift Concurrencyç›¸å…³ææ¡ˆé›†åˆ"></a>Swift Concurrencyç›¸å…³ææ¡ˆé›†åˆ</h4><p>æ‰€æœ‰ç›¸å…³ææ¡ˆæ¸…å•å¦‚ä¸‹ï¼š</p>
<ul>
<li><a href="https://github.com/apple/swift-evolution/blob/main/proposals/0296-async-await.md">SE-0296: Async/await</a> <a href="https://kemchenj.github.io/2021-03-06/">ã€è¯‘ã€‘SE-0296 Async/await</a></li>
<li><a href="https://github.com/apple/swift-evolution/blob/main/proposals/0317-async-let.md">SE-0317: async let</a> </li>
<li><a href="https://github.com/apple/swift-evolution/blob/main/proposals/0300-continuation.md">SE-0300: Continuations for interfacing async tasks with synchronous code</a> <a href="https://kemchenj.github.io/2021-03-31/">ã€è¯‘ã€‘SE-0300 Continuation â€“ æ‰§è¡ŒåŒæ­¥ä»£ç çš„å¼‚æ­¥ä»»åŠ¡æ¥å£</a></li>
<li><a href="https://github.com/apple/swift-evolution/blob/main/proposals/0302-concurrent-value-and-concurrent-closures.md">SE-0302: Sendable and @Sendable closures</a> </li>
<li><a href="https://github.com/apple/swift-evolution/blob/main/proposals/0298-asyncsequence.md">SE-0298: Async/Await: Sequences</a> <a href="https://kemchenj.github.io/2021-03-10/">ã€è¯‘ã€‘SE-0298 Async/Await åºåˆ—</a></li>
<li><a href="https://github.com/apple/swift-evolution/blob/main/proposals/0304-structured-concurrency.md">SE-0304: Structured concurrency</a> </li>
<li><a href="https://github.com/apple/swift-evolution/blob/main/proposals/0306-actors.md">SE-0306: Actors</a> <a href="https://kemchenj.github.io/2021-04-25/">ã€è¯‘ã€‘SE-0306 Actors</a></li>
<li><a href="https://github.com/apple/swift-evolution/blob/main/proposals/0313-actor-isolation-control.md">SE-0313: Improved control over actor isolation</a> </li>
<li><a href="https://github.com/apple/swift-evolution/blob/main/proposals/0297-concurrency-objc.md">SE-0297: Concurrency Interoperability with Objective-C</a> <a href="https://kemchenj.github.io/2021-03-07/">ã€è¯‘ã€‘SE-0297 Concurrency ä¸ Objective-C çš„äº¤äº’</a></li>
<li><a href="https://github.com/apple/swift-evolution/blob/main/proposals/0314-async-stream.md">SE-0314: AsyncStream and AsyncThrowingStream</a> </li>
<li><a href="https://github.com/apple/swift-evolution/blob/main/proposals/0316-global-actors.md">SE-0316: Global actors</a> </li>
<li><a href="https://github.com/apple/swift-evolution/blob/main/proposals/0310-effectful-readonly-properties.md">SE-0310: Effectful read-only properties</a> </li>
<li><a href="https://github.com/apple/swift-evolution/blob/main/proposals/0311-task-locals.md">SE-0311: Task Local Values</a> </li>
<li><a href="https://forums.swift.org/t/support-custom-executors-in-swift-concurrency/44425">Custom Executors</a> </li>
</ul>
<h4 id="å­¦ä¹ è·¯å¾„"><a href="#å­¦ä¹ è·¯å¾„" class="headerlink" title="å­¦ä¹ è·¯å¾„"></a>å­¦ä¹ è·¯å¾„</h4><p>å¦‚æœæ‰“ç®—å°è¯• Swift Concurrency çš„è¯ï¼ŒæŒ‰ç…§å…ˆåé¡ºåºï¼Œå¯ä»¥å…ˆçœ‹å®˜æ–¹æ‰‹å†Œä»‹ç»æ–‡ç« <a href="https://docs.swift.org/swift-book/LanguageGuide/Concurrency.html">Concurrency</a>ã€‚å†çœ‹<a href="https://developer.apple.com/videos/play/wwdc2021/10132/">Meet async/await in Swift</a>è¿™ä¸ªSessionï¼Œäº†è§£èƒŒååŸç†çœ‹<a href="https://developer.apple.com/videos/play/wwdc2021/10134">Explore structured concurrency in Swift</a>ã€‚åŠ¨æ‰‹ç…§ç€è¯•ç¤ºä¾‹ä»£ç ï¼Œçœ‹Paulçš„<a href="https://www.hackingwithswift.com/quick-start/concurrency">Swift Concurrency by Example</a>è¿™ä¸ªç³»åˆ—ã€‚æ¥ç€çœ‹<a href="https://developer.apple.com/videos/play/wwdc2021/10133">Protect mutable state with Swift actors</a>æ¥äº†è§£ actors æ€ä¹ˆé˜²æ­¢æ•°æ®ç«äº‰ã€‚é€šè¿‡<a href="https://developer.apple.com/videos/play/wwdc2021/10019">Discover concurrency in SwiftUI</a>çœ‹ concurrency å¦‚ä½•åœ¨ SwiftUI ä¸­ä½¿ç”¨ï¼Œ<a href="https://developer.apple.com/videos/play/wwdc2021/10095">Use async/await with URLSession</a>æ¥çœ‹æ€ä¹ˆåœ¨ URLSession ä¸­ä½¿ç”¨ async/awaitã€‚æœ€åå¬å¬è´Ÿè´£ Swift Concurrency çš„ Doug Gregor å‚åŠ çš„ä¸€ä¸ª<a href="https://www.swiftbysundell.com/podcast/99/">æ’­å®¢çš„è®¿è°ˆ</a>ï¼Œäº†è§£ä¸‹ Swift Concurrency èƒŒåçš„æ•…äº‹ã€‚</p>
<h4 id="Swift-Concurrency-å’Œ-Combine"><a href="#Swift-Concurrency-å’Œ-Combine" class="headerlink" title="Swift Concurrency å’Œ Combine"></a>Swift Concurrency å’Œ Combine</h4><p>ç”±äº Swift Concurrency çš„æ¨å‡ºå’Œå¤§é‡çš„ Session å‘å¸ƒï¼Œç‰¹åˆ«æ˜¯<a href="https://developer.apple.com/documentation/swift/asyncsequence/">AsyncSequence</a>çš„å‡ºç°ï¼Œä»¥åŠæ­£åœ¨è·¯ä¸Šçš„<a href="https://github.com/apple/swift-evolution/blob/main/proposals/0314-async-stream.md">AsyncStreamã€AsyncThrowingStream</a>å’Œ<a href="https://github.com/apple/swift-evolution/blob/main/proposals/0300-continuation.md">continuation</a>ææ¡ˆï¼ˆåœ¨Xcode 13.0 beta 3 AsyncStream æ­£å¼<a href="https://developer.apple.com/documentation/swift/asyncstream?changes=latest_beta">release</a>ï¼‰ï¼Œè¿™äº›è¶Šæ¥è¶Šå¤šå’Œ Combine åŠŸèƒ½é‡å çš„ç‰¹æ€§å‡ºç°åœ¨ Swift Concurrency è“å›¾é‡Œæ—¶ï¼Œå¤§å®¶å¼€å§‹çŒœæµ‹æ˜¯å¦ Combine ä¼šè¢« Swift Concurrency æ›¿ä»£ã€‚å…³äºæœªæ¥æ˜¯ Swift Concurrency è¿˜æ˜¯ Combineï¼Œæˆ‘çš„æ„Ÿè§‰æ˜¯ï¼ŒCombine æ›´ä¾§é‡åœ¨å“åº”å¼ç¼–ç¨‹ä¸Šï¼Œè€Œå“åº”å¼ç¼–ç¨‹å¹¶ä¸æ˜¯æ‰€æœ‰å¼€å‘äººå‘˜éƒ½ä¼šæ¥å—çš„ï¼Œè€Œ Swift Concurrency æ˜¯æ‰€æœ‰äººéƒ½æ„¿æ„æ¥å—çš„å¼€å‘æ–¹å¼ï¼Œä» Swift Concurrency æ¨å‡ºåå¼€å‘è€…ä½¿ç”¨çš„æ•°é‡å’Œç¤¾åŒºååº”ç«çƒ­ç¨‹åº¦æ¥çœ‹éƒ½æ¯” Combine è¦å¤§ã€‚åœ¨è‹¹æœå¯¹ Combine æœ‰ä¸‹ä¸€æ­¥åŠ¨ä½œä¹‹å‰ï¼Œæˆ‘è¿˜æ˜¯æ›´åå‘ Swift Concurrencyã€‚</p>
<p>è§é—»å†™åˆ°è¿™é‡Œï¼ŒæŠŠç‹¬ç‰¹æ€§æ¯”ä½œéª¨æ¶ï¼ŒçœŸå®æ„Ÿæ¯”ä½œè¡€è‚‰ï¼Œæ•…äº‹æ€§å’Œæ–°æ„æ¯”ä½œçš®è‚¤ï¼Œä½ ä¼šå‘ç°æ²¡æœ‰å†™å‡ºè‡ªå·±çš„ç»å†çš„è¯ï¼Œå°±åƒè¿›å‡»å·¨äººé‡Œçš„é‚£äº›å°å·¨äººï¼Œå³ä½¿æœ‰äº†å®Œæ•´çš„çš®è‚¤ï¼Œä½†éª¨å¤´æ¶å­ä¸å¤§æ˜¯ä¸ä¼šæœ‰å¼€å¤´è¸¢ç ´å¤§é—¨çš„åªæœ‰éª¨æ¶å’Œè¡€è‚‰çš„å·¨å‹å¤§å·¨äººé‚£ä¹ˆå¼ºå¤§ä¸”éœ‡æ’¼æœ‰åŠ›ã€‚</p>
<p>é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘å°±æå†™ä¸€äº›æˆ‘åœ¨ WWDC21 æœŸé—´ç‹¬ç‰¹çš„ä¸€äº›ç»å†ã€‚</p>
<h3 id="WWDC-playgroundç›´æ’­æ´»åŠ¨"><a href="#WWDC-playgroundç›´æ’­æ´»åŠ¨" class="headerlink" title="WWDC.playgroundç›´æ’­æ´»åŠ¨"></a>WWDC.playgroundç›´æ’­æ´»åŠ¨</h3><p>æƒ³æƒ³ WWDC21 è¿‡ç¨‹ä¸­æˆ‘è¿˜æ˜¯æœ‰äº›ç»å†ï¼Œæ¯”å¦‚å‚åŠ äº†è‹¹æœå®˜æ–¹æ¨èçš„å¤–å›´æ´»åŠ¨<a href="https://swift.gg/wwdc/">WWDC.playgournd by SwiftGG</a>ã€‚<br><img src="/uploads/my-little-idea-about-writing-technical-article/3.png" alt=""><br><img src="/uploads/my-little-idea-about-writing-technical-article/4.png" alt=""></p>
<p>è¿ç»­çœ‹äº†5å¤©æ´»åŠ¨ç›´æ’­ï¼Œè¿˜å‚åŠ äº†ä¸€å¤©çš„ Live Coding ä»‹ç» SwiftUI çš„æ–°ç‰¹æ€§ã€‚ç›´æ’­ Live Coding å‡†å¤‡çš„æ—¶é—´å¾ˆå°‘ï¼Œè€Œä¸”ä»¥å‰æˆ‘è¿˜æ²¡æœ‰ç°åœºå½“ç€å‡ åƒäººé¢å†™ä»£ç çš„ç»å†ï¼Œç›´æ’­å‰ä¸€å¤©æ™šä¸Šèµ¶ç€é€šå®µè¾¾æ—¦çœ‹å®Œäº†ç›¸å…³ Sessionï¼Œå†™äº†äº›ä»£ç æ ·ä¾‹æµ‹è¯•ï¼Œå½“å¤©ç™½å¤©è¿˜å¼€äº†ä¸€ä¸ªå¾ˆé•¿çš„ä¼šï¼Œå›å®¶å‰å’ŒåŒäº‹è®¨è®ºä¸€ä¸ªæŠ€æœ¯é—®é¢˜æ—¶ï¼Œæˆ‘å‘ç°æˆ‘å—“å­è¿˜å“‘äº†ã€‚åˆ°å®¶ååœ¨æ¡Œå‰è„šè¿˜æŠ½ç­‹äº†ï¼Œä½ å¯æƒ³è±¡åˆ°æˆ‘å½“æ—¶å†…å¿ƒæœ‰å¤šå´©æºƒã€‚</p>
<p>åœ¨ç›´æ’­å‰ï¼Œæˆ‘è¿˜ä¸“é—¨çš„ç»™æ€ç¦å…ˆæ¼”ç»ƒäº†ä¸€éï¼Œå…¶ä¸­åœ¨ä»‹ç» AsyncImage å¤„ç†å¤±è´¥ã€ç©ºç™½ã€æˆåŠŸè¿˜æœ‰é»˜è®¤æƒ…å†µæ—¶ï¼Œç¼–è¯‘å™¨æŠ¥é”™æç¤ºæ— æ³•æ‰¾åˆ°åŸå› ï¼Œè¿˜æç¤ºè®©æˆ‘æäº¤ bug çš„é”™è¯¯ä¿¡æ¯ã€‚ç›´æ’­å¼€å§‹å‰ä¸€ç›´æ²¡æœ‰æ‰¾åˆ°åŸå› ï¼Œé‡æ–°æ•²äº†ä¸€éæ‰è§£å†³ï¼Œæ‰€ä»¥å¿ƒé‡Œæ²¡åº•ï¼Œç›´æ’­å¼€å§‹æ—¶è¿˜ä¸€ç›´æ‹…å¿ƒè¿™ä¸ªé—®é¢˜ä¼šé‡ç°ã€‚ç›´æ’­æ—¶åœ¨å†™åˆ°è¿™æ®µæ—¶æœç„¶ç¼–è¯‘å™¨é”™è¯¯åˆå‡ºç°äº†ï¼Œå½“æ—¶æˆ‘è„‘è¢‹ä¸€ç‰‡ç©ºç™½ï¼Œå¿ƒä¸­å¤§å‘¼æ•‘æˆ‘ã€‚å¥½åœ¨æ²¡å¤šä¸€ä¼šæˆ‘çªç„¶å‘ç°å…ˆå‰ä¸€æ®µæ¼”ç¤ºçš„ placeholder æ¥å£æ²¡æœ‰åˆ æ‰ï¼ŒåŸå› çœŸçš„å°±æ˜¯è¿™ä¸ªï¼Œåˆ æ‰åå°±æ­£å¸¸äº†ï¼Œåˆ«ææœ‰å¤šå¼€å¿ƒäº†ã€‚åé¢å°±è½»æ¾äº†å¾ˆå¤šã€‚ç”±äºåªæœ‰ä¸€å¤©æ—¶é—´å‡†å¤‡ï¼Œå¾ˆå¤šå†…å®¹å‡†å¤‡äº†ï¼Œå½“æ—¶ä¸€è¾¹æ•²ä»£ç ä¸€è¾¹è¯´ä¹Ÿæ¼è¯´äº†å¾ˆå¤šï¼Œæ¯”å¦‚ AsyncImage ä½¿ç”¨çš„æ˜¯ URLSessionï¼Œç”¨çš„æ˜¯ URLCacheï¼Œè¿˜ä¸èƒ½è‡ªå®šä¹‰ç¼“å­˜ã€‚Refreshable åªèƒ½ç”¨åœ¨ List é‡Œã€‚SwiftUI å’Œæ•°ç»„ç»‘å®šçš„ä»£ç æ˜¯å¯ä»¥å…¼å®¹å‰ä¸€ä¸ªç‰ˆæœ¬çš„ã€‚</p>
<p>å¦å¤–è¿˜æœ‰ä¸ª WWDC æœŸé—´å¾ˆç«çš„è€ç³»ç»ŸUIæŒ‘æˆ˜èµ›è®©æˆ‘å°è±¡æ·±åˆ»ï¼Œå…¶ä¸­æœ‰ä¸ª18å²å°ä¼™ç”¨ SwiftUI å¼€å‘äº†ç»å…¸ iPhone4å¯ç”¨ç‰ˆæœ¬æœ€ç«çˆ†ï¼ŒGithub åœ°å€<a href="https://github.com/zzanehip/The-OldOS-Project">åœ¨è¿™é‡Œ</a>ã€‚</p>
<p>SwitUI æ–°ç‰¹æ€§å¤ªå¤šäº†ï¼Œç›´æ’­æ²¡æåˆ°çš„è¿˜æœ‰ task modifierã€separatorã€macOS ä¸Šçš„ tableã€Canvasã€preview in landscapeã€@FocusStateã€more button ç­‰ç­‰ã€‚å½“æ—¶ç›´æ’­æœ‰å›æ”¾ï¼Œå¯ä»¥åœ¨<a href="https://www.bilibili.com/video/BV1H44y167b7">è¿™é‡Œçœ‹</a>ã€‚æ›´å®Œæ•´è¯¦ç»†ä»‹ç»å»ºè®®çœ‹å‰é¢æåˆ° SwiftUI ç›¸å…³ Sessionã€‚</p>
<p>WWDC.playgournd æœ€åä¸€å¤©ç›´æ’­æœ‰åœº WWDC21 å­¦ç”ŸæŒ‘æˆ˜èµ›è·å¥–è€…å¼ ç´«æ€¡çš„åˆ†äº«ï¼Œå¥¹åˆ†äº«äº†æ€æ ·å‡†å¤‡æŒ‘æˆ˜èµ›çš„è¿‡ç¨‹ï¼Œé€šè¿‡è¯¦ç»†çš„è¿‡ç¨‹ä»‹ç»ï¼Œå¿ƒå¾—ä½“ä¼šï¼Œè¿˜æœ‰æ€è€ƒï¼Œè®©å¤§å®¶äº†è§£åˆ°äº†å¥¹çš„çƒ­æƒ…å’Œæ‰åï¼Œè€Œä¸”åˆ†äº«çš„å½¢å¼å’Œæ•ˆæœéå¸¸æœ‰æ–°æ„ã€‚æœ€åä¸€åœºçš„å›æ”¾<a href="https://www.bilibili.com/video/BV1Fq4y1L7od">çœ‹è¿™é‡Œ</a>ã€‚çœ‹å®Œè¿™åœºåï¼Œæˆ‘æ‰“ç®—åœ¨19å· SwiftGG å’Œå¿«æ‰‹ä¸­å­¦åˆåŠçš„ WWDC<T> æ²™é¾™æ´»åŠ¨ä¸­ä½¿ç”¨ä¸€ç§ä¸åŒçš„æ–¹å¼è¿›è¡Œåˆ†äº«ã€‚åŸå…ˆæ‰“ç®—çš„æ˜¯ä½¿ç”¨å…ˆå‰å†™å¥½çš„ä¸€ä¸ªç¤ºä¾‹å±•ç¤ºä½¿ç”¨ SwiftUI å¼€å‘å¤æ‚åº”ç”¨å¦‚ä½•å¿«æ·ï¼ŒåŒæ—¶ä»‹ç»èƒŒåçš„æŠ€æœ¯ã€‚å‡ å¤©æƒ³æ¥æƒ³å»ï¼Œåå¤æ¨æ•²æ¨ç¿»ï¼Œä¸€ç›´æ²¡æœ‰æ–°æ€è·¯ã€‚æœ€ååˆ°äº†å‰ä¸€å¤©ï¼Œæˆ‘æœ‰äº†ä¸ªä¸»æ„ï¼Œå¯ä»¥ä½¿ç”¨ SwiftUI æ¥ç¼–å†™ä¸€ä¸ªå¹»ç¯ç‰‡ç¨‹åºæ¥åˆ†äº« SwiftUI çš„å†…å®¹å•Šï¼ŒåŒæ—¶è¿˜èƒ½å¤Ÿåˆ†äº«è¿™ä¸ªå¹»ç¯ç‰‡å¼€å‘è¿‡ç¨‹å¿ƒå¾—ï¼Œè¿™æ ·æ‰æœ‰ç‹¬ç‰¹æ€§å’ŒçœŸå®æ„Ÿå˜›ã€‚äºæ˜¯æŠŠå‡†å¤‡äº†ä¸€å¹´çš„å†…å®¹éƒ½åˆ äº†ï¼Œå°±åƒå½“æ—¶å¯åŠ¨é‚£ç¯‡åˆ å¾—åªå‰©ä¸€ä¸‡å­—çš„æ–‡ç« ä¸€æ ·ï¼Œé‚£ç¯‡æ–‡ç« å‘å¸ƒå‰å…±åˆ æ‰äº†å››ä¸‡ä¸ªå­—ã€‚</p>
<h3 id="WWDCæ²™é¾™æ´»åŠ¨"><a href="#WWDCæ²™é¾™æ´»åŠ¨" class="headerlink" title="WWDCæ²™é¾™æ´»åŠ¨"></a>WWDC<T>æ²™é¾™æ´»åŠ¨</h3><p>å¯æƒ³æ³•æ€»æ˜¯å¾ˆå®¹æ˜“ï¼Œå®è·µèµ·æ¥å´åˆæ˜¯å¦ä¸€ç§æƒ…å†µã€‚æˆ‘å¯¹è‡ªåˆ¶å¹»ç¯ç‰‡çš„åˆæ­¥è®¾æƒ³æ˜¯ç¬¬ä¸€èƒ½å¤Ÿå‰åç¿»é¡µå±•ç¤ºå†…å®¹ï¼Œç¬¬äºŒèƒ½å¤Ÿæ”¯æŒå’Œ Keynote ä¸ä¸€æ ·çš„åŠ¨ç”»æ•ˆæœå’Œé¡µé¢ç¾åŒ–ï¼Œç¬¬ä¸‰èƒ½å¤Ÿç›´æ¥åœ¨å¹»ç¯ç‰‡ä¸Šè¿›è¡Œä¸€äº› SwiftUI åŠŸèƒ½çš„äº¤äº’æ¼”ç¤ºã€‚</p>
<p>æ¥ä¸‹æ¥å°±è¦å¼€å§‹å®é™…å»åšäº†ï¼Œæˆ‘å…ˆæ‹¿å‡ºä¸Šå‘¨ç”¨é“…ç¬”åœ¨ A4 çº¸ç”»çš„äººè‰å›¾åŠ å·¥æ¥ä¸°å¯Œå±•ç¤ºï¼Œå‘ç°åŠ å·¥çš„æ—¶é—´æ¥ä¸åŠäº†ï¼Œè™½ç„¶ç°åœ¨åŠ å·¥é€Ÿåº¦æ¯”ä»¥å‰å¿«äº†ï¼Œä½†æ˜¯æ—¶é—´å¤ªç´§ï¼Œè¿˜è¦å†™å¹»ç¯ç‰‡ç¨‹åºå‘¢ã€‚SwiftUI å¼€å‘ç¡®å®å¿«ï¼Œæ¯ä¸ªé¡µé¢æˆ‘éƒ½å†™æˆä¸€ä¸ª Viewï¼Œæ ‡é¢˜ã€å¤§çº²å’Œç¤ºæ„å›¾çš„ç»„åˆæˆ‘åšæˆäº†é€šç”¨ Viewï¼Œé€šè¿‡ä¼ å…¥ä¸åŒæ ‡é¢˜ã€å¤§çº²æ•°ç»„å’Œå›¾ç‰‡æ•°ç»„æ¥å±•ç¤ºä¸åŒé¡µé¢çš„å†…å®¹ï¼Œå®šä¹‰ä¸€ä¸ª ObservableObject çš„ç±» GlobalStateInfo ä½œä¸º View Model æ¥å­˜å‚¨éœ€è¦çš„çŠ¶æ€æ•°æ®ï¼Œæ¯”å¦‚å½“å‰åœ¨å“ªé¡µï¼Œå½“å‰æ–‡å­—é¢œè‰²ï¼Œå½“å‰é¡µèƒŒæ™¯é¢œè‰²ç­‰ï¼Œæ¯ä¸ª View é‡Œä½¿ç”¨ @EnvironmentObject å°±å¯ä»¥å»è·å–å’Œè®¾ç½® GlobalStateInfo äº†ã€‚</p>
<p>å…³äºä¸ºäº†ä¼ é€’æ•°æ®ï¼Œæ˜¯ç›´æ¥è°ƒç”¨ EnvironmentObjectï¼Œè¿˜æ˜¯é€šè¿‡å­è§†å›¾ä¼ é€’ ObservedObjectï¼Œä¸¤ç§æ–¹å¼å“ªä¸ªæ›´å¥½ï¼Œåœ¨ WWDC21 çš„ Digital Lounges é‡Œï¼Œè‹¹æœå·¥ç¨‹å¸ˆçš„å›ç­”æ˜¯ä¸¤è€…ç”¨é€”ä¸åŒã€‚å½“å¤§éƒ¨åˆ† View éƒ½éœ€è¦ç”¨åˆ°ä¸€äº›é€šç”¨æ•°æ®æ—¶ï¼Œæ¨èä½¿ç”¨ EnvironmentObjectï¼Œå› ä¸ºæ²¡æœ‰å®é™…ä½¿ç”¨ ObservableObject çš„ View ä¸ä¼šè¢«ä¸ä¹‹ç›¸å…³çš„ä»£ç æä¹±ã€‚å¦‚æœæ¨¡å‹ä¸æ˜¯åŸºäº View å±‚æ¬¡ç»“æ„çš„å¯¹è±¡å›¾ï¼Œä½¿ç”¨ ObservedObjectã€‚å¦å¤–è¿˜æœ‰ä¸ª Digital Lounges çš„é—®é¢˜ï¼Œæ˜¯é—®æ€ä¹ˆä»æ—§çš„ AppDelegate/SceneDelegate ç”Ÿå‘½å‘¨æœŸè½¬æ¢åˆ°æ–°çš„ SwiftUI 2 ç”Ÿå‘½å‘¨æœŸã€‚è‹¹æœå·¥ç¨‹å¸ˆè¯´å¯ä»¥ä½¿ç”¨ UIApplicationDelegateAdaptor å±æ€§åŒ…è£…å™¨ï¼ŒSwiftUI å°†å®ä¾‹åŒ–ä½ çš„ UIApplicationDelegate çš„ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶ä»¥æ­£å¸¸æ–¹å¼è°ƒç”¨å®ƒã€‚æ›´è¯¦ç»†çš„è§£ç­”å’Œå…¶ä»–çš„è¯é¢˜å¯ä»¥å‚çœ‹è¿™ç¯‡<a href="https://roblack.github.io/WWDC21Lounges/">SwiftUI Lounge QAs</a>ï¼Œå†…å®¹éƒ½æ˜¯ roblack ä» Digital Lounges é‡Œæ‘˜å‡ºæ¥çš„ï¼ŒWWDC21 é‚£å‡ å¤©æˆ‘ä¹Ÿåœ¨ Digital Loungesï¼ˆæŠ¥åæ—©ï¼‰çœ‹å¤§å®¶å’Œè‹¹æœå·¥ç¨‹å¸ˆçš„äº’åŠ¨ï¼Œåæ¥çœ‹åˆ«äººè¯´ Digital Lounges çš„ SwiftUI é‚£åœºçˆ†æ»¡ï¼Œå·²ç»è¶…è´Ÿè·è¿è½¬äº†ï¼Œæ„Ÿè§‰è‹¹æœæœ€è¿‘å˜å¾—æ›´å¼€æ”¾äº†ï¼Œå¾ˆå¤šè‹¹æœå·¥ç¨‹å¸ˆéƒ½å¼€é€šäº† Twitter è´¦å·åœ¨ WWDC æœŸé—´ç§¯æå’Œå¤§å®¶äº’åŠ¨ã€‚</p>
<p>ä¸ºäº†ä½¿é¡µé¢ä¸å•è°ƒï¼Œæˆ‘æ‰“ç®—æ¯é¡µå¤§çº²çš„é¢œè‰²åšäº›åŒºåˆ†ï¼Œå‘ç°11é¡µæ¯ä¸ªéƒ½é…ä¸€éçœ‹æ•ˆæœæ—¶é—´å¤ªç´§ï¼Œäºæ˜¯æˆ‘é€‰æ‹©äº†ä¸€äº›èƒŒæ™¯è‰²é€šè¿‡éšæœºè¯»å–ï¼Œæ¯æ¬¡çœ‹åˆ°çš„é¢œè‰²éƒ½æ˜¯ä¸åŒçš„ï¼Œç”±äºéƒ½æ˜¯ä¸€ä¸ªä¸€ä¸ªæ‰‹åŠ¨é€‰å‡ºæ¥çš„ï¼Œæ‰€ä»¥ä¸åŒç»„åˆæ•ˆæœä¹Ÿä¸ä¼šå¤ªå·®ã€‚</p>
<p>ç°åœ¨å‰åç¿»é¡µå±•ç¤ºå†…å®¹è¿™ä¸ªæƒ³æ³•æ˜¯å®Œæˆäº†ï¼Œè¿™ä¹Ÿæ˜¯ SwiftUI å¼€å‘çš„ä¼˜åŠ¿ï¼Œèƒ½å¤Ÿå¿«é€Ÿæ„å»ºé¡µé¢æ¶å­å’Œç®€å•çš„æ•°æ®é¡µé¢åŒæ­¥è®¾ç½®ã€‚ä½†æ˜¯ç¬¬äºŒä¸ªæƒ³æ³•ï¼Œå®Œæˆèµ·æ¥å°±éå¸¸è´¹æ—¶è´¹åŠ›ä¸”ä¸é‚£ä¹ˆé¡ºåˆ©äº†ã€‚</p>
<p>é¦–å…ˆè¯´ä¸‹å­—ä½“ï¼Œç³»ç»Ÿé»˜è®¤å­—ä½“å¾ˆæ­£å¼ï¼Œä»¥å¾€æˆ‘éƒ½æ˜¯ç›´æ¥ç”¨ iPad æ‰‹å†™ï¼Œä½†æ˜¯è¿™æ¬¡æ—¶é—´ç´§æ²¡æ³•ä¸€ä¸ªå­—ä¸€ä¸ªå­—çš„å†™äº†ï¼Œæ‰€ä»¥æˆ‘æ‰“ç®—é€‰æ‹©å…¶å®ƒå­—ä½“ï¼ŒView çš„ .font ä¿®æ”¹å™¨å¯ä»¥é€‰æ‹©å…¶å®ƒå­—ä½“ï¼Œæ–¹æ³•æ˜¯ .font(Font.custom(â€œfont-nameâ€, size: 110))ã€‚å¦‚æœç›´æ¥åœ¨Finderé‡ŒæŸ¥çœ‹å­—ä½“æ²¡æ³•å¾—åˆ°å¯ç”¨çš„å­—ä½“åï¼Œéœ€è¦ä½¿ç”¨ NSFontManager.shared.availableMembers æ¥è·å–å¯ç”¨å­—ä½“åã€‚</p>
<p>æ¥ä¸‹æ¥æ˜¯æ ‡é¢˜ï¼Œä»¥å¾€åšå¹»ç¯ï¼Œç»å¸¸è®²åˆ°å…·ä½“å†…å®¹æ—¶ï¼Œç‰¹åˆ«æ˜¯ç»†èŠ‚æ—¶ï¼Œå®¹æ˜“è®©çœ‹çš„äººå¿˜è®°å½“å‰é¡µä¸»é¢˜æ˜¯å•¥ã€‚å¦‚æœæ ‡é¢˜å¤ªå¤§ï¼Œå¯å±•ç¤ºå†…å®¹å°±å°‘äº†ï¼ŒåŠæ—¶è¿™æ ·ï¼Œè§‚çœ‹çš„äººä¹Ÿå®¹æ˜“å¿½è§†ä¸»é¢˜ã€‚å› æ­¤ï¼Œæˆ‘æ‰“ç®—æŠŠæ ‡é¢˜åšæˆä¸€ä¸ªå¾ªç¯çš„åŠ¨ç”»ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æˆ‘å±•å¼€è¯´å†…å®¹çš„æ—¶å€™ï¼Œçœ‹çš„äººå³ä½¿èµ°ç¥äº†è¿˜èƒ½å¤Ÿæ³¨æ„åˆ°å½“å‰é¡µä¸»é¢˜ã€‚æ ‡é¢˜çš„åŠ¨ç”»ä¸»è¦æ˜¯æ§åˆ¶å¥½åŠ¨ç”»çš„æ—¶é—´ï¼Œä¸èƒ½å¤ªå¿«ï¼Œä¸ç„¶ä¼šè¿‡äºå¸å¼•æ³¨æ„ã€‚</p>
<p>ä»¥å‰ keynote çš„è½¬åœºåŠ¨ç”»æˆ‘åŸºæœ¬éƒ½è¯•è¿‡ï¼Œæ¯æ¬¡æ¥å›éƒ½æ˜¯é‚£äº›ï¼Œå¾ˆéš¾å’Œå…¶ä»–äººåšå‡ºå·®å¼‚æ¥ã€‚åªèƒ½é å›¾å’Œé…è‰²ä½œåŒºåˆ†ã€‚è¿™æ¬¡æˆ‘åˆ©ç”¨æ¯é¡µçš„å†…å®¹å¤§çº²è¿›å…¥æ•ˆæœæ¥ä½œä¸ºè½¬åœºåŠ¨ç”»ã€‚æˆ‘å…ˆå°†å¤§çº²åˆ—è¡¨æ”¾åˆ° VStack é‡Œï¼ŒForEach é‡Œè·å–åˆ°ä¸‹æ ‡ï¼Œé€šè¿‡ä¸‹æ ‡è·å–åˆ—è¡¨æ•°ç»„é‡Œçš„ Text Viewã€‚ä¹‹æ‰€æœ‰è¦å¾—åˆ°ä¸‹æ ‡è€Œä¸æ˜¯ç›´æ¥è·å–åˆ—è¡¨æ•°ç»„é‡Œçš„ Text Viewï¼Œå…¶åŸå› æ˜¯è¿˜ä¼šå°†è¿™ä¸ªä¸‹æ ‡ç”¨åœ¨è½¬åœºåŠ¨ç”»æ•ˆæœä¸Šï¼Œæˆ‘å¸Œæœ›å¤§çº²åˆ—è¡¨çš„å†…å®¹æ˜¯ä¸€ä¸ªæ¥ä¸€ä¸ªè¿›æ¥çš„ï¼Œéœ€è¦è¿™ä¸ªä¸‹æ ‡å€¼æ¥åšæ—¶é—´é—´éš”ã€‚Animation çš„æ•ˆæœä½¿ç”¨çš„æ˜¯ interpolatingSpringï¼Œæˆ‘å°† damping å‚æ•°è®¾ç½®ä¸º0.3ï¼Œè¿™æ ·å¼¹æ€§æ•ˆæœæ›´ä½³ã€‚åˆ—è¡¨å†…å®¹è¿›å…¥çš„æ˜¯ GeometryEffect åè®®ï¼Œç”¨æ¥æ›¿ä»£ AnimatableModifierï¼Œé€šè¿‡ AnimatablePair æ¥è®¾ç½®ç§»åŠ¨ä½ç½®æ–°æ—§å€¼ã€‚ç›´æ¥ä¸€ä¸ªæ–¹å—æ»‘å…¥ç•¥æ˜¾å•è°ƒï¼Œä½¿ç”¨ CGAffineTransform é‡Œçš„ c å‚æ•°å¯ä»¥è®¾ç½®å°†çŸ©å½¢è¿›è¡Œå˜å½¢ï¼Œä¼šæœ‰ä¸€ç§è¢«æ‹‰è¿›æ¥çš„æ„Ÿè§‰ã€‚å˜å½¢è¿‡ç¨‹é…åˆæ»‘å…¥åŠ¨ç”»å†åŠ ä¸Š interpolatingSpring è®¾ç½®çš„å¼¹æ€§æ•ˆæœï¼Œä¼šè®©è½¬åœºæ›´æœ‰åŠ¨æ„Ÿã€‚</p>
<p>å¹¶è¡Œæ‰§è¡Œçš„åŠ¨ç”»è¶Šä¸°å¯Œï¼Œè½¬åœºæ„Ÿè§‰å°±ä¼šæ›´å¥½ï¼Œæˆ‘æƒ³ç€æ¯é¡µéƒ½åšä¸ªä¸åŒçš„æ•ˆæœï¼Œä½¿ç”¨ Shape ç»˜åˆ¶ä¸€äº›å›¾å½¢åšèƒŒæ™¯åŠ¨ç”»ï¼Œè¿™æ ·ä¼šæœ‰æ–°é²œæ„Ÿã€‚å½“ç¬¬ä¸€é¡µå’Œç¬¬äºŒé¡µå¼„å®Œåå·²ç»å¤©äº®äº†ï¼Œç»è¿‡ä¸€ä¸ªä¸Šåˆï¼Œä¸‹åˆå°±è¦åˆ†äº«äº†ã€‚æˆ‘è¿˜æ²¡æœ‰å›°æ„ï¼Œå› ä¸ºåé¢è¿˜æœ‰é‚£ä¹ˆå¤šé¡µé¢æ²¡æœ‰åšå®ŒåŒºåˆ†è½¬åœºçš„åŠ¨ç”»å’Œé…è‰²ï¼Œæ›´åˆ«è¯´ SwiftUI åŠŸèƒ½çš„äº¤äº’æ¼”ç¤ºäº†ã€‚è€Œä¸”å…·ä½“åˆ†äº«çš„å†…å®¹æˆ‘è¿˜æ²¡æœ‰æ•´ä½“ä¸²ä¸€éé€»è¾‘ã€‚ä¸€å¤©ä¸€å¤œå®Œæˆè¿™ä¸ªé¡¹ç›®æ—¶é—´è¿˜æ˜¯å¤ªç´§ï¼Œå½“æ—¶æƒ³ç€è¦å†èƒ½å¤šä¸€å¤©æ—¶é—´å°±å¥½äº†ã€‚2ç‚¹å¼€å§‹åˆ†äº«ï¼Œ1ç‚¹æˆ‘åœ¨æ—è¾¹ä¸€ä¸ªå°ä¼šè®®å®¤æŠŠæ•´ä¸ªå†…å®¹è‡ªå·±åœ¨å¿ƒé‡Œè¯•ç€è¯´äº†ä¸€éã€‚åˆ†äº«å†…å®¹åŒ…æ‹¬äº†è‡ªåˆ¶ä½ç‰ˆæœ¬å…¼å®¹ AsyncImage æ¼”ç¤ºã€SwiftUI é‚£äº›ç‰ˆæœ¬å…¼å®¹é—®é¢˜ã€SwiftUI èƒŒåå…³é”®æŠ€æœ¯ç®€ä»‹ã€SwiftUI ç”Ÿå‘½å‘¨æœŸã€å¸ƒå±€ã€Modifierã€ä¸é€æ˜è¿”å›ç±»å‹ã€å±æ€§åŒ…è£…ã€Result Builderã€Geometryã€Previewç”¨çš„æŠ€æœ¯ã€‚</p>
<p>å…¶ä¸­ SwiftUI å†…éƒ¨è¿ä½œçš„æœºåˆ¶æ˜¯æ¯ä¸ª View éƒ½æœ‰è‡ªå·±çš„ Identityï¼ŒSwiftUI ä¼šå°†ç»™ State å’Œ StateObject åˆ†é…å†…å­˜ç©ºé—´çš„ Storage å’Œ View çš„ Identity ç»‘å®šèµ·æ¥ï¼Œå…±å­˜äº¡ã€‚å½“ç›¸åŒ Identity çš„çŠ¶æ€æ•°æ®å‘ç”Ÿå˜åŒ–äº†æˆ–è€…å’Œ View ä¾èµ–å…³ç³»æ”¹å˜äº†ï¼Œå°±ä¼šé‡æ–°å»ºç«‹ View å’Œ RenderNode çš„ä¾èµ–å…³ç³»ï¼Œä»–ä»¬ä¹‹é—´çš„å…³ç³»æ˜¯å›¾ç»“æ„ï¼Œå›¾ç»“æ„å¯ä»¥é™ä½ä¾èµ–å…³ç³»æ£€æŸ¥å¤æ‚åº¦ã€‚æœ€åæ¸²æŸ“å‡ºæ¥ã€‚æ€»çš„æ¥è¯´ SwiftUI è¿è¡ŒåŸç†æœ‰ä¸‰ä¸ªç‚¹æœ€é‡è¦ï¼ŒIdentifierã€ç”Ÿå‘½å‘¨æœŸå’Œä¾èµ–ã€‚è§†å›¾çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ Identifier æ¥å†³å®šçš„ï¼Œstate ç”Ÿå‘½å‘¨æœŸå’Œè§†å›¾çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ç›¸åŒçš„ã€‚åœ¨ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œstate æœ‰å˜åŒ–çš„æ—¶å€™ä¼šåšdiffï¼Œdiffå’Œæ¸²æŸ“æ•ˆç‡æå‡æ˜¯ä½¿ç”¨å›¾å‹ä¾èµ–ç»“æ„ï¼Œåªæ¸²æŸ“çŠ¶æ€ä¾èµ–çš„è§†å›¾ï¼Œå¦‚æœæŒ‰ç…§ UIKit é‚£æ ·çš„æ ‘å½¢ç»“æ„åšdiffï¼Œæ•ˆç‡ä¼šç‰¹åˆ«å·®ã€‚</p>
<p>ç°åœ¨å¾ˆå¤šå¸¸ç”¨å¼€æºåº“éƒ½å·²ç»å¯¹SwiftUIåšäº†é€‚é…ï¼Œè‹¹æœå…¬å¸è‡ªå·±çš„Appï¼Œæ¯”å¦‚å¤©æ°”ã€ç›¸å†Œã€å¿«æ·æŒ‡ä»¤ã€åœ°å›¾å’Œç›¸å†Œéƒ½æœ‰ç”¨åˆ°SwiftUIã€‚ä»¥ä¸‹æ˜¯SwiftUIç”¨åˆ°çš„è¯­æ³•ç‰¹æ€§ï¼š</p>
<ul>
<li>ResultBuilder</li>
<li>ViewBuilder</li>
<li>Trailing Closure</li>
<li>Opaque Type</li>
<li>Inline</li>
<li>PropertyWrapper</li>
<li>KeyPath</li>
<li>DynamicMemberLookup</li>
</ul>
<p>å¦‚æœä½ ä½¿ç”¨è¿™äº›ç‰¹æ€§ä¹Ÿèƒ½å¤Ÿå†é€ ä¸€ä¸ªå…¼å®¹ä½ç‰ˆæœ¬çš„ç±»ä¼¼ SwiftUI çš„æ¡†æ¶ã€‚SwiftUI æœ€æ˜¾ç°çš„ DSL æŠ€æœ¯ä½¿ç”¨çš„å°±æ˜¯ ResultBuilder è¯­æ³•ç‰¹æ€§ï¼ŒResult Builderçš„ææ¡ˆ<a href="https://github.com/apple/swift-evolution/blob/main/proposals/0289-result-builders.md">SE-0289</a> é‡Œæœ‰è¯¦ç»†çš„æè¿°ï¼Œé€šè¿‡ Result Builder ä¸‹é¢çš„æ–¹æ³•å¯ä»¥è‡ªå®šä¹‰å‡ºä¸€ä¸ªç®€æ´çš„ DSL å‡ºæ¥ï¼Œæé«˜ç‰¹å®šä¸šåŠ¡å¼€å‘æ•ˆç‡ã€‚</p>
<ul>
<li>buildBlockï¼šæ„å»ºåŸºæœ¬è¯­å¥çš„blockç»„åˆç»“æœã€‚</li>
<li>buildExpressionï¼šå¯é€‰ï¼Œç»™è¡¨è¾¾å¼æä¾›ä¸Šä¸‹æ–‡ç±»å‹ä¿¡æ¯ã€‚</li>
<li>buildOptionalï¼šå¯¹æ²¡æœ‰elseçš„ifè¯­å¥æ”¯æŒã€‚</li>
<li>buildEitherï¼šæ„å»ºé€‰æ‹©è¯­å¥ä¸åŒç»“æœã€‚é€šè¿‡æ¡ä»¶ç»“æœæŠ˜å æˆä¸€ä¸ªç»“æœï¼Œå®ç°å¯¹if-elseå’Œswitchè¯­å¥çš„æ”¯æŒã€‚</li>
<li>buildArrayï¼šå°†æ‰€æœ‰è¿­ä»£ç»“æœåˆå¹¶æˆä¸€ä¸ªç»“æœçš„æ–¹å¼å®ç°å¯¹forâ€¦inè¯­å¥çš„æ”¯æŒã€‚</li>
<li>buildFinalResultï¼šå¯é€‰ï¼Œå¯ä»¥è°ƒç”¨é¡¶å±‚å‡½æ•°ä½“çš„ç»“æœè¿›è¡Œå¤„ç†ï¼Œäº§ç”Ÿæœ€ç»ˆçš„è¿”å›ç»“æœã€‚</li>
<li>buildLimitedAvailabilityï¼šä¼šåœ¨if #availableçš„blockéƒ¨åˆ†ç»“æœä¸Šè°ƒç”¨ï¼Œä½¿result builderå¯ä»¥æ“¦é™¤ç±»å‹ä¿¡æ¯ã€‚</li>
</ul>
<p>è¿™æ¬¡çš„ WWDC è¿˜ä¸“é—¨æœ‰ä¸ª Session è®²è§£äº†æ€ä¹ˆç”¨ Result Builder æ¥åš DSLï¼Œè¿™ä¸ª Session æ˜¯ <a href="https://developer.apple.com/videos/play/wwdc2021/10253/">Write a DSL in Swift using result builders</a>ã€‚</p>
<p>Swift è§†å›¾è¿”å›çš„ç±»å‹æ˜¯ä¸å›ºå®šçš„ï¼Œå› æ­¤ä½¿ç”¨äº† Swift çš„ä¸é€æ˜ç±»å‹è¯­æ³•ç‰¹æ€§æ¥è¿›è¡Œæ”¯æŒï¼Œæ”¯æŒå…¶è¿”å›å¸¦æœ‰å¤§é‡æ³›å‹å‚æ•°çš„åºå¤§ç±»å‹ï¼Œè¿™ä¸ªç±»å‹ä¸­è¿˜åŒ…æ‹¬äº† Result Builder ä¸­çš„ if æ¡ä»¶ç±»å‹å€¼ï¼Œæ”¯æŒå¤šåˆ†æ”¯ç±»å‹ã€‚Opaque Typesçš„ææ¡ˆåœ¨è¿™é‡Œ<a href="https://github.com/apple/swift-evolution/blob/master/proposals/0244-opaque-result-types.md">SE-0244</a>ã€‚</p>
<p>è·Ÿç€è§†å›¾åé¢çš„ç‚¹è¯­æ³•æ˜¯ modifierï¼Œæ¯ä¸ª modifier éƒ½ä¼šåœ¨è§†å›¾æ ‘ä¸­æ–°å»ºä¸€ä¸ªå±‚ï¼Œå› æ­¤ modifier çš„å†™çš„å…ˆåé¡ºåºä¸åŒï¼Œæ•ˆæœæ˜¯ä¸ä¸€æ ·çš„ã€‚</p>
<p>å¯¹äºæ•°æ®çš„ç›‘å¬å’Œå“åº”ä½¿ç”¨çš„æ˜¯ swift é‡Œçš„å±æ€§åŒ…è£…è¯­æ³•ç‰¹æ€§ï¼Œå±æ€§åŒ…è£…çš„ææ¡ˆæ˜¯<a href="https://github.com/apple/swift-evolution/blob/master/proposals/0258-property-wrappers.md">SE-0258</a>ã€‚åŒ…è£…åæ•°æ®çš„ä½¿ç”¨å°±æ–¹ä¾¿äº†å¾ˆå¤šï¼Œå¯¹äºä¸åŒå±æ€§åŒ…è£…ç±»åˆ«çš„é€‰æ‹©å¯ä»¥æŒ‰ç…§æ•°æ®ç±»å‹å’Œåº”ç”¨åœºæ™¯æ¥ï¼Œå¯¹äºå€¼ç±»å‹ï¼Œå¦‚æœæ˜¯åªè¯»çš„æ•°æ®å¯ä»¥ä»€ä¹ˆéƒ½ä¸åŠ ï¼Œå¦‚æœæ•°æ®æ˜¯å¯è¯»å†™çš„ï¼Œä½¿ç”¨@Stateï¼Œå¦‚æœæ•°æ®æ˜¯éœ€è¦åœ¨å…¶ä»–è§†å›¾è¿›è¡Œè¯»å†™å¹¶è‡ªå·±ä¹ŸåŒæ­¥å“åº”çš„ï¼Œä½¿ç”¨@Bindingè¿›è¡Œå£°æ˜ã€‚å¯¹äºå¯¹è±¡ç±»å‹çš„æ•°æ®ï¼ŒæŒ‡å‘å¯¹è±¡çš„å¼•ç”¨èƒ½å‘ç”Ÿå˜åŒ–è¦ç”¨@ObservedObjectæ¥å£°æ˜ï¼Œå¼•ç”¨ä¸å¯æ”¹å˜ï¼Œé‚£ä¹ˆå°±ç”¨@StateObjectï¼Œä½¿ç”¨ç¯å¢ƒä¼ é€’å¯¹è±¡ç”¨@EnvironmentObjectã€‚</p>
<p>å®Œæ•´çš„ WWDC<T>æ²™é¾™æ´»åŠ¨å›æ”¾å¯ä»¥æ‰«ä¸‹å›¾ä¸­çš„äºŒç»´ç ï¼š<br><img src="/uploads/my-little-idea-about-writing-technical-article/5.jpeg" alt=""></p>
<p><img src="/uploads/my-little-idea-about-writing-technical-article/6.JPG" alt=""><br><img src="/uploads/my-little-idea-about-writing-technical-article/7.jpeg" alt=""></p>
<p>ä¸‹é¢æ˜¯å½“æ—¶ç°åœºæ¼”ç¤ºçš„éƒ¨åˆ†å¹»ç¯ç‰‡ï¼ŒåŠ¨ç”»çš„æ•ˆæœå¯ä»¥çœ‹ä¸Šé¢çš„è§†é¢‘å›æ”¾ï¼š</p>
<p><img src="/uploads/my-little-idea-about-writing-technical-article/8.PNG" alt=""><br><img src="/uploads/my-little-idea-about-writing-technical-article/9.PNG" alt=""><br><img src="/uploads/my-little-idea-about-writing-technical-article/10.PNG" alt=""><br><img src="/uploads/my-little-idea-about-writing-technical-article/11.PNG" alt=""><br><img src="/uploads/my-little-idea-about-writing-technical-article/12.PNG" alt=""><br><img src="/uploads/my-little-idea-about-writing-technical-article/13.PNG" alt=""><br><img src="/uploads/my-little-idea-about-writing-technical-article/14.PNG" alt=""><br><img src="/uploads/my-little-idea-about-writing-technical-article/15.PNG" alt=""><br><img src="/uploads/my-little-idea-about-writing-technical-article/16.PNG" alt=""><br><img src="/uploads/my-little-idea-about-writing-technical-article/17.PNG" alt=""><br><img src="/uploads/my-little-idea-about-writing-technical-article/18.PNG" alt=""></p>
<p>è‡³æ­¤ï¼Œè¿™ç¯‡WWDC21è§é—»å°±å†™å®Œäº†ï¼Œè¯¦ç»†æå†™è‡ªå·±WWDC21æœŸé—´çš„ä¸€äº›ç‹¬ç‰¹ç»å†å’Œå…¶ä¸­æ¶‰åŠç›¸å…³æŠ€æœ¯ï¼Œè¿™æ ·ä¼šè®©æ–‡ç« çš„ç‹¬ç‰¹æ€§å’ŒçœŸå®æ„Ÿæœ‰å¾ˆå¤§çš„æå‡ã€‚</p>
<h2 id="å¯¹ç‹¬ç‰¹æ€§å’Œæ–°æ„çš„æ€è€ƒ"><a href="#å¯¹ç‹¬ç‰¹æ€§å’Œæ–°æ„çš„æ€è€ƒ" class="headerlink" title="å¯¹ç‹¬ç‰¹æ€§å’Œæ–°æ„çš„æ€è€ƒ"></a>å¯¹ç‹¬ç‰¹æ€§å’Œæ–°æ„çš„æ€è€ƒ</h2><p>é€šç¯‡çœ‹ä¸‹æ¥ï¼Œä½ æ˜¯ä¸æ˜¯æ„Ÿè§‰åˆ°æ•…äº‹æ€§å’ŒçœŸå®æ€§å…¶å®æ˜¯éå¸¸å®¹æ˜“åšåˆ°çš„ã€‚å¯ä»¥ç†è§£ä¸ºåªè¦åŠªåŠ›äº›ï¼Œæ—¶é—´å†é•¿äº›ï¼Œè¿™ä¸¤ç‚¹å°±èƒ½å¤Ÿå®Œæˆï¼Œä¸”èƒ½çº¿æ€§å¾—åˆ°æé«˜ã€‚åªåŸ‹å¤´åšäº‹æƒ…æ¯”è¾ƒå®¹æ˜“å’Œèˆ’é€‚ï¼Œä½†ä¸€ç›´è¿™ä¹ˆå¹²ï¼Œç†µå°±ä¼šè¶Šæ¥è¶Šå¤šï¼Œä¸å¯é€†çš„æ— ç”¨èƒ½é‡æ— æ³•æ’é™¤ã€‚è€Œç‹¬ç‰¹æ€§æ„å‘³ç€ä½ ä¼šå»ä½“éªŒé€‚åº”æ–°çš„ç¯å¢ƒï¼Œå»è·å–å®è·µæ–°çš„è®¤çŸ¥ï¼Œå»ç»“è¯†æ–°çš„æœ‹å‹ç¢°æ’æ–°çš„æ€è·¯ï¼Œä½¿å¾—è‡ªå·±ä½“éªŒåˆ°ä¸åŒä»¥å¾€çš„ç»éªŒã€‚æ–°æ„æˆåŠŸå‡ ç‡å¾ˆä½ï¼Œéçº¿æ€§çš„ï¼Œç±»ä¼¼äºåŸºå› çªå˜äº§ç”Ÿçš„è¿›åŒ–ï¼Œè¿™å’ŒåŠªåŠ›æ— å…³ã€‚æ–°æ„å’Œç‹¬ç‰¹æ€§ä¸€æ ·å±äºé€†ç†µè¿‡ç¨‹ï¼Œä¸èƒ½å¿½è§†ï¼Œå¤§è·¨æ­¥çš„è¿›æ­¥éœ€è¦å¯¹ä¼ ç»Ÿçš„é¢ è¦†ã€‚æ–°æ„ä¼šå¸¦æ¥æ–°çš„ç‹¬ç‰¹ç»å†å½¢æˆä¸€ä¸ªæ–°çš„å¾ªç¯ï¼Œä¸å»å°è¯•å°±ä¸ä¼šæœ‰æ–°çš„æœºä¼šã€‚</p>
<p>å¦‚æœæŠŠæœ¬æ–‡å½“æˆä¸€ç¯‡ç¬”è®°ï¼Œå…¶é—´åˆèå…¥äº†å†™ä½œå¿ƒå¾—ï¼›å¦‚æœæŠŠæœ¬æ–‡å½“åšä¸€ç¯‡å†™ä½œå¿ƒå¾—ï¼Œå…¶é—´åˆç©¿æ’äº†å¤§é‡ç¬”è®°å†…å®¹ã€‚ä½ è¯´è¿™æ˜¯ä¸æ˜¯ä¹Ÿæ˜¯ä¸€ç§æ–°æ„å‘¢ã€‚</p>
<p>å¯¹äºæ–°æ„ï¼Œæˆ‘å°è±¡æœ€æ·±çš„è¿˜æ˜¯æƒåŠ›çš„æ¸¸æˆçš„è¡€è‰²å©šç¤¼ï¼Œç¥æ¥ä¹‹ç¬”ï¼Œå½“Joffreyæ­£æœ€å¯æ°”ï¼Œå°‘ç‹¼ä¸»æ­£å¾—åŠ¿æ—¶ï¼Œå‰§æƒ…å®Œå…¨æ‰“ç ´ä¼ ç»Ÿï¼Œæ•ˆæœéå¸¸éœ‡æ’¼ã€‚å‡¡äººçš†æœ‰ä¸€æ­»ï¼Œå‡¡äº‹çš†æœ‰å¯èƒ½ï¼Œäºæ˜¯ä¹å¯¹åé¢å‰§æƒ…çš„æ¨è¿›æ›´åŠ æœŸå¾…äº†ã€‚è€Œè¿™ä¸ªæ–°æ„æ˜¯å»ºç«‹åœ¨æ•´ä¸ªå‰§å¯¹çœŸå®æ„Ÿä¸Šçš„æ¯«ä¸å«ç³Šï¼ŒåŒ…æ‹¬äº†æ‰å®çš„ä¸–ç•Œè§‚æ„å»ºï¼Œæœé¥°é“å…·é«˜åº¦çš„è¿˜åŸï¼Œå®Œå…¨æŠŠè§‚ä¼—å¸¦å…¥äº†æ•…äº‹ä¸­ã€‚å¦å¤–ä½œè€…å¯¹å¤å†å²çš„ä¸“ç ”å’Œè®°è€…ç»å†çš„ç»“åˆäº§ç”Ÿå‡ºçš„é²œæ˜çš„äººç‰©åˆ»ç”»å’Œç‹¬ç‰¹çš„å‰§æƒ…è®¾è®¡ä¹Ÿæ˜¯æœ¬å‰§çš„éª¨æ¶æ”¯æ’‘ï¼Œç‹¬ç‰¹æ€§çš„ä½“ç°ã€‚</p>
<h2 id="Finally"><a href="#Finally" class="headerlink" title="Finally"></a>Finally</h2><p>ä»Šå¤©æˆ‘è¯´çš„è¿™äº›å¿ƒå¾—å¯ä»¥ä½œä¸ºä¸‹ç¬”â€œè®°å½•å’Œåˆ†äº«â€æŠ€æœ¯çš„ä¸€ä¸ªå¥‘æœºï¼Œä½†æ˜¯å¯¹äºè‡ªå·±æŠ€æœ¯çš„æˆé•¿ï¼Œå†™æ–‡ç« å¹¶ä¸æ˜¯æœ€ç»ˆçš„ç›®çš„ï¼Œå†™ä½œæ˜¯ä½ å¯¹è‡ªå·±æ€æƒ³çš„ç ”ç©¶å’Œå¼€å‘ã€‚æ–‡ç« çš„ä¸Šé™æ˜¯ä½ çš„æŠ€æœ¯èƒ½åŠ›ï¼Œæ–‡ç« åªæ˜¯è®©äººäº†è§£ä½ æŠ€æœ¯ä¸€ç§æ‰‹æ®µã€‚å› æ­¤æ›´é‡è¦çš„æ˜¯ä½ åšçš„æŠ€æœ¯æ˜¯å¦æœ‰çªç ´æœ‰æ¼”è¿›ï¼Œè·å¾—åº”ç”¨ï¼Œå¹¶åœ¨äº§å“ä¸­å–å¾—äº†å¥½çš„æ•ˆæœã€‚è¿˜æœ‰é‚£äº›å­¤ç‹¬ç€ç ”ç©¶æŠ€æœ¯çš„æ—¶å…‰ï¼Œç»å†ç€ä¸€ç›´åŠªåŠ›ç€å¥‹æ–—ç€å´ä¸€ç›´ä¸è¢«çœ‹è§ï¼Œå¾—ä¸åˆ°è®¤åŒï¼Œä¹Ÿæ²¡æœ‰ç»“æœçš„å²æœˆï¼Œè¿˜èƒ½å¤Ÿä¸€ç›´è¢«è‡ªå·±çš„çƒ­æƒ…æ„ŸåŠ¨è€Œä¸æ”¾å¼ƒå»å–å¾—ä¸€ç‚¹ç‚¹è¿›æ­¥å¸¦æ¥çš„æ»¡è¶³æ„Ÿã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;éå¸¸æ„Ÿè°¢å¤§å®¶æŠ½å‡ºç”Ÿå‘½ä¸­å®è´µçš„ä¸€æ®µæ—¶é—´æ¥å¬æˆ‘æ¥ä¸‹æ¥çš„ä¸€å¤§æ®µå…³äºå†™æ–‡ç« é‚£äº›äº‹çš„å” å¨ã€‚å†™æ–‡ç« çš„å¥½å¤„çœ‹çœ‹&lt;a href=&quot;https://movie
    
    </summary>
    
      <category term="Programming" scheme="http://ming1016.github.io/categories/Programming/"/>
    
    
      <category term="iOS" scheme="http://ming1016.github.io/tags/iOS/"/>
    
      <category term="Swift" scheme="http://ming1016.github.io/tags/Swift/"/>
    
      <category term="Apple" scheme="http://ming1016.github.io/tags/Apple/"/>
    
  </entry>
  
  <entry>
    <title>æ·±å…¥å‰–æAuto Layoutçš„å¹»ç¯ç‰‡</title>
    <link href="http://ming1016.github.io/2021/07/13/deeply-analyse-autolayout-slides/"/>
    <id>http://ming1016.github.io/2021/07/13/deeply-analyse-autolayout-slides/</id>
    <published>2021-07-13T06:01:22.000Z</published>
    <updated>2021-07-13T06:10:00.107Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨2015å¹´SegmentFault D-Dayæ´»åŠ¨ä¸Šåˆ†äº«ç”¨çš„å¹»ç¯ç‰‡ï¼Œå‘ç°ä»¥å‰æ²¡æœ‰å‘åˆ°åšå®¢ä¸­ï¼Œç°åœ¨è¡¥ä¸Šã€‚</p>
<p><img src="/uploads/deeply-analyse-autolayout-slides/1.png" alt=""></p>
<p><img src="/uploads/deeply-analyse-autolayout-slides/2.png" alt=""></p>
<p><img src="/uploads/deeply-analyse-autolayout-slides/3.png" alt=""></p>
<p><img src="/uploads/deeply-analyse-autolayout-slides/4.png" alt=""></p>
<p><img src="/uploads/deeply-analyse-autolayout-slides/5.png" alt=""></p>
<p><img src="/uploads/deeply-analyse-autolayout-slides/6.png" alt=""></p>
<p><img src="/uploads/deeply-analyse-autolayout-slides/7.png" alt=""></p>
<p><img src="/uploads/deeply-analyse-autolayout-slides/8.png" alt=""></p>
<p><img src="/uploads/deeply-analyse-autolayout-slides/9.png" alt=""></p>
<p><img src="/uploads/deeply-analyse-autolayout-slides/10.png" alt=""></p>
<p><img src="/uploads/deeply-analyse-autolayout-slides/11.png" alt=""></p>
<p><img src="/uploads/deeply-analyse-autolayout-slides/12.png" alt=""></p>
<p><img src="/uploads/deeply-analyse-autolayout-slides/13.png" alt=""></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨2015å¹´SegmentFault D-Dayæ´»åŠ¨ä¸Šåˆ†äº«ç”¨çš„å¹»ç¯ç‰‡ï¼Œå‘ç°ä»¥å‰æ²¡æœ‰å‘åˆ°åšå®¢ä¸­ï¼Œç°åœ¨è¡¥ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/uploads/deeply-analyse-autolayout-slides/1.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;im
    
    </summary>
    
      <category term="Programming" scheme="http://ming1016.github.io/categories/Programming/"/>
    
    
      <category term="iOS" scheme="http://ming1016.github.io/tags/iOS/"/>
    
      <category term="Autolayout" scheme="http://ming1016.github.io/tags/Autolayout/"/>
    
  </entry>
  
  <entry>
    <title>WWDC 2021 Day1 ç¬”è®°</title>
    <link href="http://ming1016.github.io/2021/06/08/wwdc2021-day1-note/"/>
    <id>http://ming1016.github.io/2021/06/08/wwdc2021-day1-note/</id>
    <published>2021-06-08T08:54:01.000Z</published>
    <updated>2021-06-08T09:59:16.183Z</updated>
    
    <content type="html"><![CDATA[<p>WWDCå¼€å§‹äº†ï¼Œä¸€å‘¨æ—¶é—´ä¼šæœ‰å¤§é‡Sessionå¯å­¦ä¹ ï¼Œè¿™ä¸ªé¡µé¢<a href="https://github.com/twostraws/wwdc">https://github.com/twostraws/wwdc</a> æ”¶é›†äº†æ¥è‡ªç¤¾åŒºçš„å„ç§WWDCæ´»åŠ¨ã€æ–°é—»å’Œæ•™ç¨‹çš„é“¾æ¥ï¼Œéšç€WWDCçš„è¿›è¡Œï¼Œé¡µé¢å†…å®¹ä¼šä¸æ–­æ›´æ–°ï¼Œå»å¹´2020å¹´çš„æ±‡æ€»é¡µåœ¨è¿™é‡Œ<a href="https://github.com/twostraws/wwdc/blob/3d3b093218af06465b6b268b23e13e2ad6e2d9f8/README.md">https://github.com/twostraws/wwdc/blob/3d3b093218af06465b6b268b23e13e2ad6e2d9f8/README.md</a> ã€‚Appleå®˜æ–¹æ”¶é›†çš„å¼€å‘è€…ç»„ç»‡æ´»åŠ¨é¡µé¢æ˜¯<a href="https://developer.apple.com/wwdc21/beyond-wwdc/">https://developer.apple.com/wwdc21/beyond-wwdc/</a> ï¼Œå…¶ä¸­æœ‰SwiftGGç¿»è¯‘ç»„ç»„ç»‡çš„æ´»åŠ¨ï¼Œä»‹ç»é¡µ<a href="https://swift.gg/wwdc/">https://swift.gg/wwdc/</a> ï¼Œä¼šåœ¨æœ¬å‘¨æ¯æ™š8ç‚¹çº¿ä¸Šç›´æ’­äº¤æµWWDC21ä¸­å…³æ³¨åº¦é«˜çš„è¯é¢˜ä»¥åŠlive codingå±•ç¤ºçƒ­ç‚¹æŠ€æœ¯ï¼Œå˜‰å®¾æœ‰å–µç¥ã€æ•…èƒ¤é“é•¿ã€mmoaayã€61ã€é’Ÿé¢–ã€å‘¨æ¥·é›¯ç­‰ã€‚</p>
<p><a href="https://www.wwdcnotes.com/">https://www.wwdcnotes.com/</a> è¿™æ˜¯ä¸€äº›WWDCçš„ç¬”è®°ï¼ˆæ¯”çœ‹è§†é¢‘å¿«ï¼‰æ±‡æ€»ï¼Œå¯ä»¥è®¢é˜…ä»–çš„RSSï¼Œè¿˜åœ¨æ›´æ–°ä¸­</p>
<p>ä¸‹è½½WWDC2021é«˜æ¸…Sessionè§†é¢‘è„šæœ¬ï¼š<a href="https://github.com/dmthomas/AppleVideoDownloadScripts">https://github.com/dmthomas/AppleVideoDownloadScripts</a></p>
<h2 id="ä¸€äº›å…³æ³¨ç‚¹æ”¶é›†"><a href="#ä¸€äº›å…³æ³¨ç‚¹æ”¶é›†" class="headerlink" title="ä¸€äº›å…³æ³¨ç‚¹æ”¶é›†"></a>ä¸€äº›å…³æ³¨ç‚¹æ”¶é›†</h2><ul>
<li>SharePlayï¼ˆä½¿ç”¨Group Activitiesæ¡†æ¶ï¼‰åŒæ­¥å…±äº«è®¾å¤‡ä¸ŠAppçš„æ“ä½œå’Œæ’­æ”¾ </li>
<li>FaceTime on Web </li>
<li>Live Textï¼ˆçœ‹è®²åº§æ—¶å¯ä»¥ç›´æ¥æ‹ç…§æ‹·è´ä»£ç äº†ï¼ŒiPhoneX below not supportï¼‰ </li>
<li>iPadOS å¤šä»»åŠ¡æ„Ÿè§‰æ›´éš¾ç”¨äº† </li>
<li>Notes: Tag browser </li>
<li>Quick Noteï¼ˆæ–¹ä¾¿ï¼‰ </li>
<li>Swift Playgrounds able to build appsï¼ˆSwiftUI onlyï¼‰ï¼ˆLetâ€™s try to build and upload App on iPadï¼‰ </li>
<li>iCloud+ hides ip and location ==? VPNï¼ˆVPN apps:â€Shitâ€ï¼‰ </li>
<li>Craig drove Apple Car? </li>
<li>Universal Control ï¼ˆjust support M1ï¼‰ </li>
<li>ShortCuts for Mac </li>
<li>Object Captureï¼ˆDream comes trueï¼‰ </li>
<li>Actorï¼ˆApple SDKä¼šå¤§é‡ä½¿ç”¨ï¼Œ<a href="/MainActor">@MainActor </a> å±æ€§åŒ…è£… in UIKitï¼ŒBUTï¼ŒSwift Concurrency requires a deployment target of macOS 12, iOS 15, tvOS 15, and watchOS 8 or newer. :( Damn thatâ€™s sadï¼‰  </li>
<li>A/B testing in App Store </li>
<li>Xcode Cloudï¼ˆnot in 99$ï¼ŒBitrise die?ï¼‰å¤šè®¾å¤‡äº‘æµ‹è¯•ï¼ˆæˆªå›¾ï¼‰ã€‚è‡ªå»ºçš„æ„å»ºæµç¨‹å¯ä»¥ä»ä¸­å€Ÿé‰´ã€‚ </li>
<li>TestFlight for the Mac </li>
<li>Xcode 13 has Vim mode </li>
<li>Xcode 13 ä¸€äº›é‡è¦ä¼˜åŒ–å’Œæ–°åŠŸèƒ½ï¼š <ul>
<li>Smarter Swift Code Completion</li>
<li>Faster Swift Builds</li>
<li>Swift Documentation Compiler</li>
</ul>
</li>
<li>To build documentation for your Swift framework or package, choose Product &gt; Build Documentation </li>
<li>SwiftUI gains more control over lower-level drawing primitives with the new Canvas API. </li>
<li>SwiftUI AsyncImage <a href="https://developer.apple.com/documentation/swiftui/asyncimage">https://developer.apple.com/documentation/swiftui/asyncimage</a> </li>
<li><p>List has gained a lot of new capabilities this year: </p>
<ul>
<li>Swipe Actions <a href="https://developer.apple.com/documentation/swiftui/texteditor/swipeactions(edge:allowsfullswipe:content:">https://developer.apple.com/documentation/swiftui/texteditor/swipeactions(edge:allowsfullswipe:content:)?changes=latest_minor</a>?changes=latest_minor)</li>
<li>Pull-to-refresh (with .refreshable(action:)) ï¼ˆjust work with List, not scroll view, bug?ï¼‰ <a href="https://developer.apple.com/documentation/swiftui/texteditor/refreshable(action:">https://developer.apple.com/documentation/swiftui/texteditor/refreshable(action:)?changes=latest_minor</a>?changes=latest_minor)</li>
<li>Separator customization</li>
</ul>
</li>
<li><p>SwiftUI has a new, pretty cool, <strong>debugging</strong> utility to help you understand what is causing a view to be reevaluated. Call <code>Self._printChanges()</code> inside the body of a view to print out the changes that have triggered the view update. </p>
</li>
<li>SwiftUIï¼šMapã€Photoã€ShortCutsã€Weatherã€Apple Payã€Find Mine(WatchOS) </li>
<li>SF Symbols update <a href="https://developer.apple.com/design/human-interface-guidelines/sf-symbols/overview/">https://developer.apple.com/design/human-interface-guidelines/sf-symbols/overview/</a> </li>
<li>AttributedStringï¼šsupport Markdown syntaxï¼Œinit(markdown:options:baseURL:) ï¼ˆyou can delete your hand-rolled markdown parserï¼‰ <a href="https://developer.apple.com/documentation/foundation/attributedstring">https://developer.apple.com/documentation/foundation/attributedstring</a> </li>
<li>HTTP analyzer in Instruments, intriguingï¼ˆCharlesï¼Ÿï¼‰ </li>
<li>Surge works fine on the iOS 15 beta 1. </li>
<li>StoreKit 2 APIs Provide Customer Support </li>
<li>New âŒ˜+Shift+G in Finder </li>
<li>macOS 12 Beta ä¸Šå¾®ä¿¡ä¼šå´© </li>
<li>iOS 15 Beta éå¸¸æµç•…ï¼Œä¹å®«æ ¼é”®ç›˜å¥½ç”¨äº† </li>
<li>UIButton support multiple lines of text </li>
<li>Selective Shader Debugger </li>
<li>Screen Time API å®¶åº­æ§åˆ¶ï¼Œåšé™åˆ¶ </li>
</ul>
<h2 id="ä¸€äº›SwiftUIç›¸å…³Session"><a href="#ä¸€äº›SwiftUIç›¸å…³Session" class="headerlink" title="ä¸€äº›SwiftUIç›¸å…³Session"></a>ä¸€äº›SwiftUIç›¸å…³Session</h2><ul>
<li>Write a DSL in Swift using result builders <a href="https://developer.apple.com/videos/play/wwdc2021/10253/">https://developer.apple.com/videos/play/wwdc2021/10253/</a></li>
<li>Demystify SwiftUI <a href="https://developer.apple.com/videos/play/wwdc2021/10022/">https://developer.apple.com/videos/play/wwdc2021/10022/</a></li>
<li>Discover concurrency in SwiftUI <a href="https://developer.apple.com/videos/play/wwdc2021/10019/">https://developer.apple.com/videos/play/wwdc2021/10019/</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;WWDCå¼€å§‹äº†ï¼Œä¸€å‘¨æ—¶é—´ä¼šæœ‰å¤§é‡Sessionå¯å­¦ä¹ ï¼Œè¿™ä¸ªé¡µé¢&lt;a href=&quot;https://github.com/twostraws/wwdc&quot;&gt;https://github.com/twostraws/wwdc&lt;/a&gt; æ”¶é›†äº†æ¥è‡ªç¤¾åŒºçš„å„ç§WWDCæ´»åŠ¨ã€æ–°é—»å’Œæ•™ç¨‹çš„é“¾
    
    </summary>
    
      <category term="Programming" scheme="http://ming1016.github.io/categories/Programming/"/>
    
    
      <category term="iOS" scheme="http://ming1016.github.io/tags/iOS/"/>
    
      <category term="Swift" scheme="http://ming1016.github.io/tags/Swift/"/>
    
      <category term="Apple" scheme="http://ming1016.github.io/tags/Apple/"/>
    
  </entry>
  
  <entry>
    <title>Aç«™ çš„ Swift å®è·µ</title>
    <link href="http://ming1016.github.io/2021/05/22/acfun-swift-practice/"/>
    <id>http://ming1016.github.io/2021/05/22/acfun-swift-practice/</id>
    <published>2021-05-22T10:16:12.000Z</published>
    <updated>2021-06-05T12:38:59.371Z</updated>
    
    <content type="html"><![CDATA[<p>æ–‡ç« å·²å‘åœ¨å¿«æ‰‹å¤§å‰ç«¯å…¬ä¼—å·ï¼Œæ¬¢è¿å…³æ³¨ï¼Œæ–‡ç« åœ°å€å¦‚ä¸‹ï¼š</p>
<ul>
<li><a href="https://mp.weixin.qq.com/s/rUZ8RwhWf4DWAa5YHHynsQ">Aç«™ çš„ Swift å®è·µ â€”â€” ä¸Šç¯‡</a></li>
<li><a href="https://mp.weixin.qq.com/s/EIPHLdxBMb5MiRDDfxzJtA">Aç«™ çš„ Swift å®è·µ â€”â€” ä¸‹ç¯‡</a></li>
</ul>
<p>æ–°æ–‡ç« å†™å¾—è´¼ç´¯ã€‚å®Œç¾é”™è¿‡äº†ä¸€è§ˆç¥–å›½å¤§å¥½äººæµ·çš„æœºä¼šï¼ŒTIANROASTğŸ¦”å’–å•¡ä¹Ÿæ²¡å–æˆï¼Œæ–°ä¹°Switchæ€ªç‰©çŒäººå´›èµ·ä¹Ÿä»…é™äºç‚ç«æ‘ã€‚å¦‚æœå–œæ¬¢çš„è¯ï¼Œæ±‚è½¬å‘ã€â€œåœ¨çœ‹â€å’Œä¸€ä¸ªå¤§å¤§çš„èµã€‚</p>
<p>ä¸‹é¢æ˜¯æ­£æ–‡å†…å®¹ï¼Œæˆ‘è½¬åˆ°åšå®¢é‡Œæ¥ã€‚</p>
<h2 id="èƒŒæ™¯ä»‹ç»"><a href="#èƒŒæ™¯ä»‹ç»" class="headerlink" title="èƒŒæ™¯ä»‹ç»"></a>èƒŒæ™¯ä»‹ç»</h2><p><img src="/uploads/acfun-swift-practice/01.png" alt=""></p>
<p>AcFunä¿—ç§°ä¸ºâ€œAç«™â€ï¼Œä½œä¸ºä¸€æ¬¾äºŒæ¬¡å…ƒå†…å®¹ç¤¾åŒºäº§å“ï¼Œä»¥â€œè®¤çœŸä½ å°±è¾“äº†â€ä¸ºæ–‡åŒ–å¯¼å‘ï¼Œå€¡å¯¼è½»æ¾æ¬¢å¿«çš„äºšæ–‡åŒ–ã€‚AcFunæ¶µç›–äº†ä¸­é•¿è§†é¢‘ï¼Œå°è§†é¢‘ï¼Œç•ªå‰§ï¼Œæ–‡ç« ç­‰ä¼—å¤šå†…å®¹ï¼Œæ”¯æ’‘è¿™äº›å†…å®¹çš„å¤§éƒ¨åˆ†åŠŸèƒ½éƒ½é€‰æ‹©äº†ç”¨Swiftå¼€å‘ï¼Œæ—©åœ¨2019å¹´ï¼ŒAcFunçš„iOSæŠ€æœ¯å›¢é˜Ÿå°±å·²å°†Swiftä½œä¸ºAcFun appå’Œæ°´æ¯appçš„å¼€å‘é¦–é€‰è¯­è¨€ã€‚Swiftçš„å‡ºç°ä¸ºç”¨æˆ·æä¾›äº†æ›´ç¨³å®šçš„ä½¿ç”¨ä½“éªŒå’Œæ›´å¿«çš„äº§å“æ›´æ–°èŠ‚å¥ï¼ŒåŒæ—¶ä¹Ÿä¸ºç ”å‘å·¥ç¨‹å¸ˆåˆ›é€ äº†æ›´é«˜æ•ˆèˆ’é€‚çš„å¼€å‘ä½“éªŒã€‚Objective-Cå·²æˆè¿‡å»æ—¶ï¼ŒAcFunæ­£å…¨é¢æ‹¥æŠ±Swiftï¼Œé©¶å…¥iOSå¼€å‘å¿«è½¦é“ã€‚</p>
<h3 id="è‹¹æœæ¨å‡ºSwiftçš„åŸå› "><a href="#è‹¹æœæ¨å‡ºSwiftçš„åŸå› " class="headerlink" title="è‹¹æœæ¨å‡ºSwiftçš„åŸå› "></a>è‹¹æœæ¨å‡ºSwiftçš„åŸå› </h3><p>è°·æ­Œä½œä¸ºè‹¹æœæœ€å¤§çš„ç«äº‰å¯¹æ‰‹ï¼Œé™¤äº†Androidä¸Šçš„Kotlinï¼Œè¿˜æ¨å‡ºäº†Flutterå’ŒFuchsiaé‡Œåœ¨ç”¨çš„Dartè¯­è¨€ï¼Œè¿™äº›è¯­è¨€çš„å£ç¢‘å’Œæ˜“ç”¨æ€§è¿œé«˜äºè‹¹æœçš„Objective-Cï¼ˆåé¢ç®€ç§°OCï¼‰ã€‚OCå†å²ä¹…è¿œï¼Œæ˜¯Cè¯­è¨€çš„è¶…é›†ï¼Œå› æ­¤å…¶å‘å±•å—Cè¯­è¨€é™åˆ¶ã€‚åœ¨è¿™æ ·çš„èƒŒæ™¯ä¸‹ï¼Œå¤§å®¶éƒ½ä»¥ä¸ºè‹¹æœä¼šå¿½è§†å…¶å®ƒæ–°è¯­è¨€ï¼Œä½†å…¶å®è‹¹æœå¯¹äºé‚£äº›æ–°è¯­è¨€ç‰¹æ€§å‚æ¶å·²ä¹…ï¼Œå°†æƒ³æ³•æ–½äºè¡ŒåŠ¨çš„æ˜¯å½“æ—¶è¿˜åœ¨è‹¹æœçš„<em> Chris Lattner</em>ã€‚<em>Chris</em>æ˜¯ç‹‚çƒ­çš„ç¼–è¯‘å™¨å’Œç¼–ç¨‹è¯­è¨€çˆ±å¥½è€…ï¼ŒCã€C++ã€OCè¯­è¨€ç¼–è¯‘å™¨LLVMçš„åˆ›é€ è€…ï¼Œåœ¨LLVMå¼€å‘è¿‡ç¨‹ä¸­ï¼ŒChriså¯¹ç±»Cè¯­è¨€æœ‰ç€å¾ˆå¤šä¸æ»¡æ„çš„åœ°æ–¹ï¼Œæ¯”å¦‚é¢„å¤„ç†å™¨ã€Trigraphsè¿˜æœ‰å¤šå¹´ç§¯ç´¯çš„å¥‡æ€ªä¸œè¥¿ã€‚</p>
<p>ä¸ºäº†èƒ½å¤Ÿå…¼é¡¾ç±»ä¼¼Reactä¸€æ ·çš„ç¼–ç¨‹èŒƒå¼å’Œå…·å¤‡Javaç­‰æ­£æµè¡Œçš„è¯­è¨€çš„ä¼˜ç§€ç‰¹æ€§ï¼ŒSwiftç»å†äº†é•¿æœŸçš„ABIç¨³å®šå’Œè¯­è¨€ç‰¹æ€§è¿­ä»£å¢åŠ çš„è¿‡ç¨‹ï¼Œæœ€ç»ˆæ¨å‡ºäº†èƒ½å’ŒJSXå£°æ˜å¼UIåŒ¹æ•Œçš„Result Buildersï¼Œå¹¶ä¸”é€šè¿‡SwiftUIå’ŒCombineè¿™ç§èƒ½æå¤§æå‡å¼€å‘æ•ˆç‡çš„æ¡†æ¶è®©å¼€å‘è€…æ”¶è·äº†æƒŠå–œã€‚</p>
<p>å¯èƒ½æ˜¯Swiftçš„ABIç¨³å®šå¾—å¤ªæ™šï¼Œä¸æ­¢å„å¤§APPé‡Œå·²ç»ç§¯ç´¯äº†å¤§é‡çš„OCåº“å’Œä¸šåŠ¡ä»£ç ï¼Œè‹¹æœç³»ç»Ÿé‡Œçš„OCå æ¯”ä¹Ÿä¾ç„¶å¾ˆé«˜ï¼Œ<a href="https://blog.timac.org/2020/1019-evolution-of-the-programming-languages-from-iphone-os-to-ios-14/"><em>åšå®¢ã€ŠEvolution of the programming languages from iPhone OS 1.0 to iOS 14ã€‹ </em></a>ç»Ÿè®¡äº† iOS å†å²ç‰ˆæœ¬ OC å æ¯”ï¼Œä»æ–‡ç« ä¸­å¯ä»¥çœ‹åˆ°æœ€è¿‘çš„iOS 14ç‰ˆæœ¬é‡ŒOCå æ¯”é«˜è¾¾88%ï¼ŒCå’ŒC++ä¸»è¦ç”¨äºéŸ³è§†é¢‘ã€ç”µè¯ã€ç½‘ç»œç­‰æ¯”è¾ƒåŸºç¡€çš„æ¨¡å—ï¼Œå…¶å æ¯”ç›¸å¯¹ç¨³å®šï¼Œç‰¹åˆ«æ˜¯Cå¹¶æ²¡æœ‰æ˜æ˜¾å¢åŠ ã€‚ä¸è¿‡åœ¨æœ€è¿‘å‡ ä¸ªç‰ˆæœ¬ä¸­ï¼ŒSwiftå æ¯”æŒç»­å¢é«˜ï¼ŒiOS 14è¾¾åˆ°äº†8%ï¼Œå¯ä»¥çœ‹å‡ºè‹¹æœæ­£åœ¨ä½¿ç”¨Swifté‡æ„ä»¥å‰çš„åº“ã€‚</p>
<h3 id="è‹¹æœå®é™…é‡‡å–çš„è¡ŒåŠ¨"><a href="#è‹¹æœå®é™…é‡‡å–çš„è¡ŒåŠ¨" class="headerlink" title="è‹¹æœå®é™…é‡‡å–çš„è¡ŒåŠ¨"></a>è‹¹æœå®é™…é‡‡å–çš„è¡ŒåŠ¨</h3><p>ä¸ºäº†è®©å¹¿å¤§å¼€å‘è€…èƒ½å¤Ÿç”¨ä¸Šæ›´æ–¹ä¾¿å®‰å…¨çš„Swiftï¼Œè‹¹æœé‡‡å–äº†ä¸€ç³»åˆ—å®é™…è¡ŒåŠ¨ã€‚æ¯”å¦‚ä¸å†ç»™OCæ–°åŠ æ¥å£ï¼Œè€Œæ˜¯ç”¨Swiftæ›¿æ¢SDKï¼ŒWWDC17ä¹‹åå°±å·²ç»çœ‹ä¸åˆ°OCçš„ä¾‹å­äº†ï¼Œè‹¹æœä¸»æ¨çš„ä¸€äº›å‰æ²¿æŠ€æœ¯ï¼Œæ¯”å¦‚ARã€AIã€Healthç­‰ï¼Œåœ¨æ–°ç‰ˆé‡Œä¹Ÿéƒ½åªæœ‰Swiftç‰ˆæœ¬ã€‚æ‰€ä»¥ï¼Œåœ¨æœªæ¥çš„å‘å±•ä¸­ï¼Œä¼ä¸šä¸è€ƒè™‘Swiftæˆ–æ˜¯ç¼ºå°‘Swiftäººæ‰ï¼Œéƒ½å°†ä¼šå½±å“åˆ°æ–°æŠ€æœ¯çš„å¼•å…¥ã€‚</p>
<p>å¦å¤–ï¼Œè‹¹æœçš„RealityKitã€CareKitã€Create MLã€Systemã€WidgetKitã€CryptoKitã€Combineã€SwiftUIç­‰æ¡†æ¶åœ¨ä¸OCæ··ç¼–æ—¶éƒ½éå¸¸å›°éš¾ï¼Œä»è¿™äº›æ–¹é¢å¯ä»¥çœ‹å‡ºï¼Œè‹¹æœæ‰€æœ‰æ–°å¼€å‘çš„æ¡†æ¶éƒ½åœ¨é¿å…å’ŒOCäº§ç”Ÿå…³ç³»ï¼Œç”šè‡³è‡ªWWDC2020èµ·æ–°å¢åŠ çš„App Widgetåªèƒ½ç”¨SwiftUIå¼€å‘ã€‚</p>
<p>å¯¹äºè‹¹æœä¸€ç³»åˆ—çš„è¡ŒåŠ¨ï¼Œç¤¾åŒºä¸ä¹‹å¯¹åº”çš„ååº”æ˜¯æ²¡æœ‰çƒ­æƒ…å»å›ç­”OCçš„Bugäº†ï¼Œå› ä¸ºæœ‰äº†æ›´å¥½çš„è¿½æ±‚ã€‚OCä¸‰æ–¹åº“ä½œè€…ä¹Ÿæ²¡æœ‰ç»´æŠ¤çš„æ„æ„¿ï¼Œæ›´æ–°å‘¨æœŸæ¯”Swifté•¿å¾ˆå¤šï¼Œæ¯”å¦‚å¤§å®¶éƒ½çŸ¥é“çš„OCç½‘ç»œåº“AFNetworkingï¼Œæœ€æ–°ç‰ˆæœ¬æ›´æ–°ç”¨äº†2å¹´å¤šæ—¶é—´ï¼Œè€Œè¯¥ä½œè€…ç”¨Swiftå¼€å‘çš„å¯¹åº”çš„ç½‘ç»œåº“Alamofireï¼Œæ›´æ–°é¢‘ç‡æ¥è¿‘åŠä¸ªæœˆï¼Œä½œè€…å¯¹Swiftçš„çƒ­æƒ…å¯è§ä¸€æ–‘ã€‚</p>
<p>iOSå¼€å‘é¦–é€‰è¯­è¨€ä¹Ÿæ˜¯Swiftï¼Œä»¥åå¯èƒ½ä¼šé¢ä¸´OCå·¥ç¨‹å¸ˆåç»§æ— äººçš„å±€é¢ï¼Œç‰©ä»¥ç¨€ä¸ºè´µï¼ŒOCå¼€å‘è€…çš„æˆæœ¬ä¹Ÿä¼šå¤§å¢ã€‚ä½¿ç”¨Swiftç›¸å…³æŠ€æœ¯æ ˆçš„å›¢é˜Ÿåœ¨å¸å¼•äººæ‰æ–¹é¢ä¹Ÿå­˜åœ¨ä¸€å®šä¼˜åŠ¿ï¼ŒAcFunçš„å·¥ç¨‹å¸ˆç”°èµ›åŒå­¦æ­¤å‰é€‰æ‹©äº†å¿«æ‰‹ï¼Œè€Œæ‹’ç»äº†å¦å¤–ä¸€å®¶å…¬å¸çš„offerï¼Œä¸€ä¸ªé‡è¦å› ç´ å°±æ˜¯AcFunå¯ä»¥ä½¿ç”¨Swiftå¼€å‘ã€‚AcFunçš„iOSå¼€å‘å·¥ç¨‹å¸ˆå…³æ—­èˆªè¯´ï¼šâ€œèµ·åˆæˆ‘ä»¬å›¢é˜Ÿåœ¨ä¸šåŠ¡å¼€å‘ä¸­æ¢ç´¢Swiftæ—¶ï¼Œå¯¹Swiftä¸å¤Ÿç†Ÿæ‚‰ï¼Œå¹¶ä¸æ•¢ä¸»åŠ¨å°è¯•ä½¿ç”¨ï¼Œé€šè¿‡ç»„å†…çš„åŸ¹è®­ä»¥åŠä¸šä½™æ—¶é—´çš„å­¦ä¹ ï¼Œæˆ‘å¯¹è¿™é—¨è¯­è¨€è¶Šæ¥è¶Šæ„Ÿå…´è¶£ï¼Œçœ‹åˆ°å…¶ä»–åŒå­¦å†™çš„Swiftä»£ç æ—¢ç®€æ´åˆæ˜“æ‡‚ï¼Œæˆ‘ä¹Ÿæ…¢æ…¢å¼€å§‹å°è¯•ä½¿ç”¨ï¼Œç°åœ¨æˆ‘å·²ç»ä¸æƒ³å†™Objective-Cäº†â€ã€‚</p>
<p>æŒ‰ç…§ç›®å‰è¿™ä¸ªè¶‹åŠ¿ï¼Œä½¿ç”¨SwiftåŠ¿åœ¨å¿…è¡Œã€‚</p>
<h3 id="Swiftåœ¨AcFunçš„æ¼”è¿›"><a href="#Swiftåœ¨AcFunçš„æ¼”è¿›" class="headerlink" title="Swiftåœ¨AcFunçš„æ¼”è¿›"></a>Swiftåœ¨AcFunçš„æ¼”è¿›</h3><p>2019å¹´AcFunå®Œæˆäº†Swiftçš„è°ƒç ”å’ŒåˆæœŸåŸºç¡€è®¾æ–½å»ºè®¾ï¼Œå›¢é˜ŸSwiftåŸ¹è®­ä»¥åŠä¸šåŠ¡çš„è¯•ç‚¹ã€‚åœ¨Swiftè°ƒç ”æ¢ç´¢è¿‡ç¨‹ä¸­ï¼ŒAcFunå¼€å‘åŒå­¦ä½“éªŒåˆ°äº†Swiftçš„ä¼˜é›…ã€ç²¾ç®€ä»¥åŠå®‰å…¨ï¼Œä¹Ÿç»å†æ··ç¼–æ„å»ºæ—¶é—´é•¿å’Œä»£ç è¡¥å…¨æ…¢ç­‰é—®é¢˜ã€‚å…¶ä¸­æ„å»ºé—®é¢˜åªè¦éµå¾ªå®˜æ–¹Moduleçš„æœ€ä½³å®è·µå°±å¯ä»¥è§„é¿ï¼Œä»£ç è¡¥å…¨é—®é¢˜åœ¨Xcode12ä¸­å¾—åˆ°äº†å¾ˆå¥½çš„æ”¹å–„ã€‚2020å¹´ä¸ŠåŠå¹´AcFunå¼€å§‹äº†æ··ç¼–å·¥ç¨‹ä¼˜åŒ–ã€ç»„ä»¶åŒ–ä»¥åŠäºŒè¿›åˆ¶åŒ–å»ºè®¾ï¼Œå€ŸLLVM ModuleæŠ¹å¹³æ¨¡å—APIåœ¨è¯­è¨€ä¸Šçš„å·®å¼‚ï¼ŒåŸºç¡€åº“è¿›è¡Œäº†ModuleåŒ–é—®é¢˜ä¿®å¤ï¼Œå¹¶åŸºäºä¸»ç«™äºŒè¿›åˆ¶åŒ–æ–¹æ¡ˆï¼Œå®Œå–„äº†å¯¹Swiftæ··ç¼–çš„æ”¯æŒã€‚ç›®å‰äºŒè¿›åˆ¶åŒ–ç‡ä¸º80%ï¼Œçº¦50%çš„ç»„ä»¶å®Œæˆäº†LLVM ModuleåŒ–ï¼Œæ„å»ºé€Ÿåº¦æå‡äº†60%ä»¥ä¸Šã€‚</p>
<p>AcFun å½“å‰çš„ Swift &amp; OC æ··ç¼–æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚Infraå±‚åŒ…å«è‡ªç ”åŸºç¡€åº“ã€å¿«æ‰‹ç³»ä¸­å°SDKä»¥åŠç¬¬ä¸‰æ–¹åº“ã€‚Business Supportå±‚ä¸ºå„ä¸šåŠ¡Featureæä¾›é€šç”¨ä¸šåŠ¡æ”¯æ’‘ã€‚Business Moduleså±‚åŒ…å«å½“å‰å·²å®Œæˆè§£è€¦å’ŒModuleåŒ–çš„ä¸šåŠ¡æ¨¡å—ï¼Œæ¨¡å—ä¹‹é—´é€šè¿‡ä¾èµ–æ³¨å…¥å®¹å™¨å’Œè·¯ç”±è¿›è¡Œé€šä¿¡ã€‚å½“å‰Main Targetä¸­ä»ç„¶å­˜åœ¨å°šæœªè§£è€¦çš„æ··ç¼–ä»£ç ï¼ŒOC å’Œ Swift ä¹‹é—´é€šè¿‡æ¡¥æ¥è¿›è¡Œäº¤äº’ï¼Œå¦å¤–æœ‰ä¸€äº›å°šæœªModuleåŒ–çš„OCåŸºç¡€åº“ä»ç„¶éœ€è¦é€šè¿‡Bridging Headeræ¡¥æ¥ç»™Swiftä½¿ç”¨ã€‚è¿™äº›æ¡¥æ¥æ˜¯å½±å“ç¼–è¯‘æ—¶é—´ä»¥åŠä»£ç è¡¥å…¨é€Ÿåº¦çš„ä¸»è¦å› ç´ ã€‚</p>
<p><img src="/uploads/acfun-swift-practice/02.png" alt=""></p>
<p>éšç€æ¶æ„çš„æ¼”è¿›å’Œç»„ä»¶åŒ–çš„æ¨è¿›ï¼Œæœªæ¥ç†æƒ³ç›®æ ‡æ¶æ„æ„¿æ™¯å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚Infra å’Œ Business Support å±‚ä¸ºä¸šåŠ¡æä¾›æ›´å®Œæ•´çš„åŸºç¡€å’Œé€šç”¨ä¸šåŠ¡æ”¯æ’‘ï¼Œä¸šåŠ¡æ¨¡å—å…¨é¢è§£è€¦ã€ModuleåŒ–å’ŒäºŒè¿›åˆ¶åŒ–ï¼Œç»„ä»¶å‡ä»¥Moduleçš„å½¢å¼ç»„ç»‡å’Œèšåˆï¼ŒMain Target å®ç°å£³å·¥ç¨‹åŒ–ã€‚</p>
<p><img src="/uploads/acfun-swift-practice/03.png" alt=""></p>
<p>ç›®å‰AcFunçš„Swiftæ–‡ä»¶æ•°å å·¥ç¨‹æ€»æ•°40%ä¹‹å¤šï¼Œå´©æºƒç‡å‡å°‘äº†52%ã€‚AcFuné‡‡ç”¨æ··ç¼–åï¼Œæ€§èƒ½æ–¹é¢ï¼Œæ¯”å¦‚å¯åŠ¨æ—¶é—´ã€é¡µé¢æµç•…åº¦ã€å†…å­˜ã€CPU/GPUè´Ÿè½½ç­‰æ–¹é¢å·®åˆ«ä¸å¤§ã€‚AcFunçš„QAè´Ÿè´£äººé‚µå›½å¼ºä¸ç¦æ„Ÿå¹ï¼šâ€œAcFunçš„ç§»åŠ¨ç«¯ç ”å‘åŒå­¦å¼€å§‹æ¢ç´¢Swiftæ—¶ï¼ŒQAå›¢é˜Ÿèµ·åˆæ²¡æœ‰æ˜æ˜¾æ„ŸçŸ¥ï¼Œä½†éšç€ç ”å‘å›¢é˜ŸSwiftå»ºè®¾çš„æ¨è¿›ï¼Œå‘ç‰ˆé¢‘ç‡ä¹Ÿæé€Ÿåˆ°å•å‘¨ä»¥åï¼Œç ”å‘åŒå­¦èƒ½æŒç»­é«˜è´¨é‡äº¤ä»˜ï¼ŒçœŸæ˜¯å¤ªæ£’äº†ã€‚â€</p>
<p>Swiftçš„å†…å­˜ç®¡ç†æ˜¯é€šè¿‡ä¸¥æ ¼çš„ã€ç¡®å®šæ€§çš„å¼•ç”¨è®¡æ•°æ¥è‡ªåŠ¨ç®¡ç†çš„ï¼Œå¯ä»¥å°†å†…å­˜çš„ä½¿ç”¨é‡é™åˆ°æœ€ä½ï¼Œè¿˜å¯ä»¥é¿å…åƒåœ¾æ”¶é›†åœ¨é”™è¯¯çº¿ç¨‹ä½¿ç”¨Finalizerï¼Œæ‰§è¡Œå¤šæ¬¡ä¸èƒ½ç®¡ç†æ•°æ®åº“å¥æŸ„ä¹‹ç±»èµ„æºçš„é—®é¢˜ã€‚ARCçš„Retainå’ŒReleaseå¼€é”€åœ¨åƒåœ¾æ”¶é›†é‡Œä¹Ÿä¼šæœ‰ï¼Œæ¯”å¦‚åœ¨å­˜å‚¨ä¸€ä¸ªå¯¹è±¡å±æ€§æ—¶ç”¨Write Barrierã€‚ARCçš„ç®—æ³•ç±»ä¼¼Goçš„Tricolorç®—æ³•ã€‚åƒåœ¾å›æ”¶è¿˜ä¼šç§»åŠ¨å’Œå‹ç¼©å¯¹è±¡ï¼Œå¦‚æœè°ƒç”¨Cä»£ç ï¼Œå¯èƒ½è¿˜ä¼šå¾—åˆ°ä¸€ä¸ªDangling Pointerï¼Œæ¯”å¦‚JNIï¼Œå°±æ˜ç¡®éœ€è¦å¼•å…¥å’Œç»´æŠ¤å¯¹è±¡ï¼Œæ— å½¢ä¸­å¢åŠ äº†å¤æ‚åº¦ï¼Œè¿˜å¾ˆå®¹æ˜“å‡ºé—®é¢˜ã€‚</p>
<p>åœ¨atpæ’­å®¢205æœŸèŠ‚ç›®ä¸­ <a href="https://atp.fm/205-chris-lattner-interview-transcript"><em>Episode 205: Chris Lattner Interview Transcript</em></a>ï¼ŒChris Lattner æŒ‡å‡ºOCä¹‹æ‰€ä»¥ä¸å®‰å…¨çš„åŸå› æ˜¯å› ä¸ºOCæ˜¯åŸºäºCè¯­è¨€ï¼Œæœ‰æŒ‡é’ˆï¼Œæœ‰ä¸å®Œå…¨åˆå§‹åŒ–çš„å˜é‡ï¼Œä¼šæ•°ç»„è¶Šç•Œï¼Œå³ä½¿å¯¹å·¥å…·é“¾å’Œç¼–è¯‘å™¨æœ‰å®Œå…¨çš„æ§åˆ¶æƒï¼Œä¹Ÿæ— æ³•å¾ˆå¥½åœ°è§£å†³ä»¥ä¸Šçš„é—®é¢˜ï¼Œè§£å†³Dangling Pointerå°±éœ€è¦è§£å†³ç”Ÿå‘½å‘¨æœŸé—®é¢˜ï¼Œè€ŒCæ²¡æœ‰ä¸€ä¸ªæ¡†æ¶èƒ½è§£å†³ï¼Œæ”¹æˆå…¼å®¹æ–¹å¼è¿›å…¥ç³»ç»Ÿä¹Ÿæ˜¯è¡Œä¸é€šçš„ã€‚å› æ­¤è‹¹æœå›¢é˜Ÿç»è¿‡æ€è€ƒï¼Œå†³å®šåˆ›å»ºä¸€é—¨â€œå®‰å…¨â€çš„ç¼–ç¨‹è¯­è¨€ï¼Œè¿™ç§å®‰å…¨ä¸æ­¢æ˜¯æŒ‡æ²¡æœ‰Bugï¼Œè€Œæ˜¯åœ¨ä¿æŒå®‰å…¨çš„åŒæ—¶è¿˜èƒ½å¤Ÿä¿è¯é«˜æ€§èƒ½ï¼Œè¿›è€Œæ¨åŠ¨æ•´ä¸ªç¼–ç¨‹æ¨¡å‹å‰è¿›ã€‚</p>
<p>Swiftæ¶ˆé™¤äº†æ•´ä¸ªç±»åˆ«çš„ä¸å®‰å…¨ä»£ç ã€‚å˜é‡åœ¨ä½¿ç”¨å‰æ€»æ˜¯è¢«åˆå§‹åŒ–ï¼Œæ•°ç»„å’Œæ•´æ•°ä¼šè¢«æ£€æŸ¥æ˜¯å¦æœ‰æº¢å‡ºï¼Œå†…å­˜ä¼šè¢«è‡ªåŠ¨ç®¡ç†ï¼Œå¯¹å†…å­˜çš„ç‹¬å è®¿é—®å¯ä»¥é˜²æ­¢è®¸å¤šç¼–ç¨‹é”™è¯¯ã€‚</p>
<p>Swiftæœ‰é™æ€è°ƒåº¦å®‰å…¨çš„ç‰¹æ€§ï¼Œæ¯”Cè¯­è¨€æ›´å®‰å…¨ï¼Œå¾ˆå¤šé—®é¢˜èƒ½åœ¨ç¼–è¯‘æ—¶æå‰å‘ç°ã€‚ä»£ç ä¸­å‘ç”Ÿå†…å­˜æº¢å‡ºï¼Œç¼–è¯‘å™¨ä¼šå‘å‡ºè¯Šæ–­ä¿¡æ¯ï¼Œæ¯”å¦‚å¸¸é‡ä¸­çš„å†…å­˜æº¢å‡ºå¾ˆéš¾æŸ¥ã€‚æ•°ç»„è¶Šç•Œæ£€æŸ¥ï¼Œè¿˜æœ‰å‡½æ•°è¿”å›å¯è¾¾æ€§æ£€æµ‹ï¼Œç¡®ä¿è¿”å›å€¼å’Œå‡½æ•°å®šä¹‰çš„ç±»å‹ä¸€è‡´ã€‚</p>
<p>ç¼–è¯‘å™¨ä¸­çš„ç±»å‹å®‰å…¨æ€§å¯ä»¥è®©é—®é¢˜æ›´æ—©æš´éœ²ã€‚ä¾‹å¦‚Swift Optionalçš„è®¾è®¡åœ¨ç¼–è¯‘æœŸé˜»æ–­äº†ç©ºå€¼è®¿é—®ï¼Œåˆå¦‚åˆ©ç”¨èŒƒå‹ç±»å‹æ¨å¯¼åœ¨ç¼–è¯‘æœŸæä¾›çº¦æŸï¼Œä»è€Œé¿å…Unsafe Type Castingã€‚æ°´æ¯çš„ç ”å‘å·¥ç¨‹å¸ˆèµµèµ«åœ¨ä½¿ç”¨Swiftè¿‡ç¨‹ä¸­ï¼Œå‘ç°ä»£ç ä¸­çš„å¾ˆå¤šé—®é¢˜å’Œéšæ‚£éƒ½å¯ä»¥åœ¨ç¼–è¯‘æœŸæš´éœ²å‡ºæ¥ï¼Œåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä»£ç åªè¦èƒ½ç¼–è¯‘é€šè¿‡ï¼Œè¿è¡Œæ•ˆæœå°±ä¸ä¼šç¦»é¢„æœŸæœ‰å¾ˆå¤§çš„åå·®ï¼Œè¿™è®©ä»–å¯¹å…¶ä»£ç äº¤ä»˜è´¨é‡æ›´åŠ å……æ»¡ä¿¡å¿ƒã€‚</p>
<h3 id="Swiftè¯­è¨€çš„æ¼”è¿›"><a href="#Swiftè¯­è¨€çš„æ¼”è¿›" class="headerlink" title="Swiftè¯­è¨€çš„æ¼”è¿›"></a>Swiftè¯­è¨€çš„æ¼”è¿›</h3><p>Swiftçš„æ¼”è¿›æ¯”è¾ƒç¨³å®šï¼Œå¹¶æ²¡æœ‰åœ¨åˆæœŸç‰ˆæœ¬ä¸€è‚¡è„‘æŠŠç‰¹æ€§éƒ½åŠ ä¸Šï¼Œè€Œæ˜¯æ¯ä¸ªç‰ˆæœ¬è¿­ä»£å¢åŠ ç‰¹æ€§ã€‚æ¼”è¿›ä¹‹è·¯å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/uploads/acfun-swift-practice/04.png" alt=""></p>
<p>Swiftç¬¬ä¸€ä¸ªç‰ˆæœ¬æ¨å‡ºäº†åŸºæœ¬è¯­æ³•ï¼ŒSwift2.0ä¸»è¦æ˜¯å°†æ³›å‹å’Œåè®®èƒ½åŠ›åšäº†æå‡ï¼Œå¹¶å¯¹Linuxè¿›è¡Œäº†æ”¯æŒï¼Œåç«¯æ¡†æ¶Vaporå’ŒPerfectä¹Ÿæ˜¯åœ¨Swift2.0æ—¶å‡ºç°çš„ï¼ŒSwiftä¹Ÿæ˜¯åœ¨è¿™ä¸ªç‰ˆæœ¬å¼€æºçš„ã€‚Swift3.0å‡ºäº†Swift Package Managerï¼Œå¯¹æ ‡å‡†åº“APIè¿›è¡Œäº†é‡æ–°çš„è®¾è®¡ã€‚4.0 æ¨å‡ºCodableåè®®å’ŒKey pathã€‚5.0ç»ˆäºABIç¨³å®šï¼ŒSwiftè¿è¡Œæ—¶å†…ç½®åˆ°äº†iOS12ç³»ç»Ÿé‡Œã€‚5.1ç‰ˆæœ¬æ¨å‡ºäº†è®©å¤§å®¶æ„Ÿåˆ°è‹¹æœæ´»åŠ›çš„SwiftUIå’ŒCombineï¼Œæ–°å¢äº†ä¸€å¤§å †å›´ç»•æå‡å¼€å‘èˆ’é€‚åº¦çš„Property Wrapperã€Opaque Typeç­‰è¯­è¨€ç‰¹æ€§ï¼Œéšä¹‹ï¼Œç¤¾åŒºå¼€å§‹å¼‚å¸¸æ´»è·ƒèµ·æ¥ï¼Œä¸ä¹‹å¯¹åº”çš„æŠ€æœ¯æ–‡ç« å¤§é‡è¾“å‡ºã€‚AcFunå°±ä½¿ç”¨äº†5.1ç‰ˆæœ¬çš„Property WrapperåŒ…è£…äº†UserDefaultsï¼ŒCodableï¼ŒRxSwift Relayç­‰ï¼Œä¸šåŠ¡å¼€å‘è¿‡ç¨‹ä¸­é¿å…é›·åŒä»£ç çš„ç¼–å†™ã€‚</p>
<p>Swift 6çš„ <a href="https://forums.swift.org/t/on-the-road-to-swift-6/32862"><em>Roadmap</em></a><em> </em>è¡¨æ˜äº†Swiftä¸‹ä¸€æ­¥å‘å±•æ–¹å‘æ˜¯ä¼˜åŒ–Swiftéƒ¨ç½²å®‰è£…ï¼Œæ¯”å¦‚LSPå’ŒåŒ…ç®¡ç†ç­‰ï¼›ä¸°å¯Œå¼€æºç”Ÿæ€ï¼ŒåŒ…æ‹¬å®Œå–„æ ‡å‡†åº“ï¼Œå¼€å‘ç±»ä¼¼ç§‘å­¦è®¡ç®—è¿™æ ·çš„æ–°åº“ï¼›å›´ç»•å¼€å‘ä½“éªŒçš„æ„å»ºå’Œä»£ç è¡¥å…¨æé€Ÿã€ä¸°å¯Œè¯Šæ–­ä¿¡æ¯ã€ç¨³å®šè°ƒè¯•ä½“éªŒç­‰ï¼›DSLèƒ½åŠ›æå‡ï¼›å®Œå–„ä½çº§åˆ«ç³»ç»Ÿç¼–ç¨‹å’Œæœºå™¨å­¦ä¹ ç­‰é‡è¦é¢†åŸŸçš„æ‹“å±•ï¼›æä¾›å†…å­˜æ‰€æœ‰æƒå’Œå¹¶å‘ç­‰ä¸»è¦è¯­è¨€ç‰¹æ€§çš„æ–¹æ¡ˆï¼Œè¦åšåˆ°å‡ºè‰²ä¸ºæ­¢ã€‚</p>
<p>ç›®å‰Swiftè¿™ä¸ªé¡¹ç›®çš„è´Ÿè´£äººå« <a href="https://twitter.com/tkremenek"><em>Ted Kremenek</em></a>ï¼Œæ–¯å¦ç¦åšå£«ï¼Œä»–ä¹‹å‰è¿˜æ˜¯Rustçš„ä¸»åŠ›å¼€å‘ã€‚åœ¨è‹¹æœå·¥ä½œçš„åå¹´ï¼Œä¸€ä¸ªäººåšäº†Clangçš„é™æ€åˆ†æå™¨ï¼Œåé¢ä¸€ç›´ç®¡ç†ç€Clangå’ŒSwifté¡¹ç›®ï¼Œå‘Chrisæ±‡æŠ¥ã€‚Swifté¡¹ç›®å›¢é˜Ÿæ ¸å¿ƒæˆå‘˜è¿˜æœ‰Dave Abrahamsï¼ˆå·²é€€å‡ºï¼‰ã€John McCallã€Doug Gregorã€Joe Groffã€Saleem Abdulrasoolï¼ˆç§»æ¤Swiftåˆ°windowsï¼‰ã€Tom Doronï¼ˆåˆ›å»ºSwiftNIOï¼‰ç­‰ï¼Œä»–ä»¬çš„èº«å½±æ´»è·ƒåœ¨Githubçš„Swiftå„ä¸ªææ¡ˆä¸­ã€‚</p>
<p>å›åˆ°æˆ‘ä»¬èº«è¾¹ï¼Œå›½å†…Swiftç”¨çš„æƒ…å†µæ€ä¹ˆæ ·ï¼Ÿ</p>
<p>ä¸€äº›è€³ç†Ÿèƒ½è¯¦çš„Appï¼Œæ¯”å¦‚å¾®ä¿¡ã€æ·˜å®ã€ç™¾åº¦ã€æ”¯ä»˜å®ã€æ‹¼å¤šå¤šã€äº¬ä¸œã€å“”å“©å“”å“©ã€ä¼˜é…·ã€å°çº¢ä¹¦ç­‰éƒ½å·²ç»å¼€å§‹å°è¯•ä½¿ç”¨Swiftï¼Œè¿™äº›Appæ— ä¸€ä¾‹å¤–éƒ½é‡‡ç”¨äº†Swiftå’ŒOCæ··ç¼–å¼€å‘ã€‚ç”±äºå›½å†…ä¸šåŠ¡ç«äº‰å‹åŠ›å¤§ï¼Œå¾ˆéš¾åƒå›½å¤–å…¬å¸Uberé‚£æ ·èŠ±å¤§åŠå¹´æ—¶é—´å…¨éƒ¨ç”¨Swifté‡æ„ï¼Œå› æ­¤å¦‚æœè¦åœ¨ç°æœ‰å·¥ç¨‹åŸºç¡€ä¸Šå¼•å…¥Swiftå¼€å‘ï¼Œä¸å¯é¿å¼€é‡‡ç”¨æ··ç¼–å¼€å‘ã€‚å¾ˆå¤šAppä½¿ç”¨Swiftæ··ç¼–ï¼Œä¹Ÿæ˜¯å› ä¸ºè‹¹æœå¯¹WidgetåŠŸèƒ½å¼€å‘è¯­è¨€è®¾ç½®äº†é™åˆ¶ï¼Œå³åªèƒ½ä½¿ç”¨Swiftï¼Œçœ‹æ¥è‹¹æœå…¬å¸è¿™ä¸ªç­–ç•¥æ˜¯ç›¸å½“æœ‰æ•ˆçš„ã€‚</p>
<h2 id="æ¡†æ¶é€‰æ‹©"><a href="#æ¡†æ¶é€‰æ‹©" class="headerlink" title="æ¡†æ¶é€‰æ‹©"></a>æ¡†æ¶é€‰æ‹©</h2><p>è€Œæ­£å¼è¿›å…¥æ··ç¼–å¼€å‘å‰ï¼Œéœ€è¦å…ˆåšå¼€å‘æ¡†æ¶çš„é€‰å‹ï¼Œæˆ‘ä»¬å…ˆä»æ¶æ„æ¼”è¿›å¼€å§‹è¯´èµ·ã€‚</p>
<h3 id="æ¶æ„æ¼”è¿›"><a href="#æ¶æ„æ¼”è¿›" class="headerlink" title="æ¶æ„æ¼”è¿›"></a>æ¶æ„æ¼”è¿›</h3><p>ä¸€èˆ¬Appç»è¿‡å¤šå¹´å‘å±•ï¼Œæ¶æ„éƒ½ä¼šç»è¿‡å¦‚ä¸‹å››ä¸ªé˜¶æ®µï¼š</p>
<p><img src="/uploads/acfun-swift-practice/05.png" alt=""></p>
<p>å¦‚å›¾æ‰€ç¤ºï¼ŒAppæ¶æ„ä»å•Moduleï¼ŒMVCæ¶æ„åˆ°å‡ ç™¾ä¸ªModuleï¼Œæ— ä¾èµ–ï¼ŒåŠ¨æ€è·³è½¬ã€‚å›¢é˜Ÿä»å°å˜å¤§ï¼Œå¦‚ä»ŠAppçš„æ¶æ„æ›´åé‡é«˜è´¨é‡ã€ç¨³å®šæ€§å’Œé«˜å¯ç»´æŠ¤æ€§ã€‚è‹¹æœå…¬å¸ä¹Ÿæ˜¯é¡ºåº”å‘å±•è¶‹åŠ¿ï¼Œå…ˆåæ¨å‡ºæé«˜ç¨³å®šæ€§çš„Swiftè¯­è¨€ï¼Œè€Œåæ¨å‡ºæé«˜å¯ç»´æŠ¤æ€§çš„SwiftUIå’ŒCombineã€‚</p>
<h3 id="SwiftUI"><a href="#SwiftUI" class="headerlink" title="SwiftUI"></a>SwiftUI</h3><p>å¯¹äºä¸€ä¸ªåŸºäºUIKitçš„é¡¹ç›®æ˜¯æ²¡æœ‰å¿…è¦å…¨éƒ¨ç”¨SwiftUIé‡å†™çš„ï¼Œåœ¨UIKité‡Œä½¿ç”¨SwiftUIçš„è§†å›¾éå¸¸å®¹æ˜“ï¼ŒUIHostingControlleræ˜¯UIViewControllerçš„å­ç±»ï¼Œå¯ä»¥ç›´æ¥ç”¨åœ¨UIKité‡Œï¼Œå› æ­¤ç›´æ¥å°†SwiftUIè§†å›¾åŠ åˆ°UIHostingControllerä¸­ï¼Œå°±å¯ä»¥åœ¨UIKité‡Œä½¿ç”¨SwiftUIè§†å›¾äº†ã€‚</p>
<p>SwiftUIçš„å¸ƒå±€æ ¸å¿ƒæ˜¯ GeometryReaderã€View Preferenceså’ŒAnchor Preferencesã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/uploads/acfun-swift-practice/06.png" alt=""></p>
<p>SwiftUIçš„æ•°æ®æµæ›´é€‚åˆReduxç»“æ„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/uploads/acfun-swift-practice/07.png" alt=""></p>
<p>å¦‚ä¸Šå›¾ï¼ŒReduxç»“æ„æ˜¯çœŸæ­£çš„å•å‘å•æ•°æ®æºç»“æ„ï¼Œæ˜“äºåˆ†å‰²ï¼Œèƒ½å……åˆ†åˆ©ç”¨SwiftUIå†…ç½®çš„æ•°æ®æµProperty Wrapperã€‚UIç»„ä»¶å¹²å‡€ã€ä½“é‡å°ã€å¯å¤ç”¨å¹¶ä¸”æ— ä¸šåŠ¡é€»è¾‘ï¼Œå› æ­¤å¼€å‘æ—¶å¯ä»¥èšç„¦äºUIä»£ç ã€‚ä¸šåŠ¡é€»è¾‘æ”¾åœ¨ä¸€èµ·ï¼Œæ‰€æœ‰ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®Modeléƒ½åœ¨Reduceré‡Œã€‚<a href="https://github.com/Dimillian/ACHNBrowserUI"><em>ACHNBrowserUI</em></a> å’Œ <a href="https://github.com/Dimillian/MovieSwiftUI"><em>MovieSwiftUI</em></a> å¼€æºé¡¹ç›®éƒ½æ˜¯ä½¿ç”¨çš„Reduxæ¶æ„ã€‚æœ€è¿‘æ¯”è¾ƒç©ç›®çš„TCAï¼ˆThe Composable Architectureï¼‰ä¹Ÿæ˜¯ç±»Redux/Elmçš„æ¶æ„çš„æ¡†æ¶ï¼Œ<a href="https://github.com/pointfreeco/swift-composable-architecture"><em>é¡¹ç›®åœ°å€è§</em></a>ã€‚</p>
<p>æåˆ°æ•°æ®æµå°±ä¸å¾—ä¸è¯´ä¸‹è‹¹æœå…¬å¸æ–°å‡ºçš„Combineï¼Œå¯¹æ ‡çš„æ˜¯RxSwiftï¼Œç”±äºæ˜¯è‹¹æœå…¬å¸å®˜æ–¹çš„åº“ï¼Œæ‰€ä»¥åº”è¯¥ä¼˜å…ˆé€‰æ‹©ã€‚ä¸è¿‡å’ŒSwiftUIä¸€æ ·ï¼Œè¿™ä¸¤ä¸ªæ–°åº“å¯¹APPæ”¯æŒæœ€ä½çš„ç³»ç»Ÿç‰ˆæœ¬éƒ½è¦æ±‚æ˜¯iOS13åŠä»¥ä¸Šã€‚é‚£ä¹ˆæ€ä¹ˆèƒ½å¤Ÿæå‰ç”¨ä¸ŠSwiftUIå’ŒCombineå‘¢ï¼Ÿæˆ–è€…è¯´ç°åœ¨ä½¿ç”¨ä»€ä¹ˆåº“å¯ä»¥ä»¥ç›¸åŒæ¥å£æ–¹å¼æš‚æ—¶æ›¿æ¢å®ƒä»¬ï¼Œåˆèƒ½åœ¨ä»¥åæ”¹ä¸ºSwiftUIå’ŒCombineæ—¶æˆæœ¬æœ€å°åŒ–å‘¢ï¼Ÿ</p>
<p>å¯¹äºSwiftUIï¼ŒAcFunè‡ªç ”äº†å£°æ˜å¼UI Yseraï¼Œç±»ä¼¼SwiftUIçš„æ¥å£ï¼Œå¹¶ä¸”é‡æ„äº†AcFuné‡Œæ”¶è—æ¨¡å—åˆ—è¡¨è§†å›¾å’Œäº¤äº’é€»è¾‘ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/uploads/acfun-swift-practice/10.png" alt=""></p>
<p>é€šè¿‡ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œswiftä»£ç é‡ç›¸æ¯”è¾ƒOCå‡å°‘äº†65%ä»¥ä¸Šï¼ŒåŸå…ˆä½¿ç”¨Objective-Cå®ç°çš„ç›¸åŒåŠŸèƒ½ä»£ç è¶…è¿‡äº†1000è¡Œï¼Œè€ŒSwifté‡å†™åªéœ€è¦350è¡Œï¼Œå¯¹äºAcFunçš„ä¸šåŠ¡ç ”å‘å·¥ç¨‹å¸ˆè€Œè¨€ï¼ŒåŒæ ·çš„éœ€æ±‚å®ç°ä»£ç æ¯”ä¹‹å‰å°‘äº†è‡³å°‘30%ï¼Œé¢å¯¹å•å‘¨è¿­ä»£è¿™æ ·çš„èŠ‚å¥ï¼Œå›¢é˜Ÿä¹Ÿå˜å¾—æ›´ä»å®¹ã€‚ä»£ç å¯è¯»æ€§å¢åŠ äº†ï¼ŒåæœŸåŠŸèƒ½è¿­ä»£å’Œç»´æŠ¤æ›´å®¹æ˜“äº†ï¼ŒSwiftè®©AcFuné©¶å…¥äº†iOSå¼€å‘ç”Ÿæ€çš„â€œå¿«è½¦é“â€ã€‚</p>
<p>SwiftUIå…¨éƒ¨éƒ½æ˜¯åŸºäºSwiftçš„å„å¤§å¯æé«˜å¼€å‘æ•ˆç‡ç‰¹æ€§å®Œæˆçš„ï¼Œæ¯”å¦‚å‰é¢æåˆ°çš„ï¼Œèƒ½å¤Ÿè®¿é—®åªç»™è¯­è¨€ç‰¹æ€§çº§åˆ«è¡Œä¸ºçš„Property Wrapperï¼Œé€šè¿‡Property WrapperåŒ…è£…ä»£ç é€»è¾‘ï¼Œæ¥é™ä½ä»£ç å¤æ‚åº¦ï¼Œé™¤äº†SwiftUIå’ŒCombineé‡Œ@å¼€å¤´çš„Property Wrapperå¤–ï¼ŒSwiftè¿˜è‡ªå¸¦ç±»ä¼¼<a href="https://github.com/apple/swift-evolution/blob/master/proposals/0195-dynamic-member-lookup.md"><em>@dynamicMemberLookup</em></a> å’Œ<a href="https://github.com/apple/swift-evolution/blob/master/proposals/0216-dynamic-callable.md"><em>@dynamicCallable</em></a> è¿™æ ·é‡é‡çº§çš„Property Wrapperã€‚è¿˜æœ‰<a href="https://github.com/apple/swift-evolution/blob/main/proposals/0289-result-builders.md"><em>ResultBuilder</em></a><em> </em>è¿™ç§èƒ½å¤Ÿç®€åŒ–è¯­æ³•çš„ç‰¹æ€§ï¼Œæœ‰äº›å¦‚GraphQLã€RESTå’ŒNetworkingå®é™…ä½¿ç”¨ResultBuilderçš„<a href="https://github.com/carson-katri/awesome-result-builders"><em>èŒƒä¾‹å¯ä»¥å‚è€ƒ</em></a>ã€‚è¿™äº›Swiftçš„ç‰¹æ€§å¦‚æœä¹Ÿèƒ½å¾—åˆ°å……åˆ†åˆ©ç”¨ï¼Œå³ä½¿ä¸ç”¨SwiftUIä¹Ÿèƒ½ä½¿å¼€å‘æ•ˆç‡å¾—åˆ°å¤§å¹…æå‡ã€‚</p>
<p>ç½‘é£ï¼ˆNetflixï¼‰Appå·²ä½¿ç”¨SwiftUIé‡æ„äº†ç™»å½•ç•Œé¢ï¼Œç½‘é£å¢é•¿å›¢é˜Ÿç§»åŠ¨è´Ÿè´£äººæ•…èƒ¤é“é•¿è®°å½•äº†SwiftUIåœ¨ç½‘é£çš„è½åœ°è¿‡ç¨‹ï¼Œè¯¦ç»†æè¿°äº†<a href="https://mp.weixin.qq.com/s/oRPRCx78owLe3_gROYapCw"><em>SwiftUIçš„æ”¶ç›Š</em></a>ã€‚ç½‘é£èƒ½å¤Ÿç›´æ¥ä½¿ç”¨SwiftUIå¾—ç›Šäºä»–ä»¬æœ€ä½æ”¯æŒiOS 13ç³»ç»Ÿã€‚</p>
<p>ä¸è¿‡å¦‚æœ€ä½æ”¯æŒç³»ç»Ÿä½äºiOS 13ï¼Œè¿˜æœ‰å¼€æºé¡¹ç›®<a href="https://github.com/rakutentech/AltSwiftUI"><em>AltSwiftUI</em></a><em> </em>ä¹Ÿå®ç°äº†SwiftUIçš„è¯­æ³•å’Œç‰¹æ€§ï¼Œèƒ½å¤Ÿå‘å‰å…¼å®¹åˆ°iOS 11ã€‚</p>
<p>å¯¹äºCombineï¼Œä¹Ÿæœ‰å¼€æºå®ç°<a href="https://github.com/OpenCombine/OpenCombine"><em>OpenCombine</em></a>ï¼Œç›®å‰éƒ½æœªå®Œå…¨å®ç°æ‰€æœ‰ç‰¹æ€§ã€‚å› æ­¤ï¼Œå…·ä½“åœ¨å·¥ç¨‹ä¸­ä½¿ç”¨è¿˜æ˜¯éœ€è¦äº†è§£Combineçš„æ ¸å¿ƒåŸç†ã€‚</p>
<h3 id="RxSwift"><a href="#RxSwift" class="headerlink" title="RxSwift"></a>RxSwift</h3><p>Combineçš„çµæ„Ÿæ¥æºäºRxSwiftã€‚RxSwiftçš„æ ¸å¿ƒï¼Œè¿™é‡Œæœ‰ä»½å®ç°äº†RxSwiftæ ¸å¿ƒé€»è¾‘çš„<a href="https://github.com/sergdort/HandMadeRx/tree/master/HandMadeRx.playground/Sources"><em>ç®€ç‰ˆæ ·ä¾‹ä»£ç </em></a>ï¼Œå¯ä»¥çª¥è§†å…¶æ ¸å¿ƒé€»è¾‘ã€‚æ•´ä½“æµç¨‹å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/uploads/acfun-swift-practice/08.png" alt=""></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒRxSwiftæ•´ä½“æµç¨‹éå¸¸ç®€å•ï¼Œä¸»è¦å°±æ˜¯è®¢é˜…è€…å’Œå‘å¸ƒè€…ä¹‹é—´è¿›è¡Œè®¢é˜…ã€å‘å¸ƒã€å–æ¶ˆæ“ä½œï¼Œè®¢é˜…è€…ä¼šç›‘å¬å’Œå¤„ç†è¿™äº›äº‹ä»¶ã€‚å…·ä½“RxSwiftæ•°æ®ä¼ é€’å…³ç³»å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/uploads/acfun-swift-practice/09.png" alt=""></p>
<p>ä¸Šå›¾ä¸­çš„Observableæ˜¯å‘å¸ƒè€…ï¼ŒObserveræ˜¯è®¢é˜…è€…ã€‚å–æ¶ˆè®¢é˜…æ˜¯é€šè¿‡CompositeDisposableæ¥è¿›è¡Œç®¡ç†ï¼Œç®¡ç†æ–¹å¼å°±æ˜¯åŠ ä¸ªä¸­é—´è®¢é˜…è€…æ¥å†³å®šæ˜¯å¦å‘é€äº‹ä»¶ç»™åŸè®¢é˜…è€…ã€‚SinkDisposableæ˜¯ä¸€ä¸ªä¸­é—´å±‚ç”¨æ¥æŠŠä¸­é—´è®¢é˜…è€…å’ŒåŸè®¢é˜…è€…è¿˜æœ‰äº‹ä»¶è½¬å‘çš„é€»è¾‘æ”¾åˆ°ä¸€èµ·ã€‚æ–°å¢ä¸€ä¸ªæ“ä½œç¬¦å°±ä¼šæ–°å¢ä¸€ä¸ªSinkDisposableï¼Œæ¯”å¦‚æ–°å¢filteræ“ä½œç¬¦å°±ä¼šæ–°å¢FilterObserverå’ŒFilterObservableï¼Œå¦‚æœæ²¡æœ‰æ“ä½œç¬¦å°±æ˜¯AnoymousObserverå’ŒAnoymousObservableã€‚è®¢é˜…æ˜¯é€šè¿‡Disposerç±»æ¥ç®¡ç†çš„ï¼Œä¼šåˆ¤æ–­æ˜¯å¦å®Œæˆæˆ–è€…å‡ºé”™ï¼Œæ‰§è¡ŒDisposeæ–¹æ³•ã€‚</p>
<h3 id="Combine"><a href="#Combine" class="headerlink" title="Combine"></a>Combine</h3><p>Combineçš„æ€è·¯åŸºæœ¬å’ŒRxSwiftä¸€æ ·ï¼Œåªæ˜¯æ¥å£å‘½åä¸åŒï¼Œè¿™é‡Œæœ‰ä»½<a href="https://github.com/CombineCommunity/rxswift-to-combine-cheatsheet"><em>è¡¨æ ¼</em></a>ï¼Œåˆ—å‡ºäº†Combineå’ŒRxSwiftåŠŸèƒ½çš„å¯¹åº”å…³ç³»ï¼Œå¯ä»¥çœ‹å‡ºç›®å‰Combineç›¸è¾ƒäºRxSwiftè¿˜ç¼ºå°‘å¾ˆå¤šèƒ½åŠ›ï¼ŒCombineæ¯•ç«Ÿæ–°ç”Ÿå„¿ï¼Œè¿˜éœ€è¦æ—¶é—´æˆé•¿ã€‚ä½†æ˜¯Combineæœ‰ä¸ªç‰¹æ€§æ˜¯RxSwiftæ²¡æœ‰çš„ï¼Œé‚£å°±æ˜¯Backpressureï¼ŒBackpressureå¯è‡ªå®šä¹‰ç­–ç•¥æ§åˆ¶Subscribeèƒ½å¤Ÿæ¥æ”¶çš„æ•°é‡ã€‚</p>
<p>é™¤äº†SwiftUIå’ŒCombineï¼Œåœ¨Swiftå¼€å‘ä¸­è¿˜æœ‰å“ªäº›åº“æ˜¯å¯ä»¥ç›´æ¥æ‹¿æ¥ä½¿ç”¨çš„å‘¢ï¼Ÿè¿™é‡Œæœ‰ä»½ <a href="https://github.com/matteocrippa/awesome-swift"><em>Swiftå¼€æºåº“çš„awesome</em></a>ï¼Œåœ¨è¿™é‡Œå¯ä»¥æŸ¥ç¼ºè¡¥æ¼ã€‚AcFunä¸»è¦ä½¿ç”¨äº†Swiftå¼€æºåº“æœ‰<a href="https://github.com/apple/swift-protobuf"><em>Protobuf</em></a>,<em> </em><a href="https://github.com/ReactiveX/RxSwift"><em>RxSwift</em></a>, <a href="https://github.com/hyperoslo/Cache"><em>Cache</em></a>, <a href="https://github.com/slazyk/Observable-Swift"><em>Observable</em></a>ã€‚</p>
<p>ä»¥ä¸Šï¼Œä¸ºã€ŠAç«™ çš„ Swift å®è·µã€‹çš„ä¸Šç¯‡å†…å®¹ï¼Œä¸‹ç¯‡æˆ‘ä»¬ä¼šç»§ç»­è¯¦ç»†ä»‹ç»OCå’ŒSwiftæ˜¯æ€ä¹ˆæ··ç¼–çš„ï¼Œä»¥åŠSwiftçš„åŠ¨æ€æ€§ã€‚</p>
<h2 id="å¦‚ä½•æ··ç¼–"><a href="#å¦‚ä½•æ··ç¼–" class="headerlink" title="å¦‚ä½•æ··ç¼–"></a>å¦‚ä½•æ··ç¼–</h2><p>æ˜¨å¤©åˆšåˆšç»“æŸçš„Google I/Oè®©äººæƒ³èµ·äº†Kotlinåœ¨ä¸‰å¹´å‰æ›¾ç»ä¸Šè¿‡ä¸€æ¬¡çƒ­æœï¼ŒGoogle I/Oå®˜å®£Kotlinæ›¿ä»£Javaï¼Œæ­£å¼æˆä¸ºAndroidå¼€å‘çš„é¦–é€‰è¯­è¨€ã€‚æ­£æ‰€è°“æ¼”è¿›çš„åŠ›é‡ï¼Œè¿™ä¸€åˆ‡éƒ½è¦å½’åŠŸäºè‹¹æœå…¬å¸åœ¨2014å¹´æ¨å‡ºçš„Swiftæ›¿ä»£äº†Objective-Cï¼Œæˆä¸ºiOSä¹ƒè‡³è‹¹æœå…¨å¹³å°é¦–é€‰çš„å¼€å‘è¯­è¨€ï¼Œä»è€Œæé«˜äº†iOSå¼€å‘è€…çš„çƒ­æƒ…ã€‚ä¸Šç¯‡ä»‹ç»äº†Swiftçš„æŠ€æœ¯èƒŒæ™¯ä»¥åŠå¦‚ä½•é€‰æ‹©å¼€å‘æ¡†æ¶ã€‚ä¸‹ç¯‡çš„å†…å®¹ä¼šä»‹ç»å¤§å¤šæ•°ä»¥OCä¸ºä¸»ä½“çš„å·¥ç¨‹å¦‚ä½•ä¸Swiftå…±èˆï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨SwiftåŠ¨æ€æ€§è§£å†³å·¥ç¨‹éš¾é¢˜ã€‚</p>
<p><img src="/uploads/acfun-swift-practice/11.png" alt=""></p>
<p>å¦‚æœä½ çš„å·¥ç¨‹æ˜¯OCå¼€å‘çš„ï¼Œè¦ç”¨ä¸ŠSwiftå°±éœ€è¦è¿›è¡ŒOCå’ŒSwiftçš„æ··ç¼–å¼€å‘ã€‚</p>
<p>ç„¶è€Œï¼Œæ··ç¼–å¼€å‘åº”è¯¥æ€ä¹ˆå¼€å§‹å‘¢ï¼Ÿæœ‰æ²¡æœ‰ä»€ä¹ˆå‰ç½®æ¡ä»¶ï¼Ÿ</p>
<h3 id="å‰ç½®æ¡ä»¶"><a href="#å‰ç½®æ¡ä»¶" class="headerlink" title="å‰ç½®æ¡ä»¶"></a>å‰ç½®æ¡ä»¶</h3><p>æ··ç¼–æœ¬è´¨ä¸Šå°±æ˜¯æŠŠOCè¯­æ³•çš„å£°æ˜é€šè¿‡ç¼–è¯‘å·¥å…·ç”ŸæˆSwiftè¯­æ³•çš„å£°æ˜ï¼Œè¿™æ ·Swiftå°±å¯ä»¥é€šè¿‡ç”Ÿæˆçš„å£°æ˜ç›´æ¥è°ƒç”¨OCæ¥å£ã€‚åä¹‹ï¼ŒOCè°ƒç”¨Swiftæ¥å£ä¹Ÿå¯ä»¥é€šè¿‡ç›¸åŒçš„æ–¹æ³•ï¼ŒæŠŠSwiftè¯­æ³•çš„å£°æ˜ç”ŸæˆOCè¯­æ³•çš„å¤´æ–‡ä»¶ã€‚è¿™äº›è½¬æ¢ç”Ÿæˆçš„ç¼–è¯‘å·¥å…·éƒ½é›†æˆåœ¨å¼€å‘å·¥å…·Xcodeé‡Œã€‚</p>
<p>Xcodeå…¶å®å°±æ˜¯æ‰§è¡Œå¤šå‘½ä»¤è¡Œçš„å·¥å…·ï¼Œæ¯”å¦‚Clangã€ldç­‰ç­‰ã€‚Xcodeã€Projectæ–‡ä»¶é‡ŒåŒ…å«äº†è¿™äº›å‘½ä»¤çš„å‚æ•°å’Œå®ƒä»¬æ‰§è¡Œçš„é¡ºåºï¼Œä¹Ÿæœ‰æ‰€æœ‰å¾…ç¼–è¯‘æ–‡ä»¶å’Œå®ƒä»¬çš„ä¾èµ–å…³ç³»ã€‚<a href="https://github.com/apple/swift-llbuild/"><em>llbuild</em></a>æ˜¯ä½ç­‰çº§æ„å»ºç³»ç»Ÿï¼Œæ ¹æ®Xcode Projecté‡Œçš„é…ç½®æŒ‰é¡ºåºæ‰§è¡Œå‘½ä»¤ã€‚å‘½ä»¤è¡Œå·¥å…·çš„å‚æ•°é…ç½®æ˜¯åœ¨Xcodeçš„Build Settingsé‡Œè¿›è¡Œè®¾ç½®çš„ã€‚å¦‚æœæ˜¯åœ¨åŒä¸€ä¸ªProjecté‡Œæ··ç¼–ï¼Œé¦–å…ˆéœ€è¦å°†Build Settingsé‡ŒAlways Embed Swift Standard Librariesè®¾ç½®ä¸ºYESï¼Œç„¶ååœ¨æ¡¥æ¥æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯ProductName-Bridging-Header.hé‡Œå¯¼å…¥éœ€è¦æš´éœ²ç»™Swiftçš„OCç±»ã€‚å¦‚æœSwiftè¦è°ƒç”¨çš„OCåœ¨ä¸åŒProjecté‡Œï¼Œåˆ™éœ€è¦å°†OCçš„Projectè®¾ç½®ä¸ºModuleï¼Œå°†Defines Moduleè®¾ä¸ºYESï¼Œå†æŠŠModuleé‡Œçš„å¤´æ–‡ä»¶å¯¼å…¥åˆ°OC Modulemapæ–‡ä»¶é‡Œçš„Umbrella Headeré‡Œã€‚</p>
<h3 id="å¦‚ä½•è®¾ç½®CocoaPods"><a href="#å¦‚ä½•è®¾ç½®CocoaPods" class="headerlink" title="å¦‚ä½•è®¾ç½®CocoaPods"></a>å¦‚ä½•è®¾ç½®CocoaPods</h3><p>Swift Podçš„Podspecéœ€è¦å†™æ˜å¯¹OC Podçš„ä¾èµ–ã€‚åœ¨å·¥ç¨‹Podfileä¸­ï¼ŒOC Podåé¢è¦å†™ :modular_headers =&gt; trueã€‚å¼€å¯Modular Headerå°±æ˜¯æŠŠPodè½¬æ¢ä¸ºModuleã€‚é‚£CocoaPodsç©¶ç«Ÿåšäº†ä»€ä¹ˆï¼Ÿæ‰§è¡Œ  Pod Install â€“ Verboseå°±å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ç”ŸæˆPod Targetsæ—¶ï¼ŒCocoaPodsä¼šç”ŸæˆModule Map Fileå’ŒUmbrella Headerã€‚</p>
<p>æ¯ä¸ªå·¥ç¨‹è®¾ç½®çš„æƒ…å†µåƒå¥‡ç™¾æ€ªï¼Œè€ŒCocoaPodsä¸»è¦æ˜¯é€šè¿‡è‡ªå·±çš„dslé…ç½®æ¥å®Œæˆè¿™äº›ç¼–è¯‘å‚æ•°çš„è®¾ç½®ï¼Œæ‰€ä»¥å°±éœ€è¦å…ˆäº†è§£äº›æ··ç¼–è®¾ç½®çš„ç¼–è¯‘å‚æ•°å’Œæ¦‚å¿µï¼š</p>
<ul>
<li>å‰é¢æåˆ°çš„Defines Moduleï¼Œéœ€è¦è®¾ç½®ä¸ºYESã€‚</li>
<li>Module Map Fileè¡¨ç¤º Module Mapçš„è·¯å¾„ã€‚</li>
<li>Header Search Pathsä»£è¡¨Module Mapå®šä¹‰çš„OCå¤´æ–‡ä»¶è·¯å¾„ã€‚</li>
<li>Product Module Nameçš„é»˜è®¤è®¾ç½®å’ŒTarget Nameä¸€æ ·ã€‚</li>
<li>Framework Search Pathsæ˜¯è®¾ç½®ä¾èµ–Frameworkçš„æœç´¢è·¯å¾„ã€‚</li>
<li>Other C Flagså¯ä»¥ç”¨æ¥é…ç½®ä¾èµ–å…¶å®ƒModuleæ–‡ä»¶è·¯å¾„ã€‚</li>
<li>Other Swift Flagså¯ä»¥é…ç½®å…¶Module Mapæ–‡ä»¶è·¯å¾„ã€‚</li>
</ul>
<p>CocoaPodsçš„ä¸»è¦ç»„ä»¶æœ‰è§£æå‘½ä»¤çš„<a href="https://github.com/CocoaPods/CLAide"><em>CLAide</em></a><em>ã€</em>ç”¨æ¥è§£æPodæè¿°æ–‡ä»¶ï¼Œæ¯”å¦‚Podfileã€Podfile.lockå’ŒPodSpecæ–‡ä»¶çš„<a href="https://github.com/CocoaPods/Core"><em>Cocoapods-core</em></a><em>ã€</em>æ‹‰ä»“åº“ä»£ç å’Œèµ„æºçš„<a href="https://github.com/CocoaPods/cocoapods-downloader"><em>Cocoapods-downloader</em></a><em>ã€</em>åˆ†æä¾èµ–çš„<a href="https://github.com/CocoaPods/Molinillo"><em>Molinillo</em></a><em>ã€</em>ä»¥åŠåˆ›å»ºå’Œç¼–è¾‘Xcodeçš„.xcodeprojå’Œ.xcworkspaceæ–‡ä»¶çš„<a href="https://github.com/CocoaPods/Xcodeproj"><em>Xcodeproj</em></a>ã€‚åœ¨æ‰§è¡Œäº†Pod Installä»¥åï¼Œç»„ä»¶è°ƒç”¨æµç¨‹ä»¥åŠé…ç½®Moduleæ‰€å¤„æµç¨‹ä½ç½®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/uploads/acfun-swift-practice/12.png" alt=""></p>
<p>æŒ‰ç…§ä¸Šå›¾çš„é€»è¾‘ï¼ŒIntegratesè¿™ä¸€æ­¥ä¸»è¦æ˜¯ç”¨æ¥é…ç½®Moduleçš„ã€‚å…ˆæ£€æŸ¥Targetsï¼Œä¸»è¦æ˜¯å¯¹äºåŒ…æ‹¬Swiftç‰ˆæœ¬å’ŒModuleä¾èµ–ç­‰é—®é¢˜çš„æ£€æŸ¥ï¼Œç„¶åå†ä½¿ç”¨Xcodeprojç»„ä»¶åšModuleçš„å·¥ç¨‹é…ç½®ã€‚</p>
<p>å®Œæˆä»¥ä¸Šå·¥ä½œåï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦åœ¨Swifté‡Œä½¿ç”¨OCå¼€å‘çš„åº“FMDBï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨Importæ¥å¯¼å…¥ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> FMDB</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SwiftTestClass</span>: <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> db:<span class="type">FMDB</span>.<span class="type">FMDatabase</span>?</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">init</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>()</span><br><span class="line">        <span class="keyword">self</span>.db <span class="operator">=</span> <span class="type">FMDB</span>.<span class="type">FMDatabase</span>(path: <span class="string">&quot;dbname&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;init ok&quot;</span>)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒImport FMDBå°†FMDBçš„Moduleå€’å…¥è¿›æ¥åï¼Œæ¥å£ä¾ç„¶èƒ½å¤Ÿç›´æ¥ä½¿ç”¨Swiftè¯­æ³•è°ƒç”¨ã€‚</p>
<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒModuleä¾èµ–çš„Podä¹Ÿéœ€è¦æ˜¯Moduleã€‚å› æ­¤æ”¹é€ æ—¶éœ€è¦ä»åº•å‘ä¸Šåœ°æ”¹é€ æˆModuleã€‚å¦å¤–ï¼Œå¼€å¯Moduleåï¼Œå¦‚æœæŸä¸ªå¤´æ–‡ä»¶åœ¨Umbrella Headeré‡Œï¼Œé‚£ä¹ˆå…¶å®ƒåŒ…å«è¿™ä¸ªå¤´æ–‡ä»¶çš„Podä¹Ÿéœ€è¦æ‰“å¼€Moduleã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆè¦ç”¨Moduleï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦ç”¨Moduleï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç”¨Moduleï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦ç”¨Moduleï¼Ÿ</h3><p>åœ¨Moduleè¢«ä½¿ç”¨ä¹‹å‰ï¼Œå¼€å‘è€…ä»¬éœ€è¦å¯¹è¦å¯¼å…¥çš„Cè¯­è¨€ç¼–è¯‘å™¨å¤„ç†æ–¹å¼ç±»å¤´æ–‡ä»¶è¿›è¡Œé¢„å¤„ç†ï¼ŒæŸ¥æ‰¾å¤´æ–‡ä»¶é‡Œè¿˜å¯¼å…¥äº†å“ªäº›å¤´æ–‡ä»¶ï¼Œé€’å½’ç›´åˆ°æ‰¾åˆ°å…¨éƒ¨å¤´æ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œé¢„å¤„ç†çš„æ–¹å¼ä¼šé‡åˆ°è®¸å¤šé—®é¢˜ã€‚å…¶ä¸€ï¼Œç¼–è¯‘çš„å¤æ‚åº¦é«˜ä¸”è€—æ—¶é•¿ï¼Œè¿™æ˜¯å› ä¸ºæ¯ä¸ªå¯ç¼–è¯‘çš„æ–‡ä»¶éƒ½ä¼šå•ç‹¬ç¼–è¯‘è¿›è¡Œé¢„å¤„ç†ï¼Œæ‰€ä»¥åœ¨é¢„å¤„ç†è¿‡ç¨‹ä¸­é€’å½’æŸ¥æ‰¾å¯¼å…¥å¤´æ–‡ä»¶çš„å·¥ä½œä¼šé‡å¤å¾ˆå¤šæ¬¡ï¼Œå°¤å…¶æ˜¯å½“åŒ…å«å…³ç³»å¾ˆæ·±çš„å¤´æ–‡ä»¶è¢«å¾ˆå¤š.mæ‰€å¯¼å…¥çš„æ—¶å€™ï¼›å…¶äºŒï¼Œä¼šå‡ºç°å®å®šä¹‰å†²çªæ—¶éœ€è¦é‡æ–°æ’åºä»¥åŠå’Œè§£ä¾èµ–çš„é—®é¢˜ç­‰ã€‚</p>
<p>Moduleç›¸å¯¹æ¥è¯´æ›´åŠ ç®€æ˜“ï¼Œå®ƒçš„å¤´æ–‡ä»¶åªéœ€è¦è§£æä¸€æ¬¡ï¼Œæ‰€ä»¥ç¼–è¯‘çš„å¤æ‚åº¦ä¼šæŒ‡æ•°çº§é™ä½ï¼Œä¸”ç¼–è¯‘å™¨å¯¹Moduleçš„å¤„ç†æ–¹å¼å’ŒCè¯­è¨€çš„é¢„å¤„ç†æ–¹å¼æ˜¯å®Œå…¨ä¸åŒçš„ã€‚ç¼–è¯‘å™¨ä¼šå°†è¦ç¼–è¯‘çš„æ–‡ä»¶å¯¼å…¥çš„å¤´æ–‡ä»¶ç”ŸæˆäºŒè¿›åˆ¶æ ¼å¼ï¼Œå­˜å‚¨åœ¨Module Cacheä¸­ï¼Œç¼–è¯‘æ—¶å¦‚æœç¢°åˆ°éœ€è¦å¯¼å…¥æ¨¡å—æ—¶ï¼Œä¼šå…ˆæ£€æŸ¥Module Cacheï¼Œæœ‰å¯¹åº”çš„äºŒè¿›åˆ¶æ–‡ä»¶å°±ç›´æ¥åŠ è½½ï¼Œæ²¡æœ‰æ‰ä¼šè§£æï¼Œä»¥æ­¤æ¥ä¿è¯Moduleè§£æåªæœ‰ä¸€æ¬¡ã€‚é‡æ–°è§£æç¼–è¯‘Moduleåªä¼šå‘ç”Ÿåœ¨å¤´æ–‡ä»¶åŒ…å«çš„ä»»ä½•å¤´æ–‡ä»¶æœ‰å˜åŠ¨ï¼Œæˆ–è€…ä¾èµ–å¦å¤–ä¸€ä¸ªæ¨¡å—æœ‰æ›´æ–°çš„æ—¶å€™ã€‚æ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#<span class="keyword">import</span> &lt;FMDB/FMDatabase.h&gt;</span><br></pre></td></tr></table></figure>
<p>Clangä¼šå…ˆä»FMDB.frameworkçš„Headersç›®å½•é‡ŒæŸ¥æ‰¾FMDatabase.hï¼Œå†å»FMDB.frameworkçš„Modulesç›®å½•é‡ŒæŸ¥æ‰¾module.modulemapæ–‡ä»¶ï¼Œåˆ†æmodule.modulemapæ¥åˆ¤æ–­FMDatabase.hæ˜¯å¦æ˜¯æ¨¡å—çš„ä¸€éƒ¨åˆ†ã€‚Module Mapç”¨æ¥å®šä¹‰Moduleå’Œå¤´æ–‡ä»¶ä¹‹é—´çš„å…³ç³»ã€‚FMDB.frameworkçš„module.modulemapçš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">framework <span class="class"><span class="keyword">module</span> <span class="title">FMDB</span> &#123;</span></span><br><span class="line">  umbrella header <span class="string">&quot;FMDB-umbrella.h&quot;</span></span><br><span class="line"></span><br><span class="line">  export *</span><br><span class="line">  <span class="class"><span class="keyword">module</span> * &#123; <span class="title">export</span> * &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æƒ³è¦ç¡®å®šFMDatabase.hæ˜¯å¦æ˜¯Moduleçš„ä¸€éƒ¨åˆ†å°±è¦çœ‹module.modulemapé‡Œçš„Umbrella Headeræ–‡ä»¶ï¼Œå³FMDB-umbrella.hç›®å½•é‡Œæ˜¯å¦åŒ…å«äº†FMDatabase.hã€‚åœ¨Headersç›®å½•é‡ŒæŸ¥çœ‹FMDB-umbrella.hæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __OBJC__</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> FOUNDATION_EXPORT</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(__cplusplus)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FOUNDATION_EXPORT extern <span class="meta-string">&quot;C&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FOUNDATION_EXPORT extern</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">&quot;FMDatabase.h&quot;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&quot;FMDatabaseAdditions.h&quot;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&quot;FMDatabasePool.h&quot;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&quot;FMDatabaseQueue.h&quot;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&quot;FMDB.h&quot;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&quot;FMResultSet.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">FOUNDATION_EXPORT <span class="keyword">double</span> FMDBVersionNumber;</span><br><span class="line">FOUNDATION_EXPORT <span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> FMDBVersionString[];</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç ä¸­å¯ä»¥çœ‹åˆ°FMDatabase.hå·²ç»åŒ…å«åœ¨æ–‡ä»¶ä¸­ï¼Œå› æ­¤Clangä¼šå°†FMDBä½œä¸ºModuleå¯¼å…¥ã€‚Umbrellaæ¡†æ¶æ˜¯å¯¹æ¡†æ¶çš„ä¸€ä¸ªå°è£…ï¼Œç›®çš„æ˜¯éšè—å„ä¸ªæ¡†æ¶ä¹‹é—´çš„å¤æ‚ä¾èµ–å…³ç³»ã€‚æ„å»ºå®Œçš„Moduleä¼šè¢«å­˜æ”¾åˆ° ~/Library/Developer/Xcode/DerivedData/ModuleCache.noindex/ è¿™ä¸ªç›®å½•ä¸‹é¢ã€‚</p>
<p>Clangç¼–è¯‘å•ä¸ªOCæ–‡ä»¶æ˜¯é€šè¿‡å¯¼å…¥å¤´æ–‡ä»¶æ–¹å¼è¿›è¡Œçš„ï¼Œè€ŒSwiftæ²¡æœ‰å¤´æ–‡ä»¶ï¼Œæ‰€ä»¥Swiftç¼–è¯‘å™¨Swiftcå°±éœ€è¦å…ˆæŸ¥æ‰¾å£°æ˜ï¼Œå†æ¥ç”Ÿæˆæ¥å£ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒSwiftcè¿˜ä¼šåœ¨Module Mapæ–‡ä»¶å’ŒUmbrella Headeræ–‡ä»¶ä¸­æš´éœ²çš„å£°æ˜é‡ŒæŸ¥æ‰¾OCå£°æ˜ã€‚</p>
<p>å¦‚æœå·¥ç¨‹è¦æ„å»ºäºŒè¿›åˆ¶åº“ï¼Œéœ€è¦æ”¯æŒSwift 5.1åŠ çš„Module Stabilityå’ŒLibrary Evolutionã€‚</p>
<h3 id="Name-Mangling"><a href="#Name-Mangling" class="headerlink" title="Name Mangling"></a>Name Mangling</h3><p>æ‰¾åˆ°OCå£°æ˜åï¼ŒSwiftcå°±éœ€è¦è¿›è¡ŒName Manglingã€‚Name Manglingçš„ä½œç”¨åœ¨ä¸€æ–¹é¢æ˜¯ä¼šåƒC++é‚£æ ·é˜²æ­¢å‘½åå†²çªï¼Œå¦å¤–ä¸€æ–¹é¢æ˜¯ä¼šå¯¹OCæ¥å£å‘½åè¿›è¡ŒSwifté£æ ¼åŒ–é‡å‘½åã€‚å¦‚æœå¯¹Name Manglingå‘½åçš„æ•ˆæœä¸æ»¡æ„ï¼Œè¿˜å¯ä»¥å›åˆ°OCæºç ä¸­ç”¨NS_SWIFT_NAMEé‡æ–°å®šä¹‰æƒ³è¦åœ¨Swiftä½¿ç”¨çš„åå­—ã€‚</p>
<p>Swiftcçš„Name Manglingç›¸æ¯”è¾ƒäºCå’ŒC++çš„Name Manglingä¼šç”Ÿæˆæ›´å¤šä¿¡æ¯ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">int2string</span>(<span class="params">number</span>: <span class="type">Int</span>)</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;<span class="subst">\(number)</span>&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Swiftcç¼–è¯‘åï¼Œä½¿ç”¨nm -gæŸ¥çœ‹ç”Ÿæˆå¦‚ä¸‹çš„ä¿¡æ¯ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0000000000003de0 <span class="type">T</span> <span class="keyword">_</span><span class="variable">$s8demotest10int2string6numberSSSi_tF</span></span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šæ‰€ç¤ºï¼Œä¿¡æ¯ä¸­çš„$sè¡¨ç¤ºå…¨å±€ï¼Œ8demotestçš„demotestæ˜¯Moduleåï¼Œ8æ˜¯Moduleåçš„é•¿åº¦ã€‚int2stringæ˜¯å‡½æ•°åï¼Œå‰é¢çš„10æ˜¯ç±»åé•¿åº¦ï¼Œ6numberæ˜¯å‚æ•°åã€‚SSè¡¨ç¤ºå‚æ•°ç±»å‹æ˜¯Intã€‚Siè¡¨ç¤ºçš„æ˜¯Stringç±»å‹ï¼Œ_tFè¡¨ç¤ºå‰é¢çš„Siæ˜¯è¿”å›ç±»å‹ã€‚</p>
<p>æ¥ä¸‹æ¥å¯¹æ¯”ä¸€ä¸‹Clangå’ŒSwiftcçš„ç¼–è¯‘è¿‡ç¨‹ï¼Œé¦–å…ˆæ˜¯Clangçš„ç¼–è¯‘è¿‡ç¨‹ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/uploads/acfun-swift-practice/13.png" alt=""></p>
<p>å…¶æ¬¡æ˜¯Swiftçš„ç¼–è¯‘è¿‡ç¨‹ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/uploads/acfun-swift-practice/14.png" alt=""></p>
<p>ä»ä¸¤è€…çš„å¯¹æ¯”ä¸­å¯ä»¥çœ‹å‡ºï¼ŒSwiftç¼–è¯‘è¿‡ç¨‹ç¼ºå°‘äº†å¤´æ–‡ä»¶ï¼Œå› ä¸ºå®ƒé€šè¿‡åˆ†ç»„ç¼–è¯‘æ¨¡ç³Šäº†æ–‡ä»¶çš„æ¦‚å¿µï¼Œå‡å°‘äº†å¾ˆå¤šé‡å¤æŸ¥æ‰¾å£°æ˜çš„å·¥ä½œï¼Œè¿™æ ·ä¸ä»…ä»…å¯ä»¥ç®€åŒ–ä»£ç çš„ç¼–å†™ï¼Œè¿˜å¯ä»¥ç»™ç¼–è¯‘å™¨æ›´å¤šçš„å‘æŒ¥ç©ºé—´ã€‚</p>
<p>è‡³äºOCæ€æ ·è°ƒç”¨Swiftæ¥å£ï¼ŒSwiftcä¼šç”Ÿæˆä¸€ä¸ªå¤´æ–‡ä»¶ï¼Œä»£ç ä¸­æœ‰Publicçš„å£°æ˜ä¼šå…ˆæŒ‰æ–‡ä»¶ç”ŸæˆSwiftmoduleï¼Œæ–‡ä»¶é“¾æ¥å®Œä¼šåˆå¹¶Swiftmoduleï¼Œæœ€åæ•´ä½“ç”Ÿæˆåˆ°ä¸€ä¸ªå¤´æ–‡ä»¶é‡Œã€‚è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/uploads/acfun-swift-practice/15.png" alt=""></p>
<h3 id="ä¸ºä»€ä¹ˆå¯ä»¥è°ƒOCæ¥å£ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆå¯ä»¥è°ƒOCæ¥å£ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆå¯ä»¥è°ƒOCæ¥å£ï¼Ÿ"></a>ä¸ºä»€ä¹ˆå¯ä»¥è°ƒOCæ¥å£ï¼Ÿ</h3><p>Swiftä»£ç ä¹‹æ‰€ä»¥å¯ä»¥è°ƒOCæ¥å£ï¼Œæ˜¯å› ä¸ºOCçš„æ¥å£ä¼šè¢«ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆä¸ºSwiftè¯­æ³•æ¥å£æ–‡ä»¶ã€‚åœ¨Xcodeä¸­ï¼Œåœ¨OCå¤´æ–‡ä»¶ä¸­ç‚¹å‡»å·¦ä¸Šè§’çš„ Related Itemsï¼Œé€‰æ‹©Generated Interfaceï¼Œå°±å¯ä»¥é€‰æ‹©æŸ¥çœ‹ç”Ÿæˆçš„Swiftç‰ˆæœ¬æ¥å£æ–‡ä»¶ã€‚è‡ªåŠ¨è½¬æ¢æˆçš„Swiftæ¥å£æ–‡ä»¶å¯ä»¥ç›´æ¥ä¾›Swiftè°ƒç”¨ï¼Œåœ¨è½¬æ¢è¿‡ç¨‹ä¸­ï¼Œç¼–è¯‘å™¨ä¼šå°†NSStringè¿™ç§OCçš„åŸºç¡€åº“è½¬æ¢æˆSwifté‡Œå¯¹åº”çš„Stringã€Dateç­‰Swiftåº“ã€‚OCçš„åˆå§‹åŒ–æ–¹æ³•ä¹Ÿä¼šè¢«è½¬æ¢æˆSwiftçš„æ„é€ å™¨æ–¹æ³•ã€‚é”™è¯¯å¤„ç†ä¹Ÿä¼šè¢«è½¬æ¢æˆSwifté£æ ¼ã€‚ä¸‹é¢æ˜¯OCå’ŒSwiftè½¬æ¢å¯¹åº”çš„ç±»å‹ï¼š</p>
<p><img src="/uploads/acfun-swift-practice/16.png" alt=""></p>
<p>ä½†æ˜¯ï¼Œä»…ä»…åªä¾èµ–äºç¼–è¯‘å™¨çš„è½¬æ¢è‚¯å®šæ˜¯ä¸å¤Ÿçš„ï¼Œä¸ºäº†èƒ½è®©Swiftè°ƒç”¨å¾—æ›´åŠ èˆ’æœï¼Œè¿˜éœ€è¦å¯¹OCæ¥å£åšäº›ä¿®æ”¹é€‚é…ï¼Œæ¯”å¦‚å°†å‡½æ•°æ”¹æˆä½¿ç”¨OCæ³›å‹ï¼ŒNSArray pathsè½¬æˆSwiftæ˜¯open var paths:[Any]ï¼›å¦‚æœä½¿ç”¨äº†æ³›å‹ï¼Œå°†å…¶æ”¹æˆ NSArray pathsï¼Œé‚£å¯¹åº”çš„Swiftå°±æ˜¯open var paths:[KSPath]ï¼Œè¿™ç§æ¥å£Swiftä½¿ç”¨èµ·æ¥ä¼šæ›´æ–¹ä¾¿æœ‰æ•ˆã€‚</p>
<p>è‹¹æœå…¬å¸ä¹Ÿæä¾›äº†ä¸€äº›å®æ¥å¸®åŠ©ç”Ÿæˆå¥½ç”¨çš„Swiftæ¥å£ã€‚</p>
<p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒOCä¹‹å‰ä¸€ç›´ç¼ºå°‘æ˜¯éç©ºçš„ç±»å‹ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡ NS_ASSUME_NONNULL_BEGINå’ŒNS_ASSUME_NONNULL_ENDåŒ…èµ·æ¥ï¼Œè¿™æ ·å°±ä¸ç”¨é€ä¸ªå»æŒ‡å®šæ˜¯éç©ºäº†ã€‚NS_DESIGNATED_INITIALIZERå®å¯ä»¥å°†åˆå§‹åŒ–è®¾ç½®ä¸ºDesignatedï¼Œä¸åŠ è¿™ä¸ªå®ä¸ºConvenienceã€‚NS_SWIFT_NAMEç”¨æ¥é‡å‘½åSwiftä¸­ä½¿ç”¨çš„åç§°ï¼ŒNS_REFINED_FOR_SWIFTå¯ä»¥è§£å†³æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p>
<p>åœ¨iOSå¼€å‘çš„è¿‡ç¨‹ä¸­ä¸å¯é¿å…åœ°éœ€è¦è®¿é—® Core Foundation ç±»å‹ï¼ŒCore Fundationæ¡†æ¶ä¸€æ—¦å¯¼å…¥åˆ°Swiftæ··ç¼–ç¯å¢ƒä¸­ï¼Œå®ƒçš„ç±»å‹å°±ä¼šè¢«è‡ªåŠ¨è½¬ä¸ºSwiftç±»ï¼ŒSwiftä¹Ÿä¼šè‡ªåŠ¨ç®¡ç†Annotated Core Foundationå¯¹è±¡çš„å†…å­˜ï¼Œè€Œä¸ç”¨åƒåœ¨OCä¸­é‚£æ ·æ‰‹åŠ¨è°ƒç”¨CFRetainã€CFReleaseæˆ–è€…CFAutoreleaseå‡½æ•°ã€‚Unannotatedçš„å¯¹è±¡ä¼šè¢«åŒ…è£…åœ¨ä¸€ä¸ªUnmanagedç»“æ„é‡Œï¼Œæ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CFStringRef</span> showTwoString(<span class="built_in">CFStringRef</span> s1, <span class="built_in">CFStringRef</span> s2)</span><br></pre></td></tr></table></figure>
<p>è½¬æˆSwiftå°±æ˜¯ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">showTwoString</span>(<span class="keyword">_</span>: <span class="type">CFString</span>!, <span class="keyword">_</span>: <span class="type">CFString</span>!)</span> -&gt; <span class="type">Unmanaged</span>&lt;<span class="type">CFString</span>&gt;! &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šé¢ä»£ç æ‰€ç¤ºï¼ŒCore Fundation ç±»å‹çš„åå­—è½¬æ¢åä¼šå»æ‰åç¼€Refï¼Œè¿™æ˜¯å› ä¸ºåœ¨Swiftä¸­æ‰€æœ‰ç±»éƒ½æ˜¯å¼•ç”¨ç±»å‹ï¼ŒRefåç¼€æ¯”è¾ƒå¤šä½™ã€‚ä¸Šé¢çš„Unmanagedç»“æ„æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯takeUnretainedValue()ï¼Œå¦ä¸€ä¸ªæ˜¯takeRetainedValue()ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯ç”¨æ¥è¿”å›å¯¹è±¡çš„åŸå§‹æœªå°è£…ç±»å‹ã€‚å¦‚æœå¯¹è±¡ä¹‹å‰æ²¡æœ‰Retainå°±ç”¨takeUnretainedValue()ï¼Œå·²ç»Retainäº†ï¼Œå°±ç”¨takeRetainedValue()ã€‚</p>
<p>åœ¨Swifté‡Œç”¨getVaList(<em>:</em>:<em>:) æˆ–withVaList(</em>:<em>:) å‡½æ•°è°ƒç”¨Cçš„Variadicå‡½æ•°ï¼Œæ¯”å¦‚ vasprintf(</em>:<em>:</em>:)ã€‚</p>
<p>è°ƒç”¨æŒ‡é’ˆå‚æ•°çš„Cå‡½æ•°ï¼Œå’ŒSwiftæ˜ å°„å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/uploads/acfun-swift-practice/17.png" alt=""></p>
<p>Swiftä¹Ÿæœ‰æ— æ³•è°ƒç”¨çš„Cæ¥å£ï¼Œæ¯”å¦‚å¤æ‚çš„å®ã€Cé£æ ¼çš„Variadicå‚æ•°ï¼Œå¤æ‚çš„Arrayæˆå‘˜ç­‰ã€‚ç®€å•èµ‹å€¼çš„å®ä¼šè¢«è½¬æ¢æˆSwifté‡Œçš„å¸¸é‡èµ‹å€¼ï¼Œå¯¹äºå¤æ‚çš„å®å®šä¹‰ï¼Œç¼–è¯‘å™¨æ— æ³•è‡ªåŠ¨è½¬æ¢ï¼Œå¦‚æœè¿˜æ˜¯æƒ³äº«å—å®å¸¦æ¥çš„å¥½å¤„ï¼Œæ¯”å¦‚å¯ä»¥é¿å…é‡å¤è¾“å…¥å¤§é‡æ¨¡æ¿ä»£ç å’Œé¿å…ç±»å‹æ£€æŸ¥çº¦æŸï¼Œå¯ä»¥é€šè¿‡å‡½æ•°å’Œæ³›å‹æ›¿æ¢è·å–åŒæ ·çš„å¥½å¤„ã€‚</p>
<p>Swiftå†™å‡ºæ¥çš„Moduleä¹Ÿå¯ä»¥ç»™OCæ¥è°ƒç”¨ã€‚ä½†æ˜¯è¿™æ ·çš„è°ƒç”¨ä¼šæœ‰å¾ˆå¤šé™åˆ¶ï¼Œå› ä¸ºSwiftä¸­æœ‰å¾ˆå¤šç±»å‹æ˜¯æ²¡æ³•ç»™OCç”¨çš„ï¼Œæ¯”å¦‚åœ¨Swifté‡Œå®šä¹‰çš„æšä¸¾ã€Swiftå®šä¹‰çš„ç»“æ„ä½“ã€é¡¶å±‚å®šä¹‰çš„å‡½æ•°ã€å…¨å±€å˜é‡ã€Typealiasesã€Nestedç±»å‹ï¼Œä½†æ˜¯å¦‚æœç»•è¿‡è¿™äº›ç±»å‹ï¼ŒSwiftä¹Ÿå˜å¾—ä¸é‚£ä¹ˆSwiftäº†ã€‚</p>
<p>å³ä½¿æ˜¯å®ç°äº†æ··ç¼–ï¼Œå¼€å‘è€…ä»¬è¿˜éœ€è¦é¢å¯¹è®¸å¤šéš¾é¢˜ã€‚å› ä¸ºåœ¨OCæ—¶ä»£çš„å¾ˆå¤šé—®é¢˜ï¼Œä¾‹å¦‚Hookï¼Œæ— ç—•åŸ‹ç‚¹ç­‰å¯ä»¥åœ¨OCè¿è¡Œæ—¶å¾ˆæ–¹ä¾¿åœ°å®ç°ï¼Œè€ŒSwiftå´ç¼ºå°‘å¤©ç„¶çš„æ”¯æŒã€‚ä¸‹é¢ä»‹ç»ä¸€ä¸‹Swiftçš„åŠ¨æ€æ€§ï¼Œåœ¨å®˜æ–¹å®Œå–„å‰ï¼Œæˆ‘ä»¬åº”è¯¥æ€ä¹ˆä½¿ç”¨å®ƒã€‚</p>
<h2 id="åŠ¨æ€æ€§"><a href="#åŠ¨æ€æ€§" class="headerlink" title="åŠ¨æ€æ€§"></a>åŠ¨æ€æ€§</h2><p>Swiftåœ¨å¤„ç†çº¯ç²¹çš„Swiftè¯­è¨€æ—¶æ˜¯æœ‰è‡ªå·±çš„è¿è¡Œæ—¶çš„ï¼Œä½†æ˜¯å¯¹äºâ€œè¿™ä¸ªè¿è¡Œæ—¶æ˜¯ä¸æä¾›è®¿é—®çš„æ¥å£â€çš„é—®é¢˜ï¼ŒSwiftæ ¸å¿ƒå›¢é˜Ÿä¸æ˜¯ä¸åšåŠ¨æ€ç‰¹æ€§ï¼Œè€Œæ˜¯å› ä¸ºå¦‚æœæƒ³è¦æ”¯æŒåŠ¨æ€ç‰¹æ€§å°±éœ€è¦å¤„ç†è™šå‡½æ•°è¡¨ï¼ˆVirtual Method Tableï¼‰çš„åŠ¨æ€è°ƒç”¨å¯¹SILå‡½æ•°ä¼˜åŒ–çš„å½±å“ï¼Œæ¯”å¦‚ç±»æ²¡æœ‰è¢«Overrideå°±ä¼šè‡ªåŠ¨ä¼˜åŒ–åˆ°é™æ€è°ƒç”¨ï¼Œè€Œè¿™éœ€è¦å¤§é‡çš„æ—¶é—´ã€‚ç°é˜¶æ®µè¿˜æœ‰ä¼˜å…ˆçº§æ›´é«˜çš„äº‹æƒ…è¦åšï¼Œæ¯”å¦‚å¹¶å‘æ¨¡å‹ã€ç³»ç»Ÿç¼–ç¨‹ã€é™æ€åˆ†ææ”¯æŒç±»å‹çŠ¶æ€ç­‰ã€‚å› æ­¤ï¼Œæœ‰äººé€‰æ‹©è‡ªå·±å»å®ç°ä¸€å¥—Swiftè¿è¡Œæ—¶ï¼Œä½¿å¾—Swiftä»£ç å…·æœ‰åŠ¨æ€ç‰¹æ€§ã€‚<a href="https://twitter.com/UINT_MIN"><em>Jordan Rose</em></a>å®ç°äº†ä¸€ä¸ª<a href="https://belkadan.com/source/ppc-swift-project/tree/refs/heads/dev:/stdlib/_Runtime"><em>ç²¾ç®€ç‰ˆçš„Swift</em></a>è¿è¡Œæ—¶ï¼Œæ›´åŠ ä¸¥è°¨çš„è¿è¡Œæ—¶å®ç°å¯ä»¥å‚è€ƒ<a href="https://github.com/Azoy/Echo"><em>Echo</em></a>å’Œ<a href="https://github.com/wickwirew/Runtime"><em>Runtime</em></a>ã€‚</p>
<p>æœ‰äººå¯èƒ½ä¼šé—®ï¼ŒSwiftUIçš„Previewä¸å°±æ˜¯å…¸å‹çš„åœ¨è¿è¡Œæ—¶æ›¿æ¢æ–¹æ³•çš„å—ï¼Ÿä»–æ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿå…¶å®ä»–ä½¿ç”¨çš„æ˜¯@_dynamicReplacementå±æ€§ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯ä»¥ç›´æ¥æ‹¿ç€ç”¨æ¥è¿›è¡Œæ–¹æ³•æ›¿æ¢çš„å†…éƒ¨ä½¿ç”¨å±æ€§ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@_dynamicReplacement</span>(for: runSomething())</span><br><span class="line"><span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">_replaceRunSomething</span>()</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="string">&quot;replaced&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæƒ³è¦æŠŠä¸Šé¢çš„ä»£ç æ”¾åˆ°ä¸€ä¸ªåº“ä¸­ï¼Œå¹¶ä¸”åœ¨è¿è¡Œæ—¶åŠ è½½è¿™ä¸ªåº“è¿›è¡Œè¿è¡Œæ—¶æ–¹æ³•æ›¿æ¢å¯ä»¥é€šè¿‡è¿™æ ·çš„æ–¹å¼ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">runSomething()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> file <span class="operator">=</span> <span class="type">URL</span>(fileURLWithPath: <span class="string">&quot;/path/of/replaceLib.dylib&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> handle <span class="operator">=</span> dlopen(file.path, <span class="type">RTLD_NOW</span>) <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">fatalError</span>(<span class="string">&quot;oops dlopen failed&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">runSomething()</span><br></pre></td></tr></table></figure>
<p>é™¤äº†è¿™ä¸ªæ–¹æ³•ä»¥å¤–ï¼Œè¿˜æœ‰å…¶ä»–åŠæ³•å¯ä»¥è¿›è¡Œè¿è¡Œæ—¶çš„æ–¹æ³•æ›¿æ¢å—ï¼Ÿ</p>
<h3 id="å€¼ç±»å‹çš„æ–¹æ³•æ›¿æ¢"><a href="#å€¼ç±»å‹çš„æ–¹æ³•æ›¿æ¢" class="headerlink" title="å€¼ç±»å‹çš„æ–¹æ³•æ›¿æ¢"></a>å€¼ç±»å‹çš„æ–¹æ³•æ›¿æ¢</h3><p>é€šè¿‡ AnyClasså’Œclass_getSuperclassæ–¹æ³•å¯ä»¥æŸ¥çœ‹Swiftå¯¹è±¡çš„ç»§æ‰¿é“¾ï¼Œæ²¡æœ‰ç»§æ‰¿NSObjectçš„Swiftç±»ï¼Œä¼šæœ‰ä¸€ä¸ªéšå«çš„Super Classï¼Œè¿™ä¸ªç±»ä¼šå¸¦æœ‰ä¸€ä¸ªç”Ÿæˆçš„å¸¦å‰ç¼€çš„SwiftObjectï¼Œæ¯”å¦‚_TtCs12_SwiftObjectã€‚Swiftæ˜¯å®ç°äº†NSObjectçš„ä¸€ä¸ªobjcè¿è¡Œæ—¶çš„ç±»å‹ï¼Œè¿™ä¸ªç±»å‹ä¸èƒ½å’ŒOCäº¤äº’ã€‚ä½†æ˜¯å¦‚æœç»§æ‰¿äº†NSObjectå°±å¯ä»¥å’ŒOCäº¤äº’ã€‚</p>
<p>å¦‚æœæ–¹æ³•æˆ–å±æ€§å£°æ˜äº† @objc dynamicï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡åŠ¨æ€æ´¾å‘åœ¨Swiftå¯¹è±¡ä¸Šå»è°ƒç”¨ï¼Œæ–¹æ³•æ˜¯ï¼šä½¿ç”¨AnyObjectçš„Performæ–¹æ³•å»æ‰§è¡ŒNSSelectorFromStringé‡Œä¼ å…¥çš„æ–¹æ³•æˆ–å±æ€§åã€‚</p>
<p>å¯¹äºSwifté‡Œçš„å€¼ç±»å‹ï¼Œæ¯”å¦‚Structã€Enumã€Arrayç­‰ï¼Œå¯ä»¥éµå¾ª_ObjectiveCBridgeableåè®®ï¼Œç»è¿‡Type Castingï¼ˆæ˜¾ç¤ºæˆ–éšå¼ï¼‰è½¬æˆå¯¹åº”çš„OCå¯¹è±¡ç±»å‹ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæƒ³è¦æŸ¥çœ‹Arrayçš„ç±»ç»§æ‰¿å…³ç³»ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">classes</span>(<span class="params">of</span> <span class="params">cls</span>: <span class="type">AnyClass</span>)</span> -&gt; [<span class="type">AnyClass</span>] &#123;</span><br><span class="line">    <span class="keyword">var</span> clses:[<span class="type">AnyClass</span>] <span class="operator">=</span> []</span><br><span class="line">    <span class="keyword">var</span> cls: <span class="type">AnyClass</span>? <span class="operator">=</span> cls</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">let</span> _cls <span class="operator">=</span> cls &#123;</span><br><span class="line">        clses.append(_cls)</span><br><span class="line">        cls <span class="operator">=</span> class_getSuperclass(_cls)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> clses</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> arrays <span class="operator">=</span> [<span class="string">&quot;jone&quot;</span>, <span class="string">&quot;rose&quot;</span>, <span class="string">&quot;park&quot;</span>]</span><br><span class="line"><span class="built_in">print</span>(classes(of: object_getClass(arrays)<span class="operator">!</span>))</span><br><span class="line"><span class="comment">// [Swift.__SwiftDeferredNSArray, Swift.__SwiftNativeNSArrayWithContiguousStorage, Swift.__SwiftNativeNSArray, __SwiftNativeNSArrayBase, NSArray, NSObject]</span></span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šé¢ä»£ç æ‰€ç¤ºï¼ŒSwiftçš„Arrayæœ€ç»ˆéƒ½æ˜¯ç»§æ‰¿è‡ªNSObjectï¼Œå…¶å®ƒå€¼ç±»å‹ä¹Ÿç±»ä¼¼ã€‚å¯ä»¥çœ‹å‡ºï¼Œæ‰€æœ‰Swiftç±»å‹éƒ½æ˜¯å¯å…¼å®¹objcè¿è¡Œæ—¶çš„ã€‚å› æ­¤å¯ä»¥ç»™è¿™äº›å€¼ç±»å‹æ·»åŠ objcè¿è¡Œæ—¶æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK: ä¸ºSwiftç±»å‹æä¾›åŠ¨æ€æ´¾å‘çš„èƒ½åŠ›</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">structWithDynamic</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> str: <span class="type">String</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">show</span>(<span class="keyword">_</span> <span class="params">str</span>: <span class="type">String</span>)</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Say <span class="subst">\(str)</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> str</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">internal</span> <span class="function"><span class="keyword">func</span> <span class="title">showDynamic</span>(<span class="keyword">_</span> <span class="params">obj</span>: <span class="type">AnyObject</span>, <span class="params">str</span>: <span class="type">String</span>)</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> show(str)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> structValue <span class="operator">=</span> structWithDynamic(str: <span class="string">&quot;Hi!&quot;</span>)</span><br><span class="line"><span class="comment">// ä¸º structValue æ·»åŠ Objcè¿è¡Œæ—¶æ–¹æ³•</span></span><br><span class="line"><span class="keyword">let</span> block: <span class="keyword">@convention(block)</span>(<span class="type">AnyObject</span>, <span class="type">String</span>) -&gt; <span class="type">String</span> <span class="operator">=</span> structValue.showDynamic</span><br><span class="line"><span class="keyword">let</span> imp <span class="operator">=</span> imp_implementationWithBlock(<span class="built_in">unsafeBitCast</span>(block, to: <span class="type">AnyObject</span>.<span class="keyword">self</span>))</span><br><span class="line"><span class="keyword">let</span> dycls: <span class="type">AnyClass</span> <span class="operator">=</span> object_getClass(structValue)<span class="operator">!</span></span><br><span class="line">class_addMethod(dycls, <span class="type">NSSelectorFromString</span>(<span class="string">&quot;objcShow:&quot;</span>), imp, <span class="string">&quot;@24@0:8@16&quot;</span>)</span><br><span class="line"><span class="comment">// ä½¿ç”¨ObjcåŠ¨æ€æ´¾å‘</span></span><br><span class="line"><span class="keyword">_</span> <span class="operator">=</span> (structValue <span class="keyword">as</span> <span class="type">AnyObject</span>).perform(<span class="type">NSSelectorFromString</span>(<span class="string">&quot;objcShow:&quot;</span>), with: <span class="type">String</span>(<span class="string">&quot;Bye!&quot;</span>))<span class="operator">!</span></span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šé¢ä»£ç æ‰€ç¤ºï¼Œå–å‡ºå‡½æ•°é—­åŒ…å¯ä»¥é€šè¿‡ @convertion(block)è½¬æ¢æˆCå‡½æ•°Call Conventionæ¥è°ƒç”¨ï¼ŒCå‡½æ•°ä¹Ÿå¯ä»¥ç›´æ¥å»æ‰§è¡Œè¿™ä¸ªæŒ‡é’ˆã€‚ä½¿ç”¨ Memory Dump å·¥å…·å¯ä»¥æŸ¥çœ‹Swiftå‡½æ•°å†…å­˜ç»“æ„ï¼Œä»¥åŠè§£æå‡ºç¬¦å·ä¿¡æ¯DL_Infoã€‚Memory Dumpå·¥å…·æœ‰Mikeashçš„<a href="https://github.com/mikeash/memorydumper2"><em>memorydumper2</em></a>ï¼Œæºç è§£è¯»å¯ä»¥å‚è€ƒ<a href="https://www.mikeash.com/pyblog/friday-qa-2014-08-29-swift-memory-dumping.html"><em>Swift Memory Dumping</em></a>ã€‚é€†å‘æŸ¥çœ‹å†…å­˜å¸ƒå±€å¯ä»¥å‚è€ƒ<a href="https://github.com/neil-wu/FridaHookSwiftAlamofire/blob/master/howto.md"><em>ã€Šåˆæ¢Swift Runtimeï¼šä½¿ç”¨Fridaå®ç°é’ˆå¯¹Alamofireçš„æŠ“åŒ…å·¥å…·ã€‹</em></a><br>__</p>
<h3 id="ç±»çš„æ–¹æ³•æ›¿æ¢"><a href="#ç±»çš„æ–¹æ³•æ›¿æ¢" class="headerlink" title="ç±»çš„æ–¹æ³•æ›¿æ¢"></a>ç±»çš„æ–¹æ³•æ›¿æ¢</h3><p>åœ¨è¿è¡Œæ—¶è¿›è¡Œç±»æ–¹æ³•çš„æ›¿æ¢æ—¶ï¼Œå…ˆå°†æ–¹æ³•çš„Blockä»¥AnyObjectç±»å‹ä¼ å…¥imp_implementationWithBlockæ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªimpï¼Œç„¶åä½¿ç”¨ class_getInstanceMethod æ¥è·å–å®ä¾‹çš„åŸæ–¹æ³•ï¼Œå†é€šè¿‡ class_replaceMethod è¿›è¡Œæ–¹æ³•æ›¿æ¢ï¼Œå®Œæ•´ä»£ç å¯ä»¥å‚çœ‹<a href="https://github.com/steipete/InterposeKit"><em>InterposeKit</em></a>ï¼Œå¦å¤–è¿˜æœ‰ä¸€ä¸ªä½¿ç”¨libffiçš„æ–¹æ³•æ›¿æ¢åº“ï¼Œå‚è§<a href="https://github.com/623637646/SwiftHook"><em>SwiftHook</em></a>ã€‚</p>
<p>å¦å¤–ï¼Œé€šè¿‡è·å–å‡½æ•°åœ°å€æ¥æ”¹å˜å‡½æ•°æŒ‡å‘ä½ç½®çš„æ–¹æ³•åœ¨Swifté‡Œå®ç°æ¯”è¾ƒå›°éš¾ï¼Œè¿™æ˜¯å› ä¸ºNSInvocationä¸å¯ç”¨äº†ï¼Œå› æ­¤éœ€è¦é€šè¿‡Cçš„å‡½æ•°æ¥Hook Swiftã€‚åœ¨Swiftçš„AnyClassä¸­æœ‰ç±»ä¼¼OCçš„å¸ƒå±€ï¼Œè®°å½•äº†æŒ‡å‘ç±»å’Œç±»æˆå‘˜å‡½æ•°çš„æ•°æ®ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨æ±‡ç¼–æ¥åšå‡½æ•°æŒ‡é’ˆæ›¿æ¢çš„äº‹æƒ…ã€‚æ€è·¯æ˜¯ï¼šä¿å­˜å¯„å­˜å™¨ï¼Œè°ƒç”¨æ–°å‡½æ•°ï¼Œç„¶åæ¢å¤å¯„å­˜å™¨ï¼Œè¿˜åŸå‡½æ•°ã€‚å…·ä½“å¯ä»¥å‚è€ƒé¡¹ç›®<a href="https://github.com/johnno1962/SwiftTrace"><em>SwiftTrace</em></a>ã€‚</p>
<h3 id="æ’æ¡©"><a href="#æ’æ¡©" class="headerlink" title="æ’æ¡©"></a>æ’æ¡©</h3><p>ä½¿ç”¨ç¼–è¯‘æ’æ¡©çš„æ–¹å¼ä¹Ÿå¯ä»¥å®ç°è¿è¡Œä¸­çš„æ–¹æ³•æ›¿æ¢ï¼Œå…³é”®æ­¥éª¤åœ¨äºç¼–è¯‘æ—¶ï¼Œéœ€è¦ä½¿ç”¨DYLD_INSERT_LIBRARIESè¿›è¡Œæ‹¦æˆªï¼ŒCommandLine.argumentså¯ä»¥å¾—åˆ°Swiftcçš„æ‰§è¡Œå‚æ•°ï¼Œä»¥æŸ¥æ‰¾å¾…ç¼–è¯‘çš„Swiftæ–‡ä»¶ã€‚é€šè¿‡è‹¹æœå…¬å¸çš„<a href="https://github.com/apple/swift-syntax"><em>SwiftSyntax</em></a>æºä»£ç è§£æã€ç”Ÿæˆå’Œè½¬æ¢çš„å·¥å…·å¯ä»¥æŸ¥å‡ºæ‰€æœ‰æ–¹æ³•ï¼Œå¹¶æ’å…¥ç‰¹å®šçš„æ–¹æ³•æ›¿æ¢é€»è¾‘ä»£ç ã€‚ä¿®æ”¹å®Œé€šè¿‡-output-file-mapæ¥è·å–mach-oçš„åœ°å€å»è¦†ç›–å…ˆå‰äº§ç‰©ã€‚ä½¿ç”¨self.originalImplementation(â€¦)è°ƒç”¨åŸå§‹çš„å®ç°ä½œä¸ºé—­åŒ…ä¼ å…¥execute(arguments:originalImpl:)æ–¹æ³•ã€‚</p>
<h3 id="ClassContextDescriptorBuilder"><a href="#ClassContextDescriptorBuilder" class="headerlink" title="ClassContextDescriptorBuilder"></a>ClassContextDescriptorBuilder</h3><p>Swiftè¿è¡Œæ—¶ç»™æ¯ä¸ªç±»å‹ä¿ç•™äº†Metadataä¿¡æ¯ã€‚Metadataæ˜¯ç”±ç¼–è¯‘å™¨é™æ€ç”Ÿæˆçš„ï¼Œæœ‰äº†Metadataçš„è°ƒè¯•æ‰èƒ½å¤Ÿå‘ç°ç±»å‹çš„ä¿¡æ¯ã€‚Metadataåç§»-1æ˜¯Witness table æŒ‡é’ˆï¼ŒWitness Table æä¾›åˆ†é…ã€å¤åˆ¶å’Œé”€æ¯ç±»å‹çš„å€¼ï¼ŒWitness Table è¿˜è®°å½•äº†ç±»å‹å¤§å°ã€å¯¹é½ã€Strideç­‰å…¶å®ƒå±æ€§ã€‚Metadataåç§»é‡0çš„åœ°æ–¹æ˜¯Kindå­—æ®µï¼Œå…¶æè¿°äº†Metadataæ‰€æè¿°çš„ç±»å‹çš„ç§ç±»ï¼Œä¾‹å¦‚Classã€Structã€Enumã€Optionalã€Opaqueã€Tupleã€Functionã€Protocolç­‰ç±»å‹ã€‚è¿™äº›ç±»å‹çš„Metadataå…·ä½“è¯¦è¿°å¯è§<a href="https://github.com/apple/swift/blob/main/docs/ABI/TypeMetadata.rst"><em>Type Metadata çš„å®˜æ–¹æ–‡æ¡£</em></a>ï¼Œä»£ç æè¿°å¯ä»¥åœ¨<a href="https://github.com/apple/swift/blob/3ed11125f3e987722c14c10ac9c1c7ec25a86c65/include/swift/ABI/MetadataValues.h"><em>include/swift/ABI/MetadataValues.h</em></a>é‡Œçœ‹åˆ°ã€‚æ¯”å¦‚åœ¨Metadataé‡Œç±»çš„æ–¹æ³•æ•°é‡ä¼šæ¯”å®é™…ä»£ç é‡Œå†™çš„æ–¹æ³•æ•°é‡è¦å¤šï¼Œé‚£æ˜¯å› ä¸ºç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€äº›æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•çš„ç§ç±»åœ¨MethodDescriptorFlagsç±»ä¸­Kindé‡Œæè¿°äº†ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">class</span> <span class="title">Kind</span> </span>&#123;</span><br><span class="line">    <span class="type">Method</span>,</span><br><span class="line">    <span class="type">Init</span>,</span><br><span class="line">    <span class="type">Getter</span>,</span><br><span class="line">    <span class="type">Setter</span>,</span><br><span class="line">    <span class="type">ModifyCoroutine</span>,</span><br><span class="line">    <span class="type">ReadCoroutine</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒGetterã€Setterä»¥åŠçº¿ç¨‹ç›¸å…³è¯»å†™çš„ModifyCoroutineã€ReadCoroutineç±»å‹éƒ½æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ã€‚</p>
<p>Classçš„å†…å­˜ç»“æ„ç”Ÿæˆæ–¹æ³•å¯ä»¥åœ¨<a href="https://github.com/apple/swift/blob/3ed11125f3e987722c14c10ac9c1c7ec25a86c65/lib/IRGen/GenMeta.cpp"><em>/lib/IRGen/GenMeta.cpp</em></a>é‡Œæ‰¾åˆ°ï¼š</p>
<ul>
<li>ClassContextDescriptorBuilderè¿™ä¸ªç±»æ˜¯ç”¨æ¥ç”ŸæˆClasså†…å­˜ç»“æ„çš„ï¼Œå®ƒç»§æ‰¿äºTypeContextDescriptorBuilderBaseã€‚</li>
<li>Enumã€Structç­‰ç±»å‹çš„å†…å­˜ç»“æ„BuilderåŸºç±»éƒ½æ˜¯ç»§æ‰¿äºContextDescriptorBuilderBaseçš„TypeContextDescriptorBuilderBaseã€‚</li>
<li>ContextDescriptorBuilderBase æ˜¯æœ€åŸºç¡€çš„åŸºç±»ï¼ŒModuleã€Extensionã€Anonymousã€Protocolã€Opaque Typeã€Genericéƒ½æ˜¯ç»§æ‰¿äºå®ƒã€‚</li>
<li>Structçš„Metadataå’ŒEnumçš„Metadataå…±äº«å†…å­˜å¸ƒå±€ï¼ŒStructä¼šå¤šä¸ªæŒ‡å‘Type Context Descriptorçš„æŒ‡é’ˆã€‚</li>
</ul>
<p>å†…å­˜å¸ƒå±€æŒ‡çš„æ˜¯ä½¿ç”¨ä¸€ä¸ªStructæˆ–è€…Tupleï¼Œæ ¹æ®æ¯ä¸ªå­—æ®µçš„å¤§å°å’Œå¯¹é½æ–¹å¼å†³å®šæ€æ ·æ¥å®‰æ’å†…å­˜ä¸­çš„å­—æ®µï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸ä»…éœ€è¦æè¿°æ¸…æ¥šæ¯ä¸ªå­—æ®µçš„åç§»é‡ï¼Œè¿˜æœ‰Structæˆ–Tupleæ•´ä½“çš„å¤§å°å’Œå¯¹é½æ–¹å¼ã€‚ä¸‹é¢å°±æ˜¯GenMetaé‡Œå’ŒClassç±»å‹ç›¸å…³çš„å†…å­˜æ–¹æ³•ä»£ç ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æœ€åº•å±‚åŸºç±» ContextDescriptorBuilderBaseçš„å¸ƒå±€æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">layout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">asImpl</span>().<span class="built_in">addFlags</span>();</span><br><span class="line">  <span class="built_in">asImpl</span>().<span class="built_in">addParent</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TypeContextDescriptorBuilderBaseçš„å¸ƒå±€æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">layout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">asImpl</span>().<span class="built_in">computeIdentity</span>();</span><br><span class="line"></span><br><span class="line">  super::<span class="built_in">layout</span>();</span><br><span class="line">  <span class="built_in">asImpl</span>().<span class="built_in">addName</span>();</span><br><span class="line">  <span class="built_in">asImpl</span>().<span class="built_in">addAccessFunction</span>();</span><br><span class="line">  <span class="built_in">asImpl</span>().<span class="built_in">addReflectionFieldDescriptor</span>();</span><br><span class="line">  <span class="built_in">asImpl</span>().<span class="built_in">addLayoutInfo</span>();</span><br><span class="line">  <span class="built_in">asImpl</span>().<span class="built_in">addGenericSignature</span>();</span><br><span class="line">  <span class="built_in">asImpl</span>().<span class="built_in">maybeAddResilientSuperclass</span>();</span><br><span class="line">  <span class="built_in">asImpl</span>().<span class="built_in">maybeAddMetadataInitialization</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ClassContextDescriptorBuilderçš„å¸ƒå±€æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">layout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  super::<span class="built_in">layout</span>();</span><br><span class="line">  <span class="built_in">addVTable</span>();</span><br><span class="line">  <span class="built_in">addOverrideTable</span>();</span><br><span class="line">  <span class="built_in">addObjCResilientClassStubInfo</span>();</span><br><span class="line">  <span class="built_in">maybeAddCanonicalMetadataPrespecializations</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ ¹æ®GenMetaå¯ä»¥çœ‹åˆ°Swiftçš„Classç±»å‹å†…å­˜å¸ƒå±€æ˜¯æ ¹æ®ContextDescriptorBuilderBaseã€TypeContextDescriptorBuilderBaseå†åˆ°ClassContextDescriptorBuilderç»§æ‰¿å±‚å±‚å åŠ çš„ï¼Œå› æ­¤å¯¹åº”Classç±»å‹çš„Nominal Type Descriptorå°±å¯ä»¥ç”¨å¦‚ä¸‹Cç»“æ„æ¥æè¿°ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SwiftClassInfo</span> &#123;</span></span><br><span class="line">    <span class="keyword">uint32_t</span> flag;</span><br><span class="line">    <span class="keyword">uint32_t</span> parent;</span><br><span class="line">    <span class="keyword">int32_t</span> name;</span><br><span class="line">    <span class="keyword">int32_t</span> accessFunction;</span><br><span class="line">    <span class="keyword">int32_t</span> reflectionFieldDescriptor;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">uint32_t</span> vtable;</span><br><span class="line">    <span class="keyword">uint32_t</span> overrideTable;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ä»£ç ä¸­å¯è§ï¼Œaddçš„å‰ç¼€å°±æ˜¯å¢åŠ çš„åç§»è®°å½•ï¼ŒaddFlagsåé¢çš„addParentå°±æ˜¯ä¸‹ä¸€ä¸ªåç§»çš„è®°å½•ã€‚FieldDescriptoræ¢æˆReflectionFieldDescriptoræ˜¯è‹¹æœå…¬å¸åœ¨5.0ç‰ˆæœ¬å¯¹Metadataåšçš„æ”¹å˜ï¼Œå®˜æ–¹Mirroråå°„ç›®å‰è¿˜ä¸å®Œå–„ï¼Œæœ‰äº›ä¿¡æ¯è¿˜æ²¡æ³•æä¾›ï¼Œå› æ­¤åœ¨Metadataé‡Œå¢åŠ äº†ä¸€äº›åå°„ç›¸å…³ä¿¡æ¯ã€‚</p>
<p>OCåŠ¨æ€è°ƒç”¨æ–¹æ³•ä¼šæŠŠ_cmdä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯Selfï¼Œåé¢æ˜¯å¯å˜å‚æ•°åˆ—è¡¨ï¼ŒåŠ¨æ€è°ƒåº¦å¯ä»¥åœ¨è¿è¡Œæ—¶æ·»åŠ ç±»ã€å˜é‡å’Œæ–¹æ³•ã€‚è€Œåœ¨Swiftä¸­åŠ¨æ€è°ƒç”¨æ–¹æ³•æ˜¯åŸºäºVTableçš„ï¼Œè¿è¡Œæ—¶æ²¡æ³•å¯¹æ–¹æ³•è¿›è¡ŒåŠ¨æ€æœç´¢ï¼Œåœ°å€åœ¨ç¼–è¯‘æ—¶é™æ€å†™åœ¨äº†VTableé‡Œï¼Œè¿è¡Œæ—¶ä¸èƒ½æ”¹ï¼Œå¯ä»¥ç”¨é™æ€åœ°å€è°ƒç”¨ï¼Œæˆ–dlsymæ¥æœç´¢åç§°ã€‚</p>
<p>VTableçš„åœ°å€åœ¨TypeContextDescriptorä¹‹åï¼ŒOverrideTableå­˜å‚¨ä½ç½®åœ¨VTableä¹‹åï¼Œæœ‰ä¸‰ä¸ªå­—æ®µæ¥æè¿°ï¼Œç¬¬ä¸€ä¸ªæ˜¯è®°å½•å“ªä¸ªç±»è¢«é‡å†™ï¼Œç¬¬äºŒä¸ªæ˜¯è¢«é‡å†™çš„å‡½æ•°ï¼Œç¬¬ä¸‰ä¸ªæ˜¯ç”¨æ¥é‡å†™çš„å‡½æ•°ç›¸å¯¹çš„åœ°å€ã€‚å› æ­¤é€šè¿‡OverrideTableå°±å¯ä»¥æ‰¾åˆ°é‡å†™å‰å’Œé‡å†™åå‡½æ•°æŒ‡é’ˆï¼Œè¿™æ ·å°±æœ‰æœºä¼šåœ¨VTableé‡Œæ‰¾åˆ°å¯¹åº”å‡½æ•°è¿›è¡Œå‡½æ•°æŒ‡é’ˆçš„æ›¿æ¢ï¼Œè¾¾åˆ°Hookçš„æ•ˆæœã€‚è¦æ³¨æ„ï¼Œåœ¨Swiftç¼–è¯‘å™¨è®¾ç½®ä¼˜åŒ–æ—¶VTableçš„å‡½æ•°åœ°å€å¯èƒ½ä¼šæ¸…ç©ºæˆ–ä½¿ç”¨ç›´æ¥åœ°å€è°ƒç”¨ï¼Œè¿™ä¸¤ç§æƒ…å†µå‘ç”Ÿçš„è¯å°±æ²¡æ³•é€šè¿‡VTableè¿›è¡Œæ–¹æ³•æ›¿æ¢ã€‚</p>
<p>é‚£ä¹ˆè¿˜æœ‰å…¶å®ƒæ€è·¯å—ï¼Ÿ</p>
<h3 id="Mach-override"><a href="#Mach-override" class="headerlink" title="Mach_override"></a>Mach_override</h3><p>ä½¿ç”¨<a href="https://github.com/rentzsch"><em>Wolf Rentzsch</em></a>å†™çš„<a href="https://github.com/rentzsch/mach_override">_Mach<em>override</em></a>ä¹Ÿæ˜¯ä¸€ç§æ–¹æ³•ï¼Œå¯ä»¥åœ¨åŸå§‹å‡½æ•°çš„æ±‡ç¼–é‡ŒåŠ ä¸ªjmpï¼Œè·³åˆ°è‡ªå®šä¹‰å‡½æ•°ï¼Œç„¶åå†è·³å›åŸå§‹å‡½æ•°ã€‚Mach_override_ptrçš„ä¸‰ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ï¼Œä¸€ï¼Œè¦è¦†ç›–å‡½æ•°çš„æŒ‡é’ˆï¼›äºŒï¼Œå»è¦†ç›–å‡½æ•°çš„æŒ‡é’ˆï¼›ä¸‰ï¼Œå‚æ•°å¯ä»¥è®¾ç½®ä¸ºåŸå‡½æ•°çš„æŒ‡é’ˆåœ°å€ï¼Œå¾…Mach_override_ptrè¿”å›æˆåŠŸï¼Œå°±å¯ä»¥è°ƒåŸå‡½æ•°ã€‚Mach_overrideä¼šåˆ†é…ä¸€ä¸ªè™šæ‹Ÿå†…å­˜é¡µï¼Œä½¿å…¶å¯å†™å¯æ‰§è¡Œã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMach_override_ptråˆå§‹å‡½æ•°å’Œé‡å…¥å‡½æ•°æŒ‡é’ˆç›¸åŒï¼Œè°ƒç”¨åï¼Œé‡å…¥å‡½æ•°å°†è°ƒç”¨æ›¿æ¢å‡½æ•°è€Œä¸æ˜¯åŸå§‹å‡½æ•°ã€‚åœ¨Swiftä¸­å¦‚ä½•ä½¿ç”¨Mach_overrideå¯å‚è€ƒ<a href="https://github.com/lombax85/SwiftOverride"><em>SwiftOverride</em></a>ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é€šè¿‡ä¸Šä¸‹ç¯‡çš„ä»‹ç»ï¼Œæƒ³å¿…ä½ å·²ç»äº†è§£åˆ°Aç«™ä¸ºæ‹¥æŠ±Swiftéƒ½åšäº†å“ªäº›äº‹æƒ…ã€‚åŸºäºAç«™ä»¥åŠå¿«æ‰‹ä¸»ç«™çš„ä¸€äº›æ¶æ„å¸ˆå¯¹äºSwiftçš„çƒ­çˆ±ï¼Œä»¥åŠä¸ºä¹‹ä»˜äºçš„å®è·µï¼ŒAç«™çš„å¼€å‘ä½“éªŒæ‰å¾—ä»¥èœ•å˜ã€‚</p>
<p>ä¸ºäº†è®©OCå¼€å‘åŒå­¦èƒ½å¤ŸæŒæ¡Swiftï¼Œä»¥æ›´â€œSwiftâ€çš„æ–¹å¼è¿›è¡Œå¼€å‘ï¼ŒAç«™ç»„ç»‡äº†åå¤šæ¬¡Swiftç»„å†…çš„åŸ¹è®­å’Œåˆ†äº«ï¼Œå¹¶è§„èŒƒäº†Swiftä»£ç é£æ ¼å’Œé™æ€æ£€æŸ¥æµç¨‹ã€‚é’ˆå¯¹å¼€å‘ä½“éªŒä¸Šçš„ç—›ç‚¹ï¼ŒAç«™åœ¨2020å¹´ä¸ŠåŠå¹´å°±å¼€å§‹äº†æ··ç¼–å·¥ç¨‹çš„ä¼˜åŒ–ã€ç»„ä»¶åŒ–ä»¥åŠäºŒè¿›åˆ¶åŒ–çš„å»ºè®¾ã€‚å®Œæˆäº†åˆ†å±‚è®¾è®¡ï¼Œæ¸è¿›å¼åœ°å°†æ¨¡å—è§£è€¦ä¸‹æ²‰åˆ°å¯¹åº”çš„åˆ†å±‚ï¼Œè¿›è€Œå¯ä»¥å€ŸåŠ©LLVM Moduleæ¥æŠ¹å¹³æ¨¡å—APIåœ¨è¯­è¨€ä¸Šçš„å·®å¼‚ï¼Œä»è€Œä»£æ›¿Swiftå’ŒObjective-Cåœ¨ä¸»å·¥ç¨‹çš„æ¡¥æ¥ï¼Œä¸º10+ Aç«™å’Œä¸­å°çš„åŸºç¡€åº“è¿›è¡Œäº†ModuleåŒ–é—®é¢˜ä¿®å¤ï¼Œå¹¶åŸºäºä¸»ç«™çš„äºŒè¿›åˆ¶åŒ–æ–¹æ¡ˆ ï¼ˆGUNDAMï¼‰å®Œå–„äº†å¯¹Swiftä»¥åŠæ··ç¼–çš„æ”¯æŒã€‚ä»Swift ABI Stabilityè¿›åŒ–ä¸ºModule Stabilityçš„XCFrameworkï¼ŒWWDCçš„<a href="https://developer.apple.com/videos/play/wwdc2019/416/"><em>Session</em></a>å¾ˆå¥½çš„è¯´æ˜XCFrameworkçš„åŸç†ï¼ŒåŒæ—¶è¡¨ç¤ºXCFrameworkæ ¼å¼å¯¹Objective-C/C/C++ä¹Ÿæœ‰å¾ˆå¥½çš„æ”¯æŒã€‚ç›®å‰ç»„ä»¶çš„äºŒè¿›åˆ¶åŒ–ç‡çº¦ä¸º80%ï¼Œçº¦æœ‰50%çš„ç»„ä»¶å·²ç»å®Œæˆäº†LLVM ModuleåŒ–ï¼Œæ„å»ºæ—¶é—´æå‡äº†60%ä»¥ä¸Šã€‚éšç€Swiftä¼˜åŠ¿çš„é€æ¸ä½“ç°ä»¥åŠå›¢é˜ŸSwiftèƒ½åŠ›å»ºè®¾çš„æ¨è¿›ï¼ŒAç«™æ›´å¤šçš„å·¥ç¨‹å¸ˆå¼€å§‹å€¾å‘äºä½¿ç”¨Swiftè¿›è¡Œä¸šåŠ¡å¼€å‘ï¼Œè€ŒSwiftå¸¦æ¥çš„â€œåŠ é€Ÿåº¦â€ï¼Œä¹Ÿè®©æŠ€æœ¯å›¢é˜Ÿåˆ‡å®åœ°æ„Ÿå—åˆ°äº†å¼ºçƒˆçš„â€œæ¨èƒŒæ„Ÿâ€œã€‚</p>
<p>å½“ç„¶ï¼ŒAç«™ä¹Ÿæ›¾é‡åˆ°ä¸€äº›Swiftçš„Bugï¼Œæ¯”å¦‚æ‰“åŒ…RxSwift5åé‡åˆ°æ¨¡å—åå’Œç±»åä¸€æ ·æ‰€äº§ç”Ÿçš„Bugå’Œ<a href="https://bugs.swift.org/browse/SR-12647"><em>Issue</em></a>ï¼ŒRxSwift6é€šè¿‡é¿å…ä½¿ç”¨Typealiasçš„ç±»å‹æ›²çº¿å½¢åœ°è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œç›®å‰æ­¤é—®é¢˜å·²è¢«å®˜æ–¹æ ‡è®°ä¸ºâ€œè§£å†³â€ï¼Œåé¢çš„ç‰ˆæœ¬å¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚å¦å¤–è¿˜æœ‰ä¸¤ä¸ªæœªè§£å†³çš„é—®é¢˜ï¼Œä¸€ä¸ªæ˜¯åœ¨Moduleçš„æ¥å£ä¸­å‡ºç°Ambiguous Type Name Erroré—®é¢˜ï¼Œå‚è€ƒ<a href="https://bugs.swift.org/browse/SR-12646"><em>Issue</em></a><em>ï¼›</em>å¦ä¸€ä¸ªæ˜¯Importåäº§ç”Ÿ.swiftinterfaceå‡ºç°çš„é”™è¯¯ï¼Œå‚è§ç½‘ç«™<a href="https://bugs.swift.org/browse/SR-11422"><em>Issue</em></a>ã€‚</p>
<p>æœ€åæƒ³è¯´çš„æ˜¯ï¼ŒSwiftå¼€å‘å¹¶ä¸å®¹æ˜“ï¼Œä¸è¦è¢«Swiftç®€æ´çš„è¯­æ³•æ‰€è¿·æƒ‘ï¼Œå„ç§å¤§å°æ‹¬å·ç»„åˆä¼šè®©å¼€å‘è€…ä»¬æ„Ÿåˆ°å›°æƒ‘ï¼Œè¿˜æœ‰ä¸€äº›ç‰¹æ€§ä¼šè®©ç›´è§‚ç†è§£å˜å¾—å¾ˆå›°éš¾ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str:<span class="type">String</span>! <span class="operator">=</span> <span class="string">&quot;Hi&quot;</span></span><br><span class="line"><span class="keyword">let</span> strCopy <span class="operator">=</span> str</span><br></pre></td></tr></table></figure>
<p>æ ¹æ®Swiftç±»å‹æ¨å¯¼çš„ç‰¹æ€§ï¼ŒæŒ‰é“ç†strç±»å‹åŠ ä¸Šæ„Ÿå¹ç¬¦å·åï¼ŒstrCopyå°±ä¼šè¢«è‡ªåŠ¨æ¨å¯¼ä¸ºéå¯é€‰Stringç±»å‹ã€‚ä½†å®é™…æƒ…å†µæ˜¯ï¼ŒæŒ‰ç…§<a href="https://docs.swift.org/swift-book/LanguageGuide/TheBasics.html"><em>å®˜æ–¹æ–‡æ¡£</em></a>çš„è¯´æ³•ï¼ŒstrCopyæ²¡æœ‰ç›´æ¥æŒ‡æ˜ç±»å‹ï¼Œå³éšå¼å¯é€‰å€¼æ—¶ï¼Œstrç±»å‹æ˜¯StringååŠ ä¸Šæ„Ÿå¹å·ï¼Œè¿™ç§æ˜¯å±äºéšå«è§£åŒ…å¯é€‰å€¼Stringæ— æ³•æ¨å¯¼å‡ºéå¯é€‰Stringç±»å‹ï¼Œå› æ­¤Swiftä¼šå…ˆå°†strCopyä½œä¸ºä¸€ä¸ªæ™®é€šå¯é€‰å€¼æ¥ç”¨ï¼Œè¿™æ ·å’Œç›´è§‚çš„æ„Ÿè§‰éå¸¸ä¸ä¸€æ ·ã€‚</p>
<p>æœ¬ä»¥ä¸º5.0çš„ABIåœ¨ç¨³å®šåï¼ŒSwiftå­¦èµ·æ¥ä¼šæ›´å®¹æ˜“ï¼Œä½†æ˜¯å…¶å®æ–°çš„SwiftUIå’ŒCombineè¿™æ ·é‡é‡çº§çš„æ¡†æ¶éœ€è¦å¼€å‘è€…ç»§ç»­é’»ç ”ï¼ŒçœŸæ˜¯â€œWrite Swift, Learn Every Yearâ€ã€‚Swiftä¸æ–­ä»å…¶å®ƒè¯­è¨€ä¸­å¸å–ç²¾é«“ï¼Œæ¥ä¸‹æ¥çš„async/awaitï¼Œä½ å‡†å¤‡å¥½äº†å—ï¼Ÿè¦ç”¨ä¸Šï¼Œå…ˆå¾—çœ‹å’±å®¶APPç³»ç»Ÿæœ€ä½ç‰ˆæœ¬æ˜¯ä¸æ˜¯èƒ½å¤Ÿæ”¯æŒè¿™äº›æ–°ç‰¹æ€§ã€‚</p>
<p>è™½è¯´ä¸å®¹æ˜“ï¼Œä½†ä¸ºäº†ç¨³å®šå’Œæ•ˆç‡ï¼Œç»ˆç©¶è·Ÿä¸Šäº†æ—¶ä»£çš„æ­¥ä¼ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ–‡ç« å·²å‘åœ¨å¿«æ‰‹å¤§å‰ç«¯å…¬ä¼—å·ï¼Œæ¬¢è¿å…³æ³¨ï¼Œæ–‡ç« åœ°å€å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s/rUZ8RwhWf4DWAa5YHHynsQ&quot;&gt;Aç«™ çš„ Swift å®è·µ â€”â€” ä¸Šç¯‡&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a h
    
    </summary>
    
      <category term="Programming" scheme="http://ming1016.github.io/categories/Programming/"/>
    
    
      <category term="iOS" scheme="http://ming1016.github.io/tags/iOS/"/>
    
      <category term="Swift" scheme="http://ming1016.github.io/tags/Swift/"/>
    
      <category term="Apple" scheme="http://ming1016.github.io/tags/Apple/"/>
    
  </entry>
  
  <entry>
    <title>æ·±å…¥å‰–æ JavaScript ç¼–è¯‘å™¨/è§£é‡Šå™¨å¼•æ“ QuickJS - å¤šäº†è§£äº› JavaScript è¯­è¨€</title>
    <link href="http://ming1016.github.io/2021/02/21/deeply-analyse-quickjs/"/>
    <id>http://ming1016.github.io/2021/02/21/deeply-analyse-quickjs/</id>
    <published>2021-02-21T04:03:09.000Z</published>
    <updated>2021-04-11T14:42:09.910Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>æœ€è¿‘åœ¨åš JavaScript å’Œ Native æ‰“äº¤é“çš„å·¥ä½œï¼Œè™½ç„¶6å¹´å‰æœåŠ¡ç«¯å’Œå‰ç«¯åŒ…æ‹¬ JavaScript ç»éªŒä¹Ÿæœ‰äº›ï¼Œä¸è¿‡å¦‚ä»Šå‰ç«¯æ ‡å‡†å’Œå‰ç«¯å¼•æ“ä¹Ÿå‘å±•äº†å¾ˆå¤šï¼Œè¿™é‡Œåšä¸ªè®°å½•å§ã€‚æœ¬æ–‡ä¼šç€é‡ä»‹ç» QuickJSï¼Œå…¶ä¸­ä¼šé’ˆå¯¹ js è¯­è¨€çš„ä¸€äº›ç‰¹æ€§æ¥çœ‹è¿™äº›ç‰¹æ€§åœ¨ QuickJS æ˜¯å¦‚ä½•è§£é‡Šæ‰§è¡Œå’Œä¼˜åŒ–çš„ï¼Œèƒ½å¤ŸåŠ æ·±å¯¹ js è¯­è¨€çš„ç†è§£ã€‚QuickJS æ˜¯åœ¨ MIT è®¸å¯ä¸‹å‘çš„ä¸€ä¸ªè½»é‡ js å¼•æ“åŒ…å« js çš„ç¼–è¯‘å™¨å’Œè§£é‡Šå™¨ï¼Œæ”¯æŒæœ€æ–° TC39 çš„ ECMA-262 æ ‡å‡†ã€‚QuickJS å’Œå…¶å®ƒ js å¼•æ“çš„æ€§èƒ½å¯¹æ¯”ï¼Œå¯ä»¥å‚çœ‹ QuickJS çš„ benchmark å¯¹æ¯”<a href="https://bellard.org/quickjs/bench.html">ç»“æœé¡µ</a>ï¼Œä»ç»“æœçœ‹ï¼ŒJerryScript å†…å­˜å’Œä½“ç§¯å°äº QuickJSï¼Œä½†å„é¡¹æ€§èƒ½å‡ä½äº QuickJSï¼ŒHermes ä½“ç§¯å’Œå†…å­˜å¤§äº QuickJSï¼Œæ€§èƒ½å’Œ QuickJS å·®ä¸å¤šï¼Œä½† Hermes å¯¹äº TC39 çš„æ ‡å‡†æ”¯æŒå¹¶æ²¡ QuickJS å…¨ã€‚Frida åœ¨<a href="https://frida.re/news/2020/10/28/frida-14-0-released/">14.0ç‰ˆæœ¬</a>å¼•å…¥äº† QuickJSï¼Œç»ä½œè€…éªŒè¯å†…å­˜ä½¿ç”¨åªæœ‰ V8çš„äº”åˆ†ä¹‹ä¸€ï¼Œäºæ˜¯è®¾ä¸ºé»˜è®¤å¼•æ“ã€‚14.3ç‰ˆæœ¬å°†é»˜è®¤å¼•æ“åˆ‡å› V8ï¼Œä¸»è¦æ˜¯å› ä¸ºæŸäº›åœºæ™¯ V8è¡¨ç°å’Œè°ƒè¯•åŠŸèƒ½æ›´å¥½ï¼Œå¯¹äºè°ƒè¯•å·²ç»åœ¨ Fabrice bellard çš„è§„åˆ’é‡Œäº†ï¼Œæœªæ¥å¯æœŸã€‚</p>
<p>åœ¨è¯¦ç»†ä»‹ç»å’Œå‰–æ QuickJS ä¹‹å‰ï¼Œæˆ‘å…ˆè·Ÿä½ èŠèŠ JavaScript çš„èƒŒæ™¯å’Œ QuickJS ä½œè€…çš„èƒŒæ™¯å§ã€‚æˆ‘è§‰å¾—è¿™æ ·æ›´æœ‰åŠ©äºç†è§£ QuickJSã€‚</p>
<p>å…ˆè¯´è¯´ JavaScriptã€‚</p>
<h3 id="JavaScript-èƒŒæ™¯"><a href="#JavaScript-èƒŒæ™¯" class="headerlink" title="JavaScript èƒŒæ™¯"></a>JavaScript èƒŒæ™¯</h3><p>ç¬¬ä¸€ä¸ªå›¾æ–‡æµè§ˆå™¨æ˜¯1993å¹´çš„ Mosaicï¼Œç”± Marc Andreessen å¼€å‘ã€‚åæ›¿ä»£ Mosaic çš„æ˜¯ Netscape çš„ Netscape Navigator æµè§ˆå™¨ã€‚Brendan Eich ç»™ Netscape å¼€å‘ Java è¾…åŠ©è¯­è¨€ Mochaï¼ˆåæ›´åä¸º JavaScriptï¼‰ï¼Œè€—æ—¶10å¤©å‡ºåŸå‹ï¼ˆåŒ…å«äº†eval å‡½æ•°ï¼‰ï¼Œé›†æˆåˆ° Netscape 2é¢„è§ˆç‰ˆé‡Œï¼ŒMocha åŸºäºå¯¹è±¡è€Œé Java é‚£æ ·åŸºäºç±»ã€‚Mocha é‡‡ç”¨æºç è§£æç”Ÿæˆå­—èŠ‚ç è§£é‡Šæ‰§è¡Œæ–¹å¼è€Œéç›´æ¥ä½¿ç”¨å­—èŠ‚ç çš„åŸå› æ˜¯ Netscape å…¬å¸å¸Œæœ› Mocha ä»£ç ç®€å•æ˜“ç”¨ï¼Œèƒ½å¤Ÿç›´æ¥åœ¨ç½‘é¡µä»£ç ä¸­ç¼–å†™ã€‚</p>
<p>ç›´åˆ°ç°åœ¨å„ js å¼•æ“éƒ½è¿˜ä¸ç›´æ¥ä½¿ç”¨å­—èŠ‚ç ï¼Œè¿™æ˜¯ç”±äºä¸åŒçš„ js å¼•æ“éƒ½æœ‰è‡ªå·±çš„å­—èŠ‚ç è§„èŒƒï¼Œä¸åƒ js ä»£ç è§„èŒƒæœ‰ç»Ÿä¸€ä¸€å¥—ï¼Œè€Œä¸”å­—èŠ‚ç ä¼šæœ‰æ†ç»‘ç‰ˆæœ¬å’ŒéªŒè¯éš¾çš„é—®é¢˜ã€‚ TC39 æœ‰ä»½ä¸­é—´ä»£ç çš„ææ¡ˆï¼Œå«åš Binary ASTï¼Œææ¡ˆåœ¨è¿™ <a href="https://github.com/tc39/proposal-binary-ast">Binary AST Proposal Overview</a>ã€‚Binary AST è¿™ä»½ææ¡ˆè¿˜ä¼šå»è®¾è®¡è§£å†³å˜é‡çš„ç»‘å®šæœºåˆ¶å¯¹è§£ææ€§èƒ½å½±å“ï¼Œè¿˜æœ‰å»¶ç¼“ Early Error è¯­ä¹‰åˆ°æœ€è¿‘çš„ enclosing å‡½æ•°æˆ–å…¨å±€æ‰§è¡Œè„šæœ¬çš„æ—¶å€™æ¥æå‡è§£ææ€§èƒ½ï¼Œè§£å†³åŒºåˆ†åˆ—è¡¨è¡¨è¾¾å¼å’Œç®­å¤´å‡½æ•°å‚æ•°åˆ—è¡¨çš„åŒºåˆ«éœ€è¦åšå›æº¯ç­‰å¯èƒ½ä¼šå­˜åœ¨å­—ç¬¦å±‚é¢æ­§ä¹‰ï¼Œè¿˜æœ‰å•å­—èŠ‚å’ŒåŒå­—èŠ‚ç¼–ç æ£€æŸ¥çš„é—®é¢˜ï¼Œå­—ç¬¦ä¸²å’Œæ ‡è¯†ç¬¦ä½¿ç”¨ UTF-8ï¼Œä¸ç”¨è½¬ä¹‰ç ã€‚Binary AST å€Ÿé‰´ WebAssembly å¯¹è§£æåå¾—åˆ°çš„ AST ä½¿ç”¨åŸºæœ¬ primitivesï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å…ƒç»„ï¼‰æ¥è¿›è¡Œç®€å•äºŒè¿›åˆ¶ç¼–ç ï¼Œå†å‹ç¼©ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½ä¼šæœ‰ä¸ª header æ¥ä¿è¯å‘å‰å’Œå‘åçš„å…¼å®¹ï¼ŒèŠ‚ç‚¹ç§ç±»é€šè¿‡ header çš„ç´¢å¼•æ¥å¼•ç”¨ï¼Œé¿å…ä½¿ç”¨åç§°å¯èƒ½å¸¦æ¥çš„ç‰ˆæœ¬é—®é¢˜ï¼Œä¸ºå‡å°‘å¤§å°ä¼šæ”¯æŒ presetsã€‚</p>
<p>ä¸‹é¢å›åˆ°90å¹´ä»£ï¼Œæ¥ç€è¯´ä»£å·æ˜¯ Mocha çš„ JavaScript å‘å±•å†ç¨‹ã€‚</p>
<p>Mocha çš„åŠ¨æ€çš„å¯¹è±¡æ¨¡å‹ï¼Œä½¿ç”¨åŸå‹é“¾çš„æœºåˆ¶èƒ½å¤Ÿæ›´å¥½å®ç°ï¼Œå¯¹è±¡æœ‰å±æ€§é”®å’Œå¯¹åº”çš„å€¼ï¼Œå±æ€§çš„å€¼å¯ä»¥æ˜¯å¤šç§ç±»å‹åŒ…æ‹¬å‡½æ•°ã€å¯¹è±¡å’ŒåŸºæœ¬æ•°æ®ç±»å‹ç­‰ï¼Œæ‰¾ä¸åˆ°å±æ€§å’Œæœªåˆå§‹åŒ–çš„å˜é‡éƒ½ä¼šè¿”å› undefinedï¼Œå¯¹è±¡æœ¬èº«æ‰¾ä¸åˆ°æ—¶è¿”å› nullï¼Œnull æœ¬èº«ä¹Ÿæ˜¯å¯¹è±¡ï¼Œè¡¨ç¤ºæ²¡æœ‰å¯¹è±¡çš„å¯¹è±¡ï¼Œå› æ­¤ typeof null ä¼šè¿”å› objectã€‚åŸºç¡€ç±»å‹ä¸­å­—ç¬¦ä¸²è¿˜æ²¡æ”¯æŒ Unicodeï¼Œæœ‰8ä½å­—ç¬¦ç¼–ç ä¸å¯å˜åºåˆ—ç»„æˆï¼Œæ•°å­—ç±»å‹ç”± IEEE 754 åŒç²¾åº¦äºŒè¿›åˆ¶64ä½æµ®ç‚¹å€¼ç»„æˆã€‚æ–°çš„å±æ€§ä¹Ÿå¯ä»¥åŠ¨æ€çš„åˆ›å»ºï¼Œä½¿ç”¨é”®å€¼èµ‹å€¼æ–¹å¼ã€‚</p>
<p>Brendan Eich å–œæ¬¢ Lispï¼Œæ¥ Netscape æœ¬æ‰“ç®—æ˜¯å°† lisp å¼•å…¥æµè§ˆå™¨çš„ã€‚å› æ­¤ Mocha é‡Œæœ‰ç€å¾ˆå¤šçš„ lisp å½±å­ï¼Œæ¯”å¦‚å‡½æ•°ä¸€ç­‰å…¬æ°‘å’Œ lambdaï¼Œå‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘çš„å…·ä½“è¡¨ç°å°±æ˜¯ï¼Œå‡½æ•°å¯ä»¥ä½œä¸ºå‡½æ•°çš„å‚æ•°ï¼Œå‡½æ•°è¿”å›å€¼å¯ä»¥æ˜¯å‡½æ•°ï¼Œä¹Ÿå¯å°†å‡½æ•°èµ‹å€¼ç»™å˜é‡ã€‚Brendan Eich çš„è‡ªå·±å…³äºå½“æ—¶å¼€å‘çš„å›é¡¾æ–‡ç« å¯ä»¥çœ‹ä»–åšå®¢<a href="https://brendaneich.com/2008/04/">è¿™ç¯‡</a>ï¼Œè¿˜æœ‰è¿™ç¯‡ã€Š<a href="https://web.archive.org/web/20190320112431/https://brendaneich.com/2011/06/">New JavaScript Engine Module Owner</a>ã€‹ï¼Œè®¿è°ˆç¨¿ã€Š<a href="https://www.infoworld.com/article/2077132/bending-over-backward-to-make-javascript-work-on-14-platforms.html">Bending over backward to make JavaScript work on 14 platforms</a>ã€‹ã€‚</p>
<p>Netscape 2 æ­£å¼ç‰ˆå°† Mocha æ›´åä¸º JavaScriptï¼Œåç®€ç§° jsã€‚1.0 ç‰ˆæœ¬ js è¯­æ³•å¤§é‡å€Ÿé‰´ C è¯­è¨€ã€‚è¡Œæœ«å¯ä¸åŠ åˆ†å·ï¼Œä¸€å¼€å§‹ js å°±æ˜¯æ”¯æŒçš„ã€‚1.1ç‰ˆ js æ”¯æŒéšå¼ç±»å‹è½¬æ¢ï¼Œå¯ä»¥æŠŠä»»æ„å¯¹è±¡è½¬æˆæ•°å­—å’Œå­—ç¬¦ä¸²ã€‚1.0ç‰ˆ js å¯¹è±¡ä¸èƒ½ç»§æ‰¿ï¼Œ1.1 åŠ å…¥å¯¹è±¡çš„ prototype å±æ€§ï¼Œprototype çš„å±æ€§å’Œå®ä¾‹çš„å¯¹è±¡å…±äº«ã€‚ä¸ºäº†åŠ åˆ° ISO æ ‡å‡†ä¸­ï¼ŒNetscape æ‰¾åˆ°äº† Ecmaï¼Œå› ä¸º ISO å¯¹ Ecma è¿™ä¸ªç»„ç»‡æ˜¯è®¤å¯çš„ã€‚æ¥ç€ Ecma ç»„å»ºäº† TC39 æŠ€æœ¯å§”å‘˜ä¼šè´Ÿè´£åˆ›å»ºå’Œç»´æŠ¤ js çš„è§„èŒƒã€‚æœŸé—´ï¼Œå¾®è½¯ä¸ºäº†èƒ½å¤Ÿå…¼å®¹ jsï¼Œç»„å»ºäº†å›¢é˜Ÿå¼€å‘ JScriptï¼Œè¿‡ç¨‹æ¯”è¾ƒç—›è‹¦ï¼Œå› ä¸º js çš„è§„èŒƒå½“æ—¶è¿˜æ²¡æœ‰ï¼Œå¾®è½¯åªèƒ½è‡ªå·±æ‘¸ç´¢ï¼Œå¹¶å†™äº†ä»½è§„èŒƒ <a href="http://archives.ecma-international.org/1996/TC39/96-005.pdf">The JScript Language Specification, version 0.1</a> æäº¤ç»™ TC39ï¼Œå¾®è½¯è¿˜å°† VBScript å¼•å…¥ IEã€‚96å¹´ Netscape ä¸º JavaScript 1.1 å†™äº†è§„èŒƒ <a href="http://archives.ecma-international.org/1996/TC39/96-002.pdf">Javascript 1.1 Specification in Winword format</a> ä½œä¸º TC39 æ ‡å‡†åŒ– js çš„åŸºç¡€ã€‚97å¹´ TC39 å‘å¸ƒäº† <a href="https://www.ecma-international.org/wp-content/uploads/ECMA-262_1st_edition_june_1997.pdf">ECMA-262 ç¬¬ä¸€ç‰ˆè§„èŒƒ</a>ã€‚</p>
<p>Netscape 3 å‘å¸ƒåï¼ŒBrendan Eich é‡æ„äº† js å¼•æ“æ ¸å¿ƒï¼ŒåŠ äº†åµŒå¥—å‡½æ•°ã€lambdaã€æ­£åˆ™è¡¨è¾¾å¼ã€ä¼ªå±æ€§ï¼ˆåŠ¨æ€è®¿é—®ä¿®æ”¹å¯¹è±¡ï¼‰ã€å¯¹è±¡å’Œæ•°ç»„çš„å­—é¢é‡ã€åŸºäºæ ‡è®°å’Œæ¸…é™¤çš„ GCã€‚lambda çš„å‡½æ•°åä¸ºå¯é€‰ï¼Œè¿è¡Œæ—¶ä¼šåˆ›å»ºé—­åŒ…ï¼Œé—­åŒ…å¯é€’å½’å¼•ç”¨è‡ªå·±ä½œä¸ºå‚æ•°ã€‚æ–° js å¼•æ“å« SpiderMonkeyã€‚js è¯­è¨€å¢åŠ æ–°ç‰¹æ€§ï¼Œä»æ›´å¤šè¯­è¨€é‚£åšäº†å€Ÿé‰´ï¼Œæ¯”å¦‚ Python å’Œ Perl çš„æ•°ç»„ç›¸å…³æ–¹æ³•ï¼ŒPerl å¯¹äºå­—ç¬¦ä¸²å’Œæ­£åˆ™çš„å¤„ç†ï¼ŒJava çš„ break / continue æ ‡ç­¾è¯­å¥ä»¥åŠ switchã€‚è¯­è¨€å‡çº§ä¸º JavaScript 1.2ï¼ˆ<a href="https://web.archive.org/web/19970630092641/http://developer.netscape.com/library/documentation/communicator/jsguide/intro.htm">ç‰¹æ€§è¯¦ç»†ä»‹ç»</a>ï¼‰ï¼Œå’Œ SpiderMonkey ä¸€èµ·é›†æˆåˆ° Netscape 4.0ã€‚<a href="https://www.ecma-international.org/wp-content/uploads/ECMA-262_3rd_edition_december_1999.pdf">ES3</a> ç»“åˆäº† js 1.2 å’Œ JScript 3.0ï¼ŒI18N å°ç»„ä¸º ES3 åŠ å…¥äº†å¯é€‰ Unicode åº“æ”¯æŒã€‚å¼€å§‹å…¼å®¹ ES3çš„æµè§ˆå™¨æ˜¯è¿è¡Œå¾®è½¯ JScript 5.5çš„ IE 5.5ï¼Œè¿è¡Œ js 1.5 çš„ Netscape 6ã€‚</p>
<p>ES3 æ ‡å‡†åšæŒäº†10å¹´ã€‚</p>
<p>è¿™10å¹´å¯¹ js è®¾è®¡çš„æŠ±æ€¨ï¼Œä¹Ÿå¯ä»¥è¯´ js ä¸è®©äººæ»¡æ„çš„åœ°æ–¹ï¼Œåœ¨è¿™ä¸ªåœ°æ–¹ <a href="https://wtfjs.com/">wtfjs - a little code blog about that language we love despite giving us so much to hat</a> æœ‰æ±‡æ€»ã€‚å½“ç„¶ä¹Ÿæœ‰äººä¼šç«™å‡ºæ¥ä¸º js æ­£åï¼Œæ¯”å¦‚ Douglas Crockfordï¼Œå¯ä»¥çœ‹çœ‹ä»–çš„è¿™ç¯‡æ–‡ç«  <a href="http://www.crockford.com/javascript/javascript.html">JavaScript:The Worldâ€™s Most Misunderstood Programming Language</a>ï¼Œé‡Œé¢æåˆ°å¾ˆå¤šä¹¦éƒ½å¾ˆå·®ï¼Œæ¯”å¦‚ç”¨æ³•å’Œç‰¹æ€§çš„é—æ¼ç­‰ï¼Œåªè®¤å¯äº† JavaScript: The Definitive Guide è¿™æœ¬ä¹¦ã€‚å¹¶ä¸” Douglas Crockford è‡ªå·±è¿˜å†™äº†æœ¬ä¹¦ JavaScript: The Good Partsï¼Œä¸­æ–‡ç‰ˆå«ã€ŠJavaScriptè¯­è¨€ç²¾ç²¹ã€‹ã€‚å¦å¤– Douglas Crockford åšå‡ºçš„æœ€å¤§è´¡çŒ®æ˜¯åˆ©ç”¨ js å¯¹è±¡å’Œæ•°ç»„å­—é¢é‡å½¢å¼å®ç°äº†ç‹¬ç«‹äºè¯­è¨€çš„æ•°æ®æ ¼å¼ JavaScript Object Notationï¼Œå¹¶åŠ å…¥ TC39 çš„æ ‡å‡†ä¸­ï¼ŒJavaScript Object Notation ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¦‚ä»Šåº”ç”¨æœ€å¤šçš„æ•°æ®äº¤æ¢æ ¼å¼ JSON çš„å…¨ç§°ã€‚</p>
<p>ES4 åˆæœŸç›®æ ‡æ˜¯å¸Œæœ›èƒ½å¤Ÿæ”¯æŒç±»ã€æ¨¡å—ã€åº“ã€packageã€Decimalã€çº¿ç¨‹å®‰å…¨ç­‰ã€‚2000å¹´å¾®è½¯ Andrew Clinick ä¸»å¯¼çš„.NET Framework å¼€å§‹æ”¯æŒ JScriptã€‚å¾®è½¯å¸Œæœ›é€šè¿‡ ES4 æ ‡å‡†èƒ½å¤Ÿå°† JScript åº”ç”¨åˆ°æœåŠ¡ç«¯ï¼Œå¹¶å’Œä»¥å¾€æ ‡å‡†ä¸å…¼å®¹ã€‚æµè§ˆå™¨å¤§æˆ˜ä»¥ Netscape å¤±è´¥ç»“æŸåï¼Œå¾®è½¯å–å¾—äº†æµè§ˆå™¨ç»Ÿæ²»åœ°ä½ï¼Œå¯¹ TC39 æ ‡å‡†å¤±å»äº†å…´è¶£ï¼Œå¸Œæœ›ç”¨è‡ªå®¶æ ‡å‡†å–è€Œä»£ä¹‹ï¼Œä»¥è‡³ TC39 ä¹‹åå‡ å¹´æ²¡æœ‰ä»»ä½•å®è´¨è¿›å±•ã€‚è¿™ä¸ªæœŸé—´æµè¡Œèµ·æ¥çš„ Flash ä½¿ç”¨çš„è„šæœ¬è¯­è¨€ ActionScript ä¹Ÿåªæ˜¯åŸºäº ES3 çš„ï¼Œ2003å¹´ ActionScript 2.0 å¼€å§‹æ”¯æŒ ES4 çš„ææ¡ˆè¯­æ³•ä»¥ç®€åŒ–è¯­ä¹‰ï¼Œä¸ºäº†æå‡æ€§èƒ½ Flash èŠ±äº†3å¹´ï¼Œåœ¨2007å¹´å¼€å‘å‡º AVM2è™šæœºæ”¯æŒé™æ€ç±»å‹çš„ ActionScript 3.0ã€‚é‚£æ—¶æˆ‘æ‰€åœ¨çš„åˆ›ä¸šå…¬å¸ä½¿ç”¨çš„å°±æ˜¯ flash å¼€å‘çš„å›¾å½¢ç¤¾äº¤ç½‘ç«™ xcityï¼Œç½‘ç«™ç°åœ¨å·²ç»ä¸åœ¨äº†ï¼Œåªèƒ½åœ¨ <a href="https://tieba.baidu.com/f?ie=utf-8&amp;kw=xcity">xcityè´´å§</a>æ‰¾åˆ°å½“å¹´ç”¨æˆ·å†™çš„æ•…äº‹æˆªçš„å›¾ã€‚</p>
<p>Brendan Eich ä»£è¡¨ Mozilla åœ¨2004å¹´å¼€å§‹å‚ä¸ ES4 çš„è§„åˆ’ï¼Œ2006å¹´ Opera çš„ Lars Thomas Hansen ä¹ŸåŠ å…¥è¿›æ¥ã€‚Flash å°† AVM2 ç»™äº† Mozillaï¼Œå‘½åä¸º Tamarinã€‚èµ·åˆå¾®è½¯æ²¡æ€ä¹ˆå‚ä¸ ES4 çš„å·¥ä½œï¼Œåæ¥æœ‰20å¤šå¹´ Smalltalk ç»éªŒçš„ Allen Wirfs-Brock åŠ å…¥å¾®è½¯åï¼Œå‘ç° TC39æ­£åœ¨è®¾è®¡ä¸­ ES4 æ˜¯åŸºäºé™æ€ç±»å‹çš„ ActionScript 3.0ï¼Œäºæ˜¯æå‡ºåŠ¨æ€è¯­è¨€åŠ é™æ€ç±»å‹ä¸å®¹æ˜“æˆï¼Œè€Œä¸”ä¼šæœ‰å¾ˆå¤§çš„å…¼å®¹é—®é¢˜ï¼Œè¿˜æœ‰ä¸ªå› ç´ æ˜¯æ‹…å¿ƒ Flash ä¼šå½±å“åˆ°å¾®è½¯çš„äº§å“ï¼Œå¸Œæœ›èƒ½å¤Ÿå¤ºå›æ ‡å‡†ä¸»åŠ¨æƒã€‚Allen Wirfs-Brock çš„æƒ³æ³•å¾—åˆ°åœ¨é›…è™çš„ Douglas Crockford çš„æ”¯æŒï¼Œä»–ä»¬ä¸€èµ·æå‡ºæ–°çš„æ ‡å‡†ææ¡ˆï¼Œææ¡ˆåä¿å®ˆï¼Œåªæ˜¯å¯¹ ES3 åšè¡¥ä¸ã€‚</p>
<p>AJAXï¼Œä»¥åŠæ”¯æŒ AJAX å’Œè§£å†³æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜çš„åº“ jQuery åº“ï¼ˆåŒæœŸè¿˜æœ‰ Dojo å’Œ Prototype è¿™æ · polyfill çš„åº“ï¼‰å¸¦æ¥äº† Web2.0æ—¶ä»£ã€‚polyfill è¿™ç±»åº“ä¸€èˆ¬ä½¿ç”¨å‘½åç©ºé—´å¯¹è±¡å’Œ IIFE æ–¹å¼è§£å†³åº“ä¹‹é—´çš„å‘½åå†²çªé—®é¢˜ã€‚æˆ‘å°±æ˜¯è¿™ä¸ªæ—¶æœŸå¼€å§‹ä½¿ç”¨ js æ¥å¼€å‘è‡ªå·±çš„ç½‘ç«™ <a href="http://www.starming.com/">www.starming.com</a>ï¼Œå½“æ—¶ç»™ç½‘ç«™åšäº†å¾ˆå¤šå°çš„åº”ç”¨æ¯”å¦‚å›¾ç‰‡æ”¶è—ã€GTDã€åšå®¢ç³»ç»Ÿã€è®°å•è¯ã€RSSè®¢é˜…ï¼Œè¿˜æœ‰ä¸€ä¸ªä¸‰å›½æ¼”ä¹‰å°è¯´æ¸¸æˆï¼Œè®°å¾—é‚£ä¼šé€šè¿‡çŠ€ç‰›ä¹¦ï¼ˆä¹Ÿå°±æ˜¯ Douglas Crockford æ¨èçš„ JavaScript: The Definitive Guide ï¼Œä¸­æ–‡ç‰ˆå«ã€ŠJavaScript æƒå¨æŒ‡å—ã€‹ï¼‰å­¦äº† js åï¼Œå°±å¼„äº†ä¸ªå…¼å®¹å¤šæµè§ˆå™¨çš„ js åº“ï¼Œç„¶åç”¨è¿™ä¸ªåº“åšäº†ä¸ªå¯æ‹–æ‹½ç”Ÿæˆç½‘ç«™çš„ç³»ç»Ÿã€‚2013å¹´ä¹‹å starming å·²ç»åšæˆäº†ä¸€ä¸ªä¸ªäººåšå®¢ï¼Œç°åœ¨åŸºäº hexo çš„é™æ€åšå®¢ç½‘ç«™ã€‚2013å¹´ä¹‹å‰çš„ starming ç½‘ç«™å†…å®¹ä¾ç„¶å¯ä»¥é€šè¿‡ <a href="https://web.archive.org/">https://web.archive.org/</a> ç½‘ç«™æŸ¥çœ‹åˆ°ï¼Œç‚¹å‡»è¿™ä¸ª<a href="https://web.archive.org/web/20130124221354/http://www.starming.com/">åœ°å€</a>ã€‚</p>
<p>2006å¹´ Google çš„ Lars Bak å¼€å§‹äº† V8 å¼•æ“çš„å¼€å‘ï¼Œ2008 åŸºäº V8 çš„ Chrome æµè§ˆå™¨å‘å¸ƒï¼Œæ€§èƒ½æ¯” SpiderMonkey å¿«äº†10å€ã€‚V8 å‡ºæ¥åï¼Œå„å¤§æµè§ˆå™¨å…¬å¸å¼€å§‹ä¸“é—¨ç»„å»ºå›¢é˜ŸæŠ•å…¥ js å¼•æ“çš„æ€§èƒ½è§’é€ä¸­ã€‚å½“æ—¶ js å¼•æ“æœ‰è‹¹æœå…¬å¸çš„ SquirrelFish Extremeã€å¾®è½¯ IE9 çš„ Chakra å’Œ Mozilla çš„ TraceMonkeyï¼ˆè§£é‡Šå™¨ç”¨çš„æ˜¯ SpiderMonkeyï¼‰ã€‚</p>
<p>éšç€ IBMã€è‹¹æœå’Œ Google å¼€å§‹ä»‹å…¥æ ‡å‡†å§”å‘˜ä¼šï¼Œæ›´å¤šçš„å£°éŸ³å¸¦æ¥äº†æ›´çœŸå®çš„è¯‰æ±‚ï¼ŒTC39 ç¡®å®šå‡º ES4 è¦å’Œ ES3 å…¼å®¹ï¼ŒåŒæ—¶åŠ å…¥å¤§åº”ç”¨æ‰€éœ€çš„è¯­è¨€ç‰¹æ€§ï¼Œæ¯”å¦‚ç±»ã€æ¥å£ã€å‘½åç©ºé—´ã€packageï¼Œè¿˜æœ‰å¯é€‰é™æ€ç±»å‹æ£€æŸ¥ç­‰ç­‰ã€‚éƒ¨åˆ†ç‰¹æ€§è¢«å»ºè®®å¾€åå»¶ï¼Œæ¯”å¦‚å°¾è°ƒç”¨ã€è¿­ä»£å™¨ç”Ÿæˆå™¨ã€ç±»å‹è‡ªçœç­‰ã€‚ç°åœ¨çœ‹èµ·æ¥ ES4 10å¹´è®¾è®¡éå¸¸æ³¢æŠ˜ï¼Œæ¿€è¿›çš„åŠ å…¥é™æ€ç±»å‹ï¼Œä¸å…¼å®¹è€æ ‡å‡†ï¼ŒæŠŠæ ‡å‡†å½“ç ”ç©¶è€Œå¿½ç•¥äº†æ ‡å‡†å®é™…ä¸Šæ˜¯éœ€è¦å½¢æˆå…±è¯†çš„ï¼Œè€Œä¸æ˜¯è¦æœ‰é£é™©çš„ã€‚åœ¨ TC39 æˆå‘˜è¾¾æˆå…±è¯†åï¼ŒES4 è¿˜å‰”é™¤äº† package å’Œå‘½åç©ºé—´ç­‰ç‰¹æ€§ï¼Œç”±äº Decimal çš„è®¾è®¡è¿˜ä¸æˆç†Ÿä¹Ÿæ²¡èƒ½åŠ å…¥ã€‚ç”±äº ES4 å¾ˆå¤šç‰¹æ€§æ— æ³•é€šè¿‡ï¼Œè€Œæ²¡æ³•é€šè¿‡æ ‡å‡†ï¼Œå› æ­¤åŒæ­¥è®¾è®¡äº†10å¹´å¤šçš„ ES 3.1 æœ€ç»ˆæ”¹åä¸º ES5ï¼Œä¹Ÿå°±æ˜¯ ECMA-262 ç¬¬ 5 ç‰ˆã€‚ES5 ä¸»è¦ç‰¹æ€§åŒ…æ‹¬ä¸¥æ ¼æ¨¡å¼ï¼Œå¯¹è±¡å…ƒæ“ä½œï¼Œæ¯”å¦‚setterã€getterã€createç­‰ï¼Œå¦å¤–æ·»åŠ äº†äº›å®ç”¨çš„å†…ç½®å‡½æ•°ï¼Œæ¯”å¦‚ JSON ç›¸å…³è§£æå’Œå­—ç¬¦ä¸²äº’è½¬å‡½æ•°ï¼Œæ•°ç»„å¢åŠ äº†é«˜é˜¶å‡½æ•°ç­‰ç­‰ã€‚ES5 çš„æµ‹è¯•å¥—ä»¶æœ‰å¾®è½¯ Pratap Lakshman çš„ï¼Œ<a href="https://www.ecma-international.org/archive/ecmascript/2009/TC39/tc39-2009-030.zip">è¿™é‡Œ</a>å¯ä»¥ä¸‹è½½çœ‹åˆ°ï¼Œè°·æ­Œæœ‰ <a href="https://blog.chromium.org/2009/06/launching-sputnik-into-orbit.html">Sputnik</a>ï¼Œæœ‰5000å¤šä¸ªæµ‹è¯•ï¼ŒåŸºäºä»–ä»¬ï¼ŒTC39 æœ€åç»Ÿä¸€ç»´æŠ¤è‘—åçš„ Test262 æµ‹è¯•å¥—ä»¶ã€‚</p>
<p>ES5 ä¹‹å TC39 å¼€å§‹äº† Harmony é¡¹ç›®ï¼ŒHarmony å¼€å§‹çš„ææ¡ˆåŒ…æ‹¬ç±»ã€constã€lambdaã€è¯æ³•ä½œç”¨åŸŸã€ç±»å‹ç­‰ã€‚ä» Brenda Eich çš„ ã€Š<a href="https://brendaneich.com/2011/01/harmony-of-my-dreams/">Harmony Of My Dreams</a>ã€‹è¿™ç¯‡æ–‡ç« å¯ä»¥ js ä¹‹çˆ¶å¯¹äº Harmony çš„æœŸæœ›ï¼Œä¾‹å¦‚æ–‡ç« ä¸­æåˆ°çš„ # è¯­æ³•ï¼Œç”¨æ¥éšè— return å’Œ this è¯æ³•ä½œç”¨åŸŸç»‘å®šï¼Œæœ€ç»ˆè¢« ES2015 çš„ç®­å¤´å‡½æ•°æ›¿ä»£ï¼Œä½† # ç”¨æ¥è¡¨ç¤ºä¸å¯å˜æ•°æ®ç»“æ„æ²¡æœ‰è¢«æ”¯æŒï¼Œæ¨¡å—å’Œè¿­ä»£å™¨å‡è·å¾—äº†æ”¯æŒã€‚Harmony è®¾è®¡äº† Promise çš„åŸºç¡€ Realm è§„èŒƒæŠ½è±¡ã€å†…éƒ¨æ–¹æ³•è§„èŒƒ MOPã€Proxy å¯¹è±¡ã€WeakMapã€ç®­å¤´å‡½æ•°ã€å®Œæ•´çš„ Unicode æ”¯æŒã€å±æ€§ Symbol å€¼ã€å°¾è°ƒç”¨ã€ç±»å‹æ•°ç»„ç­‰ç‰¹æ€§ã€‚å¯¹äºç±»çš„è®¾è®¡ï¼ŒTC39 å°†ä½¿ç”¨ lambda å‡½æ•°ã€ç±»ä¼¼ Scheme çš„è¯æ³•æ•è·æŠ€æœ¯ã€æ„é€ å‡½æ•°ã€åŸå‹ç»§æ‰¿å¯¹è±¡ã€å®ä¾‹å¯¹è±¡ã€æ‰©å±•å¯¹è±¡å­—é¢é‡è¯­æ³•æ¥æ»¡è¶³ç±»æ‰€éœ€è¦çš„å¤šæ¬¡å®ä¾‹åŒ–ç‰¹æ€§ã€‚æ¨¡å—çš„è®¾è®¡æ€è·¯æ˜¯é€šè¿‡ module å’Œ import ä¸¤ç§æ–¹å¼å¯¼å…¥æ¨¡å—ï¼Œimport å¯ä»¥ç”¨æ¨¡å—å£°æ˜å’Œå­—ç¬¦ä¸²å­—é¢é‡çš„æ–¹å¼å¯¼å…¥æ¨¡å—ã€‚æ¨¡å—å¯¼å…¥èƒŒåæ˜¯æ¨¡å—åŠ è½½å™¨çš„è®¾è®¡ï¼Œè®¾è®¡çš„åŠ è½½æµç¨‹æ˜¯ï¼Œå…ˆå¤„ç†åŠ è½½æ ‡è¯†çš„è§„èŒƒï¼Œå†å¤„ç†é¢„å¤„ç†ï¼Œå¤„ç†æ¨¡å—é—´çš„ä¾èµ–ï¼Œå…³è”ä¸Šå¯¼å…¥å’Œå¯¼å‡ºï¼Œæœ€åå†è¿›è¡Œä¾èµ–æ¨¡å—çš„åˆå§‹åŒ–å·¥ä½œã€‚æ•´ä¸ªåŠ è½½è¿‡ç¨‹å¯ä»¥çœ‹è¿™ä¸ª js å®ç°çš„<a href="https://github.com/jorendorff/js-loaders">åŸå‹</a>ï¼Œåæ¥è¿™ä¸ªåŠ è½½å™¨æ²¡æœ‰è¢«åŠ å…¥è§„èŒƒï¼Œè€Œç”±æµè§ˆå™¨å»å®ç°ã€‚CommonJS ä½œè€… Kevin Dangoor çš„æ–‡ç« ã€Š<a href="https://www.blueskyonmars.com/2010/01/29/commonjs-the-first-year/">CommonJS: the First Year</a>ã€‹å†™ä¸‹åš CommonJS çš„åˆè¡·å’Œç›®æ ‡ï¼Œæ ‡å¿—ç€ js å¼€å§‹åœ¨æœåŠ¡ç«¯é¢†åŸŸæ´»è·ƒèµ·æ¥ã€‚CommonJS çš„æ€è·¯å°±æ˜¯å°†å‡½æ•°å½“ä½œæ¨¡å—ï¼Œå’Œå…¶ä»–æ¨¡å—äº¤äº’æ˜¯é€šè¿‡å¯¼å‡ºå±€éƒ¨å˜é‡ä½œä¸ºå±æ€§æä¾›å€¼ï¼Œä½†æ˜¯å±æ€§èƒ½è¢«åŠ¨æ€æ”¹å˜å’Œç”Ÿæˆï¼Œæ‰€ä»¥å¯¹äºæ¨¡å—ä½¿ç”¨è€…ï¼Œè¿™æ˜¯ä¸ç¨³å®šçš„ã€‚Ryan Dahl 2009 å¼€å‘çš„ Node.js ï¼ˆä»‹ç»å‚çœ‹ä½œè€…<a href="https://www.youtube.com/watch?v=ztspvPYybIY&amp;feature=youtu.be&amp;ab_channel=stri8ted">jsconfæ¼”è®²</a>ï¼‰å°±æ˜¯ç”¨ CommonJS çš„æ¨¡å—åŠ è½½å™¨ã€‚Node.js é“¾æ¥äº† POSIX APIï¼Œç½‘ç»œå’Œæ–‡ä»¶æ“ä½œï¼Œæœ‰ä¸ªè‡ªå·±çš„ Event Loopï¼Œæœ‰äº›åŸºç¡€çš„ C æ¨¡å—ï¼Œè¿˜åŒ…å«äº† V8 å¼•æ“ã€‚</p>
<p>2010 å¹´å¼€å§‹å‡ºç°å…¶ä»–è¯­è¨€æºç è½¬ js æºç è¿™ç§è½¬è¯‘å™¨çš„é£æ½®ï¼Œæœ€æœ‰ä»£è¡¨çš„æ˜¯ CoffeeScriptï¼ŒCoffeeScript æŸç§ç¨‹åº¦ä¸Šæ˜¯å¯¹ js å¼€å‘æä¾›äº†æ›´ä¼˜é›…æ›´å…ˆè¿›çš„å¼€å‘è¯­è¨€è¾…åŠ©ã€‚ä» CoffeeScript ä¸€äº›ç‰¹æ€§åœ¨å¼€å‘è€…çš„åé¦ˆï¼Œèƒ½å¤Ÿæ›´å¥½çš„å¸®åŠ© TC39 å¯¹ js ç‰¹æ€§æ˜¯å¦è¿›å…¥æ ‡å‡†æä¾›å‚è€ƒã€‚åæ¥è¿˜æœ‰ä»¥ä¼˜åŒ–æ€§èƒ½ä¸ºç›®çš„çš„ Emscripten å’Œ asm.js ç¿»è¯‘æˆé«˜æ•ˆ js ä»£ç çš„è½¬è¯‘å™¨ã€‚è½¬ä¹‰å™¨å¯¹äº Harmony ç”šè‡³æ˜¯åé¢çš„ ES2015 æ¥è¯´æœ‰ç€æ›´é‡è¦çš„æ„ä¹‰ã€‚å½“æ—¶çš„ç”¨æˆ·æ²¡æœ‰ä¸»åŠ¨è¿›è¡Œè½¯ä»¶å‡çº§çš„ä¹ æƒ¯ï¼Œç‰¹åˆ«æ˜¯ç”±ç³»ç»Ÿç»‘å®šçš„æµè§ˆå™¨ã€‚é€‚é… IE6çš„ç—›è‹¦ï¼Œç›¸ä¿¡è€ä¸€è¾ˆçš„å‰ç«¯å¼€å‘è€…ä¼šæœ‰å¾ˆæ·±çš„ä½“ä¼šã€‚å¤§é‡æµè§ˆå™¨ä½ç‰ˆæœ¬çš„å­˜åœ¨å¯¹äºæ–°çš„æ ‡å‡†æ¨å¹¿é€ æˆäº†å¾ˆå¤§çš„é˜»ç¢ï¼Œå› æ­¤ä½¿ç”¨æ–°æ ‡å‡†ç¼–å†™ä»£ç è½¬ç§»æˆå¯å…¼å®¹ä½ç‰ˆæœ¬æµè§ˆå™¨çš„ä»£ç èƒ½å¤Ÿè§£å†³å…¼å®¹é—®é¢˜ã€‚åœ¨ Harmony é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­é™¤äº† Mozilla ä½¿ç”¨ SpiderMonkey å¼•æ“å¼€å‘çš„ <a href="https://github.com/mozilla/narcissus/">Narcissus</a> è½¬è¯‘å™¨å¤–ï¼Œè¿˜æœ‰ç›´åˆ°ç›®å‰è¿˜åœ¨ä½¿ç”¨çš„ <a href="https://babeljs.io/">Babel</a> å’Œ <a href="https://www.typescriptlang.org/">TypeScript è¯­è¨€</a>çš„è½¬è¯‘å™¨ã€‚å¦å¤–è¿˜æœ‰ä½¿ç”¨ rust å†™çš„ js ç¼–è¯‘å™¨ <a href="https://github.com/swc-project/swc">swc</a>ï¼Œä¸»æ‰“é€Ÿåº¦ï¼Œæ‰“ç®—æ¥æ›¿ä»£ babelã€‚</p>
<p>2015å¹´ï¼Œ<a href="https://www.ecma-international.org/wp-content/uploads/ECMA-262_6th_edition_june_2015.pdf">ECMAScript 2015</a>å‘å¸ƒã€‚ECMAScript 2015 ä¹‹åï¼Œç”±äºå„ä¸ªæµè§ˆå™¨éƒ½å¼€å§‹æ›´å¿«çš„è¿­ä»£æ›´æ–°ï¼Œ TC39 å¼€å§‹é…åˆæ›´æ–°çš„èŠ‚å¥ï¼Œå¼€å§‹æ¯å¹´æ›´æ–°æ ‡å‡†ï¼Œä»¥å¹´ä½œä¸ºæ ‡å‡†çš„ç‰ˆæœ¬å·ã€‚</p>
<p>ES2016 å¢åŠ äº† async/await å¼‚æ­¥è¯­æ³•ç‰¹æ€§ï¼Œçºµè§‚ js çš„å¼‚æ­¥å†ç¨‹ï¼Œä»æœ€å¼€å§‹çš„ Callbackæ–¹å¼åˆ° Promise/thenï¼Œjs è§£å†³äº†å›è°ƒåœ°ç‹±çš„é—®é¢˜ï¼Œä½†ç¼ºå°‘èƒ½å¤Ÿæš‚åœå‡½æ•°å’Œæ¢å¤æ‰§è¡Œçš„æ–¹æ³•ï¼Œå› æ­¤åœ¨ ES2015 åŠ å…¥äº†ç”Ÿæˆå™¨ï¼Œå…¶å®ç°æ ¸å¿ƒæ€æƒ³å°±æ˜¯åç¨‹ï¼Œåç¨‹å¯ä»¥çœ‹ä½œæ˜¯è¿è¡Œä¸­çº¿ç¨‹ä¸Šçš„å¯æš‚åœå’Œæ¢å¤æ‰§è¡Œçš„ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡éƒ½æ˜¯å¯é€šè¿‡ç¨‹åºæ§åˆ¶çš„ã€‚åœ¨ ES2016 åŠ å…¥ç®€æ´çš„ async/await è¯­æ³•æ¥æ›´å¥½çš„ä½¿ç”¨åç¨‹ã€‚js å¼‚æ­¥ç¼–ç¨‹å†ç¨‹å¦‚ä¸‹å›¾ï¼š<br><img src="/uploads/deeply-analyse-quickjs/1.png" alt=""></p>
<p>ECMAScript 2016 å¼€å§‹ js è¿›å…¥äº†æ¡†æ¶ç™¾å®¶äº‰é¸£çš„æ—¶ä»£ã€‚</p>
<p>js æ¡†æ¶æ–¹é¢ï¼Œæ—©æœŸ js çš„æ¡†æ¶æ˜¯ä»¥å…¼å®¹å’Œæ¥å£ä¼˜é›…ä¸ºåŸºå‡†æ¯”è¾ƒèƒœå‡ºçš„ PrototypeJS å’Œ jQueryã€‚MVC æµè¡Œèµ·æ¥çš„æ¡†æ¶æ˜¯ Backboneï¼ŒMVVM æ—¶ä»£æ˜¯ AngularJS ä¸ºä»£è¡¨çš„æ•°æ®åŒå‘ç»‘å®šåªç”¨å…³æ³¨ Model æ¡†æ¶æ–°æ˜Ÿå´›èµ·ã€‚Vue åœ¨ MVVM åŸºç¡€ä¸Šå¢åŠ äº†ç”¨æ¥æ›¿ä»£ Options API çš„ Composition API æ¯”æ‹Ÿ React çš„ Hooksã€‚Reactï¼ˆReact çš„åˆ›ä½œè€…æ˜¯ <a href="https://twitter.com/jordwalke">Jord Walke</a>ï¼Œåœ¨ facebookï¼Œä¸è¿‡ç°åœ¨å·²ç»ç¦»å¼€äº† facebookï¼Œåˆ›ç«‹äº†è‡ªå·±çš„å…¬å¸ï¼‰åæ¥å±…ä¸Šï¼Œä»¥å‡½æ•°å¼ç¼–ç¨‹æ¦‚å¿µæ‹¿ä¸‹å¤´ç‰Œï¼Œè¿™ä¹Ÿæ˜¯å› ä¸º React æ ¸å¿ƒå›¢é˜Ÿæˆå‘˜å–œæ¬¢ OCaml è¿™æ ·çš„å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€çš„åŸå› ã€‚ã€‚React çš„ç»„ä»¶æœ‰é˜¿é‡Œçš„ <a href="https://ant.design/index-cn">Ant Design</a> å’Œ <a href="https://fusion.design/">Fusion Design</a> å¯ç”¨ã€‚React å¯¹äºé€»è¾‘å¤ç”¨ä½¿ç”¨çš„æ˜¯æ›´ä¼˜é›…çš„ Hooksï¼Œæ¥å£å°‘ï¼Œä»¥å£°æ˜å¼æ–¹å¼ä¾›ä½¿ç”¨ï¼Œå¾ˆå¤šå¼€å‘è€…ä¼šå°†è‡ªå·±å¼€å‘çš„é€»è¾‘æŠ½å‡ºæ¥åšæˆ hooksï¼Œå‡ºç°äº†å¾ˆå¤šåŸºäº hooks çŠ¶æ€ç®¡ç†å…¬ç”¨ä»£ç ã€‚å¯¹äºçŠ¶æ€çš„ç¼“å­˜ç»´æŠ¤ç”± React çš„å†…æ ¸æ¥ç»´æŠ¤ï¼Œè¿™èƒ½å¤Ÿè§£å†³ä¸€ä¸ªç»„ä»¶æ ‘æ¸²æŸ“æ²¡å®Œæˆåˆå¼€å§‹å¦ä¸€ä¸ªç»„ä»¶æ ‘å¹¶å‘æ¸²æŸ“çŠ¶æ€å€¼ç®¡ç†é—®é¢˜ï¼Œå¼€å‘è€…èƒ½å¤Ÿä¸“æ³¨å†™å‡½æ•°ç»„ä»¶ï¼Œå’Œä¼ ç»Ÿ class ç»„ä»¶çš„åŒºåˆ«å¯ä»¥çœ‹ Dan Abramov çš„è¿™ç¯‡æ–‡ç« ã€Š<a href="https://overreacted.io/how-are-function-components-different-from-classes/">How Are Function Components Different from Classes?</a>ã€‹ã€‚js æ¡†æ¶çš„æ¼”è¿›å¦‚ä¸‹å›¾ï¼š<br><img src="/uploads/deeply-analyse-quickjs/2.png" alt=""></p>
<p>ä¸ºäº†ä½¿ js èƒ½å¤Ÿåº”ç”¨äºæ›´å¤§çš„å·¥ç¨‹åŒ–ä¸­ï¼Œå‡ºç°äº†é™æ€ç±»å‹ js æ¡†æ¶ã€‚é™æ€ç±»å‹çš„ js æ¡†æ¶æœ‰å¾®è½¯çš„ TypeScript å’Œ Facebook çš„ <a href="https://flow.org/">Flow</a>ã€‚TypeScript çš„ä½œè€…æ˜¯å½“å¹´æˆ‘å¤§å­¦æ—¶åšé¡¹ç›®ä½¿ç”¨çš„ IDE Delphi çš„ä½œè€… Anders Hejlsbergï¼Œå½“æ—¶çš„ Delphi å¼€å‘ä½“éªŒéå¸¸æ£’ï¼Œæˆ‘ç”¨å®ƒåšè¿‡ä¸å°‘é¡¹ç›®ï¼Œæ”¹å–„äº†å¤§å­¦ç”Ÿæ´»å“è´¨ã€‚</p>
<p>å¯¹äº React çš„å¼€å‘ï¼Œç°éœ€è¦äº†è§£è„šæ‰‹æ¶ <a href="https://github.com/facebook/create-react-app">create-react-app</a>ï¼Œä¸€è¡Œå‘½ä»¤èƒ½å¤Ÿåœ¨ macOS å’Œ Windows ä¸Šä¸ç”¨é…ç½®ç›´æ¥åˆ›å»º React åº”ç”¨ã€‚ç„¶åæ˜¯ä½¿ç”¨ JSX æ¨¡ç‰ˆè¯­æ³•åˆ›å»ºç»„ä»¶ï¼Œç»„ä»¶æ˜¯ç‹¬ç«‹å¯é‡ç”¨çš„ä»£ç ï¼Œç»„ä»¶ä¸€èˆ¬åªéœ€è¦å¤„ç†å•ä¸€äº‹æƒ…ï¼Œæ•°æ®é€šè¿‡å‚æ•°å’Œä¸Šä¸‹æ–‡å…±äº«ï¼Œä¸Šä¸‹æ–‡å…±äº«æ•°æ®é€‚ç”¨åœºæ™¯ç±»ä¼¼äº UI ä¸»é¢˜æ‰€éœ€çš„æ•°æ®å…±äº«ã€‚ä¸ºäº†ç¡®ä¿å±æ€§å¯ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ defaultProps æ¥å®šä¹‰é»˜è®¤å€¼ï¼Œä½¿ç”¨ propTypes åœ¨æµ‹è¯•æ—¶è¿›è¡Œå±æ€§ç±»å‹è®¾ç½®å’Œæ£€æŸ¥ã€‚åœ¨ç»„ä»¶é‡Œä½¿ç”¨çŠ¶æ€ç”¨çš„æ˜¯ Hooksï¼Œæœ€å¸¸è§çš„ Hooks æ˜¯ setState å’Œ useEffectï¼Œé¡¹ç›®å¤æ‚åï¼Œéœ€è¦ç»´æŠ¤çš„çŠ¶æ€å°±ä¼šå¾ˆå¤æ‚ï¼ŒReact æœ¬èº«æœ‰ä¸ªç®€å•ä½¿ç”¨çš„çŠ¶æ€ç®¡ç†åº“ React Query æ•°æ®è¯·æ±‚çš„åº“ï¼Œä½œç”¨ç±»ä¼¼ Reduxï¼Œä½†æ²¡æœ‰æ¨¡ç‰ˆä»£ç ï¼Œæ›´è½»é‡å’Œæ˜“ç”¨ï¼Œè¿˜å¯ç”¨ Hooksã€‚React Router æ˜¯å£°æ˜å¼è·¯ç”±ï¼Œé€šè¿‡ URL å¯ä»¥æ¸²æŸ“å‡ºä¸åŒçš„ç»„ä»¶ã€‚react è·‘åœ¨ QuickJS ä¸Šçš„æ–¹æ³•å¯ä»¥å‚çœ‹ QuickJS é‚®ä»¶åˆ—è¡¨é‡Œ<a href="https://www.freelists.org/post/quickjs-devel/Running-React-on-QuickJS">è¿™å°é‚®ä»¶</a>ã€‚</p>
<p>React æ¡†æ¶å¯¹åº”ç§»åŠ¨ç«¯å¼€å‘çš„æ˜¯ React Nativeã€‚</p>
<p>React Native ä½¿ç”¨äº†ç±»ä¼¼å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´é€šè®¯çš„æ¨¡å¼ï¼Œé€šè¿‡ JSON æ ¼å¼è¿›è¡Œæ¡¥æ¥æ•°æ®ä¼ é€’ã€‚React Native ä¸­æœ‰å¤§é‡ js ä¸é€‚åˆç¼–å†™çš„åŠŸèƒ½å’Œä¸šåŠ¡é€»è¾‘ï¼Œæ¯”å¦‚çº¿ç¨‹æ€§èƒ½ç›¸åº”æ–¹é¢è¦æ±‚é«˜çš„åª’ä½“ã€IOã€æ¸²æŸ“ã€åŠ¨ç”»ã€å¤§é‡è®¡ç®—ç­‰ï¼Œè¿˜æœ‰ç³»ç»Ÿå¹³å°ç›¸å…³åŠŸèƒ½ç‰¹æ€§çš„åŠŸèƒ½ä¸šåŠ¡ä»£ç ã€‚</p>
<p>è¿™æ ·çš„ä»£ç ä»¥å‰éƒ½æ˜¯ä½¿ç”¨çš„åŸç”Ÿä»£ç å’Œ C++ ä»£ç ç¼–å†™ï¼ŒC++ ä»£ç é€šè¿‡é™æ€ç¼–è¯‘æ–¹å¼é›†æˆåˆ°å·¥ç¨‹ä¸­ï¼Œä¹Ÿèƒ½å®ç°éƒ¨åˆ†å¹³å°é€šç”¨ï¼Œä½†æ˜¯ C++ ç¼–å†™ä»£ç åœ¨å¹¶å‘æƒ…å†µä¸‹éå¸¸å®¹æ˜“äº§ç”Ÿéš¾æŸ¥çš„å†…å­˜å®‰å…¨å’Œå¹¶å‘é—®é¢˜ï¼Œå¯¹äºä¸€äº›æ¯”è¾ƒå¤§çš„å·¥ç¨‹ï¼Œå¼€å¯ Monkey æµ‹è¯•ç”±äºæ’æ¡©å¯¼è‡´å†…å­˜ä¼šå¢å¤§å¥½å‡ å€ï¼Œä»è€Œæ— æ³•æ­£å¸¸å¯åŠ¨ï¼ŒæŸ¥é—®é¢˜æ›´åŠ å›°éš¾ã€‚å½“ç„¶ Rust ä¹Ÿè®¸æ˜¯å¦ä¸€ç§é€‰æ‹©ï¼Œrust è¯­è¨€å±‚é¢å¯¹ FFI æœ‰æ”¯æŒï¼Œä½¿ç”¨ extern å°±å¯ä»¥å®ç° rust ä¸å…¶ä»–ç¼–ç¨‹è¯­è¨€çš„äº¤äº’ã€‚rust å¯¹å†…å­˜å®‰å…¨å’Œå¹¶å‘çš„é—®é¢˜éƒ½èƒ½å¤Ÿåœ¨ç¼–è¯‘æ—¶å‘ç°ï¼Œè€Œä¸ç”¨æ‹…å¿ƒä¼šåœ¨è¿è¡Œæ—¶å‘ç°ï¼Œè¿™æ ·å¼€å‘ä½“éªŒå’Œæ•ˆç‡éƒ½ä¼šæé«˜å¾ˆå¤šï¼Œç‰¹åˆ«æ˜¯åœ¨é‡æ„æ—¶ä¸ä¼šæ‹…å¿ƒå¼•å…¥æœªçŸ¥å†…å­˜å’Œå¹¶å‘é—®é¢˜ã€‚ä½¿ç”¨ rust ç¼–è¯‘ iOS æ¶æ„çš„äº§ç‰©ä¹Ÿå¾ˆç®€å•ï¼Œå…ˆå®‰è£… Rustupï¼Œç„¶ååœ¨ rustup é‡Œæ·»åŠ  iOS ç›¸å…³æ¶æ„ï¼Œrust çš„åŒ…ç®¡ç†å·¥å…·æ˜¯ cargoï¼Œç±»ä¼¼äº cocoapodsï¼Œcargo çš„å­å‘½ä»¤ cargo-lipo å¯ä»¥ç”Ÿæˆ iOS åº“ï¼Œåˆ›å»ºä¸€ä¸ª C çš„æ¡¥æ¥æ–‡ä»¶ï¼Œå†é›†æˆåˆ°å·¥ç¨‹ä¸­ã€‚å¯¹äº Android å¹³å°ï¼Œrust æœ‰ä¸“é—¨çš„ android-ndk-rs åº“ã€‚rust çš„ ffi åœ¨å¤šè¯­è¨€å¤„ç†ä¸­éœ€è¦ä¸€ä¸ªä¸­é—´çš„é€šä¿¡å±‚å¤„ç†æ•°æ®ï¼Œæ€§èƒ½å’Œå®‰å…¨æ€§éƒ½ä¸é«˜ï¼Œå¯ä»¥ä½¿ç”¨ flatbuffers ã€‚å…³äºåºåˆ—åŒ–æ–¹æ¡ˆæ€§èƒ½æ¯”è¾ƒå¯ä»¥å‚çœ‹ <a href="https://codeburst.io/json-vs-protocol-buffers-vs-flatbuffers-a4247f8bda6f">JSON vs Protocol Buffers vs FlatBuffers</a> è¿™ç¯‡æ–‡ç« ã€‚</p>
<p>React Native æœ¬èº«ä¹Ÿåœ¨å¾€å‰èµ°ã€‚ä»¥å‰ React Native æœ‰ä¸‰ä¸ªçº¿ç¨‹ï¼Œåˆ†åˆ«æ˜¯æ‰§è¡Œ js ä»£ç çš„ JS Threadï¼Œè´Ÿè´£åŸç”Ÿæ¸²æŸ“å’Œè°ƒç”¨åŸç”Ÿèƒ½åŠ›çš„ UI Threadï¼Œæ¨¡æ‹Ÿè™šæ‹Ÿ DOM å°† Flexbox å¸ƒå±€è½¬åŸç”Ÿå¸ƒå±€çš„ Shadow Threadã€‚ä¸‰ä¸ªçº¿ç¨‹å·¥ä½œæ–¹å¼æ˜¯ JS Thread ä¼šå…ˆå¯¹ React ä»£ç è¿›è¡Œåºåˆ—åŒ–ï¼Œé€šè¿‡ Bridge å‘ç»™ Shadow Threadï¼ŒShadow Thread ä¼šè¿›è¡Œååºåˆ—åŒ–ï¼Œå½¢æˆè™šæ‹Ÿ DOM äº¤ç”± Yogo è½¬æˆåŸç”Ÿå¸ƒå±€ï¼ŒShadow Thread å†é€šè¿‡ Bridge ä¼ ç»™ UI Threadï¼ŒUI Thread è·å–æ¶ˆæ¯å…ˆååºåˆ—åŒ–ï¼Œå†æŒ‰å¸ƒå±€ä¿¡æ¯è¿›è¡Œç»˜åˆ¶ï¼Œå¯ä»¥çœ‹å‡ºä¸‰ä¸ªçº¿ç¨‹äº¤äº’å¤æ‚ï¼Œè€Œä¸”æ¶ˆæ¯é˜Ÿåˆ—éƒ½æ˜¯å¼‚æ­¥ï¼Œä½¿å¾—äº‹ä»¶éš¾ä¿å¤„ç†ï¼Œåºåˆ—åŒ–éƒ½æ˜¯ç”¨çš„ JSON æ€§èƒ½å’Œ Protocol Buffers è¿˜æœ‰ FlatBuffers ç›¸æ¯”å·®å¾ˆå¤šã€‚æ–°æ¶æ„ä¼šä»çº¿ç¨‹æ¨¡å‹åšæ”¹è¿›ï¼Œé«˜ä¼˜å…ˆçº§çº¿ç¨‹ä¼šç›´æ¥åŒæ­¥è°ƒç”¨ jsï¼Œä½ä¼˜å…ˆçº§æ›´æ–° UI çš„ä»»åŠ¡ä¸åœ¨ä¸»çº¿ç¨‹å·¥ä½œã€‚åŒæ—¶æ–°æ¶æ„çš„æ ¸å¿ƒ JSI æ–¹æ¡ˆç®€åŒ– js å’ŒåŸç”Ÿè°ƒç”¨ï¼Œæ”¹é€ æˆæ›´è½»é‡æ›´é«˜æ•ˆçš„è°ƒç”¨æ–¹å¼ï¼Œç”¨æ¥æ›¿æ¢ Bridgeã€‚JSI ä½¿å¾—ä»¥å‰çš„ä¸‰ä¸ªçº¿ç¨‹é€šä¿¡ä¸ç”¨éƒ½é€šè¿‡ Bridge è¿™ç§ä¾èµ–æ¶ˆæ¯åºåˆ—åŒ–å¼‚æ­¥é€šä¿¡æ–¹å¼ï¼Œè€Œæ˜¯ç›´æ¥åŒæ­¥é€šä¿¡ï¼Œæ¶ˆé™¤å¼‚æ­¥é€šä¿¡ä¼šå‡ºç°çš„æ‹¥å¡é—®é¢˜ï¼Œå…·ä½“ä½¿ç”¨ä¾‹å­å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ã€Š<a href="https://medium.com/@christian.falch/https-medium-com-christian-falch-react-native-jsi-challenge-1201a69c8fbf">React Native JSI Challenge</a>ã€‹ã€‚å¦å¤– React Native æ–°æ¶æ„çš„ JSI æ˜¯ä¸€ä¸ªè½»é‡çš„ C++æ¡¥æ¥æ¡†æ¶ï¼Œé€šä¿¡å¯¹æ¥çš„ js å¼•æ“æ¯”å¦‚ JSCã€Hermesã€V8ã€QuickJSã€JerryScript å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ›¿æ¢ã€‚å…³äº JSI çš„è¯¦æƒ…å’Œè¿›å±•å¯ä»¥å‚è€ƒå…¶<a href="https://github.com/react-native-community/discussions-and-proposals/issues/91">ææ¡ˆåœ°å€</a>ã€‚</p>
<p>2019 å¹´å‡ºç°çš„ Svelteã€‚Svelte çš„ç‰¹ç‚¹æ˜¯æ„å»ºå‡ºçš„ä»£ç å°ï¼Œä½¿ç”¨æ—¶å¯ä»¥ç›´æ¥ä½¿ç”¨æ„å»ºå‡ºå¸¦æœ‰å°‘é‡ä»…ä¼šç”¨åˆ°é€»è¾‘çš„è¿è¡Œæ—¶çš„ç»„ä»¶ï¼Œä¸éœ€è¦ä¸“é—¨çš„æ¡†æ¶ä»£ç ä½œä¸ºè¿è¡Œæ—¶ä½¿ç”¨ï¼Œä¸ä¼šæµªè´¹ã€‚Svelte æ²¡æœ‰ diff å’Œ patch æ“ä½œï¼Œä¹Ÿèƒ½å¤Ÿå‡å°‘ä»£ç ï¼Œå‡å°‘å†…å­˜å ç”¨ï¼Œæ€§èƒ½ä¼šæœ‰æå‡ã€‚å½“ç„¶ Svelte çš„ä¼˜ç‚¹åœ¨é¡¹ç›®å¤§äº†åå¯èƒ½ä¸ä¼šåƒå°é¡¹ç›®é‚£ä¹ˆæ˜æ˜¾ã€‚</p>
<p>CSS æ¡†æ¶æœ‰ Bootstrapã€Bulmaã€Tailwind CSSï¼Œå…¶ä¸­è®¤å¯åº¦æœ€é«˜çš„æ˜¯ Tailwind CSSï¼Œè¿‘å¹´æ¥ Bootstrap æŒç»­é™ä½ï¼ŒTailwind CSS å’Œ Bootstrap æœ€å¤§çš„ä¸åŒå°±æ˜¯ Tailwind CSS æ²¡æœ‰å¿…è¦çš„å†…ç½®ç»„ä»¶ï¼Œå› æ­¤éå¸¸è½»é‡ï¼Œè¿˜æä¾›äº† utility class é›†åˆå’Œç­‰ä»·äº Lessã€Sass æ ·å¼å£°æ˜çš„ DSLã€‚æµè§ˆå™¨å¯¹ CSS æ ·å¼å’Œ DOM ç»“åˆè¿›è¡Œæ¸²æŸ“çš„åŸç†å¯ä»¥å‚çœ‹æˆ‘ä»¥å‰ã€Š<a href="https://ming1016.github.io/2017/10/11/deeply-analyse-webkit/">æ·±å…¥å‰–æ WebKit</a>ã€‹è¿™ç¯‡æ–‡ç« ã€‚</p>
<p>åœ¨æµè§ˆå™¨ä¹‹å¤–é¢†åŸŸæœ€æˆåŠŸçš„æ¡†æ¶è¦æ•° Node.js äº†ã€‚</p>
<p>Ryan Dahl åŸºäº V8 å¼€å‘äº† Node.jsï¼Œæä¾›æ ‡å‡†åº“è®© js èƒ½å¤Ÿå»ºç«‹ HTTP æœåŠ¡ç«¯åº”ç”¨ã€‚æ¯”å¦‚ä¸‹é¢çš„ js ä»£ç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> hostname = <span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> port = <span class="number">3000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.statusCode = <span class="number">200</span>;</span><br><span class="line">  res.setHeader(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/plain&#x27;</span>);</span><br><span class="line">  res.end(<span class="string">&#x27;hi&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(port, hostname, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Server running at http://<span class="subst">$&#123;hostname&#125;</span>:<span class="subst">$&#123;port&#125;</span>/`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç è¿è¡Œåä¼šèµ·äº†ä¸ªæœåŠ¡åº”ç”¨ï¼Œè®¿é—®åä¼šè¾“å‡º hiã€‚Node.js ä¼šæ¶‰åŠåˆ°ä¸€äº›ç³»ç»Ÿçº§çš„å¼€å‘ï¼Œæ¯”å¦‚ I/Oã€ç½‘ç»œã€å†…å­˜ç­‰ã€‚</p>
<p>Node.js ä½œè€… Ryan Dahl åæ¥å¼„äº† Denoï¼Œé’ˆå¯¹ Node.js åšäº†æ”¹è¿›ã€‚åŸºäº Node.js å¼€å‘åº”ç”¨æœåŠ¡çš„æ¡†æ¶è¿˜æœ‰ Next.jsï¼ŒNext.js æ˜¯ä¸€ä¸ª React æ¡†æ¶ï¼ŒåŒ…æ‹¬äº†å„ç§æœåŠ¡åº”ç”¨çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ SSRã€è·¯ç”±å’Œæ‰“åŒ…æ„å»ºï¼ŒNetflix ä¹Ÿåœ¨ç”¨ Next.jsã€‚æœ€è¿‘å‰ç«¯æµè¡Œå…¨æ ˆæ— æœåŠ¡å™¨ Web åº”ç”¨æ¡†æ¶ï¼ŒåŒ…å« Reactã€GraphQLã€Prismaã€Babelã€Webpack çš„ Redwood æ¡†æ¶è¡¨ç°ç‰¹åˆ«çªå‡ºï¼Œèƒ½å¤Ÿç»™å¼€å‘çš„äººæä¾›å¼€å‘ Web åº”ç”¨ç¨‹åºçš„å®Œæ•´ä½“éªŒã€‚</p>
<p>Node.js åçš„çƒ­ç‚¹å°±æ˜¯å¼€å‘å·¥å…·ï¼Œå·¥ç¨‹æ„å»ºï¼Œæœ€è¿‘å°±æ˜¯ FaaS å¼€å‘ã€‚å·¥ç¨‹å¼€å‘å·¥å…·æœ‰ä¾èµ–åŒ…ç®¡ç†çš„ npm å’Œ yarnï¼Œwebpackã€Snowpackã€Viteã€<a href="https://github.com/evanw/esbuild">esbuild</a> å’Œ rollup ç”¨æ¥æ‰“åŒ…ã€‚å…¶ä¸­ esbuild çš„æ„å»ºé€Ÿåº¦æœ€å¿«ã€‚</p>
<p>æµ‹è¯•æ¡†æ¶æœ‰ Karmaã€Mochaã€Jestï¼ŒReact æµ‹è¯•åº“ Enzymeã€‚å…¶ä¸­ Jest éå¸¸ç®€å•æ˜“ç”¨ï¼Œå¯è¿›è¡Œå¿«ç…§æµ‹è¯•ï¼Œå¯ç”¨äº Reactã€Typescript å’Œ Babel é‡Œï¼ŒJest ç›®å‰æ— ç–‘æ˜¯æµ‹è¯•æ¡†æ¶ä¸­æœ€ç«çš„ã€‚å¦å¤–è¿˜æœ‰ä¸ª Testing Library å¯ç”¨æ¥è¿›è¡Œ DOM å…ƒç´ çº§åˆ«æµ‹è¯•æ¡†æ¶ï¼Œæ¥å£æ˜“ç”¨ï¼Œå€¼å¾—å…³æ³¨ã€‚</p>
<p>æœ€è¿‘æ¯”è¾ƒçƒ­é—¨çš„æ˜¯ä½ä»£ç ï¼Œä½ä»£ç åšçš„æ¯”è¾ƒå¥½çš„æœ‰ <a href="https://github.com/imgcook/imove">iMove</a> ç­‰ï¼Œä»–ä»¬é€šè¿‡æ‹–æ‹½å¯è§†åŒ–æ“ä½œæ–¹å¼ç¼–è¾‘ä¸šåŠ¡äº‹ä»¶é€»è¾‘ã€‚è¿™é‡Œæœ‰ä»½<a href="https://github.com/taowen/awesome-lowcode">ä½ä»£ç çš„ awesome</a>ï¼Œæ”¶å½•äº†å„å‚å’Œä¸€äº›å¼€æºçš„ä½ä»£ç èµ„æºã€‚</p>
<p>2020 å¹´ Stack Overflow å¼€å‘è€…è°ƒæŸ¥æ˜¾ç¤ºè¶…è¿‡åŠæ•°çš„å¼€å‘è€…ä¼šä½¿ç”¨ jsï¼Œè¿™å¾—ç›Šäºå¤šå¹´æ¥ä¸æ–­æ›´æ–°ç´¯ç§¯çš„å®ç”¨æ¡†æ¶å’Œåº“ï¼Œè¿˜æœ‰ç”Ÿæ€ç¤¾åŒºçš„ç¹è£ï¼Œè¿˜æœ‰ç”±å„å¤§çŸ¥åå…¬å¸å¤§é‡è¯­è¨€å¤§å¸ˆä¸“é—¨ä¸º js ç»„æˆçš„æŠ€æœ¯å§”å‘˜ä¼š TC39ï¼Œä¸æ–­æ‰“ç£¨ jsã€‚</p>
<p>js èƒŒæ™¯è¯´å®Œäº†ï¼Œæ¥ä¸‹æ¥å’±ä»¬æ¥èŠèŠ QuickJS çš„ä½œè€…å§ã€‚</p>
<h3 id="ä½œè€…"><a href="#ä½œè€…" class="headerlink" title="ä½œè€…"></a>ä½œè€…</h3><p>QuickJS ä½œè€… Fabrice Bellard æ˜¯ä¸€ä¸ªä¼ å¥‡äººç‰©ï¼Œé€Ÿåº¦æœ€å¿«çš„<a href="https://bellard.org/tcc/">TCC</a>ï¼Œè¿˜æœ‰åŠŸèƒ½å¼ºå¤§ï¼Œä½¿ç”¨æœ€å¹¿çš„è§†é¢‘å¤„ç†åº“ <a href="http://ffmpeg.org/">FFmpeg</a> å’Œ Android æ¨¡æ‹Ÿå™¨ QEMU éƒ½æ˜¯å‡ºè‡ªä»–æ‰‹ã€‚</p>
<p>ä¸€ä¸ªäººåœ¨ä¸€ä¸ªé¡¹ç›®æˆ–è€…ä¸€ä¸ªæ–¹å‘ä¸Šå–å¾—å¾ˆå¤§æˆæœå°±å¾ˆå‰å®³äº†ï¼Œä½†æ˜¯ Fabrice Bellard å´åœ¨Cè¯­è¨€ã€æ•°æ®å‹ç¼©ã€æ•°å€¼æ–¹æ³•ã€ä¿¡å·å¤„ç†ã€åª’ä½“æ ¼å¼ã€è§£æå™¨æ–¹é¢å¼„äº†å¾ˆå¤šçš„å®ç”¨æ˜æ˜Ÿé¡¹ç›®ï¼Œæ¶‰åŠç¼–è¯‘ã€è™šæ‹Ÿæœºã€æ“ä½œç³»ç»Ÿã€å›¾å½¢å­¦ã€æ•°å­¦ç­‰é¢†åŸŸã€‚è¿˜èƒ½åç»­ç»´æŠ¤å’Œç®¡è¶³æ–‡æ¡£ï¼Œæ¯”å¦‚ QuickJS å°±ä¼šé…å¥—çš„å¯¹æ–° ECMAScript ç‰¹æ€§ã€è¿è¡Œæ—¶æ–° APIè¿›è¡Œæ”¯æŒæ›´æ–°ã€‚å„é¡¹éƒ½åœ¨æ€§èƒ½ã€å¯ç§»æ¤æ ¸çµæ´»æ€§ä¸Šåšåˆ°æè‡´ï¼Œéå¸¸ç‰›äº†ã€‚æˆ‘è§‰å¾— Fabrice Bellard å’Œ John D. Carmack II ä¸€æ ·ï¼Œå±äºä¸€äººå¯æŠµä¸€ä¸ªå†›å›¢çš„å¤©æ‰ï¼Œå…³äº John D. Carmack II çš„ä»‹ç»å¯ä»¥å‚çœ‹ã€Š<a href="https://book.douban.com/subject/1152971/">DOOMå¯ä¸–å½•</a>ã€‹è¿™æœ¬ä¹¦ã€‚ä¸‹é¢æ˜¯ä»–é¡¹ç›®çš„ä»‹ç»ï¼š</p>
<ul>
<li>1989ï¼š<a href="http://bellard.org/lzexe.html">LZEXE</a> é«˜ä¸­æ—¶å€™å†™çš„ DOS ä¸Šå¾ˆæœ‰åçš„å¯æ‰§è¡Œå‹ç¼©ç¨‹åºã€‚é‚£æ—¶ Fabrice Bellar ä½¿ç”¨ Amstrad PC1512 ç¼–ç¨‹ï¼Œç”±äº Amstrad PC1512ç£ç›˜ç©ºé—´éå¸¸æœ‰é™ï¼Œäºæ˜¯ä»–ä½¿ç”¨8086æ±‡ç¼–é‡å†™äº† LZSS å‹ç¼©ç®—æ³•ï¼Œå¹¶ä¼˜åŒ–äº†ä»£ç ç»“æ„ï¼Œæ–°çš„å‹ç¼©ç¨‹åºå°±æ˜¯ LZEXEï¼ŒLZEXE è§£å‹é€Ÿåº¦éå¸¸å¿«ï¼Œå……åˆ†æ˜¾ç¤ºäº†ä»–è¶…é«˜çš„ç¼–ç¨‹å¤©èµ‹ã€‚</li>
<li>1996ï¼š<a href="http://web.archive.org/web/19990117093837/http:/www.irisa.fr/compose/harissa/harissa.html">Harissa</a> Java è™šæ‹Ÿæœºã€‚</li>
<li>1997ï¼š <a href="https://bellard.org/pi/pi2700e9/">Pi è®¡ç®—ä¸–ç•Œçºªå½•ä¿æŒè€…</a>ã€‚Fabrice Bellard çš„è®¡ç®—åœ†å‘¨ç‡çš„å…¬å¼ <a href="https://bellard.org/pi/">Bellard å…¬å¼</a>ï¼Œæ˜¯ BBP å…¬å¼çš„å˜ä½“ï¼Œè®¡ç®—ä¸­ä½¿ç”¨ä¼˜åŒ–çš„æŸ¥å¾·è¯ºå¤«æ–¯åŸºæ–¹ç¨‹ç®—æ³•è®¡ç®—ï¼Œå¤æ‚åº¦ä»O(n3)é™åˆ°äº†O(n2)ã€‚ç”¨ BBP å…¬å¼æ¥éªŒè¯ç»“æœã€‚Bellard å…¬å¼æ¯” Bailey-Borwein-Plouffe å…¬å¼å¿«43%ï¼Œåœ¨åœ†å‘¨ç‡ç«èµ›ä¸­å–èƒœæˆä¸ºæœ€å¿«çš„è®¡ç®—åœ†å‘¨ç‡ç®—æ³•ï¼Œåˆ›é€ äº†Pi è®¡ç®—ä¸–ç•Œçºªå½•ï¼Œç›´åˆ°2010å¹´8æœˆè¢«ä½™æ™ºæ’å’Œè¿‘è—¤èŒ‚æ‰“ç ´ï¼Œä»–ä»¬å®Œæˆäº†äº”ä¸‡äº¿ä½çš„ Pi è®¡ç®—ï¼Œä½¿ç”¨çš„æ˜¯å¯ä»¥å……åˆ†åˆ©ç”¨è¶…è¿‡4æ ¸å¤šçº¿ç¨‹è¾¾åˆ°12æ ¸24è¶…çº¿ç¨‹çš„åˆ†å¸ƒå¼å¤§å‹æœåŠ¡å™¨çº§æœºå™¨è®¡ç®—çš„ y-cruncher æ¥å®Œæˆçš„è®¡ç®—ã€‚ä¸è¿‡ Fabrice Bellard ä½¿ç”¨çš„æœºå™¨é…ç½®è¦ä½å¾ˆå¤šï¼Œä½¿ç”¨äº†116å¤©ææ¡ˆç®—å‡ºäº†2700äº¿ä½ã€‚</li>
<li>1999ï¼š<a href="http://bellard.org/linmodem.html">Linmodem</a></li>
<li>2000ï¼š<a href="http://ffmpeg.org/">FFmpeg</a> ä¸»è¦æ˜¯åšéŸ³è§†é¢‘ç¼–è§£ç å’Œè½¬æ¢ï¼Œåœ¨è‹¹æœæ²¡æœ‰å¼€æ”¾ç¡¬ä»¶è§£ç æ¥å£æ—¶å€™ï¼Œåœ¨ iOS ä¸Šå„ç§è§†é¢‘ App éƒ½ä¼šç”¨ FFmpeg æ¥è§£ç è§†é¢‘ï¼ŒOpenGL ES æ¸²æŸ“ã€‚å¸¸è§çš„è§†é¢‘ç‰¹æ•ˆã€è´´çº¸éƒ½ç”¨åˆ°äº† FFmpegã€‚å¦‚ä»Šè‹¹æœå¼€æ”¾äº† Metal ç¡¬ä»¶è§£ç æ¥å£ï¼ŒAVFoundation å¯ä»¥ç›´æ¥ä½¿ç”¨ç¡¬ä»¶è§£ç ï¼Œè¿™æ ·å°±å¯ä»¥ä¸ç”¨ FFmpeg äº†ï¼Œä¸è¿‡ FFmpeg ç°åœ¨ä¾ç„¶åº”ç”¨åœ¨å„ä¸“ä¸šé¢†åŸŸï¼Œæ¯”å¦‚æ»¤é•œï¼Œæ€§èƒ½æ•ˆç‡ä¾ç„¶å¼ºåŠ²ã€‚FFmpeg å°±åƒä¸€ç¯‡åšå£«è®ºæ–‡ï¼Œå¹¶ä¸”æ¯”å…¶ä»–è®ºæ–‡è¦å¥½å¾ˆå¤šã€‚FFmpeg å¯ä»¥ä½œä¸ºåº“åœ¨åº”ç”¨ä¸­ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨é‡Œé¢çš„å·¥å…·ã€‚FFmpeg ç”±éŸ³è§†é¢‘ç¼–è§£ç åº“ libavcodec æ¨¡å—å’Œè´Ÿè´£æµåˆ°è¾“å‡ºäº’è½¬è¿‡ç¨‹çš„ Libavformat æ¨¡å—ç»„æˆï¼Œä¸¤æ¨¡å—æä¾›è§£æå’Œä¸åŒæ ¼å¼è½¬æ¢çš„èƒ½åŠ›ï¼Œå¹¶ä¸”çµæ´»æ˜“æ‰©å±•ï¼Œå¾ˆå¤šåª’ä½“å·¥å…·å’Œæ’­æ”¾å™¨éƒ½é›†æˆäº†ä»–ä»¬ã€‚éŸ³è§†é¢‘æ•°æ®ä¸åŒæ ¼å¼æœ‰ä¸åŒç®—æ³•ï¼Œç¼–ç å°±æ˜¯å†™æ•°æ®ï¼Œè§£ç å°±æ˜¯è¯»æ•°æ®ï¼Œç¼–ç è§£ç ç”± libavcodec æ¨¡å—è´Ÿè´£ã€‚ä¸€ä¸ªåª’ä½“æ•°æ®ä¼šæœ‰å¤šä¸ªæµï¼Œæ¯”å¦‚è§†é¢‘æµå’ŒéŸ³é¢‘æµï¼Œå¤šä¸ªæµæ··åˆå•è¾“å‡ºå« multiplexingï¼Œdemultiplexing æ˜¯å°†å•è¾“å‡ºè¿”å›æˆå¤šä¸ªæµã€‚multiplexing å’Œ demultiplexing ä¾é çš„å°±æ˜¯ Libavformat æ¨¡å—ã€‚</li>
<li>2000ï¼š<a href="https://bellard.org/mersenne.html">è®¡ç®—å½“æ—¶å·²çŸ¥æœ€å¤§ç´ æ•°26972593-1</a></li>
<li>2001ï¼š<a href="http://bellard.org/tcc/">TinyCC(Tiny C Compiler)</a> æ˜¯ã€æ˜¯GNU/Linuxç¯å¢ƒä¸‹æœ€å°çš„ ANSI C è¯­è¨€ç¼–è¯‘å™¨ï¼Œç›®å‰ç¼–è¯‘é€Ÿåº¦æ˜¯æœ€å¿«çš„ã€‚</li>
<li>2002ï¼š<a href="http://bellard.org/TinyGL/">TinyGL</a> æ¥è‡ªä»–åœ¨1998å¹´ VReng è™šæ‹Ÿç°å®å¼•æ“åˆ†å¸ƒå¼3D åº”ç”¨ï¼Œæ˜¯ä¸€ä¸ªéå¸¸å¿«é€Ÿã€ç´§å‡‘çš„OpenGLå­é›†ã€‚TinyGL æ¯” Mesaï¼ˆåè¢« VMWare æ”¶è´­ï¼‰ è¿˜è¦å¿«è¦å°ï¼Œå ç”¨æ›´å°‘çš„èµ„æºã€‚</li>
<li>2002ï¼š<a href="https://bellard.org/qemacs/">QEmacs</a>ï¼ŒBellard ä¸ºä»–çš„ QEmacs å†™äº†ä¸ªåŒ…æ‹¬ HTML/XML/CSS2/DocBook æ¸²æŸ“å¼•æ“ï¼Œå¦‚æœé…åˆ QuickJS ç»„è£…æˆä¸€ä¸ªæµè§ˆå™¨ä¸€ç‚¹é—®é¢˜ä¹Ÿæ²¡æœ‰ã€‚Emacs å¤„ç†å¤§æ–‡ä»¶å¾ˆæ‹¿æ‰‹ï¼Œä¸€ä¸ªæ–‡ä»¶ä¹Ÿèƒ½å¤šå¼€ç‹¬ç«‹çª—å£ï¼Œæˆ‘è§‰å¾— QuickJS 5ä¸‡è¡Œçš„æ ¸å¿ƒä»£ç æ˜¯ Bellard åœ¨è‡ªå·±çš„ QEmacs é‡Œå†™çš„ï¼Œå› ä¸º QEmacs æœ‰ä¸ªæ˜¾è‘—çš„ç‰¹æ€§æ˜¯ä½¿ç”¨é«˜åº¦ä¼˜åŒ–çš„å†…éƒ¨è¡¨ç¤ºæ³•å’Œå¯¹æ–‡ä»¶è¿›è¡Œ mmapingï¼Œè¿™æ ·å¸¦æ¥çš„å¥½å¤„æ˜¯ä¸Šç™¾å…†çš„æ–‡ä»¶ç¼–è¾‘èµ·æ¥ä¹Ÿä¸ä¼šæ…¢ã€‚</li>
<li>2003ï¼š<a href="https://www.qemu.org/">QEMU</a> åœ¨ä¸€å°ç‰©ç†æœºå™¨ä¸Šç®¡ç†æ•°ç™¾ä¸ªä¸åŒè®¡ç®—ç¯å¢ƒã€‚QEMU ä¸­ Fabrice Bellard å£°æ˜äº†ä¸¤ç™¾å¤šä¸ªç‰ˆæƒå£°æ˜ï¼Œå äº†è¿‘1/3ã€‚QEMU ä¸æ˜¯ä¸€æ¬¡ç¿»è¯‘ä¸€æ¡æŒ‡ä»¤ï¼Œä¼šå°†å¤šä¸ªæŒ‡ä»¤ç¿»è¯‘åä¸€æ¬¡è®°åˆ° chunk é‡Œï¼Œå¦‚æœè¿™å¤šä¸ªæŒ‡ä»¤ä¼šæ‰§è¡Œå¤šæ¬¡ï¼Œé‚£ä¹ˆè¿™ä¸ªç¿»è¯‘è¿‡ç¨‹å°±ä¼šè¢«çœæ‰ï¼Œä»è€Œæé«˜æ‰§è¡Œé€Ÿåº¦ã€‚VirtualBoxã€Linux Kernel-based è™šæ‹Ÿæœº(KVM)ã€Android æ¨¡æ‹Ÿå™¨éƒ½æ˜¯åŸºäº QEMUã€‚</li>
<li>2004ï¼š<a href="http://bellard.org/tcc/tccboot.html">TinyCC Boot Loader</a> å¯åœ¨15ç§’å†…ä»ä»£ç ç¼–è¯‘åˆ°å¯åŠ¨ Linux ç³»ç»Ÿã€‚</li>
<li>2005ï¼š<a href="https://bellard.org/dvbt/">DVB-T computer-hosted transmitter</a> ç”¨æ™®é€š PC å¤–åŠ  VGA å¡ï¼Œäº§ç”ŸVHFä¿¡å·ï¼Œå……å½“æ¨¡æ‹Ÿæ•°å­—ç”µè§†ç³»ç»Ÿã€‚</li>
<li>2011ï¼š<a href="https://bellard.org/jslinux/">JSLinux</a> ç”¨ Javascript å¼€å‘çš„ PC æ¨¡æ‹Ÿå™¨ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨é‡Œè¿è¡Œ Linuxã€‚</li>
<li>2012ï¼š<a href="https://bellard.org/lte/">LTEENB</a> æ˜¯ PC è½¯ä»¶å®ç°4G LTE/5G NRåŸºç«™ã€‚èƒ½è·‘åœ¨ä¸€ä¸ªæ™®é€š4æ ¸ CPU çš„ PC ä¸Šã€‚æ®è¯´æ˜¯ Fabrice Bellard ä¸€ä¸ªäºº10ä¸ªæœˆåšå‡ºæ¥çš„ï¼Œæœ‰äººè°ƒä¾ƒè¯´10ä¸ªæœˆè‡ªå·±å¯èƒ½åè®®éƒ½è¯»ä¸å®Œã€‚ç›®å‰ LTEENB ç”¨åœ¨ä»–åˆ›åŠçš„ Amarisoft å…¬å¸é‡Œã€‚</li>
<li>2014ï¼š<a href="https://bellard.org/bpg/">BPG</a> åŸºäºHEVCçš„æ–°å›¾åƒæ ¼å¼ï¼Œä½¿ç”¨ JavaScript è§£ç å™¨ã€‚ç›¸æ¯”è¾ƒJPEGï¼ŒBPG æœ‰ç€æ›´é«˜çš„å‹ç¼©ç®—æ³•ï¼Œç›¸åŒè´¨é‡ä½“ç§¯å°‘åŠã€‚</li>
<li>2017ï¼š<a href="https://bellard.org/tinyemu/">TinyEMU</a> è¢«å¼€å‘å‡ºæ¥ï¼ŒTinyEMUå¯ä»¥æ¨¡æ‹Ÿ128ä½ç²¾ç®€æŒ‡ä»¤é›† RISC-Vï¼ˆåŸºäº RISC å¼€æºæŒ‡ä»¤é›†æ¶æ„ï¼‰ å’Œ x86 CPU æŒ‡ä»¤é›†çš„å°å‹æ¨¡æ‹Ÿå™¨ï¼Œå¦å¤– TinyEMU è¿˜æœ‰ js ç‰ˆï¼Œå¯ä»¥è¿è¡Œ Linux å’Œ Windows 2000ã€‚</li>
<li>2019ï¼š<a href="https://bellard.org/quickjs/">QuickJS</a> æœ¬ç¯‡ä¸»è§’ JavaScript å¼•æ“ã€‚</li>
</ul>
<p>æ›´è¯¦ç»†çš„ä»‹ç»å¯ä»¥çœ‹ Fabrice Bellard çš„æ— æ ·å¼<a href="https://bellard.org/">ä¸ªäººç½‘ç«™</a> ä»¥åŠç½‘ç«™ä¸Šåˆ—å‡ºä»–çš„å„ä¸ªé¡¹ç›®ä»£ç ã€‚</p>
<h3 id="Decimal"><a href="#Decimal" class="headerlink" title="Decimal"></a>Decimal</h3><p>QuickJS åœ¨2020-01-05ç‰ˆæœ¬åŠ å…¥â€“bignum flag ç”¨æ¥å¼€å¯ Decimal ç§‘å­¦è®¡ç®—ï¼Œä¾é ä»–ä»¥å‰å†™çš„ <a href="https://bellard.org/libbf/">LibBF</a> æ¥å¤„ç† BigIntã€BigFloat å’Œ BigDecimal æ•°å­—ã€‚LibBFå¯ä»¥å¤„ç†ä»»æ„ç²¾åº¦æµ®ç‚¹æ•°çš„åº“ï¼Œä½¿ç”¨æ¸è¿›æœ€ä¼˜ç®—æ³•ï¼ŒåŸºæœ¬ç®—æœ¯è¿ç®—æ¥è¿‘çº¿æ€§è¿è¡Œæ—¶é—´ã€‚ä½¿ç”¨çš„ IEEE 754è¯­ä¹‰ï¼Œæ“ä½œéƒ½æ˜¯æŒ‰ IEEE 754æ ‡å‡†æ¥è¿›è¡Œå››èˆäº”å…¥ã€‚åŸºæœ¬åŠ å‡ä¹˜é™¤å’Œå¹³æ–¹æ ¹ç®—æœ¯è¿ç®—éƒ½å…·æœ‰æ¥è¿‘çº¿æ€§çš„è¿è¡Œæ—¶é—´ï¼Œä¹˜æ³•ä½¿ç”¨ SIMD ä¼˜åŒ–çš„ Number Theoretic Transform æ¥è¿ç®—ï¼ŒSIMDï¼ˆSingle instruction, multiple dataï¼‰æ˜¯å•æŒ‡ä»¤å¤šæ•°æ®çš„æ„æ€ï¼Œè¡¨ç¤ºæŸæ—¶åˆ»ä¸€ä¸ªæŒ‡ä»¤èƒ½å¤Ÿå¹¶è¡Œè®¡ç®—ï¼Œé€‚åˆä»»åŠ¡åŒ…æ‹¬è°ƒéŸ³é‡å’Œè°ƒå›¾å½¢å¯¹æ¯”åº¦ç­‰å¤šåª’ä½“æ“ä½œã€‚èƒ½å¤Ÿæ”¯æŒsinã€cosã€tanè¿™æ ·çš„å‡½æ•°ã€‚</p>
<p>TC39è¿™äº›å¹´æ¥ä¸€ç›´åœ¨è€ƒè™‘åŠ å…¥é«˜ç²¾åº¦çš„å°æ•°ç±»å‹ Decimalã€‚</p>
<p>è¿™äº›éƒ½æ˜¯ä»€ä¹ˆæ•°å­—å‘¢ï¼Ÿ</p>
<p>Int çš„æœ€å¤§å€¼æ˜¯2çš„31æ¬¡æ–¹å‡1ï¼Œåè¿›åˆ¶å°±æ˜¯2147483647ï¼Œå…±31ä½ï¼Œå¦‚æœéœ€è¦æ›´å¤§ä½æ•°å°±éœ€è¦ç”¨äºç§‘å­¦è®¡ç®—çš„ Decimalã€‚Decimal128æ˜¯128ä½çš„é«˜ç²¾åº¦ç²¾ç¡®å°æ•°ç±»å‹ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Decimal è¿™ç§ç±»å‹å‘¢ï¼Ÿ</p>
<p>decimal åˆ†æ•°é€šå¸¸ä¸èƒ½ç”¨äºŒè¿›åˆ¶æµ®ç‚¹ç²¾ç¡®è¡¨ç¤ºï¼Œå½“å»ºç«‹åè¿›åˆ¶å­—ç¬¦ä¸²è¡¨ç¤ºé‡ç›¸äº’ä½œç”¨æ¨¡å‹æ—¶ï¼ŒäºŒè¿›åˆ¶æµ®ç‚¹ç²¾åº¦æ•ˆæœè¾ƒå·®ï¼Œæ‰€ä»¥æ¶‰åŠè´¢åŠ¡è®¡ç®—éƒ½ä¸ç”¨äºŒè¿›åˆ¶æµ®ç‚¹æ•°å­—ï¼Œè¿˜æœ‰äº›å°æ•°ä¸èƒ½ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œå°¾æ•°éƒ¨åˆ†ä¼šä¸€ç›´å¾ªç¯ï¼Œæ‰€ä»¥ä¼šæˆªæ–­ï¼Œè¿™æ ·ç²¾åº¦å°±ä¼šæœ‰å½±å“ï¼Œæ¯”å¦‚0.1 + 0.2 == 0.3å°±æ˜¯ falseï¼Œ0.2 + 0.2 == 0.4å°±æ˜¯ trueã€‚å‡ºç°è¿™ä¸ªæƒ…å†µçš„åŸå› æ˜¯äºŒè¿›åˆ¶å”¯ä¸€çš„è´¨å› æ•°æ˜¯2ï¼Œå› æ­¤ä»¥2ä½œä¸ºè´¨å› æ•°è¡¨ç¤ºåˆ†æ¯çš„åˆ†æ•°æ²¡æœ‰é—®é¢˜ï¼Œè€Œä»¥5æˆ–10ä½œä¸ºåˆ†æ¯çš„åˆ†æ•°æ˜¯é‡å¤çš„å°æ•°ï¼Œ0.1çš„æ˜¯åˆ†æ¯ä¸º10çš„åˆ†æ•°1/10ï¼Œ0.2æ˜¯åˆ†æ¯ä¸º5çš„åˆ†æ•°1/5ï¼Œè¿™äº›é‡å¤å°æ•°è¿›è¡Œè¿ç®—ç„¶åè½¬æ¢ä¸ºåè¿›åˆ¶æ—¶å°±ä¼šå‡ºç°é—®é¢˜ã€‚è¿™é‡Œæœ‰ä¸ªç½‘ç«™<a href="https://0.30000000000000004.com/">0.30000000000000004.com</a>ä¸“é—¨æ”¶é›†äº†å„ç§è¯­è¨€ 0.1 + 0.2 çš„ç»“æœï¼Œä¹ŸåŒ…å«äº† Cã€C++ã€Kotlinã€Objective-Cã€Swift å’Œ JavaScriptï¼ŒåŒæ—¶ä¹Ÿåˆ—å‡ºäº†å¦‚ä½•ä½¿ç”¨è¯­è¨€æ”¯æŒæ–¹æ³•æ¥å¾—åˆ° 0.3 çš„å‡†ç¡®ç»“æœï¼Œæ¯”å¦‚ swift å·²ç»æœ‰äº† Decimal å‡½æ•°ï¼Œé€šè¿‡ Decimal(0.1) + Decimal(0.2) å°±èƒ½å¤Ÿå¾—åˆ° 0.3ã€‚<a href="https://floating-point-gui.de/">The Floating-Point Guide - What Every Programmer Should Know About Floating-Point Arithmetic</a>è¿™ä¸ªç½‘ç«™åŒ…å«äº† Decimal æ–¹æ–¹é¢é¢ï¼Œè¿˜æœ‰å„ç§è¯­è¨€çš„å¤„ç†èŒƒä¾‹ã€‚</p>
<p>Decimal å‡½æ•°çš„å®ç°åœ¨ swift æºç  stdlib/public/Darwin/Foundation/Decimal.swift è·¯å¾„ä¸‹ï¼ŒJava BigDecimalçš„å®ç°åœ¨<a href="https://docs.oracle.com/javase/7/docs/api/java/math/BigDecimal.html">è¿™é‡Œ</a>ï¼Œjs ä¹Ÿæœ‰ä¸ªäººä½¿ç”¨ js å®ç°çš„æ›´é«˜ç²¾åº¦çš„æµ®ç‚¹è¿ç®—åº“ï¼Œæ¯”å¦‚ <a href="https://github.com/mikemcl">Michael M çš„ GitHub</a> ä¸Šå°±æœ‰ <a href="https://github.com/MikeMcl/bignumber.js">bignumber.js</a>ã€<a href="https://github.com/MikeMcl/decimal.js">decimal.js</a> å’Œ <a href="https://github.com/MikeMcl/big.js">big.js</a>ã€‚QuickJS é‡‡ç”¨çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨æ•°å­—åŠ må­—é¢é‡ï¼Œè¡¨ç°èµ·æ¥å°±æ˜¯ 0.1m + 0.2mï¼Œç»“æœæ˜¯0.3mã€‚æµ®ç‚¹è¿ç®—ä¸­ä½¿ç”¨å¾ˆå¤šçš„æ•°å­—è¿›è¡Œç›¸åŠ ï¼Œä¼šäº§ç”Ÿæ¸è¿›çš„ç´¯åŠ è¯¯å·®ï¼Œç‰¹åˆ«æ˜¯åœ¨è´¢åŠ¡è®¡ç®—è¿™ç§å¯¹ç²¾åº¦è¦æ±‚é«˜çš„åº”ç”¨ä¸Šï¼Œè¿™äº›è¯¯å·®å°±ä¼šæˆä¸ºå¤§äº‹æ•…ã€‚å…ˆå‰åšåŒ…å¤§å°ä¼˜åŒ–æ—¶ï¼Œæ¨¡å—å¾ˆå¤šï¼Œå‘ç°å››èˆäº”å…¥ä½æ•°å°‘å–ä¸€ä½æ—¶åå·®è¿˜è›®å¤§ã€‚å› æ­¤æé«˜æµ®ç‚¹è¡¨ç¤ºçš„ç²¾åº¦ï¼Œå°±å¯ä»¥å‡å°‘ä¸­é—´è®¡ç®—é€ æˆçš„ç´¯ç§¯èˆå…¥è¯¯å·®ã€‚</p>
<p>å½“éœ€è¦æ›´é«˜ç²¾åº¦æ—¶ï¼Œæµ®ç‚¹è¿ç®—å¯ä»¥ç”¨å¯å˜é•¿åº¦çš„æ¯”å¦‚æŒ‡æ•°æ¥å®ç°ï¼Œå¤§å°æ ¹æ®éœ€è¦æ¥ï¼Œè¿™å°±æ˜¯ä»»æ„ç²¾åº¦æµ®ç‚¹è¿ç®—ã€‚æ›´é«˜ç²¾åº¦å°±éœ€è¦æµ®ç‚¹ç¡¬ä»¶ï¼Œå«æµ®ç‚¹æ‰©å±•ï¼Œæ¯”å¦‚ double-double arithmetricï¼Œç”¨åœ¨ C çš„ long double ç±»å‹ã€‚å°±ç®—ç²¾åº¦å†é«˜å§ï¼Œæœ‰äº›æœ‰ç†æ•°æ¯”å¦‚1/3ï¼Œä¹Ÿæ²¡æ³•å…¨ç”¨äºŒè¿›åˆ¶æµ®ç‚¹æ•°è¡¨ç¤ºï¼Œå¦‚æœè¦ç²¾ç¡®è¡¨ç°è¿™äº›æœ‰ç†æ•°ï¼Œéœ€è¦æœ‰ç†ç®—æœ¯è½¯ä»¶åŒ…ï¼Œè½¯ä»¶åŒ…å¯¹æ¯ä¸ªæ•´æ•°ä½¿ç”¨ bignumber è¿ç®—ã€‚åœ¨è®¡ç®—æœºçš„ä»£æ•°ç³»ç»Ÿï¼ˆæ¯”å¦‚Mapleï¼‰é‡Œï¼Œå¯ä»¥è¯„ä¼°æ— ç†æ•°æ¯”å¦‚ Ï€ ç›´æ¥å¤„ç†åº•å±‚æ•°å­¦ï¼Œè€Œä¸éœ€è¦ç»™æ¯ä¸ªä¸­é—´è®¡ç®—ä½¿ç”¨è¿‘ä¼¼å€¼ã€‚</p>
<p>å†çœ‹çœ‹å¯¹åº”çš„æ ‡å‡†å’Œå„ç¼–ç¨‹è¯­è¨€çš„å®ç°æƒ…å†µã€‚</p>
<p>é‚£ä»€ä¹ˆæ˜¯IEEE 754-2008æ ‡å‡†ï¼Ÿä¸ºä»€ä¹ˆè¦æœ‰è¿™ä¸ªæ ‡å‡†ï¼Ÿ</p>
<p>ä»¥å‰å¾ˆæ—©çš„æ—¶å€™å¤§æ¦‚åœ¨ä¸ƒå…«åå¹´ä»£ï¼Œè®¡ç®—æœºåˆ¶é€ å•†çš„æµ®ç‚¹æ ‡å‡†æ¯”å¦‚å­—å¤§å°ã€è¡¨ç¤ºæ–¹æ³•è¿˜æœ‰å››èˆäº”å…¥ç­‰éƒ½ä¸ä¸€æ ·ï¼Œä¸åŒç³»ç»Ÿæµ®ç‚¹çš„å…¼å®¹å°±æ˜¯ä¸ªå¾ˆå¤§çš„é—®é¢˜ï¼Œå› æ­¤å½“æ—¶è‹±ç‰¹å°”å’Œæ‘©æ‰˜ç½—æ‹‰éƒ½æå‡ºäº†æµ®ç‚¹æ ‡å‡†çš„è¯‰æ±‚ã€‚</p>
<p>85å¹´IEEE 754-2008 decimal æµ®ç‚¹æ ‡å‡†å‡ºæ¥ï¼ŒIBMå¤§å‹æœºè¿›è¡Œäº†æ”¯æŒã€‚æ ‡å‡†åœ¨è®¡ç®—æœºç¡¬ä»¶å’Œç¼–ç¨‹è¯­è¨€ä¸­åº”ç”¨éå¸¸å¹¿ï¼Œå…¶åŸºæœ¬æ ¼å¼æœ‰å•ç²¾åº¦ï¼ŒåŒç²¾åº¦å’Œæ‰©å±•ç²¾åº¦ï¼Œå•ç²¾åº¦åœ¨ C é‡Œæ˜¯ float ç±»å‹ï¼Œ7ä½å°æ•°ã€‚åŒç²¾åº¦åœ¨ C é‡Œæ˜¯ double ç±»å‹ï¼Œå 8ä¸ªå­—èŠ‚ï¼Œ64ä½åŒç²¾åº¦çš„èŒƒå›´æ˜¯2 Ã— 10çš„è´Ÿ308æ¬¡æ–¹åˆ°2 Ã— 10çš„308æ¬¡æ–¹ã€‚æ‰©å±•ç²¾åº¦åœ¨ C99å’Œ C11 æ ‡å‡†çš„é™„ä»¶IEC 60559 æµ®ç‚¹è¿ç®—é‡Œå®šä¹‰äº† long double ç±»å‹ã€‚å››ç²¾åº¦ï¼Œ34ä½å°æ•°ã€‚decimal32ã€decimal64å’Œ decimal128éƒ½æ˜¯ç”¨äºæ‰§è¡Œåè¿›åˆ¶è¿›ä½ã€‚</p>
<p>IEEE 754-2008æ ‡å‡†è¿˜å®šä¹‰äº†32ä½ã€64ä½å’Œ128ä½ decimal æµ®ç‚¹è¡¨ç¤ºæ³•ã€‚è§„å®šäº†ä¸€äº›ç‰¹æ®Šå€¼çš„è¡¨ç¤ºæ–¹æ³•ï¼Œæ¯”å¦‚æ­£æ— ç©·å¤§ +âˆ ï¼Œè´Ÿæ— ç©·å¤§ -âˆï¼Œä¸æ˜¯ä¸€ä¸ªæ•°å­—è¡¨ç¤ºä¸º NaNs ç­‰ã€‚å®šä¹‰äº†æµ®ç‚¹å•å…ƒï¼ˆFPUï¼‰ï¼Œä¹Ÿå¯ä»¥å«æ•°å­¦åå¤„ç†å™¨ï¼Œä¸“é—¨ç”¨æ¥æ‰§è¡Œæµ®ç‚¹è¿ç®—ã€‚</p>
<p>IBMåœ¨1998å¹´åœ¨å¤§å‹æœºé‡Œå¼•å…¥äº† IEEE å…¼å®¹çš„äºŒè¿›åˆ¶æµ®ç‚¹è¿ç®—ï¼Œ05å¹´åŠ äº† IEEE å…¼å®¹çš„decimal æµ®ç‚¹ç±»å‹ã€‚</p>
<p>é™¤äº†IEEE 754-2008æ ‡å‡†å¤–ï¼Œè¿˜æœ‰å…¶ä»–æµ®ç‚¹æ ¼å¼æ ‡å‡†å—ï¼Ÿ</p>
<p>ç°åœ¨å¯¹æœºå™¨å­¦ä¹ æ¨¡å‹è®­ç»ƒè€Œè¨€ï¼ŒèŒƒå›´æ¯”ç²¾åº¦æ›´æœ‰ç”¨ï¼Œå› æ­¤æœ‰äº† Bfloat16æ ‡å‡†ï¼ŒBfloat16æ ‡å‡†å’Œ IEEE 754åŠç²¾åº¦æ ¼å¼çš„å†…å­˜é‡ä¸€æ ·ï¼Œè€ŒæŒ‡æ•°è¦æ›´å¤šï¼ŒIEEE 754æ˜¯5ä½ï¼ŒBfloat16æ˜¯8ä½ã€‚å¾ˆå¤šæœºå™¨å­¦ä¹ ç¡¬ä»¶åŠ é€Ÿå™¨éƒ½æä¾›äº†æ”¯æŒBfloat16æ”¯æŒï¼ŒNvidia ç”šè‡³è¿˜æ”¯æŒäº† TensorFloat-32 æ ¼å¼æ ‡å‡†ï¼ŒæŒ‡æ•°ä½æ•°æ›´å¤šï¼Œè¾¾åˆ°10ä½ã€‚</p>
<p>å¦‚ä»Š TC39æ­£åœ¨åŠªåŠ›å°† Decimal åŠ åˆ°æ ‡å‡†ä¸­ï¼Œ<a href="https://github.com/tc39/proposal-bigint">BigInt</a> ææ¡ˆå·²æ¥å—ã€‚TC39ææ¡ˆç”¨ BigDecimal/Decimal128 è¯­æ³•æ˜¯ç±»ä¼¼ 1.23m è¿™æ ·ã€‚Swift å·²ç»æœ‰äº†æ”¯æŒï¼Œå¯¹åº”çš„æ˜¯ <a href="https://developer.apple.com/documentation/foundation/decimal">Decimal</a>ã€‚pythonä¹Ÿæœ‰ï¼Œ<a href="https://docs.python.org/2/library/decimal.html">æ–‡æ¡£</a>ã€‚æ•°æ®åº“MongoDBçš„<a href="https://docs.mongodb.com/manual/core/shell-types/#shell-type-decimal">è¯´æ˜</a>ã€‚C å’Œ C++è¯­è¨€å¯¹äº32ã€64å’Œ128ä½ IEEE 754 decimal ç±»å‹è¿˜æ˜¯ä¸€ä¸ª<a href="http://www.open-std.org/JTC1/SC22/WG14/www/docs/n1312.pdf">ææ¡ˆ</a>ï¼Œåªæ˜¯GCCç¼–è¯‘å™¨å®ç°äº†<a href="https://github.com/gcc-mirror/gcc/blob/master/libstdc%2B%2B-v3/include/decimal/decimal.h">ä¸€ä¸ª</a>ï¼ŒClangä¸æ”¯æŒdecimal floating point typesï¼Œæ‰€ä»¥ QuickJS ä¸“é—¨å®ç°äº† BigInt å’Œ BigDecimal çš„å¤„ç†ã€‚BigInt å¯ä»¥ä½¿ JavaScript æœ‰ä»»æ„å¤§å°çš„æ•´æ•°ã€‚QuickJS BigInt æ€§èƒ½ä¸Šè¿™é‡Œæœ‰ä¸ª js ç¨‹åº <a href="https://bellard.org/quickjs/pi_bigint.js">pi_bigint.js</a> ç®—10ä¸‡ä½çš„ piï¼Œç›¸åŒæœºå™¨ä¸Š V8 æ˜¯2.3sï¼ŒQuickJS æ˜¯0.26sã€‚BigDecimal ç›¸å¯¹äº BigInt å¤šäº†å°æ•°ä½ï¼Œç”¨åšé«˜ç²¾åº¦å°æ•°è®¡ç®—ã€‚BigDecimal ä½¿ç”¨åè¿›åˆ¶è€Œä¸æ˜¯äºŒè¿›åˆ¶ BigInt è¡¨ç¤ºéå°æ•°éƒ¨åˆ†ï¼Œç„¶åç”¨ scale æ¥è¡¨ç¤ºå°æ•°ä½ç½®ã€‚è¿™æ ·çš„è¡¨ç¤ºå°±ä¸ä¼šæœ‰ç²¾åº¦é—®é¢˜ï¼Œä½¿ç”¨ BigDecimal è®¡ç®—æ˜¯åœ¨ BigInt ä¹‹é—´è¿›è¡Œè¿ç®—ï¼Œscaleè¿›è¡Œå°æ•°ç‚¹ä½ç½®æ›´æ–°ã€‚Fabrice Bellardç”¨BigDecimalå†™äº†è¿™æ®µä»£ç æ¥è®¡ç®—piçš„ä½æ•°ï¼Œä»£ç åœ¨<a href="https://bellard.org/quickjs/pi_bigdecimal.js">è¿™é‡Œ</a>ã€‚</p>
<h3 id="QuickJS"><a href="#QuickJS" class="headerlink" title="QuickJS"></a>QuickJS</h3><p>QuickJS åªæœ‰210KBï¼Œä½“ç§¯å°ï¼Œå¯åŠ¨å¿«ï¼Œè§£é‡Šæ‰§è¡Œé€Ÿåº¦å¿«ï¼Œæ”¯æŒæœ€æ–° ECMAScript æ ‡å‡†ï¼ˆECMA-262ï¼‰ã€‚</p>
<p>ECMAScript æ ‡å‡†æœ€å¤§çš„å˜åŒ–æ˜¯å‘ç”Ÿåœ¨ ES2015ã€‚ç±»ã€ç®­å¤´å‡½æ•°ã€é™æ€ç±»å‹æ•°ç»„ã€letå…³é”®å­—ã€mapsã€setsã€promiseç­‰ç‰¹æ€§éƒ½æ˜¯åœ¨ ES2015ï¼ˆES6ï¼‰å¢åŠ çš„ï¼ŒECMAScript 2016 ä¸»è¦å¢åŠ äº† await/async å…³é”®å­—ï¼ŒECMAScript 2017 ä¸»è¦å¢åŠ äº† rest/spread è¿ç®—ç¬¦ï¼ŒECMAScript 2020 ä¸»è¦å¢åŠ äº† BigIntã€‚CMAScript æ ‡å‡†é€šè¯»æ¯”è¾ƒæ¯ç‡¥ï¼Œæœ€å¥½åœ¨ç¢°åˆ°å‘æ—¶æŸ¥é˜…ã€‚æœ€æ–°çš„ ECMAScript æ ‡å‡†åœ¨è¿™é‡Œ <a href="https://tc39.es/ecma262/">ecma-262</a>ã€‚QuickJSåŒ…å«äº† ecma-262 æ ‡å‡†æµ‹è¯•å¥—ä»¶ Test262ï¼Œå°† <a href="https://github.com/tc39/test262">test262 æµ‹è¯•å¥—ä»¶</a>å®‰è£…åˆ° QuickJS test262 ç›®å½•ä¸‹ï¼ŒQuickJS è¿è¡Œæµ‹è¯•å¥—ä»¶çš„ç¨‹åºæºæ–‡ä»¶æ˜¯ run-test262.cï¼Œtest262.conf åŒ…å«å„ç§æµ‹è¯•çš„é€‰é¡¹ï¼Œtest262_error.txt æ˜¯è®°å½•å½“å‰æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯çš„åˆ—è¡¨ã€‚åˆ°ä»Šå¹´ Test262é‡Œé¢æœ‰å·²åŒ…å«äº†ä¸‰ä¸‡å¤šä¸ªå•ç‹¬æµ‹è¯• ECMAScript è§„èŒƒçš„æµ‹è¯•ï¼Œè€Œ QuickJS å‡ ä¹å…¨éƒ¨é€šè¿‡äº†æµ‹è¯•ï¼Œå’Œ V8å·®ä¸å¤šï¼Œæ¯” JavaScriptCore å¼ºã€‚Test262 æ˜¯ ECMAScript æµ‹è¯•å¥—ä»¶ï¼Œåœ¨ <a href="https://test262.report/">Test262 Report ç½‘ç«™</a>ä¸Šå¯ä»¥çœ‹åˆ°å„ä¸ª js å¼•æ“å¯¹ ECMAScript æ ‡å‡†æ”¯æŒæƒ…å†µï¼Œæœ€æ–°æƒ…å†µå¦‚ä¸‹ï¼š<br><img src="/uploads/deeply-analyse-quickjs/7.png" alt=""><br>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨è¯­æ³•ã€å†…ç½®å¯¹è±¡ä¸Š QuickJS å’Œ V8 éƒ½ä¸ç›¸ä¸Šä¸‹ï¼Œé™„åŠ ç‰¹æ€§ä¸Šåšçš„æœ€å¥½ã€‚</p>
<p>QuickJS å‘å¸ƒä»¥æ¥åŠŸèƒ½çš„æ›´æ–°éƒ½ä¼šå‘å¸ƒåœ¨ <a href="https://bellard.org/quickjs/Changelog">QuickJS çš„ changelog é‡Œ</a> ä¸Šï¼Œ20å¹´é‡è¦çš„æ›´æ–°å°±æ˜¯ <a href="https://github.com/tc39/proposal-decimal">TC39 BigDecimal ææ¡ˆ</a>çš„æ”¯æŒè¿˜æœ‰æ›´æ–°äº†ä¸‹ TC39çš„ <a href="https://github.com/tc39/proposal-operator-overloading">Operator overloading</a> ææ¡ˆï¼Œæ›´æ–°çš„commitåœ¨<a href="https://github.com/tc39/proposal-operator-overloading/commit/c26e0fdc44864051c1047d032ad72760d35200d7">è¿™é‡Œ</a>ï¼Œå¹¶ä¿®æ”¹äº†è¿ç®—ç¬¦é‡è½½è¯­ä¹‰ä½¿ä¹‹æ›´æ¥è¿‘äºTC39çš„ææ¡ˆã€‚oså’Œstdæ¨¡å—åšäº†æ›´æ–°å’Œæ–°å¢ï¼ŒåŒ…æ‹¬ os.realpathã€os.getcwdã€os.mkdirã€os.statã€os.lstatã€os.readlinkã€os.readdirã€os.utimesã€os.execã€os.chdirã€std.popenã€std.loadFileã€std.strerrorã€std.FILE.prototype.telloã€std.parseExtJSONã€std.setenvã€std.unsetenvã€std.getenvironã€‚åŠ äº†å®˜æ–¹ <a href="https://github.com/bellard/quickjs">Github é•œåƒ</a>ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡å®‰è£… QuickJS æ¥å°è¯•ä¸‹å§ã€‚</p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>QuickJS çš„ç¼–è¯‘å’Œå’±ä»¬é€šè¿‡ Xcode å·¥ç¨‹é…ç½®ç¼–è¯‘çš„æ–¹å¼ä¸åŒï¼Œä½¿ç”¨çš„æ˜¯ makefile æ¥é…ç½®ç¼–è¯‘å’Œå®‰è£…çš„ï¼Œå’Œä¸€äº›å¼€æº C/C++ å·¥ç¨‹ç¼–è¯‘ä½¿ç”¨ cmake æ–¹å¼ä¹Ÿæœ‰äº›ä¸åŒï¼Œä»¥å‰æˆ‘ä»¬å†™äº›ç®€å• c/c++ çš„ demo åï¼Œä¼šç®€å•çš„é€šè¿‡ clang å‘½ä»¤åŠ å‚æ•°è¿›è¡Œç¼–è¯‘å’Œé“¾æ¥ï¼Œä½†å¦‚æœéœ€è¦ç¼–è¯‘å’Œé“¾æ¥çš„æ–‡ä»¶å¤šäº†ï¼Œç¼–è¯‘é…ç½®å¤æ‚äº†ï¼Œæ¯æ¬¡æ‰‹å·¥ç¼–å†™å°±å¤ªè¿‡å¤æ‚ï¼Œå› æ­¤å°±ä¼šç”¨åˆ° makefile æˆ–è€… cmake æ¥å¸®åŠ©å‡å°‘å¤æ‚çš„æ“ä½œæé«˜æ•ˆç‡ã€‚é‚£ä»€ä¹ˆæ˜¯ makefileï¼Ÿ å’Œ cmake æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ</p>
<p>æˆ‘å…ˆä»‹ç»ä¸‹ä»€ä¹ˆæ˜¯ makefile å§ã€‚</p>
<h3 id="makefile"><a href="#makefile" class="headerlink" title="makefile"></a>makefile</h3><p>makefile æ˜¯åœ¨ç›®å½•ä¸‹å« Makefile æ–‡ä»¶ï¼Œç”± make è¿™ä¸ªå‘½ä»¤å·¥å…·è¿›è¡Œè§£é‡Šæ‰§è¡Œã€‚æŠŠæºä»£ç ç¼–è¯‘ç”Ÿæˆçš„ä¸­é—´ç›®æ ‡æ–‡ä»¶ .o æ–‡ä»¶ï¼Œè¿™ä¸ªé˜¶æ®µåªæ£€æµ‹è¯­æ³•ï¼Œå¦‚æœæºæ–‡ä»¶æ¯”è¾ƒå¤šï¼ŒObject File ä¹Ÿå°±ä¼šå¤šï¼Œå†æ˜ç¡®çš„æŠŠè¿™äº› Object File æŒ‡å‡ºæ¥ï¼Œé“¾æ¥åˆæˆä¸€ä¸ªæ‰§è¡Œæ–‡ä»¶å°±ä¼šæ¯”è¾ƒç¹çï¼ŒæœŸé—´è¿˜ä¼šæ£€æŸ¥å¯»æ‰¾å‡½æ•°æ˜¯å¦æœ‰å®ç°ã€‚ä¸ºäº†èƒ½å¤Ÿæé«˜ç¼–è¯‘é€Ÿåº¦ï¼Œéœ€è¦å¯¹æ²¡æœ‰ç¼–è¯‘è¿‡çš„æˆ–è€…æ›´æ–°äº†çš„æºæ–‡ä»¶è¿›è¡Œç¼–è¯‘ï¼Œå…¶ä»–çš„ç›´æ¥é“¾æ¥ä¸­é—´ç›®æ ‡æ–‡ä»¶ã€‚è€Œä¸”å½“å¤´æ–‡ä»¶æ›´æ”¹äº†ï¼Œéœ€è¦é‡æ–°ç¼–è¯‘å¼•ç”¨äº†æ›´æ”¹çš„å¤´æ–‡ä»¶çš„æ–‡ä»¶ã€‚ä¸Šé¢æ‰€è¯´çš„è¿‡ç¨‹åªéœ€è¦ make å‘½ä»¤å’Œç¼–å†™çš„ makefile å°±èƒ½å®Œæˆã€‚</p>
<p>ç®€å•è¯´ï¼Œmakefile å°±æ˜¯ä¸€ä¸ªçº¯æ‰‹åŠ¨çš„ IDEï¼Œé€šè¿‡æ‰‹åŠ¨ç¼–å†™ç¼–è¯‘è§„åˆ™å’Œä¾èµ–æ¥é…åˆ make å‘½ä»¤æ¥æé«˜ç¼–è¯‘å·¥ä½œæ•ˆç‡ã€‚make ä¼šå…ˆè¯»å…¥æ‰€æœ‰ include çš„ makefileï¼Œå°†å„æ–‡ä»¶ä¸­çš„å˜é‡åšåˆå§‹åŒ–ï¼Œåˆ†æè¯­æ³•è§„åˆ™ï¼Œåˆ›å»ºä¾èµ–å…³ç³»é“¾ï¼Œä¾æ®æ­¤å…³ç³»é“¾æ¥å®šæ‰€éœ€è¦ç”Ÿæˆçš„æ–‡ä»¶ã€‚</p>
<p>é‚£ä¹ˆ makefile çš„è¯­æ³•è§„åˆ™æ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</p>
<p>makefile çš„è¯­æ³•è§„åˆ™å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">target ... : prerequisites ...</span><br><span class="line">    command</span><br><span class="line">    ...</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­çš„ target å¯ä»¥æ˜¯ä¸€ä¸ªç›®æ ‡æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œçš„æ–‡ä»¶ï¼Œè¿˜å¯ä»¥æ˜¯ä¸€ä¸ªlabelã€‚prerequisites è¡¨ç¤ºæ˜¯ target æ‰€ä¾èµ–çš„æ–‡ä»¶æˆ–è€…æ˜¯ targetã€‚prerequisites çš„æ–‡ä»¶æˆ– target åªè¦æœ‰ä¸€ä¸ªæ›´æ–°äº†ï¼Œå¯¹åº”çš„åé¢çš„ command å°±ä¼šæ‰§è¡Œã€‚command å°±æ˜¯è¿™ä¸ª target è¦æ‰§è¡Œçš„ shell å‘½ä»¤ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å…ˆå†™ä¸ª main.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;foo.h&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hi! \n&quot;</span>);</span><br><span class="line">    sayHey();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å†å†™ä¸ª foo.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;foo.h&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sayHey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hey! \n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å†å†™ä¸ª makefile</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">hi: main.o foo.o</span></span><br><span class="line">    cc -o hi main.o foo.o</span><br><span class="line"></span><br><span class="line"><span class="section">main.o: main.c foo.h</span></span><br><span class="line">    cc -c main.c</span><br><span class="line"></span><br><span class="line"><span class="section">foo.o: foo.c foo.h</span></span><br><span class="line">    cc -c foo.c</span><br><span class="line"></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">    rm hi main.o foo.o</span><br></pre></td></tr></table></figure>
<p>åœ¨è¯¥ç›®å½•ä¸‹ç›´æ¥è¾“ make å°±èƒ½ç”Ÿæˆ hi å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¦‚æœæƒ³è¦æ¸…æ‰ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶å’Œä¸­é—´ç›®æ ‡æ–‡ä»¶ï¼Œåªè¦æ‰§è¡Œ make clean å°±å¯ä»¥äº†ã€‚</p>
<p>ä¸Šé¢ä»£ç ä¸­å†’å·åçš„ .c å’Œ .h æ–‡ä»¶å°±æ˜¯è¡¨ç¤ºä¾èµ–çš„ prerequisitesã€‚ä½ ä¼šå‘ç°.o æ–‡ä»¶çš„å­—ç¬¦ä¸²é‡å¤äº†ä¸¤æ¬¡ï¼Œå¦‚æœæ˜¯è¿™ç§é‡å¤å¤šæ¬¡çš„åº”è¯¥å¦‚ä½•ç®€åŒ–å‘¢ï¼Œç±»ä¼¼ C è¯­è¨€ä¸­çš„å˜é‡ï¼Œå®é™…ä¸Šåœ¨ makefile é‡Œæ˜¯å¯ä»¥æœ‰ç±»ä¼¼å˜é‡çš„è¯­æ³•ï¼Œåœ¨æ–‡ä»¶å¼€å§‹ä½¿ç”¨ = å·æ¥å®šä¹‰å°±è¡Œã€‚å†™æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objects = main.o foo.o</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨è¿™ä¸ªå˜é‡çš„è¯­æ³•æ˜¯ $(objects)ï¼Œä½¿ç”¨å˜é‡è¯­æ³•å makefile å°±å˜æˆä¸‹é¢çš„æ ·å­ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">objects = main.o foo.o</span><br><span class="line"></span><br><span class="line"><span class="section">hi: <span class="variable">$(objects)</span></span></span><br><span class="line">    cc -o hi <span class="variable">$(objects)</span></span><br><span class="line"></span><br><span class="line"><span class="section">main.o: main.c foo.h</span></span><br><span class="line">    cc -c main.c</span><br><span class="line"></span><br><span class="line"><span class="section">foo.o: foo.c foo.h</span></span><br><span class="line">    cc -c foo.c</span><br><span class="line"></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">    rm hi <span class="variable">$(objects)</span></span><br></pre></td></tr></table></figure>
<p>makefile å…·æœ‰è‡ªåŠ¨æ¨å¯¼çš„èƒ½åŠ›ï¼Œæ¯”å¦‚ target å¦‚æœæ˜¯ä¸€ä¸ª .o æ–‡ä»¶ï¼Œé‚£ä¹ˆ makefile å°±ä¼šè‡ªåŠ¨å°† .c åŠ å…¥ prerequisitesï¼Œè€Œä¸ç”¨æ‰‹åŠ¨å†™ï¼Œå¹¶ä¸” cc -c xxx.c ä¹Ÿä¼šè¢«æ¨å¯¼å‡ºï¼Œåˆ©ç”¨äº†è‡ªåŠ¨æ¨å¯¼çš„ makefile å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">objects = main.o foo.o</span><br><span class="line"></span><br><span class="line"><span class="section">hi: <span class="variable">$(objects)</span></span></span><br><span class="line">    cc -o hi <span class="variable">$(objects)</span></span><br><span class="line"></span><br><span class="line"><span class="section">main.o: foo.h</span></span><br><span class="line"><span class="section">foo.o:</span></span><br><span class="line"></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">    rm hi <span class="variable">$(objects)</span></span><br></pre></td></tr></table></figure>
<p>make ä¸­é€šé…ç¬¦å’Œ shell ä¸€æ ·ï¼Œ~/js è¡¨ç¤ºæ˜¯ $HOME ç›®å½•ä¸‹çš„ js ç›®å½•ï¼Œ*.c è¡¨ç¤ºæ‰€æœ‰åç¼€æ˜¯cçš„æ–‡ä»¶ï¼Œæ¯”å¦‚ QuickJS çš„ makefile é‡Œä¸ºäº†èƒ½å¤Ÿéšæ—¶ä¿æŒçº¯å‡€æºç ç¯å¢ƒä¼šä½¿ç”¨ make clean æ¸…ç†ä¸­é—´ç›®æ ‡æ–‡ä»¶å’Œç”Ÿæˆæ–‡ä»¶ï¼Œå…¶ä¸­ makefile çš„ clean éƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">clean:</span></span><br><span class="line">    rm -f repl.c qjscalc.c out.c</span><br><span class="line">    rm -f *.a *.o *.d *~ unicode_gen regexp_test <span class="variable">$(PROGS)</span></span><br><span class="line">    rm -f hello.c test_fib.c</span><br><span class="line">    rm -f examples/*.so tests/*.so</span><br><span class="line">    rm -rf <span class="variable">$(OBJDIR)</span>/ *.dSYM/ qjs-debug</span><br><span class="line">    rm -rf run-test262-debug run-test262-32</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ repl.cã€qjscalc.c å’Œ out.c æ˜¯ç”Ÿæˆçš„ QuickJS å­—èŠ‚ç æ–‡ä»¶ï¼Œ<em>.aã€</em>.oã€*.d è¡¨ç¤ºæ‰€æœ‰åç¼€æ˜¯aã€oã€dçš„æ–‡ä»¶ã€‚</p>
<p>å¦‚æœè¦ç®€åŒ–åˆ°ç¼–è¯‘å¹¶é“¾æ¥æ‰€æœ‰çš„ .c å’Œ .o æ–‡ä»¶ï¼Œå¯ä»¥æŒ‰ç…§ä¸‹é¢çš„å†™æ³•æ¥å†™ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">objects := <span class="variable">$(<span class="built_in">patsubst</span> %.c,%.o,$(<span class="built_in">wildcard</span> *.c)</span>)</span><br><span class="line">foo : <span class="variable">$(objects)</span></span><br><span class="line">    cc -o foo <span class="variable">$(objects)</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç ä¸­çš„ patsubst æ˜¯æ¨¡å¼å­—ç¬¦ä¸²æ›¿æ¢å‡½æ•°ï¼Œ%è¡¨ç¤ºä»»æ„é•¿åº¦å­—ç¬¦ä¸²ï¼Œ$åŠ æ‹¬å·è¡¨ç¤ºè¦æ‰§è¡Œ makefile çš„å‡½æ•°ï¼Œwildcard çš„ä½œç”¨æ˜¯æ‰©å±•é€šé…ç¬¦ï¼Œå› ä¸ºåœ¨å˜é‡å®šä¹‰å’Œå‡½æ•°å¼•ç”¨æ—¶ï¼Œé€šé…ç¬¦ä¼šå¤±æ•ˆï¼Œå› æ­¤è¿™é‡Œ wildcard çš„ä½œç”¨æ˜¯è·å–ç›®å½•ä¸‹æ‰€æœ‰åç¼€æ˜¯ .c çš„æ–‡ä»¶ã€‚patsubstçš„è¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">patsubst</span> &lt;pattern&gt;,&lt;replacement&gt;,&lt;text&gt;)</span></span><br></pre></td></tr></table></figure>
<p>æ ¹æ®æ­¤è¯­æ³•ï¼Œä¸Šä¾‹é‡Œï¼Œå°±æ˜¯å°†ç›®å½•ä¸‹æ‰€æœ‰ .c åç¼€æ–‡ä»¶è¿”å›æˆåŒå .o çš„æ–‡ä»¶ã€‚åœ¨ patsubst å’Œ wildcard åœ¨ QuickJS çš„ makefile é‡Œå¹¿æ³›ä½¿ç”¨ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ®µï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ifdef</span> CONFIG_LTO</span><br><span class="line"><span class="section">libquickjs.a: $(patsubst %.o, %.nolto.o, <span class="variable">$(QJS_LIB_OBJS)</span>)</span></span><br><span class="line">    <span class="variable">$(AR)</span> rcs <span class="variable">$@</span> <span class="variable">$^</span></span><br><span class="line"><span class="keyword">endif</span> <span class="comment"># CONFIG_LTO</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢è¿™æ®µè¡¨ç¤ºåœ¨é…ç½®æ‰“å¼€ lto åï¼Œä¼šæŠŠ QJS_LIB_OBJS è¿™ä¸ªå˜é‡å®šä¹‰çš„é‚£äº›ä¸­é—´ç›®æ ‡ .o æ–‡ä»¶åç¼€ç¼“å­˜ .nolto.o åç¼€ã€‚</p>
<p>QuickJS çš„ makefile ä¸­ä½¿ç”¨çš„å‡½æ•°é™¤äº†patsubst å’Œ wildcard è¿˜æœ‰ shellã€‚shell çš„ä½œç”¨å°±æ˜¯å¯ä»¥ç›´æ¥è°ƒç”¨ç³»ç»Ÿçš„ shell å‡½æ•°ï¼Œæ¯”å¦‚ QuickJS é‡Œçš„ $(shell uname -s)ï¼Œå¦‚æœåœ¨ macOS ä¸Šè¿è¡Œä¼šè¿”å› Darwinï¼Œä½¿ç”¨æ­¤æ–¹æ³•å¯ä»¥åˆ¤æ–­å½“å‰ç”¨æˆ·ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿï¼Œä»è€Œè¿›è¡Œä¸åŒçš„åç»­æ“ä½œã€‚æ¯”å¦‚ QuickJS çš„ makefile æ˜¯è¿™ä¹ˆåšçš„ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(<span class="built_in">shell</span> uname -s)</span>,Darwin)</span><br><span class="line">CONFIG_DARWIN=y</span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç å¯ä»¥çœ‹å‡ºï¼Œé€šè¿‡åˆ¤æ–­ shell å‡½æ•°è¿”å›å€¼æ¥ç¡®å®šæ˜¯å¦æ˜¯ Darwinå†…æ ¸ï¼Œå°†ç»“æœè®°å½•åœ¨å˜é‡ CONFIG_DARWIN å˜é‡ä¸­ã€‚é€šè¿‡è¿™ä¸ªç»“æœåç»­é…ç½®ç¼–è¯‘å™¨ä¸º clangã€‚</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ifdef</span> CONFIG_DARWIN</span><br><span class="line"><span class="comment"># use clang instead of gcc</span></span><br><span class="line">CONFIG_CLANG=y</span><br><span class="line">CONFIG_DEFAULT_AR=y</span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>
<p>åœ¨ç¼–å†™ makefile æ—¶æœ‰äº› prerequisites å’Œ target ä¼šå˜ï¼Œè¿™æ ·åœ¨å‘½ä»¤ä¸­å°±ä¸èƒ½å†™å…·ä½“çš„æ–‡ä»¶åï¼Œåœ¨ makefile é‡Œæœ‰ç§è‡ªåŠ¨äº§ç”Ÿå˜é‡çš„è§„åˆ™ï¼Œå«åšè‡ªåŠ¨åŒ–å˜é‡å¯ä»¥è§£å†³è¿™æ ·çš„é—®é¢˜ï¼Œè‡ªåŠ¨åŒ–å˜é‡è¿˜èƒ½è§£å†³ makefile å†—ä½™é—®é¢˜ï¼Œå› ä¸ºè‡ªåŠ¨åŒ–å˜é‡ç”¨ç®€çŸ­çš„è¯­æ³•æ›¿ä»£é‡å¤ç¼–å†™ target å’Œ prerequisitesï¼Œè‡ªåŠ¨åŒ–å˜é‡æœ‰$@ã€$%ã€$&lt;ã€$?ã€$+ç­‰ï¼Œæ¯”å¦‚$@è¡¨ç¤ºçš„æ˜¯targetï¼Œ$^è¡¨ç¤º prerequisitesï¼ŒGNU make é‡Œåœ¨è‡ªåŠ¨åŒ–å˜é‡é‡ŒåŠ å…¥ D æˆ–è€… F ä¼šå˜æˆå˜ç§è‡ªåŠ¨åŒ–å˜é‡ï¼Œèƒ½å¤Ÿä»£è¡¨æ›´å¤šæ„æ€ï¼Œæ¯”å¦‚$(@F)è¡¨ç¤ºåœ¨è·¯å¾„ä¸­å–å‡ºæ–‡ä»¶åéƒ¨åˆ†ã€‚è‡ªåŠ¨åŒ–å˜é‡åœ¨ QuickJS çš„ makefile é‡Œä½¿ç”¨å¾ˆå¤šã€‚æ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(OBJDIR)</span>/%.o: %.c | <span class="variable">$(OBJDIR)</span></span><br><span class="line">    <span class="variable">$(CC)</span> <span class="variable">$(CFLAGS_OPT)</span> -c -o <span class="variable">$@</span> <span class="variable">$&lt;</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢è¿™æ®µä»£ç çš„ä½œç”¨æ˜¯å½“.oæ–‡ä»¶ä¾èµ–çš„ç¼–è¯‘ä¸­é—´äº§ç‰©æˆ– c æºæ–‡ä»¶æœ‰æ›´æ–°æ—¶ï¼Œä¼šé‡æ–°ç¼–è¯‘ç”Ÿæˆ.oæ–‡ä»¶ $@ è¡¨ç¤ºçš„æ˜¯ $(OBJDIR)/%.oï¼Œ$&lt; è¡¨ç¤ºçš„æ˜¯ %.c | $(OBJDIR)ï¼Œç®€åŒ–äº†ä»£ç ï¼Œ$@ å°±åƒæ•°ç»„é‚£æ ·ä¼šä¾æ¬¡å–å‡º targetï¼Œç„¶åæ‰§è¡Œã€‚</p>
<p>ä¾èµ–å…³ç³»é‡Œä¼šæœ‰.h å¤´æ–‡ä»¶ï¼Œä½ ä¸€å®šå¥‡æ€ªåœ¨ QuickJS çš„ makefile é‡Œé‚£äº›å¤´æ–‡ä»¶ä¸ºä»€ä¹ˆå°±æ²¡æœ‰å‡ºç°åœ¨ prerequisites ä¸­äº†ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>è¿™æ˜¯å› ä¸ºæœ‰åŠæ³•è®© makefile è‡ªåŠ¨ç”Ÿæˆä¾èµ–å…³ç³»ã€‚å¦‚æœæ²¡æœ‰è¿™åŠæ³•è‡ªåŠ¨ç”Ÿæˆä¾èµ–å…³ç³»çš„è¯ï¼Œåœ¨å¤§å‹å·¥ç¨‹ä¸­ï¼Œä½ å°±éœ€è¦å¯¹æ¯ä¸ª c æ–‡ä»¶åŒ…å«äº†é‚£äº›å¤´æ–‡ä»¶äº†è§£æ¸…æ¥šï¼Œå¹¶åœ¨ makefile é‡Œå†™å¥½ï¼Œå½“ä¿®æ”¹ c æ–‡ä»¶æ—¶è¿˜éœ€è¦æ‰‹åŠ¨çš„ç»´æŠ¤ makefileï¼Œå› æ­¤è¿™ç§å·¥ä½œä¸å…‰é‡å¤è€Œä¸”ä¸€ä¸å°å¿ƒè¿˜ä¼šé”™ã€‚</p>
<p>é‚£æœ‰åŠæ³•èƒ½è§£å†³é‡å¤æ˜“é”™çš„é—®é¢˜ä¹ˆï¼Ÿ</p>
<p>ç¼–è¯‘å™¨ï¼Œæ¯”å¦‚ clang æœ‰ä¸ªé€‰é¡¹ -MMD -MF å¯ä»¥ç”Ÿæˆä¾èµ–å…³ç³»ï¼Œç”Ÿæˆä¸ºåŒåçš„ .d æ–‡ä»¶ï¼Œ.d æ–‡ä»¶é‡Œæœ‰ç›¸åº” .c çš„æ‰€ä¾èµ–çš„æ–‡ä»¶ã€‚å› æ­¤å¯ä»¥åœ¨ makefile é‡Œåˆ©ç”¨ç¼–è¯‘å™¨è¿™ä¸ªç‰¹æ€§ï¼Œä½¿ç”¨å˜ç§è‡ªåŠ¨åŒ–å˜é‡$(@F)æ¥è®¾ç½®ç¼–è¯‘é…ç½®ï¼Œè‡ªåŠ¨è®¾ç½®åŒåæ–‡ä»¶åçš„.dæ–‡ä»¶ã€‚åœ¨ QuickJS ä¸­æ˜¯è¿™ä¹ˆé…ç½®ç¼–è¯‘æ ‡è¯†çš„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ifdef CONFIG_CLANG</span><br><span class="line">  HOST_CC=clang</span><br><span class="line">  CC=$(CROSS_PREFIX)clang</span><br><span class="line">  CFLAGS=-g -Wall -MMD -MF $(OBJDIR)/$(@F).d</span><br><span class="line">  CFLAGS += -Wextra</span><br><span class="line">  CFLAGS += -Wno-sign-compare</span><br><span class="line">  CFLAGS += -Wno-missing-field-initializers</span><br><span class="line">  CFLAGS += -Wundef -Wuninitialized</span><br><span class="line">  CFLAGS += -Wunused -Wno-unused-parameter</span><br><span class="line">  CFLAGS += -Wwrite-strings</span><br><span class="line">  CFLAGS += -Wchar-subscripts -funsigned-char</span><br><span class="line">  CFLAGS += -MMD -MF $(OBJDIR)/$(@F).d</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç ä¸­çš„$(@F).d è¡¨ç¤ºä¼šæ ¹æ® target çš„æ–‡ä»¶åç”Ÿæˆå¯¹åº”çš„åŒ…å«ä¾èµ–å…³ç³»çš„ .d æ–‡ä»¶ã€‚</p>
<p>ç”Ÿæˆå®Œ .d æ–‡ä»¶åï¼Œéœ€è¦ç”¨ include å‘½ä»¤æŠŠè¿™äº›è§„åˆ™åŠ åˆ° makefile é‡Œï¼Œçœ‹ä¸‹ QuickJS çš„åšæ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-include $(wildcard $(OBJDIR)/*.d)</span><br></pre></td></tr></table></figure>
<p>makefile è¿˜æœ‰äº›éšå«çš„è§„åˆ™ï¼Œæ¯”å¦‚æŠŠæºæ–‡ä»¶ç¼–è¯‘æˆä¸­é—´ç›®æ ‡æ–‡ä»¶è¿™ä¸€æ­¥å¯ä»¥çœç•¥ä¸å†™ï¼Œmake ä¼šè‡ªåŠ¨çš„æ¨å¯¼ç”Ÿæˆä¸­é—´ç›®æ ‡æ–‡ä»¶ï¼Œå¯¹åº”å‘½ä»¤æ˜¯ $(CC) â€“c $(CPPFLAGS) $(CFLAGS)ï¼Œé“¾æ¥ç›®æ ‡æ–‡ä»¶æ˜¯é€šè¿‡è¿è¡Œç¼–è¯‘å™¨çš„ldæ¥ç”Ÿæˆï¼Œä¹Ÿå¯ä»¥çœç•¥ï¼Œå¯¹åº”çš„å‘½ä»¤æ˜¯$(CC) $(LDFLAGS) <n>.o $(LOADLIBES) $(LDLIBS)ã€‚éšå«è§„åˆ™ä½¿ç”¨çš„å˜é‡åŒ…æ‹¬å‘½ä»¤å˜é‡å’Œå‘½ä»¤å‚æ•°å˜é‡ï¼Œéšå«è§„åˆ™å‘½ä»¤å˜é‡æœ‰ ARï¼Œé»˜è®¤å‘½ä»¤æ˜¯ ar ç”¨æ¥å¯¹å‡½æ•°åº“æ‰“åŒ…ï¼ŒAS é»˜è®¤æ˜¯ asï¼ŒCXX é»˜è®¤æ˜¯ g++ï¼ŒCC é»˜è®¤å‘½ä»¤æ˜¯ ccï¼Œæ˜¯ C è¯­è¨€çš„ç¼–è¯‘ç¨‹åºï¼ŒQuickJS çš„ CC ä¼šæ ¹æ®ç³»ç»Ÿè¿›è¡ŒåŒºåˆ†è®¾ç½®ï¼Œå¦‚æœæ˜¯ macOS è¿™ç§ Darwin ç³»ç»Ÿï¼Œä¼šä½¿ç”¨clangï¼Œå…¶ä»–çš„ç”¨ gccã€‚å¦‚æœä¸æ˜¯ Darwin ç³»ç»ŸåŒæ—¶å¼€å¯ ltoï¼Œé‚£ä¹ˆ AS ä¼šè®¾ç½®ä¸º llvm-ar å‘½ä»¤ï¼Œå¯¹åº” QuickJS çš„ makefile ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ifdef</span> CONFIG_DEFAULT_AR</span><br><span class="line">  AR=<span class="variable">$(CROSS_PREFIX)</span>ar</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="keyword">ifdef</span> CONFIG_LTO</span><br><span class="line">    AR=<span class="variable">$(CROSS_PREFIX)</span>llvm-ar</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    AR=<span class="variable">$(CROSS_PREFIX)</span>ar</span><br><span class="line">  <span class="keyword">endif</span></span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure><br>ä¸Šé¢ CROSS_PREFIX å˜é‡å®é™…ä¸Šå·²ç»æ²¡ç”¨äº†ï¼Œä»¥å‰æ˜¯å› ä¸ºè¦å…¼å®¹åœ¨ Linux ä¸‹è¿è¡Œ Windows æ‰€éœ€è¦æ·»åŠ  mingw32 çš„å‰ç¼€ï¼Œç›®å‰è¿™æ®µå˜é‡å®šä¹‰å·²ç»è¢«æ³¨é‡Šæ‰äº†ã€‚ éšå«è§„åˆ™å‘½ä»¤å‚æ•°æœ‰ç¼–è¯‘å™¨å‚æ•° CFLAGS å’Œé“¾æ¥å™¨å‚æ•° LDFLAGS ç­‰ï¼Œè¿™äº›å˜é‡å¯ä»¥æ ¹æ®æ¡ä»¶åˆ¤æ–­æˆ–è€…å¹³å°åŒºåˆ†ï¼Œé…ç½®ä¸åŒå‚æ•°ã€‚</p>
<h3 id="cmake"><a href="#cmake" class="headerlink" title="cmake"></a>cmake</h3><p>ç”±äº GNU çš„ make å’Œå…¶ä»–å·¥å…·ï¼Œæ¯”å¦‚å¾®è½¯çš„ nmake è¿˜æœ‰ BSD çš„ pmake çš„ makefile è¯­æ³•è§„åˆ™æ ‡å‡†æœ‰ä¸åŒï¼Œå› æ­¤å¦‚æœæƒ³ä¸ºå¤šä¸ªå¹³å°å’Œå·¥å…·ç¼–å†™å¯ç¼–è¯‘çš„ makefile éœ€è¦å†™å¤šä»½ makefile æ–‡ä»¶ã€‚</p>
<p>ä¸ºäº†åº”å¯¹è¿™æ ·é‡å¤ç¹ççš„å·¥ä½œï¼Œcmake å‡ºç°äº†ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç¼–å†™ CMakeList.txt è¿™æ ·çš„æ–‡ä»¶æ¥å®šåˆ¶ç¼–è¯‘æµç¨‹ï¼Œcmake ä¼šå°†å…¶è½¬æ¢æˆå¹³å°å’Œå·¥å…·ç›¸åº”çš„ makefile æ–‡ä»¶å’Œå¯¹åº”çš„å·¥ç¨‹æ–‡ä»¶ï¼ˆæ¯”å¦‚ Xcode å·¥ç¨‹æˆ–Visual Studioå·¥ç¨‹ï¼‰ã€‚æ¯”å¦‚ä½ æ‰€ç†Ÿæ‚‰çš„ LLVM å°±æ˜¯ç”¨çš„ cmakeï¼Œæºç å„ä¸ªç›®å½•ä¸‹éƒ½æœ‰å¯¹åº”çš„ CMakeList.txt æ–‡ä»¶ã€‚å…·ä½“å¯ä»¥å‚çœ‹<a href="https://cmake.org/cmake/help/latest/guide/tutorial/index.html">å®˜æ–¹æ•™ç¨‹</a>ã€‚</p>
<p>ä½¿ç”¨ qjsc -e ç”Ÿæˆçš„ C ä»£ç ï¼Œé€šè¿‡ç¼–å†™å¦‚ä¸‹çš„ CMakeLists.txt é…ç½®ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required(VERSION <span class="number">3.10</span>)</span><br><span class="line">project(runtime)</span><br><span class="line">add_executable(runtime</span><br><span class="line">        # å¦‚æœæœ‰å¤šä¸ª C æ–‡ä»¶ï¼Œåœ¨è¿™é‡ŒåŠ </span><br><span class="line">        src/main.c)</span><br><span class="line"></span><br><span class="line"># å¤´æ–‡ä»¶å’Œåº“æ–‡ä»¶</span><br><span class="line">include_directories(/usr/local/include)</span><br><span class="line">add_library(quickjs STATIC IMPORTED)</span><br><span class="line">set_target_properties(quickjs</span><br><span class="line">        PROPERTIES IMPORTED_LOCATION</span><br><span class="line">        <span class="string">&quot;/usr/local/lib/quickjs/libquickjs.a&quot;</span>)</span><br><span class="line"></span><br><span class="line"># é“¾æ¥åˆ° <span class="function">runtime</span></span><br><span class="line"><span class="function"><span class="title">target_link_libraries</span><span class="params">(runtime</span></span></span><br><span class="line"><span class="params"><span class="function">        quickjs)</span></span></span><br></pre></td></tr></table></figure><br>æŒ‰ç…§ä¸Šé¢ä»£ç ç¼–å†™ï¼Œå¯ä»¥ç¼–è¯‘å‡ºå¯æ‰§è¡Œçš„æ–‡ä»¶äº†ã€‚</p>
<p>github ä¸Šæœ‰ä¸ª <a href="https://github.com/mezum/quickjs-cmake">QuickJS å·¥ç¨‹çš„ cmake è„šæœ¬</a>ï¼Œå¯ä»¥ç”¨æ¥ä¸‹è½½ç¼–è¯‘ QuickJS åº“ã€‚</p>
<h3 id="Xcode-æ¥ç¼–è¯‘å®‰è£…å’Œè°ƒè¯•-QuickJS-æºç "><a href="#Xcode-æ¥ç¼–è¯‘å®‰è£…å’Œè°ƒè¯•-QuickJS-æºç " class="headerlink" title="Xcode æ¥ç¼–è¯‘å®‰è£…å’Œè°ƒè¯• QuickJS æºç "></a>Xcode æ¥ç¼–è¯‘å®‰è£…å’Œè°ƒè¯• QuickJS æºç </h3><p>ç”±äº QuickJS ä½¿ç”¨çš„æ˜¯ makefile ç®¡ç†ï¼Œè€Œ makefile ä¸èƒ½ç›´æ¥è½¬æˆ Xcode çš„å·¥ç¨‹æ–‡ä»¶ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ Xcode çš„ External Build Systemï¼Œåˆ›å»ºå·¥ç¨‹ QuickJSXcode åï¼Œç»™å·¥ç¨‹æ·»åŠ  QuickJS æºç æ–‡ä»¶ï¼Œç›´æ¥å¯¼å…¥åˆ°å·¥ç¨‹å³å¯ï¼Œä½¿ç”¨ âŒ˜ + B æ„å»ºå·¥ç¨‹ï¼Œåœ¨ Product/Scheme/Edit Scheme é‡Œé€‰æ‹© Run/Infoï¼Œåœ¨ Executable é‡Œé€‰æ‹©åˆšæ‰æ„å»ºç”Ÿæˆçš„ qjs å¯æ‰§è¡Œæ–‡ä»¶ã€‚å¦‚ä¸‹å›¾ï¼š<br><img src="/uploads/deeply-analyse-quickjs/8.png" alt=""><br>ç„¶åæ·»åŠ å‘½ä»¤è¡Œå·¥å…· Target è¾…åŠ©ï¼Œåœ¨ Target çš„ Dependencies é‡Œæ·»åŠ  QuickJSXcodeï¼Œåœ¨ Link Binary With Libraries é‡Œæ·»åŠ ç¼–è¯‘å‡ºæ¥çš„ libquickjs.aã€‚æœ€ååœ¨ Build Settings çš„ Search Paths é‡Œï¼Œå°† QuickJS ä»£ç è·¯å¾„æ·»åŠ åˆ° Header Search Paths å’Œ Library Search Paths é‡Œã€‚å®Œæˆåç°åœ¨å°±å¯ä»¥ä½¿ç”¨ Xcode è¿›è¡Œ QuickJS æºç æ–­ç‚¹è°ƒè¯•ã€è‡ªåŠ¨è¡¥å…¨å’Œè·³è½¬äº†ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="/uploads/deeply-analyse-quickjs/6.png" alt=""><br>é€šè¿‡æ–­ç‚¹è°ƒè¯•ï¼Œæ›´åŠ æ–¹ä¾¿é˜…è¯»ç†è§£æºç ã€‚å¯è°ƒè¯•å·¥ç¨‹æˆ‘æ”¾åˆ°äº†Githubä¸Šï¼Œåœ¨<a href="https://github.com/ming1016/study/tree/master/QuickJS">è¿™é‡Œ</a>ã€‚</p>
<p>QuickJS åœ¨ VSCode çš„è°ƒè¯•çš„è¯ï¼Œå…ˆ fork ä¸€ä»½ Koushik Dutta çš„ QuickJS ä¿®æ”¹ç‰ˆæœ¬ï¼Œä»£ç åœ¨<a href="https://github.com/koush/quickjs">è¿™</a>ï¼ŒVSCode æ‰©å±•çš„ <a href="https://github.com/koush/vscode-quickjs-debug">github åœ°å€</a>ï¼Œ<a href="https://marketplace.visualstudio.com/items?itemName=koush.quickjs-debug">VSCode æ‰©å±•å¸‚åœºé“¾æ¥</a>ï¼Œå¯¹ QuickJS ä¿®æ”¹çš„è¯¦ç»† Koushik Dutta åœ¨é‚®ä»¶é‡Œæœ‰è¯´æ˜ï¼Œé‚®ä»¶åœ°å€<a href="https://www.freelists.org/post/quickjs-devel/QuickJS-Debugger-implementation-for-VSCode">åœ¨è¿™</a>ï¼ŒFabrice Bellard çœ‹äº†ä¹Ÿ<a href="https://www.freelists.org/post/quickjs-devel/QuickJS-Debugger-implementation-for-VSCode,4">å›é‚®ä»¶</a>è¡¨ç¤ºä»¥åä¼šå¢åŠ è°ƒè¯•æ¥å£ã€‚</p>
<h2 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h2><p>æŒ‰ç…§<a href="https://bellard.org/quickjs/quickjs.html#Installation">å®˜æ–¹æ‰‹å†Œå†™çš„æ–¹å¼</a>ä½¿ç”¨ makefile å®‰è£…åï¼Œå‘½ä»¤è¡Œå·¥å…·ä¼šè¢«å®‰è£…åˆ° /usr/local/bin ç›®å½•ä¸‹ï¼Œæ­¤ç›®å½•ä¸‹ä¼šæœ‰ JS è§£é‡Šå™¨ qjsï¼Œæœ‰ç¼–è¯‘å™¨ qjscï¼ˆQuickJS compilerï¼‰ ç¼–è¯‘ js æ–‡ä»¶ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆQuickJSå¼•æ“ + js æ–‡ä»¶æ‰“åŒ…ï¼Œqjs è§£é‡Šæ‰§è¡Œç›®æ ‡ js æ–‡ä»¶ï¼‰ï¼Œè¿˜æœ‰ä¸€ä¸ªå¯ä»¥å¯¹ä»»æ„é•¿åº¦æ•°å­—è®¡ç®—çš„ qjscalcã€‚ç¼–è¯‘çš„åº“ä¼šæ”¾åˆ° /usr/local/lib/quickjs/ ç›®å½•ä¸‹ï¼Œæœ‰é™æ€åº“ libquickjs.aï¼Œå¯ä»¥ç”Ÿæˆæ›´å°å’Œé€Ÿåº¦æ›´å¿«çš„åº“ libquickjs.lto.aï¼Œltoï¼ˆLink-Time-Optimizationï¼‰éœ€è¦åœ¨ç¼–è¯‘æ—¶åŠ ä¸Š -flto æ ‡è¯†ã€‚</p>
<p>qjsc è¿˜å¯ä»¥æŠŠ js æ–‡ä»¶ç¼–è¯‘æˆ QuickJS è™šæ‹Ÿæœºçš„å­—èŠ‚ç ï¼Œæ¯”å¦‚ç¼–å†™ä¸‹é¢çš„ä¸€æ®µ javascript ä»£ç ï¼Œä¿å­˜ä¸º helloworld.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> myString1 = <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> myString2 = <span class="string">&quot;World&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(myString1 + <span class="string">&quot; &quot;</span> + myString2 + <span class="string">&quot;!&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qjsc -o hello helloworld.js</span><br></pre></td></tr></table></figure>
<p>å°±èƒ½å¤Ÿè¾“å‡ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ hello å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿è¡Œåè¾“å‡º hello world !ã€‚æŠŠå‚æ•°æ”¹æˆ-e å¯ä»¥è¾“å‡º.cæ–‡ä»¶ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qjsc -e -o helloworld.c helloworld.js</span><br></pre></td></tr></table></figure>
<p>æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* File generated automatically by the QuickJS compiler. */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;quickjs-libc.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">uint32_t</span> qjsc_helloworld_size = <span class="number">173</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">uint8_t</span> qjsc_helloworld[<span class="number">173</span>] = &#123;</span><br><span class="line"> <span class="number">0x02</span>, <span class="number">0x09</span>, <span class="number">0x12</span>, <span class="number">0x6d</span>, <span class="number">0x79</span>, <span class="number">0x53</span>, <span class="number">0x74</span>, <span class="number">0x72</span>,</span><br><span class="line"> <span class="number">0x69</span>, <span class="number">0x6e</span>, <span class="number">0x67</span>, <span class="number">0x31</span>, <span class="number">0x12</span>, <span class="number">0x6d</span>, <span class="number">0x79</span>, <span class="number">0x53</span>,</span><br><span class="line"> <span class="number">0x74</span>, <span class="number">0x72</span>, <span class="number">0x69</span>, <span class="number">0x6e</span>, <span class="number">0x67</span>, <span class="number">0x32</span>, <span class="number">0x0a</span>, <span class="number">0x48</span>,</span><br><span class="line"> <span class="number">0x65</span>, <span class="number">0x6c</span>, <span class="number">0x6c</span>, <span class="number">0x6f</span>, <span class="number">0x0a</span>, <span class="number">0x57</span>, <span class="number">0x6f</span>, <span class="number">0x72</span>,</span><br><span class="line"> <span class="number">0x6c</span>, <span class="number">0x64</span>, <span class="number">0x0e</span>, <span class="number">0x63</span>, <span class="number">0x6f</span>, <span class="number">0x6e</span>, <span class="number">0x73</span>, <span class="number">0x6f</span>,</span><br><span class="line"> <span class="number">0x6c</span>, <span class="number">0x65</span>, <span class="number">0x06</span>, <span class="number">0x6c</span>, <span class="number">0x6f</span>, <span class="number">0x67</span>, <span class="number">0x02</span>, <span class="number">0x20</span>,</span><br><span class="line"> <span class="number">0x02</span>, <span class="number">0x21</span>, <span class="number">0x1a</span>, <span class="number">0x68</span>, <span class="number">0x65</span>, <span class="number">0x6c</span>, <span class="number">0x6c</span>, <span class="number">0x6f</span>,</span><br><span class="line"> <span class="number">0x77</span>, <span class="number">0x6f</span>, <span class="number">0x72</span>, <span class="number">0x6c</span>, <span class="number">0x64</span>, <span class="number">0x2e</span>, <span class="number">0x6a</span>, <span class="number">0x73</span>,</span><br><span class="line"> <span class="number">0x0e</span>, <span class="number">0x00</span>, <span class="number">0x06</span>, <span class="number">0x00</span>, <span class="number">0xa0</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x01</span>,</span><br><span class="line"> <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x52</span>, <span class="number">0x01</span>, <span class="number">0xa2</span>, <span class="number">0x01</span>,</span><br><span class="line"> <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x3f</span>, <span class="number">0xe1</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line"> <span class="number">0x80</span>, <span class="number">0x3f</span>, <span class="number">0xe2</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x80</span>, <span class="number">0x3e</span>,</span><br><span class="line"> <span class="number">0xe1</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x82</span>, <span class="number">0x3e</span>, <span class="number">0xe2</span>, <span class="number">0x00</span>,</span><br><span class="line"> <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x82</span>, <span class="number">0x04</span>, <span class="number">0xe3</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line"> <span class="number">0x3a</span>, <span class="number">0xe1</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0xe4</span>, <span class="number">0x00</span>,</span><br><span class="line"> <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x3a</span>, <span class="number">0xe2</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x38</span>,</span><br><span class="line"> <span class="number">0xe5</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x42</span>, <span class="number">0xe6</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line"> <span class="number">0x00</span>, <span class="number">0x38</span>, <span class="number">0xe1</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0xe7</span>,</span><br><span class="line"> <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x9d</span>, <span class="number">0x38</span>, <span class="number">0xe2</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line"> <span class="number">0x00</span>, <span class="number">0x9d</span>, <span class="number">0x04</span>, <span class="number">0xe8</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x9d</span>,</span><br><span class="line"> <span class="number">0x24</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0xcd</span>, <span class="number">0x28</span>, <span class="number">0xd2</span>, <span class="number">0x03</span>, <span class="number">0x01</span>,</span><br><span class="line"> <span class="number">0x04</span>, <span class="number">0x3d</span>, <span class="number">0x3f</span>, <span class="number">0x35</span>, <span class="number">0x36</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> JSContext *<span class="title">JS_NewCustomContext</span><span class="params">(JSRuntime *rt)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  JSContext *ctx = JS_NewContextRaw(rt);</span><br><span class="line">  <span class="keyword">if</span> (!ctx)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">  JS_AddIntrinsicBaseObjects(ctx);</span><br><span class="line">  JS_AddIntrinsicDate(ctx);</span><br><span class="line">  JS_AddIntrinsicEval(ctx);</span><br><span class="line">  JS_AddIntrinsicStringNormalize(ctx);</span><br><span class="line">  JS_AddIntrinsicRegExp(ctx);</span><br><span class="line">  JS_AddIntrinsicJSON(ctx);</span><br><span class="line">  JS_AddIntrinsicProxy(ctx);</span><br><span class="line">  JS_AddIntrinsicMapSet(ctx);</span><br><span class="line">  JS_AddIntrinsicTypedArrays(ctx);</span><br><span class="line">  JS_AddIntrinsicPromise(ctx);</span><br><span class="line">  JS_AddIntrinsicBigInt(ctx);</span><br><span class="line">  <span class="keyword">return</span> ctx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  JSRuntime *rt;</span><br><span class="line">  JSContext *ctx;</span><br><span class="line">  rt = JS_NewRuntime();</span><br><span class="line">  js_std_set_worker_new_context_func(JS_NewCustomContext);</span><br><span class="line">  js_std_init_handlers(rt);</span><br><span class="line">  JS_SetModuleLoaderFunc(rt, <span class="literal">NULL</span>, js_module_loader, <span class="literal">NULL</span>);</span><br><span class="line">  ctx = JS_NewCustomContext(rt);</span><br><span class="line">  js_std_add_helpers(ctx, argc, argv);</span><br><span class="line">  js_std_eval_binary(ctx, qjsc_helloworld, qjsc_helloworld_size, <span class="number">0</span>);</span><br><span class="line">  js_std_loop(ctx);</span><br><span class="line">  JS_FreeContext(ctx);</span><br><span class="line">  JS_FreeRuntime(rt);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œé•¿åº¦173çš„æ•°ç»„ qjsc_helloworld è®°å½•çš„å°±æ˜¯ quickjs ç¼–è¯‘ç”Ÿæˆçš„å­—èŠ‚ç ã€‚js_std_loop å°±æ˜¯ Event Loop å¤„ç†çš„å‡½æ•°ï¼Œæ˜¯è°ƒç”¨ç”¨æˆ· js å›è°ƒçš„ä¸»å¾ªç¯ï¼Œjs_std_loop å‡½æ•°å®ç°ä»£ç å¾ˆç®€æ´ï¼Œå¦‚ä¸‹ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* main loop which calls the user JS callbacks */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">js_std_loop</span><span class="params">(JSContext *ctx)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    JSContext *ctx1;</span><br><span class="line">    <span class="keyword">int</span> err;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(;;) &#123;</span><br><span class="line">        <span class="comment">/* execute the pending jobs */</span></span><br><span class="line">        <span class="keyword">for</span>(;;) &#123;</span><br><span class="line">            err = JS_ExecutePendingJob(JS_GetRuntime(ctx), &amp;ctx1);</span><br><span class="line">            <span class="keyword">if</span> (err &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (err &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                    js_std_dump_error(ctx1);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!os_poll_func || os_poll_func(ctx))</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ä¸Šé¢ä»£ç ä¸­çš„ os_poll_func å°±æ˜¯ js_os_poll å‡½æ•°çš„è°ƒç”¨ï¼Œjs_os_poll å‡½æ•°åœ¨ quickjs-libc.c é‡Œå®šä¹‰ï¼Œä¼šåœ¨ä¸»çº¿ç¨‹æ£€æŸ¥æœ‰æ²¡æœ‰éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œæ²¡æœ‰çš„è¯ä¼šåœ¨åå°ç­‰å¾…äº‹ä»¶æ‰§è¡Œã€‚</p>
<p>ç®€å•è¯´QuickJSé›†æˆä½¿ç”¨è¿‡ç¨‹æ˜¯å…ˆå°† QuickJS æºç ç¼–è¯‘æˆé™æ€æˆ–åŠ¨æ€åº“ã€‚makefile ä¼šæŠŠå¤´æ–‡ä»¶ã€åº“æ–‡ä»¶å’Œå¯æ‰§è¡Œæ–‡ä»¶ copy åˆ°æ ‡å‡†ç›®å½•ä¸‹ã€‚ç„¶å C æºç è°ƒç”¨ QuickJS æä¾›çš„ API å¤´æ–‡ä»¶ã€‚æœ€åç¼–è¯‘ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚</p>
<p>é‚£ä¹ˆ js å’ŒåŸç”Ÿ c çš„äº¤äº’å¦‚ä½•åšå‘¢ï¼Ÿ</p>
<h2 id="è°ƒç”¨åŸç”Ÿå‡½æ•°"><a href="#è°ƒç”¨åŸç”Ÿå‡½æ•°" class="headerlink" title="è°ƒç”¨åŸç”Ÿå‡½æ•°"></a>è°ƒç”¨åŸç”Ÿå‡½æ•°</h2><p>åœ¨ QuickJS çš„ js ä»£ç é‡Œå¯ä»¥é€šè¿‡ import å¯¼å…¥ä¸€ä¸ª c çš„åº“ï¼Œè°ƒç”¨åº“é‡Œçš„å‡½æ•°ã€‚æ¯”å¦‚ QuickJS ä¸­çš„ fib.c æ–‡ä»¶ï¼ŒæŸ¥çœ‹å…¶å‡½æ•° js_fib å°±æ˜¯å¯¹ js é‡Œè°ƒç”¨çš„ fib å‡½æ•°çš„å®ç°ï¼Œä½¿ç”¨çš„æ˜¯ JS_CFUNC_DEF å®æ¥åš js æ–¹æ³•å’Œå¯¹åº” c å‡½æ•°æ˜ å°„ã€‚æ˜ å°„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> JSCFunctionListEntry js_fib_funcs[] = &#123;</span><br><span class="line">    JS_CFUNC_DEF(<span class="string">&quot;fib&quot;</span>, <span class="number">1</span>, js_fib ),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>åœ¨ js ä¸­ä½¿ç”¨èµ·æ¥ä¹Ÿå¾ˆç®€å•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; fib &#125; <span class="keyword">from</span> <span class="string">&quot;./fib.so&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> f = fib(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>
<p>quickjs-libc å†…ç½®äº†äº› std å’Œ os åŸç”Ÿå‡½æ•°å¯ä»¥ç›´æ¥ä¾› js ä½¿ç”¨ï¼Œæ¯”å¦‚ std.out.printf å‡½æ•°ï¼Œå…ˆçœ‹åœ¨ js_std_file_proto_funcs é‡Œçš„æ˜ å°„ä»£ç ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JS_CFUNC_DEF(<span class="string">&quot;printf&quot;</span>, <span class="number">1</span>, js_std_printf ),</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°å¯¹åº”çš„æ˜¯ js_std_printf å‡½æ•°ï¼ŒJS_CFUNC_DEF å®çš„ç¬¬äºŒä¸ªå‚æ•°ä¸º1è¡¨ç¤º outã€‚åœ¨ js é‡Œä½¿ç”¨çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> std <span class="keyword">from</span> <span class="string">&#x27;std&#x27;</span></span><br><span class="line"><span class="keyword">const</span> hi = <span class="string">&#x27;hi&#x27;</span></span><br><span class="line">std.out.printf(<span class="string">&#x27;%s&#x27;</span>, hi)</span><br></pre></td></tr></table></figure>
<p>æ€ä¹ˆæ–°å»ºä¸€ä¸ªè‡ªå·±çš„åº“å‘¢ï¼Ÿ</p>
<p>QuickJS é‡Œçš„ fib å°±æ˜¯ä¸ªä¾‹å­ï¼Œé€šè¿‡ç”Ÿæˆçš„ test_fib.c å¯ä»¥çœ‹åˆ°ä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">extern</span> JSModuleDef *<span class="title">js_init_module_fib</span><span class="params">(JSContext *ctx, <span class="keyword">const</span> <span class="keyword">char</span> *name)</span></span>;</span><br><span class="line">js_init_module_fib(ctx, <span class="string">&quot;examples/fib.so&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œå¯ä»¥å£°æ˜ä¸€ä¸ª js_init_module_fib å‡½æ•°å¹¶æŒ‡å®šåº“çš„è·¯å¾„ï¼Œåˆ›å»ºä¸€ä¸ª c æ¨¡å—ã€‚åœ¨åº“çš„æºæ–‡ä»¶ fib.c é‡Œçœ‹å®ç° js_init_module_fib å‡½æ•°çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> JS_SHARED_LIBRARY</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> JS_INIT_MODULE js_init_module</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> JS_INIT_MODULE js_init_module_fib</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">JSModuleDef *<span class="title">JS_INIT_MODULE</span><span class="params">(JSContext *ctx, <span class="keyword">const</span> <span class="keyword">char</span> *module_name)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    JSModuleDef *m;</span><br><span class="line">    m = JS_NewCModule(ctx, module_name, js_fib_init);</span><br><span class="line">    <span class="keyword">if</span> (!m)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    JS_AddModuleExportList(ctx, m, js_fib_funcs, countof(js_fib_funcs));</span><br><span class="line">    <span class="keyword">return</span> m;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œåˆ›å»ºæ¨¡å—ä½¿ç”¨çš„æ˜¯ JS_NewCModule å‡½æ•°ï¼Œæ¥ç€é€šè¿‡ JS_AddModuleExportList å°†æ¨¡å—çš„å‡½æ•°åŠ åˆ°æ¨¡å—å¯¼å‡ºåˆ—è¡¨é‡Œã€‚JS_SetModuleLoaderFunc ä¼šè®¾ç½®è¯»å–åº“çš„å‡½æ•°ä¸º js_module_loaderï¼Œjs_module_loader ä¼šåˆ¤æ–­è·¯å¾„åç¼€ï¼Œå¦‚æœæ˜¯.so ä¼šè°ƒç”¨ js_module_loader_so å‡½æ•°ã€‚js_module_loader_so ä¼šä½¿ç”¨ dlopen å’Œ dlsym æ¥è°ƒç”¨ so åº“ã€‚</p>
<p>QuickJS å¯¹è°ƒç”¨ c ç½‘ç»œçš„ä½¿ç”¨å¯ä»¥å‚çœ‹ <a href="https://github.com/khanhas/minnet-quickjs">minnet-quickjs</a> çš„ minnet.c å°è£…æ¥å£å®ç°ã€‚</p>
<p>js è°ƒç”¨ iOS çš„ Objective-C çš„æ–¹æ³•å¯ä»¥å‚çœ‹ <a href="https://github.com/quickjs-ios/quickjs-ios">QuickJS iOS Bridge</a> è¿™ä¸ªå·¥ç¨‹ï¼Œä½¿ç”¨ç¤ºä¾‹å¯ä»¥å‚çœ‹<a href="https://github.com/quickjs-ios/quickjs-ios/blob/464b2501e37dd749f6c1db16af73b9d2e36e7bee/QuickJS-iOSTests/QuickJS_iOSTests.m#L276">è¿™æ®µè°ƒç”¨ Objective-C ç½‘ç»œè¯·æ±‚çš„ä»£ç </a>ã€‚</p>
<p>å¦å¤–åœ¨ QuickJS çš„é‚®ä»¶åˆ—è¡¨ä¸­çœ‹åˆ°äº›åŒå­¦å¯¹ QuickJS åšäº†å†™æ‰©å±•å·¥ä½œï¼Œå°† QuickJS çš„èƒ½åŠ›è¿›è¡Œäº†å¢å¼ºã€‚æ¯”å¦‚å°† QuickJS ç§»æ¤åˆ° <a href="http://fuchsia.dev">Fuchsia æ“ä½œç³»ç»Ÿ</a>ä¸Šï¼Œåœ¨<a href="https://fuchsia.googlesource.com/third_party/quickjs">è¿™é‡Œ</a>å¯ä»¥çœ‹åˆ°ã€‚<a href="https://github.com/ratboy666/qjs-ffi">qjs-ffi</a> å¯¹ QuickJS å¢åŠ  ffi çš„æ”¯æŒã€‚Eduard Suica å¼€å‘äº† <a href="https://github.com/eduardsui/jib.js">jib.js</a> å¯å°† QuickJS ä½œä¸º js è§£é‡Šå™¨ çš„ js è¿è¡Œæ—¶ç¯å¢ƒï¼Œå…¼å®¹ Node.jsï¼Œæ”¯æŒ socketã€ç®¡é“ã€æ–‡ä»¶å’Œæ§åˆ¶å°ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ·±å…¥ QuickJS å†…éƒ¨ï¼Œçœ‹çœ‹ QuickJS çš„æºä»£ç ç»“æ„ä»¥åŠè¯´è¯´æºç çš„åŸç†ã€‚</p>
<h2 id="æºç æ–‡ä»¶ä»‹ç»"><a href="#æºç æ–‡ä»¶ä»‹ç»" class="headerlink" title="æºç æ–‡ä»¶ä»‹ç»"></a>æºç æ–‡ä»¶ä»‹ç»</h2><p>æˆ‘å…ˆå¯¹ QuickJS æºç æ–‡ä»¶åšä¸ªä»‹ç»ï¼Œä¸»è¦æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<ul>
<li>quickjs.c å’Œ quickjs.hï¼šQuickJS çš„æ ¸å¿ƒä»£ç ï¼Œå…¶ä»–æ–‡ä»¶åŸºæœ¬éƒ½ä¼šä¾èµ–äºå®ƒã€‚</li>
<li>quickjs-lib.c å’Œ quickjs-lib.hï¼šè°ƒç”¨ QuickJS æ¥å£ APIï¼Œä¾› C ç¨‹åºä½¿ç”¨ã€‚</li>
<li>quickjs-atom.hï¼šå®šä¹‰äº†jsçš„å…³é”®å­—åŸå­å­—ç¬¦ä¸²ã€‚</li>
<li>quickjs-opcode.hï¼šå®šä¹‰äº†å­—èŠ‚ç æ“ä½œç¬¦</li>
</ul>
<p>æ–‡ä»¶å¤¹ï¼š</p>
<ul>
<li>examples/ï¼šä¸€äº› js ä»£ç çš„ç¤ºä¾‹ï¼ŒåŒ…å«äº†å’Œ c äº¤äº’çš„ js ä»£ç </li>
<li>tests/ï¼šæµ‹è¯• QuickJS æ ¸å¿ƒåŠŸèƒ½ç”¨çš„</li>
<li>doc/ï¼šQuickJS å®˜æ–¹ä½¿ç”¨è¯´æ˜æ–‡æ¡£</li>
</ul>
<p>ä¸€äº›å¯æ‰§è¡Œç¨‹åºç›¸å…³çš„æ–‡ä»¶ï¼š</p>
<ul>
<li>qjsc.cï¼šç¼–è¯‘å®Œç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ qjscï¼Œæ˜¯ QuickJS çš„ Javascript ç¼–è¯‘å™¨ã€‚</li>
<li>qjs.cï¼šå¯äº¤äº’è§£é‡Šæ‰§è¡Œçš„ç¨‹åº qjsï¼Œæ˜¯ QuickJS çš„è§£é‡Šå™¨ã€‚qjs å…·æœ‰æ ˆè™šæœºå†…æ ¸ï¼Œé€šè¿‡è¯»å– js æ–‡ä»¶è§£é‡Šæ‰§è¡Œï¼Œå‡½æ•°è°ƒç”¨é“¾æ˜¯ main-&gt;eval_file-&gt;eval_buf-&gt;JS_EvalFunction-&gt;JS_EvalFunctionInternal-&gt;JS_CallFree-&gt;JS_CallInternal</li>
<li>repl.jsï¼šjså†™çš„REPLç¨‹åºã€‚</li>
<li>qjscalc.jsï¼šä¸€ä¸ªè®¡ç®—å™¨ç¨‹åºã€‚</li>
</ul>
<p>å…¶ä¸­ qjsc.c ä¼šæ ¹æ®å‚æ•°è¾“å…¥ï¼ŒæŒ¨ä¸ªè°ƒç”¨ compile_file å‡½æ•°è¿›è¡Œç¼–è¯‘ã€‚å‚æ•°è¯´æ˜å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">ming@mingdeMacBook-Pro ~ % qjsc -h</span><br><span class="line">QuickJS Compiler version <span class="number">2020</span><span class="number">-11</span><span class="number">-08</span></span><br><span class="line">usage: qjsc [options] [files]</span><br><span class="line"></span><br><span class="line">options are:</span><br><span class="line">-c          åªè¾“å‡ºå­—èŠ‚ç  C æ–‡ä»¶ï¼Œé»˜è®¤æ˜¯è¾“å‡ºå¯æ‰§è¡Œæ–‡ä»¶</span><br><span class="line">-e          è¾“å‡ºå¸¦ main å‡½æ•°çš„å­—èŠ‚ç  C æ–‡ä»¶</span><br><span class="line">-o output   è®¾ç½®è¾“å‡ºæ–‡ä»¶åï¼Œé»˜è®¤æ˜¯ a.out æˆ–è€… out.c</span><br><span class="line">-N cname    è®¾ç½®è¾“å‡º c æ–‡ä»¶çš„å­—èŠ‚ç æ•°ç»„çš„å˜é‡å</span><br><span class="line">-m          ç¼–è¯‘æˆ JavaScript æ¨¡å—</span><br><span class="line">-D module_name         ç¼–è¯‘åŠ¨æ€åŠ è½½æ¨¡å—æˆ– workerï¼Œä¹Ÿå°±æ˜¯ç”¨äº† <span class="keyword">import</span> æˆ– os.Worker çš„æƒ…å†µ</span><br><span class="line">-M module_name[,cname] ç»™å¤–éƒ¨ C æ¨¡å—æ·»åŠ åˆå§‹åŒ–ä»£ç </span><br><span class="line">-x          big endian å’Œ little endian ç¿»è½¬ï¼Œç”¨äºäº¤å‰ç¼–è¯‘</span><br><span class="line">-p prefix   è®¾ç½® C å˜é‡åçš„å‰ç¼€</span><br><span class="line">-S n        è®¾ç½®æœ€å¤§æ ˆå¤§å°ï¼Œé»˜è®¤æ˜¯ <span class="number">262144</span></span><br><span class="line">-flto       ç¼–è¯‘æˆå¯æ‰§è¡Œæ–‡ä»¶ä½¿ç”¨ clang çš„é“¾æ¥ä¼˜åŒ–</span><br><span class="line">-fbignum    big number æ”¯æŒçš„å¼€å¯</span><br><span class="line">-fno-[date|eval|<span class="built_in">string</span>-normalize|regexp|json|proxy|<span class="built_in">map</span>|typedarray|promise|<span class="keyword">module</span>-loader|bigint]</span><br><span class="line">            è®©ä¸€äº›è¯­è¨€ç‰¹æ€§ä¸å¯ç”¨ï¼Œä»è€Œèƒ½å¤Ÿè®©ç”Ÿæˆçš„ä»£ç æ›´å°</span><br></pre></td></tr></table></figure>
<p>ç¼–è¯‘çš„è¿‡ç¨‹æ˜¯å…ˆä½¿ç”¨ js_load_file è¯»å– js æ–‡ä»¶å†…å®¹ï¼Œä½¿ç”¨ JS_Eval å‡½æ•°ç”Ÿæˆ JSValue çš„å¯¹è±¡ï¼ŒJSValue æ˜¯åŸºæœ¬çš„å€¼æˆ–æŒ‡é’ˆåœ°å€ï¼Œæ¯”å¦‚å‡½æ•°ã€æ•°ç»„ã€å­—ç¬¦ä¸²éƒ½æ˜¯å€¼ï¼Œç„¶åä½¿ç”¨ output_object_code å‡½æ•°æŠŠå¯¹è±¡çš„å­—èŠ‚ç å†™åˆ°æ–‡ä»¶é‡Œï¼Œä¹Ÿå°±æ˜¯ dump æˆäºŒè¿›åˆ¶ã€‚ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ä½¿ç”¨çš„å‡½æ•°æ˜¯ output_executableã€‚</p>
<p>qjs çš„ Options -e è¡¨ç¤ºæ‰§è¡Œè¡¨è¾¾å¼ï¼Œ-i è¡¨ç¤ºè¿›å…¥äº¤äº’æ¨¡å¼ï¼Œ-I è¡¨ç¤ºåŠ è½½æ–‡ä»¶ï¼Œ-d ä¼šç»Ÿè®¡å†…å­˜ä½¿ç”¨æƒ…å†µã€‚</p>
<p>å¦å¤–è¿˜æœ‰ä¸€äº›è¾…åŠ©å‡½æ•° cutils.cã€cutils.hã€‚unicode ç›¸å…³å‡½æ•°æ–‡ä»¶ libunicode.cã€libunicode.hã€libunicode-table.hã€‚æ­£åˆ™è¡¨è¾¾å¼æ”¯æŒç›¸å…³æ–‡ä»¶ libregexp.cã€libregexp.hã€libregexp-opcode.hã€‚é“¾è¡¨ list.hã€‚Decimal ä»»æ„ç²¾åº¦ç§‘å­¦è®¡ç®— libBF libbf.cã€libbf.hã€‚</p>
<h2 id="QuickJS-æ¶æ„"><a href="#QuickJS-æ¶æ„" class="headerlink" title="QuickJS æ¶æ„"></a>QuickJS æ¶æ„</h2><p>QuickJS çš„ç»“æ„å›¾å¦‚ä¸‹ï¼š<br><img src="/uploads/deeply-analyse-quickjs/5.png" alt=""><br>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå…¶ä¸­æœ€ä¸Šå±‚æ˜¯ qjs å’Œ qjscï¼Œqjs åŒ…å«äº†å‘½ä»¤è¡Œå‚æ•°å¤„ç†ï¼Œå¼•æ“ç¯å¢ƒåˆ›å»ºï¼ŒåŠ è½½æ¨¡å—å’Œ js æ–‡ä»¶è¯»å–è§£é‡Šæ‰§è¡Œã€‚qjsc å¯ä»¥ç¼–è¯‘ js æ–‡ä»¶æˆå­—èŠ‚ç æ–‡ä»¶ï¼Œç”Ÿæˆçš„å­—èŠ‚ç å¯ä»¥ç›´æ¥è¢«è§£é‡Šæ‰§è¡Œï¼Œæ€§èƒ½ä¸Šçœ‹æ˜¯çœæ‰äº† js æ–‡ä»¶è§£æçš„æ¶ˆè€—ã€‚</p>
<p>ä¸­é—´å±‚æ˜¯æ ¸å¿ƒï¼ŒJSRuntime æ˜¯ js è¿è¡Œæ—¶ï¼Œå¯ä»¥çœ‹åšæ˜¯ js è™šæ‹Ÿæœºç¯å¢ƒï¼Œå¤šä¸ª JSRuntime ä¹‹é—´æ˜¯éš”ç¦»çš„ï¼Œä»–ä»¬ä¹‹é—´ä¸èƒ½ç›¸äº’è°ƒç”¨å’Œé€šä¿¡ã€‚JSContext æ˜¯è™šæœºé‡Œçš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œä¸€ä¸ª JSRuntime é‡Œå¯ä»¥æœ‰å¤šä¸ª JSContextï¼Œæ¯ä¸ªä¸Šä¸‹æ–‡æœ‰è‡ªå·±çš„å…¨å±€å’Œç³»ç»Ÿå¯¹è±¡ï¼Œä¸åŒ JSContext ä¹‹é—´å¯ä»¥ç›¸äº’è®¿é—®å’Œå…±äº«å¯¹è±¡ã€‚JS_Eval å’Œ JS_Parse ä¼šæŠŠ js æ–‡ä»¶ç¼–è¯‘ä¸ºå­—èŠ‚ç ã€‚JS_Call æ˜¯ç”¨æ¥è§£é‡Šæ‰§è¡Œå­—èŠ‚ç çš„ã€‚JS_OPCode æ˜¯ç”¨æ¥æ ‡è¯†æ‰§è¡ŒæŒ‡ä»¤å¯¹åº”çš„æ“ä½œç¬¦ã€‚JSClass åŒ…å«æ ‡å‡†çš„ js çš„å¯¹è±¡ï¼Œæ˜¯è¿è¡Œæ—¶åˆ›å»ºçš„ç±»ï¼Œå¯¹è±¡ç±»å‹ä½¿ç”¨ JSClassID æ¥æ ‡è®°ï¼Œä½¿ç”¨ JS_NewClassID å’Œ JS_NewClass å‡½æ•°æ³¨å†Œï¼Œä½¿ç”¨ JS_NewObjectClass æ¥åˆ›å»ºå¯¹è±¡ã€‚JSOpCode æ˜¯å­—èŠ‚ç çš„ç»“æ„ä½“ï¼Œé€šè¿‡ quickjs-opcode.h é‡Œçš„å­—èŠ‚ç çš„å®šä¹‰å¯ä»¥çœ‹åˆ°ï¼ŒQuickJS å¯¹äºæ¯ä¸ªå­—èŠ‚ç çš„å¤§å°éƒ½ä¼šç²¾ç¡®æ§åˆ¶ï¼Œç›®çš„æ˜¯ä¸æµªè´¹å†…å­˜ä½¿ç”¨ï¼Œæ¯”å¦‚8ä½ä»¥ä¸‹ç”¨ä¸åˆ°1ä¸ªå­—èŠ‚å’Œå…¶ä»–ä¿¡æ¯ä¸€èµ·æ”¾åœ¨é‚£1ä¸ªå­—èŠ‚é‡Œï¼Œ8ä½ç”¨2ä¸ªå­—èŠ‚ï¼Œæ•´æ•°åœ¨ç¬¬2ä¸ªå­—èŠ‚é‡Œï¼Œ16ä½ç”¨å2ä¸ªå­—èŠ‚ã€‚Unicode æ˜¯ QuickJS è‡ªå·±åšçš„åº“ libunicode.cï¼Œlibunicode æœ‰ Unicode è§„èŒƒåŒ–å’Œè„šæœ¬é€šç”¨ç±»åˆ«æŸ¥è¯¢ï¼ŒåŒ…å«æ‰€æœ‰ Unicode äºŒè¿›åˆ¶å±æ€§ï¼Œlibunicode è¿˜å¯ä»¥å•ç‹¬å‡ºæ¥ç”¨åœ¨å…¶ä»–å·¥ç¨‹ä¸­ã€‚ä¸­é—´å±‚è¿˜åŒ…å«æ”¯æŒç§‘å­¦è®¡ç®— BigInt å’Œ BigFloat çš„ libbf åº“ï¼Œæ­£åˆ™è¡¨è¾¾å¼å¼•æ“ libregexpã€‚æ‰©å±•æ¨¡å— Std Module å’Œ OS Moduleï¼Œæä¾›æ ‡å‡†èƒ½åŠ›å’Œç³»ç»Ÿèƒ½åŠ›ï¼Œæ¯”å¦‚æ–‡ä»¶æ“ä½œå’Œæ—¶é—´æ“ä½œç­‰ã€‚</p>
<p>åº•å±‚æ˜¯åŸºç¡€ï¼ŒJS_RunGC ä½¿ç”¨å¼•ç”¨è®¡æ•°æ¥ç®¡ç†å¯¹è±¡çš„é‡Šæ”¾ã€‚JS_Exception æ˜¯ä¼šæŠŠ JSValue è¿”å›çš„å¼‚å¸¸å¯¹è±¡å­˜åœ¨ JSContext é‡Œï¼Œé€šè¿‡ JS_GetException å‡½æ•°å–å‡ºå¼‚å¸¸å¯¹è±¡ã€‚å†…å­˜ç®¡ç†æ§åˆ¶ js è¿è¡Œæ—¶å…¨å±€å†…å­˜åˆ†é…ä¸Šé™ä½¿ç”¨çš„æ˜¯ JS_SetMemoryLimit å‡½æ•°ï¼Œè‡ªå®šä¹‰åˆ†é…å†…å­˜ç”¨çš„æ˜¯ JS_NewRuntime2 å‡½æ•°ï¼Œå †æ ˆçš„å¤§å°ä½¿ç”¨çš„æ˜¯ JS_SetMaxStackSize å‡½æ•°æ¥è®¾ç½®ã€‚</p>
<p>æ€»çš„æ¥è¯´ QuickJS çš„è¿è¡Œæ–¹å¼å¦‚ä¸‹å›¾ï¼š<br><img src="/uploads/deeply-analyse-quickjs/3.png" alt=""></p>
<h2 id="QuickJS-æ ¸å¿ƒä»£ç æµç¨‹"><a href="#QuickJS-æ ¸å¿ƒä»£ç æµç¨‹" class="headerlink" title="QuickJS æ ¸å¿ƒä»£ç æµç¨‹"></a>QuickJS æ ¸å¿ƒä»£ç æµç¨‹</h2><p>quickjs.c æœ‰5ä¸‡å¤šè¡Œä»£ç ã€‚åˆ†æ QuickJS ä»£ç å¯ä»¥ä»ä»–è§£ææ‰§è¡Œ JS ä»£ç çš„è¿‡ç¨‹ä¸€æ­¥ä¸€æ­¥çš„åˆ†æã€‚è°ƒç”¨ QuickJS æ‰§è¡Œä¸€æ®µ JS ä»£ç çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">JSRuntime *rt = JS_NewRuntime();</span><br><span class="line">JSContext *ctx = JS_NewContext(rt);</span><br><span class="line">js_std_add_helpers(ctx, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *scripts = <span class="string">&quot;console.log(&#x27;hello quickjs&#x27;)&quot;</span>;</span><br><span class="line">JS_Eval(ctx, scripts, <span class="built_in">strlen</span>(scripts), <span class="string">&quot;main&quot;</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç ä¸­ rt å’Œ ctx æ˜¯å…ˆæ„é€ ä¸€ä¸ª JS è¿è¡Œæ—¶å’Œä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œjs_std_add_helpers æ˜¯è°ƒç”¨ C çš„ std æ–¹æ³•å¸®åŠ©åœ¨æ§åˆ¶å°è¾“å‡ºè°ƒè¯•ä¿¡æ¯ã€‚</p>
<h3 id="æ–°å»º-Runtime"><a href="#æ–°å»º-Runtime" class="headerlink" title="æ–°å»º Runtime"></a>æ–°å»º Runtime</h3><p>JS_NewRuntime å‡½æ•°ä¼šæ–°å»ºä¸€ä¸ª JSRuntime rtï¼ŒRuntimeçš„ç»“æ„ä½“ JSRuntime åŒ…å«äº†å†…å­˜åˆ†é…å‡½æ•°å’ŒçŠ¶æ€ï¼ŒåŸå­å¤§å° atom_size å’ŒåŸå­ç»“æ„æ•°ç»„æŒ‡é’ˆ atom_arrayï¼Œè®°å½•ç±»çš„æ•°ç»„ class_arrayï¼Œç”¨äº GC çš„ä¸€äº›é“¾è¡¨ headï¼Œæ ˆå¤´ stack_topï¼Œæ ˆç©ºé—´å¤§å°ï¼ˆbytesï¼‰stack_sizeï¼Œå½“å‰æ ˆå¸§ current_stack_frameï¼Œé¿å…é‡å¤å‡ºç°å†…å­˜è¶…å‡ºé”™è¯¯çš„ in_out_of_memory å¸ƒå°”å€¼ï¼Œä¸­æ–­å¤„ç† interrupt_handlerï¼Œmodule è¯»å–å‡½æ•° module_loader_funcï¼Œç”¨äºåˆ†é…ã€é‡Šæ”¾å’Œå…‹éš† SharedArrayBuffers çš„ sab_funcsï¼ŒShape çš„å“ˆå¸Œè¡¨ shape_hashï¼Œåˆ›å»ºä¸€èˆ¬å‡½æ•°å¯¹è±¡å¤–ï¼Œè¿˜æœ‰ç§é¿å¼€ç¹çå­—èŠ‚ç å¤„ç†æ›´å¿«åˆ›å»ºå‡½æ•°å¯¹è±¡çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ Shapeï¼Œåˆ›å»º Shape çš„è°ƒç”¨é“¾æ˜¯ JS_NewCFunctionData -&gt; JS_NewObjectProtoClass -&gt; js_new_shapeã€‚åˆ›å»º shape çš„å‡½æ•°æ˜¯ js_new_shape2ï¼Œåˆ›å»ºå¯¹è±¡è°ƒç”¨çš„å‡½æ•°æ˜¯ JS_NewObjectFromShapeã€‚</p>
<p>åˆ›å»ºçš„å¯¹è±¡æ˜¯ JSObject ç»“æ„ä½“ï¼ŒJSObject æ˜¯ js çš„å¯¹è±¡ï¼ŒJSObject çš„å­—æ®µä¼šä½¿ç”¨ unionï¼Œç»“æ„ä½“å’Œ union çš„åŒºåˆ«æ˜¯ç»“æ„ä½“çš„å­—æ®µä¹‹é—´ä¼šæœ‰è‡ªå·±çš„å†…å­˜ï¼Œè€Œ union é‡Œçš„å­—æ®µä¼šä½¿ç”¨ç›¸åŒçš„å†…å­˜ï¼Œunion å†…å­˜å°±æ˜¯é‡Œé¢å ç”¨æœ€å¤šå†…å­˜å­—æ®µçš„å†…å­˜ã€‚union ä½¿ç”¨çš„å†…å­˜è¦†ç›–æ–¹å¼ï¼Œåªèƒ½æœ‰ä¸€ä¸ªå­—æ®µçš„å€¼ï¼Œæ¯æ¬¡æœ‰æ–°å­—æ®µèµ‹å€¼éƒ½ä¼šè¦†ç›–å…ˆå‰çš„å­—æ®µå€¼ã€‚JSObject é‡Œç¬¬ä¸€ä¸ª union æ˜¯ç”¨åˆ°å¼•ç”¨è®¡æ•°çš„ï¼Œ<code>__gc_ref_count</code> ç”¨æ¥è®¡æ•°ï¼Œ<code>__gc_mark</code> ç”¨æ¥æè¿°å½“å‰ GC çš„ä¿¡æ¯ï¼Œå€¼ä¸º JSGCObjectTypeEnum æšä¸¾ã€‚extensible æ˜¯è¡¨ç¤ºå¯¹è±¡èƒ½å¦æ‰©å±•ã€‚is_exotic è®°å½•å¯¹è±¡æ˜¯å¦æ˜¯ exotic å¯¹è±¡ï¼Œes è§„èŒƒé‡Œå®šä¹‰åªè¦ä¸æ˜¯æ™®é€šçš„å¯¹è±¡éƒ½æ˜¯ exotic å¯¹è±¡ï¼Œæ¯”å¦‚æ•°ç»„åˆ›å»ºçš„å®ä¾‹å°±æ˜¯ exotic å¯¹è±¡ã€‚fast_array ä¸º true ç”¨äºJS_CLASS_ARRAYã€JS_CLASS_ARGUMENTSå’Œç±»å‹åŒ–æ•°ç»„è¿™æ ·åªä¼šç”¨åˆ° get å’Œ put åŸºæœ¬æ“ä½œçš„æ•°ç»„ã€‚å¦‚æœå¯¹è±¡æ˜¯æ„é€ å‡½æ•° is_constructor ä¸º trueã€‚å½“ is_uncatchable_error å­—æ®µä¸º true æ—¶è¡¨ç¤ºå¯¹è±¡çš„é”™è¯¯ä¸å¯æ•è·ã€‚class_id å¯¹åº”çš„æ˜¯ JS_CLASS æ‰“å¤´çš„æšä¸¾å€¼ï¼Œè¿™äº›æšä¸¾å€¼å®šä¹‰äº†ç±»çš„ç±»å‹ã€‚åŸå‹å’Œå±æ€§çš„åå­—è¿˜æœ‰ flag è®°åœ¨ shape å­—æ®µï¼Œå­˜å±æ€§çš„æ•°ç»„è®°å½•åœ¨ prop å­—æ®µã€‚</p>
<p>first_weak_ref æŒ‡å‘ç¬¬ä¸€æ¬¡ä½¿ç”¨è¿™ä¸ªå¯¹è±¡åšé”®çš„ WeakMap åœ°å€ã€‚åœ¨ js ä¸­ WeakMap çš„é”®å¿…é¡»è¦æ˜¯å¯¹è±¡ï¼ŒMap çš„é”®å¯ä»¥æ˜¯å¯¹è±¡ä¹Ÿå¯ä»¥æ˜¯å…¶ä»–ç±»å‹ï¼Œå½“ Map çš„é”®æ˜¯å¯¹è±¡æ—¶ä¼šå¤šä¸€æ¬¡å¯¹å¯¹è±¡å¼•ç”¨çš„è®¡æ•°ï¼Œè€Œ WeakMap åˆ™ä¸ä¼šï¼ŒWeakMapæ²¡æ³•è·å–æ‰€æœ‰é”®å’Œæ‰€æœ‰å€¼ã€‚é”®ä½¿ç”¨å¯¹è±¡ä¸»è¦æ˜¯ä¸ºäº†ç»™å®ä¾‹å­˜å‚¨ä¸€äº›é¢å¤–çš„æ•°æ®ï¼Œå¦‚æœä½¿ç”¨ Map çš„è¯é‡Šæ”¾å¯¹è±¡æ—¶è¿˜éœ€è¦è€ƒè™‘ Map å¯¹åº”é”®å’Œå€¼çš„åˆ é™¤ï¼Œç»´æŠ¤èµ·æ¥ä¸æ–¹ä¾¿ï¼Œè€Œä½¿ç”¨ WeakMapï¼Œå½“å¯¹è±¡åœ¨å…¶ä»–åœ°æ–¹é‡Šæ”¾å®Œåå¯¹åº”çš„ WeakMap é”®å€¼å°±ä¼šè¢«è‡ªåŠ¨æ¸…é™¤æ‰ã€‚</p>
<p>JS_ClASS å¼€å¤´å®šä¹‰çš„ç±»å¯¹è±¡ä½¿ç”¨çš„æ˜¯ unionï¼Œå› ä¸ºä¸€ä¸ªå®ä¾‹å¯¹è±¡åªå¯èƒ½å±äºä¸€ç§ç±»å‹ã€‚å…¶ä¸­ JS_CLASS_BOUND_FUNCTION ç±»å‹å¯¹åº”çš„ç»“æ„ä½“æ˜¯ JSBoundFunctionï¼ŒJS_CLASS_BOUND_FUNCTION ç±»å‹æ˜¯ä½¿ç”¨ bind() æ–¹æ³•åˆ›å»ºçš„å‡½æ•°ï¼Œåˆ›å»ºçš„å‡½æ•°çš„ this è¢«æŒ‡å®šæ˜¯ bind() çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œbind çš„å…¶ä»–å‚æ•°ä¼šç»™æ–°åˆ›å»ºçš„å‡½æ•°ä½¿ç”¨ã€‚JS_CLASS_C_FUNCTION_DATA è¿™ç§ç±»å‹çš„å¯¹è±¡æ˜¯ QuickJS çš„æ‰©å±•å‡½æ•°ï¼Œå¯¹åº”ç»“æ„ä½“æ˜¯ JSCFunctionDataRecordã€‚JS_CLASS_FOR_IN_ITERATOR ç±»å‹å¯¹è±¡æ˜¯ forâ€¦in åˆ›å»ºçš„è¿­ä»£å™¨å‡½æ•°ï¼Œå¯¹åº”çš„ç»“æ„ä½“æ˜¯ JSForInIteratorã€‚</p>
<p>JS_CLASS_ARRAY_BUFFER è¡¨ç¤ºå½“å‰å¯¹è±¡æ˜¯ ArrayBuffer å¯¹è±¡ï¼ŒArrayBuffer æ˜¯ç”¨æ¥è®¿é—®äºŒè¿›åˆ¶æ•°æ®ï¼Œæ¯”å¦‚åŠ å¿«æ•°ç»„æ“ä½œï¼Œè¿˜æœ‰åª’ä½“å’Œç½‘ç»œ Socket çš„äºŒè¿›åˆ¶æ•°æ®ï¼ŒArrayBuffer å¯¹åº” swift é‡Œçš„ byte arrayï¼Œswift çš„å­—ç¬¦ä¸²ç±»å‹æ˜¯åŸºäº Unicode scalar å€¼æ„å»ºçš„ï¼Œä¸€ä¸ª Unicode scalar æ˜¯ä¸€ä¸ª21ä½æ•°å­—ï¼Œç”¨æ¥ä»£è¡¨ä¸€ä¸ªå­—ç¬¦æˆ–ä¿®é¥°ç¬¦ï¼Œæ¯”å¦‚ U+1F600 å¯¹åº”çš„ä¿®é¥°ç¬¦æ˜¯ ğŸ˜€ï¼ŒU+004D å¯¹åº”çš„å­—ç¬¦æ˜¯ Mã€‚å› æ­¤ Unicode scalar æ˜¯å¯ä»¥ç”± byte array æ¥æ„å»ºçš„ã€‚byte array å’Œå­—ç¬¦ä¹‹é—´ä¹Ÿå¯ä»¥ç›¸äº’è½¬æ¢ï¼Œå¦‚ä¸‹é¢çš„ swift ä»£ç ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å­—ç¬¦è½¬ byte array</span></span><br><span class="line"><span class="keyword">let</span> str <span class="operator">=</span> <span class="string">&quot;starming&quot;</span></span><br><span class="line"><span class="keyword">let</span> byteArray: [<span class="type">UInt8</span>] <span class="operator">=</span> str.utf8.map&#123; <span class="type">UInt8</span>(<span class="variable">$0</span>) &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// byte array è½¬å­—ç¬¦</span></span><br><span class="line"><span class="keyword">let</span> byteArray:[<span class="type">UInt8</span>] <span class="operator">=</span> [<span class="number">115</span>, <span class="number">116</span>, <span class="number">97</span>, <span class="number">114</span>, <span class="number">109</span>, <span class="number">105</span>, <span class="number">110</span>, <span class="number">103</span>]</span><br><span class="line"><span class="keyword">let</span> str <span class="operator">=</span> <span class="type">String</span>(data: <span class="type">Data</span>(bytes: byteArray, count: <span class="number">8</span>), encoding: .utf8)</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œå°† starming å­—ç¬¦ä¸²è½¬æ¢æˆäº† [115, 116, 97, 114, 109, 105, 110, 103] byte arrayï¼Œé€†å‘è¿‡æ¥ä¹Ÿæ²¡æœ‰é—®é¢˜ã€‚</p>
<p>typed_array å­—æ®µåŒ…å«å¦‚ä¸‹ç±»å‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    JS_CLASS_UINT8C_ARRAY,      <span class="comment">/* u.array (typed_array) */</span></span><br><span class="line">    JS_CLASS_INT8_ARRAY,        <span class="comment">/* u.array (typed_array) */</span></span><br><span class="line">    JS_CLASS_UINT8_ARRAY,       <span class="comment">/* u.array (typed_array) */</span></span><br><span class="line">    JS_CLASS_INT16_ARRAY,       <span class="comment">/* u.array (typed_array) */</span></span><br><span class="line">    JS_CLASS_UINT16_ARRAY,      <span class="comment">/* u.array (typed_array) */</span></span><br><span class="line">    JS_CLASS_INT32_ARRAY,       <span class="comment">/* u.array (typed_array) */</span></span><br><span class="line">    JS_CLASS_UINT32_ARRAY,      <span class="comment">/* u.array (typed_array) */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_BIGNUM</span></span><br><span class="line">    JS_CLASS_BIG_INT64_ARRAY,   <span class="comment">/* u.array (typed_array) */</span></span><br><span class="line">    JS_CLASS_BIG_UINT64_ARRAY,  <span class="comment">/* u.array (typed_array) */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    JS_CLASS_FLOAT32_ARRAY,     <span class="comment">/* u.array (typed_array) */</span></span><br><span class="line">    JS_CLASS_FLOAT64_ARRAY,     <span class="comment">/* u.array (typed_array) */</span></span><br><span class="line">    JS_CLASS_DATAVIEW,          <span class="comment">/* u.typed_array */</span></span><br></pre></td></tr></table></figure>
<p>typed_array ä¹Ÿå°±æ˜¯ç±»å‹åŒ–æ•°ç»„ï¼Œå…¶ç»“æ„ä½“æ˜¯ JSTypedArrayã€‚ç±»å‹åŒ–æ•°ç»„æŠŠå®ç°åˆ†ä¸º ArrayBuffer å¯¹è±¡ç¼“å†²ï¼Œä½¿ç”¨è§†å›¾è¯»å†™ç¼“å†²å¯¹è±¡ä¸­çš„å†…å®¹ï¼Œè§†å›¾ä¼šå°†æ•°æ®è½¬æ¢æˆæœ‰ç±»å‹çš„æ•°ç»„ã€‚</p>
<p>map_state å­—æ®µçš„ç»“æ„ä½“æ˜¯ JSMapStateï¼Œç”¨æ¥å­˜æ”¾ä»¥ä¸‹å¯¹è±¡ç±»å‹çš„çŠ¶æ€ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">JS_CLASS_MAP,               <span class="comment">/* u.map_state */</span></span><br><span class="line">JS_CLASS_SET,               <span class="comment">/* u.map_state */</span></span><br><span class="line">JS_CLASS_WEAKMAP,           <span class="comment">/* u.map_state */</span></span><br><span class="line">JS_CLASS_WEAKSET,           <span class="comment">/* u.map_state */</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢å¯¹è±¡ç±»å‹çš„çŠ¶æ€ï¼ŒçŠ¶æ€åŒ…æ‹¬æ˜¯å¦æ˜¯ weak çš„Mapã€Map è®°å½•é“¾æ¥å¤´ã€è®°å½•æ•°é‡ã€é“¾æ¥å¤´å“ˆå¸Œè¡¨ã€å“ˆå¸Œå¤§å°ã€è°ƒæ•´å“ˆå¸Œè¡¨å¤§å°çš„æ¬¡æ•°ã€‚</p>
<p>Map çš„è¿­ä»£å™¨ç±»å‹æ˜¯ JS_CLASS_MAP_ITERATOR å’Œ JS_CLASS_SET_ITERATORï¼Œå¯¹åº”çš„ç»“æ„ä½“æ˜¯ JSMapIteratorDataã€‚æ•°ç»„è¿­ä»£å™¨çš„ç±»å‹æ˜¯ JS_CLASS_ARRAY_ITERATOR å’Œ JS_CLASS_STRING_ITERATORï¼Œå¯¹åº”ç»“æ„ä½“æ˜¯ JSArrayIteratorDataã€‚æ­£åˆ™è¡¨è¾¾å¼è¿­ä»£å™¨çš„ç±»å‹æ˜¯ JS_CLASS_REGEXP_STRING_ITERATORï¼Œå¯¹åº”ç»“æ„ä½“æ˜¯ JSRegExpStringIteratorDataã€‚function åå¸¦ä¸€ä¸ªæ˜Ÿå·è¿™æ ·è¡¨ç¤ºçš„å‡½æ•°æ˜¯ç”Ÿæˆå™¨å‡½æ•°ï¼Œç±»å‹æ˜¯ JS_CLASS_GENERATORï¼Œç»“æ„ä½“æ˜¯ JSGeneratorDataï¼Œç”Ÿæˆå™¨å‡½æ•°ä¼šè¿”å›ä¸€ä¸ª generator å¯¹è±¡ã€‚ç”Ÿæˆå™¨å‡½æ•°ç”¨äº coroutineï¼Œå‡½æ•°å†…é€šè¿‡ yield è¯­å¥å¯ä»¥å°†å‡½æ•°æ‰§è¡Œæš‚åœï¼Œè®©å…¶ä»–å‡½æ•°å¯ä»¥æ‰§è¡Œï¼Œå†æ¬¡æ‰§è¡Œå¯ä»¥ä»æš‚åœå¤„ç»§ç»­æ‰§è¡Œã€‚</p>
<p>æœ€åå°±æ˜¯ big number çš„æ•°å€¼è¿ç®—ï¼ŒåŒ…æ‹¬ bigint_opsã€bigfloat_opsã€bigdecimal_opsã€‚</p>
<p>JS_NewRuntime å‡½æ•°å¯¹ JSRuntime å’Œ JSMallocState åˆå§‹åŒ–ä½¿ç”¨çš„æ˜¯ memset å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¸€èˆ¬æ˜¯å¯¹æ¯”è¾ƒå¤§äº›çš„ç»“æ„ä½“è¿›è¡Œåˆå§‹åŒ–ï¼Œå› ä¸ºæ˜¯ç›´æ¥æ“ä½œå†…å­˜ï¼Œæ‰€ä»¥å¾ˆå¿«ã€‚JS_NewRuntime å‡½æ•°ä½¿ç”¨çš„ JSMallocFunctions ç»“æ„ä½“æ¥è®°å½• JSMallocState åˆ†é…å†…å­˜çŠ¶æ€ã€‚ JSRuntime é‡Œç”¨ context_list è®°å½•æ‰€æœ‰çš„ä¸Šä¸‹æ–‡ï¼Œgc_obj_list è®°å½•åˆ†é…çš„ GC å¯¹è±¡ï¼Œåœ¨è°ƒç”¨ JS_FreeValueRT å‡½æ•°æ—¶å¦‚æœ JSValue çš„ tag æ˜¯å­—èŠ‚ç ï¼ŒåŒæ—¶ä¸åœ¨ GC æ¸…ç†å‘¨æœŸå†…æ—¶ï¼Œä¼šå°† GC å¯¹è±¡åŠ åˆ° gc_zero_ref_count_list é‡Œã€‚</p>
<p>æ¥ç€ JS_NewRuntime å‡½æ•°ä¼šè°ƒç”¨ JS_InitAtoms å‡½æ•°å»åˆå§‹åŒ– Atomï¼ŒåŒ…æ‹¬é‚£äº› js çš„å…³é”®å­—å’Œsymbolç­‰ã€‚QuickJS ä½¿ç”¨ include quickjs-atom.h æ–‡ä»¶æ–¹å¼å¯¼å…¥çš„ atomï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> &#123;</span></span><br><span class="line">    __JS_ATOM_NULL = JS_ATOM_NULL,</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DEF(name, str) JS_ATOM_ ## name,</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;quickjs-atom.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">undef</span> DEF</span></span><br><span class="line">    JS_ATOM_END,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç ä¸­çš„ JS_ATOM_END ä½œä¸ºæšä¸¾çš„æœ€åä¸€ä¸ªå€¼ï¼ŒåŒæ—¶èƒ½å¤Ÿè¡¨ç¤º atom çš„æ•°é‡ï¼Œatom è¿˜ä¼šè®°å½•åœ¨ js_atom_init[] é‡Œã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">char</span> js_atom_init[] =</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DEF(name, str) str <span class="meta-string">&quot;\0&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;quickjs-atom.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">undef</span> DEF</span></span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<p>å®šä¹‰æšä¸¾çš„ä½œç”¨å°±æ˜¯èƒ½å¤Ÿåœ¨ç¼–è¯‘æ—¶ç¡®å®š atom çš„æ•°é‡ï¼Œæ¯”åœ¨è¿è¡Œæ—¶é€šè¿‡è®¡ç®—æ•°ç»„æ•°é‡æ€§èƒ½æ¶ˆè€—å°‘ã€‚åœ¨ JS_InitAtoms å‡½æ•°é‡Œé€šè¿‡ JS_ATOM_END å°†éå† js_atom_init å‡½æ•°åˆå§‹åŒ–æ¯ä¸ª atomï¼Œjs_atom_init å‡½æ•°é‡Œä¼šå…ˆä½¿ç”¨ js_alloc_string_rt ä¸ºå­—ç¬¦ä¸²åˆ†é…å†…å­˜å°†å­—ç¬¦ä¸²æ‹·è´åˆ°ç©ºé—´å†…ï¼Œæœ€åè°ƒç”¨ <code>__JS_NewAtom</code> å‡½æ•°æ–°å»º atomã€‚</p>
<p>JS_NewRuntime å‡½æ•°æœ€åä¼šç”¨ init_class_range å‡½æ•°åˆ›å»ºå¯¹è±¡ã€æ•°ç»„å’Œå‡½æ•°ç±»ï¼Œæ¯ä¸ªç±»æ–°å»ºç”¨çš„æ˜¯ JS_NewClass1 å‡½æ•°ï¼Œè¿™é‡Œä¼šå®Œæˆ JSClass ç»“æ„ä½“çš„åˆå§‹åŒ–ï¼Œé‡ç½®ä¸Šä¸‹æ–‡ç±»åŸå‹æ•°ç»„å’Œç±»æ•°ç»„ã€‚é€šè¿‡ JSClassCall å’Œ JSClassExoticMethods æ¥è®¾ç½® JSClassã€‚JSClassCall ä¼šè°ƒç”¨ js_call_c_functionã€js_c_function_data_callã€js_call_bound_functionã€js_generator_function_callã€‚JSClassExoticMethods exotic æ˜¯å¤–æ¥è¡Œä¸ºçš„æŒ‡é’ˆï¼Œæ²¡æœ‰å¯ä»¥ä¸º NULLï¼ŒJS_NewRuntime å‡½æ•°ä¼šè®¾ç½® js_arguments_exotic_methodsã€js_string_exotic_methodsã€js_module_ns_exotic_methods ä¸‰ä¸ªè¡Œä¸ºã€‚</p>
<h3 id="æ–°å»ºä¸Šä¸‹æ–‡"><a href="#æ–°å»ºä¸Šä¸‹æ–‡" class="headerlink" title="æ–°å»ºä¸Šä¸‹æ–‡"></a>æ–°å»ºä¸Šä¸‹æ–‡</h3><p>JS_NewContext å‡½æ•°ä¼šé€šè¿‡ JS_NewContextRaw åˆå§‹åŒ–ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œå¹¶å°†ä¸Šä¸‹æ–‡ JSContext çš„ rt å­—æ®µï¼Œä¹Ÿå°±æ˜¯ JSRuntime ç»“æ„ä½“å­—æ®µæŒ‡å‘å…¥å‚ rtã€‚JSContext ç»“æ„ä½“é‡Œé¢åŒ…å«äº† GC å¯¹è±¡çš„ headerï¼ŒJSRuntimeï¼Œå¯¹è±¡æ•°é‡å’Œå¤§å°ï¼Œshapeçš„æ•°ç»„ï¼Œå…¨å±€å¯¹è±¡ global_obj å’Œå…¨å±€å˜é‡åŒ…æ‹¬å…¨å±€ let/const çš„å®šä¹‰ã€‚è·Ÿ big number ç›¸å…³çš„ bf_ctxï¼Œrt-&gt;bf_ctx æ˜¯æŒ‡é’ˆï¼Œå…±äº«æ‰€æœ‰ä¸Šä¸‹æ–‡ã€‚fp_env æ˜¯å…¨å±€ FP ç¯å¢ƒã€‚é€šè¿‡ bignum_ext æ¥æ§åˆ¶æ˜¯å¦å¼€å¯æ•°å­¦æ¨¡å¼ï¼Œall_operator_overload æ¥æ§åˆ¶æ˜¯å¦å¼€å¯ operator overloadingã€‚å½“è®¡æ•°å™¨ä¸º0åï¼ŒJSRuntime.interrupt_handler å°±ä¼šè¢«è°ƒç”¨ã€‚loaded_modules æ˜¯ JSModuleDef.link çš„åˆ—è¡¨ã€‚compile_regexp å‡½æ•°å¦‚æœè¿”å›çš„ JSValueæ˜¯ NULL è¡¨ç¤ºè¾“å…¥æ­£åˆ™è¡¨è¾¾å¼çš„æ¨¡å¼ä¸è¢«æ”¯æŒã€‚eval_internal å‡½æ•°å¦‚æœè¿”å› NULL è¡¨ç¤ºè¾“å…¥çš„å­—ç¬¦ä¸²æˆ–è€…æ–‡ä»¶ eval æ²¡æ³•æ‰§è¡Œã€‚</p>
<p>ä½¿ç”¨ JS_AddIntrinsicBasicObjects å‡½æ•°å¯¹ä¸Šä¸‹æ–‡åˆå§‹åŒ–å†…ç½®æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ã€‚JS_AddIntrinsicBaseObjects å‡½æ•°ä¼šå¾€å…¨å±€å¯¹è±¡ ctx-&gt;global_obj é‡Œæ·»åŠ æ ‡å‡†åº“çš„å¯¹è±¡ Objectã€å‡½æ•° Functionã€é”™è¯¯ Errorã€è¿­ä»£å™¨åŸå‹ã€æ•°ç»„ Arrayã€Numberã€å¸ƒå°”å€¼ Booleanã€å­—ç¬¦ä¸² Stringã€Mathã€ES6åå°„ã€ES6 symbolã€ES6 Generatorç­‰ï¼Œç„¶åå®šä¹‰å…¨å±€å±æ€§å’Œåˆå§‹åŒ–å‚æ•°ã€‚JS_AddIntrinsicDate å‡½æ•°ä¼šæ·»åŠ  Dateï¼ŒJS_AddIntrinsicEval ä¼šè®¾ç½®å†…éƒ¨ eval å‡½æ•°ä¸º <code>__JS_EvalInternal</code>ã€‚JS_AddIntrinsicStringNormalize å‡½æ•°ä¼šè®¾ç½®å±æ€§ normalizeã€‚</p>
<p>JS_AddIntrinsicRegExp å‡½æ•°ä¼šæ·»åŠ  æ­£åˆ™è¡¨è¾¾å¼åº“ RegExpã€‚JS_AddIntrinsicJSON å‡½æ•°ä¼šåœ¨å…¨å±€å¯¹è±¡ä¸­æ·»åŠ  JSON æ ‡å‡†åº“ã€‚JS_AddIntrinsicProxy å‡½æ•°ç”¨æ¥æ·»åŠ ä¸º js æä¾›å…ƒç¼–ç¨‹èƒ½åŠ›çš„ Proxyï¼Œç”¨æ¥è¿›è¡Œç›®æ ‡å¯¹è±¡æ‹¦æˆªã€è¿ç®—ç¬¦é‡è½½ã€å¯¹è±¡æ¨¡æ‹Ÿç­‰ã€‚</p>
<p>JS_AddIntrinsicMapSet å‡½æ•°ä¼šæ·»åŠ  Mapã€‚JS_AddIntrinsicTypedArrays ä¼šæ·»åŠ ç”± Lars T. Hansen è®¾è®¡çš„ SharedArrayBuffer å’Œ Atomicsï¼Œä¹Ÿå°±æ˜¯å…±äº«å†…å­˜å’ŒåŸå­ç‰¹æ€§ï¼Œè¯¥<a href="https://github.com/tc39/ecmascript_sharedmem">ææ¡ˆåœ¨è¿™</a> 17å¹´è¢« TC39 åˆå¹¶åˆ° ecma262 è§„èŒƒä¸­ï¼Œå…±äº«å†…å­˜å¯ä»¥è®©å¤šçº¿ç¨‹å¹¶å‘è¯»å†™æ•°æ®ï¼Œä½¿ç”¨åŸå­æ§åˆ¶å¹¶å‘ï¼Œåè°ƒæœ‰ç«äº‰å…³ç³»çº¿ç¨‹ï¼Œå…¶ç›®çš„å°±æ˜¯è®© web worker é—´å…±äº«æ•°æ®åè°ƒæ›´å¿«æ›´ç®€å•é¿å…å¹½çµæ¼æ´ã€‚</p>
<p>JS_AddIntrinsicPromise å‡½æ•°ä¼šæ·»åŠ  <a href="https://tc39.es/ecma262/#sec-promise-objects">Promise</a>ã€<a href="https://tc39.es/ecma262/#sec-async-function-objects">AsyncFunction</a> å’Œ <a href="https://tc39.es/ecma262/#sec-asyncgeneratorfunction-objects">AsyncGeneratorFunction</a></p>
<p>å¦‚æœå¼€å¯äº† big number JS_NewContext å‡½æ•°ä¼šè°ƒç”¨ JS_AddIntrinsicBigInt æ·»åŠ  BigInt æ¥æ”¯æŒç§‘å­¦è®¡ç®—ã€‚</p>
<h3 id="JS-Eval"><a href="#JS-Eval" class="headerlink" title="JS_Eval"></a>JS_Eval</h3><p>JS_Eval æ–¹æ³•å°±æ˜¯æ‰§è¡Œ JS è„šæœ¬çš„å…¥å£æ–¹æ³•ã€‚JS_Eval é‡Œè°ƒç”¨æƒ…å†µå¦‚ä¸‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JS_Eval -&gt; JS_EvalThis -&gt; JS_EvalInternal -&gt; eval_internal(__JS_EvalInternal)</span><br></pre></td></tr></table></figure>
<p>å®é™…èµ·ä½œç”¨çš„æ˜¯ <code>__JS_EvalInternal</code> å‡½æ•°ï¼Œå†…éƒ¨ä¼šå…ˆå£°æ˜æ•´ä¸ªè„šæœ¬è§£ææ¶‰åŠçš„å†…å®¹ï¼Œæ¯”å¦‚ JSParseState sã€å‡½æ•°å¯¹è±¡å’Œè¿”å›å€¼ fun_objã€æ ˆå¸§ sfã€å˜é‡æŒ‡é’ˆ var_refsã€å‡½æ•°å­—èŠ‚ç  bã€å‡½æ•° fdã€æ¨¡å— m ç­‰ã€‚é€šè¿‡å‡½æ•° js_parse_init æ¥è®¾ç½®åˆå§‹åŒ– JSParseStateã€‚æœ‰ä¸Šä¸‹æ–‡ ctxã€æ–‡ä»¶å filenameã€æ ¹æ®è¾“å…¥ input å­—ç¬¦ä¸²é•¿åº¦è®¾ç½®ç¼“å­˜å¤§å°å’Œåˆå§‹åŒ– token ç­‰ã€‚</p>
<p>js_parse_init å‡½æ•°æ‰§è¡Œå®Œåä¼šè¿‡æ»¤ Shebangï¼ŒShebang ä¸€èˆ¬æ˜¯ä¼šåœ¨ç±» Unix è„šæœ¬çš„ç¬¬ä¸€è¡Œï¼Œè§„åˆ™æ˜¯å¼€å¤´ä¸¤ä¸ªå­—ç¬¦æ˜¯#!ï¼Œä½œç”¨æ˜¯å‘Šè¯‰ç³»ç»Ÿå¸Œæœ›ç”¨ä»€ä¹ˆè§£é‡Šå™¨æ‰§è¡Œè„šæœ¬ï¼Œæ¯”å¦‚#!/bin/bash è¡¨ç¤ºå¸Œæœ›ç”¨ bash æ¥æ‰§è¡Œè„šæœ¬ã€‚åœ¨ QuickJS é‡Œæ˜¾ç„¶ Shebang èµ·ä¸äº†ä»€ä¹ˆç”¨ï¼Œå› æ­¤é€šè¿‡ skip_shebang å‡½æ•°è¿‡æ»¤æ‰ã€‚</p>
<p>eval_type è·å– eval çš„ç±»å‹ï¼Œeval çš„ type æœ‰å››ç§ï¼ŒJS_EVAL_TYPE_GLOBAL 00 è¡¨ç¤ºé»˜è®¤å…¨å±€ä»£ç ï¼ŒJS_EVAL_TYPE_MODULE 01 è¡¨ç¤ºæ¨¡å—ä»£ç ï¼ŒJS_EVAL_TYPE_DIRECT 10 è¡¨ç¤ºåœ¨ internal ç›´æ¥è°ƒç”¨ï¼ŒJS_EVAL_TYPE_INDIRECT 11 è¡¨ç¤ºåœ¨ internal éç›´æ¥è°ƒç”¨ã€‚eval çš„ flagæœ‰å››ç§ï¼ŒJS_EVAL_FLAG_STRICT 10xx è¡¨å¼ºè¡Œ strict æ¨¡å¼ï¼ŒJS_EVAL_FLAG_STRIP 100xx è¡¨å¼ºè¡Œ strip æ¨¡å¼ï¼ŒJS_EVAL_FLAG_COMPILE_ONLY 1000xx è¡¨ç¤ºä»…ç¼–è¯‘ä½†ä¸è¿è¡Œï¼Œè¿”å›æ˜¯ä¸€ä¸ªæœ‰ JS_TAG_FUNCTION_BYTECODE æˆ– JS_TAG_MODULE tag çš„å¯¹è±¡ï¼Œé€šè¿‡ JS_EvalFunction() å‡½æ•°æ‰§è¡Œã€‚JS_EVAL_FLAG_BACKTRACE_BARRIER 10000xx è¡¨ç¤ºåœ¨ Error å›æº¯ä¸­ä¸éœ€è¦ä¹‹å‰çš„å †æ ˆå¸§ã€‚</p>
<p><code>__JS_EvalInternal</code> å‡½æ•°ä½¿ç”¨ js_new_function_def å‡½æ•°åˆ›å»ºä¸€ä¸ªé¡¶å±‚çš„å‡½æ•°å®šä¹‰èŠ‚ç‚¹ï¼Œå…¶ç¬¬äºŒä¸ªå‚æ•°ä¸ºçˆ¶å‡½æ•°è®¾ç½®ä¸º NULLï¼Œåé¢å†è§£æå‡ºæ¥çš„å‡½æ•°éƒ½ä¼šæˆä¸ºä»–çš„å­å‡½æ•°ï¼Œjs_new_function_def ä¼šè¿”å›ä¸€ä¸ªåˆå§‹åŒ–çš„ JSFunctionDefã€‚JSFunctionDef çš„å­—æ®µ parent_scope_level æ˜¯å½“å‰å‡½æ•°åœ¨çˆ¶å±‚ä½œç”¨åŸŸçš„å±‚çº§ã€‚parent_cpool_idx æ˜¯å½“å‰å‡½æ•°åœ¨çˆ¶å±‚çš„å¸¸é‡æ± å­é‡Œç´¢å¼•ã€‚child_list æ˜¯å­å‡½æ•°åˆ—è¡¨ã€‚is_eval å¦‚æœä¸º true è¡¨ç¤ºå½“å‰å‡½æ•°ä»£ç æ˜¯ eval å‡½æ•°è°ƒç”¨çš„ã€‚is_global_var è¡¨ç¤ºå½“å‰å‡½æ•°æ˜¯å¦ä¸æ˜¯å±€éƒ¨çš„ï¼Œæ¯”å¦‚æ˜¯å…¨å±€çš„ï¼Œåœ¨ module ä¸­æˆ–é strictã€‚</p>
<p>has_home_object è¡¨ç¤ºå½“å‰å‡½æ•°æ˜¯å¦æ˜¯ home objectã€‚æ¯ä¸ªå‡½æ•°éƒ½æœ‰ä¸€ä¸ª slot ç”¨æ¥å­˜å‡½æ•°çš„ home objectï¼Œè¿™ä¸ª slot å¯ä»¥é€šè¿‡[[HomeObject]]è®¿é—®åˆ°ï¼Œhome object å°±æ˜¯å‡½æ•°çš„åˆå§‹å®šä¹‰ã€‚slot åªæœ‰åœ¨å‡½æ•°å®šä¹‰ä¸º class æˆ– object literals æ‰ä¼šè¢«è®¾ç½®ï¼Œå…¶ä»–æƒ…å†µä¼šè¿”å› undefinedã€‚å¦‚ä¸‹çš„å‡½æ•°å®šä¹‰ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ol = &#123; foo () &#123;&#125; &#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">c</span> </span>&#123; foo () &#123;&#125; &#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span> (<span class="params"></span>) </span>&#123;&#125;</span><br></pre></td></tr></table></figure><br>ä¸Šé¢çš„ f å‡½æ•°ä¼šç›´æ¥è¿”å› undefinedï¼Œc æ˜¯ classï¼Œol æ˜¯ object literalsï¼Œå½“ super æ–¹æ³•è¢«è°ƒç”¨æ—¶ä¼šæŸ¥çœ‹å½“å‰å‡½æ•°çš„[[HomeObject]]ï¼Œä»è€Œè·å–åŸå‹ï¼Œé€šè¿‡åŸå‹è°ƒç”¨åˆ° super æ–¹æ³•ã€‚</p>
<p>has_prototype æ˜¯æŒ‡å½“å‰å‡½æ•°æ˜¯å¦æœ‰ prototypeï¼Œclass éƒ½æœ‰ prototypeã€‚has_parameter_expressions æŒ‡æ˜¯å¦æœ‰å‚æ•°è¡¨è¾¾å¼ï¼Œå¦‚æœæœ‰å°±ä¼šåˆ›å»ºå‚æ•°ä½œç”¨åŸŸã€‚has_use_strict è¡¨ç¤ºæ˜¯å¦æ˜¯å¼ºåˆ¶æ¨¡å¼ã€‚has_eval_call è¡¨ç¤ºå‡½æ•°é‡Œæ˜¯å¦æœ‰è°ƒç”¨ eval å‡½æ•°ã€‚</p>
<p>has_arguments_binding æŒ‡å‡½æ•°æ˜¯å¦æœ‰å‚æ•°ç»‘å®šï¼Œå¦‚æœæœ‰å°±æ˜¯ç®­å¤´å‡½æ•°ã€‚ç®­å¤´å‡½æ•°æ˜¯ä½¿ç”¨ =&gt; å®šä¹‰å‡½æ•°ï¼Œå¦‚ä¸‹é¢ä»£ç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¸¦å‚æ•°</span></span><br><span class="line"><span class="keyword">var</span> foo = <span class="function"><span class="params">v</span> =&gt;</span> v</span><br><span class="line"><span class="comment">// å¯¹åº”å¦‚ä¸‹éç®­å¤´å‡½æ•°</span></span><br><span class="line"><span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span>(<span class="params">v</span>) </span>&#123; <span class="keyword">return</span> v &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ— å‚æ•°</span></span><br><span class="line"><span class="keyword">var</span> foo = <span class="function">() =&gt;</span> <span class="number">0</span></span><br><span class="line"><span class="comment">// å¯¹åº”å¦‚ä¸‹éç®­å¤´å‡½æ•°</span></span><br><span class="line"><span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="number">0</span> &#125;</span><br></pre></td></tr></table></figure>
<p>ç®­å¤´å‡½æ•°å†…çš„ this æ˜¯æŒ‡å®šä¹‰æ—¶çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯è¿è¡Œæ—¶çš„å¯¹è±¡ï¼Œä½¿ this ä»åŠ¨æ€å˜æˆé™æ€ã€‚ä¸èƒ½ä½¿ç”¨ new å‘½ä»¤ï¼Œä¸å¯ä»¥ç”¨ arguments å¯¹è±¡ï¼Œä½¿ç”¨ rest å‚æ•°ä»£æ›¿ï¼Œä¸å¯ä»¥ä½¿ç”¨ yieldã€‚</p>
<p>ç®­å¤´å‡½æ•°çš„æ„å›¾ä¸»è¦æ˜¯å¯ä»¥è®©è¡¨è¾¾æ›´ç®€æ´ï¼Œå¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸ç”¨ç®­å¤´å‡½æ•°</span></span><br><span class="line"><span class="keyword">var</span> sortedGroup = group.sort(<span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a - b;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ç®­å¤´å‡½æ•°</span></span><br><span class="line"><span class="keyword">var</span> sortedGroup = group.sort(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a - b);</span><br></pre></td></tr></table></figure>
<p>ç®­å¤´ç¬¦å·å‰é¢çš„å°æ‹¬å·å†…æ˜¯å‚æ•°ï¼Œä»£ç æ•´ä½“çœ‹èµ·æ¥ç®€æ´äº†å¾ˆå¤šã€‚</p>
<p>36å¹´å›¾çµå¼€å‘çš„æœ‰è®¡ç®—åŠŸèƒ½çš„æ•°å­¦æ¨¡å‹å«å›¾çµæœºï¼Œè€ŒåŒæœŸ Alan Church å¼€å‘çš„æ¨¡å‹å« Î» æ¼”ç®—ï¼ŒÎ» å°±æ˜¯ lambdaï¼ŒLisp å°±æ˜¯ç”¨ lambda æ¥è¡¨ç¤ºå‡½æ•°ï¼Œè‡³ä»Šå‡½æ•°è¡¨è¾¾å¼ä¹Ÿå« lambdaã€‚å› æ­¤ Î» æ¼”ç®—ç®—å¾—ä¸Šæœ€æ—©çš„ç¼–ç¨‹è¯­è¨€ã€‚ã€Š<a href="https://hacks.mozilla.org/2015/06/es6-in-depth-arrow-functions/">ES6 In Depth:Arrow functions</a>ã€‹åšå®¢é‡Œæåˆ° fixed point å‡½æ•°å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fix = Î»f.(Î»x.f(Î»v.x(x)(v)))(Î»x.f(Î»v.x(x)(v)))</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ fix å‡½æ•°å¯ä»¥ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fix = <span class="function"><span class="params">f</span> =&gt;</span> (<span class="function"><span class="params">x</span> =&gt;</span> f(<span class="function"><span class="params">v</span> =&gt;</span> x(x)(v)))</span><br><span class="line">               (<span class="function"><span class="params">x</span> =&gt;</span> f(<span class="function"><span class="params">v</span> =&gt;</span> x(x)(v)));</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç çœ‹èµ·æ¥æ›´åŠ ç®€æ´å’Œæ¸…æ™°ã€‚</p>
<p>ä½¿ç”¨å‡½æ•°å¼ç¼–ç¨‹è®¾è®¡ä¸º js æä¾›äº†ç±»ä¼¼ eachã€mapã€reduceã€filter ç­‰ä½¿ç”¨åŠŸèƒ½çš„è‘—å<a href="http://underscorejs.org/">underscorejs</a> ï¼Œå°±æ˜¯é‡åº¦ä½¿ç”¨äº†ç®­å¤´å‡½æ•°ï¼Œä»¥ç®€åŒ– underscorejs çš„ä½¿ç”¨æ¥å£ã€‚</p>
<p>å®Œæ•´çš„ç®­å¤´å‡½æ•°å®šä¹‰å‚çœ‹ ecma262 <a href="https://tc39.es/ecma262/#sec-arrow-function-definitions">Arrow Function Definitions</a> éƒ¨åˆ†ã€‚</p>
<p>has_this_binding æŒ‡å‡½æ•°é‡Œæ˜¯å¦å¯ä»¥ç”¨ new.targetã€‚new_target_allowed æŒ‡ new.target çš„è¿”å›æ˜¯æŒ‡å‘æ„é€ æ–¹æ³•ï¼Œå› æ­¤å¦‚æœæ²¡æœ‰ new.target è¡¨ç¤ºåªæ˜¯æ™®é€šçš„å‡½æ•°ã€‚super_call_allowed æŒ‡å‡½æ•°æ˜¯å¦å¯è°ƒç”¨ super å‡½æ•°ï¼Œæ„é€ å‡½æ•°é‡Œè°ƒç”¨çˆ¶ç±»æ„é€ å™¨ã€‚super_allowed è¡¨ç¤ºå‡½æ•°æ˜¯å¦å¯ä»¥ç”¨ super æˆ– super[]ï¼Œç±»çš„ method å¯ä»¥è°ƒï¼Œæ™®é€šçš„å‡½æ•°ä¸èƒ½è°ƒã€‚arguments_allowed è¡¨ç¤ºå½“å‰å‡½æ•°æ˜¯å¦å¯ä»¥ä½¿ç”¨ argumentsï¼Œç®­å¤´å‡½æ•°ä¸èƒ½ä½¿ç”¨ argumentsã€‚argumentså’Œå‰©ä½™å˜é‡åŒºåˆ«åœ¨å‰©ä½™å˜é‡æ˜¯ä¸ªæ•°ç»„ï¼Œargumentséœ€è¦é€šè¿‡ Array.prototype.slice.call å‡½æ•°è½¬æˆçœŸæ­£çš„æ•°ç»„ã€‚is_derived_class_constructor è¡¨ç¤ºå½“å‰å‡½æ•°æ˜¯å¦ä¸ºæ´¾ç”Ÿå‡½æ•°ï¼Œç»§æ‰¿è‡ªå…¶ä»–ç±»çš„ç±»å«æ´¾ç”Ÿç±»ã€‚in_function_body æ˜¯çœ‹å‡½æ•°æ˜¯å¦æ˜¯åœ¨å‡½æ•°çš„ body é‡Œå®šä¹‰çš„ï¼Œå¦‚æœæ˜¯ false è¡¨ç¤ºå‡½æ•°å¯èƒ½æ˜¯åœ¨å‚æ•°é‡Œå®šä¹‰ã€‚func_name æ˜¯å‡½æ•°åï¼Œå¦‚æœæ²¡æœ‰å‡½æ•°å func_name ä¸º JS_ATOM_NULLã€‚vars æ˜¯å‡½æ•°é‡Œå®šä¹‰çš„å˜é‡åˆ—è¡¨ã€‚var_size æ˜¯ç»™å˜é‡åˆ—è¡¨åˆ†é…çš„ç©ºé—´å¤§å°ã€‚var_count æ˜¯å˜é‡çš„æ•°é‡ã€‚args æ˜¯å‡½æ•°å‚æ•°çš„åˆ—è¡¨ã€‚arg_size æ˜¯ç»™å‚æ•°åˆ—è¡¨åˆ†é…çš„ç©ºé—´å¤§å°ã€‚arg_count æ˜¯å‚æ•°çš„ä¸ªæ•°ã€‚defined_arg_count è¡¨ç¤ºå‡½æ•°æœŸæœ›çš„å‚æ•°æ•°ï¼Œä¹Ÿå°±æ˜¯å®é™…ä¼ é€’ç»™å‡½æ•°çš„å‚æ•°ï¼Œæ¯”å¦‚æœ‰é»˜è®¤å€¼çš„å‚æ•°å°±ä¸ä¼šè®¡ç®—åœ¨å†…ã€‚arguments_var_idx æ˜¯ arguments å˜é‡åœ¨å‡½æ•°å˜é‡åˆ—è¡¨é‡Œçš„ç´¢å¼•ã€‚func_var_idx æ˜¯å½“å‰å‡½æ•°åœ¨å‡½æ•°å˜é‡åˆ—è¡¨é‡Œçš„ç´¢å¼•ã€‚eval_ret_idx æ˜¯å½“å‰å‡½æ•°è¿”å›å€¼åœ¨å‡½æ•°å˜é‡åˆ—è¡¨é‡Œçš„ç´¢å¼•ã€‚this_var_idx æŒ‡ this åœ¨å‡½æ•°å˜é‡åˆ—è¡¨é‡Œçš„ç´¢å¼•ã€‚new_target_var_idx æ˜¯åŒ…å« new.target çš„å˜é‡åœ¨å‡½æ•°å˜é‡åˆ—è¡¨é‡Œçš„ç´¢å¼•ã€‚this_active_func_var_idx æ˜¯åŒ…å« this.active_func å˜é‡åœ¨å‡½æ•°å˜é‡åˆ—è¡¨é‡Œçš„ç´¢å¼•ã€‚home_object_var_idx æ˜¯ home object å˜é‡åœ¨å‡½æ•°å˜é‡åˆ—è¡¨é‡Œçš„ç´¢å¼•ï¼Œä½¿ç”¨è¿™ä¸ªç´¢å¼•å¯ä»¥å–åˆ°çˆ¶å‡½æ•°ã€‚scope_level æ˜¯å½“å‰å‡½æ•°ä½œç”¨åŸŸå±‚çº§ï¼Œä¹Ÿå°±æ˜¯ fd-&gt;scopes çš„ç´¢å¼•ã€‚scope_first æ˜¯ç¬¬ä¸€ä¸ªä½œç”¨åŸŸã€‚scope_size æ˜¯ä¸ºå‡½æ•°å¤šä¸ªä½œç”¨åŸŸåˆ†é…çš„å¤§å°ã€‚scope_count æŒ‡ä¸€å…±æœ‰å¤šå°‘ä¸ªä½œç”¨åŸŸã€‚scopes æŒ‡å½“å‰å‡½æ•°æ‰€æœ‰ä½œç”¨åŸŸçš„æ•°ç»„ã€‚body_scope æ˜¯å‡½æ•° body çš„ä½œç”¨åŸŸã€‚byte_code æ˜¯å‡½æ•°çš„å­—èŠ‚ç ã€‚last_opcode_pos æ˜¯æœ€åä¸€ä¸ªå­—èŠ‚ç æ“ä½œç¬¦ã€‚last_opcode_line_num æ˜¯æœ€åä¸€ä¸ªå­—èŠ‚ç æ“ä½œç¬¦æ‰€åœ¨è¡Œæ•°ã€‚cpool æ˜¯å®šä¹‰å¸¸é‡çš„æ± å­ï¼Œæ¯”å¦‚å­—ç¬¦ä¸²ã€æ•°å­—ã€å¯¹è±¡ã€æ•°ç»„ç­‰ã€‚closure_var_count æ˜¯é—­åŒ…çš„æ•°é‡ã€‚closure_var_size æ˜¯é—­åŒ…çš„å¤§å°ã€‚closure_var é—­åŒ…éƒ½æ”¾åœ¨è¿™ä¸ªæ•°ç»„é‡Œã€‚filename æŒ‡å‡½æ•°æ‰€åœ¨çš„æ–‡ä»¶çš„æ–‡ä»¶åã€‚line_num æ˜¯å‡½æ•°çš„è¡Œæ•°ã€‚pc2line è¡¨ç¤ºä»£ç è¡Œå·ã€‚source æ˜¯å‡½æ•°æºç ã€‚source_len æ˜¯æºæ–‡ä»¶å¤§å°ã€‚module ä¹Ÿä¼šå½“ä½œå‡½æ•°ä¸€æ ·å¤„ç†ã€‚</p>
<h3 id="åˆ›å»ºé¡¶çº§å‡½æ•°å®šä¹‰"><a href="#åˆ›å»ºé¡¶çº§å‡½æ•°å®šä¹‰" class="headerlink" title="åˆ›å»ºé¡¶çº§å‡½æ•°å®šä¹‰"></a>åˆ›å»ºé¡¶çº§å‡½æ•°å®šä¹‰</h3><p>js_new_function_def ä¼šé€šè¿‡è¿è¡Œ JS_NewAtom å‡½æ•°ï¼Œæ¥è¿”å›ä¸€ä¸ªæ–‡ä»¶å JSAtomã€‚JS_NewAtom å‡½æ•°è°ƒç”¨é“¾å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JS_NewAtom -&gt; JSNewAtomLen -&gt; JS_NewAtomStr -&gt; __JS_NewAtom</span><br></pre></td></tr></table></figure>
<p>JSAtom æ˜¯ uint32_t ç±»å‹æ•´æ•°ï¼Œç”¨æ¥è®°å½•å…³é”®å­—ç­‰å­—ç¬¦ä¸²ï¼Œä½œç”¨æ˜¯æé«˜å­—ç¬¦ä¸²å†…å­˜å ç”¨å’Œä½¿ç”¨çš„æ•ˆç‡ã€‚JSAtom çš„ç±»å‹æœ‰ JS_ATOM_TYPE_STRINGã€JS_ATOM_TYPE_GLOBAL_SYMBOLã€JS_ATOM_TYPE_SYMBOLã€JS_ATOM_TYPE_PRIVATEã€‚JS_NewRuntime å‡½æ•°æ‰§è¡Œæ—¶ä¼šæŠŠ quickjs-atom.h é‡Œå®šä¹‰çš„ JS å…³é”®å­—æ¯”å¦‚ ifã€newã€tryç­‰ï¼Œä¿ç•™å­—æ¯”å¦‚ classã€enumã€import ç­‰ï¼Œæ ‡è¯†ç¬¦ nameã€getã€string ç­‰åŠ åˆ°å†…å­˜ä¸­ï¼Œè§£æä¸­åŠ çš„ä¼šæŒ‰éœ€ä½¿ç”¨ã€‚å­—ç¬¦ä¸²è½¬ JSAtom æ˜¯é€šè¿‡ <code>__JS_NewAtom</code> å‡½æ•°æ¥åšçš„ï¼Œ<code>__JS_NewAtom</code> å‡½æ•°ä¼šå…ˆå°è¯•çœ‹å·²æ³¨å†Œçš„ atom é‡Œæ˜¯å¦å·²ç»æœ‰å¯¹åº”çš„å­—ç¬¦ä¸²ï¼Œæ²¡æœ‰å°±æ ¹æ®å®šä¹‰çš„è§„åˆ™ç®—å‡ºå­—ç¬¦ä¸²çš„ hash å€¼ iï¼Œç„¶åæŠŠå­—ç¬¦ä¸²æŒ‡é’ˆåŠ åˆ° JSAtomStruct ç±»å‹çš„ atom_array é‡Œã€‚</p>
<p>å¦‚æœå·²ç»æœ‰ç›¸åŒçš„ atom åœ¨ atom_array é‡Œï¼Œgoto åˆ° done labelé‡Œï¼ŒC è¯­è¨€ä¸­çš„ goto è¯­å¥æ˜¯ä¸€ç§æŠŠæ§åˆ¶æ— æ¡ä»¶è½¬ç§»åˆ°åŒå‡½æ•°å†…labelå¤„çš„è¯­å¥ã€‚æˆ‘è§‰å¾—ä½¿ç”¨ goto ä¸»è¦æ˜¯ä¸ºäº†å‡å°‘å¤šä¸ª return çš„æƒ…å†µï¼Œç‰¹åˆ«æ˜¯é€»è¾‘å¤šï¼Œæœ€åéœ€è¦è¿›è¡Œç»Ÿä¸€å¤„ç†æ—¶ï¼Œä»£ç ä¸Šçœ‹èµ·æ¥ä¼šæ›´é¡ºï¼ŒæŒ‰é¡ºåºè¯»ï¼Œå¯è¯»æ€§ä¼šå¥½ã€‚<code>__JS_NewAtom</code> å‡½æ•°å‡ºç°å¼‚å¸¸å°±ä¼š goto åˆ° fail labelä¸­ï¼Œå°† i è®¾ç½®ä¸º JS_ATOM_NULL ç±»å‹ã€‚done labelä¼šæ‰§è¡Œ js_free_string å‡½æ•°ï¼Œè°ƒç”¨çš„æ˜¯ JS_FreeAtomStruct å‡½æ•°ï¼Œç›®çš„æ˜¯ä» atom_array é‡Œç§»å‡º atomï¼Œè¿‡ç¨‹æ˜¯å…ˆä»é“¾è¡¨ä¸­ç§»å‡º atom ç„¶ååœ¨ atom_array é‡Œå°†å…¶æ ‡è®°ä¸ºç©ºé—²ï¼Œè¿™æ ·æ–°åŠ çš„ atom å°±å¯ä»¥æ”¾ç½®åˆ°è¿™ä¸ªä½ç½®ã€‚</p>
<p>å­—ç¬¦ä¸²å­˜å‚¨çš„ç»“æ„æ˜¯ JSStringï¼Œascii ä¼šå­˜æ”¾åœ¨ JSString çš„ union ä¸­ str8 ä¸­ã€‚åœ¨ JS_NewAtomLen å‡½æ•°é‡Œä¼šå…ˆå°†å­—ç¬¦ä¸²é€šè¿‡ JS_NewStringLen è½¬æˆ JSValueï¼Œç„¶åé€šè¿‡å® JS_VALUE_GET_STRING å°†å…¶è½¬æˆ JSStringã€‚</p>
<p>æœ€å <code>__JS_NewAtom</code> å‡½æ•°ä¼šå¯¹ atom_array åšäº›è¾¹ç•Œå¤„ç†ã€‚</p>
<p>js_new_function_def å‡½æ•°æ‰§è¡Œå®Œåˆ›å»ºäº†é¡¶çº§å‡½æ•°å®šä¹‰åï¼Œä¼šåšä¸ªåˆ¤æ–­ï¼Œå¦‚æœåˆ›å»ºå¤±è´¥ä¼šç›´æ¥ä½¿ç”¨ goto è¯­æ³•è·³è½¬åˆ°<br>fail1 labelå¤„ï¼Œfail1 labelä¼šé‡Šæ”¾æ‰€æœ‰ JSModuleDefã€‚</p>
<p>å¦‚æœæ²¡æœ‰å¤±è´¥ <code>__JS_EvalInternal</code> å‡½æ•°ä¼šå…ˆå°† JSParseState çš„å½“å‰å‡½æ•°è®¾ç½®ä¸º js_new_function_def åˆ›å»ºçš„å‡½æ•° fdã€‚ç„¶åå¯¹ fd è¿›è¡Œå­—æ®µçš„è®¾ç½®ã€‚ä½¿ç”¨ push_scope ç”Ÿæˆä¸€ä¸ªä½œç”¨åŸŸï¼Œåé¢è§£æçš„å†…å®¹ä¼šæ”¾åˆ°è¿™ä¸ªä½œç”¨åŸŸå†…ã€‚æ¥ä¸‹æ¥å°±å¼€å§‹æ‰§è¡Œè§£æå‡½æ•° js_parse_programï¼Œå…¥å‚æ˜¯ JSParseState ç±»å‹çš„ sï¼Œs è®°å½•ç€ fdï¼Œç”¨æ¥ä½œä¸ºè§£æå†…å®¹çš„è¾“å…¥ã€‚</p>
<h3 id="js-è§£æå’Œç”Ÿæˆå­—èŠ‚ç "><a href="#js-è§£æå’Œç”Ÿæˆå­—èŠ‚ç " class="headerlink" title="js è§£æå’Œç”Ÿæˆå­—èŠ‚ç "></a>js è§£æå’Œç”Ÿæˆå­—èŠ‚ç </h3><p>js_parse_program å‡½æ•°ä¼šå…ˆè°ƒç”¨ next_token è·å–ä¸€ä¸ª token åˆ°ä¼ å…¥çš„ JSParseState é‡Œã€‚æ¥ç€é€šè¿‡ js_parse_directives æ¥è§£æ use strict æŒ‡ä»¤ã€‚å¦‚æœåœ¨æ¨¡å—å¤´éƒ¨åŠ ä¸Šäº† use strict æŒ‡ä»¤ï¼Œè¡¨ç¤º ES æ¨¡å—éœ€è¦ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼ã€‚ä¸¥æ ¼æ¨¡å¼ä¼šå¯¹ä¸€äº›è¯­æ³•åšé™åˆ¶ï¼Œå…·ä½“å¯ä»¥å‚çœ‹ ecma262 é‡Œ <a href="https://tc39.es/ecma262/#sec-strict-mode-of-ecmascript">The Strict Mode of ECMAScript</a> è¯´æ˜ã€‚ç„¶å js_parse_program å‡½æ•°ä¼šä¸€ç›´è°ƒç”¨ js_parse_source_element å‡½æ•°ç›´åˆ°è¿”å›çš„ token æ˜¯ TOK_EOFï¼ˆæ–‡ä»¶ç»“æŸç¬¦ï¼‰ä¸ºæ­¢ã€‚</p>
<p>å¯¹äºä¸€ä¸ª JS è„šæœ¬é‡Œçš„ä»£ç ï¼Œå¯ä»¥åˆ†ä¸ºå››ä¸ªç§ç±»ï¼Œä¸€ç§æ˜¯è¡¨è¾¾å¼å£°æ˜ï¼Œä½¿ç”¨ js_parse_statement_or_decl å‡½æ•°è§£æï¼Œè§£æç±»ä¼¼ ifã€while è¿™æ ·è¯­å¥ã€‚ä¸€ç§æ˜¯å‡½æ•°å£°æ˜ï¼Œä½¿ç”¨js_parse_function_decl å‡½æ•°è§£æï¼Œå¦å¤–ä¸¤ç§æ˜¯ exportï¼Œä½¿ç”¨ js_parse_export è§£ææ¨¡å—å¯¼å‡º å’Œ importï¼Œä½¿ç”¨ js_parse_import è§£ææ¨¡å—å¯¼å…¥ã€‚js_parse_source_element å‡½æ•°æ ¹æ®æ¯ä¸ª token çš„ç§ç±»é€‰æ‹©ä¸åŒçš„å‡½æ•°è¿›è¡Œè§£æã€‚</p>
<p>js_parse_export å‡½æ•°å’Œ js_parse_import å‡½æ•°è§£ææ¨¡å—çš„ä¸¤ä¸ªä¸»è¦åŠŸèƒ½ï¼Œå…¶ä¸­ export ä¸»è¦æ˜¯è´Ÿè´£å®šä¹‰æ¨¡å—å¯¹å¤–éƒ¨çš„æ¥å£ï¼Œimport ä¸»è¦æ˜¯è´Ÿè´£æ¥å—å¤–éƒ¨æ¨¡å—çš„æ¥å£ä»¥ä¾›è°ƒç”¨ã€‚JS çš„ä¸€ä¸ªæ¨¡å—å¦‚æœæƒ³è®©å…¶ä»–æ¨¡å—ä½¿ç”¨å…¶å†…éƒ¨çš„å˜é‡ã€å‡½æ•°å’Œç±»å°±éœ€è¦ä½¿ç”¨ export å‘½ä»¤ï¼Œæ¯”å¦‚åœ¨æŸä¸ªjsæ–‡ä»¶ä¸­å®šä¹‰å¯è¢«å…¶ä»–æ¨¡å—è®¿é—®çš„æ•°æ®çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> aExportVar = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> anotherExportVar = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">export</span> &#123;anotherExportVar&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç ä¸­ aExportVarã€anotherExportVar å˜é‡å’Œ foo å‡½æ•° éƒ½èƒ½è¢«å…¶ä»–æ¨¡å—è¯»å–ã€‚å¦‚æœæƒ³é‡å‘½åå¯¼å‡ºï¼Œå¯ä»¥ä½¿ç”¨ as å…³é”®å­—ï¼Œæ¯”å¦‚ export {a as b}ã€‚å¦‚æœæƒ³éƒ½å¯¼å‡ºå¯ä»¥ç”¨ export * from â€œmodâ€ï¼Œåœ¨ js_parse_export å‡½æ•°è§£æä¸­ï¼Œå¯¹äºç±»ã€å‡½æ•°ã€å¤§æ‹¬å·ã€fromã€varã€letã€constã€asç­‰æ¶‰åŠ export çš„å…³é”®å­—å‡æœ‰å¤„ç†ï¼Œè§£æè§„åˆ™å‚çœ‹ ecma262 çš„ <a href="https://tc39.es/ecma262/#sec-exports">Exports</a> éƒ¨åˆ†ï¼Œå…³äº default è¿™ç§ export å’Œ import çš„å¤åˆå†™æ³•ææ¡ˆ <a href="https://github.com/tc39/proposal-export-default-from">export default from</a>ï¼Œåœ¨ QuickJS é‡Œä¹Ÿå¾—åˆ°äº†æ”¯æŒï¼Œåœ¨ js_parse_export å‡½æ•°çš„ TOK_DEFAULT æ¡ä»¶å¤„ç†é‡Œå¯ä»¥çœ‹åˆ°ã€‚è§£æçš„ export æ•°æ®ä¼šé€šè¿‡ add_export_entry è¿”å›ä¸€ä¸ª JSExportEntry å¹¶æ”¾åˆ° JSModuleDef çš„ export_entries æ•°ç»„ä¸­è®°å½•ã€‚</p>
<p>import ä¼šå°†æ¨¡å— export å®šä¹‰è¾“å‡ºçš„æ¥å£åŠ è½½åˆ°è‡ªå·±çš„æ¨¡å—ä¸­ï¼Œè§„åˆ™å¯å‚çœ‹ TC39 çš„ <a href="https://tc39.es/ecma262/#sec-imports">Import</a>ï¼Œä¸ºäº†æ”¯æŒ import å‡½æ•°èƒ½å¤Ÿæ”¯æŒåŠ¨æ€åŠ è½½ï¼ŒTC39 merge äº† <a href="https://github.com/tc39/proposal-dynamic-import">Dynamic import</a> è¿™ä¸ªææ¡ˆï¼ŒDynamic Import é…åˆ webpack çš„ä»£ç åˆ†å‰²å®ç°å¼‚æ­¥æ‡’åŠ è½½ï¼Œå¯¹äºé¡µé¢åŠ è½½æ€§èƒ½æ˜¯ä¸ªå¾ˆå¥½çš„æ–¹æ¡ˆã€‚js_parse_import å‡½æ•°ä¼šå°† import æ¨¡å—é€šè¿‡ add_import å‡½æ•°å°† import æ•°æ®è½¬æˆ JSImportEntry æ·»åŠ åˆ° JSModuleDef çš„ import_entries æ•°ç»„ä¸­ã€‚</p>
<p>æ¥ä¸‹æ¥çœ‹ä¸‹ç¬¬ä¸‰ç§ï¼Œå‡½æ•°å®šä¹‰è§£æå‡½æ•° js_parse_function_declã€‚js_parse_function_decl å†…æ˜¯æ‰§è¡Œçš„ js_parse_function_decl2 å‡½æ•°ã€‚js_parse_function_decl2 å‡½æ•°ä¼šä¾æ® JSParseFunctionEnum æšä¸¾å€¼ func_type è¿›è¡Œä¸åŒçš„è§£æå’Œå­—èŠ‚ç ç”Ÿæˆï¼Œç”Ÿæˆçš„å­—èŠ‚ç çš„å‡½æ•°æ˜¯å‰ç¼€ä¸º emit çš„å‡½æ•°ï¼Œå­—èŠ‚ç ä¼šå­˜åœ¨ JSParseState çš„å½“å‰å‡½æ•° cur_func çš„ byte_code å­—æ®µä¸­ã€‚func_type æœ‰ statementã€varã€exprã€arrowã€getterã€setterã€methodã€ç±»çš„æ„é€ å‡½æ•°ã€æ´¾ç”Ÿç±»çš„æ„é€ å‡½æ•°ã€‚å…¶ä¸­ statementã€varã€exprã€arrow ç±»å‹éƒ½æ˜¯åŒ¿åå‡½æ•°ã€‚</p>
<p>åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œå°† s-&gt;cur_func ä½œä¸ºå…¶çˆ¶å‡½æ•°ï¼Œé€šè¿‡ s-&gt;cur_func = fd; å°† JSParseState çš„å½“å‰å‡½æ•°è®¾ç½®ä¸ºæ–°åˆ›å»ºçš„ JSFunctionDefï¼Œä»¥æ­¤èƒ½å¤Ÿç”Ÿæˆå‡½æ•°å®šä¹‰æ ‘ç»“æ„ã€‚ç„¶åå¼€å§‹è§£æå‚æ•°ï¼Œå‚æ•°é€šè¿‡ add_arg å‡½æ•°æ·»åŠ åˆ° fd çš„ args æ•°ç»„ä¸­ã€‚å°æ‹¬å·å†…çš„å‚æ•°é€šè¿‡ js_parse_expect(s, â€˜(â€˜) å‡½æ•°èµ·å§‹ï¼Œåœ¨ while (s-&gt;token.val != â€˜)â€™) é—­åŒ…å†…è§£æã€‚å°æ‹¬å·å†…å¦‚æœ‰ä¸­æ‹¬å·å’Œå¤§æ‹¬å·ï¼Œä¹Ÿå°±æ˜¯æœ‰æ•°ç»„å’Œå¯¹è±¡çš„æƒ…å†µå°±ä½¿ç”¨ js_parse_destructuring_element å‡½æ•°è¿›è¡Œè§£æï¼Œç”±äºå¯¹è±¡å’Œæ•°ç»„ä¼šå‡ºç°åœ¨å„ç§ js çš„è¯­æ³•ä¸­ï¼Œæ‰€ä»¥å°†å…¶å¤„ç†åŒ…è£…æˆäº†ä¸€ä¸ªé€šç”¨çš„é€’å½’å‡½æ•° js_parse_destructuring_element ç”¨æ¥ç®€åŒ–å†™æ³•ã€‚</p>
<p>è®¾ç½®å®Œå‚æ•°å˜é‡ä½œç”¨åŸŸåï¼Œå°±å¼€å§‹å‡½æ•° body çš„è§£æã€‚å¦‚æœæ˜¯ç®­å¤´å‡½æ•°ï¼ŒQuickJS ä¼šç‰¹æ®Šå¤„ç†ï¼Œå¹¶åœ¨å¤„ç†å®Œç›´æ¥ goto åˆ° done labelã€‚js_parse_function_decl2 å‡½æ•°å¯¹äºç®­å¤´å‡½æ•°ä¼šç”¨ä¸¤ä¸ªå‡½æ•°å…ˆåšæ£€æŸ¥ï¼Œä¸€ä¸ªæ˜¯æ£€æŸ¥å‡½æ•°åå‡½æ•° js_parse_function_check_namesï¼Œå¦‚æœæœ‰å‡½æ•°åå°±ç›´æ¥ goto åˆ° fail labelã€‚å¦ä¸€ä¸ªæ£€æŸ¥å‡½æ•°æ˜¯ js_parse_assign_expr èµ‹å€¼è¡¨è¾¾å¼è§£æå‡½æ•°ï¼Œæ¯”å¦‚ = æˆ– += è¿™æ ·çš„ç¬¦å·ï¼Œå¦‚æœç®­å¤´å‡½æ•°åé¢æ˜¯èµ‹å€¼è¡¨è¾¾å¼ï¼Œé‚£ä¹ˆä¹Ÿä¼šç›´æ¥ goto åˆ° failã€‚å¦‚ç®­å¤´å‡½æ•°è§„åˆ™ç¬¦åˆï¼Œä¼šä½¿ç”¨ emit_op ç”Ÿæˆ OP_return å­—èŠ‚ç æ“ä½œç¬¦ï¼Œå¹¶ç”¨å°†æºç ä¿å­˜åœ¨ fd-&gt;source é‡Œã€‚</p>
<p>ä¸æ˜¯ç®­å¤´å‡½æ•°å°±åœ¨å¤§æ‹¬å·å†…æ‰§è¡Œé€’å½’å‡½æ•° js_parse_source_element è§£æè¡¨è¾¾å¼å’Œå­å‡½æ•°ï¼Œå½¢æˆå®Œæ•´çš„å‡½æ•°å®šä¹‰æ ‘ç»“æ„ã€‚é€’å½’è°ƒç”¨ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (s-&gt;token.val != <span class="string">&#x27;&#125;&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (js_parse_source_element(s))</span><br><span class="line">        goto fail;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®Œæˆåä¹Ÿä¼šä¿å­˜æºç åˆ° JSFunctionDef çš„ source å­—æ®µé‡Œã€‚eat } ç¬¦å·å js_parse_function_decl2 å‡½æ•°ä¼š goto åˆ° failã€‚æ— è®ºæ˜¯ done labelè¿˜æ˜¯ fail labeléƒ½ä¼šå°† cur_func è®¾ç½®ä¸ºçˆ¶å‡½æ•°ï¼Œå›åˆ°çˆ¶å‡½æ•°é‡Œç»§ç»­è§£æåé¢çš„ä»£ç ã€‚</p>
<p>æœ€åç¬¬å››ç§ï¼Œjs_parse_statement_or_decl å£°æ˜å’Œè¡¨è¾¾å¼è§£æå‡½æ•°ã€‚</p>
<p>js_parse_statement_or_decl å‡½æ•°ä¸»è¦ä¾æ® token çš„å€¼ç±»å‹æ¥åˆ†åˆ«è°ƒç”¨å¯¹åº”çš„è§£æå‡½æ•°ã€‚token çš„å€¼æ˜¯å¤§æ‹¬å·æ—¶ä¼šè°ƒç”¨ js_parse_block è§£æã€‚return ä¼šçœ‹ä¸‹ä¸€ä¸ª token çš„å€¼ï¼Œå¦‚æœä¸æ˜¯ ;ã€}ï¼Œé‚£ä¹ˆå°±ä¼šè°ƒç”¨ js_parse_expr å‡½æ•°ã€‚throw ä¹Ÿä¼šè°ƒç”¨ js_parse_exprï¼Œå¦‚æœæ²¡æœ‰è¡¨è¾¾å¼å°±æ·»åŠ  OP_throw å­—èŠ‚ç æ“ä½œç¬¦ã€‚</p>
<p>letã€constã€var éƒ½ä¼šè°ƒç”¨ js_parse_var å‡½æ•°è§£æã€‚js_parse_var å¤„ç†ç­‰å·å³ä¾§ä½¿ç”¨çš„æ˜¯ js_parse_assign_expr2 å‡½æ•°æ¥è§£æèµ‹å€¼è¡¨è¾¾å¼ï¼Œå…¶ä¸­ä¼šä½¿ç”¨ js_parse_cond_expr æ¥è§£æé—®å·å’Œå†’å·è¿™æ ·çš„æ¡ä»¶è¿ç®—ç¬¦ï¼Œè§£æ ?: è¡¨è¾¾å¼ï¼Œ?: è¿ç®—ç¬¦æ˜¯ä¸‰å…ƒè¿ç®—ç¬¦ï¼Œæ¡ä»¶ä¸ºçœŸæ‰§è¡Œ ? åé¢è¡¨è¾¾å¼ï¼Œä¸ºå‡æ‰§è¡Œ : åé¢è¡¨è¾¾å¼ï¼Œè§„åˆ™å‚çœ‹ <a href="https://tc39.es/ecma262/#sec-conditional-operator">Condition Operator</a>ï¼Œå†’å·éƒ¨åˆ†ä½¿ç”¨çš„æ˜¯ Coalesce è¡¨è¾¾å¼è§£æå‡½æ•° js_parse_coalesce_exprï¼Œè§£æ ?? è¡¨è¾¾å¼ï¼Œ?? è¿ç®—ç¬¦æ˜¯éç©ºè¿ç®—ç¬¦ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯ null æˆ– undefinedï¼Œé‚£ä¹ˆå°±ä¼šè¿”å›ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä¸ç„¶å°±è¿”å›ç¬¬äºŒä¸ªå‚æ•°ã€‚ä¸æˆ–ä½¿ç”¨ js_parse_logical_and_or å‡½æ•°è§£æ &amp;&amp; æˆ– || è¿™æ ·è¡¨è¾¾å¼ï¼ŒäºŒå…ƒè¡¨è¾¾å¼ä½¿ç”¨ js_parse_expr_binary å‡½æ•°ï¼Œè§£æ * + == ç­‰è¡¨è¾¾å¼ï¼Œ ä¸€å…ƒä½¿ç”¨ js_parse_unary å‡½æ•°ï¼Œæ¯”å¦‚ + ! ç­‰ã€‚å¦‚æœèµ‹å€¼æ˜¯å­—ç¬¦ä¸²ã€æ•°å­—ç­‰æœ€å°å•å…ƒå°±ä½¿ç”¨ js_parse_postfix_expr å‡½æ•°ã€‚</p>
<p>if ä¼šåœ¨å¼€å§‹å’Œç»“æŸåˆ†åˆ«è°ƒç”¨ä½œç”¨åŸŸçš„è¿›æ ˆ push_scope å’Œå‡ºæ ˆ pop_scops å‡½æ•°ï¼Œif å†…ä¼šé€’å½’è°ƒç”¨ js_parse_statement_or_decl å‡½æ•°ã€‚while ä¼šç”¨ new_label å‡½æ•°åˆ›å»ºæ¡ä»¶å’Œé€€å‡ºçš„ labelï¼Œä½¿ç”¨ push_break_entry åŠ åˆ° BlockEnv ç»“æ„ä½“ä¸­è®°å½•ã€‚while è§£æå®Œä¼šè°ƒç”¨ pop_break_entry å‡½æ•°å°† fd-&gt;top_break è®¾ç½®ä¸º BlockEnv çš„å‰ä¸€ä¸ª breakã€‚while å†…ä¹Ÿæ˜¯é€’å½’è°ƒç”¨ js_parse_statement_or_decl å‡½æ•°ã€‚ç›¸æ¯”è¾ƒäº whileï¼Œfor ä¼šå¤šè°ƒç”¨ js_parse_for_in_of å»è§£æ for/in æˆ–è€… for/ofã€‚break å’Œ continue éƒ½ä¼šç›´æ¥ goto åˆ° failã€‚</p>
<p>switchã€tryã€with ä¸»è¦æ˜¯ BlockEnv è®¾ç½®ä¸åŒï¼Œå…¶ä»–éƒ¨åˆ†éƒ½æ˜¯æŒ‰ç…§æ­£å¸¸å£°æ˜å’Œè¡¨è¾¾å¼æ–¹å¼è§£æã€‚å¦‚æœæ˜¯ class çš„è¯ï¼Œä¼šè°ƒç”¨ js_parse_class å‡½æ•°æ¥è§£æ classã€‚es æ ‡å‡†é‡Œçš„ empty statement å’Œ debugger statement è™½ç„¶åªæ˜¯ç®€å•çš„ goto åˆ° failï¼Œä½†ä¹Ÿéƒ½æœ‰å¤„ç†ã€‚js_parse_statement_or_decl å‡½æ•°å¤„ç†è¯¦ç»†æ ‡å‡†å¯ä»¥å‚çœ‹ ecma262 çš„ <a href="https://tc39.es/ecma262/#sec-ecmascript-language-statements-and-declarations">Statements and Declarations</a>ã€‚</p>
<p><code>__JS_EvalInternal</code> å‡½æ•°æ‰§è¡Œå®Œè§£æå‡½æ•° js_parse_program åå¼€å§‹è°ƒç”¨ js_create_function å‡½æ•°æ¥åˆ›å»ºå‡½æ•°å¯¹è±¡å’Œæ‰€æœ‰åŒ…å«çš„å­å‡½æ•°ã€‚</p>
<h3 id="js-create-function-åˆ›å»ºå‡½æ•°å¯¹è±¡åŠåŒ…å«çš„å­å‡½æ•°"><a href="#js-create-function-åˆ›å»ºå‡½æ•°å¯¹è±¡åŠåŒ…å«çš„å­å‡½æ•°" class="headerlink" title="js_create_function åˆ›å»ºå‡½æ•°å¯¹è±¡åŠåŒ…å«çš„å­å‡½æ•°"></a>js_create_function åˆ›å»ºå‡½æ•°å¯¹è±¡åŠåŒ…å«çš„å­å‡½æ•°</h3><p>js_create_function å‡½æ•°ä¼šä» JSFunctionDef ä¸­åˆ›å»ºä¸€ä¸ªå‡½æ•°å¯¹è±¡å’Œå­å‡½æ•°ï¼Œç„¶åé‡Šæ”¾ JSFunctionDefã€‚å¼€å§‹ä¼šé‡æ–°è®¡ç®—ä½œç”¨åŸŸçš„å…³è”ï¼Œé€šè¿‡å››æ­¥å°†ä½œç”¨åŸŸå’Œå˜é‡å…³è”èµ·æ¥ï¼Œæ–¹ä¾¿åœ¨ä½œç”¨åŸŸå’Œçˆ¶ä½œç”¨åŸŸä¸­æŸ¥æ‰¾å˜é‡ã€‚ç¬¬ä¸€æ­¥éå†å‡½æ•°å®šä¹‰é‡Œçš„ä½œç”¨åŸŸï¼Œè®¾ç½®é“¾è¡¨å¤´ã€‚ç¬¬äºŒæ­¥éå†å˜é‡åˆ—è¡¨ï¼Œå°†å˜é‡å¯¹åº”ä½œç”¨åŸŸå±‚çº§é“¾è¡¨å¤´æ”¾åˆ°å˜é‡çš„ scope_next é‡Œï¼Œå¹¶å°†å˜é‡æ‰€åœ¨åˆ—è¡¨ç´¢å¼•æ”¾åˆ°å˜é‡å¯¹åº”ä½œç”¨åŸŸå±‚çº§é“¾è¡¨å¤´é‡Œã€‚ç¬¬ä¸‰æ­¥å†éå†ä½œç”¨åŸŸï¼Œå°†æ²¡æœ‰å˜é‡çš„ä½œç”¨åŸŸæŒ‡å‘çˆ¶ä½œç”¨åŸŸçš„é“¾è¡¨ã€‚ç¬¬å››æ­¥å°†å½“å‰ä½œç”¨åŸŸå’Œçˆ¶ä½œç”¨åŸŸå˜é‡é“¾è¡¨è¿èµ·æ¥ã€‚é€šè¿‡ fd-&gt;has_eval_call æ¥çœ‹æ˜¯å¦æœ‰è°ƒç”¨ evalï¼Œå¦‚æœæœ‰ï¼Œé€šè¿‡ add_eval_variables æ¥æ·»åŠ  eval å˜é‡ã€‚å¦‚æœå‡½æ•°é‡Œæœ‰ eval è°ƒç”¨ï¼Œadd_eval_variables å‡½æ•°ä¼šå°† eval é‡Œçš„é—­åˆå˜é‡æŒ‰ç…§ä½œç”¨åŸŸæ’åºã€‚add_eval_variables å‡½æ•°ä¼šä¸º eval å®šä¹‰ä¸€ä¸ªç»™å‚æ•°ä½œç”¨åŸŸç”¨çš„é¢å¤–çš„å˜é‡å¯¹è±¡ï¼Œè¿˜æœ‰éœ€å®šä¹‰å¯èƒ½ä¼šä½¿ç”¨çš„ argumentsï¼Œè¿˜åœ¨å‚æ•°ä½œç”¨åŸŸåŠ ä¸ª arguments bindingï¼Œå¦å¤–ï¼Œeval å¯ä»¥ä½¿ç”¨ enclosing å‡½æ•°çš„æ‰€æœ‰å˜é‡ï¼Œå› æ­¤éœ€è¦éƒ½åŠ åˆ°é—­åŒ…é‡Œã€‚</p>
<h4 id="pass-1"><a href="#pass-1" class="headerlink" title="pass 1"></a>pass 1</h4><p>js_create_function å‡½æ•°è¿˜ä¼šä½¿ç”¨ add_module_variables å‡½æ•°æ·»åŠ æ¨¡å—é—­åŒ…ä¸­çš„å…¨å±€å˜é‡ã€‚import å…¶ä»–æ¨¡å—çš„å…¨å±€ä¼šé€šè¿‡ js_parse_import å‡½æ•°ä½œä¸ºé—­åŒ…å˜é‡æ·»åŠ è¿›æ¥ï¼Œadd_module_variables å‡½æ•°æ˜¯æ·»åŠ  module é‡Œçš„å…¨å±€å˜é‡ï¼Œå°†æ¨¡å—çš„å…¨å±€å˜é‡é€šè¿‡ add_closure_var å‡½æ•°åŠ åˆ°å½“å‰å‡½æ•°å®šä¹‰é‡Œï¼Œå¹¶å¤„ç†ç±»å‹æ˜¯ JS_EXPORT_TYPE_LOCAL çš„ exports çš„å˜é‡ã€‚add_module_variables å‡½æ•°ä¼šå…ˆæ·»åŠ é€šè¿‡ js_parse_import å‡½æ•°å¯¼å…¥ä½œä¸ºé—­åŒ…å˜é‡çš„å…¨å±€å˜é‡ï¼Œæ·»åŠ é—­åŒ…å˜é‡è°ƒç”¨çš„æ˜¯ add_closure_var å‡½æ•°ã€‚éå† fd-&gt;child_list é€’å½’ä½¿ç”¨ js_create_function å‡½æ•°åˆ›å»ºæ‰€æœ‰å­å‡½æ•°ï¼Œå°†åˆ›å»ºçš„å­å‡½æ•°å¯¹è±¡ä¿å­˜åœ¨ fd-&gt;cpool é‡Œï¼Œcpool æ˜¯ä¸€ä¸ª JSValue ç»“æ„ä½“ï¼ŒJSValue æ˜¯æœ€åŸºæœ¬çš„å•ä½ï¼Œè¿™ä¸ªç»“æ„ä½“ä¼šæœ‰ä¸€ä¸ª tag æ¥æ ‡ç¤º JSValue çš„ç±»å‹ï¼Œå€¼æ˜¯ä¿å­˜åœ¨ JSValueUnion é‡Œï¼Œå€¼å¯ä»¥æ˜¯æ•´å‹å’Œæµ®ç‚¹ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡çš„æŒ‡é’ˆï¼ŒæŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡æ˜¯ç”±å¼•ç”¨è®¡æ•°æ¥è¿›è¡Œç®¡ç†çš„ï¼Œå¼•ç”¨è®¡æ•°ç»“æ„ä½“æ˜¯ JSRefCountHeaderã€‚è¿™é‡Œ JSValue çš„å€¼æ˜¯ä¸ªæ•°ç»„ã€‚</p>
<p>å¦‚æœæ‰“å¼€äº† DUMP_BYTECODEï¼ˆå°† #define DUMP_BYTECODE  (1) è¿™æ®µæ³¨é‡Šæ‰“å¼€ï¼‰ï¼Œjs_create_function å‡½æ•°ä¼šå…ˆè¿›è¡Œç¬¬ä¸€æ¬¡ dump_byte_code å‡½æ•°è°ƒç”¨ï¼Œdump_byte_code å‡½æ•°å…¥å‚ tab æ˜¯å­—èŠ‚ç ï¼Œå‡½æ•°ä¸»è¦é€šè¿‡ get å‰ç¼€çš„å‡½æ•°ï¼Œæ¯”å¦‚ get_u32 å’Œ get_u16 æ¥å–å­—èŠ‚ç çš„å€¼ï¼Œå¹¶æ‰“å°å‡ºæ¥ã€‚</p>
<p>å‰é¢ js_create_function å‡½æ•° dump çš„å­—èŠ‚ç å¯ä»¥ç§°ä¸º pass 1ï¼Œå¦‚æœåª dump è¿™ä¸ªé˜¶æ®µå­—èŠ‚ç ï¼Œå°† DUMP_BYTECODE è®¾ç½®ä¸º4ï¼Œdump pass 2 é˜¶æ®µå­—èŠ‚ç éœ€è¦è°ƒç”¨ resolve_variables å‡½æ•°ã€‚</p>
<h4 id="pass-2ï¼ˆresolve-variablesï¼‰"><a href="#pass-2ï¼ˆresolve-variablesï¼‰" class="headerlink" title="pass 2ï¼ˆresolve_variablesï¼‰"></a>pass 2ï¼ˆresolve_variablesï¼‰</h4><p>è§£æå½“å‰å‡½æ•°çš„å­—èŠ‚ç çš„æ“ä½œç¬¦ï¼Œop å°±æ˜¯å½“å‰çš„æ“ä½œç¬¦ã€‚add_scope_var å‡½æ•°ç”¨æ¥æ·»åŠ å˜é‡ï¼Œadd_scope_var å‡½æ•°ä¼šè°ƒç”¨ add_var å‡½æ•°å°†å˜é‡æ·»åŠ åˆ°å‡½æ•°å®šä¹‰ JSFunctionDef çš„ vars å­—æ®µé‡Œï¼Œadd_var è°ƒç”¨å®Œï¼Œadd_scope_var å‡½æ•°ä¼šç»§ç»­è®¾ç½®å˜é‡å®šä¹‰ç»“æ„ä½“ JSVarDef çš„ scope_levelã€scope_next å’Œ scope_firstï¼Œå…¶ä¸­ scope çš„ä½œç”¨æ˜¯åœ¨è¿›å…¥æ–°ä½œç”¨åŸŸæ—¶èƒ½æ‰¾åˆ°æœ€ä¸´è¿‘çš„å˜é‡ã€‚QuickJS åœ¨è§£ææ—¶ä¼šç”Ÿæˆä½¿ç”¨å˜é‡çš„å­—èŠ‚ç ï¼Œæ¯”å¦‚ OP_scope_get_var å­—èŠ‚ç æ“ä½œç¬¦ã€‚</p>
<p>resolve_variables å‡½æ•°ä¼šåœ¨éœ€è¦çš„æ—¶å€™å°†å…¨å±€å˜é‡è®¿é—®è½¬æ¢æˆå±€éƒ¨å˜é‡æˆ–é—­åŒ…å˜é‡ã€‚resolve_variables å‡½æ•°ä¼šå…ˆåšè¿è¡Œæ—¶æ£€æŸ¥ï¼Œç„¶åéå†æ‰€æœ‰å­—èŠ‚ç ï¼Œå­—èŠ‚ç æ“ä½œç¬¦æ˜¯ OP_eval å’Œ OP_apply_eval æ—¶å°†ä½œç”¨åŸŸç´¢å¼•è½¬æ¢æˆè°ƒæ•´åçš„å˜é‡ç´¢å¼•ã€‚å½“å­—èŠ‚ç æ˜¯ OP_scope_get_var_undefã€OP_scope_get_varã€OP_scope_put_varã€OP_scope_delete_varã€OP_scope_get_refã€OP_scope_put_var_initã€OP_scope_make_ref æ—¶éƒ½ä¼šè°ƒç”¨ resolve_scope_var å‡½æ•°ï¼Œåœ¨ä½œç”¨åŸŸé‡ŒæŸ¥æ‰¾å˜é‡ï¼Œå¯¹å­—èŠ‚ç æ“ä½œç¬¦è¿›è¡Œä¼˜åŒ–ã€‚å¯¹åº” QuickJS ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> OP_scope_get_var_undef:</span><br><span class="line"><span class="keyword">case</span> OP_scope_get_var:</span><br><span class="line"><span class="keyword">case</span> OP_scope_put_var:</span><br><span class="line"><span class="keyword">case</span> OP_scope_delete_var:</span><br><span class="line"><span class="keyword">case</span> OP_scope_get_ref:</span><br><span class="line"><span class="keyword">case</span> OP_scope_put_var_init:</span><br><span class="line">    var_name = get_u32(bc_buf + pos + <span class="number">1</span>);</span><br><span class="line">    scope = get_u16(bc_buf + pos + <span class="number">5</span>);</span><br><span class="line">    pos_next = resolve_scope_var(ctx, s, var_name, scope, op, &amp;bc_out,</span><br><span class="line">                                 <span class="literal">NULL</span>, <span class="literal">NULL</span>, pos_next);</span><br><span class="line">    JS_FreeAtom(ctx, var_name);</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure></p>
<p>resolve_variables å‡½æ•°å°±æ˜¯ä½¿ç”¨å‰é¢æ·»åŠ çš„å˜é‡ã€‚resolve_variables å‡½æ•°å…ˆéå†å½“å‰å‡½æ•°å®šä¹‰çš„ä½œç”¨åŸŸï¼Œå¦‚æœæ‰¾åˆ°å¯¹åº”çš„ç¬¦å·å°±ç”Ÿæˆå¯¹åº”ä¼˜åŒ–çš„å­—èŠ‚ç æ“ä½œç¬¦ï¼Œæ²¡æœ‰æ‰¾åˆ°ä¼šçœ‹å‡½æ•°å†…æ˜¯å¦å­˜åœ¨ eval çš„è°ƒç”¨ï¼Œä¾ç„¶æ²¡æœ‰ä¼šåˆ°çˆ¶ä½œç”¨åŸŸæŸ¥æ‰¾ï¼Œè¿˜æ²¡æœ‰çš„è¯ï¼Œå°±ä¼šåœ¨å…¨å±€ä½œç”¨åŸŸæŸ¥æ‰¾ï¼Œä»»ä½•ç¯èŠ‚æ‰¾åˆ°çš„å¤„ç†æ–¹å¼æ˜¯ä¸€è‡´çš„ã€‚</p>
<p>resolve_scope_var å‡½æ•°ä¼šç¡®å®šä½œç”¨åŸŸé‡Œçš„å˜é‡ç±»åˆ«ï¼Œçœ‹æ˜¯æœ¬åœ°å˜é‡ã€å…¨å±€å˜é‡ã€å‚æ•°ã€ä¼ªå˜é‡ã€‚åšæ³•æ˜¯å…ˆé€šè¿‡ is_pseudo_var å¸ƒå°”å€¼æ¥åˆ¤æ–­æ˜¯å¦è§£å†³ä¼ªå˜é‡é—®é¢˜ï¼Œä¼ªå˜é‡å°±æ˜¯ç±»ä¼¼ new.target å’Œ this è¿™æ ·çš„å…³é”®å­—ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å¤„ç†ä½œç”¨åŸŸå±€éƒ¨å˜é‡ï¼Œå¦‚æœæ˜¯ï¼Œç”Ÿæˆå–å±€éƒ¨å˜é‡çš„å­—èŠ‚ç æ“ä½œç¬¦ OP_get_locã€‚æ£€æŸ¥ eval å¯¹è±¡å’Œåœ¨å‚æ•°ä½œç”¨åŸŸå†…çš„ eval å¯¹è±¡ï¼Œç„¶åå†åœ¨æ›´ä¸Šçš„ä½œç”¨åŸŸè¿›è¡Œæ£€æŸ¥ï¼Œå¦‚æœä¸æ˜¯å½“å‰ä½œç”¨åŸŸçš„å˜é‡ï¼Œç”Ÿæˆå–è‡ªç”±å˜é‡çš„å­—èŠ‚ç æ“ä½œç¬¦ OP_get_var_ref ï¼Œæ‰¾å‡ºç›¸åº”çš„é—­åŒ…å˜é‡ï¼Œå¹¶æ·»åŠ åˆ°é—­åŒ…å˜é‡åˆ—è¡¨é‡Œï¼Œè¿™æ ·åšçš„åŸå› ç”±è‡ªç”±å˜é‡å®šä¹‰æ¥å®šçš„ï¼Œè‡ªç”±å˜é‡æ˜¯ä¸åœ¨æ‰€ä½¿ç”¨çš„å£°æ˜ä½œç”¨åŸŸä¸­è¿›è¡Œçš„å£°æ˜ã€‚resolve_scope_var å‡½æ•°ä¼šå°†å…¨å±€å˜é‡ç”Ÿæˆå¯¹åº”çš„å–å…¨å±€å˜é‡çš„å­—èŠ‚ç æ“ä½œç¬¦ OP_get_varã€‚ç”± label_done æ¥ç¡®å®šæ˜¯å¦å­—èŠ‚ç æ›´æ–°ï¼Œå¦‚æœæ›´æ–° JSFunctionDef çš„ label_slots çš„ pos2 éœ€è¦é‡æ–°æ›´æ–°ä¼ª bc-sizeã€‚</p>
<p>resolve_variables å‡½æ•°åœ¨éå†åˆ°å­—èŠ‚ç æ“ä½œç¬¦æ˜¯ OP_scope_get_private_field æ—¶ä¼šè°ƒç”¨ resolve_scope_private_field å‡½æ•°ï¼Œprivate field æ˜¯ js ç±»é‡Œç§æœ‰å˜é‡å’Œæ–¹æ³•çš„å®šä¹‰ï¼Œç›®å‰è¿˜åœ¨ææ¡ˆçš„ç¬¬ä¸‰ä¸ªé˜¶æ®µï¼Œä¹Ÿå°±å®Œæˆå‰æœ€åä¸€ä¸ªé˜¶æ®µï¼Œè¿™ä¸ªé˜¶æ®µè¡¨ç¤ºæ–¹æ¡ˆå·²ç¡®å®šï¼Œè®¾è®¡ä¸Šçš„é—®é¢˜å·²è§£å†³ï¼ŒåŒ…æ‹¬å…¼å®¹æ€§ç­‰é—®é¢˜ã€‚private field æ˜¯ ES2020 è‰æ¡ˆæå‡ºçš„ï¼Œææ¡ˆç›¸å…³ä¿¡æ¯åœ¨ <a href="https://github.com/tc39/proposal-class-fields">Class field declarations for JavaScript</a> è¿™é‡Œï¼Œè¯¦ç»†æ–¹æ¡ˆè®¾è®¡åœ¨ <a href="https://tc39.es/proposal-class-fields/">Public and private instance fields proposal</a> è¿™é‡Œã€‚QuickJS åœ¨å¤„ç† token é˜¶æ®µåœ¨ next_token å‡½æ•°é‡Œç¢°åˆ° # å­—ç¬¦ä¼šè°ƒ parse_ident å‡½æ•°å–å‡ºå®šä¹‰çš„å˜é‡åå‡ºæ¥å¯„å­˜åˆ° token.u.ident.atom é‡Œï¼Œç±»å‹è®¾ç½®ä¸º TOK_PRIVATE_NAMEï¼Œé€šè¿‡ add_private_class_field å‡½æ•°å°†å˜é‡æ·»åŠ åˆ°å½“å‰ä½œç”¨åŸŸå˜é‡åˆ—è¡¨é‡Œã€‚resolve_variables å‡½æ•°ä½¿ç”¨ resolve_scope_private_field å‡½æ•°å¤„ç† private fieldï¼Œå‡½æ•°å†…è°ƒç”¨ resolve_scope_private_field1 å‡½æ•°æŸ¥ä½œç”¨åŸŸé“¾çš„ä¸Šå±‚æ¥æ£€æŸ¥æ˜¯å¦å¯å¤„ç† private fieldï¼Œå¦‚æœä¸è¡Œç›´æ¥è¿”å› -1ï¼Œå¯ä»¥çš„è¯ä¼šç”Ÿæˆå– private field çš„å­—èŠ‚ç æ“ä½œç¬¦ OP_get_private_fieldã€‚</p>
<p>å½“å¼€å¯ OPTIMIZE å®å®šä¹‰æ—¶ï¼Œç¢°åˆ°å‡½æ•°ç»“æŸç›¸å…³å­—èŠ‚ç æ“ä½œç¬¦æ¯”å¦‚ OP_tail_callã€OP_tail_call_methodã€OP_returnã€OP_return_undefã€OP_throwã€OP_throw_errorã€OP_ret ç­‰æ—¶ resolve_variables ä¼šè°ƒç”¨ skip_dead_code å»æ‰æ— ç”¨çš„ä»£ç ã€‚</p>
<p>OP_label å­—èŠ‚ç æ“ä½œç¬¦å¯¹åº”æ˜¯ js çš„ label è¯­å¥ï¼Œlabel è¯­å¥çš„ ecma262 éƒ¨åˆ†æ˜¯ <a href="https://tc39.es/ecma262/#sec-labelled-statements">Labelled Statements</a>ï¼Œjs çš„ label ä¸åƒ c è¯­è¨€æœ‰ gotoï¼Œå› æ­¤éƒ½æ˜¯é…åˆ break å’Œ continue ä¸€èµ·ä½¿ç”¨ã€‚</p>
<p>è¿›å…¥ä½œç”¨åŸŸçš„å­—èŠ‚ç æ“ä½œç¬¦æ˜¯ OP_enter_scopeã€‚ä¼šæ£€æŸ¥è¿›å…¥çš„ä½œç”¨åŸŸä¸­çš„å‡½æ•°å’Œå˜é‡åˆ—è¡¨ï¼Œå¦‚æœå˜é‡ç±»å‹æ˜¯ JS_VAR_FUNCTION_DECL æˆ– JS_VAR_NEW_FUNCTION_DECL ä¼šä¼˜åŒ–ç”Ÿæˆå­—èŠ‚ç æ“ä½œç¬¦ OP_put_locï¼Œå¦‚æœæ˜¯å…¶ä»–ç±»å‹å°±ç”Ÿæˆ OP_set_loc_uninitializedã€‚åœ¨è¿›å…¥ä½œç”¨åŸŸæ—¶ï¼Œå…ˆå¤„ç† js çš„ Hoistingï¼Œä¹Ÿå°±æ˜¯å˜é‡æå‡ï¼Œå˜é‡æå‡æ˜¯æŒ‡åœ¨ç¼–è¯‘é˜¶æ®µä¼šåœ¨å†…å­˜ä¸­å°†å˜é‡å’Œå‡½æ•°å£°æ˜æ”¾åˆ°æ‰§è¡Œå…¶ä»–ä»£ç å‰ï¼Œå¦‚æœåŒ…å«äº†æ–°ä½œç”¨åŸŸæƒ…å†µå°±ä¼šå¤æ‚äº›ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œè¿™æ ·è¯´æ¯”è¾ƒæŠ½è±¡ã€‚æˆ‘ä¸¾ä¸ªä¾‹å­ï¼Œä»£ç  Aï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> say = <span class="string">&quot;hi!&quot;</span>;</span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(say);</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>
<p>æŒ‰ç…§å˜é‡æå‡è§„èŒƒå®šä¹‰ï¼Œä¸Šé¢ä»£ç ä¼šè¾“å‡º hiï¼Œå’Œä½ æƒ³çš„ä¸€æ ·å§ã€‚å¦‚æœæ¢æˆä¸‹é¢çš„ä»£ç  Bï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> say = <span class="string">&quot;hi!&quot;</span>;</span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(say);</span><br><span class="line">    <span class="keyword">var</span> say = <span class="string">&quot;see u again!&quot;</span></span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>
<p>ä½ å…ˆæƒ³æƒ³ä¸Šé¢çš„ä»£ç ä¼šè¾“å‡ºä»€ä¹ˆã€‚QuickJS å¤„ç† Hoisting ä½¿ç”¨çš„æ˜¯ instantiate_hoisted_definitions å‡½æ•°ï¼Œinstantiate_hoisted_definitions å‡½æ•° ä¼šå…ˆå°†å‡½æ•°å‚æ•°å’Œå˜é‡åŠ åˆ° Hoisting é‡Œï¼Œé—­åŒ…é‡Œä¼šåŒ…å«æ‰€æœ‰ enclosing å˜é‡ï¼Œå¦‚æœå¤–éƒ¨æœ‰å˜é‡ç¯å¢ƒï¼Œåœ¨å¤–éƒ¨ä¸ºå˜é‡åˆ›å»ºä¸€ä¸ªå±æ€§ï¼Œå¯¹åº”çš„ QuickJS çš„ instantiate_hoisted_definitions å‡½æ•°å¤„ç†ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; s-&gt;global_var_count; i++) &#123;</span><br><span class="line">    JSGlobalVar *hf = &amp;s-&gt;global_vars[i];</span><br><span class="line">    <span class="keyword">int</span> has_closure = <span class="number">0</span>;</span><br><span class="line">    BOOL force_init = hf-&gt;force_init;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(idx = <span class="number">0</span>; idx &lt; s-&gt;closure_var_count; idx++) &#123;</span><br><span class="line">        JSClosureVar *cv = &amp;s-&gt;closure_var[idx];</span><br><span class="line">        <span class="keyword">if</span> (cv-&gt;var_name == hf-&gt;var_name) &#123;</span><br><span class="line">            has_closure = <span class="number">2</span>;</span><br><span class="line">            force_init = FALSE;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (cv-&gt;var_name == JS_ATOM__var_ ||</span><br><span class="line">            cv-&gt;var_name == JS_ATOM__arg_var_) &#123;</span><br><span class="line">            dbuf_putc(bc, OP_get_var_ref);</span><br><span class="line">            dbuf_put_u16(bc, idx);</span><br><span class="line">            has_closure = <span class="number">1</span>;</span><br><span class="line">            force_init = TRUE;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!has_closure) &#123;</span><br><span class="line">        <span class="comment">// å±€éƒ¨å’Œå…¨å±€ä¸å†²çªçš„å¤„ç†</span></span><br><span class="line">        ... <span class="comment">// çœç•¥å¤„ç†</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (hf-&gt;cpool_idx &gt;= <span class="number">0</span> || force_init) &#123;</span><br><span class="line">        <span class="comment">// å†²çªä½†å¯åˆå§‹åŒ–çš„å¤„ç†</span></span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢ä»£ç å¯ä»¥çœ‹å‡ºï¼Œé—­åŒ…å†…å®šä¹‰å˜é‡å’Œå¤–éƒ¨å˜é‡ç›¸åŒæ—¶ï¼Œä¼šè®¾ç½® has_closure ä¸º2ï¼ŒåŒæ—¶è®¾ç½® force_init ä¸º FALSEã€‚æ ¹æ®ä¹‹åä»£ç å¯ä»¥çœ‹å‡ºè¿™æ ·è®¾ç½®åå°±ä¸ä¼šè¿›è¡Œåˆå§‹åŒ–å¤„ç†ï¼Œä»è€Œèƒ½çœ‹å‡ºé—­åŒ…å†…å˜é‡æ˜¯ä¸ä¼šåˆå§‹åŒ–çš„ã€‚å› æ­¤ä¸Šé¢ä¸¾ä¾‹çš„ä»£ç  B è¾“å‡ºçš„ç»“æœæ˜¯ undefinedã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œå¦‚æœæ˜¯å‡½æ•°å˜é‡ï¼Œåˆ™å…ˆåˆ›å»ºé—­åŒ…ï¼Œå­—èŠ‚ç æ“ä½œç¬¦æ˜¯ OP_fclosureï¼Œç„¶åå°†é—­åŒ…è®¾ç½®ä¸ºå­—èŠ‚ç æ“ä½œç¬¦ OP_put_loc å±€éƒ¨å˜é‡ã€‚å…¶ä»–æƒ…å†µå¯¹è¯¥ä½œç”¨åŸŸä¸­çš„å˜é‡è¿›è¡Œæœªåˆå§‹åŒ–å£°æ˜ï¼Œå¯¹åº”å­—èŠ‚ç æ“ä½œç¬¦æ˜¯ OP_set_loc_uninitializedã€‚é€€å‡ºä½œç”¨åŸŸæ—¶ç”Ÿæˆå…³é—­å±€éƒ¨å˜é‡çš„ OP_close_loc å­—èŠ‚ç æ“ä½œç¬¦ã€‚resolve_variables å‡½æ•°æœ€åä¼šå°† DynBuf bc_out æ”¾åˆ° JSFunctionDef çš„ byte_code å­—æ®µé‡Œã€‚</p>
<p>æ‰§è¡Œå®Œ resolve_variables åï¼Œå°† DUMP_BYTECODE è®¾ç½®ä¸º2ï¼Œå¯ä»¥çœ‹åˆ° resolve_variables å‡½æ•°æ‰§è¡Œå®Œåçš„å­—èŠ‚ç ã€‚ä¸‹ä¸€æ­¥æ˜¯æ‰§è¡Œ resolve_labels å‡½æ•°ã€‚è¿™ä¸ªé˜¶æ®µæ˜¯ pass 3</p>
<h4 id="pass3ï¼ˆresolve-labelsï¼‰"><a href="#pass3ï¼ˆresolve-labelsï¼‰" class="headerlink" title="pass3ï¼ˆresolve_labelsï¼‰"></a>pass3ï¼ˆresolve_labelsï¼‰</h4><p>resolve_labels ä¸»è¦æ˜¯åš peephole ä¼˜åŒ–å’Œå¤„ç† goto å’Œ labelsã€‚peephole æ˜¯æŒ‡çš„å°æŒ‡ä»¤é›†ï¼Œåœ¨ QuickJS é‡Œå°±æ˜¯ js_parse_program å‡½æ•°æ‰§è¡Œåç”Ÿæˆçš„å­—èŠ‚ç ï¼Œpeephole é¡¾åæ€ä¹‰å°±æ˜¯ä¼˜åŒ– QuickJS çš„å­—èŠ‚ç ã€‚å¯¹ peephole ä¼˜åŒ–å¸¸ç”¨æŠ€æœ¯æœ‰å†—ä½™æŒ‡ä»¤åˆ é™¤ï¼ŒåŒ…æ‹¬æ²¡ç”¨çš„å­˜å’Œå–æŒ‡ä»¤è¿˜æœ‰ä¸ä¼šæ‰§è¡Œçš„æŒ‡ä»¤ã€‚ç„¶åæ˜¯åˆå¹¶æ“ä½œï¼Œå¤šä¸ªæ“ä½œå¦‚æœå¯ä»¥ç”¨ä¸€ä¸ªæ“ä½œæ›¿ä»£ï¼Œå°±è¿›è¡Œæ›¿æ¢ã€‚åˆ©ç”¨ Algebraic è§„åˆ™ç®€åŒ–å’Œé‡æ’æŒ‡ä»¤ç›¸å…³ä¼˜åŒ–ã€‚æœ€åå°±æ˜¯ä½¿ç”¨ä¸€äº›ç‰¹æ®Šçš„æŒ‡ä»¤æ¥ä¼˜åŒ–ã€‚æ¯”å¦‚ Java å­—èŠ‚ç çš„ aload æŒ‡ä»¤å¦‚æœé‡å¤æ‰§è¡Œï¼Œå¯ä»¥æ›¿æ¢æˆ dup æŒ‡ä»¤ã€‚å¦å¤–ï¼Œå¦‚æœç¼–è¯‘å™¨åœ¨è°ƒç”¨å­ç¨‹åºä¹‹å‰å°†å¯„å­˜å™¨ä¿å­˜åœ¨å †æ ˆä¸Šï¼Œè¿”å›æ—¶è¿›è¡Œæ¢å¤ï¼Œå¤šæ¬¡è°ƒç”¨å­ç¨‹åºå°±ä¼šäº§ç”Ÿå¤šä½™çš„å †æ ˆï¼Œå¦‚æœåé¢çš„è°ƒç”¨ ä¸ä¾èµ–ä¹‹å‰çš„å¯„å­˜å™¨ï¼Œå¤šä½™çš„ POP/PUSH éƒ½å¯ä»¥åˆ é™¤ã€‚å†æ¯”å¦‚æ±‡ç¼–é‡Œçš„å¤šæ¬¡ sh æŒ‡ä»¤åŠ  ldc1 å¤šå­˜ä¸€å–å¯ä»¥é€šè¿‡ xor å¼‚æˆ–æŒ‡ä»¤å‡å°‘è®¿é—®å­˜å‚¨æ“ä½œï¼Œå¯ä»¥æå‡æ€§èƒ½ã€‚å½“ç¢°åˆ°è·³è½¬åˆ°è·³è½¬çš„æŒ‡ä»¤æ—¶ï¼Œå¯ä»¥åšè·³è½¬æŒ‡ä»¤ä¼˜åŒ–ï¼Œåšæ³•æ˜¯ç›´æ¥è·³åˆ°ç›®æ ‡åœ°å€ï¼Œè¿˜å¯ä»¥æ£€æŸ¥å“ªäº›åˆ†æ”¯ä¸ä¼šè¢«è·³è½¬ä¹Ÿå¯ä»¥åšæŒ‡ä»¤åˆ é™¤ä¼˜åŒ–ã€‚</p>
<p>ä¸‹é¢ä¾‹å­æ˜¯æ¶ˆé™¤å†—ä½™çš„ load storesã€‚æ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = b + c;</span><br><span class="line">d = a + e;</span><br></pre></td></tr></table></figure>
<p>è½¬ä¸ºä¸‹é¢çš„æŒ‡ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MOV b, R0  ; æŠŠ b æ‹·åˆ°å¯„å­˜å™¨</span><br><span class="line">ADD c, R0  ; æ·»åŠ  c åˆ°å¯„å­˜å™¨ï¼Œå¯„å­˜å™¨ç°åœ¨æ˜¯ b+c</span><br><span class="line">MOV R0, a  ; æŠŠ R0 å¯„å­˜å™¨æ‹·ç»™ a</span><br><span class="line">MOV a, R0  ; å°† a æ‹·åˆ°å¯„å­˜å™¨</span><br><span class="line">ADD e, R0  ; Add  e to the register, the register is now a+e [(b+c)+e] å°† e æ·»åŠ åˆ°å¯„å­˜å™¨ï¼Œç°åœ¨å¯„å­˜å™¨æ˜¯ a+eï¼Œa æ˜¯ b+cï¼Œå› æ­¤æ­¤æ—¶å¯„å­˜å™¨æ˜¯ b+c+e</span><br><span class="line">MOV R0, d  ; æŠŠå¯„å­˜å™¨æ‹·ç»™ d</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ MOV a, RO æ˜¯å¤šä½™çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å°† a æ‹·ç»™å¯„å­˜å™¨æ˜¯å†—ä½™æ­¥éª¤ã€‚</p>
<p>æœ¬è´¨ä¸Š peephole ä¼˜åŒ–è¿˜æ˜¯ç¼–è¯‘é˜¶æ®µçš„ä¼˜åŒ–ï¼Œåªæ˜¯å¤„äºä¸€èˆ¬ç¼–è¯‘åç«¯çš„ä¼˜åŒ–ï¼Œç”±äº QuickJS è§£æåæ˜¯ç›´æ¥ç”Ÿæˆäº†å­—èŠ‚ç ï¼Œå¹¶ç›´æ¥è§£é‡Šæ‰§è¡Œç”Ÿæˆçš„å­—èŠ‚ç ï¼Œæ‰€ä»¥å¾ˆå¤šç¼–è¯‘çš„ä¼˜åŒ–æŠ€æœ¯æ˜¯ç”¨ä¸ä¸Šçš„ï¼Œå…¶ä»–çš„ä¼˜åŒ–åŒ…æ‹¬æœ‰å¾ªç¯ä¼˜åŒ–çš„è¯±å¯¼å˜é‡ã€å¼ºåº¦é™ä½ã€å¾ªç¯èåˆã€å¾ªç¯åè½¬ã€å¾ªç¯äº’æ¢ã€å¾ªç¯ä¸å˜çš„ä»£ç è¿åŠ¨ã€å¾ªç¯åµŒå¥—ä¼˜åŒ–ã€å¾ªç¯å±•å¼€ã€å¾ªç¯æ‹†åˆ†ã€å¾ªç¯è§£é™¤åˆ‡æ¢ã€è½¯ä»¶æµæ°´çº¿ã€è‡ªåŠ¨å¹¶è¡ŒåŒ–ç­‰ï¼›æ•°æ®æµåˆ†æçš„å¸¸è§çš„å­è¡¨è¾¾æ¶ˆé™¤ã€å¸¸é‡æŠ˜å ã€è¯±å¯¼å˜é‡è¯†åˆ«å’Œæ¶ˆé™¤ã€æ­»åº“æ¶ˆé™¤ã€ä½¿ç”¨å®šä¹‰é“¾ã€æ´»å˜é‡åˆ†æã€å¯ç”¨è¡¨è¾¾æ–¹å¼ï¼›SSA-based çš„å…¨å±€å€¼ç¼–å·ï¼Œç¨€ç–æ¡ä»¶å¸¸æ•°ä¼ æ’­ï¼›Code generation çš„å¯„å­˜å™¨åˆ†é…ã€æŒ‡ä»¤é€‰æ‹©ã€æŒ‡ä»¤è°ƒåº¦ã€Rematerializationï¼›å‡½æ•°çš„å°¾è°ƒç”¨æ¶ˆé™¤ã€æ¶ˆé™¤ä¸­é—´æ•°æ®ç»“æ„çš„ Deforestationï¼›å…¨å±€æœ‰è¿‡ç¨‹é—´ä¼˜åŒ–ã€‚</p>
<p>é™æ€åˆ†æçš„ä¼˜åŒ–æœ‰åˆ«ååˆ†æã€æŒ‡é’ˆåˆ†æã€å½¢çŠ¶åˆ†æã€è½¬ä¹‰åˆ†æã€é˜µåˆ—è®¿é—®åˆ†æã€ä¾èµ–æ€§åˆ†æã€æ§åˆ¶æµåˆ†æã€æ•°æ®æµåˆ†æç­‰ã€‚å…¶ä»–çš„ä¼˜åŒ–åŒ…æ‹¬æ¶ˆé™¤è¾¹ç•Œæ£€æŸ¥ã€ç¼–è¯‘æ—¶å‡½æ•°æ‰§è¡Œã€æ¶ˆé™¤æ­»ä»£ç ã€å†…è”æ‰©å±•ã€è·³çº¿ç¨‹ã€æŒ‰é…ç½®ä¼˜åŒ–ç­‰ã€‚peephole ä¼˜åŒ–å±äº base block çº§åˆ«çš„ä¼˜åŒ–ï¼Œllvm ä¼šåœ¨ SSA ä¼˜åŒ–æ—¶åš module-scheduling å’Œ peephole ä¼˜åŒ–ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹ resolve_labels å‡½æ•°æ˜¯æ€ä¹ˆåš peephole ä¼˜åŒ–çš„ã€‚</p>
<p>resolve_labels å‡½æ•°å…ˆåˆå§‹åŒ–ä¼ªå˜é‡ï¼Œæ¯”å¦‚å‰é¢æåˆ°çš„ new.targe å’Œ thisï¼Œè¿˜æœ‰ home_objectã€this.active_func å˜é‡ï¼Œå…¶ä¸­ this å˜é‡åœ¨æ´¾ç”Ÿç±»çš„æ„é€ å‡½æ•°ä¸­æ˜¯æ²¡æœ‰åˆå§‹åŒ–çš„ã€‚éšåä¼šåˆå§‹åŒ–å‚æ•°å˜é‡ã€å½“å‰å‡½æ•°å¼•ç”¨ã€å˜é‡ç¯å¢ƒå¯¹è±¡ã€‚è¿™äº›éƒ½ä¼šç”Ÿæˆ OP_special_object å­—èŠ‚ç æ“ä½œç¬¦ï¼Œå¹¶æ ¹æ®ä¸åŒå˜é‡ç±»å‹ç”Ÿæˆå¯¹åº”çš„å€¼ï¼Œç±»å‹å®šä¹‰æšä¸¾æ˜¯ OPSpecialObjectEnumã€‚</p>
<p>æ¥ä¸‹æ¥å°±æ˜¯éå†å­—èŠ‚ç ï¼Œé’ˆå¯¹ä¸åŒå­—èŠ‚ç æŒ‡ä»¤è¿›è¡Œä¼˜åŒ–ã€‚</p>
<p>OP_line_num æ˜¯ç”¨äºè°ƒè¯•çš„è¡Œå·ï¼Œè®°åœ¨ line_num æ•´å‹å˜é‡é‡Œã€‚ä½¿ç”¨ JSOpCode ç»“æ„ä½“è®¡ç®—æ ˆçš„å¤§å°ï¼Œéå†æŒ‡ä»¤é›†æ—¶ï¼Œå †æ ˆå¤§å°é€šè¿‡ oi-&gt;n_push - n_pop è·å–ã€‚OP_label æ“ä½œç¬¦æœ€ç»ˆç”Ÿæˆå­—èŠ‚ç çš„åç§»é‡ä¼šè¢«ç¡®å®šã€‚OP_gotoã€OP_gosubã€OP_if_trueã€OP_if_false å’Œ OP_label ä¸€æ ·ä¼šç¡®å®šæœ€ç»ˆåç§»é‡ï¼Œé€šè¿‡ find_jump_target å‡½æ•°æ‰¾åˆ°ç›®æ ‡ labelï¼Œé€šè¿‡ update_label å‡½æ•°ç§»é™¤ jump æŒ‡ä»¤ã€‚</p>
<p>é‡åˆ° OP_nullï¼Œé€šè¿‡ code_match å‡½æ•°æ¥çœ‹å‰ä¸€ä¸ªå­—èŠ‚ç æ“ä½œç¬¦å¦‚æœæ˜¯ OP_strict_eqï¼Œé‚£ä¹ˆå°±å¯ä»¥ä¼˜åŒ–æˆ OP_is_nullã€‚å¯¹äº OP_push_i32ï¼Œå¦‚æœå‰å­—èŠ‚ç æ“ä½œç¬¦æ˜¯ OP_negï¼Œä¼šç”¨ push_short_int å‡½æ•°åœ¨ val å‰åŠ ä¸Š - ç¬¦å·æ¥ç²¾ç®€æŒ‡ä»¤ã€‚OP_push_i32ã€OP_push_atom_value å’Œ OP_drop æŒ‡ä»¤ç´§ç›¸é‚»çš„è¯å¯ä»¥éƒ½ç§»å‡ºã€‚</p>
<p>å¦å¤–OP_to_propkeyã€OP_to_propkey2ã€OP_undefinedã€OP_insert2ã€OP_dupã€OP_get_locã€OP_get_argã€OP_get_var_refã€OP_put_locã€OP_put_argã€OP_put_var_refã€OP_post_incã€OP_post_decã€OP_typeof ç­‰å­—èŠ‚ç æ“ä½œç¬¦è¿›è¡Œä¼˜åŒ–ï¼Œç›¸åŒçš„å¤„ç†é€šè¿‡ goto è·³åˆ° label æ ‡ç­¾çš„æ–¹å¼æ¥å¤„ç†ã€‚æœ‰shrinkã€has_labelã€has_gotoã€has_constant_test ç­‰ label æ¥ç»Ÿä¸€ä¼˜åŒ–é€»è¾‘ã€‚ä¸»è¦æ˜¯å°†é•¿çš„æ“ä½œæ•°è½¬æˆçŸ­æ“ä½œæ•°ï¼Œåˆå¹¶æŒ‡ä»¤ï¼Œè¿˜æœ‰å°†æ“ä½œæ•°ç§»åˆ°æ“ä½œç¬¦é‡ŒæŠŠé•¿çš„å­—èŠ‚ç æŒ‡ä»¤è½¬æ¢æˆçŸ­æŒ‡ä»¤ã€‚</p>
<p>resolve_labels å‡½æ•°æœ€åè¿˜ä¼šéå†ä¸€é s-&gt;jump_slots åšæ›´å¤šçš„è·³è½¬æŒ‡ä»¤çš„ä¼˜åŒ–ã€‚</p>
<p>resolve_labels å‡½æ•°æ‰§è¡Œå®Œåï¼Œpass 3 é˜¶æ®µ js_create_function è¿˜éœ€è¦è°ƒç”¨ compute_stack_size å‡½æ•°å¹¿åº¦ä¼˜å…ˆæ–¹å¼æ¥è®¡ç®—å †æ ˆå¤§å°ã€‚compute_stack_size å‡½æ•°å¯¹ä¼šå¯¹æ ˆæœ‰å½±å“çš„æŒ‡ä»¤ä½¿ç”¨ ss_check æ£€æŸ¥å­—èŠ‚ç çš„buffer æ˜¯å¦æœ‰å­—èŠ‚ç ç¼“å†²åŒºæº¢å‡ºã€å †æ ˆæº¢å‡ºæˆ–å †æ ˆå¤§å°ä¸ä¸€è‡´é—®é¢˜ï¼Œå¹¶åœ¨ s-&gt;stack_level_tab é‡Œè®°å½•æ¯ä¸ªä½ç½®çš„æ ˆå¤§å°ï¼Œç„¶åç”¨ js_resize_array æ›´æ–° s-&gt;pc_stack æ•°ç»„ã€‚</p>
<p>æ€»çš„æ¥è¯´ä»è„šæœ¬ç”Ÿæˆæœ€ç»ˆå­—èŠ‚ç æœ‰ä¸¤ä¸ªé˜¶æ®µï¼Œç¬¬ä¸€ä¸ªé˜¶æ®µæ˜¯è„šæœ¬è§£æï¼Œè¿™ä¸ªé˜¶æ®µä¼šå…ˆå°†ç”Ÿæˆçš„ token ä½¿ç”¨è§£æå„ç§è¯­å¥å’Œè¡¨è¾¾å¼çš„å‡½æ•°ç›´æ¥åœ¨è§£ææ—¶ç”Ÿæˆ pass 1å­—èŠ‚ç ï¼Œç„¶åç”Ÿæˆå‡½æ•°å®šä¹‰æ ‘ã€‚ç¬¬äºŒé˜¶æ®µæ˜¯ä¼˜åŒ–é˜¶æ®µï¼Œä¸»è¦æ˜¯ resolve_variables å‡½æ•°å’Œ resolve_labels å‡½æ•°ã€‚resolve_variables ä¼šä¼˜åŒ–å˜é‡ï¼Œæ¯”å¦‚å…¨å±€å˜é‡ã€æœ¬åœ°å˜é‡ã€è‡ªç”±å˜é‡ã€å‚æ•°ç­‰ï¼Œå°†ä½œç”¨åŸŸæ“ä½œç®€åŒ–æˆå¯¹åº”å®šä¹‰å˜é‡ç§ç±»å­—èŠ‚ç ã€‚resolve_labels ä¸»è¦æ˜¯å¯¹è·³è½¬ç›¸å…³çš„ä¼˜åŒ–ï¼Œæ¯”å¦‚é€šè¿‡ç¡®å®šæœ€ç»ˆè·³è½¬åœ°å€æ¥ä¼˜åŒ–ä¸­é—´è·³è½¬ã€‚</p>
<p>æ€»çš„æ¥çœ‹ï¼Œjs_create_function å‡½æ•°æ•´ä½“ä¾èµ–å¦‚ä¸‹å›¾ï¼š<br><img src="/uploads/deeply-analyse-quickjs/4.png" alt=""><br>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨åˆ›å»ºå‡½æ•°æ—¶ï¼Œå¦‚æœå½“å‰å‡½æ•°ä½¿ç”¨çš„å˜é‡æ˜¯ä¸Šä¸€çº§å‡½æ•°çš„å±€éƒ¨å˜é‡ï¼Œå°±ä¼šå°†ä¸Šä¸€çº§å‡½æ•°çš„å±€éƒ¨å˜é‡æ·»åŠ åˆ°ä¸Šä¸€çº§å‡½æ•°çš„é—­åŒ…å˜é‡çš„åˆ—è¡¨é‡Œã€‚</p>
<h3 id="è§£é‡Šæ‰§è¡Œ-JS-EvalFunctionInternal"><a href="#è§£é‡Šæ‰§è¡Œ-JS-EvalFunctionInternal" class="headerlink" title="è§£é‡Šæ‰§è¡Œ JS_EvalFunctionInternal"></a>è§£é‡Šæ‰§è¡Œ JS_EvalFunctionInternal</h3><p><code>__JS_EvalInternal</code> å‡½æ•°æ‰§è¡Œå®Œ js_create_functionï¼Œè¿˜ä¼šè£…è½½ä½¿ç”¨ js_resolve_module å‡½æ•°å¤„ç†å½“å‰æ¨¡å—æ‰€éœ€æ‰€æœ‰æ¨¡å—ã€‚æœ€åå°±æ˜¯è¦å¼€å§‹è§£é‡Šæ‰§è¡Œå‡½æ•°å¯¹è±¡ fun_obj äº†ã€‚</p>
<p>å‡½æ•°å¯¹è±¡å­—èŠ‚ç ä¿¡æ¯ç»“æ„ä½“æ˜¯ JSFunctionBytecodeï¼Œjs å‡½æ•°åœ¨è¿è¡Œæ—¶çš„æ•°æ®ç»“æ„æ˜¯ JSFunctionBytecodeï¼Œåˆ›å»ºå‡½æ•°å°±æ˜¯åˆå§‹åŒ– JSFunctionBytecode ç»“æ„ä½“ï¼Œå¹¶è®¾ç½®é‡Œé¢æ‰€éœ€çš„å­—æ®µï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯å°†æ‰«æä»£ç ç”Ÿæˆçš„ä¸´æ—¶ JSFunctionDef å¯¹åº”åˆ° JSFunctionBytecode ä¸­ï¼Œç”± js_create_function å‡½æ•°è´Ÿè´£å¤„ç†ã€‚JSFunctionBytecode ç»“æ„ä½“é‡Œçš„ byte_code_buf å­—æ®µæ˜¯å‡½æ•°å¯¹è±¡è‡ªå·±å­—èŠ‚ç çš„æŒ‡é’ˆï¼Œvardefs é‡Œæ˜¯å‡½æ•°çš„å‚æ•°å’Œå±€éƒ¨å˜é‡ï¼›closure_var æ˜¯ç”¨äºå­˜æ”¾å¤–éƒ¨å¯è§çš„é—­åŒ…å˜é‡ï¼Œclosure_var é€šè¿‡ add_closure_var å‡½æ•°è¿›è¡Œæ·»åŠ ï¼Œadd_closure_var å‡½æ•°ä¼šæŠŠè¦ç”¨åˆ°çš„å˜é‡æ·»åŠ æˆé—­åŒ…å˜é‡ï¼Œé€šè¿‡ get_closure_var2 å‡½æ•°å¾€ä¸Šå±‚çº§é€’å½’ç»™æ¯å±‚çº§å‡½æ•°æ·»åŠ é—­åŒ…å˜é‡ï¼Œç›´åˆ°æ‰¾åˆ°ç›®æ ‡å‡½æ•°ï¼›stack_size æ˜¯æŒ‡å †æ ˆçš„å¤§å°ï¼Œstack_size ä¸»è¦ä½œç”¨æ˜¯ä¸ºåˆå§‹åŒ–æ ˆæ—¶èƒ½å¤Ÿå‡å°‘å†…å­˜å ç”¨ï¼›cpool æ˜¯å‡½æ•°å†…å¸¸é‡æ± ã€‚</p>
<p>QuickJS è§£é‡Šæ‰§è¡Œçš„æ–¹å¼æœ‰äº”ç§ï¼Œflag å®šä¹‰äº† JS_EVAL_FLAG_STRICT è¡¨ç¤ºæŒ‰ç…§ strict æ¨¡å¼æ‰§è¡Œï¼ŒJS_EVAL_FLAG_STRIP è¡¨ç¤ºä¼šæŒ‰ strip æ¨¡å¼æ‰§è¡Œï¼ŒJS_EVAL_FLAG_COMPILE_ONLY æŒ‡åªç”Ÿæˆå‡½æ•°å¯¹è±¡ï¼Œä¸è§£é‡Šæ‰§è¡Œï¼Œä½†è¿”å›çš„ç»“æœçš„ç»“æœæ˜¯å¸¦æœ‰å­—èŠ‚ç æˆ– JS_TAG_MODULE çš„å‡½æ•°å¯¹è±¡ï¼Œè¿™ä¸ªå‡½æ•°å¯¹è±¡ä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨ JS_EvalFunctionInternal æ¥è§£é‡Šæ‰§è¡Œçš„ã€‚JS_EVAL_FLAG_BACKTRACE_BARRIER è¡¨ç¤ºå‡ºç°é—®é¢˜è¿›è¡Œå›æº¯æ—¶ä¸éœ€è¦ä¹‹å‰å †æ ˆå¸§ã€‚</p>
<p>QuickJS è§£é‡Šæ‰§è¡Œçš„å‡½æ•°æ˜¯ JS_EvalFunctionInternalï¼ŒJS_EvalFunctionInteral å‡½æ•°ä¼šç”¨ JS_VALUE_GET_TAG æ¥çœ‹å‡½æ•°å¯¹è±¡æ˜¯å¸¦å­—èŠ‚ç çš„ JS_TAG_FUNCTION_BYTECODE è¿˜æ˜¯ JS_TAG_MODULEã€‚</p>
<p>å¦‚æœæ˜¯ JS_VALUE_GET_TAG æ˜¯ JS_TAG_MODULE è¡¨ç¤ºå½“å‰å‡½æ•°å¯¹è±¡æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œå› æ­¤éœ€è¦æŒ‰ç…§æ¨¡å—çš„æ–¹å¼å¤„ç†ï¼ŒJS_EvalFunctionInternal å‡½æ•°ä¼šå…ˆè°ƒç”¨ js_create_module_function æ‰¾å‡ºæ¨¡å—ä¸­å¯¼å‡ºçš„å˜é‡ï¼Œjs_create_module_function å‡½æ•°è°ƒç”¨é“¾å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">js_create_module_function -&gt; js_create_module_bytecode_function -&gt; js_create_module_var</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œå®Œ js_create_module_functionï¼Œä¼šè°ƒç”¨ js_link_module å‡½æ•°ï¼Œjs_link_module å‡½æ•°ä¼šå¤„ç†æ‰€æœ‰è¦å¯¼å…¥çš„å˜é‡ï¼Œå°†å…¶ä¿å­˜åœ¨ JSModuleDef çš„ req_module_entries æ•°ç»„é‡Œä¾›è§£é‡Šæ‰§è¡Œæ—¶ä½¿ç”¨ã€‚ç„¶å js_link_module è¿˜ä¼šæ£€æŸ¥é—´æ¥çš„å¯¼å…¥ã€‚æœ€åå°†å¯¼å‡ºçš„å˜é‡ä¿å­˜åœ¨æ¨¡å— JSExportEntry çš„ export_entries æ•°ç»„é‡Œï¼Œç„¶åä½¿ç”¨ JS_Call å‡½æ•°æ‰§è¡Œå¯¼å‡ºçš„è¿™äº›å…¨å±€å˜é‡çš„åˆå§‹åŒ–ã€‚</p>
<p>JS_EvalFunctionInteral å‡½æ•°å¯¹äº tag æ˜¯ JS_TAG_FUNCTION_BYTECODE çš„å‡½æ•°å¯¹è±¡ä¼šè°ƒç”¨ js_closure å’Œ JS_CallFree ä¸¤ä¸ªå‡½æ•°è¿›è¡Œå­—èŠ‚ç çš„è§£é‡Šæ‰§è¡Œã€‚</p>
<p>js_closure å‡½æ•°æœ€ç»ˆä¼šç”Ÿæˆå‡½æ•°é—­åŒ…å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¼šè®¾ç½®å±æ€§ã€‚js_closure è¿˜ä¼šç”Ÿæˆè®¾ç½®å˜é‡å±æ€§ï¼Œæ¯”å¦‚æ¥æºå’Œç±»å‹ï¼Œå¹¶å­˜åœ¨å½“å‰å‡½æ•°çš„ var_refs é‡Œï¼Œå˜é‡å¤„ç†ä½¿ç”¨çš„æ˜¯ js_closure2 å‡½æ•°ã€‚js_closure å…ˆä½¿ç”¨ JS_NewObjectClass å°† func_obj ç±»å‹ç”± js_closure2 å‡½æ•°ä¼šéå†é—­åŒ…å˜é‡ï¼Œé€šè¿‡ get_var_ref å‡½æ•°æ¥çœ‹é—­åŒ…å˜é‡æ¥è‡ªå“ªä¸€å±‚ä¸Šä¸‹æ–‡ï¼Œæœ€åå­˜åœ¨å½“å‰å‡½æ•°çš„ JSVarRef é‡Œï¼ŒJSVarRef è¡¨å˜é‡å¼•ç”¨ã€‚åœ¨ js_closure2 å‡½æ•°ä¸­ï¼Œå½“å‘ç°è‡ªç”±å˜é‡çš„ is_local ä¸º false ä¹Ÿå°±æ˜¯å˜é‡æ¥è‡ªå¤–å±‚ï¼Œå°±ä¼šç›´æ¥ä» js_closure2 å‡½æ•°ä¼ å…¥çš„ä¸Šå±‚çš„å‚æ•° cur_var_refs é‡Œå–å‡ºå˜é‡ï¼Œå­˜åœ¨ var_refs é‡Œï¼Œå½“ JS_CallInternal æ‰§è¡Œæ—¶å½“é‡åˆ° OP_get_var_ref å­—èŠ‚ç æ“ä½œç¬¦æ—¶å‡½æ•°é—­åŒ…ä¼šç›´æ¥é€šè¿‡ç´¢å¼•ä» var_refs é‡Œå–å‡ºå˜é‡å¹¶é€šè¿‡ JS_DupValue å°†å¼•ç”¨åŠ 1ï¼ŒåŒæ—¶æŠŠå¼•ç”¨åŠ åˆ°æ ˆé¡¶ã€‚OP_put_var_ref ä½¿ç”¨ set_value å‡½æ•°å°†æ ˆé¡¶å€¼æ›´æ–°åˆ° var_refs å¯¹åº”ç´¢å¼•ä½ç½®ï¼Œå¹¶ pop æ ˆé¡¶å€¼ã€‚js_function_set_properties å‡½æ•°è®¾ç½®å±æ€§ã€‚</p>
<p>åˆ›å»ºäº†é—­åŒ…ç¯å¢ƒï¼Œæ¥ä¸‹æ¥æ‰§è¡Œ JS_Call å‡½æ•°ï¼ŒJS_Call å‡½æ•°ä¼šé€ä¸ªæ‰§è¡Œå­—èŠ‚ç çš„æŒ‡ä»¤ã€‚JS_Call ä¼šè°ƒç”¨ JS_CallInternal å‡½æ•°ï¼ŒQuickJS çš„å­—èŠ‚ç æ‰§è¡Œæ¶æ„æ˜¯åŸºäºæ ˆæŒ‡ä»¤çš„ï¼ŒJavaScriptCore æ˜¯åŸºäºå¯„å­˜å™¨è§£é‡Šæ‰§è¡Œçš„ï¼Œå…³äº JavaScriptCore çš„è¯¦ç»†ä»‹ç»å¯ä»¥å‚çœ‹æˆ‘ä»¥å‰çš„æ–‡ç« ã€Š<a href="https://ming1016.github.io/2018/04/21/deeply-analyse-javascriptcore/">æ·±å…¥å‰–æ JavaScriptCore</a>ã€‹ã€‚JSStackFrame æ˜¯æ¨¡æ‹Ÿæ ˆï¼Œåœ¨ä¸€ä¸ªè¿è¡Œæ—¶åªä¼šæœ‰ä¸€ä¸ªæ¨¡æ‹Ÿæ ˆåœ¨ä½¿ç”¨ï¼Œgenerator é€šè¿‡ä¿å­˜ä¸€ä¸ªè¿˜åœ¨è¿è¡Œä¸­æ²¡ç»“æŸçš„æ ˆæ¥è¾¾åˆ°æŒ‚èµ·çš„ç›®çš„ã€‚</p>
<p>JS_CallInternal ä¼šå¯¹å­—èŠ‚ç çš„æ¯æ¡æŒ‡ä»¤éƒ½è¿›è¡Œè§£é‡Šæ‰§è¡Œã€‚ä¼šå…ˆä¸ºå˜é‡ã€å­˜æ”¾æ•°æ®çš„æ ˆè¿˜æœ‰å‚æ•°ç­‰è¿›è¡Œå†…å­˜çš„åˆ†é…ã€‚ç„¶åå†å¯¹æ¯æ¡å­—èŠ‚ç æŒ‡ä»¤ä¸€ä¸ªä¸€ä¸ªè¿›è¡Œè§£é‡Šæ‰§è¡Œï¼ŒæŒ‡ä»¤ç±»å‹æœ‰ push å¼€å¤´çš„å…¥æ ˆæŒ‡ä»¤ã€‚gotoã€if æ‰“å¤´çš„è·³è½¬æŒ‡ä»¤ã€‚call å¼€å¤´çš„è°ƒç”¨æŒ‡ä»¤ã€‚äº¤æ¢ç±»çš„æŒ‡ä»¤æœ‰ swapã€nipã€dupã€permã€drop ç­‰ã€‚ç”¨äºè®¡ç®—çš„æŒ‡ä»¤æœ‰åŠ å‡ä¹˜é™¤ã€ä¸€å…ƒè®¡ç®—ã€é€»è¾‘è®¡ç®—ç­‰ã€‚å¤„ç†æŒ‡ä»¤æ—¶ç”Ÿæˆ JSValue ç”¨çš„æ˜¯ JS_MKVAL å’Œ JS_MKPTR è¿™ä¸¤ä¸ªå®ã€‚æ–°å»ºå­—ç¬¦ä¸²ç±»å‹ç”¨çš„æ˜¯ JS_NewStringï¼Œå¯¹è±¡æ˜¯ JS_NewObjectï¼Œæ•°ç»„æ˜¯ JS_NewArrayç­‰ã€‚ç±»å‹è½¬æ¢ä½¿ç”¨çš„å‡½æ•°æœ‰ JS_toString æ¥è½¬æ¢æˆå­—ç¬¦ä¸²ç±»å‹ï¼ŒJS_ToNumeric è½¬æ¢æˆæ•°å­—ï¼ŒJS_ToObject è½¬æ¢æˆå¯¹è±¡ç­‰ã€‚</p>
<p>å†…å­˜ç›¸å…³æŒ‡ä»¤æœ‰ JS_DupValue å‡½æ•°å¯¹ JSRefCountHeader è¿›è¡Œå¼•ç”¨è®¡æ•°åŠ 1ï¼ŒJS_FreeValue å¯¹å¼•ç”¨è®¡æ•°å‡1ï¼Œè§¦å‘GCä½¿ç”¨ js_trigger_gc å‡½æ•°ï¼Œæ·»åŠ ä¸€ä¸ª GC å¯¹è±¡ä½¿ç”¨ add_gc_object å‡½æ•°ï¼Œç§»å‡ºä½¿ç”¨ remove_gc_object å‡½æ•°ã€‚è§¦å‘ GC çš„æ—¶æœºæ˜¯å¯ä»¥çœ‹å“ªé‡Œè°ƒç”¨äº† JS_NewObjectProtoClass è¿™ä¸ªå‡½æ•°ï¼ŒJS_NewObjectProtoClass å‡½æ•°ä¼šè°ƒç”¨ JS_NewObjectFromShape å‡½æ•°ä¼šè§¦å‘ js_trigger_gc å‡½æ•°ï¼Œjs_trigger_gc å‡½æ•°ä¼šåˆ¤æ–­å†…å­˜å¤§å°æ˜¯å¦å¤§äº malloc_gc_thresholdï¼Œè¶…è¿‡å°±ä¼šè°ƒç”¨ JS_RunGC å‡½æ•°ã€‚å¯¹åº”åˆ¤æ–­ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">force_gc = ((rt-&gt;malloc_state.malloc_size + size) &gt;</span><br><span class="line">                rt-&gt;malloc_gc_threshold);</span><br></pre></td></tr></table></figure>
<p>å¦‚æœå®šä¹‰äº† FORCE_GC_AT_MALLOC è¿™ä¸ªå®ï¼Œæ¯æ¬¡éƒ½ä¼šè°ƒç”¨ JS_RunGC å‡½æ•°ã€‚JS_RunGC å‡½æ•°ä¼šè°ƒç”¨ä¸‰ä¸ªå‡½æ•°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">JS_RunGC</span><span class="params">(JSRuntime *rt)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">/* decrement the reference of the children of each object. mark =</span></span><br><span class="line"><span class="comment">       1 after this pass. */</span></span><br><span class="line">    gc_decref(rt);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* keep the GC objects with a non zero refcount and their childs */</span></span><br><span class="line">    gc_scan(rt);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* free the GC objects in a cycle */</span></span><br><span class="line">    gc_free_cycles(rt);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šä»£ç ä¸­ï¼Œgc_decref å‡½æ•°ä¼šéå† gc_obj_list å‡å°‘æ¯ä¸ªå¯¹è±¡çš„å­å¯¹è±¡çš„å¼•ç”¨ï¼Œå‡åˆ°0çš„ä¼šå­˜åˆ° temp_obj_list é‡Œï¼Œgc_scan å‡½æ•°ä¼šè°ƒç”¨ gc_scan_incref_child å°†å­å¯¹è±¡å¼•ç”¨åŠ 1ï¼Œä¿æŒ GC å¯¹è±¡è®¡æ•°å’Œä»–ä»¬å­å¯¹è±¡ã€‚gc_free_cycles å‡½æ•°åœ¨å‘¨æœŸä¸­é‡Šæ”¾ GC å¯¹è±¡ï¼ŒJS_GC_OBJ_TYPE_JS_OBJECT å’Œ JS_GC_OBJ_TYPE_FUNCTION_BYTECODE ç±»å‹çš„å’Œ JSValue ç›¸å…³çš„ä¼šé‡Šæ”¾ï¼Œå…¶ä»–çš„ä¼šåˆ é™¤ã€‚</p>
<p>æ€»çš„è¯´æ¥ï¼ŒGC æ˜¯é€šè¿‡ add_gc_object å‡½æ•°è°ƒç”¨å¼€å§‹çš„ï¼Œè°ƒç”¨äº† add_gc_object å‡½æ•°çš„å‡½æ•°éƒ½æ˜¯ä¼šæ¶‰åŠåˆ° GCï¼Œæ¯”å¦‚ JS_CallInternalã€js_create_functionã€JS_NewObjectFromShape ç­‰å‡½æ•°ã€‚å…¶ä¸­ JS_DupValueRT ä¼šå¯¹å¼•ç”¨è®¡æ•°åšåŠ 1æ“ä½œã€‚free_var_ref å’Œ JS_FreeValueRT å‡½æ•°ä¼šå¯¹å¼•ç”¨è®¡æ•°å‡1ï¼Œå½“å‡åˆ°0æ—¶ä¼šè°ƒç”¨ JS_FreeValueRT é‡Šæ”¾ç§»é™¤å¼•ç”¨å¯¹è±¡ã€‚</p>
<p>ä¸‹é¢è¯¦ç»†è®²è§£ä¸åŒç±»å‹æŒ‡ä»¤æ€ä¹ˆè§£é‡Šæ‰§è¡Œçš„ã€‚</p>
<p>pc æŒ‡å‘å½“å‰æ­£åœ¨æ‰§è¡Œçš„å­—èŠ‚ç åœ°å€ã€‚sp æŒ‡å‘å †æ ˆï¼Œå †æ ˆå­˜ç€è¿è¡Œæ—¶çš„æ•°æ®ï¼Œé€šè¿‡ pc æŒ‡å‘çš„æ“ä½œæŒ‡ä»¤è¿›è¡Œå †æ ˆçš„å…¥æ ˆå’Œå‡ºæ ˆæ“ä½œã€‚</p>
<p>OP_push_i32 ä½¿ç”¨ JS_NewInt32 å°†å½“å‰å­—èŠ‚ç çš„å€¼è½¬æˆ JSInt32ï¼Œsp++ å°†å€¼å…¥æ ˆã€‚é€šè¿‡ quickjs-opcode.h æ–‡ä»¶å¯ä»¥çœ‹åˆ° OP_push_i32 ç›¸å…³å®šä¹‰ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DEF(       push_i32, <span class="number">5</span>, <span class="number">0</span>, <span class="number">1</span>, i32)</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢OPCode å®šä¹‰ä¸­ç¬¬ä¸€ä¸ªå‚æ•° id è¡¨ç¤º OPCode çš„åå­—ï¼Œç¬¬äºŒä¸ª size è¡¨ç¤º OPCode çš„å­—èŠ‚å¤§å°ï¼Œç¬¬ä¸‰ä¸ª n_pop è¡¨ç¤ºå‡ºæ ˆå…ƒç´ çš„æ•°é‡ï¼Œç¬¬å››ä¸ªå‚æ•° n_push è¡¨ç¤ºå…¥æ ˆå…ƒç´ çš„æ•°é‡ï¼Œç¬¬äº”ä¸ªå‚æ•° f è¡¨ç¤ºå­—èŠ‚ç çš„ç±»å‹ã€‚ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥çœ‹åˆ° OP_push_i32 çš„å¤§å°æ˜¯5å­—èŠ‚ï¼Œé‚£ä¹ˆä¸‹ä¸ªå­—èŠ‚ç éœ€è¦ pc æŒ‡é’ˆå¢åŠ 4 åŠ ä¸Šé€šè¿‡æ ˆæ“ä½œå¾—åˆ°çš„åç§»å€¼1åŠ åœ¨ä¸€èµ·æ˜¯5ï¼Œå› æ­¤å¯ä»¥ç§»åˆ°ä¸‹ä¸€ä¸ªæŒ‡ä»¤ã€‚</p>
<p>å¯¹äº8ä½ä»¥ä¸‹æ•´æ•°ï¼Œä½¿ç”¨çš„æ˜¯ OP_push åŠ ä½æ•°çš„å­—èŠ‚ç ï¼Œå¤§å°æ˜¯1ä¸ªå­—èŠ‚ã€‚ä½¿ç”¨ JS_NewInt32 è¿›è¡Œç±»å‹è½¬æ¢ç„¶åå…¥æ ˆã€‚8ä½æ•´æ•°ä½¿ç”¨çš„æ˜¯ OP_push_i8ï¼Œ8ä½æ•´æ•°æ”¾åœ¨ç¬¬2ä¸ªå­—èŠ‚é‡Œï¼Œ16ä½æ•´æ•°éœ€è¦2ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥å¯¹åº”çš„å­—èŠ‚ç æ˜¯ OP_push_i16ã€‚OP_push_empty_string ä¼šå°† JS_ATOM_empty_string è¿™ä¸ª atom ä½¿ç”¨ JS_AtomToString è½¬æˆ JSValue å…¥æ ˆã€‚OP_push_atom_value ä¼šå°† atom çš„å€¼è½¬æˆå¯¹åº”å­—ç¬¦ä¸² JSValue è¿›è¡Œå…¥æ ˆã€‚å½“é‡åˆ° OP_undefinedã€OP_nullã€OP_push_falseã€OP_push_trueæ—¶å°†å¯¹åº”çš„ç‰¹æ®Šå€¼å®šä¹‰ï¼Œæ¯”å¦‚ JS_UNDEFINED å’Œ JS_NULL å…¥æ ˆã€‚</p>
<p>å½“å­—èŠ‚ç æ“ä½œç¬¦æ˜¯ OP_fclosure æˆ– OP_fclosure8 é—­åŒ…æ—¶ï¼Œä¼šè°ƒç”¨ js_closure å»åˆ›å»ºé—­åŒ…è§£é‡Šç¯å¢ƒï¼Œè§£é‡Šæ‰§è¡ŒåŒ…å†…æŒ‡ä»¤ã€‚é—­åŒ…å°±æ˜¯å‡½æ•°å’Œå‘¨è¾¹çŠ¶æ€çš„å¼•ç”¨åˆåœ¨ä¸€èµ·çš„ç»„åˆï¼Œå†…å±‚å¯ä»¥è®¿é—®å¤–å±‚ä½œç”¨åŸŸã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">b</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ä¸Šé¢ä»£ç å¯ä»¥çœ‹å‡ºï¼Œadd å‡½æ•°å†…æ‰§è¡ŒåŠ æ³•çš„å‡½æ•°èƒ½å¤Ÿè®¿é—®åˆ°å¤–å±‚çš„å…¥å‚å˜é‡ aï¼Œä»è€Œå’Œè¿”å›å‡½æ•°çš„å…¥å‚å˜é‡ b è¿›è¡ŒåŠ æ³•è¿ç®—ï¼Œè¿”å›ç›¸åŠ åçš„å€¼ã€‚è§£ææ—¶ï¼Œä¼šç”Ÿæˆ scope_get_var å’Œ scope_put_varï¼Œåœ¨æ‰§è¡Œ resolve_variable å‡½æ•°æ—¶ä¼šå°†è§£æåçš„æŒ‡ä»¤è½¬æ¢æˆå±€éƒ¨å˜é‡ get_loc å’Œ put_locï¼Œè‡ªç”±å˜é‡ get_var_ref å’Œ put_var_refã€‚è·å–å±€éƒ¨å’Œå¤–å±‚å˜é‡ä½¿ç”¨çš„æ˜¯ get_closure_var å‡½æ•°ï¼Œget_closure_var å‡½æ•°ä¼šå°†å½“å‰å‡½æ•°æ‰€è¦ç”¨çš„å˜é‡è®°å½•åœ¨å‡½æ•°å®šä¹‰å¯¹è±¡ JSFunctionDef çš„ closure_var é‡Œã€‚å˜é‡ç»“æ„æ˜¯ JSClosureVarï¼Œè¡¨ç¤ºé—­åŒ…å˜é‡ä¿¡æ¯ï¼Œè®°å½•é—­åŒ…é‡Œå˜é‡çš„å„ç§ä¿¡æ¯ï¼Œæ¯”å¦‚å˜é‡çš„ç´¢å¼•ã€åå­—ç­‰ï¼Œå…¶å­—æ®µ is_local å¦‚æœæ˜¯ true è¡¨ç¤ºå˜é‡æ˜¯å±€éƒ¨å˜é‡ï¼Œfalse è¡¨ç¤ºæ˜¯ä¸Šå±‚å˜é‡ã€‚åœ¨æ‰§è¡Œ OP_fclosure å­—èŠ‚ç æ“ä½œç¬¦æ—¶ï¼Œä¼šæ ¹æ® JSFunctionDef çš„ closure_var ç”Ÿæˆ var_refsï¼Œä¹Ÿå°±æ˜¯è‡ªç”±å˜é‡çš„å¼•ç”¨ï¼Œè·å–è¿™äº›è‡ªç”±å˜é‡çš„å­—èŠ‚ç æ“ä½œç¬¦æ˜¯ OP_get_var_refï¼Œæ˜¯é€šè¿‡ var_refs é‡Œçš„ç´¢å¼•è·å–ã€‚</p>
<p>å­—èŠ‚ç æ“ä½œç¬¦æ“ä½œ OP_push_this åˆ†ä¸ºæ™®é€šå¤„ç†å’Œä¸¥æ ¼æ¨¡å¼å¤„ç†ï¼Œæ™®é€šå¤„ç†æ˜¯ç›´æ¥å°†thisæŒ‡å‘æŒ‡é’ˆå…¥æ ˆï¼Œå†å¯¹å¼•ç”¨è®¡æ•°åŠ 1ã€‚ä¸¥æ ¼æ¨¡å¼å¯¹äº NULL å’Œæœªå®šä¹‰çš„ this ä¼šå°†å…¨å±€å¯¹è±¡æŒ‡é’ˆå…¥æ ˆï¼Œå¦‚æœ this æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå°±æŒ‰ç…§æ™®é€šæ¨¡å¼å¤„ç†ï¼Œå…¶ä»–ç±»å‹ä¼šå°è¯•ä½¿ç”¨ JS_ToObject è½¬æˆå¯¹è±¡ï¼Œå¦‚æœæœ‰å¼‚å¸¸åˆ™ä¼š goto åˆ° exception labelã€‚</p>
<p>OP_object è¡¨ç¤ºéœ€è¦åœ¨è¿è¡Œæ—¶åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ä¸åœ¨ç¼–è¯‘æ—¶åˆ›å»ºï¼ŒQuickJS ä½¿ç”¨çš„æ˜¯ JS_NewObject å‡½æ•°ï¼ˆæœ€ç»ˆè°ƒç”¨çš„æ˜¯ JS_NewObjectProtoClass å‡½æ•°ï¼‰ï¼Œåˆ›å»º JSShape çš„ JSValueï¼Œæ–‡ç« å‰é¢ä¹Ÿè¯´äº†ï¼Œshape æ˜¯ä¸€ç§é¿å¼€ç¹çå­—èŠ‚ç å¤„ç†æ›´å¿«åˆ›å»ºå‡½æ•°å¯¹è±¡çš„æ–¹æ³•ã€‚å¦å¤–é’ˆå¯¹ä¸€äº›å®šä¹‰åœ¨ OPSpecialObjectEnum æšä¸¾é‡Œç‰¹æ®Šçš„å¯¹è±¡åˆ›å»ºçš„å­—èŠ‚ç æ“ä½œç¬¦æ˜¯ OP_special_objectï¼Œå‚æ•°å’Œå˜é‡ç±»å‹æœ€ç»ˆéƒ½ä¼šè°ƒç”¨ JS_NewObjectProtoClass å‡½æ•°åˆ›å»º shape å¯¹è±¡ï¼Œthis å’Œ home_object ä¼šè¿”å›å¯¹åº”çš„æŒ‡é’ˆï¼Œimport ä¼šå¯¼å…¥æ¨¡å—ã€‚</p>
<p>dropã€nip å’Œ dup å¼€å¤´çš„å­—èŠ‚ç æ˜¯å¯¹ sp å †æ ˆé‡Œçš„é¡¶å±‚å€¼è¿›è¡Œåˆ é™¤å’Œå¤åˆ¶ã€‚insert å¼€å¤´çš„å­—èŠ‚ç æ˜¯åŠ å…¥å¯¹è±¡æŒ‡é’ˆï¼Œperm æ˜¯äº¤æ¢å¯¹è±¡å’Œå€¼çš„æ ˆå±‚çº§ã€‚swap å¼€å¤´çš„æ˜¯äº¤æ¢å€¼çš„æ ˆå±‚çº§ï¼Œrot æ˜¯æ•´ä½“ç¿»è½¬ã€‚</p>
<p>call å¼€å¤´çš„å­—èŠ‚ç æ“ä½œç¬¦å’Œ OP_eval ä¼šé€’å½’è°ƒç”¨ JS_CallInternal å‡½æ•°è¿›è¡Œå¯¹åº”ä½ç½®çš„æ‰§è¡Œã€‚OP_call_constructor ä¼šè°ƒç”¨ JS_CallConstructorInternal å‡½æ•°æ‰§è¡Œæ„é€ å‡½æ•°æŒ‡ä»¤ï¼Œæœ€ç»ˆå‡½æ•°çš„æŒ‡ä»¤ä¹Ÿæ˜¯é€šè¿‡ JS_CallInternal è§£é‡Šæ‰§è¡Œã€‚</p>
<p>åˆ›å»ºæ•°ç»„ï¼Œä½¿ç”¨çš„æ˜¯ OP_array_fromï¼Œå¯¹åº”å‡½æ•°æ˜¯ JS_NewArrayï¼ŒJS_NewArray å‡½æ•°ä¼šæ‰§è¡Œ JS_NewObjectFromShape å‡½æ•°ï¼Œå‚æ•°è®¾ç½®ç±»å‹ä¸º JS_CLASS_ARRAYï¼ŒJS_NewObjectFromShape ä¼šåˆ›å»ºä¸€ä¸ªæ•°ç»„å¯¹è±¡ Shapeã€‚</p>
<p>OP_apply ä¼šè°ƒç”¨ js_function_apply å‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰å‚æ•°å°±ä¼šç›´æ¥è°ƒç”¨ JS_Call è§£é‡Šæ‰§è¡Œï¼Œæœ‰å‚æ•°çš„è¯ä½¿ç”¨ build_arg_list å‡½æ•°è·å–å‚æ•°åˆ—è¡¨ï¼Œå¯¹äºæ„é€ å‡½æ•° js_function_apply ä¼šä½¿ç”¨ JS_CallConstructor2 å‡½æ•°æ‰§è¡Œï¼Œå…¶ä»–çš„ç›´æ¥ä½¿ç”¨ JS_Call æ‰§è¡Œã€‚</p>
<p>OP_eval å’Œ OP_apply_eval ä¼šæ£€æŸ¥ eval æ‰§è¡Œå‚æ•°ï¼Œå¦‚æœæ²¡æœ‰ä¼šè°ƒç”¨ JS_EvalObject å‡½æ•°ï¼ŒJS_EvalObject å‡½æ•°ä¼šä¾æ® val å‚æ•°æ˜¯å¦æ˜¯å­—ç¬¦ä¸²å†³å®šæ˜¯ç›´æ¥è¿”å› val åœ°å€è¿˜æ˜¯è°ƒç”¨ JS_EvalInternal è§£æå­—ç¬¦ä¸²ã€‚</p>
<p>OP_regexp ä¼šä½¿ç”¨ js_regexp_constructor_internal å‡½æ•°åˆ›å»ºä¸€ä¸ªæ­£åˆ™å‡½æ•°å¯¹è±¡æ”¾åˆ°å †æ ˆä¸­ã€‚OP_get_super ä¼šä½¿ç”¨ JS_GetPrototype å‡½æ•°æ¥è·å–åŸå‹å¯¹è±¡æ”¾åˆ°å †æ ˆä¸­ã€‚OP_import æ˜¯åŠ¨æ€è·å– import å†…å®¹ï¼Œä½¿ç”¨ js_new_promise_capability å‡½æ•°æ£€æŸ¥æ˜¯å¦æ˜¯ promiseï¼Œç„¶åè°ƒç”¨ JS_CallConstructor å‡½æ•°æ‰§è¡Œã€‚</p>
<p>å¯¹äºå…¨å±€å˜é‡å­˜å–å­—èŠ‚ç ï¼Œæ˜¯è°ƒç”¨çš„ JS_GetGlobalVar å’Œ JS_SetGlobalVar å‡½æ•°ã€‚å…¨å±€å˜é‡å’Œå‡½æ•°çš„å®šä¹‰ä½¿ç”¨çš„æ˜¯ JS_DefineGlobalVar å’Œ JS_DefineGlobalFunction å‡½æ•°ã€‚å±€éƒ¨å˜é‡å’Œå‚æ•° put ä½¿ç”¨çš„æ˜¯ JS_DupValue å‡½æ•°å…¥æ ˆï¼Œset ä½¿ç”¨çš„æ˜¯ set_value å‡½æ•°ã€‚å¯¹å…¨å±€å˜é‡ã€å±€éƒ¨å˜é‡å’Œå‚æ•°ååŠ  check çš„æŒ‡ä»¤æ˜¯åœ¨å…¥æ ˆæˆ–è®¾ç½®å€¼å‰ä¼šç”¨ JS_IsUninitialized å‡½æ•°æ¥åˆ¤æ–­ä»–ä»¬æ˜¯å¦æ˜¯ JS_TAG_UNINITIALIZEDï¼Œåœ¨ä»–ä»¬ä¹‹å‰åŠ  make è¡¨ç¤ºåœ¨è¿è¡Œæ—¶æ·»åŠ å¯¹è±¡ï¼Œä¼šå…ˆç”¨ JS_NewObjectProto åˆ›å»ºå« JSShape çš„ JSValue å…¥æ ˆï¼Œåœ¨æ ˆé‡Œå†å–å‡º JSObject è®¾ç½®å˜é‡å¼•ç”¨ï¼Œå†å…¥æ ˆå˜é‡çš„ atomã€‚OP_close_loc ç”¨çš„æ˜¯ close_lexical_var æ¥å–æ¶ˆå±€éƒ¨å˜é‡çš„å¼•ç”¨ã€‚</p>
<p>goto è¿™æ ·çš„å­—èŠ‚ç æŒ‡ä»¤åœ¨ quickjs-opcode.h é‡Œå®šä¹‰çš„å€¼ç±»å‹éƒ½æ˜¯ labelï¼Œé€šè¿‡å–å‡ºæŒ‡ä»¤å¯¹åº” label çš„åç§»é‡ï¼Œè®© pc åŠ ä¸Šåç§»é‡ç›´æ¥è·³è½¬åˆ°å¯¹åº”å­—èŠ‚ç ã€‚OP_if_true æœ‰äº”ä¸ªå­—èŠ‚ï¼Œå› æ­¤ pc += 4 ä¸ºä¸‹ä¸ªæŒ‡ä»¤æŒ‡é’ˆåœ°å€ã€‚ä» sp æ ˆé‡Œå–å‡ºæ ˆé¡¶ opï¼Œä½¿ç”¨ JS_VALUE_GET_TAG å–å‡º tag å€¼ï¼Œåˆ¤æ–­å°äº JS_TAG_UNDEFINED å°±æ‰§è¡Œä¸‹ä¸ªæŒ‡ä»¤ã€‚è¿™é‡Œ JS_TAG_UNDEFINED å’Œå…¶ä»– tag ç±»å‹éƒ½å®šä¹‰åœ¨ä¸€ä¸ªåŒ¿åæšä¸¾é‡Œï¼Œæœ‰å¼•ç”¨è®¡æ•°çš„ç±»å‹éƒ½æ˜¯è´Ÿæ•°ï¼Œæ¯”å¦‚ JS_TAG_BIG_INT -10ã€JS_TAG_STRING -7ã€JS_TAG_MODULE -3ã€JS_TAG_FUNCTION_BYTECODE -2ã€JS_TAG_OBJECT -1ã€‚æ•´æ•°ã€å¸ƒå°”å€¼ã€NULL ç±»å‹ä¹Ÿæ»¡è¶³å°äº JS_TAG_UNDEFINED æ¡ä»¶ã€‚OP_if_false æ‰§è¡Œä¸‹æ¡æŒ‡ä»¤é€»è¾‘å’Œ OP_if_true ç›¸åã€‚</p>
<p>for éå†è¯­æ³•å…³é”®å­—ç›¸å…³å­—èŠ‚ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DEF(   for_in_start, 1, 1, 1, none)</span><br><span class="line">DEF(   for_of_start, 1, 1, 3, none)</span><br><span class="line">DEF(for_await_of_start, 1, 1, 3, none)</span><br><span class="line">DEF(    for_in_next, 1, 1, 3, none)</span><br><span class="line">DEF(    for_of_next, 2, 3, 5, u8)</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šè¿°å­—èŠ‚ç å®šä¹‰é‡Œå¯ä»¥çœ‹åˆ°ï¼Œå®šä¹‰çš„å­—èŠ‚ç å¯¹åº”çš„æ˜¯ JavaScript çš„ forâ€¦in å’Œ forâ€¦of è¯­æ³•ã€‚forâ€¦in æ˜¯ç”¨åœ¨å¯¹è±¡çš„éå†ï¼Œä¼šéå†æ‰€æœ‰å¯¹è±¡ä»¥å­—ç¬¦ä¸²ä¸ºé”®çš„æšä¸¾å±æ€§ï¼Œä¹ŸåŒ…æ‹¬ç»§æ‰¿çš„å±æ€§ã€‚forâ€¦of è¯­å¥æ˜¯åœ¨å¯è¿­ä»£å¯¹è±¡ä¸Šåˆ›å»ºè¿­ä»£çš„å¾ªç¯ï¼Œè¿™æ ·çš„å¯¹è±¡æœ‰å­—ç¬¦ä¸²ã€æ•°ç»„ã€å‚æ•°ã€NodeListã€TypedArrayã€Mapã€Setç­‰ã€‚forâ€¦in ä¼šé€šè¿‡ build_for_in_iterator å‡½æ•°æ¥å¤„ç†ï¼Œforâ€¦of ä¼šç”¨ JS_GetIterator å‡½æ•°é‡Œçš„ JS_CreateAsyncFromSyncIterator å‡½æ•°åˆ›å»ºæ‰€éœ€çš„è¿­ä»£çš„å¾ªç¯ã€‚</p>
<p>è·å–å±æ€§çš„å­—èŠ‚ç æ“ä½œç¬¦æ˜¯ OP_get_fieldï¼ŒJS_CallInternal å‡½æ•°ä¼šè°ƒç”¨çš„æ˜¯ JS_GetPropertyã€‚OP_put_field æ˜¯è®¾ç½®ç±»å±æ€§ï¼ŒJS_CallInternal å‡½æ•°ä¼šè°ƒç”¨ JS_SetPropertyInternal å‡½æ•°ã€‚åˆ›å»ºä¸€ä¸ªæ–°å±æ€§ä½¿ç”¨çš„æ˜¯ OP_define_field å­—èŠ‚ç æ“ä½œç¬¦ã€‚ç§æœ‰å±æ€§çš„è·å–ã€è®¾ç½®ã€å®šä¹‰å­—èŠ‚ç è°ƒç”¨çš„å‡½æ•°åˆ†åˆ«æ˜¯ JS_GetPrivateFieldã€JS_SetPrivateFieldã€JS_DefinePrivateFieldã€‚å±æ€§è·å–ä¼šè°ƒç”¨çš„æ˜¯ find_own_property å‡½æ•°ï¼Œè®¾ç½®å±æ€§ä¼šåœ¨è°ƒç”¨å±æ€§åŸºç¡€ä¸Šå¤šè°ƒç”¨ set_value å‡½æ•°å¯¹å±æ€§å€¼è¿›è¡Œè®¾ç½®ï¼Œå®šä¹‰ä¼šå¤šè°ƒç”¨ add_property å‡½æ•°ï¼Œadd_property å‡½æ•°ä¼šå…ˆæ£€æŸ¥æ˜¯å¦å…ˆå‰å·²ç»å®šä¹‰è¿‡ï¼Œå¦‚æœæ²¡æœ‰å°±ä¼šè°ƒç”¨ add_shape_property å‡½æ•°æ–°å»ºå±æ€§ã€‚åˆ é™¤å±æ€§ä¼šè°ƒç”¨ delete_property å‡½æ•°ã€‚</p>
<p>ç§æœ‰ç¬¦å· private symbol å¯¹åº”çš„å­—èŠ‚ç æ“ä½œç¬¦æ˜¯ OP_private_symbolï¼Œè°ƒç”¨çš„æ˜¯ JS_NewSymbolFromAtom å‡½æ•°ï¼Œå‚æ•° atom_type ä¸º JS_ATOM_TYPE_PRIVATEã€‚<a href="https://github.com/zenparsing/proposal-private-symbols">private symbol ææ¡ˆ</a>å’Œ private field çš„ææ¡ˆä¸€æ ·éƒ½åœ¨å®Œæˆçš„æœ€åä¸€ä¸ªé˜¶æ®µã€‚ä»¥å‰å®ä¾‹çš„å±æ€§æ˜¯å¯ä»¥è¢«å¤–éƒ¨çš„ä»£ç ä¿®æ”¹ï¼Œæ²¡æ³•ä¿æŠ¤ï¼Œä¸€äº›åº“ä¼šç”¨ä¸‹åˆ’çº¿å­—ç¬¦ä½œä¸ºå‰ç¼€æ ‡è®°å±æ€§ä¸ºç§æœ‰ï¼ŒTypeScript é ç¼–è¯‘å™¨æ¥æ£€æŸ¥ç§æœ‰å±æ€§å¦ä¼šè¢«å¤–éƒ¨ä¿®æ”¹ã€‚å¦ä¸€ç§æ–¹æ³•å°±æ˜¯å†…éƒ¨ä½¿ç”¨é—­åŒ…éšè—å±æ€§ï¼ŒæŠŠå±æ€§å’Œå¤–éƒ¨ä»£ç çš„ä¿®æ”¹éš”ç¦»å¼€ï¼Œç¼ºç‚¹å°±æ˜¯æ¯ä¸ªå®ä¾‹éƒ½è¦é¢å¤–ä¸ºç§æœ‰çš„å±æ€§åˆ›å»ºé—­åŒ…ã€‚private symbol è¯­æ³•èƒ½èµ·åˆ°ä¿æŠ¤ç§æœ‰å±æ€§çš„ä½œç”¨ï¼Œåœ¨æ ‡å‡†å’Œè¯­æ³•å±‚é¢æ”¯æŒï¼Œè€Œä¸ä¾èµ–ä¸‰æ–¹å®šåˆ¶ç¼–è¯‘è§„åˆ™æˆ–é¢å¤–åŠ é—­åŒ…ä¿æŠ¤ã€‚ç¼–å†™ private symbol ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s1 = <span class="built_in">Symbol</span>(<span class="string">&#x27;s&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> s2 = <span class="built_in">Symbol</span>(<span class="string">&#x27;s&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;s1 æ˜¯å¦ç­‰äº s1ï¼š &quot;</span> + (s1 === s2));</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç æ‰§è¡Œçš„ç»“æœæ˜¯ falseï¼Œè¡¨ç¤ºå³ä½¿ Symbol å‚æ•°æ˜¯ç›¸åŒå­—ç¬¦ä¸²ï¼Œè¿”å›çš„ symbol éƒ½æ˜¯å”¯ä¸€çš„ã€‚private symbol å­—èŠ‚ç å¤„ç†å‡½æ•° JS_NewSymbolFromAtom å‚æ•° atom_type å¯¹åº”çš„æ˜¯ JS_ATOM_TYPE_PRIVATEï¼ŒJS_NewSymbolFromAtom å‡½æ•°è°ƒç”¨é“¾æ˜¯ JS_NewSymbolFromAtom -&gt; JS_NewSymbol -&gt; <code>__JS_NewAtom</code>ï¼Œ <code>__JS_NewAtom</code> å‡½æ•°å¯¹äº atom_type æ˜¯ JS_ATOM_TYPE_PRIVATE ç›¸å…³å¤„ç†ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> &#123;</span></span><br><span class="line">    JS_ATOM_TYPE_STRING = <span class="number">1</span>,</span><br><span class="line">    JS_ATOM_TYPE_GLOBAL_SYMBOL,</span><br><span class="line">    JS_ATOM_TYPE_SYMBOL,</span><br><span class="line">    JS_ATOM_TYPE_PRIVATE,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (atom_type &lt; JS_ATOM_TYPE_SYMBOL) &#123;</span><br><span class="line">    <span class="comment">// çœ‹çœ‹æ˜¯å¦å·²ç»æœ‰ç›¸åŒçš„å­—ç¬¦ä¸²</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// å°è¯•å®šä½å·²æ³¨å†Œçš„ atom</span></span><br><span class="line">    len = str-&gt;len;</span><br><span class="line">    <span class="comment">// è®¡ç®— hash å€¼</span></span><br><span class="line">    h = hash_string(str, atom_type);</span><br><span class="line">    h &amp;= JS_ATOM_HASH_MASK;</span><br><span class="line">    <span class="comment">// h1 çš„ä½œç”¨æ˜¯ç”¨æ¥ä¿è¯ h æ˜¯åœ¨ hash_size çš„èŒƒå›´é‡Œ</span></span><br><span class="line">    h1 = h &amp; (rt-&gt;atom_hash_size - <span class="number">1</span>);</span><br><span class="line">    i = rt-&gt;atom_hash[h1];</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦æœ‰ç›¸åŒçš„ atom åœ¨ atom_array é‡Œ</span></span><br><span class="line">    <span class="keyword">while</span> (i != <span class="number">0</span>) &#123;</span><br><span class="line">        p = rt-&gt;atom_array[i];</span><br><span class="line">        <span class="keyword">if</span> (p-&gt;hash == h &amp;&amp;</span><br><span class="line">            p-&gt;atom_type == atom_type &amp;&amp;</span><br><span class="line">            p-&gt;len == len &amp;&amp;</span><br><span class="line">            js_string_memcmp(p, str, len) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!__JS_AtomIsConst(i))</span><br><span class="line">                p-&gt;header.ref_count++;</span><br><span class="line">            <span class="keyword">goto</span> done;</span><br><span class="line">        &#125;</span><br><span class="line">        i = p-&gt;hash_next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// å¤„ç† symbol ç±»å‹</span></span><br><span class="line">    h1 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (atom_type == JS_ATOM_TYPE_SYMBOL) &#123;</span><br><span class="line">        h = JS_ATOM_HASH_SYMBOL;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// private symbol åœ¨åé¢çš„å¤„ç†å’Œ symbol ä¸€æ ·</span></span><br><span class="line">        h = JS_ATOM_HASH_PRIVATE;</span><br><span class="line">        atom_type = JS_ATOM_TYPE_SYMBOL;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢ QuickJS å¯¹äº private symbol çš„å¤„ç†å¯ä»¥çœ‹å‡ºï¼Œä¾æ®æšä¸¾å®šä¹‰å°äº JS_ATOM_TYPE_SYMBOL ç±»å‹çš„æ˜¯å­—ç¬¦ä¸²å’Œå…¨å±€ symbolï¼Œä»–ä»¬ä¼šåšå»é‡å¤„ç†ï¼Œä¼šæ£€æŸ¥å…ˆå‰æ˜¯å¦æœ‰æ³¨å†Œï¼Œå¦‚æœæœ‰å°±ä¼šå¤ç”¨ï¼Œå¯¹äº symbol ç±»å‹æ— è®ºæ˜¯ symbol è¿˜æ˜¯ private symbol éƒ½ä¼šæŒ‰ç…§ä¸å¤ç”¨ï¼Œæ¯ä¸ªéƒ½ä½¿ç”¨æ–°å»ºçš„æ–¹å¼æ¥å¤„ç†ã€‚</p>
<p>è®¾ç½®å¯¹è±¡æ“ä½œç¬¦æ˜¯ OP_set_name å’Œ OP_set_name_computedã€‚å…¶ä¸­ OP_set_name_computed ç”¨æ¥è®¾ç½®è®¡ç®—çš„å±æ€§åï¼Œè®¡ç®—çš„å±æ€§åè¯­æ³•æ˜¯åœ¨ ECMAScript 2015 æ ‡å‡†é‡Œå¼€å§‹æ”¯æŒçš„ã€‚è¯¥è¯­æ³•å…è®¸åœ¨[]ä¸­åŠ å…¥è¡¨è¾¾å¼ï¼Œè¿™ä¸ªè¡¨è¾¾å¼ä¼šå°†è®¡ç®—ç»“æœä½œä¸ºå±æ€§åã€‚æ¯”å¦‚ä¸‹é¢ js ä»£ç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> num = <span class="number">1</span></span><br><span class="line"><span class="keyword">const</span> o = &#123;[<span class="string">&#x27;k&#x27;</span> + num]: <span class="number">1</span>&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ o.k1 æ¥è·å– k1 é”®å¯¹åº”çš„å€¼1ã€‚è®¡ç®—çš„å±æ€§åä¹Ÿå¯ä»¥ç”¨æ¨¡æ¿å­—å…ƒï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> num = <span class="number">1</span></span><br><span class="line"><span class="keyword">const</span> o = &#123;[<span class="string">`k<span class="subst">$&#123;num&#125;</span>`</span>]: <span class="number">1</span>&#125;</span><br></pre></td></tr></table></figure>
<p>QuickJS å¯¹å¯¹è±¡è®¾ç½®å’Œè®¡ç®—çš„å±æ€§åå¯¹è±¡è®¾ç½®çš„å‡½æ•°åˆ†åˆ«æ˜¯ JS_DefineObjectName å’Œ JS_DefineObjectNameComputedï¼Œä»–ä»¬éƒ½ä¼šé€šè¿‡ JS_isObject å‡½æ•°æ£€æŸ¥æ˜¯å¦æ˜¯å¯¹è±¡ç±»å‹ï¼Œjs_object_has_name å‡½æ•°åˆ¤æ–­æ˜¯å¦æ˜¯æœ‰é”®åå¯¹è±¡ï¼ŒJS_DefinePropertyValue å‡½æ•°è®¾ç½®å±æ€§å€¼ã€‚ä¸åŒçš„æ˜¯è®¡ç®—çš„å±æ€§åä¼šè°ƒç”¨ js_get_function_name æ¥å¤„ç†å±æ€§åè®¡ç®—é—®é¢˜ã€‚</p>
<p>å®šä¹‰æ–¹æ³•å­—èŠ‚ç æ“ä½œç¬¦æ˜¯ OP_define_methodï¼Œå…ˆä»å †æ ˆå–å‡ºæŒæœ‰æ–¹æ³•çš„å¯¹è±¡ï¼Œç„¶åå†è°ƒç”¨ js_method_set_properties å‡½æ•°è®¾ç½®æ–¹æ³•ä¸ºå¯¹è±¡çš„å±æ€§ï¼Œç„¶åé€šè¿‡ JS_DefineProperty æ¥å®šä¹‰è®¾ç½®çš„å±æ€§ã€‚</p>
<p>å®šä¹‰ç±»ä½¿ç”¨çš„æ˜¯ js_op_define_class å‡½æ•°ï¼Œjs_op_define_class ä¼šå…ˆå¤„ç†æœ‰çˆ¶ç±»å’Œæ— çˆ¶ç±»çš„æƒ…å†µï¼Œè°ƒç”¨ JS_NewObjectProtoClass å‡½æ•°åˆ›å»ºç±»å¯¹è±¡ï¼Œè¿”å› JSValueï¼Œå°†è¿™ä¸ªå€¼ä¼ å…¥ js_closure2 è·å–ç±»çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»å¯¹åº”çš„å­—èŠ‚ç ã€home_objectã€å˜é‡ç­‰ã€‚js_method_set_home_object å‡½æ•°è®¾ç½® home_objectï¼Œä½¿ç”¨ JS_DefinePropertyValue æ¥å®šä¹‰å±æ€§å€¼ï¼Œè®¡ç®—çš„å±æ€§ç”¨ JS_DefineObjectNameComputed å‡½æ•°ï¼Œæ„é€ å‡½æ•°å±æ€§å¿…é¡»æ˜¯ç¬¬ä¸€ä¸ªï¼Œæ„é€ å‡½æ•°å±æ€§å¯ä»¥è¢«è®¡ç®—çš„å±æ€§è¦†ç›–ã€‚</p>
<p>å®šä¹‰æ•°ç»„å…ƒç´ ä½¿ç”¨å­—èŠ‚ç æ“ä½œç¬¦æ˜¯ OP_define_array_elï¼Œè°ƒç”¨ JS_DefinePropertyValueValue å‡½æ•°ï¼Œæ’å…¥æ•°ç»„å…ƒç´ ç”¨çš„æ˜¯ OP_appendï¼Œè°ƒç”¨ js_append_enumerate å‡½æ•°ã€‚è·å–å¯¹è±¡çš„å±æ€§å’Œè®¾ç½®å¯¹è±¡çš„å±æ€§å‡½æ•°åˆ†åˆ«æ˜¯ JS_GetPropertyValue å’Œ JS_SetPropertyValue å‡½æ•°ã€‚å¯¹è±¡çš„å±æ€§å…¶å®åœ¨ js è¯­æ³•ä¸­è¢«åŒ…è£…æˆä¸åŒçš„æ¦‚å¿µï¼Œæ¯”å¦‚æ•°ç»„çš„å±æ€§å…¶å®å°±æ˜¯æ•°ç»„çš„å…ƒç´ ï¼Œå› æ­¤ä¸‹é¢è¿™äº›å­—èŠ‚ç éƒ½ä¼šç”¨åˆ°è·å–å¯¹è±¡å±æ€§å’Œè®¾ç½®å¯¹è±¡å±æ€§çš„å‡½æ•°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DEF(   get_array_el, 1, 2, 1, none)</span><br><span class="line">DEF(  get_array_el2, 1, 2, 2, none) /* obj prop -&gt; obj value */</span><br><span class="line">DEF(   put_array_el, 1, 3, 0, none)</span><br><span class="line">DEF(get_super_value, 1, 3, 1, none) /* this obj prop -&gt; value */</span><br><span class="line">DEF(put_super_value, 1, 4, 0, none) /* this obj prop value -&gt; */</span><br><span class="line">DEF(  get_ref_value, 1, 2, 3, none)</span><br><span class="line">DEF(  put_ref_value, 1, 3, 0, none)</span><br></pre></td></tr></table></figure>
<p>OP_add æ˜¯åŠ æŒ‡ä»¤å­—èŠ‚ç æ“ä½œç¬¦ï¼ŒOP_add ä¼šå…ˆä» sp æ ˆé‡Œå–å‡ºå¾…ç›¸åŠ ä¸¤ä¸ªæ•°ï¼Œä½¿ç”¨ JS_VALUE_IS_BOTH_INT å’Œ JS_VALUE_IS_BOTH_FLOAT å‡½æ•°åˆ¤æ–­ä¸¤ä¸ªæ•°æ˜¯å¦ç±»å‹ä¸€æ ·ï¼Œç›¸åŒçš„è¯å¯ä»¥ç›´æ¥ç›¸åŠ ï¼Œæ•´æ•°çš„è¯å…ˆä½¿ç”¨64ä½è®¡ç®—ï¼Œç„¶åç”¨32ä½æ¯”è¾ƒæ˜¯å¦ç›¸åŒï¼Œä¸åŒçš„è¯ goto åˆ° add_slow label ä¸­è¿›è¡Œè®¡ç®—ã€‚int å’Œ float å¤–çš„æ¯”å¦‚ big int ç­‰ç§‘å­¦è®¡ç®—ä¹Ÿ goto åˆ° add_slow ä¸­è®¡ç®—ï¼Œadd_slow label é‡Œå®é™…è°ƒç”¨çš„æ˜¯ js_add_slow å‡½æ•°ã€‚å‡ã€ä¹˜ã€é™¤çš„å­—èŠ‚ç æ“ä½œç¬¦å¯¹åº”çš„åˆ†åˆ«æ˜¯ OP_subã€OP_mulã€OP_divï¼Œå…¶å®ç°å’ŒåŠ å­—èŠ‚ç æ“ä½œç¬¦ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯ä»–ä»¬çš„å¤æ‚è®¡ç®—éƒ½ä¼š goto åˆ° binary_arith_slow labelï¼Œè°ƒç”¨çš„æ˜¯ js_binary_arith_slow å‡½æ•°ã€‚ä¸€å…ƒè®¡ç®—å­—èŠ‚ç æ“ä½œç¬¦ OP_plusã€OP_negã€OP_incã€OP_decã€OP_inc_locã€OP_dec_locï¼Œä»–ä»¬çš„å¤æ‚è®¡ç®—ä¼šè°ƒç”¨ js_unary_arith_slow å‡½æ•°ã€‚é€»è¾‘è®¡ç®— OP_shlã€OP_sarã€OP_andã€OP_orã€OP_xorï¼Œå¤æ‚è®¡ç®—ä¼šè°ƒç”¨ js_binary_logic_slow å‡½æ•°ã€‚</p>
<p>OP_to_object å­—èŠ‚ç æ“ä½œç¬¦ä¼šæ ¹æ®æ ˆä¸­å®šä¹‰å¯¹è±¡ç±»å‹æ¥å°†ä¸€äº›éå¯¹è±¡ç±»å‹è½¬ä¸ºå¯¹è±¡ï¼Œè°ƒç”¨çš„æ˜¯ JS_ToObject å‡½æ•°ï¼Œå†…ä¸»è¦æ˜¯è°ƒç”¨ JS_NewObjectFromShape å‡½æ•°æ¥å¤„ç†ï¼Œç±»å‹ class_id æ¥åŒºåˆ†ä¸åŒçš„æ•°æ®ç±»å‹ã€‚OP_to_propkey å’Œ OP_to_propkey2 æ˜¯å°†é”®å€¼çš„ç±»å‹è½¬ä¸ºé”®å¯æ”¯æŒçš„å­—èŠ‚ç æ“ä½œç¬¦ï¼Œå…¶ä¸»è¦å¤„ç†å°±æ˜¯é™¤äº†æ•´å‹ã€å­—ç¬¦ä¸²å’Œ symbol å¤–ç±»å‹é€šè¿‡ JS_ToStringInternal å‡½æ•°è½¬åŒ–ä¸ºå­—ç¬¦ JSValue ç±»å‹ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ä»‹ç»&quot;&gt;&lt;a href=&quot;#ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;ä»‹ç»&quot;&gt;&lt;/a&gt;ä»‹ç»&lt;/h2&gt;&lt;p&gt;æœ€è¿‘åœ¨åš JavaScript å’Œ Native æ‰“äº¤é“çš„å·¥ä½œï¼Œè™½ç„¶6å¹´å‰æœåŠ¡ç«¯å’Œå‰ç«¯åŒ…æ‹¬ JavaScript ç»éªŒä¹Ÿæœ‰äº›ï¼Œä¸è¿‡å¦‚ä»Šå‰ç«¯æ ‡
    
    </summary>
    
      <category term="Programming" scheme="http://ming1016.github.io/categories/Programming/"/>
    
    
      <category term="Web" scheme="http://ming1016.github.io/tags/Web/"/>
    
      <category term="ç¼–è¯‘" scheme="http://ming1016.github.io/tags/%E7%BC%96%E8%AF%91/"/>
    
      <category term="JavaScript" scheme="http://ming1016.github.io/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>App å¯åŠ¨æé€Ÿå®è·µå’Œä¸€äº›æƒ³æ³•</title>
    <link href="http://ming1016.github.io/2020/12/18/thinking-in-how-to-speed-up-app/"/>
    <id>http://ming1016.github.io/2020/12/18/thinking-in-how-to-speed-up-app/</id>
    <published>2020-12-18T08:14:09.000Z</published>
    <updated>2021-04-11T14:42:09.930Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/uploads/thinking-in-how-to-speed-up-app/1.png" alt=""></p>
<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¯åŠ¨æ˜¯é—¨é¢ï¼Œå¥½çš„å°è±¡ä¹ŸåŠ©äºç•™å­˜ç‡æé«˜ã€‚è‹¹æœä¹Ÿåœ¨ç³»ç»Ÿå¯åŠ¨ä¸Šä¸æ–­åŠªåŠ›ï¼Œæå‡ç”¨æˆ·ä½“éªŒï¼Œæœ€æ–°çš„ M1 å®£ä¼ ä¸­è¿˜ç‰¹åˆ«å¼ºè°ƒäº†ç¿»ç›–ç§’å¼€ macOSï¼Œå¯ä»¥çœ‹å‡ºå…¶å¯¹æè‡´å¯åŠ¨é€Ÿåº¦çš„è¿½æ±‚ã€‚<a href="https://farfetchtechblog.com/en/blog/post/mobile-app-launch-performance-ii/">è¿™ç¯‡æ–‡ç« </a>æåˆ°ï¼Œæ® <a href="https://wemakewebsites.com/blog/improve-page-load-speed-increase-conversion/">Akamai</a> è°ƒæŸ¥ï¼Œæ¯å¤š1ç§’ç­‰å¾…ï¼Œè½¬åŒ–ç‡ä¼šä¸‹é™7%ï¼ŒKissMetrics çš„ä¸€ä»½æŠ¥å‘Šè¯´å¯åŠ¨è¶…5ç§’ï¼Œä¼šä½¿19%çš„ç”¨æˆ·æ”¾å¼ƒç­‰å¾…å¸è½½ Appã€‚<br><img src="/uploads/thinking-in-how-to-speed-up-app/2.png" alt=""></p>
<p>é«˜å¾· App å¯åŠ¨ä¼˜åŒ–ä¸“é¡¹å®Œæˆåå·²ç»æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œä¸€ç›´ä¿æŒå®å±ä¸æ˜“ï¼Œæˆ‘ä¸€å¹´å‰åœ¨è¿™ç¯‡<a href="https://ming1016.github.io/2019/12/07/how-to-analyze-startup-time-cost-in-ios/">æ–‡ç« </a>é‡Œä¹Ÿåšäº†äº›æ€»ç»“ã€‚æˆ‘è¿™é‡Œå†è¡¥å……äº›å¯åŠ¨ä¼˜åŒ–ç”¨åˆ°ä¸€äº›æ‰‹æ®µå’Œä¸€äº›æƒ³æ³•ï¼Œå¸Œæœ›è¿™äº›èƒ½å¤Ÿå¯¹ä½ æœ‰å¸®åŠ©ã€‚</p>
<h2 id="é€šè¿‡-Universal-Links-å’Œ-App-Links-ä¼˜åŒ–å”¤ç«¯å¯åŠ¨ä½“éªŒ"><a href="#é€šè¿‡-Universal-Links-å’Œ-App-Links-ä¼˜åŒ–å”¤ç«¯å¯åŠ¨ä½“éªŒ" class="headerlink" title="é€šè¿‡ Universal Links å’Œ App Links ä¼˜åŒ–å”¤ç«¯å¯åŠ¨ä½“éªŒ"></a>é€šè¿‡ Universal Links å’Œ App Links ä¼˜åŒ–å”¤ç«¯å¯åŠ¨ä½“éªŒ</h2><p>App éƒ½ä¼šå­˜åœ¨æ‹‰æ–°å’Œå¯¼æµçš„è¯‰æ±‚ï¼Œå¦‚ä½•æé«˜è¿™æ ·åœºæ™¯çš„ç”¨æˆ·ä½“éªŒå‘¢ï¼Ÿè¿™é‡Œä¼šç”¨åˆ°å”¤ç«¯æŠ€æœ¯ã€‚åŒ…å«é€‰æ‹©ä»€ä¹ˆæ ·çš„æ¢ç«¯åè®®ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹å”¤ç«¯è·¯å¾„ï¼Œå¦‚ä¸‹ï¼š<br><img src="/uploads/thinking-in-how-to-speed-up-app/3.png" alt=""></p>
<p>å”¤ç«¯çš„åè®®åˆ†ä¸ºè‡ªå®šä¹‰åè®®å’Œå¹³å°æ ‡å‡†åè®®ï¼Œè‡ªå®šä¹‰åè®®åœ¨ iOS ç«¯ä¼šæœ‰ç³»ç»Ÿæç¤ºå¼¹æ¡†ï¼Œåœ¨ Android ç«¯ chrome 25 åè‡ªå®šä¹‰åè®®å¤±æ•ˆï¼Œéœ€ç”¨ Intent åè®®åŒ…è£…æ‰èƒ½æ‰“å¼€ Appã€‚å¦‚æœå¸Œæœ›æé«˜ä½“éªŒæœ€å¥½ä½¿ç”¨å¹³å°æ ‡å‡†åè®®ã€‚å¹³å°æ ‡å‡†åè®®åœ¨ iOS å¹³å°å« Universal Linksï¼Œåœ¨ iOS 9 å¼€å§‹å¼•å…¥çš„ï¼Œæ‰€ä»¥ iOS 9 åŠä»¥ä¸Šç³»ç»Ÿéƒ½æ”¯æŒï¼Œå¦‚æœç”¨æˆ·å®‰è£…äº†è¦è·³çš„ App å°±ä¼šç›´æ¥è·³åˆ° Appï¼Œä¸ä¼šæœ‰ç³»ç»Ÿå¼¹æ¡†æç¤ºã€‚ç›¸å¯¹åº”çš„ Android å¹³å°æ ‡å‡†åè®®å« App Linksï¼ŒAndroid 6 ä»¥ä¸Šéƒ½æ”¯æŒã€‚</p>
<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ iOS çš„ Universal Links ä¸æ”¯æŒè‡ªåŠ¨å”¤ç«¯ï¼Œä¹Ÿå°±æ˜¯é¡µé¢åŠ è½½åè‡ªåŠ¨æ‰§è¡Œå”¤ç«¯æ˜¯ä¸è¡Œçš„ï¼Œéœ€è¦ç”¨æˆ·ä¸»åŠ¨ç‚¹å‡»è¿›è¡Œå”¤ç«¯ã€‚å¯¹äºè‡ªå®šä¹‰åè®®å’Œå¹³å°æ ‡å‡†åè®®åœ¨æœ‰äº› App é‡Œæ˜¯é‡åˆ°å±è”½æˆ–è€…é‚£äº› App è‡ªå®šä¹‰å¼¹çª—æç¤ºï¼Œè¿™å°±åªèƒ½é€šè¿‡æ²Ÿé€šåŠ ç™½æ¥è§£å†³äº†ã€‚</p>
<p>å¦å¤–å¯¹äºå¯åŠ¨æ—¶å±•ç¤º H5 å¯åŠ¨é¡µï¼Œæˆ–å”¤ç«¯è·³è½¬ç‰¹å®šåŠŸèƒ½é¡µï¼Œå¯ä»¥å°†æ‹¦æˆªåˆ¤æ–­ç½®å‰ï¼Œåˆ¤æ–­å‡ºå¯åŠ¨å»å¾€åŠŸèƒ½é¡µï¼Œä¼˜å…ˆåŠ è½½åŠŸèƒ½é¡µçš„ä»»åŠ¡ï¼Œä¸»å›¾ç›¸å…³ä»»åŠ¡é¡¹å»¶åå†åŠ è½½ï¼Œä»¥æå‡å¯åŠ¨åˆ°ç‰¹å®šé¡µé¢çš„é€Ÿåº¦ã€‚</p>
<h2 id="H5å¯åŠ¨é¡µ"><a href="#H5å¯åŠ¨é¡µ" class="headerlink" title="H5å¯åŠ¨é¡µ"></a>H5å¯åŠ¨é¡µ</h2><p>ç°åœ¨ App å¯åŠ¨ä¼šåœ¨æœ‰æ´»åŠ¨æ—¶å…ˆå¼¹å‡ºæ´»åŠ¨è¿è¥ H5 é¡µé¢æé«˜æ´»åŠ¨æ›å…‰ç‡ã€‚ä½†å¦‚æœ H5 åŠ è½½æ…¢åŠ¿å¿…éå¸¸å½±å“å¯åŠ¨çš„ä½“éªŒã€‚</p>
<p>iOS çš„è¯å¯ä»¥ä½¿ç”¨ ODR(On-Demand Resources) åœ¨å®‰è£…åå…ˆä¸‹è½½ä¸‹æ¥ï¼Œç‚¹å‡»å¯åŠ¨å‰å®é™…ä¸Šå°±å¯ä»¥ç›´æ¥åŠ è½½æœ¬åœ°çš„äº†ã€‚ODR å®‰è£…åç«‹åˆ»ä¸‹è½½çš„æ¨¡å¼ï¼Œä¸‹è½½èµ„æºä¼šè¢«æ¸…é™¤ï¼Œæ‰€ä»¥éœ€è¦å°†ä¸‹è½½å†…å®¹ç§»åŠ¨åˆ°è‡ªå®šä¹‰çš„åœ°æ–¹ï¼ŒåŒæ—¶è¿˜éœ€è¦åšè‡ªå·±å…œåº•çš„ä¸‹è½½æ¥ä¿è¯åœ¨ On-Demand Resources ä¸‹è½½å¤±è´¥æ—¶ï¼Œè¿˜èƒ½å¤Ÿå†ä»è‡ªå·±å…œåº•æœåŠ¡å™¨ä¸Šæ‹‰ä¸‹èµ„æºã€‚</p>
<p>On-Demand Resources è¿˜èƒ½å¤Ÿæ”¾å¾ˆå¤šèµ„æºï¼Œç”šè‡³åŒ…æ‹¬è„šæœ¬ä»£ç çš„é¢„åŠ è½½ï¼Œå¯ä»¥å‡å°‘åŒ…ä½“ç§¯ã€‚ç”±äºä½¿ç”¨çš„æ˜¯è‹¹æœæœåŠ¡å™¨ï¼Œè¿˜èƒ½å¤Ÿå‡å°‘ CDN äº§ç”Ÿçš„å³°å€¼æˆæœ¬ã€‚</p>
<p>å¦‚æœä¸ä½¿ç”¨ On-Demand Resources ä¹Ÿå¯ä»¥å¯¹ WKWebView è¿›è¡Œé¢„åŠ è½½ï¼Œè™½ç„¶å®‰è£…åç¬¬ä¸€æ¬¡è¿˜æ˜¯éœ€è¦ä»æœåŠ¡å™¨ä¸ŠåŠ è½½ä¸€æ¬¡ï¼Œä¸è¿‡åé¢å°±å¯ä»¥ä»æœ¬åœ°å¿«é€Ÿè¯»å–äº†ã€‚</p>
<p>iOS æœ‰ä¸‰å¥—æ–¹æ¡ˆï¼Œä¸€å¥—æ˜¯é€šè¿‡ WKBrowsingContextController æ³¨å†Œ schemeï¼Œä½¿ç”¨ URLProtocol è¿›è¡Œç½‘ç»œæ‹¦æˆªã€‚ç¬¬äºŒå¥—æ˜¯åŸºäº WKURLSchemeHandler è‡ªå®šä¹‰ scheme æ‹¦æˆªè¯·æ±‚ã€‚ç¬¬ä¸‰å¥—æ˜¯åœ¨æœ¬åœ°æ­å»º local serverï¼Œæ‹¦æˆªç½‘ç»œè¯·æ±‚é‡å®šå‘åˆ°æœ¬åœ° serverã€‚ç¬¬ä¸‰å¥—æ­å»ºæœ¬åœ° server æˆæœ¬é«˜ï¼Œå¯åŠ¨ server æ¯”è¾ƒè€—æ—¶ã€‚ç¬¬äºŒå¥— WKURLSchemeHandler ä½¿ç”¨è‡ªå®šä¹‰ schemeï¼Œå¯¹äº H5 é€‚é…æˆæœ¬å¾ˆé«˜ï¼Œè€Œä¸”éœ€è¦ iOS 11 ä»¥ä¸Šç³»ç»Ÿæ”¯æŒã€‚</p>
<p>ç¬¬ä¸€å¥—æ–¹æ¡ˆæ˜¯ä½¿ç”¨äº† WKBrowsingContextController çš„ registerSchemeForCustomProtocol: è¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„å‚æ•°è®¾ç½®ä¸º http æˆ– https ç„¶åæ‰§è¡Œï¼Œåé¢è¿™ç±» scheme å°±èƒ½å¤Ÿè¢« NSURLProtocol å¤„ç†äº†ï¼Œå…·ä½“å®ç°å¯ä»¥åœ¨<a href="https://github.com/Yeatse/NSURLProtocol-WebKitSupport">è¿™é‡Œ</a>çœ‹åˆ°ã€‚</p>
<p>Android é€šè¿‡ç³»ç»Ÿæä¾›çš„èµ„æºæ‹¦æˆªApiå³å¯å®ç°åŠ è½½æ‹¦æˆªï¼Œæ‹¦æˆªåæ ¹æ®è¯·æ±‚çš„urlè¯†åˆ«èµ„æºç±»å‹ï¼Œå‘½ä¸­åè®¾ç½®å¯¹åº”çš„mimeTypeã€encodingã€fileStreamå³å¯ã€‚</p>
<h2 id="ä¸‹è½½é€Ÿåº¦"><a href="#ä¸‹è½½é€Ÿåº¦" class="headerlink" title="ä¸‹è½½é€Ÿåº¦"></a>ä¸‹è½½é€Ÿåº¦</h2><p><img src="/uploads/thinking-in-how-to-speed-up-app/4.png" alt=""><br>App å®‰è£…å‰çš„ä¸‹è½½é€Ÿåº¦ä¹Ÿç›´æ¥å½±å“åˆ°äº†ç”¨æˆ·ä»é€‰æ‹©ä½ çš„ App åˆ°ä½¿ç”¨çš„ä½“éªŒï¼Œå¦‚æœä¸‹è½½å¤§å°è¿‡å¤§ï¼Œç”¨æˆ·æ²¡æœ‰è€å¿ƒç­‰å¾…ï¼Œå¯èƒ½å°±æ”¾å¼ƒäº†ä½ çš„ Appï¼Œ4G5G ç¯å¢ƒä¸‹è¶… 200MB ä¼šå¼¹çª—æç¤ºæ˜¯å¦ç»§ç»­ä¸‹è½½ï¼Œä¸¥é‡å½±å“è½¬åŒ–ç‡ã€‚</p>
<p>å› æ­¤è¿˜å¯¹ä¸‹è½½å¤§å°åšäº†ä¼˜åŒ–ï¼Œå°† __TEXT å­—æ®µè¿ç§»åˆ°è‡ªå®šä¹‰æ®µï¼Œä½¿å¾— iPhone X ä»¥å‰æœºå™¨çš„ä¸‹è½½å¤§å°å‡å°‘äº†1/3çš„å¤§å°ï¼Œè¿™æ‹›ä¹‹æ‰€ä»¥å¯¹ iPhone X ä»¥å‰æœºå™¨ç®¡ç”¨çš„åŸå› æ˜¯å› ä¸ºå…ˆå‰æœºå™¨æ˜¯æŒ‰ç…§å…ˆåŠ å¯†å†å‹ç¼©ï¼Œå‹ç¼©ç‡ä½ï¼Œè€Œä¹‹åæœºå™¨æ”¹å˜äº†ç­–ç•¥å› æ­¤ä¸‹è½½å¤§å°å°±ä¼šå¤§å¹…å‡å°‘ã€‚Michael Eisel è¿™ç¯‡åšå®¢<a href="https://eisel.me/app-size">ã€ŠOne Quick Way to Drastically Reduce your iOS Appâ€™s Download Sizeã€‹</a> æå‡ºäº†è¿™å¥—æ–¹æ¡ˆï¼Œä½ å¯ä»¥ç«‹åˆ»åº”ç”¨åˆ°è‡ªå·±åº”ç”¨ä¸­ï¼Œæé«˜è€æœºå™¨ä¸‹è½½é€Ÿåº¦ï¼Œæ•ˆæœç«‹ç«¿è§å½±ã€‚</p>
<p>Michael Eisel è¿˜ç”¨ Swift åŒ…è£…äº† <a href="https://github.com/simdjson/simdjson">simdjson</a> å†™äº†ä¸ªåº“ <a href="https://github.com/michaeleisel/ZippyJSON">ZippyJSONDecoder</a> æ¯”ç³»ç»Ÿè‡ªå¸¦ JSONDecoder å¿«ä¸‰å€ï¼Œå¾ˆç¬¦åˆæœ¬ç¯‡â€œè¦æ›´å¿«â€çš„ä¸»é¢˜å¯¹å§ï¼Œäººç±»å¯¹é€Ÿåº¦çš„è¿½æ±‚æ˜¯æ²¡æœ‰æ­¢å¢ƒçš„ï¼Œæœ€è¿‘ YY å¤§ç¥ ibireme ä¹Ÿåœ¨å†™ JSON åº“ <a href="https://github.com/ibireme/yyjson">YYJSON</a> é€Ÿåº¦æ¯” simdjson è¿˜å¿«ã€‚Michael è¿˜å†™ä¸ªäº†æé€Ÿæ„å»ºçš„è‡ªåˆ¶é“¾æ¥å™¨ <a href="https://github.com/michaeleisel/zld">zld</a>ï¼Œé¡¹ç›®è¯´æ˜è¿˜æè¿°äº†å¦‚ä½•å¼€å‘å®šåˆ¶è‡ªå·±çš„é“¾æ¥å™¨ã€‚è¿˜æœ‰ä¸»çº¿ç¨‹é˜»å¡ï¼ˆANRï¼‰æ£€æµ‹çš„ swift ç±» <a href="https://gist.github.com/michaeleisel/77b8efc9bedab1444dbb71a5915dbd15">ANRChecker</a>ï¼Œè¿˜æœ‰é€šè¿‡hook æ–¹å¼è®°å½•ç³»ç»Ÿé”™è¯¯æ—¥å¿—çš„<a href="https://gist.github.com/michaeleisel/8eddd0082b4fd7f2bd118d97e79bf12e">ä¾‹å­</a>å±•ç¤ºå¦‚ä½•é€šè¿‡æˆªè·è‡ªåŠ¨å¸ƒå±€é”™è¯¯ï¼Œå‡½æ•°æ˜¯ UIViewAlertForUnsatisfiableConstraints ï¼Œmalloc é—®é¢˜æ›¿æ¢å‡½æ•°ä¸º malloc_error_break å³å¯ã€‚Michael çš„è¿™äº›æ€§èƒ½é—®é¢˜å¤„ç†æ‰‹æ®µéå¸¸å®ç”¨ï¼ŒçœŸæ˜¯ä¸ªå®è—ç”·å­©ã€‚</p>
<p>é€šè¿‡æ¯æœˆæ–°å¢æ¿€æ´»é‡ã€æµè§ˆåˆ°æ–°å¢æ¿€æ´»è½¬æ¢ç‡ã€ä¸‹è½½åˆ°æ¿€æ´»è½¬æ¢ç‡ã€è½¬æ¢ç‡å—ä½“ç§¯å› ç´ å½±å“å æ¯”ã€æ¯ä¸ªç”¨æˆ·è·å–æˆæœ¬ï¼Œä½¿ç”¨å…¬å¼è®¡ç®—èƒ½å¤Ÿå¾—åˆ°æ¯æœˆæˆæœ¬æ”¶ç›Šï¼ŒæŠŠä½ ä»¬å…¬å¸å¯¹åº”å…·ä½“å‚æ•°æ•°å€¼å¥—åˆ°å…¬å¼ä¸­ï¼Œç®—å‡ºæ¥åä½ ä¼šå‘ç°å¦‚æœé™ä½äº†50å¤šMBï¼Œæ¯æœˆå°±ä¼šæœ‰éå¸¸å¤§çš„æ”¶ç›Šã€‚</p>
<p>å¯¹äº Android æ¥è¯´ï¼Œå¾ˆå¤šåŠŸèƒ½æ˜¯å¯ä»¥æ”¾åœ¨äº‘ç«¯æŒ‰éœ€ä¸‹è½½ä½¿ç”¨ï¼Œåé¢çš„æ–¹å‘æ˜¯é‡äº‘è½»ç«¯ï¼Œäº‘ç«¯ä¸€ä½“ï¼Œæ‰“é€šäº‘ç«¯é“¾è·¯ã€‚</p>
<p>ä¸‹è½½å’Œå®‰è£…å®Œæˆåï¼Œå°±è¦åˆ†æ App å¼€å§‹å¯åŠ¨æ—¶å¦‚ä½•åšä¼˜åŒ–äº†ï¼Œæˆ‘æ¥ä¸‹æ¥è·Ÿä½ è¯´è¯´ Android å¯åŠ¨ so åº“åŠ è½½å¦‚ä½•åšç›‘æ§å’Œä¼˜åŒ–ã€‚</p>
<h2 id="Android-so-åº“åŠ è½½ä¼˜åŒ–"><a href="#Android-so-åº“åŠ è½½ä¼˜åŒ–" class="headerlink" title="Android so åº“åŠ è½½ä¼˜åŒ–"></a>Android so åº“åŠ è½½ä¼˜åŒ–</h2><h3 id="ç¼–è¯‘é˜¶æ®µ-é™æ€åˆ†æä¼˜åŒ–"><a href="#ç¼–è¯‘é˜¶æ®µ-é™æ€åˆ†æä¼˜åŒ–" class="headerlink" title="ç¼–è¯‘é˜¶æ®µ-é™æ€åˆ†æä¼˜åŒ–"></a>ç¼–è¯‘é˜¶æ®µ-é™æ€åˆ†æä¼˜åŒ–</h3><p>ä¾æ‰˜è‡ªåŠ¨åŒ–æ„å»ºå¹³å°ï¼Œé€šè¿‡æ„å»ºé…ç½®å®ç°å¯¹æºç æ¨¡å—çš„çµæ´»é…ç½®ï¼Œè¿›è¡Œå®šåˆ¶åŒ–ç¼–è¯‘ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-ffunction-sections -fdata-sections <span class="comment">// å®ç°æŒ‰éœ€åŠ è½½</span></span><br><span class="line">-fvisibility=hidden -fvisibility-inlines-hidden <span class="comment">// å®ç°ç¬¦å·éšè—</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å¯ä»¥é¿å…æ— ç”¨æ¨¡å—çš„å¼•å…¥ï¼Œæ•ˆæœå¦‚ä¸‹å›¾ï¼š<br><img src="/uploads/thinking-in-how-to-speed-up-app/7.png" alt=""></p>
<h3 id="è¿è¡Œé˜¶æ®µ-hookåˆ†æä¼˜åŒ–"><a href="#è¿è¡Œé˜¶æ®µ-hookåˆ†æä¼˜åŒ–" class="headerlink" title="è¿è¡Œé˜¶æ®µ-hookåˆ†æä¼˜åŒ–"></a>è¿è¡Œé˜¶æ®µ-hookåˆ†æä¼˜åŒ–</h3><p>Android Linker è°ƒç”¨æµç¨‹å¦‚ä¸‹ï¼š<br><img src="/uploads/thinking-in-how-to-speed-up-app/5.png" alt=""><br>æ³¨æ„ï¼Œfind_library åŠ è½½æˆåŠŸåè¿”å› soinfo å¯¹è±¡æŒ‡é’ˆï¼Œç„¶åè°ƒç”¨å…¶ call_constructors æ¥è°ƒç”¨ so çš„ init_arrayã€‚call_constructors è°ƒç”¨ call_arrayï¼Œå…¶å†…éƒ¨å¾ªç¯è°ƒç”¨ call_funtion æ¥è®¿é—® init_array æ•°ç»„çš„è°ƒç”¨ã€‚</p>
<p>é«˜å¾·Androidå°ä¼™ä¼´ä»¬åŸºäº <a href="https://github.com/frida/frida-gum">frida-gum</a> çš„ hook å¼•æ“å¼€å‘äº†çº¿ä¸‹æ€§èƒ½ç›‘æ§å·¥å…·ï¼Œå¯ä»¥ hook c++ åº“ï¼Œæ”¯æŒ macosã€androidã€iosï¼Œé’ˆå¯¹ so çš„å…¨å±€æ„é€ æ—¶é—´å’Œé“¾æ¥æ—¶é—´è¿›è¡Œ hookï¼Œå¯¹å…³é”® so åŠ è½½çš„å…³é”®èŠ‚ç‚¹è€—æ—¶è¿›è¡Œåˆ†æã€‚dlopen ç›¸å…³ hook ç›‘æ§ç‚¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">target_func_t</span> android_funcs_22[] = &#123;</span><br><span class="line">    &#123;<span class="string">&quot;__dl_dlopen&quot;</span>, <span class="number">0</span>, (<span class="keyword">void</span> *)my_dlopen&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;__dl_ZL12find_libraryPKciPK12android_dlextinfo&quot;</span>, <span class="number">0</span>, (<span class="keyword">void</span> *)my_find_library&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;__dl_ZN6soinfo16CallConstructorsEv&quot;</span>, <span class="number">0</span>, (<span class="keyword">void</span> *)my_soinfo_CallConstructors&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;__dl_ZN6soinfo9CallArrayEPKcPPFvvEjb&quot;</span>, <span class="number">0</span>, (<span class="keyword">void</span> *)my_soinfo_CallArray&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">target_func_t</span> android_funcs_28[] = &#123;</span><br><span class="line">    &#123;<span class="string">&quot;__dl_Z9do_dlopenPKciPK17android_dlextinfoPKv&quot;</span>, <span class="number">0</span>, (<span class="keyword">void</span> *)my_do_dlopen_28&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;__dl_Z14find_librariesP19android_namespace&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;__dl_ZN6soinfo17call_constructorsEv&quot;</span>, <span class="number">0</span>, (<span class="keyword">void</span> *)my_soinfo_CallConstructors&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;__dl_ZL10call_arrayIPFviPPcS1_EEvPKcPT_jbS5_&quot;</span>, <span class="number">0</span>, (<span class="keyword">void</span> *)my_call_array_28&lt;constructor_func&gt;&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;__dl_ZN6soinfo10link_imageERK10LinkListIS&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;__dl_g_argc&quot;</span>, <span class="number">0</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;__dl_g_argv&quot;</span>, <span class="number">0</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;__dl_g_envp&quot;</span>, <span class="number">0</span>, <span class="number">0</span>&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>android ç‰ˆæœ¬ä¸åŒå¯¹åº” hook æ–¹æ³•æœ‰æ‰€ä¸åŒï¼Œè¦æ³¨æ„å½“ so æœ‰å…¶ä»–å¤–éƒ¨é“¾æ¥ä¾èµ–æ—¶ï¼Œé’ˆå¯¹ dlopen çš„ç›‘æ§æ•°æ®ï¼Œä¸åªåŒ…æ‹¬è‡ªèº«éƒ¨åˆ†ï¼Œä¹ŸåŒ…æ‹¬ä¾èµ–çš„ so éƒ¨åˆ†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œso åŠ è½½é¡ºåºä¹Ÿä¼šäº§ç”Ÿå¾ˆå¤§çš„å½±å“ã€‚</p>
<p>JNI_OnLoad çš„ hook ç›‘æ§ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> ABTOR_ANDROID</span></span><br><span class="line"><span class="function">jint <span class="title">my_JNI_ONLoad</span><span class="params">(JavaVM* vm, <span class="keyword">void</span>* reserved)</span> </span>&#123;</span><br><span class="line">    asl::HookEngine::HoolContext *ctx = asl::HookEngine::getHookContext();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">uint64_t</span> start = PerfUtils::getTickTime();</span><br><span class="line">    jint res = asl::CastFuncPtr(my_JNI_OnLoad, ctx-&gt;org_func)(vm, reserved);</span><br><span class="line">    <span class="keyword">int</span> duration = (<span class="keyword">int</span>)(PerfUtils::getTickTime() - start);</span><br><span class="line"></span><br><span class="line">    LibLoaderMonitorImpl *monitor = (LibLoaderMonitorImpl*)LibLoaderMonitor::getInstance();</span><br><span class="line">    monitor-&gt;addOnloadInfo(ctx-&gt;user_data, duration);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šä»£ç æ‰€ç¤ºï¼Œlinker çš„ dlopen å®ŒæˆåŠ è½½ï¼Œç„¶åè°ƒç”¨ dlsym æ¥è°ƒç”¨ç›®æ ‡ so çš„ JNI_OnLoadï¼Œå®Œæˆ JNI æ¶‰åŠçš„åˆå§‹åŒ–æ“ä½œã€‚</p>
<p>åŠ è½½ so éœ€è¦æ³¨æ„å¹¶è¡Œå‡ºç° loadLibrary0 é”çš„é—®é¢˜ï¼Œè¿™æ ·ä¼šè®©å¤šçº¿ç¨‹å‘ç”Ÿç­‰é”ç°è±¡ã€‚å¯ä»¥å‡å°‘å¹¶å‘åŠ è½½ï¼Œä½†ä¸èƒ½ç®€å•æŠŠæ•´ä¸ªåŠ è½½è¿‡ç¨‹æ”¾åˆ°ä¸²è¡Œä»»åŠ¡é‡Œï¼Œè¿™æ ·è€—æ—¶å¯èƒ½ä¼šæ›´é•¿ï¼Œå¹¶ä¸”æ²¡æ³•å……åˆ†åˆ©ç”¨èµ„æºã€‚æ¯”è¾ƒå¥½çš„åšæ³•æ˜¯ï¼Œå°†è€—æ—¶å°‘çš„ä¸²è¡Œèµ·æ¥åŒæ—¶å¹¶è¡Œè€—æ—¶é•¿çš„ so åŠ è½½ã€‚</p>
<p>è‡³æ­¤å®Œæˆäº† so çš„åˆå§‹åŒ–å’Œé“¾æ¥çš„ç›‘æ§ã€‚</p>
<p>è¯´å®Œ Androidï¼Œé‚£ä¹ˆ iOS çš„åŠ è½½æ˜¯æ€æ ·çš„ï¼Œå¦‚ä½•ä¼˜åŒ–å‘¢ï¼Ÿæˆ‘æ¥ç€è·Ÿä½ è¯´ã€‚</p>
<h2 id="App-åŠ è½½"><a href="#App-åŠ è½½" class="headerlink" title="App åŠ è½½"></a>App åŠ è½½</h2><p>_dyld_start ä¹‹å‰åšäº†ä»€ä¹ˆï¼Œdyld_start æ˜¯è°è°ƒç”¨çš„ï¼Œé€šè¿‡æŸ¥çœ‹<a href="https://opensource.apple.com/tarballs/xnu/">xnuçš„æºç </a>å¯ä»¥ç†å‡ºï¼Œå½“ App ç‚¹å‡»åä¼šé€šè¿‡__mac_execve å‡½æ•° fork è¿›ç¨‹ï¼ŒåŠ è½½è§£æ Mach-O æ–‡ä»¶ï¼Œè°ƒç”¨ exec_activate_image() å¼€å§‹æ¿€æ´» image çš„è¿‡ç¨‹ã€‚å…ˆæ ¹æ® image ç±»å‹æ¥é€‰æ‹© imgactï¼Œå¼€å§‹ load_machfileï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šå…ˆè§£æ Mach-Oï¼Œè§£æåä¾æ®å…¶ä¸­çš„ LoadCommand å¯åŠ¨ dyldã€‚æœ€åä½¿ç”¨ activate_exec_state() å¤„ç†ç»“æ„ä¿¡æ¯ï¼Œthread_setentrypoint() è®¾ç½® entry_point Appçš„å…¥å£ç‚¹ã€‚</p>
<p>_dyld_start ä¹‹åè¦å°‘äº›åŠ¨æ€åº“ï¼Œå› ä¸ºé“¾æ¥è€—æ—¶ï¼›å°‘äº› +loadã€C çš„ constructor å‡½æ•°å’Œ C++ é™æ€å¯¹è±¡ï¼Œå› ä¸ºè¿™äº›ä¼šåœ¨å¯åŠ¨é˜¶æ®µæ‰§è¡Œï¼Œå¤šäº†å°±ä¼šå½±å“å¯åŠ¨æ—¶é—´ã€‚å› æ­¤ï¼Œæ²¡æœ‰ç”¨çš„ä»£ç å°±éœ€è¦å®šæœŸæ¸…ç†å’Œçº¿ä¸Šç›‘æ§ã€‚é€šè¿‡å…ƒç±»ä¸­flagçš„æ–¹å¼è¿›è¡Œç›‘æ§ç„¶åå®šæœŸæ¸…ç†ã€‚</p>
<h2 id="iOS-ä¸»çº¿ç¨‹æ–¹æ³•è°ƒç”¨æ—¶é•¿æ£€æµ‹"><a href="#iOS-ä¸»çº¿ç¨‹æ–¹æ³•è°ƒç”¨æ—¶é•¿æ£€æµ‹" class="headerlink" title="iOS ä¸»çº¿ç¨‹æ–¹æ³•è°ƒç”¨æ—¶é•¿æ£€æµ‹"></a>iOS ä¸»çº¿ç¨‹æ–¹æ³•è°ƒç”¨æ—¶é•¿æ£€æµ‹</h2><p>+load æ–¹æ³•æ—¶é—´ç»Ÿè®¡ï¼Œä½¿ç”¨è¿è¡Œæ—¶ swizzling çš„æ–¹å¼ï¼Œå°†ç»Ÿè®¡ä»£ç æ”¾åˆ°é“¾æ¥é¡ºåºçš„æœ€å‰é¢å³å¯ã€‚é™æ€åˆå§‹åŒ–å‡½æ•°åœ¨ DATA çš„ mod_init_func åŒºï¼Œå…ˆæŠŠé‡Œé¢åŸå§‹å‡½æ•°åœ°å€ä¿å­˜ï¼Œå‰ååŠ ä¸Šè‡ªå®šä¹‰å‡½æ•°è®°å½•æ—¶é—´ã€‚</p>
<p>åœ¨ Linuxä¸Š æœ‰ strace å·¥å…·ï¼Œè¿˜æœ‰åº“è·Ÿè¸ªå·¥å…· ltraceï¼ŒOSX æœ‰åŒ…è£…äº† dtrace çš„ instruments å’Œ dtruss å·¥å…·ï¼Œä¸è¿‡åœ¨æŸäº›åœºæ™¯éœ€æ±‚ä¸‹ä¸å¥½ç”¨ã€‚objc_msgSend å®é™…ä¸Šä¼šé€šè¿‡åœ¨ç±»å¯¹è±¡ä¸­æŸ¥æ‰¾é€‰æ‹©å™¨åˆ°å‡½æ•°çš„æ˜ å°„æ¥é‡å®šå‘æ‰§è¡Œåˆ°å®ç°å‡½æ•°ã€‚ä¸€æ—¦å®ƒæ‰¾åˆ°äº†ç›®æ ‡å‡½æ•°ï¼Œå®ƒå°±ä¼šç®€å•åœ°è·³è½¬åˆ°é‚£é‡Œï¼Œè€Œä¸å¿…é‡æ–°è°ƒæ•´å‚æ•°å¯„å­˜å™¨ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘æŠŠå®ƒç§°ä¸ºè·¯ç”±æœºåˆ¶ï¼Œè€Œä¸æ˜¯æ¶ˆæ¯ä¼ é€’ã€‚Objective-C çš„ä¸€ä¸ªæ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œå †æ ˆå’Œå¯„å­˜å™¨æ˜¯ä¸º objc_msgSend è°ƒç”¨é…ç½®çš„ï¼Œobjc_msgSend è·¯ç”±æ‰§è¡Œã€‚objc_msgSend ä¼šåœ¨ç±»å¯¹è±¡ä¸­æŸ¥æ‰¾å‡½æ•°è¡¨å¯¹åº”å®šå‘åˆ°çš„å‡½æ•°ï¼Œæ‰¾åˆ°ç›®æ ‡å‡½æ•°å°±è·³è½¬ï¼Œå‚æ•°å¯„å­˜å™¨ä¸ä¼šé‡æ–°è°ƒæ•´ã€‚</p>
<p>å› æ­¤å¯ä»¥åœ¨è¿™é‡Œ hook ä½åšç»Ÿä¸€å¤„ç†ã€‚hook objc_msgSend è¿˜å¯ä»¥è·å–å¯åŠ¨æ–¹æ³•åˆ—è¡¨ï¼Œç”¨äºäºŒè¿›åˆ¶é‡æ’æ–¹æ¡ˆä¸­æ‰€éœ€è¦çš„ AppOrderFilesï¼Œä¸è¿‡  AppOrderFiles è¿˜å¯ä»¥é€šè¿‡ Clang SanitizerCoverage è·å¾—ï¼Œå…·ä½“å¯ä»¥çœ‹å®è—ç”·å­© Michael Eisel è¿™ä¸ªè¿™ç¯‡åšå®¢ã€Š<a href="https://eisel.me/order">Improving App Performance with Order Files</a>ã€‹ çš„ä»‹ç»ã€‚</p>
<p>objc_msgSend å¯ä»¥é€šè¿‡ fishhook æŒ‡å®šåˆ°ä½ å®šä¹‰çš„ hook æ–¹æ³•ä¸­ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åˆ›å»ºè·³è½¬ page çš„æ–¹å¼æ¥ hookã€‚åšæ³•æ˜¯å…ˆç”¨ mmap åˆ†é…ä¸€ä¸ªè·³è½¬çš„ pageï¼Œè¿™ä¸ªå†…å­˜åé¢ä¼šç”¨æ¥æ‰§è¡ŒåŸå‡½æ•°ï¼Œä½¿ç”¨ç‰¹æ®ŠæŒ‡ä»¤é›†å°†CPUé‡å®šå‘åˆ°å†…å­˜çš„ä»»æ„ä½ç½®ã€‚åˆ›å»ºä¸€ä¸ªå†…è”æ±‡ç¼–å‡½æ•°ç”¨æ¥æ”¾ç½®è·³è½¬çš„åœ°å€ï¼Œåˆ©ç”¨ C ç¼–è¯‘å™¨è‡ªåŠ¨å¤åˆ¶è·³è½¬ page çš„ç»“æ„ï¼ŒæŒ‡å‘ hook çš„å‡½æ•°ï¼Œä¹‹å‰æŠŠæŒ‡ä»¤å¤åˆ¶åˆ°è·³è½¬ page ä¸­ã€‚ARM64 æ˜¯ä¸€ä¸ª RISC æ¶æ„ï¼Œéœ€è¦æ ¹æ®<a href="https://www.element14.com/community/servlet/JiveServlet/previewBody/41836-102-1-229511/ARM.Reference_Manual.pdf">æŒ‡ä»¤ç§ç±»</a>æ£€æŸ¥åˆ†æ”¯æŒ‡ä»¤ã€‚å¯ä»¥åœ¨ <a href="https://opensource.apple.com/source/objc4/objc4-647/runtime/Messengers.subproj/objc-msg-arm64.s">_objc_msgSend</a> é‡Œæ‰¾åˆ° b æŒ‡ä»¤çš„æ£€æŸ¥ã€‚ç›¸å…³ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ENTRY _objc_msgSend</span><br><span class="line">MESSENGER_START</span><br><span class="line"></span><br><span class="line">cmp x0, #<span class="number">0</span>          <span class="comment">// nil check and tagged pointer check</span></span><br><span class="line">b.le    LNilOrTagged        <span class="comment">//  (MSB tagged pointer looks negative)</span></span><br><span class="line">ldr x13, [x0]       <span class="comment">// x13 = isa</span></span><br><span class="line"><span class="keyword">and</span> x9, x13, #ISA_MASK  <span class="comment">// x9 = class</span></span><br></pre></td></tr></table></figure>
<p>æ£€æŸ¥é€šè¿‡å°±å¯ä»¥ç”¨è¿™ä¸ªæŒ‡é’ˆè¯»å–åç§»é‡ï¼Œå¹¶ä¿®æ”¹æŒ‡å‘è·³è½¬åœ°å€ï¼Œè·³è½¬pageå®Œæˆï¼Œhook å‡½æ•°å°±å¯ä»¥è¢«è°ƒç”¨äº†ã€‚</p>
<p>æ¥ä¸‹æ¥çœ‹ä¸‹ hook _objc_msgSend çš„å‡½æ•°ï¼Œè¿™ä¸ªæˆ‘åœ¨ä»¥å‰åšå®¢ã€Š<a href="https://ming1016.github.io/2017/06/20/deeply-ios-performance-optimization/">æ·±å…¥å‰–æ iOS æ€§èƒ½ä¼˜åŒ–</a>ã€‹å†™è¿‡ï¼Œä¸è¿‡å¤šèµ˜è¿°ï¼Œåªåšç‚¹è¡¥å……è¯´æ˜ã€‚ä»<a href="https://github.com/ming1016/GCDFetchFeed/blob/master/GCDFetchFeed/GCDFetchFeed/Lib/SMLagMonitor/SMCallTraceCore.c">è¿™é‡Œçš„æºç </a>å¯ä»¥çœ‹å®ç°ï¼Œå…¶ä¸­çš„attribute((naked)) è¡¨ç¤ºæ— å‚æ•°å‡†å¤‡å’Œæ ˆåˆå§‹åŒ–ï¼Œ asm è¡¨ç¤ºå…¶åé¢æ˜¯æ±‡ç¼–ä»£ç ï¼Œvolatile æ˜¯è®©åé¢çš„æŒ‡ä»¤é¿å…è¢«ç¼–è¯‘ä¼˜åŒ–åˆ°ç¼“å­˜å¯„å­˜å™¨ä¸­å’Œæ”¹å˜æŒ‡ä»¤é¡ºåºï¼Œvolatile ä½¿å…¶ä¿®é¥°å˜é‡è¢«è®¿é—®æ—¶éƒ½ä¼šåœ¨å…±äº«å†…å­˜é‡Œé‡æ–°è¯»å–ï¼Œå˜é‡å€¼å˜åŒ–æ—¶ä¹Ÿèƒ½å†™åˆ°å…±äº«å†…å­˜ä¸­ï¼Œè¿™æ ·ä¸åŒçº¿ç¨‹çœ‹åˆ°çš„å˜é‡éƒ½æ˜¯ä¸€ä¸ªå€¼ã€‚å¦‚æœä½ å‘ç°ä¸åŠ  volatile ä¹Ÿæ²¡æœ‰é—®é¢˜ï¼Œä½ å¯ä»¥æŠŠç¼–è¯‘ä¼˜åŒ–é€‰é¡¹è°ƒåˆ°æ›´ä¼˜è¯•è¯•ã€‚stpè¡¨ç¤ºæ“ä½œä¸¤ä¸ªå¯„å­˜å™¨ï¼Œä¸­æ‹¬å·éƒ¨åˆ†è¡¨ç¤ºå‹æ ˆå­˜å…¥spåç§»åœ°å€ï¼Œ!ç¬¦å·è¡¨åˆå¹¶äº†å‹æ ˆæŒ‡ä»¤ã€‚</p>
<p>save() çš„ä½œç”¨æ˜¯æŠŠä¼ é€’å‚æ•°å¯„å­˜å™¨å…¥æ ˆä¿å­˜ï¼Œcall(b, value)ç”¨æ¥è·³åˆ°æŒ‡å®šå‡½æ•°åœ°å€ï¼Œcall(blr, &amp;before_objc_msgSend) æ˜¯è°ƒç”¨åŸ _objc_msgSend ä¹‹å‰æŒ‡å®šæ‰§è¡Œå‡½æ•°ï¼Œcall(blr, orig_objc_msgSend) æ˜¯è°ƒç”¨ objc_msgSend å‡½æ•°ï¼Œcall(blr, &amp;after_objc_msgSend) æ˜¯è°ƒç”¨åŸ _objc_msgSend ä¹‹åæŒ‡å®šæ‰§è¡Œå‡½æ•°ã€‚before_objc_msgSend å’Œ after_objc_msgSend åˆ†åˆ«è®°å½•æ—¶é—´ï¼Œå·®å€¼å°±æ˜¯æ–¹æ³•è°ƒç”¨æ‰§è¡Œçš„æ—¶é•¿ã€‚</p>
<p>è°ƒç”¨ä¹‹é—´é€šè¿‡ save() ä¿å­˜å‚æ•°ï¼Œé€šè¿‡ load() æ¥è¯»å–å‚æ•°ã€‚call çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯blrï¼Œblr æ˜¯æŒ‡è·³è½¬åˆ°å¯„å­˜å™¨åœ°å€åä¼šè¿”å›ï¼Œç”±äº blr ä¼šæ”¹å˜ lr å¯„å­˜å™¨X30çš„å€¼ï¼Œå½±å“ ret è·³åˆ°åŸæ–¹æ³•è°ƒç”¨æ–¹åœ°å€ï¼Œå´©æºƒå †æ ˆæ‰¾æ–¹æ³•è°ƒç ”æ ˆä¹Ÿä¾èµ– lr åœ¨æ ˆä¸Šè®°å½•çš„åœ°å€ï¼Œæ‰€ä»¥éœ€è¦åœ¨ call() ä¹‹å‰å¯¹ lr è¿›è¡Œä¿å­˜ï¼Œcall() éƒ½è°ƒç”¨å®Œåå†è¿›è¡Œæ¢å¤ã€‚è·³è½¬åˆ°hookå‡½æ•°ï¼Œhookå‡½æ•°å¯ä»¥æ‰§è¡Œæˆ‘ä»¬è‡ªå®šä¹‰çš„äº‹æƒ…ï¼Œå®Œæˆåæ¢å¤CPUçŠ¶æ€ã€‚</p>
<h2 id="è¿›å…¥ä¸»å›¾åçš„ä¼˜åŒ–"><a href="#è¿›å…¥ä¸»å›¾åçš„ä¼˜åŒ–" class="headerlink" title="è¿›å…¥ä¸»å›¾åçš„ä¼˜åŒ–"></a>è¿›å…¥ä¸»å›¾åçš„ä¼˜åŒ–</h2><p><img src="/uploads/thinking-in-how-to-speed-up-app/12.png" alt=""></p>
<p>è¿›å…¥ä¸»å›¾åï¼Œç”¨æˆ·å°±å¯ä»¥ç‚¹å‡»æŒ‰é’®è¿›å…¥ä¸åŒåŠŸèƒ½äº†ï¼Œæ˜¯å¦èƒ½å¤Ÿå¿«é€Ÿå“åº”æŒ‰é’®ç‚¹å‡»æ“ä½œä¹Ÿæ˜¯å¯åŠ¨ä½“éªŒæ„ŸçŸ¥å¾ˆé‡è¦çš„äº‹æƒ…ã€‚æŒ‰é’®ç‚¹å‡»çš„ä¸¤ä¸ªäº‹ä»¶ didTouchUp å’Œ didTouchDown ä¹‹é—´ä¹Ÿä¼šæœ‰å»¶æ—¶ï¼Œå› æ­¤å¯ä»¥åœ¨ didTouchDown æ—¶åœ¨ä¸»çº¿ç¨‹å…ˆ async åˆå§‹åŒ–ä¸‹ä¸€ä¸ª VCï¼ŒæŠŠåˆå§‹åŒ–æå‰å®Œæˆï¼Œè¿™æ ·åšå¯ä»¥æé«˜50ms-100msçš„é€Ÿåº¦ï¼Œç”šè‡³æ›´å¤šï¼Œå…·ä½“æ”¶ç›Šä¾èµ–å½“å‰ä¸»çº¿ç¨‹ç¹å¿™æƒ…å†µå’Œä¸‹ä¸€ä¸ªé¡µé¢ viewDidLoad ç­‰åˆå§‹åŒ–æ–¹æ³•é‡Œçš„è€—æ—¶ï¼Œå¯åŠ¨é˜¶æ®µä¸»çº¿ç¨‹ä¸€å®šä¸ä¼šé—²ï¼Œå³ä½¿ç‚¹å‡»åä¸»çº¿ç¨‹é˜»å¡ï¼Œä½¿ç”¨ async ä¹Ÿèƒ½ä¿è¯ä¸‹ä¸€ä¸ªé¡µé¢çš„åˆå§‹åŒ–ä¸ä¼šåœã€‚</p>
<h2 id="çº¿ç¨‹è°ƒåº¦å’Œä»»åŠ¡ç¼–æ’"><a href="#çº¿ç¨‹è°ƒåº¦å’Œä»»åŠ¡ç¼–æ’" class="headerlink" title="çº¿ç¨‹è°ƒåº¦å’Œä»»åŠ¡ç¼–æ’"></a>çº¿ç¨‹è°ƒåº¦å’Œä»»åŠ¡ç¼–æ’</h2><h3 id="æ•´ä½“æ€è·¯"><a href="#æ•´ä½“æ€è·¯" class="headerlink" title="æ•´ä½“æ€è·¯"></a>æ•´ä½“æ€è·¯</h3><p>å¯¹äºä»»åŠ¡ç¼–æ’æœ‰ç§æ‰“æ³•ï¼Œå°±æ˜¯å…ˆæŠŠæ‰€æœ‰ä»»åŠ¡æ»åï¼Œç„¶åå†çœ‹å“ªä¸ªæ˜¯å¯åŠ¨å¼€å§‹å¿…é¡»è¦åŠ è½½çš„ã€‚æ•ˆæœç«‹ç«¿è§å½±ï¼Œå¾ˆå¿«å°±èƒ½çœ‹åˆ°æœ€å¥½çš„ç»“æœï¼Œåé¢å°±æ˜¯åå¤æ–Ÿé…Œï¼Œä¸¥æ ¼æŠŠå…³è°æ‰æ˜¯å¿…è¦çš„å¯åŠ¨ä»»åŠ¡äº†ã€‚</p>
<p>å¯åŠ¨é˜¶æ®µçš„ä»»åŠ¡ï¼Œå…ˆç†å‡ºç›¸å…³ä¾èµ–å…³ç³»ï¼Œåœ¨æ¡†æ¶ä¸­è¿›è¡Œé…ç½®ï¼Œæœ‰ä¾èµ–çš„ä»»åŠ¡æœ‰åºæ‰§è¡Œï¼Œæ— ä¾èµ–ç‹¬ç«‹ä»»åŠ¡å¯ä»¥åœ¨éå¯†é›†ä»»åŠ¡æ‰§è¡ŒæœŸä¸²è¡Œåˆ†ç»„ï¼Œç»„å†…å¹¶å‘æ‰§è¡Œã€‚</p>
<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯Android çš„ SharedPreferences æ–‡ä»¶åŠ è½½å¯¼è‡´çš„ ContextImpl é”ç«äº‰ï¼Œä¸€ç§è§£æ³•æ˜¯åˆå¹¶æ–‡ä»¶ï¼Œä¸è¿‡åæœŸç»´æŠ¤æˆæœ¬ä¼šé«˜ï¼Œå¦ä¸€ç§æ˜¯ä½¿ç”¨ä¸²è¡Œä»»åŠ¡åŠ è½½ã€‚ä½ å¯èƒ½ä¼šç–‘æƒ‘ï¼Œæˆ‘æ²¡æ€ä¹ˆç”¨é”ï¼Œé‚£æ˜¯ä¸æ˜¯å°±ä¸ä¼šæœ‰é”ç­‰å¾…çš„é—®é¢˜äº†ã€‚å…¶å®ä¸ç„¶ï¼Œæ¯”å¦‚åœ¨ iOSä¸­ï¼Œdispatch_once é‡Œæœ‰ dispatch_atomic_barrier æ–¹æ³•ï¼Œæ­¤æ–¹æ³•å°±æœ‰é”çš„ä½œç”¨ï¼Œå› æ­¤é”å…¶å®å­˜åœ¨å„ä¸ª API ä¹‹ä¸‹ï¼Œå¦‚ä¸ç”¨å·¥å…·å»åšæ£€æŸ¥ï¼Œæœ‰æ—¶è¿˜çœŸä¸å®¹æ˜“å‘ç°è¿™äº›é—®é¢˜ã€‚</p>
<p>æœ‰ IO æ“ä½œçš„ä»»åŠ¡é™¤äº†é”ç­‰å¾…é—®é¢˜ï¼Œè¿˜æœ‰æ•ˆç‡æ–¹é¢ä¹Ÿéœ€è¦ç‰¹åˆ«æ³¨æ„ï¼Œæ¯”å¦‚ iOS çš„ Fundation åº“ä½¿ç”¨çš„æ˜¯ NSData writeToFile:atomically: æ–¹æ³•ï¼Œæ­¤æ–¹æ³•ä¼šè°ƒç”¨ç³»ç»Ÿæä¾›çš„ fsync å‡½æ•°å°†æ–‡ä»¶æè¿°ç¬¦ fd é‡Œä¿®æ”¹çš„æ•°æ®å¼ºå†™åˆ°ç£ç›˜é‡Œï¼Œfsync ç›¸æ¯”è¾ƒä¸ fcntl æ•ˆç‡é«˜ä½†å†™å…¥ç‰©ç†ç£ç›˜ä¼šæœ‰ç­‰å¾…ï¼Œå¯èƒ½ä¼šåœ¨ç³»ç»Ÿå¼‚å¸¸æ—¶å‡ºç°å†™å…¥é¡ºåºé”™ä¹±çš„æƒ…å†µã€‚ç³»ç»Ÿæä¾›çš„ write() å’Œ mmap() å‡½æ•°éƒ½ä¼šç”¨åˆ°å†…æ ¸é¡µç¼“å­˜ï¼Œæ˜¯å¦å†™å…¥ç£ç›˜ä¸ç”±è°ƒç”¨è¿”å›æ˜¯å¦æˆåŠŸå†³å®šï¼Œå¦å¤– c çš„æ ‡å‡†åº“çš„è¯»å†™ API fread å’Œ fwrite è¿˜ä¼šåœ¨ç³»ç»Ÿå†…æ ¸é¡µç¼“å­˜åŒæ­¥å¯¹åº”ç”±ä¿å­˜äº†ç¼“å†²åŒºåŸºåœ°å€çš„ FILE ç»“æ„ä½“çš„å†…éƒ¨ç¼“å†²åŒºã€‚å› æ­¤å¯åŠ¨é˜¶æ®µ IO æ“ä½œæ–¹æ³•éœ€è¦ç»¼åˆåšæ•ˆç‡ã€å‡†ç¡®å’Œé‡è¦æ€§ä¸‰æ–¹é¢å› ç´ çš„æƒè¡¡è€ƒè™‘ï¼Œå†è¿›è¡Œæœ‰ IO æ“ä½œçš„ä»»åŠ¡ç¼–æ’ã€‚</p>
<p>é’ˆå¯¹åˆå§‹åŒ–è€—æ—¶çš„åº“ï¼Œæ¯”å¦‚åŸ‹ç‚¹åº“ï¼Œå¯ä»¥å»¶ååˆå§‹åŒ–ï¼Œå…ˆå°†æ‰€éœ€è¦çš„æ•°æ®å­˜å‚¨åˆ°å†…å­˜ä¸­ï¼Œå¾…åˆ°åŸ‹ç‚¹åº“åˆå§‹åŒ–æ—¶å†è¿›è¡Œè®°å½•ã€‚å¯¹ä¸€äº›ä¸»å›¾ä¸Šä¸šåŠ¡ç½‘ç»œå¯ä»¥å»¶åè¯·æ±‚ï¼Œæ¯”å¦‚é—ªå±ã€æ¶ˆæ¯ç›’å­ã€ä¸»å›¾å¤©æ°”ã€é™è¡Œæ§ä»¶æ•°æ®è¯·æ±‚ã€å¼€æ”¾å›¾å±‚æ•°æ®ã€Wi-Fiä¿¡æ¯ä¸ŠæŠ¥è¯·æ±‚ç­‰ã€‚</p>
<h3 id="å¤šçº¿ç¨‹å…±äº«æ•°æ®çš„é—®é¢˜"><a href="#å¤šçº¿ç¨‹å…±äº«æ•°æ®çš„é—®é¢˜" class="headerlink" title="å¤šçº¿ç¨‹å…±äº«æ•°æ®çš„é—®é¢˜"></a>å¤šçº¿ç¨‹å…±äº«æ•°æ®çš„é—®é¢˜</h3><p>å¹¶å‘ä»»åŠ¡ç¼–æ’ç¼ºå°‘ä¸€ä¸ªç»Ÿä¸€çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹ï¼Œå¹¶å‘é€šä¿¡å…±äº«æ•°æ®æ–¹å¼çš„æ‰‹æ®µï¼Œæ¯”å¦‚ä»£ç†å’Œé€šçŸ¥ä¼šè®©å¤„ç†åˆ°å¤„é£ï¼Œé—­åŒ…è¿™ç§åŒ¿åå‡½æ•°æ’æŸ¥é—®é¢˜ä¸æ–¹ä¾¿ï¼Œè€Œä¸”å›è°ƒä¸­å¥—å›è°ƒå‰æœŸè®¾è®¡åæœŸç»´æŠ¤å’Œç†è§£å¾ˆå›°éš¾ï¼Œè°ƒè¯•ã€æ€§èƒ½æµ‹è¯•ä¹Ÿä¹±ã€‚è¿™äº›é€šè¿‡å›è°ƒæ¥å¤„ç†å¼‚æ­¥ï¼Œä¸å…‰å¤æ‚éš¾æ§ï¼Œè¿˜æœ‰é™æ€æ¡ä»¶ã€ä¾èµ–å…³ç³»ã€æ‰§è¡Œé¡ºåºè¿™æ ·çš„é¢å¤–å¤æ‚åº¦ï¼Œä¸ºäº†è§£å†³è¿™äº›é¢å¤–å¤æ‚åº¦ï¼Œè¿˜éœ€è¦ä½¿ç”¨æ›´å¤šçš„å¤æ‚æœºåˆ¶æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ¯”å¦‚ä½¿ç”¨ä½æ•ˆçš„ mutexã€è¶…é«˜å¤æ‚åº¦çš„è¯»å†™é”ã€åŒé‡æ£€æŸ¥é”å®šã€åº•å±‚åŸå­æ“ä½œæˆ–ä¿¡å·é‡çš„æ–¹å¼æ¥ä¿æŠ¤æ•°æ®ï¼Œéœ€è¦ä¿è¯æ•°æ®æ˜¯æ­£ç¡®é”ä½çš„ï¼Œä¸ç„¶ä¼šæœ‰å†…å­˜é—®é¢˜ï¼Œé”ç²’åº¦è¦å®šè¿˜è¦æ³¨æ„é¿å…æ­»é”ã€‚</p>
<p>å¹¶å‘çº¿ç¨‹é€šä¿¡ä¸€èˆ¬éƒ½ä¼šä½¿ç”¨ libdispatchï¼ˆGCDï¼‰è¿™æ ·çš„å…±äº«æ•°æ®æ–¹å¼æ¥å¤„ç†ï¼Œä¹Ÿå°±å¼‚æ­¥å†å›è°ƒçš„æ–¹å¼ã€‚libdispatch çš„ async ç­–ç•¥æ˜¯æŠŠä»»åŠ¡çš„ block æ”¾åˆ°é˜Ÿåˆ—é“¾è¡¨ï¼Œä½¿ç”¨æ—¶ä¼šåœ¨åº•å±‚çš„çº¿ç¨‹æ± é‡Œæ‰¾å¯ç”¨çº¿ç¨‹ï¼Œæœ‰å°±ç›´æ¥ç”¨ï¼Œæ²¡æœ‰å°±æ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼ˆå‚çœ‹ <a href="https://github.com/apple/swift-corelibs-libdispatch">libdispatch</a> æºç ï¼Œç›‘æ§çº¿ç¨‹æ±  <a href="https://github.com/apple/swift-corelibs-libdispatch/blob/main/src/event/workqueue.c">workqueue.c</a>ï¼Œé˜Ÿåˆ—è°ƒåº¦ <a href="https://github.com/apple/swift-corelibs-libdispatch/blob/main/src/queue.c">queue.c</a>ï¼‰ï¼Œä½¿ç”¨è¿™æ ·çš„ç­–ç•¥æ¥å‡å°‘çº¿ç¨‹åˆ›å»ºã€‚å½“å¹¶å‘ä»»åŠ¡å¤šæ—¶ï¼Œæ¯”å¦‚å¯åŠ¨æœŸé—´ï¼Œå³ä½¿çº¿ç¨‹æ²¡çˆ†ï¼Œä½† CPU åœ¨å„ä¸ªçº¿ç¨‹åˆ‡æ¢å¤„ç†ä»»åŠ¡æ—¶ä¹Ÿæ˜¯ä¼šæœ‰æ—¶é—´å¼€é”€çš„ï¼Œæ¯æ¬¡åˆ‡æ¢çº¿ç¨‹ï¼ŒCPU éƒ½éœ€è¦æ‰§è¡Œè°ƒåº¦ç¨‹åºå¢åŠ è°ƒåº¦æˆæœ¬å’Œå¢åŠ  CPU ä½¿ç”¨ç‡ï¼Œå¹¶ä¸”è¿˜å®¹æ˜“å‡ºç°å¤šçº¿ç¨‹ç«äº‰é—®é¢˜ã€‚å•æ¬¡çº¿ç¨‹åˆ‡æ¢çœ‹èµ·æ¥ä¸é•¿ï¼Œä½†æ•´ä¸ªå¯åŠ¨ï¼Œåˆ‡æ¢é¢‘ç‡é«˜çš„è¯ï¼Œæ•´ä½“æ—¶é—´å°±ä¼šå¢å¤§ã€‚</p>
<p>å¤šçº¿ç¨‹çš„é—®é¢˜ä»¥åŠå¤„ç†æ–¹å¼ï¼Œå¸¦æ¥äº†å¼€å‘å’Œæ’æŸ¥é—®é¢˜çš„å¤æ‚æ€§ï¼Œä»¥åŠå‡ºç°é—®é¢˜æœºç‡çš„æé«˜ï¼Œèµ„æºå’ŒåŠŸèƒ½äº‘åŒ–ä¹Ÿæœ‰ç±»ä¼¼çš„é—®é¢˜ï¼Œäº‘åŒ–å’Œæœ¬åœ°çš„è€¦åˆä¾èµ–ã€äº‘åŒ–ä¹‹é—´çš„å…³ç³»å¤„ç†ã€ç‰ˆæœ¬å…¼å®¹é—®é¢˜ä¼šå¸¦æ¥æ›´å¤æ‚çš„å¼€å‘ä»¥åŠæµ‹è¯•æŒ‘æˆ˜ï¼Œè¿˜æœ‰é—®é¢˜æ’æŸ¥çš„å¤æ‚åº¦ã€‚è¿™äº›éƒ½éœ€è¦å»åšæƒè¡¡ï¼Œå¯¹åŸºç¡€å»ºè®¾æ–¹æ¡ˆæå‡ºäº†æ›´é«˜çš„è¦æ±‚ï¼Œå¯¹å®¹é”™å›æ»šçš„å“åº”é€Ÿåº¦ä¹Ÿæœ‰æ›´é«˜çš„è¦æ±‚ã€‚</p>
<p>è¿™é‡Œæœ‰ä¸ª <a href="https://mirrors.edge.kernel.org/pub/linux/kernel/people/paulmck/perfbook/perfbook.html">book</a> ä¸“é—¨æ¥è¯´å¹¶è¡Œç¼–ç¨‹éš¾çš„ï¼Œå¹¶å‘Šè¯‰ä½ è¯¥æ€ä¹ˆåšã€‚<a href="https://gist.github.com/tclementdev/6af616354912b0347cdf6db159c37057">è¿™é‡Œæœ‰ç¯‡æ–‡ç« </a> åˆ—å‡ºäº†è‹¹æœå…¬å¸ libdispatch çš„ç»´æŠ¤è€… Pierre Habouzit å…³äº libdispatch çš„è®¨è®ºé‚®ä»¶ã€‚</p>
<p>è¯´äº†ä¸€å †å…±äº«æ•°æ®æ–¹å¼çš„é—®é¢˜ï¼Œæ²¡æœ‰ä½“æ„Ÿï¼Œä¸‹é¢æˆ‘è¯´ä¸ªæœ€è¿‘ç¢°åˆ°çš„å¤šçº¿ç¨‹é—®é¢˜ï¼Œä½ ä¹Ÿçœ‹çœ‹æ’æŸ¥æœ‰å¤šè´¹åŠ²ã€‚</p>
<h3 id="ä¸€ä¸ªå…·ä½“å¤šçº¿ç¨‹é—®é¢˜æ’æŸ¥æ€è·¯"><a href="#ä¸€ä¸ªå…·ä½“å¤šçº¿ç¨‹é—®é¢˜æ’æŸ¥æ€è·¯" class="headerlink" title="ä¸€ä¸ªå…·ä½“å¤šçº¿ç¨‹é—®é¢˜æ’æŸ¥æ€è·¯"></a>ä¸€ä¸ªå…·ä½“å¤šçº¿ç¨‹é—®é¢˜æ’æŸ¥æ€è·¯</h3><p>é—®é¢˜æ˜¯å·¥ç¨‹å¼•å…¥ä¸€ä¸ªç³»ç»Ÿåº“ï¼Œæš‚å« A åº“ï¼Œå‡ºç°çš„é—®é¢˜ç°è±¡æ˜¯ CoreMotion ä¸å›è°ƒï¼Œç½‘ç»œè¯·æ±‚æ— æ³•æ‰§è¡Œï¼Œé™¤äº†å…¨å±€å¹¶å‘é˜Ÿåˆ—ä¼š pending block å¤–ä¸»çº¿ç¨‹å’Œå…¶å®ƒé˜Ÿåˆ—å·¥ä½œæ­£å¸¸ã€‚</p>
<p>ç¬¬ä¸€é˜¶æ®µï¼Œæ’æŸ¥æ€è·¯çœ‹æ˜¯å¦è·Ÿæˆ‘ä»¬å·¥ç¨‹ç›¸å…³ï¼Œé¦–å…ˆçœ‹æ˜¯ä¸æ˜¯å„ä¸ªç³»ç»Ÿéƒ½æœ‰æ­¤é—®é¢˜ï¼Œå‘ç° iOS14 å’Œ iOS13 éƒ½æœ‰é—®é¢˜ã€‚ç„¶åæŠŠAåº“æ”¾åˆ°ä¸€ä¸ªçº¯å‡€ Demo å·¥ç¨‹ä¸­ï¼Œå‘ç°æ²¡æœ‰å‡ºé—®é¢˜äº†ã€‚åŸºäºä¸Šé¢ä¸¤ç§æƒ…å†µï¼Œæ¨æµ‹åªæœ‰å°†Aåº“å¼•å…¥æˆ‘ä»¬å·¥ç¨‹æ‰ä¼šå‡ºç°é—®é¢˜ã€‚åœ¨çº¯å‡€ Demo å·¥ç¨‹ä¸­ï¼ŒAåº“ä½¿ç”¨æ—¶ CPU ä¼šå ç”¨60%-80%ï¼Œé›†æˆåˆ°æˆ‘ä»¬å·¥ç¨‹åæ¶¨åˆ°100%ï¼Œæ‰€ä»¥ä¸‹ä¸ªé˜¶æ®µæ’æŸ¥æ–¹å‘å°±æ˜¯æ€§èƒ½ã€‚</p>
<p>ç¬¬äºŒé˜¶æ®µçš„æ‰“æ³•æ˜¯çœ‹æ˜¯å¦æ˜¯ç”±æ€§èƒ½å¼•èµ·çš„é—®é¢˜ã€‚å…ˆåœ¨çº¯å‡€å·¥ç¨‹ä¸­åˆ›å»ºå¤§é‡çº¿ç¨‹ï¼Œç›´åˆ°çº¿ç¨‹æ‰“æ»¡ï¼Œç„¶åè¿›è¡Œå¤§é‡æµ®ç‚¹è¿ç®—ä½¿ CPU åˆ°100%ï¼Œä½†æ˜¯æ²¡æ³•å¤ç°ï¼Œä»»åŠ¡é€šè¿‡ libdispatch åˆ°å…¨å±€å¹¶å‘é˜Ÿåˆ—èƒ½æ­£å¸¸å·¥ä½œã€‚</p>
<p>æ€ä¹ˆåœ¨ Demo é‡Œçœ‹åˆ°å‡ºçº¿ç¨‹å·²çˆ†æ»¡äº†å‘¢ï¼Ÿ</p>
<p>libdispatch å¯ä»¥ä½¿ç”¨çº¿ç¨‹æ•°æ˜¯æœ‰ä¸Šé™çš„ï¼Œåœ¨ libdispatch çš„<a href="https://opensource.apple.com/tarballs/libdispatch/">æºç </a>é‡Œå¯ä»¥çœ‹åˆ° libdispatch çš„é˜Ÿåˆ—åˆå§‹åŒ–æ—¶ä½¿ç”¨ pthread çº¿ç¨‹æ± ç›¸å…³ä»£ç ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">if</span> DISPATCH_USE_PTHREAD_POOL</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span></span><br><span class="line">_dispatch_root_queue_init_pthread_pool(<span class="keyword">dispatch_queue_global_t</span> dq,</span><br><span class="line">        <span class="keyword">int</span> pool_size, <span class="keyword">dispatch_priority_t</span> pri)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">dispatch_pthread_root_queue_context_t</span> pqc = dq-&gt;do_ctxt;</span><br><span class="line">    <span class="keyword">int</span> thread_pool_size = DISPATCH_WORKQ_MAX_PTHREAD_COUNT;</span><br><span class="line">    <span class="keyword">if</span> (!(pri &amp; DISPATCH_PRIORITY_FLAG_OVERCOMMIT)) &#123;</span><br><span class="line">        thread_pool_size = (<span class="keyword">int32_t</span>)dispatch_hw_config(active_cpus);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (pool_size &amp;&amp; pool_size &lt; thread_pool_size) thread_pool_size = pool_size;</span><br><span class="line">    ... <span class="comment">// çœç•¥ä¸ç›¸å…³ä»£ç </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šé¢ä»£ç æ‰€ç¤ºï¼Œdispatch_hw_config ä¼šç”¨ dispatch_source æ¥ç›‘æ§é€»è¾‘ CPUã€ç‰©ç† CPUã€æ¿€æ´» CPU çš„æƒ…å†µè®¡ç®—å‡ºçº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹æ•°é‡ï¼Œå¦‚æœå½“å‰çŠ¶æ€æ˜¯ DISPATCH_PRIORITY_FLAG_OVERCOMMITï¼Œä¹Ÿå°±æ˜¯ä¼šå‡ºç° overcommit é˜Ÿåˆ—æ—¶ï¼Œçº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹æ•°å°±æŒ‰ç…§ DISPATCH_WORKQ_MAX_PTHREAD_COUNT è¿™ä¸ªå®å®šä¹‰çš„æ•°é‡æ¥ï¼Œè¿™ä¸ªå®å¯¹åº”çš„å€¼æ˜¯255ã€‚å› æ­¤é€šè¿‡æŸ¥çœ‹æ˜¯å¦å‡ºç° overcommit é˜Ÿåˆ—å¯ä»¥çœ‹å‡ºçº¿ç¨‹æ± æ˜¯å¦å·²æ»¡ã€‚</p>
<p>ä»€ä¹ˆæ—¶å€™ libdispatch ä¼šåˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ï¼Ÿ</p>
<p>å½“ libdispatch è¦æ‰§è¡Œé˜Ÿåˆ—é‡Œ block æ—¶ä¼šå»æ£€æŸ¥æ˜¯å¦æœ‰å¯ç”¨çš„çº¿ç¨‹ï¼Œå‘ç°æœ‰å¯ç”¨çº¿ç¨‹æ—¶ï¼Œåœ¨å¯ç”¨çº¿ç¨‹å»æ‰§è¡Œ blockï¼Œå¦‚æœæ²¡æœ‰ï¼Œé€šè¿‡ pthread_create æ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œåœ¨ä¸Šé¢æ‰§è¡Œï¼Œå‡½æ•°å…³é”®ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">void</span></span><br><span class="line">_dispatch_root_queue_poke_slow(<span class="keyword">dispatch_queue_global_t</span> dq, <span class="keyword">int</span> n, <span class="keyword">int</span> <span class="built_in">floor</span>)</span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// å¦‚æœçŠ¶æ€æ˜¯overcommitï¼Œé‚£ä¹ˆå°±ç»§ç»­æ·»åŠ åˆ°pending</span></span><br><span class="line">    <span class="keyword">bool</span> overcommit = dq-&gt;dq_priority &amp; DISPATCH_PRIORITY_FLAG_OVERCOMMIT;</span><br><span class="line">    <span class="keyword">if</span> (overcommit) &#123;</span><br><span class="line">        os_atomic_add2o(dq, dgq_pending, remaining, relaxed);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!os_atomic_cmpxchg2o(dq, dgq_pending, <span class="number">0</span>, remaining, relaxed)) &#123;</span><br><span class="line">            _dispatch_root_queue_debug(<span class="string">&quot;worker thread request still pending for &quot;</span></span><br><span class="line">                    <span class="string">&quot;global queue: %p&quot;</span>, dq);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">    t_count = os_atomic_load2o(dq, dgq_thread_pool_size, ordered);</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        can_request = t_count &lt; <span class="built_in">floor</span> ? <span class="number">0</span> : t_count - <span class="built_in">floor</span>;</span><br><span class="line">        <span class="comment">// æ˜¯å¦æœ‰å¯ç”¨</span></span><br><span class="line">        <span class="keyword">if</span> (remaining &gt; can_request) &#123;</span><br><span class="line">            _dispatch_root_queue_debug(<span class="string">&quot;pthread pool reducing request from %d to %d&quot;</span>,</span><br><span class="line">                    remaining, can_request);</span><br><span class="line">            os_atomic_sub2o(dq, dgq_pending, remaining - can_request, relaxed);</span><br><span class="line">            remaining = can_request;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// çº¿ç¨‹æ»¡</span></span><br><span class="line">        <span class="keyword">if</span> (remaining == <span class="number">0</span>) &#123;</span><br><span class="line">            _dispatch_root_queue_debug(<span class="string">&quot;pthread pool is full for root queue: &quot;</span></span><br><span class="line">                    <span class="string">&quot;%p&quot;</span>, dq);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">while</span> (!os_atomic_cmpxchgvw2o(dq, dgq_thread_pool_size, t_count,</span><br><span class="line">            t_count - remaining, &amp;t_count, acquire));</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        _dispatch_retain(dq); <span class="comment">// åœ¨ _dispatch_worker_thread é‡Œå–ä»»åŠ¡å¹¶æ‰§è¡Œ</span></span><br><span class="line">        <span class="keyword">while</span> ((r = pthread_create(pthr, attr, _dispatch_worker_thread, dq))) &#123;</span><br><span class="line">            <span class="keyword">if</span> (r != EAGAIN) &#123;</span><br><span class="line">                (<span class="keyword">void</span>)dispatch_assume_zero(r);</span><br><span class="line">            &#125;</span><br><span class="line">            _dispatch_temporary_resource_shortage();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">while</span> (--remaining);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šé¢ä»£ç æ‰€ç¤ºï¼Œcan_request è¡¨ç¤ºå¯ç”¨çº¿ç¨‹æ•°ï¼Œé€šè¿‡å½“å‰æœ€å¤§å¯ç”¨çº¿ç¨‹æ•°å‡å»å·²ç”¨çº¿ç¨‹æ•°è·å¾—ï¼Œèµ‹ç»™ remainingåï¼Œç”¨æ¥åˆ¤æ–­çº¿ç¨‹æ˜¯å¦æ»¡å’Œæ§åˆ¶çº¿ç¨‹åˆ›å»ºã€‚dispatch_worker_thread ä¼šå–ä»»åŠ¡å¹¶æ‰§è¡Œã€‚</p>
<p>å½“ libdispatch ä½¿ç”¨çš„çº¿ç¨‹æ± ä¸­çº¿ç¨‹è¿‡å¤šï¼Œå¹¶ä¸”æœ‰ pending æ ‡è®°ï¼Œå½“ç­‰å¾…è¶…æ—¶ï¼Œä¹Ÿå°±æ˜¯ libdispatch é‡Œ DISPATCH_CONTENTION_USLEEP_MAX å®å®šä¹‰çš„æ—¶é—´åï¼Œä¹Ÿä¼šè§¦å‘åˆ›å»ºä¸€ä¸ªæ–°çš„å¾…å¤„ç†çº¿ç¨‹ã€‚libdispatch å¯¹åº”å‡½æ•°å…³é”®ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">bool</span></span><br><span class="line">__DISPATCH_ROOT_QUEUE_CONTENDED_WAIT__(<span class="keyword">dispatch_queue_global_t</span> dq,</span><br><span class="line">        <span class="keyword">int</span> (*predicate)(<span class="keyword">dispatch_queue_global_t</span> dq))</span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">bool</span> pending = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">if</span> (!pending) &#123;</span><br><span class="line">            <span class="comment">// æ·»åŠ pendingæ ‡è®°</span></span><br><span class="line">            (<span class="keyword">void</span>)os_atomic_inc2o(dq, dgq_pending, relaxed);</span><br><span class="line">            pending = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        _dispatch_contention_usleep(sleep_time);</span><br><span class="line">        ...</span><br><span class="line">        sleep_time *= <span class="number">2</span>;</span><br><span class="line">    &#125; <span class="keyword">while</span> (sleep_time &lt; DISPATCH_CONTENTION_USLEEP_MAX);</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">if</span> (pending) &#123;</span><br><span class="line">        (<span class="keyword">void</span>)os_atomic_dec2o(dq, dgq_pending, relaxed);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (status == DISPATCH_ROOT_QUEUE_DRAIN_WAIT) &#123;</span><br><span class="line">        _dispatch_root_queue_poke(dq, <span class="number">1</span>, <span class="number">0</span>); <span class="comment">// åˆ›å»ºæ–°çº¿ç¨‹</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> status == DISPATCH_ROOT_QUEUE_DRAIN_READY;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šæ‰€ç¤ºï¼Œåœ¨åˆ›å»ºæ–°çš„å¾…å¤„ç†çº¿ç¨‹åï¼Œä¼šé€€å‡ºå½“å‰çº¿ç¨‹ï¼Œè´Ÿè½½æ²¡äº†å°±ä¼šå»ç”¨æ–°å»ºçš„çº¿ç¨‹ã€‚</p>
<p>æ¥ä¸‹æ¥ä½¿ç”¨ Instruments è¿›è¡Œåˆ†æ Trace æ–‡ä»¶ï¼Œå‘ç°å¯åŠ¨é˜¶æ®µç«‹åˆ»å¼€å§‹ä½¿ç”¨Aåº“çš„è¯ï¼ŒCPU ä¼šçªç„¶ä¸Šå‡ï¼Œå¦‚æœä½¿ç”¨ A åº“ç¨æ™šäº›ï¼ŒCPU ä½¿ç”¨ç‡å°±æ˜¯ç¨³å®šæ­£å¸¸çš„ã€‚è¿™è¯´æ˜åœ¨ç¬¬ä¸€ä¸ªé˜¶æ®µæ€§èƒ½ç›¸å…³ç»“è®ºåªæ˜¯å¶ç°æƒ…å†µæ‰ä¼šå‡ºç°ï¼Œå‡ºé—®é¢˜æ—¶ï¼Œå¹¶æ²¡æœ‰å‡ºç°ç³»ç»Ÿèµ„æºç´§å¼ çš„æƒ…å†µï¼Œå¯ä»¥å¾—å‡ºå¹¶ä¸æ˜¯æ€§èƒ½é—®é¢˜çš„ç»“è®ºã€‚é‚£ä¹ˆä¸‹ä¸€ä¸ªé˜¶æ®µåªèƒ½ä»Aåº“çš„ä½¿ç”¨å’Œæ’æŸ¥æˆ‘ä»¬å·¥ç¨‹å…¶å®ƒåŠŸèƒ½çš„é—®é¢˜ã€‚</p>
<p>ç¬¬ä¸‰ä¸ªé˜¶æ®µçš„æ€è·¯æ˜¯ä½¿ç”¨åŠŸèƒ½äºŒåˆ†æ’æŸ¥æ³•ï¼Œå…ˆæ’å‡º A åº“ä½¿ç”¨é—®é¢˜ï¼Œåšæ³•æ˜¯åœ¨ä½¿ç”¨æœ€ç®€å•çš„ A åº“åˆå§‹åŒ–ä¸€ä¸ªé¡µé¢åœ¨é¦–å±ä¹Ÿä¼šå¤ç°é—®é¢˜ã€‚</p>
<p>æˆ‘ä»¬çš„åŠŸèƒ½ä¸»è¦åˆ†ä¸ºæ¸²æŸ“ã€å¼•æ“ã€ç½‘ç»œåº“ã€åŸºç¡€åŠŸèƒ½ã€ä¸šåŠ¡å‡ ä¸ªéƒ¨åˆ†ã€‚å°†æ¸²æŸ“ã€å¼•æ“ã€ç½‘ç»œåº“æ‹‰å‡ºæ¥å»ºä¸ªDemoï¼Œå‘ç°è¿™ä¸ª Demo ä¸ä¼šå‡ºç°é—®é¢˜ã€‚é‚£ä¹ˆæœ‰é—®é¢˜çš„å°±å¯èƒ½åœ¨åŸºç¡€åŠŸèƒ½ã€ä¸šåŠ¡ä¸Šã€‚</p>
<p>å…ˆå»æ‰çš„åŠŸèƒ½æ¨¡å—æœ‰ CoreMotionã€ç½‘ç»œã€æ—¥å¿—æ¨¡å—ã€å®šæ—¶ä»»åŠ¡ï¼ˆåŸ‹ç‚¹ä¸Šä¼ ï¼‰ï¼Œä¾ç„¶å¤ç°ã€‚æ¥ä¸‹æ¥å»æ‰é˜Ÿåˆ—é‡Œçš„ libdispatch ä»»åŠ¡ï¼Œé˜Ÿåˆ—é‡Œçš„ä»»åŠ¡ä¸»è¦æ˜¯ç”± Operation å’Œ libdispatch ä¸¤ç§æ–¹å¼æ”¾å…¥ã€‚å…¶ä¸­ Operation æœ€åæ˜¯ä½¿ç”¨ libdispatch å°†ä»»åŠ¡ block æ”¾å…¥é˜Ÿåˆ—ï¼ŒæœŸé—´ä¼šåšä¼˜å…ˆçº§å’Œå¹¶å‘æ•°çš„åˆ¤æ–­ã€‚å¯¹äº libdispatch å¯ä»¥ Hook ä½å¯ä»¥æŠŠä»»åŠ¡ block æ”¾åˆ°é˜Ÿåˆ—çš„ libdispatch æ–¹æ³•ï¼Œæœ‰ dispatch_asyncã€dispatch_afterã€dispatch_barrier_asyncã€dispatch_apply è¿™äº›æ–¹æ³•ã€‚ä»»åŠ¡ç›´æ¥è¿”å›ï¼Œè¿˜æ˜¯æœ‰é—®é¢˜ã€‚</p>
<p>æ¨æµ‹éªŒè¯åŸºç¡€èƒ½åŠ›å’Œä¸šåŠ¡å¯¹å‡ºç°é—®é¢˜é˜Ÿåˆ—æœ‰å½±å“ï¼Œinstruments åªèƒ½åˆ†æçº¿ç¨‹ï¼Œæ— æ³•åˆ†æé˜Ÿåˆ—ï¼Œå› æ­¤éœ€è¦å†™å·¥å…·åˆ†æé˜Ÿåˆ—æƒ…å†µã€‚</p>
<p>æ¥ä¸‹æ¥è¿›å…¥ç¬¬å››ä¸ªé˜¶æ®µã€‚</p>
<p>å…ˆ hook æ—¶æˆªè·ä»»åŠ¡ block ä½¿ç”¨çš„ libdispatch æ–¹æ³•ã€æ‰§è¡Œé˜Ÿåˆ—åã€ä¼˜å…ˆçº§ã€åšå”¯ä¸€æ ‡è¯†çš„å…¥é˜Ÿæ—¶é—´ã€å½“å‰é˜Ÿåˆ—çš„ä»»åŠ¡æ•°ã€è¿˜æœ‰æ‰§è¡Œå †æ ˆçš„ä¿¡æ¯ã€‚é€šè¿‡æˆªè·çš„å†…å®¹æŒ‰ç…§æ—¶é—´çº¿çœ‹ï¼Œå½“å‡ºç°å…¨å±€å¹¶å‘é˜Ÿåˆ— pending block æ•°é‡å †ç§¯æ—¶ï¼Œæ–°çš„ä½¿ç”¨ libdispatch åŠ å…¥çš„éƒ¨åˆ†ä»»åŠ¡å¯ä»¥å¾—åˆ°æ‰§è¡Œï¼Œä¹Ÿæœ‰æ²¡æ‰§è¡Œçš„ï¼Œéƒ½æ‰§è¡Œäº†ä¹Ÿä¼šæœ‰é—®é¢˜ã€‚</p>
<p>ç„¶åå»æ‰ Operation çš„ä»»åŠ¡ï¼šé€šè¿‡æ—¥å¿—è¿˜èƒ½å‘ç° Operation è°ƒç”¨ libdispatch çš„ä»»åŠ¡ç›´æ¥ hook libdispatch çš„æ–¹æ³•æ˜¯è·å–ä¸åˆ°çš„ï¼Œå¯èƒ½æ˜¯ Operation è°ƒç”¨æ–¹æ³•æœ‰å˜åŒ–ã€‚å¦å¤–åœ¨æ— æ³•æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹ä¸Šæ–°å»ºçš„ libdispatch ä»»åŠ¡ä¹Ÿæ— æ³•æ‰§è¡Œï¼Œæ— æ³•æ‰§è¡Œçš„ Operation ä»»åŠ¡è¾¾åˆ°æ‰€è®¾ç½®çš„ maxConcurrentOperationCountï¼Œå¯¹åº”çš„ OperationQueue å°±ä¼šåœ¨ Operation çš„é˜Ÿåˆ—é‡Œ pendingã€‚ç”±æ­¤å¯ä»¥æ¨æ–­å‡ºï¼Œåœ¨å±€å¹¶å‘é˜Ÿåˆ— pending çš„ block åŒ…å«äº†ç›´æ¥ä½¿ç”¨ libdispatch çš„å’Œ Operation çš„ä»»åŠ¡ï¼Œpending çš„ä»»åŠ¡ã€‚å› æ­¤è¿˜éœ€è¦ hook ä½ Operationï¼Œè¿‡æ»¤æ‰æ‰€æœ‰æ·»åŠ åˆ° Operation Queue çš„ä»»åŠ¡ï¼Œä½†ç»“æœè¿˜æ˜¯å¤ç°é—®é¢˜ã€‚</p>
<p>æ­¤æ—¶å¾ˆå´©æºƒï¼Œæœ¬æ¥åšå¥½äº†ä¸€ä¸ªä¸€ä¸ªä¸‹æ‰åŠŸèƒ½çš„å‡†å¤‡ï¼ˆæˆæœ¬é«˜ï¼‰ï¼Œè¿™æ—¶ï¼Œæœ‰åŒå­¦å‘ç°å‰é˜¶æ®µä¸¤ä¸ªä¸å¯¹çš„ç»“è®ºã€‚</p>
<p>è¿™ä¸ªé˜¶æ®µå®šä¸ºç¬¬äº”é˜¶æ®µã€‚</p>
<p>ç¬¬ä¸€ä¸ªä¸å¯¹çš„ç»“è®ºæ˜¯ç» QA åŒå­¦é•¿æ—¶é—´å¤šè½®æµ‹è¯•ï¼Œåªåœ¨14.2åŠä»¥ä¸Šç³»ç»Ÿç‰ˆæœ¬æœ‰é—®é¢˜ï¼Œç”±äºåªæœ‰è¿™ä¸ªç‰ˆæœ¬æ‰å¼€å§‹æœ‰æ­¤é—®é¢˜ï¼Œæ¨æ–­å¯èƒ½æ˜¯ç³»ç»Ÿ bugï¼›ç¬¬äºŒä¸ªä¸å¯¹çš„æ˜¯åªæœ‰æ¸²æŸ“ã€å¼•æ“ã€ç½‘ç»œåº“çš„ Demo å†æ¬¡æ£€æŸ¥ï¼Œå¯å¤ç°é—®é¢˜ï¼Œå› æ­¤å¯ä»¥é’ˆå¯¹è¿™ä¸ª Demo è¿›è¡Œè¿›ä¸€æ­¥äºŒåˆ†æ’æŸ¥ã€‚</p>
<p>äºæ˜¯ï¼Œå’±ä»¬é’ˆå¯¹ä¸¤ä¸ªå…ˆå‰é”™è¯¯ç»“è®ºï¼Œå†æ¬¡å‡ºå‘ï¼ŒåŒæ­¥è¿›è¡ŒéªŒè¯ã€‚å¯¹ Demo æ’é™¤äº†ç½‘ç»œåº“ä¾ç„¶å¤ç°ï¼Œåæ’é™¤å¼•æ“è¿˜æ˜¯å¤ç°ï¼ŒåŒæ—¶ä½¿ç”¨äº†è‡ªå·±çš„ç¤ºä¾‹å·¥ç¨‹åœ¨iOS14.2ä¸Šå¤ç°äº†é—®é¢˜ï¼Œå’Œç¬¬ä¸€é˜¶æ®µçº¯å‡€Demoçš„åŒºåˆ«æ˜¯å¾€å…¨å±€å¹¶å‘é˜Ÿåˆ—é‡Œæ–¹å¼ï¼Œå®˜æ–¹ Demo æ˜¯ Operationï¼Œæˆ‘ä»¬çš„æ˜¯ libdispatchã€‚</p>
<p>å› æ­¤å¾—å‡ºç»“è®ºæ˜¯è‹¹æœç³»ç»Ÿå‡çº§é—®é¢˜ï¼ŒåŸå› å¯èƒ½åœ¨ OperationQueueï¼Œé—®é¢˜é‡ç°åï¼Œä¸å†è¿è¡Œå…¶ä¸­çš„ operationã€‚14.3beta ç‰ˆè¿˜æ²¡æœ‰è§£å†³ã€‚äº”ä¸ªé˜¶æ®µæ€»ç»“å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/uploads/thinking-in-how-to-speed-up-app/13.png" alt=""></p>
<p>é‚£ä¹ˆçœ‹ä¸‹ Operation å®ç°ï¼Œåˆ†æä¸‹ç³»ç»Ÿ bug åŸå› ã€‚</p>
<p><a href="https://github.com/apportable/Foundation">ApportableFoundation</a> é‡Œæœ‰Operationçš„å¼€æºå®ç° <a href="https://github.com/apportable/Foundation/blob/master/System/Foundation/src/NSOperation.m">NSOperation.m</a>ï¼Œç›¸æ¯”è¾ƒ <a href="http://www.gnustep.org/">GNUstep</a> å’Œ <a href="http://www.cocotron.org/">Cocotron</a> æ›´å®Œå–„ï¼Œå¯ä»¥çœ‹åˆ° Operation å¦‚ä½•åœ¨ _schedulerRun å‡½æ•°é‡Œé€šè¿‡ libdispatch çš„ async æ–¹æ³•å°† operation çš„ä»»åŠ¡æ”¾åˆ°é˜Ÿåˆ—æ‰§è¡Œã€‚</p>
<p><a href="https://github.com/apple/swift-corelibs-foundation/">swiftæºç </a>é‡Œçš„fundationä¹Ÿæœ‰å®ç° <a href="https://github.com/apple/swift-corelibs-foundation/blob/main/Sources/Foundation/Operation.swift">Operation</a>ï¼Œæˆ‘ä»¬çœ‹çœ‹ _schedule å‡½æ•°çš„å…³é”®ä»£ç ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="function"><span class="keyword">func</span> <span class="title">_schedule</span>()</span> &#123;</span><br><span class="line">    <span class="operator">...</span></span><br><span class="line">    <span class="comment">// æŒ‰ä¼˜å…ˆçº§é¡ºåºæ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">for</span> prio <span class="keyword">in</span> <span class="type">Operation</span>.<span class="type">QueuePriority</span>.priorities &#123;</span><br><span class="line">        <span class="operator">...</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">let</span> operation <span class="operator">=</span> op<span class="operator">?</span>.takeUnretainedValue() &#123;</span><br><span class="line">            <span class="operator">...</span></span><br><span class="line">            <span class="keyword">let</span> next <span class="operator">=</span> operation.__nextPriorityOperation</span><br><span class="line">            <span class="operator">...</span></span><br><span class="line">            <span class="keyword">if</span> <span class="type">Operation</span>.__NSOperationState.enqueued <span class="operator">==</span> operation._state <span class="operator">&amp;&amp;</span> operation._fetchCachedIsReady(<span class="operator">&amp;</span>retest) &#123;</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">let</span> previous <span class="operator">=</span> prev<span class="operator">?</span>.takeUnretainedValue() &#123;</span><br><span class="line">                    previous.__nextPriorityOperation <span class="operator">=</span> next</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    _setFirstPriorityOperation(prio, next)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="operator">...</span></span><br><span class="line">                <span class="keyword">if</span> __mainQ &#123;</span><br><span class="line">                    queue <span class="operator">=</span> <span class="type">DispatchQueue</span>.main</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    queue <span class="operator">=</span> __dispatch_queue <span class="operator">??</span> _synthesizeBackingQueue()</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">let</span> schedule <span class="operator">=</span> operation.__schedule &#123;</span><br><span class="line">                    <span class="keyword">if</span> operation <span class="keyword">is</span> _BarrierOperation &#123;</span><br><span class="line">                        queue.async(flags: .barrier, execute: &#123;</span><br><span class="line">                            schedule.perform()</span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        queue.async(execute: schedule)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                op <span class="operator">=</span> next</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="operator">...</span> <span class="comment">// æ·»åŠ </span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="operator">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°ä»£ç å¯è§ï¼Œå¯ä»¥çœ‹åˆ° _schedule å‡½æ•°æ ¹æ® Operation.QueuePriority.priorities ä¼˜å…ˆçº§æ•°ç»„é¡ºåºï¼Œä»æœ€é«˜ barrier å¼€å§‹åˆ° veryHighã€highã€normalã€low åˆ°æœ€ä½çš„ veryLowï¼Œæ ¹æ® operation å±æ€§è®¾ç½®å†³å®š libdispatch çš„ queue æ˜¯ä»€ä¹ˆç±»å‹çš„ï¼Œæœ€åé€šè¿‡ async å‡½æ•°åˆ†é…åˆ°å¯¹åº”çš„é˜Ÿåˆ—ä¸Šæ‰§è¡Œã€‚</p>
<p>æŸ¥çœ‹ operation ä»£ç æ›´æ–°æƒ…å†µï¼Œæœ€æ–° operation æäº¤ä¿®å¤äº†ä¸€ä¸ªé—®é¢˜ï¼Œcommit <a href="https://github.com/apple/swift-corelibs-foundation/commit/9f44ed353c77a438d6f4ba879b2b388210e2107f">åœ¨è¿™</a>ï¼Œæ ¹æ®ä¿®å¤é—®é¢˜çš„æè¿°æ¥çœ‹ï¼Œå’Œ A åº“å¼•å…¥å¯¼è‡´é˜Ÿåˆ—ä¸å¯æ·»åŠ  OperationQueue çš„æƒ…å†µéå¸¸ç±»ä¼¼ã€‚ä¿®å¤çš„åœ°æ–¹å¯ä»¥çœ‹ä¸‹å›¾ï¼š<br><img src="/uploads/thinking-in-how-to-speed-up-app/8.png" alt=""></p>
<p>å¦‚å›¾æ‰€ç¤ºï¼Œåœ¨å…ˆå‰ _schedule å‡½æ•°é‡Œä½¿ç”¨ nextOperation è€Œä¸ç”¨ nextPriorityOperation ä¼šå¯¼è‡´ä¸»æ“ä½œåˆ—è¡¨é‡Œçš„ä¸åŒä¼˜å…ˆçº§æ“ä½œåˆ—è¡¨äº¤å‰è¿æ¥ï¼Œå¯èƒ½ä¼šåœ¨æ‰§è¡Œåé¢æ“ä½œæ—¶è¢«æŒ‚èµ·ï¼Œè€Œ A åº“é‡Œçš„ OperationQueue éƒ½æ˜¯é«˜ä¼˜çš„ï¼Œå¦‚æœæœ‰å…¶å®ƒä¼˜å…ˆçº§çš„ OperationQueue åŠ è¿›æ¥å°±ä¼šå‡ºç°æŒ‚èµ·çš„é—®é¢˜ã€‚</p>
<p>ä»æäº¤è®°å½•çœ‹ï¼Œ19å¹´6æœˆ12æ—¥çš„é‚£æ¬¡æäº¤å˜æ›´äº†å¾ˆå¤šä»£ç é€»è¾‘ï¼Œæè¿°ä¸Šçœ‹æ˜¯ä¸ºäº†æ›´æ¥è¿‘ objc çš„å®ç°ï¼ŒchangePriority å‡½æ•°å°±æ˜¯é‚£ä¸ªæ—¶å€™åŠ è¿›å»çš„ã€‚æäº¤çš„ commit å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="/uploads/thinking-in-how-to-speed-up-app/9.png" alt=""></p>
<p>æ€€ç–‘ï¼ˆåªæ˜¯æ€€ç–‘ï¼Œè‹¹æœå®˜æ–¹å¹¶æ²¡æœ‰è¯´ï¼‰å¯èƒ½æ˜¯åœ¨ iOS14 å¼•å…¥ swift ç‰ˆçš„ Operationï¼Œå› æ­¤è¿™ä¸ª Operation é’ˆå¯¹ objc è°ƒç”¨åšäº†é€‚é…ã€‚ä¹‹æ‰€ä»¥14.2ä¹‹å‰ Operation é‡æ„åçš„ bug æ²¡æœ‰å¼•èµ·é—®é¢˜ï¼Œå¯èƒ½æ˜¯å½“æ—¶ A åº“çš„ Queue ä¼˜å…ˆçº§è¿˜æ²¡è°ƒé«˜ï¼Œ14.2ç‰ˆæœ¬Aåº“çš„ Queue ä¼˜å…ˆçº§å¼€å§‹è°ƒé«˜äº†ï¼Œæ‰€ä»¥å‡ºç°äº†ä¼˜å…ˆçº§äº¤å‰æŒ‚èµ·çš„æƒ…å†µã€‚</p>
<p>ä»è¿™æ¬¡æ’æŸ¥å¯ä»¥å‘ç°ï¼Œç›®å‰å¯¹äºå¹¶å‘çš„ç›‘æµ‹è¿˜æ˜¯éå¸¸å¤æ‚çš„ã€‚é‚£ä¹ˆå¹¶å‘é—®é¢˜åœ¨ iOS çš„å°†æ¥ä¼šå¾—åˆ°è§£å†³å—ï¼Ÿ</p>
<h3 id="å¤šçº¿ç¨‹å¹¶è¡Œè®¡ç®—æ¨¡å‹"><a href="#å¤šçº¿ç¨‹å¹¶è¡Œè®¡ç®—æ¨¡å‹" class="headerlink" title="å¤šçº¿ç¨‹å¹¶è¡Œè®¡ç®—æ¨¡å‹"></a>å¤šçº¿ç¨‹å¹¶è¡Œè®¡ç®—æ¨¡å‹</h3><p>æ—¢ç„¶å…±äº«æ•°æ®æ–¹å¼é—®é¢˜å¤šï¼Œé‚£è¿˜æœ‰å…¶å®ƒé€‰æ‹©å—ï¼Ÿ</p>
<p>å®é™…ä¸Šåœ¨æœåŠ¡ç«¯å¤§é‡ä½¿ç”¨ç€ Actor è¿™æ ·çš„å¹¶è¡Œè®¡ç®—æ¨¡å‹ï¼Œåœ¨å¹¶è¡Œä¸–ç•Œé‡Œï¼Œä¸€åˆ‡éƒ½æ˜¯ actorï¼Œactor å°±åƒä¸€ä¸ªå®¹å™¨ï¼Œä¼šæœ‰è‡ªå·±çš„çŠ¶æ€ã€è¡Œä¸ºã€ä¸²è¡Œé˜Ÿåˆ—çš„æ¶ˆæ¯é‚®ç®±ã€‚actor ä¹‹é—´ä½¿ç”¨æ¶ˆæ¯æ¥é€šä¿¡ï¼Œä¼šæŠŠæ¶ˆæ¯å‘åˆ°æ¥å—æ¶ˆæ¯ actor çš„æ¶ˆæ¯é‚®ç®±é‡Œï¼Œæ¶ˆæ¯ç›’å­å¯å¹¶è¡Œæ¥å—æ¶ˆæ¯ï¼Œæ¶ˆæ¯çš„å¤„ç†æ˜¯ä¾æ¬¡è¿›è¡Œï¼Œå½“å‰å¤„ç†å®Œæ‰å¤„ç†ä¸‹ä¸€ä¸ªï¼Œæ¶ˆæ¯é‚®ç®±è¿™å¥—æœºåˆ¶å°±å¥½åƒ actor ä»¬çš„å¤§ç®¡å®¶ï¼Œè®© actor ä¹‹é—´çš„æ²Ÿé€šäº•ç„¶æœ‰åºã€‚</p>
<p>æœ‰è°æ˜¯åœ¨ä½¿ç”¨ actor æ¨¡å‹å‘¢ï¼Ÿ</p>
<p>actor å†å²æ‚ ä¹…ï¼Œ<a href="https://www.erlang.org/">Erlang</a>ï¼ˆ<a href="http://erlang.org/download/armstrong_thesis_2003.pdf">Elangè®¾è®¡è®ºæ–‡</a>ï¼‰ï¼Œ<a href="http://akka.io/">Akka</a>ï¼ˆ<a href="https://www.scala-lang.org/">Scala</a> ç¼–å†™çš„ <a href="http://doc.akka.io/docs/akka/current/scala/actors.html">Akka actor</a> ç³»ç»Ÿï¼ŒAkka ä½¿ç”¨å¤šï¼Œç›¸å¯¹æˆç†Ÿï¼‰ã€Goï¼ˆä½¿ç”¨çš„ goroutineï¼ŒåŸºäº <a href="https://en.wikipedia.org/wiki/Communicating_sequential_processes">CSP</a> æ„å»ºï¼‰éƒ½æ˜¯åŸºäº actor æ¨¡å‹å®ç°æ•°æ®éš”ç¦»ã€‚</p>
<p><a href="https://forums.swift.org/t/swift-concurrency-roadmap/41611">Swiftå¹¶å‘è·¯çº¿å›¾</a>ä¹Ÿé¢„ç¤ºç€ Swift è¦åŠ å…¥ actorï¼ŒChris Lattner ä¹Ÿå¸Œæœ› Swift èƒ½å¤Ÿåœ¨å¤šæ ¸æœºå™¨ï¼Œè¿˜æœ‰å¤§å‹æœåŠ¡é›†ç¾¤èƒ½å¤Ÿå¾—åˆ°æ–¹ä¾¿çš„ä½¿ç”¨ï¼Œåˆ†å¸ƒå¼ç¡¬ä»¶çš„å‘å±•è¶‹åŠ¿å¿…å®šæ˜¯å¤šæ ¸ï¼Œå»å…±äº«å†…å­˜çš„ç¡¬ä»¶çš„ï¼Œå› ä¸ºå…±äº«å†…å­˜çš„ç¼–ç¨‹ä¸å…‰å¤æ‚è€Œä¸”åŸå­æ€§è®¿é—®æ¯”éåŸå­æ€§è¦æ…¢è¿‘ç™¾å€ã€‚ææ¡ˆä¸­è®¾è®¡åˆ° actor çš„è®¾è®¡æ˜¯æŠŠ actor è®¾è®¡æˆä¸€ç§ç‰¹æ®Šç±»ï¼Œè®©è¿™ä¸ªç±»æœ‰å¼•ç”¨è¯­ä¹‰ï¼Œèƒ½å½¢æˆ mapï¼Œå¯ä»¥ weak æˆ– unowned å¼•ç”¨ã€‚actor ç±»ä¸­åŒ…å«ä¸€äº›åªæœ‰ actor æ‰æœ‰çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•æä¾› actor ç¼–ç¨‹æ¨¡å‹æ‰€éœ€å®‰å…¨æ€§ã€‚ä½† actor ç±»ä¸èƒ½ç»§æ‰¿è‡ªé actor ç±»ï¼Œå› ä¸ºè¿™æ · actor çŠ¶æ€å¯èƒ½ä¼šæœ‰æœºä¼šä»¥ä¸å®‰å…¨çš„æ–¹å¼æ³„éœ²ã€‚actor å’Œå®ƒçš„å‡½æ•°å’Œå±æ€§ä¹‹é—´æ˜¯é™æ€å…³ç³»ï¼Œè¿™æ ·å¯ä»¥é€šè¿‡ç¼–è¯‘æ–¹å¼é¿å…æ•°æ®ç«äº‰ï¼Œå¯¹æ•°æ®éš”ç¦»ï¼Œå¦‚æœä¸æ˜¯å®‰å…¨è®¿é—® actor å±æ€§çš„ä¸Šä¸‹æ–‡ï¼Œç¼–è¯‘å™¨å¯ä»¥å¤„ç†åˆ‡æ¢åˆ°é‚£ä¸ªä¸Šä¸‹æ–‡ä¸­ã€‚å¯¹äº actor éš”ç¦»ä¼šå€Ÿé‰´<a href="https://github.com/apple/swift-evolution/blob/main/proposals/0176-enforce-exclusive-access-to-memory.md">å¼ºåˆ¶æ‰§è¡Œå¯¹å†…å­˜çš„ç‹¬å è®¿é—®</a>ææ¡ˆçš„æ€æƒ³ï¼Œæ¯”å¦‚å±€éƒ¨å˜é‡ã€inoutå‚æ•°ã€ç»“æ„ä½“å±æ€§ç¼–è¯‘å™¨å¯ä»¥åˆ†æå˜é‡çš„æ‰€æœ‰è®¿é—®ï¼Œæœ‰å†²çªå°±å¯ä»¥æŠ¥é”™ï¼Œç±»å±æ€§å’Œå…¨å±€å˜é‡è¦åœ¨è¿è¡Œæ—¶å¯ä»¥è·Ÿè¸ªåœ¨è¿›è¡Œçš„è®¿é—®ï¼Œæœ‰å†²çªæŠ¥é”™ã€‚è€Œå…¨å±€å†…å­˜è¿˜æ˜¯æ²¡æ³•é¿å…æ•°æ®ç«äº‰ï¼Œè¿™ä¸ªéœ€è¦å¢åŠ ä¸€ä¸ªå…¨å±€ actor ä¿æŠ¤ã€‚</p>
<p>æŒ‰ actor æ¨¡å‹å¯¹ä»»åŠ¡ä¹‹é—´é€šè®¯é‡æ–°è°ƒæ•´ï¼Œä¸ç”¨å›è°ƒä»£ç†ç­‰æ‰‹æ®µï¼Œå°†å‘é€æ¶ˆæ¯æ”¾åˆ°æ¶ˆæ¯é‚®ç®±é‡Œè¿›è¡Œç±»ä¼¼ RxSwift é‚£æ · next çš„æ–¹å¼ä¸€ä¸ªä¸€ä¸ªä¸²è¡Œä¼ é€’ã€‚è¯´åˆ° RxSwiftï¼Œé‚£ RxSwift å’Œ Combine è¿™æ ·çš„æ¡†æ¶èƒ½æ›¿ä»£ actor å—ï¼Ÿ</p>
<p>å¯¹è¿™äº›å“åº”å¼æ¡†æ¶æ¥è¯´è§£å†³çº¿ç¨‹é€šä¿¡åªæ˜¯å…¶ä¸­å¾ˆå°çš„ä¸€éƒ¨åˆ†ï¼Œå…¶è¿˜æ˜¯ä¼šé¢ä¸´é—­åŒ…ã€è°ƒè¯•å’Œç»´æŠ¤å¤æ‚çš„é—®é¢˜ï¼Œè€Œä¸”è¿˜è¦ä½¿ç”¨å“åº”å¼ç¼–ç¨‹èŒƒå¼ï¼Œæ˜¾ç„¶è¿˜æ˜¯æœ‰äº›é‡äº†ï¼Œé™¤éä½ å·²ç»ä¹ æƒ¯äº†å“åº”å¼ç¼–ç¨‹ã€‚</p>
<p>ä»»åŠ¡éƒ½æŒ‰ actor æ¨¡å‹æ–¹å¼æ¥å†™ï¼Œè¿˜èƒ½å¤Ÿåšåˆ°åŠŸèƒ½ä¹‹é—´çš„è§£è€¦ï¼Œå¦‚æœæ˜¯æœåŠ¡å™¨åº”ç”¨ï¼Œactor å¯ä»¥å¸ƒåˆ°ä¸åŒçš„è¿›ç¨‹ç”šè‡³æ˜¯ä¸åŒæœºå™¨ä¸Šã€‚</p>
<p>actor ä¸­æ¶ˆæ¯é‚®ä»¶åœ¨åŒä¸€æ—¶é—´åªèƒ½å¤„ç†ä¸€ä¸ªæ¶ˆæ¯ï¼Œè¿™æ ·ç­‰å¾…è¿”å›ä¸€ä¸ªå€¼çš„æ–¹å¼ï¼Œéœ€è¦æš‚åœï¼Œå†…éƒ¨æœ‰è¿”å›å†ç»§ç»­æ‰§è¡Œï¼Œè¿™è¦æ€ä¹ˆå®ç°å‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯ä½¿ç”¨ Coroutine</p>
<p>åœ¨ Swift å¹¶å‘è·¯çº¿ææ¡ˆé‡Œè¿˜æåˆ°äº†åŸºäº coroutine çš„ async/await è¯­æ³•ï¼Œè¿™ç§è¯­æ³•é£æ ¼å·²ç»è¢«å¹¿æ³›é‡‡çº³ï¼Œæ¯”å¦‚Pythonã€Dartã€JavaScript éƒ½æœ‰å®ç°ï¼Œè¿™æ ·èƒ½å¤Ÿå†™å‡ºç®€æ´å¥½ç»´æŠ¤çš„å¹¶å‘ä»£ç ã€‚</p>
<p>ä¸Šè¿°åªæ˜¯ææ¡ˆï¼Œæœ€å¿«ä¹Ÿéœ€è¦ä¸¤ä¸ªç‰ˆæœ¬çš„ç­‰å¾…ï¼Œé‚£ä¹ˆè¯­è¨€ä¸Šçš„æ”¯æŒè¿˜æ²¡æœ‰æ¥ï¼Œæ€ä¹ˆèƒ½æå‰äº«ç”¨ coroutine å‘¢ï¼Ÿ</p>
<p><img src="/uploads/thinking-in-how-to-speed-up-app/14.png" alt=""></p>
<p>å¤„ç†æš‚åœæ¢å¤æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨ context å¤„ç†å‡½æ•° setjmp å’Œ longjmpï¼Œä½† setjmp å’Œ longjmp è¾ƒéš¾å®ç°ä¸´æ—¶åˆ‡æ¢åˆ°ä¸åŒçš„æ‰§è¡Œè·¯å¾„ï¼Œç„¶åæ¢å¤åˆ°åœæ­¢æ‰§è¡Œçš„åœ°æ–¹ï¼Œæ‰€ä»¥æœåŠ¡å™¨ç”¨ä¸€èˆ¬éƒ½ä¼šä½¿ç”¨ ucontext æ¥å®ç°ï¼Œgnu çš„ä¸¾çš„ä¾‹å­ <a href="https://www.gnu.org/software/libc/manual/html_mono/libc.html#System-V-contexts">GNU C Library: Complete Context Control</a>ï¼Œè¿™ä¸ªä¾‹å­åœ¨äºåˆ›å»º context å †æ ˆï¼Œswapcontext æ¥ä¿å­˜ contextï¼Œè¿™æ ·å¯ä»¥åœ¨å…¶å®ƒåœ°æ–¹èƒ½æ‰§è¡Œå›åˆ°åŸæ¥çš„åœ°æ–¹ã€‚åˆ›å»º context å †æ ˆä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">uc[<span class="number">1</span>].uc_link = &amp;uc[<span class="number">0</span>];</span><br><span class="line">uc[<span class="number">1</span>].uc_stack.ss_sp = st1;</span><br><span class="line">uc[<span class="number">1</span>].uc_stack.ss_size = <span class="keyword">sizeof</span> st1;</span><br><span class="line">makecontext (&amp;uc[<span class="number">1</span>], (<span class="keyword">void</span> (*) (<span class="keyword">void</span>)) f, <span class="number">1</span>, <span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç ä¸­ uc_link è¡¨ç¤ºçš„æ˜¯ä¸» contextã€‚ä¿å­˜ context çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">swapcontext (&amp;uc[n], &amp;uc[<span class="number">3</span> - n]);</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯åœ¨ Xcode é‡Œä¸€è¯•ï¼Œå‡ºç°é”™è¯¯æç¤ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implicit declaration of function &#x27;swapcontext&#x27; is invalid in c99</span><br></pre></td></tr></table></figure>
<p>åŸæ¥æœ€æ–°çš„ POSXI æ ‡å‡†å·²ç»æ²¡æœ‰è¿™ä¸ªå‡½æ•°äº†ï¼ŒIEEE Std 1003.1-2001 / Cor 2-2004ï¼Œåº”ç”¨äº†é¡¹ç›®XBD/TC2/D6/28ï¼Œæ ‡æ³¨ getcontext()ã€makecontext()ã€setcontext()å’Œswapcontext() å‡½æ•°è¿‡æ—¶äº†ã€‚åœ¨ POSIX  2004ç¬¬743é¡µè¯´æ˜äº†åŸå› ï¼Œå¤§æ¦‚æ„æ€å°±æ˜¯å»ºè®®ä½¿ç”¨ pthread è¿™ç§ç³»ç»Ÿç¼–ç¨‹ä¸Šï¼Œåæ¥çš„ Rust å’Œ Swift coroutine çš„ææ¡ˆé‡Œéƒ½æ˜¯ä½¿ç”¨çš„ç³»ç»Ÿç¼–ç¨‹æ¥å®ç° coroutineï¼Œé•¿æœŸçœ‹ç³»ç»Ÿç¼–ç¨‹å®ç° coroutine è‚¯å®šæ˜¯è¶‹åŠ¿ã€‚é‚£ä¹ˆåœ¨ swift å‡çº§ä¹‹å‰è¿˜æœ‰åŠæ³•åœ¨ iOS ç”¨ ucontext è¿™ç§è½»é‡çº§çš„ coroutine å—ï¼Ÿ</p>
<p>å…¶å®ä¹Ÿæ˜¯æœ‰çš„ï¼Œå¯ä»¥è€ƒè™‘ä¸´æ—¶è¿‡æ¸¡ä¸€ä¸‹ã€‚å…·ä½“å¯ä»¥çœ‹çœ‹ ucontext çš„æ±‡ç¼–å®ç°ï¼Œé‡æ–°åœ¨è‡ªå·±å·¥ç¨‹é‡Œå®ç°å‡ºæ¥å°±å¯ä»¥äº†ã€‚<a href="https://code.woboq.org/userspace/glibc/sysdeps/unix/sysv/linux/x86_64/getcontext.S.html">getcontext</a>ã€<a href="https://code.woboq.org/userspace/glibc/sysdeps/unix/sysv/linux/x86_64/setcontext.S.html">setcontext</a>ã€<a href="https://code.woboq.org/userspace/glibc/sysdeps/unix/sysv/linux/x86_64/makecontext.c.html">makecontext</a>ã€<a href="https://code.woboq.org/userspace/glibc/sysdeps/unix/sysv/linux/x86_64/swapcontext.S.html">swapcontext</a> çš„åœ¨ linux ç³»ç»Ÿä»£ç é‡Œèƒ½çœ‹åˆ°ã€‚ucontext_t ç»“æ„ä½“é‡Œçš„ uc_stack ä¼šè®°å½• context ä½¿ç”¨çš„æ ˆã€‚getcontext() æ˜¯æŠŠå„ä¸ªå¯„å­˜å™¨ä¿å­˜åˆ°å†…å­˜ç»“æ„ä½“é‡Œï¼Œsetcontext() æ˜¯æŠŠæ¥è‡ª makecontext() å’Œ getcontext() çš„å„å¯„å­˜å™¨æ¢å¤åˆ°å½“å‰ context çš„å¯„å­˜å™¨é‡Œã€‚switchcontext() åˆå¹¶äº† getcontext() å’Œ setcontext()ã€‚</p>
<p>ucontext_t çš„ç»“æ„ä½“è®¾è®¡å¦‚ä¸‹ï¼š<br><img src="/uploads/thinking-in-how-to-speed-up-app/6.png" alt=""></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œucontext_t è¿˜åŒ…å«äº†ä¸€ä¸ªæ›´é«˜å±‚æ¬¡çš„ context å°è£… uc_mcontextï¼Œuc_mcontext ä¼šä¿å­˜è°ƒç”¨çº¿ç¨‹çš„å¯„å­˜å™¨ã€‚ä¸Šå›¾ä¸­ eax æ˜¯å‡½æ•°å…¥å‚åœ°å€ï¼Œå¯„å­˜å™¨å€¼å…¥æ ˆæ“ä½œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">movl    $<span class="number">0</span>, oEAX(%eax)</span><br><span class="line">movl    %ecx, oECX(%eax)</span><br><span class="line">movl    %edx, oEDX(%eax)</span><br><span class="line">movl    %edi, oEDI(%eax)</span><br><span class="line">movl    %esi, oESI(%eax)</span><br><span class="line">movl    %ebp, oEBP(%eax)</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šä»£ç ä¸­ oECXã€oEDX ç­‰è¡¨ç¤ºç›¸åº”å¯„å­˜å™¨åœ¨å†…å­˜ç»“æ„ä½“é‡Œçš„ä½ç½®ã€‚esp æŒ‡å‘è¿”å›åœ°å€å€¼ï¼Œç”± eip å­—æ®µè®°å½•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">movl    (%esp), %ecx</span><br><span class="line">movl    %ecx, oEIP(%eax)</span><br></pre></td></tr></table></figure>
<p>edx æ˜¯ getcontext() çš„æ ˆå¯„å­˜å™¨ä¼šè®°å½• ucontext_t.uc_stack.ss_sp æ ˆé¡¶çš„å€¼ï¼ŒoSS_SIZE æ˜¯æ ˆå¤§å°ï¼Œé€šè¿‡æŒ‡ä»¤addl å¯ä»¥æ‰¾åˆ°æ ˆåº•ã€‚makecontext() ä¼šæ ¹æ® ecx é‡Œçš„å‚æ•°å»è®¾ç½®æ ˆï¼Œsetcontext() æ˜¯ getcontext çš„é€†æ“ä½œï¼Œè®¾ç½®å½“å‰ contextï¼Œæ ˆé¡¶åœ¨ esp å¯„å­˜å™¨ã€‚</p>
<p>è½»é‡çº§çš„ coroutine å®ç°äº†ï¼Œä¸‹é¢å’±ä»¬å¯ä»¥é€šè¿‡ Swift <a href="https://github.com/apple/swift-evolution/blob/main/proposals/0296-async-await.md">async/awaitææ¡ˆ</a>ï¼ˆå·²åŠ äº†ç¼–å·0296ï¼Œè¡¨ç¤ºæ ¸å¿ƒå›¢é˜Ÿå·²ç»è®¤å¯ï¼Œä¸Šçº¿å¯æœŸï¼‰çœ‹ä¸‹ç³»ç»Ÿç¼–ç¨‹çš„ coroutine æ˜¯æ€ä¹ˆå®ç°çš„ã€‚Swift async/await ææ¡ˆä¸­çš„æ€è·¯æ˜¯è®©å¼€å‘è€…ç¼–å†™å¼‚æ­¥æ“ä½œé€»è¾‘ï¼Œç¼–è¯‘å™¨ç”¨æ¥è½¬æ¢å’Œç”Ÿæˆæ‰€éœ€çš„éšå¼æ“ä½œé—­åŒ…ã€‚å¯ä»¥çœ‹ä½œæ˜¯ä¸ªè¯­æ³•ç³–ï¼Œå¹¶åƒå…¶å®ƒå®ç°é‚£æ ·ä¼šæ”¹å˜å®Œæˆå¤„ç†ç¨‹åºè¢«è°ƒç”¨çš„é˜Ÿåˆ—ã€‚å·¥ä½œåŸç†ç±»ä¼¼ tryï¼Œä¹Ÿä¸éœ€è¦æ•è· self çš„è½¬ä¹‰é—­åŒ…ã€‚æŒ‚èµ·ä¼šä¸­æ–­åŸå­æ€§ï¼Œæ¯”å¦‚ä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—ä¸­ä»»åŠ¡è¦æŒ‚èµ·ï¼Œè®©å…¶å®ƒä»»åŠ¡åœ¨ä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—ä¸­äº¤é”™è¿è¡Œï¼Œå› æ­¤å¼‚æ­¥å‡½æ•°æœ€å¥½æ˜¯ä¸é˜»å¡çº¿ç¨‹ã€‚å°†å¼‚æ­¥å‡½æ•°å½“ä½œä¸€èˆ¬å‡½æ•°è°ƒç”¨ï¼Œè¿™æ ·çš„è°ƒç”¨ä¼šæš‚æ—¶ç¦»å¼€çº¿ç¨‹ï¼Œç­‰å¾…å½“å‰çº¿ç¨‹ä»»åŠ¡å®Œæˆå†ä»å®ƒç¦»å¼€çš„åœ°æ–¹æ¢å¤æ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Œå¹¶ä¿è¯æ˜¯åœ¨å…ˆå‰çš„actoré‡Œæ‰§è¡Œå®Œæˆã€‚</p>
<h2 id="å¯åŠ¨æ€§èƒ½åˆ†æå·¥å…·"><a href="#å¯åŠ¨æ€§èƒ½åˆ†æå·¥å…·" class="headerlink" title="å¯åŠ¨æ€§èƒ½åˆ†æå·¥å…·"></a>å¯åŠ¨æ€§èƒ½åˆ†æå·¥å…·</h2><h3 id="iOS-å®˜æ–¹å·¥å…·"><a href="#iOS-å®˜æ–¹å·¥å…·" class="headerlink" title="iOS å®˜æ–¹å·¥å…·"></a>iOS å®˜æ–¹å·¥å…·</h3><p>Instruments ä¸­ Time Profiles ä¸­çš„ Profile å¯ä»¥æ–¹ä¾¿çš„åˆ†ææ¨¡å—ä¸­æ¯ä¸ªæ–¹æ³•çš„è€—æ—¶ã€‚Time Profiles ä¸­çš„ Samples åˆ†æå°†æ›´åŠ å‡†ç¡®çš„æ˜¾ç¤ºå‡º App å¯åŠ¨åæ¯ä¸€ä¸ª CPU æ ¸å¿ƒåœ¨ä¸€ä¸ªæ—¶é—´ç‰‡å†…æ‰€æ‰§è¡Œçš„ä»£ç ã€‚å¦‚æœåœ¨æ¨¡å—å¼€å‘ä¸­æœ‰ä»¥ä¸‹çš„éœ€æ±‚ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ Samples åˆ†æï¼š</p>
<ol>
<li>å¸Œæœ›æ›´ç²¾ç¡®çš„åˆ†ææŸä¸ªæ–¹æ³•å…·ä½“æ‰§è¡Œä»£ç çš„è€—æ—¶</li>
<li>æƒ³çŸ¥é“ä¸€ä¸ªæ–¹æ³•åˆ°å¦ä¸€ä¸ªæ–¹æ³•çš„è€—æ—¶æƒ…å†µï¼ˆè·¨æ–¹æ³•è€—æ—¶åˆ†æï¼‰</li>
</ol>
<p>MetricKit 2.0 å¼€å§‹åŠ å¼ºäº†è¯Šæ–­ç‰¹æ€§ï¼Œé€šè¿‡æ”¶é›†è°ƒç”¨æ ˆä¿¡æ¯èƒ½å¤Ÿæ–¹ä¾¿æˆ‘ä»¬æ¥è¿›è¡Œé—®é¢˜çš„è¯Šæ–­ï¼Œé€šè¿‡ didReceive å›è°ƒ MXMetricPayload æ€§èƒ½æ•°æ®ï¼Œå¯åŒ…å« MXSignpostMetric è‡ªå®šä¹‰é‡‡é›†æ•°æ®ï¼Œç”šè‡³æ˜¯ä½ æ•è·ä¸åˆ°çš„å´©æºƒä¿¡å·çš„ç³»ç»Ÿå¼ºæ€å´©æºƒä¿¡æ¯ä¼ åˆ°è‡ªå·±æœåŠ¡å™¨è¿›è¡Œåˆ†æå’ŒæŠ¥è­¦ã€‚</p>
<h3 id="å¦‚ä½•åœ¨-iOS-çœŸæœºå’Œæ¨¡æ‹Ÿå™¨ä¸Šå®ç°è‡ªåŠ¨åŒ–æ€§èƒ½åˆ†æ"><a href="#å¦‚ä½•åœ¨-iOS-çœŸæœºå’Œæ¨¡æ‹Ÿå™¨ä¸Šå®ç°è‡ªåŠ¨åŒ–æ€§èƒ½åˆ†æ" class="headerlink" title="å¦‚ä½•åœ¨ iOS çœŸæœºå’Œæ¨¡æ‹Ÿå™¨ä¸Šå®ç°è‡ªåŠ¨åŒ–æ€§èƒ½åˆ†æ"></a>å¦‚ä½•åœ¨ iOS çœŸæœºå’Œæ¨¡æ‹Ÿå™¨ä¸Šå®ç°è‡ªåŠ¨åŒ–æ€§èƒ½åˆ†æ</h3><p>è‹¹æœæœ‰ä¸ª usbmux åè®®ä¼šç»™è‡ªå·± macOS ç¨‹åºå’Œè®¾å¤‡è¿›è¡Œé€šä¿¡ï¼Œåœºæ™¯æœ‰å¤‡ä»½ iPhone è¿˜æœ‰çœŸæœºè°ƒè¯•ã€‚macOS å¯¹åº”çš„æ˜¯/System/Library/PrivateFrameworks/MobileDevice.framework/Versions/A/Resources/ ä¸‹çš„ usbmuxd ç¨‹åºï¼Œusbmuxd æ˜¯ IPC socket å’Œ TCP socket ç”¨æ¥è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡ï¼Œ<a href="https://github.com/libimobiledevice/usbmuxd">è¿™é‡Œ</a>æœ‰ä»–çš„ä¸€ä¸ªå¼€æºå®ç°ã€‚å¯¹äºåœ¨æ‰‹æœºç«¯æ˜¯ lockdown æ¥èµ·æœåŠ¡ã€‚å› æ­¤åˆ©ç”¨ usbmuxd çš„åè®®ï¼Œå°±å¯ä»¥è‡ªå»ºå’Œè®¾å¤‡é€šä¿¡çš„åº”ç”¨æ¯”å¦‚ lookinï¼Œå®ç°æ–¹å¼å¯ä»¥å‚è€ƒè¿™ä¸ª <a href="https://github.com/rsms/peertalk">demo</a>ã€‚ä½¿ç”¨ usbmux åè®®çš„ <a href="https://github.com/libimobiledevice/libimobiledevice">libimobiledevice</a>ï¼ˆç›¸å½“äº Android çš„ adbï¼‰æä¾›äº†æ›´å¤šèƒ½åŠ›ï¼Œå¯ä»¥è·å–è®¾å¤‡çš„ä¿¡æ¯ã€æ­è½½ <a href="https://github.com/libimobiledevice/ifuse">ifuse</a> è®¿é—®è®¾å¤‡æ–‡ä»¶ç³»ç»Ÿï¼ˆæ²¡è¶Šç‹±å¯è®¿é—®ç…§ç‰‡åª’ä½“ã€æ²™ç›’ã€æ—¥å¿—ï¼‰ã€ä¸è°ƒè¯•æœåŠ¡å™¨è¿æ¥è¿œç¨‹è°ƒè¯•ã€‚æ— ä¾µå…¥çš„åº“è¿˜æœ‰ <a href="https://www.gamebench.net/">gamebench</a> ä¹Ÿç”¨åˆ°äº† libimobiledeviceã€‚</p>
<p>instruments å¯ä»¥å¯¼å‡º .trace æ–‡ä»¶ï¼Œä»¥å‰åªèƒ½ç”¨ instruments æ‰“å¼€ï¼ŒXcode12 æä¾›äº† xctrace å‘½ä»¤è¡Œå·¥å…·å¯ä»¥å¯¼å‡ºå¯åˆ†æçš„æ•°æ®ã€‚Xcode12 ä¹‹å‰çš„æ—¶å€™æ˜¯èƒ½ä½¿ç”¨ <a href="https://github.com/Qusic/TraceUtility">TraceUtility</a> è¿™ä¸ªåº“ï¼ŒTraceUtility çš„åšæ³•æ˜¯é“¾ä¸Š Xcode é‡Œ instruments ç”¨çš„é‚£äº›åº“ï¼Œæ¯”å¦‚ DVTFoundation å’Œ InstrumentsKit ç­‰ï¼Œè°ƒç”¨å¯¹åº”çš„æ–¹æ³•å»è·å–.traceæ–‡ä»¶ã€‚ä½¿ç”¨ libimobiledevice èƒ½æ„é€ æ“ä½œ instruments çš„åº”ç”¨ï¼Œå°† instruments çš„èƒ½åŠ›è‡ªåŠ¨åŒ–ã€‚</p>
<p><a href="https://perfdog.qq.com/">perfdog</a>å°±æ˜¯ä½¿ç”¨äº†libimobiledeviceè°ƒç”¨äº†instrumentsçš„æ¥å£ï¼ˆè§<a href="https://recon.cx/2018/montreal/schedule/system/event_attachments/attachments/000/000/043/original/RECON-MTL-2018-Discovering_the_iOS_Instruments_Server.pdf">æ¥å£ç ”ç©¶</a>ï¼Œ<a href="https://github.com/troybowman/ios_instruments_client">å®ç°ä»£ç </a>ï¼‰æ¥å®ç°instrumentsçš„ä¸€äº›åŠŸèƒ½ï¼Œå¹¶è¿›è¡Œäº†æ‰©å±•å®šåˆ¶ï¼Œæ— ä¾µå…¥çš„æ„å»ºæœ¬åœ°æ€§èƒ½ç›‘æ§å¹¶é›†æˆåˆ°è‡ªåŠ¨æµ‹è¯•ä¸­å‡ºæ•°æ®ï¼Œå‡å°‘äººå·¥æˆæœ¬ã€‚æ— ä¾µå…¥çš„å¦ä¸€ä¸ªå¥½å¤„å°±æ˜¯å¯ä»¥æ–¹ä¾¿ç”¨åŒä¸€å¥—æ ‡å‡†çœ‹åˆ°å…¶ä»–APPçš„è¡¨ç°æƒ…å†µã€‚</p>
<p>è¦åˆ°å…·ä½“åœºæ™¯å»è·‘ case è¿˜éœ€è¦æµç¨‹è‡ªåŠ¨åŒ–ã€‚Appium ä½¿ç”¨çš„æ˜¯ Facebook å¼€å‘çš„ä¸€å¥—åŸºäº W3C æ ‡å‡†äº¤äº’åè®® <a href="https://w3c.github.io/webdriver/">WebDriver</a> çš„åº“ <a href="https://github.com/facebookarchive/WebDriverAgent">WebDriverAgent</a>ï¼Œpython ç‰ˆå¯ä»¥çœ‹<a href="https://github.com/openatx/facebook-wda">è¿™ä¸ª</a>ï¼Œä¸è¿‡åæ¥ Facebook å¼€å‘äº†æ–°çš„ä¸€å¥—å‘½ä»¤è¡Œå·¥å…·<a href="https://github.com/facebook/idb/">idb(iOS Development Bridge)</a>ï¼Œå½’æ¡£äº† WebDriverAgentã€‚idb å¯ä»¥å¯¹ iOS æ¨¡æ‹Ÿå™¨å’Œè®¾å¤‡è·‘è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œidb ä¸»è¦æœ‰ä¸¤ä¸ªåŸºäº macOS ç³»ç»Ÿåº“ CoreSimulator.frameworkã€MobileDevice.frameworkï¼ŒåŒ…è£…çš„ FBSimulatorControl å’Œ FBDeviceControl åº“ã€‚FBSimulatorControl åŒ…å«äº† iOS æ¨¡æ‹Ÿå™¨çš„æ‰€æœ‰åŠŸèƒ½ï¼ŒXcode å’Œ simctl éƒ½æ˜¯ç”¨çš„ CoreSimulatorï¼Œè‡ªåŠ¨åŒ–ä¸­è¾“å…¥äº‹ä»¶æ˜¯é€†å‘äº† iOS æ¨¡æ‹Ÿå™¨ Indigo æœåŠ¡çš„åè®®ï¼ŒIndigo æ˜¯æ¨¡æ‹Ÿå™¨é€šè¿‡ mach IPC é€šé“ mach_msg_send æ¥å—è§¦æ‘¸ç­‰è¾“å…¥äº‹ä»¶çš„åè®®ã€‚ç ´è§£åå°±å¯ä»¥æ¨¡æ‹Ÿè¾“å…¥äº‹ä»¶äº†ã€‚MobileDevice.framework ä¹Ÿæ˜¯ macOS çš„ç§æœ‰åº“ï¼ŒmacOS ä¸Šçš„ Finderã€Xcodeã€Photos è¿™äº›ä¼šä½¿ç”¨ iOS è®¾å¤‡çš„åº”ç”¨éƒ½æ˜¯ç”¨äº† MobileDeviceï¼Œæ–‡ä»¶è¯»å†™ç”¨çš„æ˜¯åŒ…è£…äº† AMDServiceConnection åè®®çš„ AFC æ–‡ä»¶æ“ä½œ APIï¼Œidb çš„ instruments ç›¸å…³åŠŸèƒ½æ˜¯åœ¨<a href="https://github.com/facebook/idb/blob/master/FBDeviceControl/Management/FBInstrumentsClient.h">è¿™é‡Œ</a>å®ç°äº† DTXConnectionServices æœåŠ¡åè®®ã€‚libmobiledevice å¯ä»¥çœ‹ä½œæ˜¯é‡æ–°å®ç°äº† MobileDevice.frameworkã€‚<a href="https://github.com/iOSForensics/pymobiledevice">pymobiledevice</a>ã€<a href="https://github.com/mountainstorm/MobileDevice">MobileDevice</a>ã€C ç¼–å†™çš„ <a href="https://github.com/samdmarshall/SDMMobileDevice/">SDMMobileDevice</a>ï¼Œè¿˜æœ‰Objective-C ç¼–å†™çš„ <a href="https://github.com/cipi1965/MobileDeviceAccess">MobileDeviceAccess</a>ï¼Œè¿™äº›åº“ä¹Ÿæ˜¯ç”¨çš„ MobileDevice.frameworkã€‚</p>
<p>æ€»ç»“å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/uploads/thinking-in-how-to-speed-up-app/15.png" alt=""></p>
<h3 id="Android-Profiler"><a href="#Android-Profiler" class="headerlink" title="Android Profiler"></a>Android Profiler</h3><p>Android Profiler æ˜¯ Android ä¸­å¸¸ç”¨çš„è€—æ—¶åˆ†æå·¥å…·ï¼Œä»¥å„ç§å›¾è¡¨çš„å½¢å¼å±•ç¤ºå‡½æ•°æ‰§è¡Œæ—¶é—´ï¼Œå¸®åŠ©å¼€å‘è€…åˆ†æè€—æ—¶é—®é¢˜ã€‚</p>
<p>å¯åŠ¨ä¼˜åŒ–ç€å®æ˜¯ç‰µä¸€å‘åŠ¨å…¨èº«çš„äº‹æƒ…ï¼Œæ‰‹æ®µæ—¢çç¢åˆå¤æ‚ã€‚å¦‚ä½•èƒ½å¤Ÿå°†ç›‘æ§ä½“ç³»å»ºè®¾èµ·æ¥ï¼Œå¹¶èå…¥åˆ°æ•´ä¸ªç ”å‘åˆ°ä¸Šçº¿æµç¨‹ä¸­ï¼Œæ˜¯ä¸ªåºå¤§çš„å·¥ç¨‹ã€‚ä¸‹é¢ç»™ä½ ä»‹ç»ä¸‹æˆ‘ä»¬æ˜¯å¦‚ä½•åšçš„å§ã€‚</p>
<h2 id="ç®¡æ§æµç¨‹ä½“ç³»ä¿éšœå¹³å°å»ºè®¾"><a href="#ç®¡æ§æµç¨‹ä½“ç³»ä¿éšœå¹³å°å»ºè®¾" class="headerlink" title="ç®¡æ§æµç¨‹ä½“ç³»ä¿éšœå¹³å°å»ºè®¾"></a>ç®¡æ§æµç¨‹ä½“ç³»ä¿éšœå¹³å°å»ºè®¾</h2><p>APMè‡ªåŠ¨åŒ–ç®¡æ§å’Œæµç¨‹ä½“ç³»ä¿éšœå¹³å°ï¼Œç›®æ ‡æ˜¯é€šè¿‡ç¨³å®šç¯å¢ƒæ›´è‡ªåŠ¨åŒ–çš„æµ‹è¯•ï¼Œé‡‡é›†åˆ°çš„æ€§èƒ½æ•°æ®èƒ½å¤Ÿé€šè¿‡åˆ†ææ£€æµ‹ï¼Œå‘ç°é—®é¢˜èƒ½å¤Ÿæ›´ä½æˆæœ¬å®šä½åˆ†å‘å‘Šè­¦ï¼ŒåŒæ—¶å¤§ç›˜èƒ½å¤Ÿå±•ç¤ºè¶‹åŠ¿å’Œè¯¦æƒ…ã€‚å¹³å°è®¾è®¡å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/uploads/thinking-in-how-to-speed-up-app/10.png" alt=""></p>
<p>å¼€å‘è¿‡ç¨‹ä¼š daily å‡ºè¿­ä»£æŠ¥å‘Šï¼Œå¼€å‘å®Œæˆåï¼Œä¼šæœ‰é›†æˆå¡å£ï¼Œæå‰å¡ä½è¿­ä»£æ€§èƒ½é—®é¢˜ã€‚</p>
<p>é›†æˆåï¼Œåœ¨é›†æˆæ„å»ºå¹³å°èƒ½å¤Ÿæ„å»ºæ­£å¼åŒ…å’Œçº¿ä¸‹æ€§èƒ½åŒ…ï¼Œè¿›è¡Œçº¿ä¸‹æµ‹è¯•å’Œçº¿ä¸Šæ€§èƒ½æ•°æ®é‡‡é›†ï¼Œçº¿ä¸‹æ”¯æŒå½•åˆ¶å›æ”¾ã€Monkey ç­‰è‡ªåŠ¨åŒ–æµ‹è¯•æ‰‹æ®µï¼Œæµ‹è¯•æœŸé—´ä¼šæœ‰ç”Ÿæˆç‰ˆæœ¬æŠ¥å‘Šï¼Œå‘å¸ƒä¸Šçº¿å‰ä¹Ÿä¼šæœ‰å‘å¸ƒå¡å£ï¼ŒåŠæ—¶å¤„ç†ç‰ˆæœ¬é—®é¢˜ã€‚</p>
<p>å‘å¸ƒåï¼Œé€šè¿‡äº‘æ§è¿›è¡ŒæŒ‡æ ‡é…ç½®ã€é˜ˆå€¼é…ç½®è¿˜æœ‰é‡‡é›†æ¯”ä¾‹ç­‰ã€‚æ€§èƒ½æ•°æ®ä¸Šä¼ æœåŠ¡ç»å¼‚å¸¸æ£€æµ‹å‘ç°é—®é¢˜ä¼šè§¦å‘æŠ¥è­¦ï¼Œè‡ªåŠ¨åœ¨ Bug å¹³å°åˆ›å»ºå·¥å•è¿›è¡Œè·Ÿè¸ªï¼Œä»¥ä¾¿åŠæ—¶ä¿®å¤é—®é¢˜å‡å°‘ç”¨æˆ·ä½“éªŒæŸå¤±ã€‚æœåŠ¡è¿˜ä¼šåšç»Ÿè®¡ã€åˆ†çº§ã€åŸºçº¿å¯¹æ¯”ã€ç‰ˆæœ¬å…³è”ä»¥åŠè¿‡æ»¤ç­‰æ•°æ®åˆ†ææ“ä½œï¼Œè¿™äº›åˆ†æåçš„æ€§èƒ½æ•°æ®æœ€ç»ˆä¼šé€šè¿‡ç‰ˆæœ¬ã€è¿­ä»£è¶‹åŠ¿ç­‰ç»Ÿè®¡æŠ¥è¡¨æ–¹å¼åœ¨å¤§ç›˜ä¸Šå±•ç¤ºï¼Œè¿˜èƒ½å±•ç¤ºè¯¦æƒ…ï¼ŒåŒ…æ‹¬å¯¹æ¯”å±•ç¤ºã€é—®é¢˜è¯¦æƒ…ã€åœºæ™¯åˆ†ç±»ã€æ¡ä»¶æŸ¥è¯¢ç­‰ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/uploads/thinking-in-how-to-speed-up-app/1.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;
    
    </summary>
    
      <category term="Programming" scheme="http://ming1016.github.io/categories/Programming/"/>
    
    
      <category term="iOS" scheme="http://ming1016.github.io/tags/iOS/"/>
    
      <category term="Swift" scheme="http://ming1016.github.io/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>2020å¹´æ¶‚å›¾</title>
    <link href="http://ming1016.github.io/2020/05/04/draw-in-2020/"/>
    <id>http://ming1016.github.io/2020/05/04/draw-in-2020/</id>
    <published>2020-05-04T15:47:57.000Z</published>
    <updated>2021-04-11T14:42:09.916Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/uploads/draw-in-2020/01.jpg" alt=""><br><img src="/uploads/draw-in-2020/02.jpg" alt=""><br><img src="/uploads/draw-in-2020/03.jpg" alt=""><br><img src="/uploads/draw-in-2020/04.png" alt=""><br><img src="/uploads/draw-in-2020/05.png" alt=""><br><img src="/uploads/draw-in-2020/06.jpg" alt=""><br><img src="/uploads/draw-in-2020/07.jpg" alt=""><br><img src="/uploads/draw-in-2020/08.jpg" alt=""><br><img src="/uploads/draw-in-2020/09.png" alt=""><br><img src="/uploads/draw-in-2020/10.png" alt=""><br><img src="/uploads/draw-in-2020/11.jpg" alt=""><br><img src="/uploads/draw-in-2020/12.jpg" alt=""><br><img src="/uploads/draw-in-2020/13.jpg" alt=""><br><img src="/uploads/draw-in-2020/14.png" alt=""><br><img src="/uploads/draw-in-2020/15.png" alt=""></p>
<p><img src="/uploads/why_write_study_ios_programming_with_daiming_book_and_draw_recently/08.jpg" alt=""><br><img src="/uploads/why_write_study_ios_programming_with_daiming_book_and_draw_recently/09.jpg" alt=""><br><img src="/uploads/why_write_study_ios_programming_with_daiming_book_and_draw_recently/10.jpg" alt=""><br><img src="/uploads/why_write_study_ios_programming_with_daiming_book_and_draw_recently/11.jpg" alt=""><br><img src="/uploads/why_write_study_ios_programming_with_daiming_book_and_draw_recently/12.jpg" alt=""><br><img src="/uploads/why_write_study_ios_programming_with_daiming_book_and_draw_recently/13.jpg" alt=""><br><img src="/uploads/why_write_study_ios_programming_with_daiming_book_and_draw_recently/14.jpg" alt=""><br><img src="/uploads/why_write_study_ios_programming_with_daiming_book_and_draw_recently/15.jpg" alt=""><br><img src="/uploads/why_write_study_ios_programming_with_daiming_book_and_draw_recently/16.jpg" alt=""><br><img src="/uploads/why_write_study_ios_programming_with_daiming_book_and_draw_recently/17.jpg" alt=""><br><img src="/uploads/why_write_study_ios_programming_with_daiming_book_and_draw_recently/19.jpg" alt=""><br><img src="/uploads/why_write_study_ios_programming_with_daiming_book_and_draw_recently/20.jpg" alt=""><br><img src="/uploads/why_write_study_ios_programming_with_daiming_book_and_draw_recently/21.jpg" alt=""><br><img src="/uploads/why_write_study_ios_programming_with_daiming_book_and_draw_recently/22.jpg" alt=""><br><img src="/uploads/why_write_study_ios_programming_with_daiming_book_and_draw_recently/23.jpg" alt=""><br><img src="/uploads/why_write_study_ios_programming_with_daiming_book_and_draw_recently/24.jpg" alt=""><br><img src="/uploads/why_write_study_ios_programming_with_daiming_book_and_draw_recently/25.jpg" alt=""><br><img src="/uploads/why_write_study_ios_programming_with_daiming_book_and_draw_recently/26.jpg" alt=""><br><img src="/uploads/why_write_study_ios_programming_with_daiming_book_and_draw_recently/27.jpg" alt=""></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/uploads/draw-in-2020/01.jpg&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;img src=&quot;/uploads/draw-in-2020/02.jpg&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;img src=&quot;/uploads/draw-in-2020/03.
    
    </summary>
    
      <category term="My painting" scheme="http://ming1016.github.io/categories/My-painting/"/>
    
    
      <category term="Painting" scheme="http://ming1016.github.io/tags/Painting/"/>
    
      <category term="iPad" scheme="http://ming1016.github.io/tags/iPad/"/>
    
      <category term="Procreate" scheme="http://ming1016.github.io/tags/Procreate/"/>
    
  </entry>
  
  <entry>
    <title>æˆ‘ä¸ºä»€ä¹ˆå†™äº†ã€Šè·Ÿæˆ´é“­å­¦iOSç¼–ç¨‹ã€‹è¿™æœ¬ä¹¦</title>
    <link href="http://ming1016.github.io/2020/04/12/why_write_study_ios_programming_with_daiming_book_and_draw_recently/"/>
    <id>http://ming1016.github.io/2020/04/12/why_write_study_ios_programming_with_daiming_book_and_draw_recently/</id>
    <published>2020-04-12T12:31:03.000Z</published>
    <updated>2021-04-11T14:42:09.936Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨æˆ‘æ”¹äº†å‡ æ¬¡å°é¢åï¼Œä¹¦å·²ä¸Šæ¶ã€‚</p>
<p><img src="/uploads/why_write_study_ios_programming_with_daiming_book_and_draw_recently/01.jpg" alt=""><br><img src="/uploads/why_write_study_ios_programming_with_daiming_book_and_draw_recently/02.jpg" alt=""><br><img src="/uploads/why_write_study_ios_programming_with_daiming_book_and_draw_recently/03.jpg" alt=""><br><img src="/uploads/why_write_study_ios_programming_with_daiming_book_and_draw_recently/04.png" alt=""><br><img src="/uploads/why_write_study_ios_programming_with_daiming_book_and_draw_recently/05.jpg" alt=""><br><img src="/uploads/why_write_study_ios_programming_with_daiming_book_and_draw_recently/06.png" alt=""><br><img src="/uploads/why_write_study_ios_programming_with_daiming_book_and_draw_recently/07.png" alt=""></p>
<h2 id="ä¸ºä»€ä¹ˆå†™ã€Šè·Ÿæˆ´é“­å­¦iOSç¼–ç¨‹ã€‹"><a href="#ä¸ºä»€ä¹ˆå†™ã€Šè·Ÿæˆ´é“­å­¦iOSç¼–ç¨‹ã€‹" class="headerlink" title="ä¸ºä»€ä¹ˆå†™ã€Šè·Ÿæˆ´é“­å­¦iOSç¼–ç¨‹ã€‹"></a>ä¸ºä»€ä¹ˆå†™ã€Šè·Ÿæˆ´é“­å­¦iOSç¼–ç¨‹ã€‹</h2><p>åˆåˆ°äº†æ–°çš„ä¸€å¹´å¼€å§‹æ¢å·¥ä½œçš„å­£èŠ‚ï¼Œæˆ‘èº«è¾¹å¥½å¤šç†Ÿäººä¹Ÿéƒ½å¼€å§‹å¯»æ‰¾æœºä¼šï¼Œçœ‹èµ·æ¥ç¦»èŒåŸå› å„æœ‰ä¸åŒï¼Œæœ‰ç»©æ•ˆä¸å¥½çš„ã€å’Œé¢†å¯¼å¤„ä¸å¥½çš„ã€å¤šå¹´éš¾æ™‹å‡çš„ã€åšçš„äº‹æƒ…éš¾æå‡è‡ªå·±çš„ã€æœ‰æ›´å¥½æœºä¼šçš„ã€‚ä½†ç©¶å…¶æ ¸å¿ƒï¼Œæˆ‘è§‰å¾—è¿˜æ˜¯å±æœºæ„Ÿï¼Œæƒ³ç€å¦‚æœè„±ç¦»ç°åœ¨æ‰€å¤„å…¬å¸ç¯å¢ƒï¼Œæ²¡æœ‰ç°åœ¨çš„çº§åˆ«ä½ç½®ï¼Œè‡ªå·±è¿˜å‰©ä¸‹ä»€ä¹ˆï¼Œåœ¨ä¸€ç¾¤å€™é€‰äººé‡Œï¼Œè‡ªå·±æœ‰æ²¡æœ‰èƒœäºå…¶ä»–äººçš„äº®ç‚¹ï¼Œæ˜¯å¦èƒ½å¤Ÿè„±é¢–è€Œå‡ºã€‚æˆ‘æ—¶å¸¸ä¼šæ€è€ƒè¿™äº›é—®é¢˜ï¼Œåšäº†å¤šå¹´æŠ€æœ¯ï¼Œä¸€ç›´åœ¨æƒ³ï¼Œç›¸åŒæ—¶é—´é‡Œæ¥è§¦å’Œå­¦ä¹ ä»€ä¹ˆçŸ¥è¯†æ‰æ˜¯ç‰©æœ‰æ‰€å€¼çš„ã€‚</p>
<p>è®¡ç®—æœºé¢†åŸŸï¼Œä½œä¸ºå¼€å‘è€…æœ€å¼€å§‹æ¥è§¦ï¼ŒåŒæ—¶ä¹Ÿæ˜¯è¿ç”¨æœ€å¤šçš„å°±æ˜¯ç¼–ç¨‹è¯­è¨€ï¼Œç°åœ¨å­¦ä¹  iOS å¼€å‘ä¸€å®šè¦é€‰æ‹©ç”¨ Swiftã€‚é‚£ä¹ˆï¼Œä» Swift å®˜æ–¹æ‰‹å†Œå­¦ä¹ å®Œ Swift è¯­æ³•ï¼Œç†Ÿç»ƒè¿›è¡Œ App å¼€å‘ä¸Šæ¶åŠæ—¥å¸¸è¿­ä»£å¼€å‘åï¼Œè¿˜è¦å­¦ä¹ ä»€ä¹ˆæ‰èƒ½å¤Ÿè®©è‡ªå·±èƒ½å¤Ÿæ›´è¿›ä¸€æ­¥å‘¢ï¼Œæ‰èƒ½è®©è‡ªå·±æ›´æœ‰ç«äº‰åŠ›ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªæ˜¯éœ€è¦åå¤æ€è€ƒçš„ã€‚æˆ‘ä¸è§‰å¾—æ— ä¼‘æ­¢çš„è·Ÿè¿›æ¯å¹´ç³»ç»Ÿå‡çº§æ–°ç‰¹æ€§ï¼Œæ¯”å¦‚ ARKitã€WatchKitã€Force Touchã€iBeaconã€SiriKit ç­‰ï¼Œæˆ–è€…ç†Ÿç»ƒç³»ç»Ÿå’Œå¼€æºæ§ä»¶ï¼Œæ¯”å¦‚Segmented Controlã€Picker Viewã€Popã€èƒ½å¤Ÿå¯¹è‡ªå·±æœ‰æœ¬è´¨çš„æé«˜ã€‚ä¸æ˜¯è¯´å­¦è¿™äº›æ²¡ç”¨ï¼Œè€Œæ˜¯å¤Ÿç”¨å°±è¡Œï¼Œæ¯•ç«Ÿå¼€å‘ App æ¥æœåŠ¡ç”¨æˆ·ï¼Œæœ€ç»ˆè¿˜æ˜¯éœ€è¦ç”±è¿™äº›æ¥æ”¯æŒåŠŸèƒ½å¼€å‘ã€‚</p>
<p>æˆ‘æƒ³è¡¨è¾¾çš„æ˜¯ï¼Œå¯¹äºä½ ä¸ªäººæ¥è¯´ï¼Œå½“ä½ è¦ä»æ™®é€šå¼€å‘è€…å¾€æ¶æ„è®¾è®¡å¸ˆè¿™æ¡è·¯ä¸Šèµ°ï¼Œé™¤äº†æ»¡è¶³ç”¨æˆ·åŠŸèƒ½éœ€æ±‚çš„å¼€å‘ï¼Œè¿˜éœ€è¦äº†è§£æ›´å¤šæŠ€æœ¯é€‰å‹ï¼Œæ‰èƒ½ä¸ºå›¢é˜Ÿå¼€å‘æ•ˆç‡å’Œè´¨é‡æä¾›æ”¯æŒä¿éšœã€‚è¿™ä¸å…‰æ˜¯å‡­å€Ÿç»éªŒå°±èƒ½å¤Ÿåšåˆ°çš„ï¼Œè¿˜éœ€è¦å¯¹ç¼–ç¨‹è¯­è¨€å’Œç¼–ç¨‹èŒƒå¼æœ‰æ›´å¤šçš„äº†è§£ï¼Œæˆ‘åœ¨å†™ã€Šè·Ÿæˆ´é“­å­¦iOSç¼–ç¨‹ã€‹è¿™æœ¬ä¹¦æ—¶ï¼Œæˆ‘å¯¹ Swift è¯­è¨€åšäº†æ·±æŒ–ï¼Œè€Œä¸æ˜¯ç…§æ¬æ‰‹å†Œï¼Œä¹Ÿæ˜¯æƒ³è®©ä½ èƒ½å¤Ÿé€šè¿‡æ³›å‹ï¼Œé›†åˆã€å†…å­˜å’ŒèŒƒå¼æ›´å¤šäº†è§£ Swfit è¿™é—¨è¯­è¨€ã€‚åŒæ—¶ç»“åˆå®é™…å¼€å‘ä¸­ä½¿ç”¨æœ€é¢‘ç¹çš„åœºæ™¯ï¼Œæ¯”å¦‚ JSON æ•°æ®å¤„ç†ï¼Œç½‘ç»œè¯·æ±‚å’Œç•Œé¢å¸ƒå±€ï¼Œä»åº•å±‚æºç å±‚é¢æ¥å‰–æè¿™äº›åº”ç”¨åœºæ™¯èƒŒåçš„ä»£ç å®ç°åŸç†ã€‚æœ¬ä¹¦ Swift ç« èŠ‚æœ€åè¿˜è¯¦ç»†è¯´äº†æ€ä¹ˆç”¨ Swift å¼€å‘äº†è¯­è¨€è½¬æ¢å™¨å’Œè§£é‡Šå™¨ï¼Œä¸€æ­¥ä¸€æ­¥æŒæ¡è¯­è¨€è§£æçš„è¿‡ç¨‹ï¼Œè¿™éƒ¨åˆ†å†…å®¹æ˜¯å¯¹ä¸Šæ¬¡æˆ‘åœ¨ @Swift å¤§ä¼šä¸Šè®²çš„å†…å®¹çš„è¡¥å……ï¼Œå¤§ä¼šå¹»ç¯ç‰‡å¯è§ï¼š<a href="https://ming1016.github.io/2018/09/17/produce-slides-of-third-at-swift-conference/">è¿™æ¬¡swiftå¤§ä¼šåˆ†äº«å‡†å¤‡çš„å¹»ç¯ç‰‡å’Œ demo | æˆ´é“­çš„åšå®¢ - æ˜Ÿå…‰ç¤¾</a>ã€‚</p>
<p>å¯¹è¯­è¨€ç¼–è¯‘è¿‡ç¨‹çš„å­¦ä¹ ï¼Œä»·å€¼æ˜¯å¾ˆé«˜çš„ï¼Œæœ¬ä¹¦ä¹Ÿç€é‡ä»‹ç»äº†ç¼–è¯‘ä»¥åŠç¼–è¯‘äº§ç‰©çš„çŸ¥è¯†å’Œè¿ç”¨ã€‚ä½ å¯ä»¥å›æƒ³ä¸‹ï¼Œå½“ç¢°åˆ°ä¸€ä¸ªä»¥å‰æ²¡æœ‰åšè¿‡çš„éœ€æ±‚ï¼Œè§£å†³ä¸€ä¸ªæ²¡æœ‰ç¢°åˆ°è¿‡çš„çº¿ä¸Šé—®é¢˜æ—¶ï¼Œå¤„ç†çš„æ–¹æ¡ˆè‚¯å®šæ˜¯æœ‰é«˜ä½ä¹‹åˆ†çš„ï¼Œäº†è§£çš„è¶Šå¤šè¶Šæ·±å…¥ï¼Œæ–¹æ¡ˆå°±æ›´æœ‰æ•ˆï¼Œæ¯”å¦‚å…ˆå‰çƒ­ä¿®å¤æ—¶æœŸï¼Œä¸ºäº†èƒ½å¤Ÿè®©åŸç”Ÿå¼€å‘ä¸å­¦å‰ç«¯ä»£ç è¿›è¡Œçƒ­ä¿®å¤ï¼Œåˆ©ç”¨ Clang è¿›è¡Œä»£ç è½¬æ¢ï¼Œä»è€ŒèŠ‚çœäº†å­¦ä¹ æˆæœ¬ï¼Œå†åˆ°åæ¥ï¼Œä¸ºäº†æå‡ä¿®å¤ä»£ç æ€§èƒ½è€Œå†…ç½®è§£é‡Šå™¨è§£é‡Šç¼–è¯‘å‡ºçš„å­—èŠ‚ç ï¼Œè¯´æ˜äº†è´«ç©·å¾€å¾€ä¼šé™åˆ¶æƒ³è±¡åŠ›ï¼Œè€Œå¯Œæœ‰çš„çŸ¥è¯†èƒ½å¤Ÿæé«˜æƒ³è±¡ç©ºé—´ã€‚å½“ç„¶ç¼–è¯‘çš„çŸ¥è¯†ä¸å…‰åªé™äºè¿™äº›ï¼Œæ¯”å¦‚ä½¿ç”¨ LLVM ä¸­çš„é™æ€æ£€æŸ¥èƒ½åŠ›å¯ä»¥è¾…åŠ©ç›‘æ§ä»£ç è´¨é‡ï¼Œå­¦ä¹ ç¼–è¯‘å‰ç«¯çŸ¥è¯†ä¹Ÿèƒ½å¤Ÿä½¿è‡ªå·±å…·æœ‰åŠ¨æ‰‹å¤„ç†ä»£ç çš„èƒ½åŠ›ï¼Œæ¯”å¦‚æ ¹æ®è‡ªå·±å·¥ç¨‹ç‰¹ç‚¹è¿›è¡Œä»£ç çš„æ‰¹é‡å¤„ç†ï¼Œçœæ—¶çœåŠ›ã€‚æˆ‘åœ¨æœ€è¿‘åšå¯åŠ¨ä¼˜åŒ–æ—¶å‘ç°ï¼Œä½¿ç”¨ç¼–è¯‘å‰ç«¯çš„çŸ¥è¯†è¿˜èƒ½å¤Ÿå¾ˆè½»æ¾çš„å¤„ç†ç‰¹å®šè§„åˆ™çš„æ–‡ä»¶ï¼Œç”šè‡³ç›´æ¥ä»ä»£ç ä¸­æå–éœ€è¦çš„éƒ¨åˆ†ï¼Œä»è€Œæé«˜åˆ†æå¯åŠ¨é—®é¢˜çš„æ•ˆç‡ã€‚</p>
<p>å¯¹ç¼–è¯‘äº§ç‰©ç»“æ„è¿›è¡Œäº†è§£ï¼Œä¸å…‰èƒ½é€†å‘çœ‹ç«å“ï¼Œè¿˜èƒ½å¤Ÿäº†è§£å’Œå¤„ç†å…¶å®ƒå¾ˆå¤šå…¶å®ƒäº‹æƒ…ï¼Œæ¯”å¦‚ c è¯­è¨€æ–¹æ³• hookï¼Œæ–¹æ³•è°ƒç”¨å †æ ˆç¬¦å·åŒ–çš„åŸç†ï¼Œå¯åŠ¨æ—¶äºŒè¿›åˆ¶åŠ è½½è¿‡ç¨‹çš„äº†è§£ç­‰ã€‚è¿™äº›çŸ¥è¯†ç‚¹æ—¢ä¸å®¹æ˜“è¿‡æ—¶ä¹Ÿå…·æœ‰é€šç”¨æ€§ï¼Œè¿™äº›å¹´æ¥ï¼Œè®¡ç®—æœºåº•å±‚ä¸æ–­æ¼”è¿›ï¼Œç³»ç»Ÿä¸æ–­è¶‹åŒï¼Œç‰¹åˆ«æ˜¯æ•°æ®ç»“æ„çš„è®¾è®¡å°±æœ‰å¾ˆå¤šå€¼å¾—å­¦ä¹ å’Œå€Ÿé‰´çš„ï¼Œæ¯”å¦‚å»äº†è§£ç¼–è¯‘äº§ç‰©å¯¼å‡ºç¬¦å·ä¸ºä»€ä¹ˆ trie æ•°æ®ç»“æ„ï¼Œèƒ½å¤Ÿå­¦ä¹ åˆ°æ—¶é—´å’Œç©ºé—´å¤æ‚åº¦åœ¨å®é™…åœºæ™¯ä¸­æ˜¯å¦‚ä½•åšé€‰æ‹©çš„ã€‚</p>
<p>ç°åœ¨å„å…¬å¸æ­£åœ¨å°è¯•è¿ç”¨è·¨ç«¯æŠ€æœ¯ï¼Œå½“ä½ ä» React Native åˆ° Weexï¼Œå†åˆ°å°ç¨‹åºï¼Œç›´åˆ°ç°åœ¨ Google å‡ºçš„ Flutterï¼Œä¸€è·¯è·Ÿè¿‡æ¥ï¼Œä½ ä¸€å®šä¼šè§‰å¾—å¾ˆç–²æƒ«ï¼Œå³ä½¿ä½ éƒ½å·²ç†Ÿç»ƒæŒæ¡äº†æ€ä¹ˆä½¿ç”¨ï¼Œå¼€å‘äº†å¾ˆå¤šåŠŸèƒ½ï¼Œè¶Ÿè¿‡äº†æ— æ•°å‘ï¼Œå½“ä½ é¢å¯¹ä¸‹ä¸€ä¸ªæµè¡Œæ¡†æ¶æ—¶ï¼Œä½ å¯èƒ½åˆè¦é‡æ–°æ¥è¿‡ã€‚é‚£æ€æ ·æ‰èƒ½å¤Ÿä½¿è‡ªå·±ä»·å€¼æé«˜å‘¢ï¼Œä¸€ä¸ªåˆæ ¼çš„æ¶æ„å¸ˆéœ€è¦å…·æœ‰çš„æ˜¯çœ‹æ¸…æŠ€æœ¯æœ¬è´¨å’Œè¶‹åŠ¿çš„èƒ½åŠ›ã€‚è€Œäº†è§£è¿™äº›æŠ€æœ¯æœ¬è´¨æ˜¯äº†è§£éšè—åœ¨è¿™äº›è·¨ç«¯æŠ€æœ¯èƒŒåçš„å®ç°ï¼Œè¿™äº›å®ç°ä¸»è¦ç”¨åˆ°äº† DSL è½¬ä¹‰ã€çƒ­æ›´æ–°ã€JavaScriptCore æ¡¥æ¥åŸç”Ÿã€è§£é‡Šå™¨ã€WebCore æ¸²æŸ“çš„æ”¹é€ ï¼ˆFlutterï¼‰ï¼Œè¿™äº›åœ¨æœ¬ä¹¦ä¸­éƒ½ä¼šè¯¦ç»†çš„è·Ÿä½ è¯´ï¼Œç‰¹åˆ«æ˜¯æœ€åå¤§å‰ç«¯æŠ€æœ¯é‚£ç« ï¼Œä¼šæ·±å…¥ä»‹ç»WebKit ä¸­çš„ JavaScriptCore å’Œ WebCore çš„åŸç†å’Œæºç å®ç°ï¼Œä»¥æ±‚è®©ä½ èƒ½å¤ŸçŸ¥å…¶ç„¶çŸ¥å…¶æ‰€ä»¥ç„¶ã€‚</p>
<p>ä½ ä¼šå‘ç°å½“ä½ å­¦ä¹ äº†ä¸Šé¢æåˆ°çš„çŸ¥è¯†å¹¶åŠ ä»¥å®é™…è¿ç”¨åï¼Œå·¥ä½œä¸­å¤„ç†é—®é¢˜ï¼Œç”šè‡³æ˜¯ç–‘éš¾æ‚ç—‡æ—¶ï¼Œä½ çš„è„‘æµ·ä¸­å°±ä¸å†æ˜¯ä¸€å¼ ç™½çº¸æ— ä»ä¸‹æ‰‹ï¼Œè€Œæ˜¯æ»¡æ»¡çš„ä¸€ä¹¦æŸœæ•´ç†å¥½çš„èµ„æ–™ä¿¡æ‰‹æ‹ˆæ¥ã€‚åŒæ—¶è‡ªå·±çš„ç«äº‰åŠ›ä¹Ÿèƒ½å¤Ÿå¾—åˆ°æå‡ã€‚</p>
<h2 id="PS"><a href="#PS" class="headerlink" title="PS"></a>PS</h2><p>ä¹¦å‡ºç‰ˆåï¼Œå·§å“¥åœ¨å…¬ä¼—å·ä¸Šåšäº†æ¨èã€Š<a href="https://mp.weixin.qq.com/s/82ZZTmGRNcYINuVqEGz38A">iOS ç•Œçš„é»‘å®¢ä¸ç”»å®¶ - æˆ´é“­</a>ã€‹ï¼Œç¡¬æ ¸å·ä¸»å†¬ç“œçš„æ–‡ç« ä¹Ÿä»‹ç»äº†è¿™æœ¬ä¹¦ã€Š<a href="https://mp.weixin.qq.com/s/1eG5alckPs8ODh72tzA77w">è¯´ä¸€è¯´æˆ´é“­è€å¸ˆæ–°ä¹¦ä¸­çš„æŠ€æœ¯ä¾§é‡</a>ã€‹</p>
<p>æ¬²è´­ã€Šè·Ÿæˆ´é“­å­¦iOSç¼–ç¨‹ã€‹è¿™æœ¬ä¹¦ï¼Œé€šè¿‡è¿™ä¸ª<a href="https://item.m.jd.com/product/12839082.html?dist=jd">äº¬ä¸œé“¾æ¥</a>å¯ä»¥ä»¥å…¨ç½‘æœ€ä½ä»·49å…ƒä¹°åˆ°ï¼Œä¹Ÿå¯åŠ æˆ‘å¾®ä¿¡ allstarmingï¼Œå¤‡æ³¨â€œè´­ä¹¦â€æ¥è´­ä¹°ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨æˆ‘æ”¹äº†å‡ æ¬¡å°é¢åï¼Œä¹¦å·²ä¸Šæ¶ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/uploads/why_write_study_ios_programming_with_daiming_book_and_draw_recently/01.jpg&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;img src
    
    </summary>
    
      <category term="Programming" scheme="http://ming1016.github.io/categories/Programming/"/>
    
    
      <category term="iOS" scheme="http://ming1016.github.io/tags/iOS/"/>
    
      <category term="book" scheme="http://ming1016.github.io/tags/book/"/>
    
  </entry>
  
  <entry>
    <title>Apple æ“ä½œç³»ç»Ÿå¯æ‰§è¡Œæ–‡ä»¶ Mach-O</title>
    <link href="http://ming1016.github.io/2020/03/29/apple-system-executable-file-macho/"/>
    <id>http://ming1016.github.io/2020/03/29/apple-system-executable-file-macho/</id>
    <published>2020-03-29T08:13:45.000Z</published>
    <updated>2021-04-11T14:42:09.902Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>Mach-O çš„å…¨ç§°æ˜¯ Mach Object File Formatã€‚å¯ä»¥æ˜¯å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç›®æ ‡ä»£ç æˆ–å…±äº«åº“ï¼ŒåŠ¨æ€åº“ã€‚Mach å†…æ ¸çš„æ“ä½œç³»ç»Ÿæ¯”å¦‚ macOSï¼ŒiPadOS å’Œ iOS éƒ½æ˜¯ç”¨çš„ Mach-Oã€‚Mach-O åŒ…å«ç¨‹åºçš„æ ¸å¿ƒé€»è¾‘ï¼Œä»¥åŠå…¥å£ç‚¹ä¸»è¦åŠŸèƒ½ã€‚</p>
<p>é€šè¿‡å­¦ä¹  Mach-Oï¼Œå¯ä»¥äº†è§£åº”ç”¨ç¨‹åºæ˜¯å¦‚ä½•åŠ è½½åˆ°ç³»ç»Ÿçš„ï¼Œå¦‚ä½•æ‰§è¡Œçš„ã€‚è¿˜èƒ½äº†è§£ç¬¦å·æŸ¥æ‰¾ï¼Œå‡½æ•°è°ƒç”¨å †æ ˆç¬¦å·åŒ–ç­‰ã€‚æ›´é‡è¦çš„æ˜¯èƒ½å¤Ÿäº†è§£å¦‚ä½•è®¾è®¡æ•°æ®ç»“æ„ï¼Œè¿™å¯¹äºæ—¥åå¼€å‘ç”Ÿæ¶¯çš„æ”¶ç›Šæ˜¯é•¿æœŸçš„ã€‚äº†è§£è¿™äº›å¯¹äºäº†è§£ç¼–è¯‘å’Œé€†å‘å·¥ç¨‹éƒ½ä¼šæœ‰å¸®åŠ©ï¼Œä½ è¿˜ä¼šäº†è§£åˆ°åŠ¨æ€é“¾æ¥å™¨çš„å†…éƒ¨å·¥ä½œåŸç†ä»¥åŠå­—èŠ‚ç æ ¼å¼çš„ä¿¡æ¯ï¼ŒLeb128å­—èŠ‚æµï¼ŒMach å¯¼å‡ºæ—¶ Trie äºŒè¿›åˆ¶ image å‹ç¼©ã€‚</p>
<p>å¯¹äº Mach-Oï¼Œä½ ä¸€å®šä¸é™Œç”Ÿï¼Œä½†æ˜¯å¯¹äºå®ƒå†…éƒ¨é€»è¾‘ä½ ä¸€å®šä¼šå¥½å¥‡ï¼Œæ¯”å¦‚å®ƒæ˜¯æ€ä¹ˆæ„å»ºå‡ºæ¥çš„ï¼Œç»„ç»‡æ–¹å¼å¦‚ä½•ï¼Œæ€ä¹ˆåŠ è½½çš„ï¼Œå¦‚ä½•å·¥ä½œï¼Œè°è®©å®ƒå·¥ä½œçš„ï¼Œæ€æ ·å¯¼å…¥å’Œå¯¼å‡ºç¬¦å·çš„ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å…ˆçœ‹çœ‹æ€ä¹ˆæ„å»ºä¸€ä¸ª Mach-O æ–‡ä»¶çš„å§ã€‚</p>
<h2 id="æ„å»º"><a href="#æ„å»º" class="headerlink" title="æ„å»º"></a>æ„å»º</h2><p>æ„å»º Mach-O æ–‡ä»¶ï¼Œä¸»è¦éœ€è¦ç”¨åˆ°ç¼–è¯‘å™¨å’Œé™æ€é“¾æ¥å™¨ï¼Œç¼–è¯‘å™¨å¯ä»¥å°†ç¼–å†™çš„é«˜çº§è¯­è¨€ä»£ç è½¬æˆä¸­é—´ç›®æ ‡æ–‡ä»¶ï¼Œç„¶åç”¨é™æ€é“¾æ¥å™¨æŠŠä¸­é—´ç›®æ ‡æ–‡ä»¶ç»„åˆæˆ Mach-Oã€‚</p>
<p>ç¼–è¯‘å™¨é©±åŠ¨ç¨‹åºä½¿ç”¨çš„æ˜¯ clangï¼Œæœ‰ç¼–è¯‘ã€ç»„è£…å’Œé“¾æ¥çš„èƒ½åŠ›ï¼Œè°ƒç”¨ Xcode Tools é‡Œçš„å…¶ä»–å·¥å…·æ¥å®ç°æºç åˆ° Mach-O æ–‡ä»¶ç”Ÿæˆã€‚å…¶ä»–å·¥å…·åŒ…æ‹¬å°†æ±‡ç¼–ä»£ç åˆ›å»ºä¸ºä¸­é—´ç›®æ ‡æ–‡ä»¶çš„ as æ±‡ç¼–ç¨‹åºï¼Œç»„åˆä¸­é—´ç›®æ ‡æ–‡ä»¶æˆ Mach-O æ–‡ä»¶çš„é™æ€é“¾æ¥å™¨ ldï¼Œè¿˜æœ‰åˆ›å»ºé™æ€åº“æˆ–å…±äº«åº“çš„ libtoolã€‚</p>
<p>æ„å»ºæˆ Mach-O åŒ…æ‹¬ä¸­é—´å¯¹è±¡æ–‡ä»¶ï¼ˆMH_OBJECTï¼‰ã€å¯æ‰§è¡ŒäºŒè¿›åˆ¶ï¼ˆMH_EXECUTEï¼‰ã€VM å…±äº«åº“æ–‡ä»¶ï¼ˆMH_FVMLIBï¼‰ã€Crash äº§ç”Ÿçš„ Core æ–‡ä»¶ï¼ˆMH_COREï¼‰ã€preloadï¼ˆMH_PRELOADï¼‰ã€åŠ¨æ€å…±äº«åº“ï¼ˆMH_DYLIBï¼‰ã€åŠ¨æ€é“¾æ¥å™¨ï¼ˆMH_DYLINKERï¼‰ã€é™æ€é“¾æ¥æ–‡ä»¶ï¼ˆMH_DYLIB_STUBï¼‰ã€ç¬¦å·æ–‡ä»¶å’Œè°ƒè¯•ä¿¡æ¯ï¼ˆMH_DSYMï¼‰è¿™å‡ ç§ç±»å‹ã€‚å…¶ä¸­æ¡†æ¶ä¼šåŒ…å«Mach-Oå’Œå›¾ç‰‡ã€æ–‡æ¡£ã€æ¥å£ç­‰ç›¸å…³èµ„æºã€‚</p>
<p>å†™ä¸ª main.c æ–‡ä»¶ä»£ç ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span> </span>&#123; </span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *name = argv[<span class="number">1</span>];</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, name);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ clang æ„å»ºæˆ Mach-O æ–‡ä»¶ a.outã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xcrun clang main.c</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæœ‰å¤šä¸ªæ–‡ä»¶ï¼Œå…ˆå°†å¤šä¸ªæ–‡ä»¶ç”Ÿæˆä¸­é—´ç›®æ ‡æ–‡ä»¶ï¼Œåç¼€æ˜¯.oï¼Œä½¿ç”¨ clang çš„é€‰é¡¹ -cã€‚æ¯ä¸ªç›®æ ‡æ–‡ä»¶éƒ½æ˜¯æ¨¡å—ã€‚ä½¿ç”¨é™æ€é“¾æ¥å™¨å¯ä»¥æŠŠå¤šä¸ªæ¨¡å—ç»„åˆæˆä¸€ä¸ªåŠ¨æ€å…±äº«åº“ã€‚é€šè¿‡ ld å¯ä»¥å®Œæˆè¿™ä¸ªæ“ä½œã€‚ä½¿ç”¨ libtool çš„é€‰é¡¹ -static å¯ä»¥æ„å»ºé™æ€åº“ã€‚</p>
<p>ç»„åˆæˆåŠ¨æ€åº“å¯ä»¥ä½¿ç”¨ clang çš„ -dynamiclib é€‰é¡¹ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xcrun clang -dynamiclib command.c header.c -fvisibility=hidden -o mac.dylib</span><br></pre></td></tr></table></figure>
<p>é™æ€é“¾æ¥å°±æ˜¯æŠŠå„ä¸ªæ¨¡å—ç»„åˆæˆä¸€ä¸ªæ•´ä½“ï¼Œç”Ÿæˆæ–°çš„ Mach-Oï¼Œé“¾æ¥çš„å†…å®¹å°±æ˜¯æŠŠå„ä¸ªæ¨¡å—é—´ç›¸äº’çš„å¼•ç”¨èƒ½å¤Ÿæ­£ç¡®çš„é“¾æ¥å¥½ï¼ŒåŸç†å°±æ˜¯æŠŠä¸€äº›æŒ‡ä»¤å¯¹å…¶ä»–ç¬¦å·çš„åœ°å€å¼•ç”¨è¿›è¡Œä¿®æ­£ã€‚è¿‡ç¨‹åŒ…å«åœ°å€å’Œç©ºé—´åˆ†é…ï¼Œç¬¦å·è§£æå’Œå›´ç»•ç¬¦å·è¿›è¡Œçš„é‡å®šä½ã€‚æ ¸å¿ƒæ˜¯é‡å®šä½ï¼ŒX86-64å¯»å€æ–¹å¼æ˜¯ RIP-relative å¯»å€ï¼Œå°±æ˜¯åŸºäº RIP æ¥è®¡ç®—ç›®æ ‡åœ°å€ï¼Œé€šè¿‡ jumpq è·³è½¬ç›®æ ‡åœ°å€ï¼Œå°±æ˜¯å½“å‰æŒ‡ä»¤ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€æ¥åŠ åç§»é‡ã€‚</p>
<p>æ„å»ºå®Œ Mach-Oã€‚é‚£ä½ ä¸€å®šå¥½å¥‡ Mach-O é‡Œé¢éƒ½æœ‰ä»€ä¹ˆå‘¢ï¼Ÿåˆ†æ Mach-O çš„å·¥å…·æœ‰åˆ†æä½“ç³»ç»“æ„çš„ lipoï¼Œæ˜¾å¼æ–‡ä»¶ç±»å‹çš„ fileï¼Œåˆ— Data å†…å®¹çš„ otoolï¼Œåˆ†æ image æ¯ä¸ªé€»è¾‘ä¿¡æ¯ç¬¦å·çš„ pagestuffï¼Œç¬¦å·è¡¨æ˜¾ç¤ºçš„ nmã€‚</p>
<h2 id="ç»„æˆ"><a href="#ç»„æˆ" class="headerlink" title="ç»„æˆ"></a>ç»„æˆ</h2><p>Mach-O ä¼šå°†æ•°æ®æµåˆ†ç»„ï¼Œæ¯ç»„éƒ½ä¼šæœ‰è‡ªå·±çš„æ„ä¹‰ï¼Œä¸»è¦åˆ†ä¸‰å¤§éƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯ Mach Headerã€Load Commandã€Dataã€‚</p>
<h3 id="Header"><a href="#Header" class="headerlink" title="Header"></a>Header</h3><p>Mach Header é‡Œä¼šæœ‰ Mach-O çš„ CPU ä¿¡æ¯ï¼Œä»¥åŠ Load Command çš„ä¿¡æ¯ã€‚å¯ä»¥ä½¿ç”¨ otool æŸ¥çœ‹å†…å®¹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">otool -v -h a.out</span><br></pre></td></tr></table></figure>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Mach header</span><br><span class="line">      magic cputype cpusubtype  caps    filetype ncmds sizeofcmds      flags</span><br><span class="line">MH_MAGIC_64  X86_64        ALL  <span class="number">0x00</span>     EXECUTE    <span class="number">16</span>       <span class="number">1368</span>   NOUNDEFS DYLDLINK TWOLEVEL PIE</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ _dyld_get_image_header å‡½æ•°å¯ä»¥è·å– mach_header ç»“æ„ä½“ã€‚<a href="https://github.com/ming1016/GCDFetchFeed/blob/master/GCDFetchFeed/GCDFetchFeed/Lib/SMLagMonitor/SMCallStack.m">GCDFetchFeed/SMCallStack.m at master Â· ming1016/GCDFetchFeed Â· GitHub</a> é‡Œè¿™æ®µä»£ç é‡Œæœ‰åˆ¤æ–­ Mach Header ç»“æ„ä½“é­”æ•°çš„å‡½æ•° smCmdFirstPointerFromMachHeaderï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">uintptr_t</span> <span class="title">smCmdFirstPointerFromMachHeader</span><span class="params">(<span class="keyword">const</span> struct mach_header* <span class="keyword">const</span> machHeader)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (machHeader-&gt;magic) &#123;</span><br><span class="line">        <span class="keyword">case</span> MH_MAGIC:</span><br><span class="line">        <span class="keyword">case</span> MH_CIGAM:</span><br><span class="line">        <span class="keyword">case</span> MH_MAGIC_64:</span><br><span class="line">        <span class="keyword">case</span> MH_CIGAM_64:</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">uintptr_t</span>)(((machHeaderByCPU*)machHeader) + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// Header ä¸åˆæ³•</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿˜æœ‰ Fat Headerï¼Œé‡Œé¢ä¼šåŒ…å«å¤šä¸ªæ¶æ„çš„ Headerã€‚</p>
<p>LLVM ä¸­ç”Ÿæˆ Mach Header çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MachOFileLayout::writeMachHeader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">auto</span> cpusubtype = MachOLinkingContext::cpuSubtypeFromArch(_file.arch);</span><br><span class="line">  <span class="comment">// dynamic x86 executables on newer OS version should also set the</span></span><br><span class="line">  <span class="comment">// CPU_SUBTYPE_LIB64 mask in the CPU subtype.</span></span><br><span class="line">  <span class="comment">// <span class="doctag">FIXME:</span> Check that this is a dynamic executable, not a static one.</span></span><br><span class="line">  <span class="keyword">if</span> (_file.fileType == llvm::MachO::MH_EXECUTE &amp;&amp;</span><br><span class="line">      cpusubtype == CPU_SUBTYPE_X86_64_ALL &amp;&amp;</span><br><span class="line">      _file.os == MachOLinkingContext::OS::macOSX) &#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> version;</span><br><span class="line">    <span class="keyword">bool</span> failed = MachOLinkingContext::parsePackedVersion(<span class="string">&quot;10.5&quot;</span>, version);</span><br><span class="line">    <span class="keyword">if</span> (!failed &amp;&amp; _file.minOSverson &gt;= version)</span><br><span class="line">      cpusubtype |= CPU_SUBTYPE_LIB64;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  mach_header *mh = <span class="keyword">reinterpret_cast</span>&lt;mach_header*&gt;(_buffer);</span><br><span class="line">  mh-&gt;magic = _is64 ? llvm::MachO::MH_MAGIC_64 : llvm::MachO::MH_MAGIC;</span><br><span class="line">  mh-&gt;cputype =  MachOLinkingContext::cpuTypeFromArch(_file.arch);</span><br><span class="line">  mh-&gt;cpusubtype = cpusubtype;</span><br><span class="line">  mh-&gt;filetype = _file.fileType;</span><br><span class="line">  mh-&gt;ncmds = _countOfLoadCommands;</span><br><span class="line">  mh-&gt;sizeofcmds = _endOfLoadCommands - _startOfLoadCommands;</span><br><span class="line">  mh-&gt;flags = _file.flags;</span><br><span class="line">  <span class="keyword">if</span> (_swap)</span><br><span class="line">    swapStruct(*mh);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Load-Command"><a href="#Load-Command" class="headerlink" title="Load Command"></a>Load Command</h3><p>Load Command åŒ…å« Mach-O é‡Œå‘½ä»¤ç±»å‹ä¿¡æ¯ï¼Œåç§°å’ŒäºŒè¿›åˆ¶æ–‡ä»¶çš„ä½ç½®ã€‚</p>
<p>ä½¿ç”¨ otool å‘½ä»¤å¯ä»¥æŸ¥çœ‹è¯¦ç»†ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">otool -v -l a.out</span><br></pre></td></tr></table></figure>
<p>éå† Mach Header é‡Œçš„ ncmds å¯ä»¥å–åˆ°æ‰€æœ‰ Load Commandã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">uint32_t</span> iCmd = <span class="number">0</span>; iCmd &lt; machHeader-&gt;ncmds; iCmd++) &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">load_command</span>* <span class="title">loadCmd</span> =</span> (struct load_command*)cmdPointer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>load<em>command é‡Œçš„ cmd æ˜¯ä»¥ LC</em> å¼€å¤´å®šä¹‰çš„å®ï¼Œå¯ä»¥å‚çœ‹ loader.h é‡Œçš„å®šä¹‰ï¼Œæœ‰50å¤šä¸ªï¼Œä¸»è¦çš„æ˜¯ï¼š</p>
<ul>
<li>LC_SEGMENT_64(_PAGEZERO)</li>
<li>LC_SEGMENT_64(_TEXT)</li>
<li>LC_SEGMENT_64(_DATA)</li>
<li>LC_SEGMENT_64(_LINKEDIT)</li>
<li>LC_DYLD_INFO_ONLY</li>
<li>LC_SYMTAB</li>
<li>LC_DYSYMTAB</li>
<li>LC_LOAD_DYLINKER</li>
<li>LC_UUID</li>
<li>LC_BUILD_VERSION</li>
<li>LC_SOURCE_VERSION</li>
<li>LC_MAIN</li>
<li>LC_LOAD_DYLIB(libSystem.B.dylib)</li>
<li>LC_FUNCTION_STARTS</li>
<li>LC_DATA_IN_CODE</li>
</ul>
<p>æ¯ä¸ª command çš„ç»“æ„éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œå‰ä¸¤ä¸ªå­—æ®µ cmd å’Œ cmdsize æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>æ ¹æ® Load Command å¯ä»¥å¾—åˆ° Segment çš„åç§»é‡ã€‚</p>
<p>ç”Ÿæˆ Load Command çš„ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">llvm::Error <span class="title">MachOFileLayout::writeLoadCommands</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">uint8_t</span> *lc = &amp;_buffer[_startOfLoadCommands];</span><br><span class="line">  <span class="keyword">if</span> (_file.fileType == llvm::MachO::MH_OBJECT) &#123;</span><br><span class="line">    <span class="comment">// Object files have one unnamed segment which holds all sections.</span></span><br><span class="line">    <span class="keyword">if</span> (_is64) &#123;</span><br><span class="line">     <span class="keyword">if</span> (<span class="keyword">auto</span> ec = writeSingleSegmentLoadCommand&lt;MachO64Trait&gt;(lc))</span><br><span class="line">       <span class="keyword">return</span> ec;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">auto</span> ec = writeSingleSegmentLoadCommand&lt;MachO32Trait&gt;(lc))</span><br><span class="line">        <span class="keyword">return</span> ec;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Add LC_SYMTAB with symbol table info</span></span><br><span class="line">    symtab_command* st = <span class="keyword">reinterpret_cast</span>&lt;symtab_command*&gt;(lc);</span><br><span class="line">    st-&gt;cmd     = LC_SYMTAB;</span><br><span class="line">    st-&gt;cmdsize = <span class="keyword">sizeof</span>(symtab_command);</span><br><span class="line">    st-&gt;symoff  = _startOfSymbols;</span><br><span class="line">    st-&gt;nsyms   = _file.stabsSymbols.size() + _file.localSymbols.size() +</span><br><span class="line">                  _file.globalSymbols.size() + _file.undefinedSymbols.size();</span><br><span class="line">    st-&gt;stroff  = _startOfSymbolStrings;</span><br><span class="line">    st-&gt;strsize = _endOfSymbolStrings - _startOfSymbolStrings;</span><br><span class="line">    <span class="keyword">if</span> (_swap)</span><br><span class="line">      swapStruct(*st);</span><br><span class="line">    lc += <span class="keyword">sizeof</span>(symtab_command);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add LC_VERSION_MIN_MACOSX, LC_VERSION_MIN_IPHONEOS,</span></span><br><span class="line">    <span class="comment">// LC_VERSION_MIN_WATCHOS, LC_VERSION_MIN_TVOS</span></span><br><span class="line">    writeVersionMinLoadCommand(_file, _swap, lc);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add LC_FUNCTION_STARTS if needed.</span></span><br><span class="line">    <span class="keyword">if</span> (_functionStartsSize != <span class="number">0</span>) &#123;</span><br><span class="line">      linkedit_data_command* dl = <span class="keyword">reinterpret_cast</span>&lt;linkedit_data_command*&gt;(lc);</span><br><span class="line">      dl-&gt;cmd      = LC_FUNCTION_STARTS;</span><br><span class="line">      dl-&gt;cmdsize  = <span class="keyword">sizeof</span>(linkedit_data_command);</span><br><span class="line">      dl-&gt;dataoff  = _startOfFunctionStarts;</span><br><span class="line">      dl-&gt;datasize = _functionStartsSize;</span><br><span class="line">      <span class="keyword">if</span> (_swap)</span><br><span class="line">        swapStruct(*dl);</span><br><span class="line">      lc += <span class="keyword">sizeof</span>(linkedit_data_command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add LC_DATA_IN_CODE if requested.</span></span><br><span class="line">    <span class="keyword">if</span> (_file.generateDataInCodeLoadCommand) &#123;</span><br><span class="line">      linkedit_data_command* dl = <span class="keyword">reinterpret_cast</span>&lt;linkedit_data_command*&gt;(lc);</span><br><span class="line">      dl-&gt;cmd      = LC_DATA_IN_CODE;</span><br><span class="line">      dl-&gt;cmdsize  = <span class="keyword">sizeof</span>(linkedit_data_command);</span><br><span class="line">      dl-&gt;dataoff  = _startOfDataInCode;</span><br><span class="line">      dl-&gt;datasize = _dataInCodeSize;</span><br><span class="line">      <span class="keyword">if</span> (_swap)</span><br><span class="line">        swapStruct(*dl);</span><br><span class="line">      lc += <span class="keyword">sizeof</span>(linkedit_data_command);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// Final linked images have sections under segments.</span></span><br><span class="line">    <span class="keyword">if</span> (_is64) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">auto</span> ec = writeSegmentLoadCommands&lt;MachO64Trait&gt;(lc))</span><br><span class="line">        <span class="keyword">return</span> ec;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">auto</span> ec = writeSegmentLoadCommands&lt;MachO32Trait&gt;(lc))</span><br><span class="line">        <span class="keyword">return</span> ec;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add LC_ID_DYLIB command for dynamic libraries.</span></span><br><span class="line">    <span class="keyword">if</span> (_file.fileType == llvm::MachO::MH_DYLIB) &#123;</span><br><span class="line">      dylib_command *dc = <span class="keyword">reinterpret_cast</span>&lt;dylib_command*&gt;(lc);</span><br><span class="line">      StringRef path = _file.installName;</span><br><span class="line">      <span class="keyword">uint32_t</span> size = <span class="keyword">sizeof</span>(dylib_command) + pointerAlign(path.size() + <span class="number">1</span>);</span><br><span class="line">      dc-&gt;cmd                         = LC_ID_DYLIB;</span><br><span class="line">      dc-&gt;cmdsize                     = size;</span><br><span class="line">      dc-&gt;dylib.name                  = <span class="keyword">sizeof</span>(dylib_command); <span class="comment">// offset</span></span><br><span class="line">      <span class="comment">// needs to be some constant value different than the one in LC_LOAD_DYLIB</span></span><br><span class="line">      dc-&gt;dylib.timestamp             = <span class="number">1</span>;</span><br><span class="line">      dc-&gt;dylib.current_version       = _file.currentVersion;</span><br><span class="line">      dc-&gt;dylib.compatibility_version = _file.compatVersion;</span><br><span class="line">      <span class="keyword">if</span> (_swap)</span><br><span class="line">        swapStruct(*dc);</span><br><span class="line">      <span class="built_in">memcpy</span>(lc + <span class="keyword">sizeof</span>(dylib_command), path.begin(), path.size());</span><br><span class="line">      lc[<span class="keyword">sizeof</span>(dylib_command) + path.size()] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">      lc += size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add LC_DYLD_INFO_ONLY.</span></span><br><span class="line">    dyld_info_command* di = <span class="keyword">reinterpret_cast</span>&lt;dyld_info_command*&gt;(lc);</span><br><span class="line">    di-&gt;cmd            = LC_DYLD_INFO_ONLY;</span><br><span class="line">    di-&gt;cmdsize        = <span class="keyword">sizeof</span>(dyld_info_command);</span><br><span class="line">    di-&gt;rebase_off     = _rebaseInfo.size() ? _startOfRebaseInfo : <span class="number">0</span>;</span><br><span class="line">    di-&gt;rebase_size    = _rebaseInfo.size();</span><br><span class="line">    di-&gt;bind_off       = _bindingInfo.size() ? _startOfBindingInfo : <span class="number">0</span>;</span><br><span class="line">    di-&gt;bind_size      = _bindingInfo.size();</span><br><span class="line">    di-&gt;weak_bind_off  = <span class="number">0</span>;</span><br><span class="line">    di-&gt;weak_bind_size = <span class="number">0</span>;</span><br><span class="line">    di-&gt;lazy_bind_off  = _lazyBindingInfo.size() ? _startOfLazyBindingInfo : <span class="number">0</span>;</span><br><span class="line">    di-&gt;lazy_bind_size = _lazyBindingInfo.size();</span><br><span class="line">    di-&gt;export_off     = _exportTrie.size() ? _startOfExportTrie : <span class="number">0</span>;</span><br><span class="line">    di-&gt;export_size    = _exportTrie.size();</span><br><span class="line">    <span class="keyword">if</span> (_swap)</span><br><span class="line">      swapStruct(*di);</span><br><span class="line">    lc += <span class="keyword">sizeof</span>(dyld_info_command);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add LC_SYMTAB with symbol table info.</span></span><br><span class="line">    symtab_command* st = <span class="keyword">reinterpret_cast</span>&lt;symtab_command*&gt;(lc);</span><br><span class="line">    st-&gt;cmd     = LC_SYMTAB;</span><br><span class="line">    st-&gt;cmdsize = <span class="keyword">sizeof</span>(symtab_command);</span><br><span class="line">    st-&gt;symoff  = _startOfSymbols;</span><br><span class="line">    st-&gt;nsyms   = _file.stabsSymbols.size() + _file.localSymbols.size() +</span><br><span class="line">                  _file.globalSymbols.size() + _file.undefinedSymbols.size();</span><br><span class="line">    st-&gt;stroff  = _startOfSymbolStrings;</span><br><span class="line">    st-&gt;strsize = _endOfSymbolStrings - _startOfSymbolStrings;</span><br><span class="line">    <span class="keyword">if</span> (_swap)</span><br><span class="line">      swapStruct(*st);</span><br><span class="line">    lc += <span class="keyword">sizeof</span>(symtab_command);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add LC_DYSYMTAB</span></span><br><span class="line">    <span class="keyword">if</span> (_file.fileType != llvm::MachO::MH_PRELOAD) &#123;</span><br><span class="line">      dysymtab_command* dst = <span class="keyword">reinterpret_cast</span>&lt;dysymtab_command*&gt;(lc);</span><br><span class="line">      dst-&gt;cmd            = LC_DYSYMTAB;</span><br><span class="line">      dst-&gt;cmdsize        = <span class="keyword">sizeof</span>(dysymtab_command);</span><br><span class="line">      dst-&gt;ilocalsym      = _symbolTableLocalsStartIndex;</span><br><span class="line">      dst-&gt;nlocalsym      = _file.stabsSymbols.size() +</span><br><span class="line">                            _file.localSymbols.size();</span><br><span class="line">      dst-&gt;iextdefsym     = _symbolTableGlobalsStartIndex;</span><br><span class="line">      dst-&gt;nextdefsym     = _file.globalSymbols.size();</span><br><span class="line">      dst-&gt;iundefsym      = _symbolTableUndefinesStartIndex;</span><br><span class="line">      dst-&gt;nundefsym      = _file.undefinedSymbols.size();</span><br><span class="line">      dst-&gt;tocoff         = <span class="number">0</span>;</span><br><span class="line">      dst-&gt;ntoc           = <span class="number">0</span>;</span><br><span class="line">      dst-&gt;modtaboff      = <span class="number">0</span>;</span><br><span class="line">      dst-&gt;nmodtab        = <span class="number">0</span>;</span><br><span class="line">      dst-&gt;extrefsymoff   = <span class="number">0</span>;</span><br><span class="line">      dst-&gt;nextrefsyms    = <span class="number">0</span>;</span><br><span class="line">      dst-&gt;indirectsymoff = _startOfIndirectSymbols;</span><br><span class="line">      dst-&gt;nindirectsyms  = _indirectSymbolTableCount;</span><br><span class="line">      dst-&gt;extreloff      = <span class="number">0</span>;</span><br><span class="line">      dst-&gt;nextrel        = <span class="number">0</span>;</span><br><span class="line">      dst-&gt;locreloff      = <span class="number">0</span>;</span><br><span class="line">      dst-&gt;nlocrel        = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> (_swap)</span><br><span class="line">        swapStruct(*dst);</span><br><span class="line">      lc += <span class="keyword">sizeof</span>(dysymtab_command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If main executable, add LC_LOAD_DYLINKER</span></span><br><span class="line">    <span class="keyword">if</span> (_file.fileType == llvm::MachO::MH_EXECUTE) &#123;</span><br><span class="line">      <span class="comment">// Build LC_LOAD_DYLINKER load command.</span></span><br><span class="line">      <span class="keyword">uint32_t</span> size=pointerAlign(<span class="keyword">sizeof</span>(dylinker_command)+dyldPath().size()+<span class="number">1</span>);</span><br><span class="line">      dylinker_command* dl = <span class="keyword">reinterpret_cast</span>&lt;dylinker_command*&gt;(lc);</span><br><span class="line">      dl-&gt;cmd              = LC_LOAD_DYLINKER;</span><br><span class="line">      dl-&gt;cmdsize          = size;</span><br><span class="line">      dl-&gt;name             = <span class="keyword">sizeof</span>(dylinker_command); <span class="comment">// offset</span></span><br><span class="line">      <span class="keyword">if</span> (_swap)</span><br><span class="line">        swapStruct(*dl);</span><br><span class="line">      <span class="built_in">memcpy</span>(lc+<span class="keyword">sizeof</span>(dylinker_command), dyldPath().data(), dyldPath().size());</span><br><span class="line">      lc[<span class="keyword">sizeof</span>(dylinker_command)+dyldPath().size()] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">      lc += size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add LC_VERSION_MIN_MACOSX, LC_VERSION_MIN_IPHONEOS, LC_VERSION_MIN_WATCHOS,</span></span><br><span class="line">    <span class="comment">// LC_VERSION_MIN_TVOS</span></span><br><span class="line">    writeVersionMinLoadCommand(_file, _swap, lc);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add LC_SOURCE_VERSION</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// Note, using a temporary here to appease UB as we may not be aligned</span></span><br><span class="line">      <span class="comment">// enough for a struct containing a uint64_t when emitting a 32-bit binary</span></span><br><span class="line">      source_version_command sv;</span><br><span class="line">      sv.cmd       = LC_SOURCE_VERSION;</span><br><span class="line">      sv.cmdsize   = <span class="keyword">sizeof</span>(source_version_command);</span><br><span class="line">      sv.version   = _file.sourceVersion;</span><br><span class="line">      <span class="keyword">if</span> (_swap)</span><br><span class="line">        swapStruct(sv);</span><br><span class="line">      <span class="built_in">memcpy</span>(lc, &amp;sv, <span class="keyword">sizeof</span>(source_version_command));</span><br><span class="line">      lc += <span class="keyword">sizeof</span>(source_version_command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If main executable, add LC_MAIN.</span></span><br><span class="line">    <span class="keyword">if</span> (_file.fileType == llvm::MachO::MH_EXECUTE) &#123;</span><br><span class="line">      <span class="comment">// Build LC_MAIN load command.</span></span><br><span class="line">      <span class="comment">// Note, using a temporary here to appease UB as we may not be aligned</span></span><br><span class="line">      <span class="comment">// enough for a struct containing a uint64_t when emitting a 32-bit binary</span></span><br><span class="line">      entry_point_command ep;</span><br><span class="line">      ep.cmd       = LC_MAIN;</span><br><span class="line">      ep.cmdsize   = <span class="keyword">sizeof</span>(entry_point_command);</span><br><span class="line">      ep.entryoff  = _file.entryAddress - _seg1addr;</span><br><span class="line">      ep.stacksize = _file.stackSize;</span><br><span class="line">      <span class="keyword">if</span> (_swap)</span><br><span class="line">        swapStruct(ep);</span><br><span class="line">      <span class="built_in">memcpy</span>(lc, &amp;ep, <span class="keyword">sizeof</span>(entry_point_command));</span><br><span class="line">      lc += <span class="keyword">sizeof</span>(entry_point_command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add LC_LOAD_DYLIB commands</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> DependentDylib &amp;dep : _file.dependentDylibs) &#123;</span><br><span class="line">      dylib_command* dc = <span class="keyword">reinterpret_cast</span>&lt;dylib_command*&gt;(lc);</span><br><span class="line">      <span class="keyword">uint32_t</span> size = <span class="keyword">sizeof</span>(dylib_command) + pointerAlign(dep.path.size()+<span class="number">1</span>);</span><br><span class="line">      dc-&gt;cmd                         = dep.kind;</span><br><span class="line">      dc-&gt;cmdsize                     = size;</span><br><span class="line">      dc-&gt;dylib.name                  = <span class="keyword">sizeof</span>(dylib_command); <span class="comment">// offset</span></span><br><span class="line">      <span class="comment">// needs to be some constant value different than the one in LC_ID_DYLIB</span></span><br><span class="line">      dc-&gt;dylib.timestamp             = <span class="number">2</span>;</span><br><span class="line">      dc-&gt;dylib.current_version       = dep.currentVersion;</span><br><span class="line">      dc-&gt;dylib.compatibility_version = dep.compatVersion;</span><br><span class="line">      <span class="keyword">if</span> (_swap)</span><br><span class="line">        swapStruct(*dc);</span><br><span class="line">      <span class="built_in">memcpy</span>(lc+<span class="keyword">sizeof</span>(dylib_command), dep.path.begin(), dep.path.size());</span><br><span class="line">      lc[<span class="keyword">sizeof</span>(dylib_command)+dep.path.size()] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">      lc += size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add LC_RPATH</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> StringRef &amp;path : _file.rpaths) &#123;</span><br><span class="line">      rpath_command *rpc = <span class="keyword">reinterpret_cast</span>&lt;rpath_command *&gt;(lc);</span><br><span class="line">      <span class="keyword">uint32_t</span> size = pointerAlign(<span class="keyword">sizeof</span>(rpath_command) + path.size() + <span class="number">1</span>);</span><br><span class="line">      rpc-&gt;cmd                         = LC_RPATH;</span><br><span class="line">      rpc-&gt;cmdsize                     = size;</span><br><span class="line">      rpc-&gt;path                        = <span class="keyword">sizeof</span>(rpath_command); <span class="comment">// offset</span></span><br><span class="line">      <span class="keyword">if</span> (_swap)</span><br><span class="line">        swapStruct(*rpc);</span><br><span class="line">      <span class="built_in">memcpy</span>(lc+<span class="keyword">sizeof</span>(rpath_command), path.begin(), path.size());</span><br><span class="line">      lc[<span class="keyword">sizeof</span>(rpath_command)+path.size()] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">      lc += size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add LC_FUNCTION_STARTS if needed.</span></span><br><span class="line">    <span class="keyword">if</span> (_functionStartsSize != <span class="number">0</span>) &#123;</span><br><span class="line">      linkedit_data_command* dl = <span class="keyword">reinterpret_cast</span>&lt;linkedit_data_command*&gt;(lc);</span><br><span class="line">      dl-&gt;cmd      = LC_FUNCTION_STARTS;</span><br><span class="line">      dl-&gt;cmdsize  = <span class="keyword">sizeof</span>(linkedit_data_command);</span><br><span class="line">      dl-&gt;dataoff  = _startOfFunctionStarts;</span><br><span class="line">      dl-&gt;datasize = _functionStartsSize;</span><br><span class="line">      <span class="keyword">if</span> (_swap)</span><br><span class="line">        swapStruct(*dl);</span><br><span class="line">      lc += <span class="keyword">sizeof</span>(linkedit_data_command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add LC_DATA_IN_CODE if requested.</span></span><br><span class="line">    <span class="keyword">if</span> (_file.generateDataInCodeLoadCommand) &#123;</span><br><span class="line">      linkedit_data_command* dl = <span class="keyword">reinterpret_cast</span>&lt;linkedit_data_command*&gt;(lc);</span><br><span class="line">      dl-&gt;cmd      = LC_DATA_IN_CODE;</span><br><span class="line">      dl-&gt;cmdsize  = <span class="keyword">sizeof</span>(linkedit_data_command);</span><br><span class="line">      dl-&gt;dataoff  = _startOfDataInCode;</span><br><span class="line">      dl-&gt;datasize = _dataInCodeSize;</span><br><span class="line">      <span class="keyword">if</span> (_swap)</span><br><span class="line">        swapStruct(*dl);</span><br><span class="line">      lc += <span class="keyword">sizeof</span>(linkedit_data_command);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> llvm::Error::success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="Data"><a href="#Data" class="headerlink" title="Data"></a>Data</h3><p>Data ç”± Segment çš„æ•°æ®ç»„æˆï¼Œæ˜¯ Mach-O å æ¯”æœ€å¤šçš„éƒ¨åˆ†ï¼Œæœ‰ä»£ç æœ‰æ•°æ®ï¼Œæ¯”å¦‚ç¬¦å·è¡¨ã€‚Data å…±ä¸‰ä¸ª Segmentï¼Œ<strong>TEXTã€</strong>DATAã€<strong>LINKEDITã€‚å…¶ä¸­ </strong>TEXT å’Œ <strong>DATA å¯¹åº”ä¸€ä¸ªæˆ–å¤šä¸ª Sectionï¼Œ</strong>LINKEDIT æ²¡æœ‰ Sectionï¼Œéœ€è¦é…åˆ LC_SYMTAB æ¥è§£æ symbol table å’Œ string tableã€‚è¿™äº›é‡Œé¢æ˜¯ Mach-O çš„ä¸»è¦æ•°æ®ã€‚</p>
<p>ç”Ÿæˆ __LINKEDIT çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MachOFileLayout::buildLinkEditInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  buildRebaseInfo();</span><br><span class="line">  buildBindInfo();</span><br><span class="line">  buildLazyBindInfo();</span><br><span class="line">  buildExportTrie();</span><br><span class="line">  computeSymbolTableSizes();</span><br><span class="line">  computeFunctionStartsSize();</span><br><span class="line">  computeDataInCodeSize();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MachOFileLayout::writeLinkEditContent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (_file.fileType == llvm::MachO::MH_OBJECT) &#123;</span><br><span class="line">    writeRelocations();</span><br><span class="line">    writeFunctionStartsInfo();</span><br><span class="line">    writeDataInCodeInfo();</span><br><span class="line">    writeSymbolTable();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    writeRebaseInfo();</span><br><span class="line">    writeBindingInfo();</span><br><span class="line">    writeLazyBindingInfo();</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> add weak binding info</span></span><br><span class="line">    writeExportInfo();</span><br><span class="line">    writeFunctionStartsInfo();</span><br><span class="line">    writeDataInCodeInfo();</span><br><span class="line">    writeSymbolTable();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ç”Ÿæˆ <strong>LINKEDIT çš„ä»£ç å¯ä»¥çœ‹å‡º </strong>LINKEDIT é‡ŒåŒ…å« dyld æ‰€éœ€å„ç§æ•°æ®ï¼Œæ¯”å¦‚ç¬¦å·è¡¨ã€é—´æ¥ç¬¦å·è¡¨ã€rebase æ“ä½œç ã€ç»‘å®šæ“ä½œç ã€å¯¼å‡ºç¬¦å·ã€å‡½æ•°å¯åŠ¨ä¿¡æ¯ã€æ•°æ®è¡¨ã€ä»£ç ç­¾åç­‰ã€‚</p>
<p>__DATA åŒ…å« lazy å’Œ non lazy ç¬¦å·æŒ‡é’ˆï¼Œè¿˜ä¼šåŒ…å«é™æ€æ•°æ®å’Œå…¨å±€å˜é‡ç­‰ã€‚å¯é‡å®šä½çš„ Mach-O æ–‡ä»¶è¿˜ä¼šæœ‰ä¸€ä¸ªé‡å®šä½çš„åŒºåŸŸç”¨æ¥å­˜å‚¨é‡å®šä½ä¿¡æ¯ï¼Œå¦‚æœå“ªä¸ª section æœ‰é‡å®šä½å­—èŠ‚ï¼Œå°±ä¼šæœ‰ä¸€ä¸ª relocation table å¯¹åº”ã€‚</p>
<p>ç”Ÿæˆ relocation çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MachOFileLayout::writeRelocations</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">uint32_t</span> relOffset = _startOfRelocations;</span><br><span class="line">  <span class="keyword">for</span> (Section sect : _file.sections) &#123;</span><br><span class="line">    <span class="keyword">for</span> (Relocation r : sect.relocations) &#123;</span><br><span class="line">      any_relocation_info* rb = <span class="keyword">reinterpret_cast</span>&lt;any_relocation_info*&gt;(</span><br><span class="line">                                                           &amp;_buffer[relOffset]);</span><br><span class="line">      *rb = packRelocation(r, _swap, _bigEndianArch);</span><br><span class="line">      relOffset += <span class="keyword">sizeof</span>(any_relocation_info);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ size å‘½ä»¤å¯ä»¥çœ‹åˆ°å†…å®¹çš„åˆ†å¸ƒï¼Œä½¿ç”¨å‰é¢ç”Ÿæˆçš„ a.out æ¥çœ‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xcrun size -x -l -m a.out</span><br></pre></td></tr></table></figure>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Segment __PAGEZERO: <span class="number">0x100000000</span> (vmaddr <span class="number">0x0</span> fileoff <span class="number">0</span>)</span><br><span class="line">Segment __TEXT: <span class="number">0x1000</span> (vmaddr <span class="number">0x100000000</span> fileoff <span class="number">0</span>)</span><br><span class="line">    Section __text: <span class="number">0x41</span> (addr <span class="number">0x100000f50</span> offset <span class="number">3920</span>)</span><br><span class="line">    Section __stubs: <span class="number">0x6</span> (addr <span class="number">0x100000f92</span> offset <span class="number">3986</span>)</span><br><span class="line">    Section __stub_helper: <span class="number">0x1a</span> (addr <span class="number">0x100000f98</span> offset <span class="number">3992</span>)</span><br><span class="line">    Section __cstring: <span class="number">0x4</span> (addr <span class="number">0x100000fb2</span> offset <span class="number">4018</span>)</span><br><span class="line">    Section __unwind_info: <span class="number">0x48</span> (addr <span class="number">0x100000fb8</span> offset <span class="number">4024</span>)</span><br><span class="line">    total <span class="number">0xad</span></span><br><span class="line">Segment __DATA_CONST: <span class="number">0x1000</span> (vmaddr <span class="number">0x100001000</span> fileoff <span class="number">4096</span>)</span><br><span class="line">    Section __got: <span class="number">0x8</span> (addr <span class="number">0x100001000</span> offset <span class="number">4096</span>)</span><br><span class="line">    total <span class="number">0x8</span></span><br><span class="line">Segment __DATA: <span class="number">0x1000</span> (vmaddr <span class="number">0x100002000</span> fileoff <span class="number">8192</span>)</span><br><span class="line">    Section __la_symbol_ptr: <span class="number">0x8</span> (addr <span class="number">0x100002000</span> offset <span class="number">8192</span>)</span><br><span class="line">    Section __data: <span class="number">0x8</span> (addr <span class="number">0x100002008</span> offset <span class="number">8200</span>)</span><br><span class="line">    total <span class="number">0x10</span></span><br><span class="line">Segment __LINKEDIT: <span class="number">0x1000</span> (vmaddr <span class="number">0x100003000</span> fileoff <span class="number">12288</span>)</span><br><span class="line">total <span class="number">0x100004000</span></span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­__TEXT Segment çš„å†…å®¹æœ‰ï¼š</p>
<ul>
<li>Section64(<strong>TEXT,</strong>text)</li>
<li>Section64(<strong>TEXT,</strong>stubs)</li>
<li>Section64(<strong>TEXT,</strong>stub_helper)</li>
<li>Section64(<strong>TEXT,</strong>cstring)</li>
<li>Section64(<strong>TEXT,</strong>unwind_info)</li>
</ul>
<p>__DATA Segment çš„å†…å®¹æœ‰ï¼š</p>
<ul>
<li>Section64(<strong>DATA,</strong>nl_symbol_ptr)</li>
<li>Section64(<strong>DATA,</strong>la_symbol_ptr)</li>
</ul>
<p>__LINKEDIT çš„å†…å®¹æ˜¯ï¼š</p>
<ul>
<li>Dynamic Loader Info</li>
<li>Function Starts</li>
<li>Symbol Table</li>
<li>Data in Code Entries</li>
<li>Dynamic Symbol Table</li>
<li>String Table</li>
</ul>
<p>å¦‚æœæ˜¯ Objective-C ä»£ç ç”Ÿæˆçš„ Mach-O ä¼šå¤šå‡ºå¾ˆå¤šå’Œ Objective-C ç›¸å…³çš„ Section ï¼Œæˆ‘æ‹¿<a href="https://github.com/ming1016/GCDFetchFeed">å·²é˜…</a>é¡¹ç›®ç”Ÿæˆçš„ Mach-O æ¥çœ‹ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xcrun size -x -l -m GCDFetchFeed</span><br></pre></td></tr></table></figure>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">Segment __PAGEZERO: <span class="number">0x100000000</span> (vmaddr <span class="number">0x0</span> fileoff <span class="number">0</span>)</span><br><span class="line">Segment __TEXT: <span class="number">0xa8000</span> (vmaddr <span class="number">0x100000000</span> fileoff <span class="number">0</span>)</span><br><span class="line">    Section __text: <span class="number">0x89084</span> (addr <span class="number">0x1000020e0</span> offset <span class="number">8416</span>)</span><br><span class="line">    Section __stubs: <span class="number">0x588</span> (addr <span class="number">0x10008b164</span> offset <span class="number">569700</span>)</span><br><span class="line">    Section __stub_helper: <span class="number">0x948</span> (addr <span class="number">0x10008b6ec</span> offset <span class="number">571116</span>)</span><br><span class="line">    Section __gcc_except_tab: <span class="number">0x1318</span> (addr <span class="number">0x10008c034</span> offset <span class="number">573492</span>)</span><br><span class="line">    Section __cstring: <span class="number">0xbebd</span> (addr <span class="number">0x10008d34c</span> offset <span class="number">578380</span>)</span><br><span class="line">    Section __objc_methname: <span class="number">0xa20f</span> (addr <span class="number">0x100099209</span> offset <span class="number">627209</span>)</span><br><span class="line">    Section __objc_classname: <span class="number">0x11d9</span> (addr <span class="number">0x1000a3418</span> offset <span class="number">668696</span>)</span><br><span class="line">    Section __objc_methtype: <span class="number">0x2185</span> (addr <span class="number">0x1000a45f1</span> offset <span class="number">673265</span>)</span><br><span class="line">    Section __const: <span class="number">0x23c</span> (addr <span class="number">0x1000a6780</span> offset <span class="number">681856</span>)</span><br><span class="line">    Section __ustring: <span class="number">0x23e</span> (addr <span class="number">0x1000a69bc</span> offset <span class="number">682428</span>)</span><br><span class="line">    Section __entitlements: <span class="number">0x184</span> (addr <span class="number">0x1000a6bfa</span> offset <span class="number">683002</span>)</span><br><span class="line">    Section __unwind_info: <span class="number">0x1274</span> (addr <span class="number">0x1000a6d80</span> offset <span class="number">683392</span>)</span><br><span class="line">    total <span class="number">0xa5f08</span></span><br><span class="line">Segment __DATA: <span class="number">0x2f000</span> (vmaddr <span class="number">0x1000a8000</span> fileoff <span class="number">688128</span>)</span><br><span class="line">    Section __nl_symbol_ptr: <span class="number">0x8</span> (addr <span class="number">0x1000a8000</span> offset <span class="number">688128</span>)</span><br><span class="line">    Section __got: <span class="number">0x258</span> (addr <span class="number">0x1000a8008</span> offset <span class="number">688136</span>)</span><br><span class="line">    Section __la_symbol_ptr: <span class="number">0x760</span> (addr <span class="number">0x1000a8260</span> offset <span class="number">688736</span>)</span><br><span class="line">    Section __const: <span class="number">0x4238</span> (addr <span class="number">0x1000a89c0</span> offset <span class="number">690624</span>)</span><br><span class="line">    Section __cfstring: <span class="number">0x9d80</span> (addr <span class="number">0x1000acbf8</span> offset <span class="number">707576</span>)</span><br><span class="line">    Section __objc_classlist: <span class="number">0x510</span> (addr <span class="number">0x1000b6978</span> offset <span class="number">747896</span>)</span><br><span class="line">    Section __objc_nlclslist: <span class="number">0x40</span> (addr <span class="number">0x1000b6e88</span> offset <span class="number">749192</span>)</span><br><span class="line">    Section __objc_catlist: <span class="number">0x90</span> (addr <span class="number">0x1000b6ec8</span> offset <span class="number">749256</span>)</span><br><span class="line">    Section __objc_nlcatlist: <span class="number">0x10</span> (addr <span class="number">0x1000b6f58</span> offset <span class="number">749400</span>)</span><br><span class="line">    Section __objc_protolist: <span class="number">0x80</span> (addr <span class="number">0x1000b6f68</span> offset <span class="number">749416</span>)</span><br><span class="line">    Section __objc_imageinfo: <span class="number">0x8</span> (addr <span class="number">0x1000b6fe8</span> offset <span class="number">749544</span>)</span><br><span class="line">    Section __objc_const: <span class="number">0x182e8</span> (addr <span class="number">0x1000b6ff0</span> offset <span class="number">749552</span>)</span><br><span class="line">    Section __objc_selrefs: <span class="number">0x2bf8</span> (addr <span class="number">0x1000cf2d8</span> offset <span class="number">848600</span>)</span><br><span class="line">    Section __objc_protorefs: <span class="number">0x8</span> (addr <span class="number">0x1000d1ed0</span> offset <span class="number">859856</span>)</span><br><span class="line">    Section __objc_classrefs: <span class="number">0x858</span> (addr <span class="number">0x1000d1ed8</span> offset <span class="number">859864</span>)</span><br><span class="line">    Section __objc_superrefs: <span class="number">0x370</span> (addr <span class="number">0x1000d2730</span> offset <span class="number">862000</span>)</span><br><span class="line">    Section __objc_ivar: <span class="number">0xb48</span> (addr <span class="number">0x1000d2aa0</span> offset <span class="number">862880</span>)</span><br><span class="line">    Section __objc_data: <span class="number">0x32a0</span> (addr <span class="number">0x1000d35e8</span> offset <span class="number">865768</span>)</span><br><span class="line">    Section __data: <span class="number">0x604</span> (addr <span class="number">0x1000d6888</span> offset <span class="number">878728</span>)</span><br><span class="line">    Section __bss: <span class="number">0x158</span> (addr <span class="number">0x1000d6e90</span> offset <span class="number">0</span>)</span><br><span class="line">    total <span class="number">0x2efe4</span></span><br><span class="line">Segment __LINKEDIT: <span class="number">0xae000</span> (vmaddr <span class="number">0x1000d7000</span> fileoff <span class="number">880640</span>)</span><br><span class="line">total <span class="number">0x100185000</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ° __objc å‰ç¼€çš„éƒ½æ˜¯ä¸ºäº†æ”¯æŒ Objective-C è¯­è¨€æ–°å¢åŠ çš„ã€‚</p>
<p>é‚£ä¹ˆ Swift è¯­è¨€ä»£ç æ„å»ºçš„ Mach-O æ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</p>
<p>ä½¿ç”¨æˆ‘åšå¯åŠ¨ä¼˜åŒ–æ—¶ç”¨ Swift å†™çš„å·¥å…· <a href="https://github.com/ming1016/MethodTraceAnalyze">MethodTraceAnalyze</a> çœ‹ä¸‹å†…å®¹æœ‰ä»€ä¹ˆã€‚ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">Segment __PAGEZERO: <span class="number">0x100000000</span> (vmaddr <span class="number">0x0</span> fileoff <span class="number">0</span>)</span><br><span class="line">Segment __TEXT: <span class="number">0x115000</span> (vmaddr <span class="number">0x100000000</span> fileoff <span class="number">0</span>)</span><br><span class="line">    Section __text: <span class="number">0xfd540</span> (addr <span class="number">0x1000019b0</span> offset <span class="number">6576</span>)</span><br><span class="line">    Section __stubs: <span class="number">0x6f6</span> (addr <span class="number">0x1000feef0</span> offset <span class="number">1044208</span>)</span><br><span class="line">    Section __stub_helper: <span class="number">0xbaa</span> (addr <span class="number">0x1000ff5e8</span> offset <span class="number">1045992</span>)</span><br><span class="line">    Section __swift5_typeref: <span class="number">0xf56</span> (addr <span class="number">0x100100192</span> offset <span class="number">1048978</span>)</span><br><span class="line">    Section __swift5_capture: <span class="number">0x3b4</span> (addr <span class="number">0x1001010e8</span> offset <span class="number">1052904</span>)</span><br><span class="line">    Section __cstring: <span class="number">0x7011</span> (addr <span class="number">0x1001014a0</span> offset <span class="number">1053856</span>)</span><br><span class="line">    Section __const: <span class="number">0x4754</span> (addr <span class="number">0x1001084c0</span> offset <span class="number">1082560</span>)</span><br><span class="line">    Section __swift5_fieldmd: <span class="number">0x2bf4</span> (addr <span class="number">0x10010cc14</span> offset <span class="number">1100820</span>)</span><br><span class="line">    Section __swift5_types: <span class="number">0x1f0</span> (addr <span class="number">0x10010f808</span> offset <span class="number">1112072</span>)</span><br><span class="line">    Section __swift5_builtin: <span class="number">0x78</span> (addr <span class="number">0x10010f9f8</span> offset <span class="number">1112568</span>)</span><br><span class="line">    Section __swift5_reflstr: <span class="number">0x2740</span> (addr <span class="number">0x10010fa70</span> offset <span class="number">1112688</span>)</span><br><span class="line">    Section __swift5_proto: <span class="number">0x154</span> (addr <span class="number">0x1001121b0</span> offset <span class="number">1122736</span>)</span><br><span class="line">    Section __swift5_assocty: <span class="number">0x120</span> (addr <span class="number">0x100112304</span> offset <span class="number">1123076</span>)</span><br><span class="line">    Section __objc_methname: <span class="number">0x7a5</span> (addr <span class="number">0x100112424</span> offset <span class="number">1123364</span>)</span><br><span class="line">    Section __swift5_protos: <span class="number">0x8</span> (addr <span class="number">0x100112bcc</span> offset <span class="number">1125324</span>)</span><br><span class="line">    Section __unwind_info: <span class="number">0x1c70</span> (addr <span class="number">0x100112bd4</span> offset <span class="number">1125332</span>)</span><br><span class="line">    Section __eh_frame: <span class="number">0x7b0</span> (addr <span class="number">0x100114848</span> offset <span class="number">1132616</span>)</span><br><span class="line">    total <span class="number">0x11362c</span></span><br><span class="line">Segment __DATA_CONST: <span class="number">0x4000</span> (vmaddr <span class="number">0x100115000</span> fileoff <span class="number">1134592</span>)</span><br><span class="line">    Section __got: <span class="number">0x4a8</span> (addr <span class="number">0x100115000</span> offset <span class="number">1134592</span>)</span><br><span class="line">    Section __const: <span class="number">0x32f8</span> (addr <span class="number">0x1001154a8</span> offset <span class="number">1135784</span>)</span><br><span class="line">    Section __objc_classlist: <span class="number">0xd0</span> (addr <span class="number">0x1001187a0</span> offset <span class="number">1148832</span>)</span><br><span class="line">    Section __objc_protolist: <span class="number">0x10</span> (addr <span class="number">0x100118870</span> offset <span class="number">1149040</span>)</span><br><span class="line">    Section __objc_imageinfo: <span class="number">0x8</span> (addr <span class="number">0x100118880</span> offset <span class="number">1149056</span>)</span><br><span class="line">    total <span class="number">0x3888</span></span><br><span class="line">Segment __DATA: <span class="number">0x8000</span> (vmaddr <span class="number">0x100119000</span> fileoff <span class="number">1150976</span>)</span><br><span class="line">    Section __la_symbol_ptr: <span class="number">0x948</span> (addr <span class="number">0x100119000</span> offset <span class="number">1150976</span>)</span><br><span class="line">    Section __objc_const: <span class="number">0x2018</span> (addr <span class="number">0x100119948</span> offset <span class="number">1153352</span>)</span><br><span class="line">    Section __objc_selrefs: <span class="number">0xb0</span> (addr <span class="number">0x10011b960</span> offset <span class="number">1161568</span>)</span><br><span class="line">    Section __objc_protorefs: <span class="number">0x10</span> (addr <span class="number">0x10011ba10</span> offset <span class="number">1161744</span>)</span><br><span class="line">    Section __objc_classrefs: <span class="number">0x38</span> (addr <span class="number">0x10011ba20</span> offset <span class="number">1161760</span>)</span><br><span class="line">    Section __objc_data: <span class="number">0x98</span> (addr <span class="number">0x10011ba58</span> offset <span class="number">1161816</span>)</span><br><span class="line">    Section __data: <span class="number">0x1f88</span> (addr <span class="number">0x10011baf0</span> offset <span class="number">1161968</span>)</span><br><span class="line">    Section __bss: <span class="number">0x2a68</span> (addr <span class="number">0x10011da80</span> offset <span class="number">0</span>)</span><br><span class="line">    Section __common: <span class="number">0x50</span> (addr <span class="number">0x1001204e8</span> offset <span class="number">0</span>)</span><br><span class="line">    total <span class="number">0x7530</span></span><br><span class="line">Segment __LINKEDIT: <span class="number">0x152000</span> (vmaddr <span class="number">0x100121000</span> fileoff <span class="number">1171456</span>)</span><br><span class="line">total <span class="number">0x100273000</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ° <strong>DATA Segment éƒ¨åˆ†è¿˜æ˜¯æœ‰ </strong>objc å‰ç¼€çš„ Sectionï¼Œ<strong>TEXT Segment é‡Œå·²ç»éƒ½æ˜¯ </strong>swift5 ä¸ºå‰ç¼€çš„ Section äº†ã€‚</p>
<p>ä½¿ç”¨ otool å¯ä»¥æŸ¥çœ‹æŸä¸ª Section å†…å®¹ã€‚æ¯”å¦‚æŸ¥çœ‹ <strong>TEXT Segment çš„ </strong>text Section çš„å†…å®¹ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xcrun otool -s __TEXT __text a.out</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ otool å¯ä»¥ç›´æ¥çœ‹ Mach-O æ±‡ç¼–å†…å®¹ ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xcrun otool -v -t a.out</span><br></pre></td></tr></table></figure>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">a.out:</span><br><span class="line">(__TEXT,__text) section</span><br><span class="line">_main:</span><br><span class="line"><span class="number">0000000100000f</span>50    pushq   %rbp</span><br><span class="line"><span class="number">0000000100000f</span>51    movq    %rsp, %rbp</span><br><span class="line"><span class="number">0000000100000f</span>54    subq    $<span class="number">0x20</span>, %rsp</span><br><span class="line"><span class="number">0000000100000f</span>58    movl    $<span class="number">0x0</span>, <span class="number">-0x4</span>(%rbp)</span><br><span class="line"><span class="number">0000000100000f</span>5f    movl    %edi, <span class="number">-0x8</span>(%rbp)</span><br><span class="line"><span class="number">0000000100000f</span>62    movq    %rsi, <span class="number">-0x10</span>(%rbp)</span><br><span class="line"><span class="number">0000000100000f</span>66    movq    <span class="number">-0x10</span>(%rbp), %rax</span><br><span class="line"><span class="number">0000000100000f</span>6a    movq    <span class="number">0x8</span>(%rax), %rax</span><br><span class="line"><span class="number">0000000100000f</span>6e    movq    %rax, <span class="number">-0x18</span>(%rbp)</span><br><span class="line"><span class="number">0000000100000f</span>72    movq    <span class="number">-0x18</span>(%rbp), %rsi</span><br><span class="line"><span class="number">0000000100000f</span>76    leaq    <span class="number">0x35</span>(%rip), %rdi</span><br><span class="line"><span class="number">0000000100000f</span>7d    movb    $<span class="number">0x0</span>, %al</span><br><span class="line"><span class="number">0000000100000f</span>7f    callq   <span class="number">0x100000f92</span></span><br><span class="line"><span class="number">0000000100000f</span>84    xorl    %ecx, %ecx</span><br><span class="line"><span class="number">0000000100000f</span>86    movl    %eax, <span class="number">-0x1c</span>(%rbp)</span><br><span class="line"><span class="number">0000000100000f</span>89    movl    %ecx, %eax</span><br><span class="line"><span class="number">0000000100000f</span>8b    addq    $<span class="number">0x20</span>, %rsp</span><br><span class="line"><span class="number">0000000100000f</span>8f    popq    %rbp</span><br><span class="line"><span class="number">0000000100000f</span>90    retq</span><br></pre></td></tr></table></figure>
<p>æ„å»ºä¸­æŸ¥çœ‹ä»£ç ç”Ÿæˆæ±‡ç¼–å¯ä»¥ä½¿ç”¨ clang ä»¥ä¸‹é€‰é¡¹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xcrun clang -S -o - main.c</span><br></pre></td></tr></table></figure>
<p> ç”Ÿæˆæ±‡ç¼–å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">    .section    __TEXT,__text,regular,pure_instructions</span><br><span class="line">    .build_version macos, <span class="number">10</span>, <span class="number">15</span>    sdk_version <span class="number">10</span>, <span class="number">15</span>, <span class="number">4</span></span><br><span class="line">    .globl  _main                   ## -- Begin function main</span><br><span class="line">    .p2align    <span class="number">4</span>, <span class="number">0x90</span></span><br><span class="line">_main:                                  ## @main</span><br><span class="line">    .cfi_startproc</span><br><span class="line">## %bb<span class="number">.0</span>:</span><br><span class="line">    pushq   %rbp</span><br><span class="line">    .cfi_def_cfa_offset <span class="number">16</span></span><br><span class="line">    .cfi_offset %rbp, <span class="number">-16</span></span><br><span class="line">    movq    %rsp, %rbp</span><br><span class="line">    .cfi_def_cfa_register %rbp</span><br><span class="line">    subq    $<span class="number">32</span>, %rsp</span><br><span class="line">    movl    $<span class="number">0</span>, <span class="number">-4</span>(%rbp)</span><br><span class="line">    movl    %edi, <span class="number">-8</span>(%rbp)</span><br><span class="line">    movq    %rsi, <span class="number">-16</span>(%rbp)</span><br><span class="line">    movq    <span class="number">-16</span>(%rbp), %rax</span><br><span class="line">    movq    <span class="number">8</span>(%rax), %rax</span><br><span class="line">    movq    %rax, <span class="number">-24</span>(%rbp)</span><br><span class="line">    movq    <span class="number">-24</span>(%rbp), %rsi</span><br><span class="line">    leaq    L_.str(%rip), %rdi</span><br><span class="line">    movb    $<span class="number">0</span>, %al</span><br><span class="line">    callq   _printf</span><br><span class="line">    xorl    %ecx, %ecx</span><br><span class="line">    movl    %eax, <span class="number">-28</span>(%rbp)         ## <span class="number">4</span>-byte Spill</span><br><span class="line">    movl    %ecx, %eax</span><br><span class="line">    addq    $<span class="number">32</span>, %rsp</span><br><span class="line">    popq    %rbp</span><br><span class="line">    retq</span><br><span class="line">    .cfi_endproc</span><br><span class="line">                                        ## -- End function</span><br><span class="line">    .section    __TEXT,__cstring,cstring_literals</span><br><span class="line">L_.str:                                 ## @.str</span><br><span class="line">    .asciz  <span class="string">&quot;%s\n&quot;</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥å‘ç°ä¸¤è€…æ±‡ç¼–é€»è¾‘æ˜¯ä¸€æ ·çš„ã€‚ç‚¹ç¬¦å·å¼€å¤´çš„éƒ½æ˜¯æ±‡ç¼–æŒ‡ä»¤ï¼Œæ¯”å¦‚.section å°±æ˜¯å‘ŠçŸ¥ä¼šæ‰§è¡Œå“ªä¸ª segmentï¼Œ.p2align æŒ‡ä»¤æ˜ç¡®åé¢ä»£ç å¯¹é½æ–¹å¼ï¼Œè¿™é‡Œæ˜¯16(2^4) å­—èŠ‚å¯¹é½ï¼Œ0x90 è¡¥é½ã€‚åœ¨ <strong>TEXT Segment çš„ </strong>text Section é‡Œä¼šåˆ›å»ºä¸€ä¸ªè°ƒç”¨å¸§å †æ ˆï¼Œè¿›è¡Œå‡½æ•°è°ƒç”¨ï¼Œcallq printf å‡½æ•°å‰ä¼šç”¨åˆ° L<em>.str(%rip)ï¼ŒL</em>.str æ ‡ç­¾ä¼šæŒ‡å‘å­—ç¬¦ä¸²ï¼Œleaq ä¼šæŠŠå­—ç¬¦ä¸²çš„æŒ‡é’ˆåŠ è½½åˆ° rdi å¯„å­˜å™¨ã€‚æœ€åä¼šé”€æ¯è°ƒç”¨å¸§å †æ ˆï¼Œè¿›è¡Œ retq è¿”å›ã€‚</p>
<p>ä¸»è¦ Sectionï¼š</p>
<ul>
<li>__nl_symbol_ptrï¼šåŒ…å« non-lazy ç¬¦å·æŒ‡é’ˆï¼Œmach-o/loader.h é‡Œæœ‰è¯¦ç»†è¯´æ˜ã€‚æœåŠ¡ dyld_stub_binder å¤„ç†çš„ç¬¦å·ã€‚</li>
<li><strong>la_symbol_ptrï¼š</strong>stubs ç¬¬ä¸€ä¸ª jump ç›®æ ‡åœ°å€ã€‚åŠ¨æ€åº“çš„ç¬¦å·æŒ‡é’ˆåœ°å€ã€‚</li>
<li><strong>gotï¼šäºŒè¿›åˆ¶æ–‡ä»¶çš„å…¨å±€åç§»è¡¨ GOTï¼Œä¹ŸåŒ…å« S_NON_LAZY_SYMBOL_POINTERS æ ‡è®°çš„ non-lazy ç¬¦å·æŒ‡é’ˆã€‚æœåŠ¡äº </strong>TEXT Segment é‡Œçš„ç¬¦å·ã€‚å¯ä»¥å°†<strong>got çœ‹ä½œä¸€ä¸ªè¡¨ï¼Œé‡Œé¢æ¯é¡¹éƒ½æ˜¯ä¸€ä¸ªåœ°å€å€¼ã€‚</strong>got çš„æ¯é¡¹åœ¨åŠ è½½æœŸé—´éƒ½ä¼šè¢« dyld é‡å†™ï¼Œæ‰€ä»¥ä¼šåœ¨ <strong>DATA Segment ä¸­ã€‚</strong>got ç”¨æ¥å­˜æ”¾ non-lazy ç¬¦å·æœ€ç»ˆåœ°å€ï¼Œä¸º dyld æ‰€ç”¨ã€‚dylib å¤–éƒ¨ç¬¦å·å¯¹äºå…¨å±€å˜é‡å’Œå¸¸é‡å¼•ç”¨åœ°å€ä¼šæŒ‡åˆ° __gotã€‚</li>
<li>__lazy_symbolï¼šåŒ…å« lazy ç¬¦å·ï¼Œé¦–æ¬¡ä½¿ç”¨æ—¶ç»‘å®šã€‚</li>
<li><strong>stubsï¼šè·³è½¬è¡¨ï¼Œé‡å®šå‘åˆ° lazy å’Œ non-lazy ç¬¦å·çš„ sectionã€‚è¢«æ ‡è®°ä¸º S_SYMBOL_STUBSã€‚</strong>TEXT Segment é‡Œä»£ç å’Œ dylib å¤–éƒ¨ç¬¦å·çš„å¼•ç”¨åœ°å€å¯¹å‡½æ•°ç¬¦å·çš„å¼•ç”¨éƒ½æŒ‡å‘äº† <strong>stubsã€‚å…¶ä¸­æ¯é¡¹éƒ½æ˜¯ jmp ä»£ç é—´æ¥å¯»å€ï¼Œå¯è·³åˆ° </strong>la_symbol_ptr Section ä¸­ã€‚</li>
<li><strong>stub_helperï¼šlazy åŠ¨æ€ç»‘å®šç¬¦å·çš„è¾…åŠ©å‡½æ•°ã€‚å¯è·³åˆ° </strong>nl_symbol_ptr Section ä¸­ã€‚</li>
<li>__textï¼šæœºå™¨ç ï¼Œä¹Ÿæ˜¯å®é™…ä»£ç ï¼ŒåŒ…å«æ‰€æœ‰åŠŸèƒ½ã€‚</li>
<li>__cstringï¼šå¸¸é‡ã€‚åªè¯» C å­—ç¬¦ä¸²ã€‚</li>
<li>__constï¼šåˆå§‹åŒ–è¿‡çš„å¸¸é‡ã€‚</li>
<li>_<em>objc</em>ï¼šObjective-C è¯­è¨€ runtime çš„æ”¯æŒã€‚</li>
<li>__dataï¼šåˆå§‹åŒ–è¿‡çš„å˜é‡ã€‚</li>
<li>__bssï¼šæœªåˆå§‹åŒ–çš„é™æ€å˜é‡ã€‚</li>
<li>__unwind_infoï¼šç”Ÿæˆå¼‚å¸¸å¤„ç†ä¿¡æ¯ã€‚</li>
<li>__eh_frameï¼šDWARF2 unwind å¯æ‰§è¡Œæ–‡ä»¶ä»£ç ä¿¡æ¯ï¼Œç”¨äºè°ƒè¯•ã€‚</li>
<li>string tableï¼šä»¥ç©ºå€¼ç»ˆæ­¢çš„å­—ç¬¦ä¸²åºåˆ—ã€‚</li>
<li>symbol tableï¼šé€šè¿‡ LC_SYMTAB å‘½ä»¤æ‰¾åˆ° symbol tableï¼Œå…¶åŒ…å«æ‰€æœ‰ç”¨åˆ°çš„ç¬¦å·ä¿¡æ¯ã€‚ç»“æ„ä½“ nlist_64æè¿°äº†ç¬¦å·çš„åŸºæœ¬ä¿¡æ¯ã€‚nlist_64 ç»“æ„ä½“ä¸­ n_type å­—æ®µæ˜¯ä¸€ä¸ª8ä½å¤åˆå­—æ®µï¼Œå…¶ä¸­bit[0:1]è¡¨ç¤ºæ˜¯å¤–éƒ¨ç¬¦å·ï¼Œbit[5:8]è¡¨è°ƒè¯•ç¬¦å·ï¼Œbit[4:5]è¡¨ç¤ºç§æœ‰ external ç¬¦å·ï¼Œbit[1:4]æ˜¯ç¬¦å·ç±»å‹ï¼Œæœ‰ N_UNDF æœªå®šä¹‰ã€N_ABS ç»å¯¹åœ°å€ã€N_SECT æœ¬åœ°ç¬¦å·ã€N_PBUD é¢„ç»‘å®šç¬¦å·ã€N_INDR åŒåç¬¦å·å‡ ç§ç±»å‹ã€‚</li>
<li>indirect symbol tableï¼šæ¯é¡¹éƒ½æ˜¯ä¸€ä¸ª index å€¼ï¼ŒæŒ‡å‘ symbol table ä¸­çš„é¡¹ã€‚ç”± LC_DYSYMTAB å®šä¹‰ï¼Œå’Œ<strong>nl_symbol_ptr å’Œ </strong>lazy_symbol ä¸€èµ·ä¸º <strong>stubs å’Œ </strong>got ç­‰ Section æœåŠ¡ã€‚</li>
</ul>
<p>ç”Ÿæˆ Section çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MachOFileLayout::writeSectionContent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> Section &amp;s : _file.sections) &#123;</span><br><span class="line">    <span class="comment">// Copy all section content to output buffer.</span></span><br><span class="line">    <span class="keyword">if</span> (isZeroFillSection(s.type))</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">if</span> (s.content.empty())</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">uint32_t</span> offset = _sectInfo[&amp;s].fileOffset;</span><br><span class="line">    <span class="keyword">uint8_t</span> *p = &amp;_buffer[offset];</span><br><span class="line">    <span class="built_in">memcpy</span>(p, &amp;s.content[<span class="number">0</span>], s.content.size());</span><br><span class="line">    p += s.content.size();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ symble table ç”Ÿæˆçš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MachOFileLayout::writeSymbolTable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Write symbol table and symbol strings in parallel.</span></span><br><span class="line">  <span class="keyword">uint32_t</span> symOffset = _startOfSymbols;</span><br><span class="line">  <span class="keyword">uint32_t</span> strOffset = _startOfSymbolStrings;</span><br><span class="line">  <span class="comment">// Reserve n_strx offset of zero to mean no name.</span></span><br><span class="line">  _buffer[strOffset++] = <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">  _buffer[strOffset++] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">  appendSymbols(_file.stabsSymbols, symOffset, strOffset);</span><br><span class="line">  appendSymbols(_file.localSymbols, symOffset, strOffset);</span><br><span class="line">  appendSymbols(_file.globalSymbols, symOffset, strOffset);</span><br><span class="line">  appendSymbols(_file.undefinedSymbols, symOffset, strOffset);</span><br><span class="line">  <span class="comment">// Write indirect symbol table array.</span></span><br><span class="line">  <span class="keyword">uint32_t</span> *indirects = <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">uint32_t</span>*&gt;</span><br><span class="line">                                            (&amp;_buffer[_startOfIndirectSymbols]);</span><br><span class="line">  <span class="keyword">if</span> (_file.fileType == llvm::MachO::MH_OBJECT) &#123;</span><br><span class="line">    <span class="comment">// Object files have sections in same order as input normalized file.</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> Section &amp;section : _file.sections) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">uint32_t</span> index : section.indirectSymbols) &#123;</span><br><span class="line">        <span class="keyword">if</span> (_swap)</span><br><span class="line">          *indirects++ = llvm::sys::getSwappedBytes(index);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          *indirects++ = index;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// Final linked images must sort sections from normalized file.</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> Segment &amp;seg : _file.segments) &#123;</span><br><span class="line">      SegExtraInfo &amp;segInfo = _segInfo[&amp;seg];</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> Section *section : segInfo.sections) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">uint32_t</span> index : section-&gt;indirectSymbols) &#123;</span><br><span class="line">          <span class="keyword">if</span> (_swap)</span><br><span class="line">            *indirects++ = llvm::sys::getSwappedBytes(index);</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">            *indirects++ = index;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è·å– Segment ä¿¡æ¯çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">segmentWalk</span><span class="params">(<span class="keyword">void</span> *segment_command)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">uint32_t</span> nsects;</span><br><span class="line">  <span class="keyword">void</span> *section;</span><br><span class="line"></span><br><span class="line">  section = segment_command + <span class="keyword">sizeof</span>(struct segment_command);</span><br><span class="line">  nsects = ((struct segment_command *) segment_command)-&gt;nsects;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (nsects--) &#123;</span><br><span class="line">    section += <span class="keyword">sizeof</span>(struct s_section);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è·å–å¯¹åº”ç¬¦å·çš„æ–¹æ³•ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰å‚çœ‹ &lt;mach-o/nlist.h&gt;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N_UNDF  0x0  <span class="comment">// æœªå®šä¹‰</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N_ABS 0x2    <span class="comment">// ç»å¯¹åœ°å€</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N_SECT 0xe   <span class="comment">// æœ¬åœ°ç¬¦å·</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N_PBUD 0xc   <span class="comment">// é¢„å®šä¹‰ç¬¦å·</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N_INDR 0xa   <span class="comment">// åŒåç¬¦å·</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N_STAB 0xe0  <span class="comment">// è°ƒè¯•ç¬¦å·</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N_PEXT 0x10  <span class="comment">// ç§æœ‰ external ç¬¦å·</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N_TYPE 0x0e  <span class="comment">// ç±»å‹ä½çš„æ©ç </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N_EXT 0x01   <span class="comment">// external ç¬¦å·</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">char</span> <span class="title">symbolical</span><span class="params">(sym)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (N_STAB &amp; sym-&gt;type)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;-&#x27;</span>; </span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ((N_TYPE &amp; sym-&gt;type) == N_UNDF) &#123;</span><br><span class="line">    <span class="keyword">if</span> (sym-&gt;name_not_found)</span><br><span class="line">     <span class="keyword">return</span> <span class="string">&#x27;C&#x27;</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (sym-&gt;type &amp; N_EXT)</span><br><span class="line">     <span class="keyword">return</span> = <span class="string">&#x27;U&#x27;</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">     <span class="keyword">return</span> = <span class="string">&#x27;?&#x27;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((N_TYPE &amp; sym-&gt;type) == N_SECT) &#123;</span><br><span class="line">    <span class="keyword">return</span> matched(saved_sections, sym);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((N_TYPE &amp; sym-&gt;type) == N_ABS) &#123;</span><br><span class="line">    <span class="keyword">return</span> = <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((N_TYPE &amp; sym-&gt;type) == N_INDR) &#123;</span><br><span class="line">    <span class="keyword">return</span> = <span class="string">&#x27;I&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">char</span> <span class="title">matched</span><span class="params">(saved_sections, symbol)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (sect = find_mysection(saved_sections, symbol-&gt;n_sect)) # </span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (!ft_strcmp(sect-&gt;name, SECT_TEXT))</span><br><span class="line">      ret = <span class="string">&#x27;T&#x27;</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (!ft_strcmp(sect-&gt;name, SECT_DATA))</span><br><span class="line">      ret = <span class="string">&#x27;D&#x27;</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (!ft_strcmp(sect-&gt;name, SECT_BSS))</span><br><span class="line">      ret = <span class="string">&#x27;B&#x27;</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      ret = <span class="string">&#x27;S&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!(mysym-&gt;type &amp; N_EXT))</span><br><span class="line">       ret -= <span class="string">&#x27;A&#x27;</span> - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="åŠ è½½è¿è¡Œ"><a href="#åŠ è½½è¿è¡Œ" class="headerlink" title="åŠ è½½è¿è¡Œ"></a>åŠ è½½è¿è¡Œ</h2><p>ç¨‹åºè¦å’Œå…¶ä»–åº“è¿˜æœ‰æ¨¡å—ä¸€èµ·è¿è¡Œï¼Œéœ€è¦åœ¨è¿è¡Œæ—¶å¯¹è¿™äº›åº“å’Œæ¨¡å—çš„ç¬¦å·å¼•ç”¨è¿›è¡Œè§£æï¼Œè¿è¡Œæ—¶ï¼Œä½ åº”ç”¨ç¨‹åºä½¿ç”¨çš„æ¨¡å—ç¬¦å·éƒ½åœ¨å…±äº«åç§°ç©ºé—´ã€‚macOS ä½¿ç”¨çš„æ˜¯ä¸¤çº§åç§°ç©ºé—´æ¥ç¡®ä¿ä¸åŒæ¨¡å—ç¬¦å·åä¸ä¼šå†²çªï¼ŒåŒæ—¶å¢å¼ºå‘å‰å…¼å®¹ã€‚</p>
<p>é€‰æ‹©è¦åŠ è½½çš„ Mach-O åï¼Œç³»ç»Ÿå†…æ ¸ä¼šå…ˆç¡®å®šè¯¥æ–‡ä»¶æ˜¯å¦æ˜¯ Mach-O æ–‡ä»¶ã€‚</p>
<p>æ–‡ä»¶çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯é­”æ•°ï¼Œé€šè¿‡é­”æ•°å¯ä»¥æ¨æ–­æ˜¯ä¸æ˜¯ Mach-Oï¼Œmach-o/loader.h é‡Œå®šä¹‰äº†å››ä¸ªé­”æ•°æ ‡è¯†ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MH_MAGIC    0xfeedface</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MH_CIGAM    NXSwapInt(MH_MAGIC)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MH_MAGIC_64 0xfeedfacf</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MH_CIGAM_64 NXSwapInt(MH_MAGIC_64)</span></span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šå››ä¸ªé­”æ•°æ ‡è¯†æ˜¯ Mach-O æ–‡ä»¶ã€‚</p>
<p>ç„¶åå†…æ ¸ç³»ç»Ÿä¼šç”¨ fork å‡½æ•°åˆ›å»ºä¸€ä¸ªè¿›ç¨‹ï¼Œç„¶åé€šè¿‡ execve å‡½æ•°å¼€å§‹ç¨‹åºåŠ è½½è¿‡ç¨‹ï¼Œexecve æœ‰å¤šä¸ªç§ç±»ï¼Œæ¯”å¦‚ execlã€execv ç­‰ï¼Œåªæ˜¯åœ¨å‚æ•°å’Œç¯å¢ƒå˜é‡ä¸Šæœ‰ä¸åŒï¼Œæœ€ç»ˆéƒ½ä¼šåˆ°å†…æ ¸çš„ execve å‡½æ•°ã€‚</p>
<p>æ¥ç€ä¼šæ£€æŸ¥ Mach-O headerï¼ŒåŠ è½½ dyld å’Œç¨‹åºåˆ° Load Command æŒ‡å®šçš„åœ°å€ç©ºé—´ã€‚æ‰§è¡ŒåŠ¨æ€é“¾æ¥å™¨ã€‚åŠ¨æ€é“¾æ¥å™¨é€šè¿‡ dyld_stub_binder è°ƒç”¨ï¼Œè¿™ä¸ªå‡½æ•°çš„å‚æ•°ä¸ç›´æ¥æŒ‡å®šè¦ç»‘å®šçš„ç¬¦å·ï¼Œè€Œæ˜¯é€šè¿‡ç»™ dyld_stub_binder åç§»é‡åˆ° dyld è§£é‡Šçš„ç‰¹æ®Šå­—èŠ‚ç  Segment ä¸­ã€‚dyld_stub_binder å‡½æ•°çš„ä»£ç åœ¨è¿™é‡Œï¼š<a href="https://opensource.apple.com/source/dyld/dyld-635.2/src/dyld_stub_binder.s.auto.html">dyld_stub_binder.s</a>ã€‚dyld åˆ†ä¸º rebaseã€bindingã€lazy bindingã€å¯¼å‡ºå‡ ä¸ªéƒ¨åˆ†ã€‚dyld å¯ä»¥ hookï¼Œä½¿ç”¨ DYLD_INSERT_LIBRARIESï¼Œç±»ä¼¼ ld çš„ LD_PRELOAD è¿˜æœ‰ DYLD_LIBRARY_PATHã€‚</p>
<p><strong>text é‡Œéœ€è¦è¢« lazy binding çš„ç¬¦å·å¼•ç”¨ï¼Œè®¿é—®æ—¶å›åˆ° stub ä¸­ï¼Œç›®æ ‡åœ°å€åœ¨ </strong>la_symbol_ptrï¼Œå¯¹åº” <strong>la_symbol_ptr çš„å†…å®¹ä¼šæŒ‡å‘ </strong>stub_helperï¼Œå…¶ä¸­é€»è¾‘ä¼šè°ƒåˆ° dyld_stub_binder å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šé€šè¿‡ dyld æ‰¾åˆ°ç¬¦å·çš„çœŸå®åœ°å€ï¼Œæœ€å dyld_stub_binder ä¼šæŠŠå¾—åˆ°çš„åœ°å€å†™å…¥ <strong>la_symbol_ptr é‡Œåï¼Œä¼šè·³è½¬åˆ°ç¬¦å·çš„çœŸå®åœ°å€ã€‚ç”±äºåœ°å€å·²ç»åœ¨ </strong>la_symbol_ptr é‡Œäº†ï¼Œæ‰€ä»¥å†è®¿é—®ç¬¦å·æ—¶ä¼šé€šè¿‡ stub çš„ jum æŒ‡ä»¤ç›´æ¥è·³è½¬åˆ°çœŸå®åœ°å€ã€‚</p>
<p>é€šè¿‡ dyld åŠ è½½ä¸»ç¨‹åºé“¾æ¥åˆ°çš„æ‰€æœ‰ä¾èµ–åº“ï¼Œæ‰§è¡Œç¬¦å·ç»‘å®šä¹Ÿå°±æ˜¯non lazy bindingã€‚ç»‘å®šè§£æå…¶ä»–æ¨¡å—çš„åŠŸèƒ½å’Œæ•°æ®çš„å¼•ç”¨è¿‡ç¨‹ï¼Œä¹Ÿå«å¯¼å…¥ç¬¦å·ã€‚</p>
<h3 id="å¯¼å…¥å¯¼å‡ºç¬¦å·"><a href="#å¯¼å…¥å¯¼å‡ºç¬¦å·" class="headerlink" title="å¯¼å…¥å¯¼å‡ºç¬¦å·"></a>å¯¼å…¥å¯¼å‡ºç¬¦å·</h3><p>æ‰§è¡Œç»‘å®šæ—¶ï¼Œé“¾æ¥ç¨‹åºä¼šç”¨å®é™…å®šä¹‰çš„åœ°å€æ›¿æ¢ç¨‹åºçš„æ¯ä¸ªå¯¼å…¥å¼•ç”¨ã€‚é€šè¿‡æ„å»ºæ—¶çš„é€‰é¡¹è®¾ç½®ï¼Œdyld å¯ä»¥å³æ—¶ç»‘å®šï¼Œä¹Ÿå«å»¶è¿Ÿç»‘å®šï¼Œé¦–æ¬¡ä½¿ç”¨å¼•ç”¨æ—¶çš„ç»‘å®šï¼Œåœ¨ä½¿ç”¨ç¬¦å·å‰ä¸ä¼šå°†ç¨‹åºçš„å¼•ç”¨ç»‘å®šåˆ°å…±äº«åº“çš„ç¬¦å·ã€‚ä½¿ç”¨ -bind_at_load å¯ä»¥åŠ è½½æ—¶ç»‘å®šï¼ŒåŠ¨æ€é“¾æ¥ç¨‹åºåœ¨åŠ è½½ç¨‹åºæ—¶ç«‹å³ç»‘å®šæ‰€æœ‰å¯¼å…¥çš„å¼•ç”¨ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®è¿™ä¸ªé€‰é¡¹ï¼Œé»˜è®¤æŒ‰å³æ—¶ç»‘å®šæ¥ã€‚è®¾ç½® -prebindï¼Œç¨‹åºå¼•ç”¨çš„å…±äº«åº“éƒ½ä¼šåœ¨æŒ‡å®šçš„åœ°å€é¢„å…ˆç»‘å®šã€‚</p>
<p>æ ¹æ® Code Fragment Manager è®¾è®¡çš„å¼±å¼•ç”¨å…è®¸ç¨‹åºæœ‰é€‰æ‹©çš„ç»‘å®šåˆ°æŒ‡å®šçš„å…±äº«åº“ï¼Œå¦‚æœ dyld æ‰¾ä¸åˆ°å¼±å¼•ç”¨çš„å®šä¹‰ï¼Œä¼šè®¾ç½®ä¸º NULLï¼Œç„¶åå¯ä»¥ç»§ç»­åŠ è½½ç¨‹åºã€‚ä»£ç ä¸Šå¯ä»¥å†™åˆ¤æ–­ï¼Œå¦‚æœå¼•ç”¨ä¸ºç©ºè¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚</p>
<p>è¿‡ç¨‹é“¾æ¥è¡¨ PLTï¼Œä¼šåœ¨è¿è¡Œæ—¶ç¡®å®šå‡½æ•°åœ°å€ã€‚callq æŒ‡ä»¤åœ¨ dyld_stub è°ƒç”¨ PLT æ¡ç›®ï¼Œç¬¦å· stub ä½äº <strong>TEXT Segment çš„ </strong>stubs Section ä¸­ã€‚æ¯ä¸ª Mach-O ç¬¦å· stub éƒ½æ˜¯ä¸€ä¸ª jumpq æŒ‡ä»¤ï¼Œå®ƒä¼šè°ƒç”¨ dyld æ‰¾åˆ°ç¬¦å·ï¼Œç„¶åæ‰§è¡Œã€‚</p>
<p>Mach-O çš„å¯¼å…¥å’Œå¯¼å‡ºéƒ½ä¼šå­˜åœ¨ __LINKEDIT é‡Œã€‚ä½¿ç”¨ FSA æ¥å— Leb128 å‚æ•°ï¼Œä¹Ÿå°±æ˜¯ç»‘å®šæ“ä½œç ã€‚LEB ä¼šæŠŠæ•´æ•°å€¼ç¼–ç æˆå¯å˜é•¿åº¦çš„å­—èŠ‚åºåˆ—ï¼Œæœ€åä¸€ä¸ªå­—èŠ‚æ‰è®¾ç½®æœ€é«˜æœ‰æ•ˆä½ã€‚</p>
<p>å½“ FSA å¾ªç¯æˆ–é€’å½’æ—¶ï¼Œä¼šç”¨0xF0å¯¹å…¶è¿›è¡Œæ©ç è·å¾—æ“ä½œç ï¼Œæ‰€æœ‰å¯¼å…¥ç»‘å®šæ“ä½œç éƒ½ä¼šå¯¹åº”æœ‰å®åç§°å’Œå¯¹åº”çš„åŠŸèƒ½ã€‚æ¯”å¦‚ 0xb0 å¯¹åº”å®æ˜¯ BIND_OPCODE_DO_BIND_ADD_ADDR_IMM_SCALEDï¼ŒåŠŸèƒ½æ˜¯å°†è®°å½•æ”¾åˆ°å¯¼å…¥å †æ ˆä¸­ï¼Œç„¶åæŠŠå½“å‰è®°å½•çš„åœ°å€åç§»é‡è®¾ä¸º seg_offset = seg_offset + (scale * sizeofptr) + sizeofptr ï¼Œå…¶ä¸­ scale æ˜¯ç«‹å³æ•°ä¸­åŒ…å«çš„å€¼ï¼Œsizeofptr æ˜¯æŒ‡é’ˆå¯¹åº”å¹³å°çš„å¤§å°ã€‚</p>
<p>Mach-O å¯¼å‡ºç¬¦å·æ˜¯ <a href="https://en.wikipedia.org/wiki/Trie">trie</a> çš„æ•°æ®ç»“æ„ï¼Œtrie èŠ‚ç‚¹æœ€å¤šæœ‰ä¸€ä¸ªç»ˆç«¯å­—ç¬¦ä¸²ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰ç»ˆç«¯ä¿¡æ¯ï¼Œå°±ä»¥0x00å­—èŠ‚æ ‡è®°ã€‚æœ‰çš„åŒ–ï¼Œå°±ç”¨ Leb128 ä»£æ›¿è¯¥èŠ‚ç‚¹çš„ç»ˆç«¯å­—ç¬¦ä¸²ä¿¡æ¯å¤§å°ã€‚èŠ‚ç‚¹å¯¼å‡ºä¿¡æ¯åï¼Œç±»å‹ä¿¡æ¯ç±»å‹ä½¿ç”¨0x3å¯¹æ ‡å¿—è¿›è¡Œä½æ©ç è·å¾—ã€‚0x00è¡¨ç¤ºå¸¸è§„ç¬¦å·ï¼Œ0x01è¡¨ç¤ºçº¿ç¨‹æœ¬åœ°ç¬¦å·ï¼Œ0x02æ ‡è¯†ç»å¯¹ç¬¦å·ï¼Œ0x4è¡¨ç¤ºå¼±å¼•ç”¨ç¬¦å·ï¼Œ0x8è¡¨ç¤ºé‡æ–°å¯¼å‡ºï¼Œ0x10æ˜¯ stubï¼Œå…·æœ‰ Leb128çš„ stub åç§»é‡ã€‚å¤§éƒ¨åˆ†ç¬¦å·éƒ½æ˜¯å¸¸è§„ç¬¦å·ï¼Œä¼šå°† Mach-O çš„åç§»é‡ç»™ç¬¦å·ã€‚</p>
<p>ç”Ÿæˆ trie æ•°æ®ç»“æ„çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MachOFileLayout::buildExportTrie</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (_file.exportInfo.empty())</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// For all temporary strings and objects used building trie.</span></span><br><span class="line">  BumpPtrAllocator allocator;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Build trie of all exported symbols.</span></span><br><span class="line">  <span class="keyword">auto</span> *rootNode = <span class="keyword">new</span> (allocator) TrieNode(StringRef());</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;TrieNode*&gt; allNodes;</span><br><span class="line">  allNodes.reserve(_file.exportInfo.size()*<span class="number">2</span>);</span><br><span class="line">  allNodes.push_back(rootNode);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> Export&amp; entry : _file.exportInfo) &#123;</span><br><span class="line">    rootNode-&gt;addSymbol(entry, allocator, allNodes);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;TrieNode*&gt; orderedNodes;</span><br><span class="line">  orderedNodes.reserve(allNodes.size());</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> Export&amp; entry : _file.exportInfo)</span><br><span class="line">    rootNode-&gt;addOrderedNodes(entry, orderedNodes);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Assign each node in the vector an offset in the trie stream, iterating</span></span><br><span class="line">  <span class="comment">// until all uleb128 sizes have stabilized.</span></span><br><span class="line">  <span class="keyword">bool</span> more;</span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> offset = <span class="number">0</span>;</span><br><span class="line">    more = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (TrieNode* node : orderedNodes) &#123;</span><br><span class="line">      <span class="keyword">if</span> (node-&gt;updateOffset(offset))</span><br><span class="line">        more = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">while</span> (more);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Serialize trie to ByteBuffer.</span></span><br><span class="line">  <span class="keyword">for</span> (TrieNode* node : orderedNodes) &#123;</span><br><span class="line">    node-&gt;appendToByteBuffer(_exportTrie);</span><br><span class="line">  &#125;</span><br><span class="line">  _exportTrie.align(_is64 ? <span class="number">8</span> : <span class="number">4</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Trie ä¹Ÿå«æ•°å­—æ ‘æˆ–å‰ç¼€æ ‘ï¼Œæ˜¯ä¸€ç§æœç´¢æ ‘ã€‚æŸ¥æ‰¾å¤æ‚åº¦ O(m)ï¼Œm æ˜¯å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚å’Œæ•£åˆ—è¡¨ç›¸æ¯”ï¼Œæ•£åˆ—æœ€å·®å¤æ‚åº¦æ˜¯ O(N)ï¼Œä¸€èˆ¬éƒ½æ˜¯ O(1)ï¼Œç”¨ O(m)æ—¶é—´è¯„ä¼° hashã€‚æ•£åˆ—ç¼ºç‚¹æ˜¯ä¼šåˆ†é…ä¸€å¤§å—å†…å­˜ï¼Œå†…å®¹è¶Šå¤šæ‰€å å†…å­˜è¶Šå¤§ã€‚Trie ä¸ä»…æŸ¥æ‰¾å¿«ï¼Œæ’å…¥å’Œåˆ é™¤éƒ½å¾ˆå¿«ï¼Œé€‚åˆå­˜å‚¨é¢„æµ‹æ€§æ–‡æœ¬æˆ–è‡ªåŠ¨å®Œæˆè¯å…¸ã€‚ä¸ºäº†è¿›ä¸€æ­¥ä¼˜åŒ–æ‰€å ç©ºé—´ï¼Œå¯ä»¥å°† Trie è¿™ç§æ ‘å½¢çš„ç¡®å®šæ€§æœ‰é™è‡ªåŠ¨æœºå‹ç¼©æˆç¡®å®šæ€§éå¾ªç¯æœ‰é™çŠ¶æ€è‡ªåŠ¨ä½“ï¼ˆDAFSAï¼‰ï¼Œå…¶ç©ºé—´å°ï¼Œåšæ³•æ˜¯ä¼šå‹ç¼©ç›¸åŒåˆ†æ”¯ã€‚å¯¹äºæ›´å¤§å†…å®¹ï¼Œè¿˜å¯ä»¥åšæ›´è¿›ä¸€æ­¥çš„ä¼˜åŒ–ï¼Œæ¯”å¦‚ä½¿ç”¨å­—æ¯ç¼©å‡çš„å®ç°æŠ€æœ¯ï¼ŒæŠŠåŸæ¥çš„å­—ç¬¦ä¸²é‡æ–°è§£é‡Šä¸ºè¾ƒé•¿çš„å­—ç¬¦ä¸²ï¼›ä½¿ç”¨å•é“¾å¼åˆ—è¡¨ï¼ŒèŠ‚ç‚¹è®¾è®¡ä¸ºç”±ç¬¦å·ã€å­èŠ‚ç‚¹ã€ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ¥è¡¨ç¤ºï¼›å°†å­—æ¯è¡¨æ•°ç»„å­˜å‚¨ä¸ºä»£è¡¨ ASCII å­—æ¯è¡¨çš„256ä½çš„ä½å›¾ã€‚</p>
<p>å¯¹äºåŠ¨æ€åº“ï¼Œæœ‰å‡ ä¸ªæ˜“äºç†è§£çš„å…¬å…±ç¬¦å·æ¯”å¯¼å‡ºæ‰€æœ‰ç¬¦å·æ›´æ˜“äºä½¿ç”¨ï¼Œè®©å…¬å…±ç¬¦å·é›†å°‘ï¼Œç§æœ‰ç¬¦å·é›†ä¸°å¯Œï¼Œç»´æŠ¤èµ·æ¥æ›´åŠ æ–¹ä¾¿ã€‚æ›´æ–°æ—¶ä¹Ÿä¸ä¼šå½±å“è¾ƒæ—©ç‰ˆæœ¬ã€‚å¯¼å‡ºæœ€å°‘æ•°é‡çš„ç¬¦å·ï¼Œè¿˜èƒ½å¤Ÿä¼˜åŒ–åŠ¨æ€åŠ è½½ç¨‹åºåˆ°è¿›ç¨‹çš„æ—¶é—´ï¼ŒåŠ¨æ€åº“å¯¼å‡ºç¬¦å·è¶Šå°‘ï¼Œdyld åŠ è½½å°±è¶Šå¿«ã€‚</p>
<p>é™æ€å­˜å‚¨ç±»æ˜¯è¡¨æ˜ä¸æƒ³å¯¼å‡ºç¬¦å·çš„æœ€ç®€å•çš„æ–¹æ³•ã€‚å°†å¯è§æ€§å±æ€§æ”¾ç½®åœ¨å®ç°æ–‡ä»¶ä¸­çš„ç¬¦å·å®šä¹‰é‡Œï¼Œè®¾ç½®ç¬¦å·å¯è§æ€§ä¹Ÿèƒ½å¤Ÿæ›´ç²¾ç¡®çš„æ§åˆ¶å“ªäº›ç¬¦å·æ˜¯å…¬å…±ç¬¦å·è¿˜æ˜¯ç§æœ‰ç¬¦å·ã€‚åœ¨ç¼–è¯‘é€‰é¡¹ -fvisbility å¯ä»¥æŒ‡å®šæœªæŒ‡å®šå¯è§æ€§ç¬¦å·çš„å¯è§æ€§ã€‚ä½¿ç”¨ -weak_library é€‰é¡¹ä¼šå‘Šè¯‰ç¼–è¯‘å™¨å°†åº“é‡Œæ‰€æœ‰å¯¼å‡ºç¬¦å·éƒ½è®¾ä¸ºå¼±é“¾æ¥ç¬¦å·ã€‚ä½¿ç”¨ nm çš„ -gm é€‰é¡¹å¯ä»¥æŸ¥çœ‹ Mach-O å¯¼å‡ºçš„ç¬¦å·ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nm -gm header.dylib</span><br></pre></td></tr></table></figure>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(undefined) external ___cxa_atexit (from libSystem)</span><br><span class="line">(undefined) external _printf (from libSystem)</span><br><span class="line">(undefined) <span class="function">external <span class="title">dyld_stub_binder</span> <span class="params">(from libSystem)</span></span></span><br></pre></td></tr></table></figure>
<p>å¦å¤–å¯ä»¥é€šè¿‡å¯¼å‡ºçš„ç¬¦å·æ–‡ä»¶ï¼Œåˆ—å‡ºè¦å¯¼å‡ºçš„ç¬¦å·æ¥æ§åˆ¶å¯¼å‡ºç¬¦å·æ•°é‡ï¼Œå…¶ä»–ç¬¦å·éƒ½ä¼šè¢«éšè—ã€‚å¯¼å‡ºç¬¦å·æ–‡ä»¶ list å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_foo</span><br><span class="line">_header</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ -exported_symbols_list é€‰é¡¹ç¼–è¯‘å°±å¯ä»¥ä»…å¯¼å‡ºæ–‡ä»¶ä¸­æŒ‡å®šçš„ç¬¦å·ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clang -dynamiclib header.c -exported_symbols_list <span class="built_in">list</span> -o header.dylib</span><br></pre></td></tr></table></figure>
<h3 id="ç¬¦å·ç»‘å®šèŒƒå›´"><a href="#ç¬¦å·ç»‘å®šèŒƒå›´" class="headerlink" title="ç¬¦å·ç»‘å®šèŒƒå›´"></a>ç¬¦å·ç»‘å®šèŒƒå›´</h3><p>ç¬¦å·å¯èƒ½å­˜åœ¨ä¸å¤šä¸ªä½œç”¨åŸŸçº§åˆ«ã€‚æœªå®šä¹‰çš„å¤–éƒ¨ç¬¦å·æ˜¯åœ¨å½“å‰æ–‡ä»¶ä¹‹å¤–çš„æ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="keyword">int</span> count;</span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br></pre></td></tr></table></figure>
<p>ç§æœ‰å®šä¹‰ç¬¦å·ï¼Œå…¶ä»–æ¨¡å—ä¸å¯è§</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> count;</span><br></pre></td></tr></table></figure>
<p>ç§æœ‰å¤–éƒ¨ç¬¦å·å¯ä»¥ä½¿ç”¨ <strong>private_extern</strong>å…³é”®å­—ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__private_extern__ <span class="keyword">int</span> count = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>
<p>æŒ‡å®šä¸€ä¸ªå‡½æ•°ä¸ºå¼±å¼•ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ weak_import å±æ€§ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">(<span class="keyword">void</span>)</span> __<span class="title">attribute__</span><span class="params">((weak_import))</span></span>;</span><br></pre></td></tr></table></figure>
<p>åœ¨ç¬¦å·å£°æ˜ä¸­æ·»åŠ  weak å±æ€§æ¥æŒ‡å®šå°†ç¬¦å·è®¾ç½®ä¸ºåˆå¹¶çš„å¼±å¼•ç”¨ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">(<span class="keyword">void</span>)</span> __<span class="title">attribute__</span><span class="params">((weak))</span></span>;</span><br></pre></td></tr></table></figure>
<h3 id="å…¥å£ç‚¹"><a href="#å…¥å£ç‚¹" class="headerlink" title="å…¥å£ç‚¹"></a>å…¥å£ç‚¹</h3><p>ç¬¦å·ç»‘å®šç»“æœæ”¾åˆ° LC_DYSYMTAB æŒ‡å®šçš„ sectionï¼Œè§£æåçš„åœ°å€ä¼šæ”¾åˆ° <strong>DATA segment çš„ </strong>nl_symbol_ptr å’Œ <strong>got é‡Œã€‚dyld ä½¿ç”¨ Load Command æŒ‡å®š Mach-O ä¸­çš„æ•°æ®ä»¥å„ç§æ–¹å¼é“¾æ¥ä¾èµ–é¡¹ã€‚Mach-O çš„ Segment æŒ‰ç…§ Load Command ä¸­æŒ‡å®šæ˜ å°„åˆ°å†…å­˜ä¸­ã€‚ åˆå§‹åŒ–åï¼Œä¼šè°ƒç”¨ LC_MAIN æŒ‡å®šçš„å…¥å£ç‚¹ï¼Œè¿™ä¸ªç‚¹æ˜¯ </strong>TEXT Segment çš„ <strong>text Section çš„å¼€å§‹ã€‚ä½¿ç”¨ </strong>stubs å°† <strong>la_symbol_ptr æŒ‡å‘ </strong>stub_helpersï¼Œdyld_stub_binder æ‰§è¡Œè§£æï¼Œç„¶åæ›´æ–° __la_symbol_ptr çš„åœ°å€ã€‚</p>
<p>Mach-O å’Œé“¾æ¥å™¨ä¹‹é—´æ˜¯é€šè¿‡ assembly trampoline è¿›è¡Œçš„æ¡¥æ¥ï¼ŒMach-O æ¥å£çš„ ABI å’Œ ELF ç›¸åŒï¼Œä½†ç­–ç•¥ä¸åŒã€‚macOS åœ¨è°ƒç”¨ dyld å‰åéƒ½ä¼šä¿å­˜å’Œæ¢å¤ SSE å¯„å­˜å™¨ã€‚</p>
<h3 id="åŠ¨æ€åº“æ„é€ å‡½æ•°å’Œææ„å‡½æ•°"><a href="#åŠ¨æ€åº“æ„é€ å‡½æ•°å’Œææ„å‡½æ•°" class="headerlink" title="åŠ¨æ€åº“æ„é€ å‡½æ•°å’Œææ„å‡½æ•°"></a>åŠ¨æ€åº“æ„é€ å‡½æ•°å’Œææ„å‡½æ•°</h3><p>åŠ¨æ€åº“åŠ è½½å¯èƒ½éœ€è¦æ‰§è¡Œç‰¹æ®Šçš„åˆå§‹åŒ–æˆ–è€…éœ€è¦åšäº›å‡†å¤‡å·¥ä½œï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨åˆå§‹åŒ–å‡½æ•°ä¹Ÿå°±æ˜¯æ„é€ å‡½æ•°ã€‚ç»“æŸçš„æ—¶å€™å¯ä»¥åŠ ææ„å‡½æ•°ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå…ˆå®šä¹‰ä¸€ä¸ª header.cï¼Œåœ¨é‡Œé¢åŠ ä¸Šæ„é€ å‡½æ•°å’Œææ„å‡½æ•°ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">__attribute__((constructor))</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, <span class="string">&quot;prepare&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__attribute__((destructor))</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">end</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, <span class="string">&quot;end&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showHeader</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, <span class="string">&quot;header&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å°† header.c æ„å»ºæˆä¸€ä¸ªåŠ¨æ€åº“ header.dylibã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xcrun clang -dynamiclib header.c -fvisibility=hidden -o header.dylib</span><br></pre></td></tr></table></figure>
<p>å°† header.dylib å’Œ main.c æ„å»ºæˆä¸€ä¸ªä¸­é—´ç›®æ ‡æ–‡ä»¶ main.oã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xcrun clang main.c header.dylib -o main</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œçœ‹ç»“æœ</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ming@mingdeMacBook-Pro macho_demo % ./main <span class="string">&quot;hi&quot;</span></span><br><span class="line">prepare</span><br><span class="line">hi</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒåŠ¨æ€åº“çš„æ„é€ å‡½æ•° prepare å’Œææ„å‡½æ•° end éƒ½æ‰§è¡Œäº†ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ä»‹ç»&quot;&gt;&lt;a href=&quot;#ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;ä»‹ç»&quot;&gt;&lt;/a&gt;ä»‹ç»&lt;/h2&gt;&lt;p&gt;Mach-O çš„å…¨ç§°æ˜¯ Mach Object File Formatã€‚å¯ä»¥æ˜¯å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç›®æ ‡ä»£ç æˆ–å…±äº«åº“ï¼ŒåŠ¨æ€åº“ã€‚Mach å†…æ ¸çš„æ“ä½œç³»ç»Ÿ
    
    </summary>
    
      <category term="Programming" scheme="http://ming1016.github.io/categories/Programming/"/>
    
    
      <category term="iOS" scheme="http://ming1016.github.io/tags/iOS/"/>
    
      <category term="Apple" scheme="http://ming1016.github.io/tags/Apple/"/>
    
      <category term="Mach-O" scheme="http://ming1016.github.io/tags/Mach-O/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨å¿«æ‰‹åšåˆ†äº«ã€æ— ç”¨ç±»æ£€æŸ¥ã€åœ¨å¹¿å·åš SwiftUI å­¦ä¹ ç¬”è®°åˆ†äº«ã€InfoQäºŒå‰æ ‘è§†é¢‘</title>
    <link href="http://ming1016.github.io/2020/01/05/kuaishou-unused-class-swiftui-note-binary-tree-interview/"/>
    <id>http://ming1016.github.io/2020/01/05/kuaishou-unused-class-swiftui-note-binary-tree-interview/</id>
    <published>2020-01-05T07:57:05.000Z</published>
    <updated>2021-04-11T14:42:09.924Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åœ¨å¿«æ‰‹åšåˆ†äº«"><a href="#åœ¨å¿«æ‰‹åšåˆ†äº«" class="headerlink" title="åœ¨å¿«æ‰‹åšåˆ†äº«"></a>åœ¨å¿«æ‰‹åšåˆ†äº«</h2><p><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/00.jpeg" alt=""></p>
<p>å‰æ»´æ»´åŒäº‹é‚€è¯·æˆ‘å»å¿«æ‰‹åšåˆ†äº«ã€‚ä¸‹é¢æ˜¯åˆ†äº«æ—¶çš„ Slidesï¼š</p>
<p><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/01.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/02.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/03.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/04.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/05.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/06.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/07.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/08.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/09.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/10.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/11.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/12.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/13.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/14.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/15.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/16.png" alt=""></p>
<p>è¯¦ç»†æ–‡ç« ä»‹ç»ï¼š<a href="https://ming1016.github.io/2019/12/07/how-to-analyze-startup-time-cost-in-ios/">å¦‚ä½•å¯¹ iOS å¯åŠ¨é˜¶æ®µè€—æ—¶è¿›è¡Œåˆ†æ | æ˜Ÿå…‰ç¤¾ - æˆ´é“­çš„åšå®¢</a></p>
<p>ä»£ç ï¼š<a href="https://github.com/ming1016/MethodTraceAnalyze">GitHub - ming1016/MethodTraceAnalyze: æ–¹æ³•è€—æ—¶åˆ†æ</a></p>
<h2 id="æ— ç”¨ç±»æ£€æŸ¥"><a href="#æ— ç”¨ç±»æ£€æŸ¥" class="headerlink" title="æ— ç”¨ç±»æ£€æŸ¥"></a>æ— ç”¨ç±»æ£€æŸ¥</h2><p>å¦‚æœåŒ…é‡Œæœ‰ä¸€å †æ²¡ç”¨çš„ç±»ï¼Œä¸å…‰ä¼šå½±å“ç”¨æˆ·ä¸‹è½½é€Ÿåº¦ï¼Œä¹Ÿä¼šå½±å“å¯åŠ¨åŠ è½½é€Ÿåº¦ã€‚æ£€æŸ¥æ— ç”¨ç±»ï¼Œä¸€æ¬¡æ˜¯æ— æ³•è·å¾—å…¨éƒ¨æ— ç”¨ç±»çš„ï¼Œå› ä¸ºæ— ç”¨çš„ç±»é‡Œç”¨äº†å…¶ä»–æ— ç”¨çš„ç±»å°±ç®—æ˜¯æœ‰ç”¨äº†ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œé€’å½’æŸ¥æ‰¾ï¼Œè¿™æ ·æ‰èƒ½å¤Ÿè¿æ ¹æ‹”èµ·ã€‚è¿™ä¸ªè¿‡ç¨‹å¦‚æœæ˜¯æ‰‹åŠ¨åšæ¯”è¾ƒè´¹åŠ²ã€æ”¶ç›Šæ— æ³•ä¸€æ¬¡è¯„ä¼°ï¼Œå¾ˆéš¾æ¨åŠ¨ã€‚åŒæ—¶è¿˜éœ€è¦åœ¨çº¿ä¸Šç°åº¦è¿è¡Œæ—¶æ£€æŸ¥å®é™…ç±»çš„ä½¿ç”¨æƒ…å†µï¼Œå¾ˆå¤šé™æ€å±‚é¢å…³è”çš„ç±»ä½¿ç”¨ï¼Œå®é™…è¿è¡Œè¿‡ç¨‹ä¸­ä¹Ÿå¯èƒ½ç”¨ä¸åˆ°ã€‚</p>
<p>æ€è·¯å’Œå…³é”®ä»£ç å¦‚ä¸‹ã€‚</p>
<h3 id="ç¬¬ä¸€æ­¥"><a href="#ç¬¬ä¸€æ­¥" class="headerlink" title="ç¬¬ä¸€æ­¥"></a>ç¬¬ä¸€æ­¥</h3><p>ä½¿ç”¨ <a href="https://github.com/ming1016/MethodTraceAnalyze">MethodTraceAnalyze</a> é‡Œ ParseOC ç±»çš„ ocNodes å‡½æ•°ï¼Œé€šè¿‡ä¼ å…¥ workspace è·¯å¾„è·å–æ‰€æœ‰èŠ‚ç‚¹çš„ç»“æ„ä½“ OCNodeã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> allNodes <span class="operator">=</span> <span class="type">ParseOC</span>.ocNodes(workspacePath: workSpacePath)</span><br></pre></td></tr></table></figure>
<p>æ‰¾å‡ºç±»å‹æ˜¯æ–¹æ³•çš„ç»“æ„ä½“ï¼Œå› ä¸ºç±»çš„åˆå§‹åŒ–å’Œä½¿ç”¨éƒ½æ˜¯åœ¨è¿™äº›æ–¹æ³•ä¸­è¿›è¡Œçš„ã€‚OCNode é’ˆå¯¹ä¸åŒç±»å‹æ‰€å­˜å‚¨çš„æ•°æ®ä¹Ÿæ˜¯ä¸åŒçš„ï¼Œæ‰€ä»¥æˆ‘å®šä¹‰ä¸€ä¸ª OCNodeValueProtocol åè®®å±æ€§ï¼Œè¿™æ ·å°±å¯ä»¥é’ˆå¯¹ä¸åŒç±»å‹çš„èŠ‚ç‚¹å­˜å‚¨ä¸åŒçš„æ•°æ®ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">OCNodeDefaultValue</span>: <span class="title">OCNodeValueProtocol</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> defaultValue: <span class="type">String</span></span><br><span class="line">    <span class="function"><span class="keyword">init</span>()</span> &#123;</span><br><span class="line">        defaultValue <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">OCNodeMethod</span>: <span class="title">OCNodeValueProtocol</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> belongClass: <span class="type">String</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> methodName: <span class="type">String</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> tokenNodes: [<span class="type">OCTokenNode</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">OCNodeClass</span>: <span class="title">OCNodeValueProtocol</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> className: <span class="type">String</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> baseClass: <span class="type">String</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> hMethod: [<span class="type">String</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> mMethod: [<span class="type">String</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> baseClasses: [<span class="type">String</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°å¯¹æ–¹æ³•ç±»å‹ä¼šå­˜æ‰€å±ç±»ã€æ–¹æ³•åå’Œæ–¹æ³•å†…æ‰€æœ‰ tokenä»¥ä¾¿è¿›è¡Œè¿›ä¸€æ­¥åˆ†æã€‚å¯¹ç±»è¿™ç§ç±»å‹ä¼šè®°å½•ä»–çš„åŸºç±»ã€ç±»åã€å¤´æ–‡ä»¶æ–¹æ³•åˆ—è¡¨å’Œå®ç°æ–‡ä»¶æ–¹æ³•åˆ—è¡¨ï¼Œè¿˜ç”¨ä¸€ä¸ªæ ˆè®°å½•ç»§æ‰¿é“¾ã€‚</p>
<h3 id="ç¬¬äºŒæ­¥"><a href="#ç¬¬äºŒæ­¥" class="headerlink" title="ç¬¬äºŒæ­¥"></a>ç¬¬äºŒæ­¥</h3><p>è·å–æ‰€æœ‰ç±»çš„èŠ‚ç‚¹ï¼Œé€šè¿‡å¯¹æ–¹æ³•å†…æ‰€æœ‰ token çš„åˆ†ææ¥çœ‹ä½¿ç”¨äº†å“ªäº›ç±»ï¼Œå¹¶è®°å½•ä½¿ç”¨çš„ç±»ã€‚</p>
<p>è·å–æ‰€æœ‰ç±»èŠ‚ç‚¹çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–æ‰€æœ‰ç±»èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">var</span> allClassSet:<span class="type">Set</span>&lt;<span class="type">String</span>&gt; <span class="operator">=</span> <span class="type">Set</span>()</span><br><span class="line"><span class="keyword">for</span> aNode <span class="keyword">in</span> allNodes &#123;</span><br><span class="line">    <span class="keyword">if</span> aNode.type <span class="operator">==</span> .class &#123;</span><br><span class="line">        <span class="keyword">let</span> classValue <span class="operator">=</span> aNode.value <span class="keyword">as!</span> <span class="type">OCNodeClass</span></span><br><span class="line">        allClassSet.insert(classValue.className)</span><br><span class="line">        <span class="keyword">if</span> classValue.baseClass.count <span class="operator">&gt;</span> <span class="number">0</span> &#123;</span><br><span class="line">            baseClasses.insert(classValue.baseClass)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="comment">// end for aNode in allNodes</span></span><br></pre></td></tr></table></figure>
<p>è®°å½•ä½¿ç”¨çš„ç±»å…³é”®ä»£ç ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">parseAMethodUsedClass</span>(<span class="params">node</span>: <span class="type">OCNode</span>, <span class="params">allClass</span>: <span class="type">Set</span>&lt;<span class="type">String</span>&gt;)</span> -&gt; <span class="type">Set</span>&lt;<span class="type">String</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> usedClassSet:<span class="type">Set</span>&lt;<span class="type">String</span>&gt; <span class="operator">=</span> <span class="type">Set</span>()</span><br><span class="line">    <span class="keyword">guard</span> node.type <span class="operator">==</span> .method <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> usedClassSet</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> methodValue:<span class="type">OCNodeMethod</span> <span class="operator">=</span> node.value <span class="keyword">as!</span> <span class="type">OCNodeMethod</span></span><br><span class="line">    <span class="keyword">for</span> aNode <span class="keyword">in</span> methodValue.tokenNodes &#123;</span><br><span class="line">        <span class="keyword">if</span> allClass.contains(aNode.value) &#123;</span><br><span class="line">            usedClassSet.insert(aNode.value)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> usedClassSet</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ç¬¬ä¸‰æ­¥"><a href="#ç¬¬ä¸‰æ­¥" class="headerlink" title="ç¬¬ä¸‰æ­¥"></a>ç¬¬ä¸‰æ­¥</h3><p>æœ‰äº†æ‰€æœ‰ä½¿ç”¨çš„ç±»å’Œæ‰€æœ‰çš„ç±»ï¼Œå°±èƒ½å¤Ÿè·å–æ²¡ç”¨åˆ°çš„ç±»ã€‚ä¸ºäº†è·‘ä¸€æ¬¡å°±èƒ½å¤Ÿå°†æ‰€æœ‰æ²¡ç”¨çš„ç±»æ‰¾å‡ºï¼Œæ‰€ä»¥éœ€è¦åœ¨æ‰¾åˆ°æ— ç”¨ç±»åï¼Œå°†è¿™äº›ç±»è‡ªåŠ¨å»æ‰å†è¿›è¡Œä¸‹ä¸€æ¬¡æŸ¥æ‰¾ã€‚æˆ‘è¿™é‡Œå†™äº†ä¸ªé€’å½’æ¥å¹²è¿™ä»¶äº‹ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> recursiveCount <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">recursiveCheckUnUsedClass</span>(<span class="params">unUsed</span>:<span class="type">Set</span>&lt;<span class="type">String</span>&gt;)</span> -&gt; <span class="type">Set</span>&lt;<span class="type">String</span>&gt; &#123;</span><br><span class="line">    recursiveCount <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;into recursive!!!!ç¬¬<span class="subst">\(recursiveCount)</span>æ¬¡&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;----------------------<span class="subst">\n</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> unUsed &#123;</span><br><span class="line">        <span class="built_in">print</span>(a)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> unUsedClassSet <span class="operator">=</span> unUsed</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç¼©å°èŒƒå›´</span></span><br><span class="line">    <span class="keyword">for</span> aUnUsed <span class="keyword">in</span> unUsedClassSet &#123;</span><br><span class="line">        <span class="keyword">if</span> allClassSet.contains(aUnUsed) &#123;</span><br><span class="line">            allClassSet.remove(aUnUsed)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> allUsedClassSet:<span class="type">Set</span>&lt;<span class="type">String</span>&gt; <span class="operator">=</span> <span class="type">Set</span>()</span><br><span class="line">    <span class="keyword">for</span> aNode <span class="keyword">in</span> allNodes &#123;</span><br><span class="line">        <span class="keyword">if</span> aNode.type <span class="operator">==</span> .method &#123;</span><br><span class="line">            <span class="keyword">let</span> nodeValue:<span class="type">OCNodeMethod</span> <span class="operator">=</span> aNode.value <span class="keyword">as!</span> <span class="type">OCNodeMethod</span></span><br><span class="line">            <span class="comment">// è¿‡æ»¤å·²åˆ¤å®šæ— ç”¨ç±»é‡Œçš„æ–¹æ³•</span></span><br><span class="line">            <span class="keyword">guard</span> <span class="operator">!</span>unUsedClassSet.contains(nodeValue.belongClass) <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">let</span> usedSet <span class="operator">=</span> <span class="type">ParseOCMethodContent</span>.parseAMethodUsedClass(node: aNode, allClass: allClassSet)</span><br><span class="line">            <span class="keyword">if</span> usedSet.count <span class="operator">&gt;</span> <span class="number">0</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> aSet <span class="keyword">in</span> usedSet &#123;</span><br><span class="line">                    allUsedClassSet.insert(aSet)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="comment">// end if usedSet.count &gt; 0</span></span><br><span class="line">        &#125; <span class="comment">// end if aNode.type == .method</span></span><br><span class="line">    &#125; <span class="comment">// end for aNode in allNodes</span></span><br><span class="line">    <span class="keyword">var</span> hasUnUsed <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    <span class="comment">// æ‰¾å‡ºæ— ç”¨ç±»</span></span><br><span class="line">    <span class="keyword">for</span> aSet <span class="keyword">in</span> allClassSet &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="operator">!</span>allUsedClassSet.contains(aSet) &#123;</span><br><span class="line">            unUsedClassSet.insert(aSet)</span><br><span class="line">            hasUnUsed <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> hasUnUsed &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœå‘ç°è¿˜æœ‰æ— ç”¨çš„ç±»ï¼Œéœ€è¦ç»§ç»­é€’å½’è°ƒç”¨è¿›è¡Œåˆ†æ</span></span><br><span class="line">        <span class="keyword">return</span> recursiveCheckUnUsedClass(unUsed: unUsedClassSet)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> unUsedClassSet</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€’å½’è°ƒç”¨</span></span><br><span class="line"><span class="keyword">var</span> unUsedClassFromRecursive <span class="operator">=</span> recursiveCheckUnUsedClass(unUsed: <span class="type">Set</span>&lt;<span class="type">String</span>&gt;())</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡é€’å½’è¿›è¡Œå¤šæ¬¡èƒ½å¤Ÿå–åˆ°æœ€ç»ˆçš„ç»“æœã€‚</p>
<h3 id="ç¬¬å››æ­¥"><a href="#ç¬¬å››æ­¥" class="headerlink" title="ç¬¬å››æ­¥"></a>ç¬¬å››æ­¥</h3><p>å¯¹äºç»§æ‰¿å’Œç³»ç»Ÿçš„ç±»è¿˜éœ€è¦è¿›è¡Œè¿‡æ»¤ï¼Œè¿›ä¸€æ­¥æé«˜å‡†ç¡®æ€§ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> unUsedClassSetCopy <span class="operator">=</span> unUsedClassFromRecursive</span><br><span class="line"><span class="keyword">for</span> aSet <span class="keyword">in</span> unUsedClassSetCopy &#123;</span><br><span class="line">    <span class="comment">// è¿‡æ»¤ç³»ç»Ÿæ§ä»¶</span></span><br><span class="line">    <span class="keyword">let</span> filters <span class="operator">=</span> [<span class="string">&quot;NS&quot;</span>,<span class="string">&quot;UI&quot;</span>]</span><br><span class="line">    <span class="keyword">var</span> shouldFilter <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    <span class="keyword">for</span> filter <span class="keyword">in</span> filters &#123;</span><br><span class="line">        <span class="keyword">if</span> aSet.hasPrefix(filter) &#123;</span><br><span class="line">            shouldFilter <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¿‡æ»¤åŸºç±»</span></span><br><span class="line">    <span class="keyword">if</span> baseClasses.contains(aSet) &#123;</span><br><span class="line">        shouldFilter <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¼€å§‹è¿‡æ»¤</span></span><br><span class="line">    <span class="keyword">if</span> shouldFilter &#123;</span><br><span class="line">        unUsedClassFromRecursive.remove(aSet)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¸…ç†äº†é€šè¿‡è¿™ç§é™æ€æ‰«æå‡ºçš„æ— ç”¨ç±»ï¼Œè¿˜å¯ä»¥é€šè¿‡è¿è¡Œæ—¶æ¥åˆ¤æ–­ç±»æ˜¯å¦è¢«åˆå§‹åŒ–äº†ï¼Œä»è€Œæ‰¾å‡ºæ— ç”¨ç±»ã€‚ç±»è¿è¡Œæ—¶æ˜¯å¦åˆå§‹åŒ–çš„è¿™ä¸ªä¿¡æ¯æ˜¯ä¸ªå¸ƒå°”å€¼ï¼Œå« isInitializedï¼Œå­˜å‚¨åœ¨å…ƒç±» class_rw_t ç»“æ„ä½“çš„ flags å­—æ®µé‡Œï¼Œåœ¨ 1&lt;&lt;29 ä½è®°å½•ã€‚</p>
<p>å®Œæ•´ä»£ç è§ ParseOCMethodContent æ–‡ä»¶ï¼š<a href="https://github.com/ming1016/MethodTraceAnalyze/blob/master/MethodTraceAnalyze/OC/ParseOCMethodContent.swift">MethodTraceAnalyze/ParseOCMethodContent.swift at master Â· ming1016/MethodTraceAnalyze Â· GitHub</a></p>
<h2 id="åœ¨å¹¿å·åšçš„-SwiftUI-å­¦ä¹ ç¬”è®°åˆ†äº«"><a href="#åœ¨å¹¿å·åšçš„-SwiftUI-å­¦ä¹ ç¬”è®°åˆ†äº«" class="headerlink" title="åœ¨å¹¿å·åšçš„ SwiftUI å­¦ä¹ ç¬”è®°åˆ†äº«"></a>åœ¨å¹¿å·åšçš„ SwiftUI å­¦ä¹ ç¬”è®°åˆ†äº«</h2><p><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/45.jpg" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/46.jpg" alt=""></p>
<p>ä¸‹é¢æ˜¯ç¬”è®°å†…å®¹ï¼š</p>
<p><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/24.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/25.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/26.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/27.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/28.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/29.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/30.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/31.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/32.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/33.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/34.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/35.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/36.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/37.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/38.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/39.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/40.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/41.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/42.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/43.png" alt=""><br><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/44.png" alt=""></p>
<p>æ¨èå–µç¥çš„ SwiftUI æ–°ä¹¦ï¼Œ<a href="https://objccn.io/products/swift-ui">ObjC ä¸­å›½ - SwiftUI ä¸ Combine ç¼–ç¨‹</a>ã€‚</p>
<p>è¿™æœ¬ä»‹ç» Combine çš„ä¹¦ä¹Ÿä»‹ç»çš„éå¸¸è¯¦ç»†ï¼š<a href="https://heckj.github.io/swiftui-notes/">Using Combine</a></p>
<p>è¿™ä¸ªç½‘ç«™æœ‰å¤§é‡ SwiftUI çš„æ§ä»¶ä½¿ç”¨èŒƒä¾‹å¯ä»¥å‚è€ƒï¼š<a href="https://www.hackingwithswift.com/quick-start/swiftui">SwiftUI by Example - free quick start tutorials for Swift developers</a></p>
<p>è¿™ä¸ªåšå®¢æ¯ç¯‡éƒ½æ˜¯ SwiftUI ç›¸å…³çš„ï¼Œè€Œä¸”æ›´æ–°éå¸¸é¢‘ç¹ï¼š<a href="https://swiftwithmajid.com/">Home | Majidâ€™s blog about Swift development</a></p>
<h2 id="InfoQäºŒå‰æ ‘è§†é¢‘"><a href="#InfoQäºŒå‰æ ‘è§†é¢‘" class="headerlink" title="InfoQäºŒå‰æ ‘è§†é¢‘"></a>InfoQäºŒå‰æ ‘è§†é¢‘</h2><p>äº”åˆ†é’Ÿçš„è§†é¢‘ï¼Œåœ¨å¯¼æ¼”æ„æ€ä¸‹éœ€è¦ä¸€å¤©åœ¨å››ä¸ªåœ°æ–¹è¿›è¡Œæ‹æ‘„ï¼Œç”±äºå‰ä¸€å¤©æ™šä¸Šåº†åŠŸå®´å–é«˜äº†ï¼Œæ‹æ‘„å½“å¤© iPad ç¬”ä¹Ÿå¿˜å¸¦äº†ï¼Œå¤´è¿˜æœ‰äº›æ‡µã€‚å¯¼æ¼”ä¸­åˆé¥­éƒ½æ²¡åƒä¸“é—¨å›å®¶æ‹¿äº†ä»–çš„ç¬”ç»™æˆ‘ç”¨ã€‚ä¸‹åˆåœ°ç‚¹å®‰æ’åœ¨å¤®ç¾ï¼Œå…ˆè®¿è°ˆå†ç”»ä¸€å¼ ã€‚åŒ—äº¬ç”µå½±å­¦é™¢æ¯•ä¸š14å¹´ä¸“ä¸šç»˜ç”»ç»éªŒçš„å¯¼æ¼”è´¾æˆæ–Œï¼Œåœ¨æˆ‘ç”»æ—¶è¾¹å¸®æˆ‘æ”¹ç”»è¾¹ä¼ æˆäº†ç»éªŒï¼Œæˆ‘è§‰å¾—è¿™äº›ç»éªŒä¼šè®©æˆ‘æ›´è¿›ä¸€æ­¥ã€‚</p>
<p><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/17.jpg" alt=""></p>
<p>ä¸‹é¢æ˜¯è®°è€…å‰¡æ²›åœ¨ InfoQ ä¸Šå‘å¸ƒçš„é‡‡è®¿å†…å®¹å’Œè§†é¢‘ï¼ŒåŸæ–‡åœ¨ï¼š<a href="https://mp.weixin.qq.com/s/Xz2TcGjG14AXr_zmXMwUxg">â€œåˆ›é€ ï¼Œå°±å€¼å¾—è¢«è‚¯å®šâ€ï¼Œä¸€åç¨‹åºå‘˜çš„è‰ºæœ¯äººç”Ÿä¸¨äºŒå‰æ ‘è§†é¢‘</a></p>
<p><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/18.jpg" alt=""></p>
<p>ä»–æ˜¯ä¸€åç¨‹åºå‘˜ï¼ŒåŒæ—¶ä¹Ÿç”¨è‡ªå·±çš„ä¸šä½™æ—¶é—´ç”»ç”»ã€‚æ— è®ºæ˜¯æŠ€æœ¯åˆ†äº«è¿˜æ˜¯çè—å›å¿†ï¼Œä»–éƒ½ç”¨ç”»ç¬”è®°å½•è‡ªå·±ï¼Œè¿æ¥ä»–äººã€‚ä»–è§‰å¾—ç¨‹åºå‘˜å¾ˆé…·ï¼Œæ— è®ºç¼–ç¨‹è¿˜æ˜¯ç”»ç”»ï¼Œéƒ½æ˜¯åœ¨åˆ›é€ ï¼Œè¿™å°±æ˜¯æœ€å€¼å¾—è‚¯å®šçš„äº‹æƒ…ã€‚</p>
<p><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/19.jpg" alt=""></p>
<p>ä»–åœ¨é«˜å¾·è´Ÿè´£æ¶æ„ç ”å‘å·¥ä½œï¼Œä¹Ÿæ˜¯å¤§å®¶çœ¼ä¸­çš„è‰ºæœ¯å®¶ï¼Œåœ¨ä»–èº«ä¸Šæ€»èƒ½çœ‹åˆ°é‚£äº›æ‰§å¿µä¸å†³å¿ƒï¼Œå®ƒä»¬å‘ç€å…‰ï¼Œæ— æ—¶æ— åˆ»ä¸å½±å“ç€å‘¨å›´çš„äººã€‚</p>
<p>ä»–å°±æ˜¯æˆ´é“­ï¼Œä¸€åé…·é…·çš„ç¨‹åºå‘˜ã€‚</p>
<p>å½“èŠåˆ°â€è¿æ¥â€œè¿™ä¸ªè¯çš„æ—¶å€™ï¼Œä»–çš„çœ¼ç¥å¼‚å¸¸åšå®šã€‚</p>
<p>ä»–è§‰å¾—è‡ªå·±åšæŒåˆ›ä½œï¼ŒåšæŒåšå¾ˆå¤šæ²¡æœ‰é—¨æ§›çš„æŠ€æœ¯åˆ†äº«ï¼Œå¾ˆå¤§ä¸€éƒ¨åˆ†åŠ¨åŠ›å°±æ¥è‡ªè¿™ç§æ¸´æœ›ï¼Œæ¸´æœ›è¿æ¥è‡ªå·±çš„è¿‡å»ï¼Œä¹Ÿæ¸´æœ›è¿æ¥ä»–äººã€‚</p>
<p>ä»–å°±æ˜¯æˆ´é“­ï¼Œä¸€ä¸ªæœ‰ç‚¹é…·ï¼Œè¿˜æœ‰ç‚¹æ–‡è‰ºçš„ç¨‹åºå‘˜ï¼Œåœ¨é«˜å¾·åœ°å›¾è´Ÿè´£æ¶æ„ç ”å‘å·¥ä½œã€‚é™¤äº†æŠŠè‡ªå·±æ´»çš„å¾ˆå¹´è½»ï¼Œåœ¨ä»–èº«ä¸Šæ€»èƒ½çœ‹åˆ°ä¸€äº›å‘ç€å…‰çš„ä¸œè¥¿ã€‚</p>
<p>â€œæ˜¯ä¿¡å¿µå—ï¼Ÿâ€</p>
<p>â€œæ˜¯æ‰§å¿µã€‚â€</p>
<h3 id="â€œå½“æ¼«ç”»å®¶ï¼Œå¯èƒ½è¿é¥­éƒ½åƒä¸é¥±ã€‚â€"><a href="#â€œå½“æ¼«ç”»å®¶ï¼Œå¯èƒ½è¿é¥­éƒ½åƒä¸é¥±ã€‚â€" class="headerlink" title="â€œå½“æ¼«ç”»å®¶ï¼Œå¯èƒ½è¿é¥­éƒ½åƒä¸é¥±ã€‚â€"></a>â€œå½“æ¼«ç”»å®¶ï¼Œå¯èƒ½è¿é¥­éƒ½åƒä¸é¥±ã€‚â€</h3><p>æ•…äº‹çš„å¼€å¤´ï¼Œå¤šå°‘æœ‰äº›é—æ†¾ã€‚</p>
<p>æˆ´é“­æœ€æ—©æ¥è§¦ç”»ç”»ï¼Œæ˜¯å°å­¦ä¹‹å‰æŠ¥è¿‡çš„ä¸€ä¸ªé«˜é˜¶å›½ç”»ç­ï¼Œå› ä¸ºè€å¸ˆåœ¨ä¸Šæµ·ï¼Œæ‰€ä»¥ä»–æ¯ç”»å®Œä¸€å¼ éƒ½è¦å¯„è¿‡å»å¹¶ç­‰å¾…å›ä¿¡ï¼Œå½“å…¶ä¸­ä¸€å¹…ç”»æ”¹åˆ°ç¬¬ä¸‰éçš„æ—¶å€™è€å¸ˆå›ä¿¡è¯´ï¼šè¿™å­©å­å¯èƒ½æ²¡ä»€ä¹ˆå¤©èµ‹ã€‚å› ä¸ºè¿™ä»¶äº‹ï¼Œå½“æ—¶æˆ´é“­å¿ƒé‡Œå¯¹ç”»ç”»çš„æ¸´æœ›ï¼Œå‡ ä¹é™åˆ°äº†å†°ç‚¹ï¼Œå¯¹äºç”»ç”»çš„å…´è¶£ä¹Ÿå°±æ­¤æç½®ã€‚</p>
<p>ç›´åˆ°å…­å¹´çº§çš„ä¸€æ¬¡ç¾æœ¯ä½œä¸šï¼Œå¹³æ—¶é…·çˆ±çœ‹æ¼«ç”»çš„æˆ´é“­ï¼Œæ‰å†ä¸€æ¬¡ä¸‹å®šå†³å¿ƒæŠŠè‡ªå·±å–œæ¬¢çš„è§’è‰²æ¬åˆ°çº¸ä¸Šã€‚</p>
<p>â€œåŒå­¦éƒ½è¯´ç”»çš„å¤ªåƒäº†ï¼Œé‚£ç§è¢«å†æ¬¡è‚¯å®šçš„å¼€å¿ƒï¼Œå¾ˆéš¾å¿˜è®°ã€‚â€</p>
<p><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/21.jpg" alt=""></p>
<p>åæ¥æ•´ä¸ªåˆä¸­ï¼Œæˆ´é“­éƒ½åœ¨è¯¾ä½™æ—¶é—´ç”»æ¼«ç”»ï¼Œä¹Ÿæ²¡å†æŠ¥ç­ï¼Œä¸€ç›´åˆ°åˆä¸­æ¯•ä¸šæˆ´é“­è·Ÿçˆ¶äº²è¯´ä¸æƒ³ä¸Šå­¦äº†ï¼Œâ€œæƒ³å»ç”»æ¼«ç”»ï¼Œåšä¸€åæ¼«ç”»å®¶â€ã€‚ä¸éš¾é¢„æ–™ï¼Œè¿™ä¸ªæƒ³æ³•å¹¶æ²¡æœ‰å¾—åˆ°çˆ¶äº²çš„æ”¯æŒï¼Œâ€œå½“æ¼«ç”»å®¶ï¼Œå¯èƒ½è¿é¥­éƒ½åƒä¸é¥±â€ã€‚</p>
<p>ä½†ä»æˆ´é“­çš„è¯è¯­ä¸­ï¼Œå¹¶æ²¡æœ‰å› ä¸ºçˆ¶äº²è¿™æ¬¡é€‰æ‹©è€Œå¬åˆ°ä¸æ¯«æ°”é¦ï¼Œä¼¼ä¹å¿ƒé‡Œçš„ç§å­å·²ç»ç”Ÿæ ¹ã€‚</p>
<p>â€œå…´è¶£ä¸æ˜¯è¯´å–œæ¬¢æ¼«ç”»ï¼Œå°±è¦å»ä»äº‹æ¼«ç”»ã€‚å½“æˆ‘ä»¬ä»è¢«åŠ¨çš„è¡Œä¸ºä¸­è·å¾—æˆå°±æ„Ÿæ—¶ï¼Œä¹Ÿä¼šåœ¨æ— å½¢ä¸­åŸ¹å…»å‡ºå…´è¶£ï¼Œç”»ç”»å¦‚æ­¤ï¼Œç¼–ç¨‹ä¹Ÿæ˜¯ä¸€æ ·ã€‚â€œ</p>
<h3 id="â€œæˆ‘ä¸æƒ³è®©è‡ªå·±æŠ•å…¥äº†ç”Ÿå‘½çš„çƒ­çˆ±ï¼Œåœæ»ä¸å‰ã€‚â€"><a href="#â€œæˆ‘ä¸æƒ³è®©è‡ªå·±æŠ•å…¥äº†ç”Ÿå‘½çš„çƒ­çˆ±ï¼Œåœæ»ä¸å‰ã€‚â€" class="headerlink" title="â€œæˆ‘ä¸æƒ³è®©è‡ªå·±æŠ•å…¥äº†ç”Ÿå‘½çš„çƒ­çˆ±ï¼Œåœæ»ä¸å‰ã€‚â€"></a>â€œæˆ‘ä¸æƒ³è®©è‡ªå·±æŠ•å…¥äº†ç”Ÿå‘½çš„çƒ­çˆ±ï¼Œåœæ»ä¸å‰ã€‚â€</h3><p>â€œä»é‚£åæ¥ï¼Œå°±ä¸€ç›´åœ¨åšæŒç”»ç”»äº†ã€‚â€</p>
<p>ä»ä¸´æ‘¹ç®€å•çš„æ¼«ç”»ï¼Œåˆ°æ›´å¤æ‚çš„ç”»é£ã€æ›´å¤šå…ƒçš„è§’è‰²ï¼Œå†åˆ°ä¸´æ‘¹å†™å®äººç‰©ã€å½±è§†å‰§ç…§ï¼ŒæœŸé—´è¿˜ä¸“é—¨è‡ªå­¦è¿‡ç´ æï¼Œç›´åˆ°ç°åœ¨çš„å†åˆ›ä½œï¼Œæˆ´é“­é™¤äº†æŠŠè‡ªå·±çš„çˆ±å¥½å’Œå›å¿†ç”»å‡ºæ¥ï¼Œè¿˜æŠŠè‡ªå·±çš„ä¸“ä¸šå†…å®¹åšæˆæ¼«ç”»ï¼Œç”¨æ›´å®¹æ˜“ä¼ è¾¾çš„æ–¹å¼å»åšæ¯ä¸€æ¬¡æŠ€æœ¯åˆ†äº«ã€‚</p>
<p>â€œå¤§æ¦‚æ˜¯ä»å››ã€äº”å¹´å‰å¼€å§‹ï¼Œç©ºé—²çš„æ—¶å€™ä¼šèŠ±å¾ˆé•¿çš„æ—¶é—´ç”»ç”»ï¼Œå¹³æ—¶æ¯å¤©ä¹Ÿä¼šæŒ¤å‡ºä¸€ä¸ªå¤šå°æ—¶åšæŒç»ƒæ‰‹ï¼Œå› ä¸ºæˆ‘ä¸å¸Œæœ›è‡ªå·±çƒ­çˆ±çš„ä¸œè¥¿ï¼Œåœæ»ä¸å‰ï¼Œå…´è¶£ä¸è¯¥åªæ˜¯å…´è¶£è€Œå·²ã€‚â€</p>
<p>åæ¥æˆ´é“­æ¥è§¦äº†æ•°ç»˜ï¼Œå°±å¼€å§‹æŠŠå¾ˆå¤šåˆ›ä½œç•™åœ¨å±å¹•ä¸Šã€‚</p>
<p>â€œç”¨ ipad ç”»ï¼Œæ›´é€‚åˆæˆ‘ç°åœ¨çš„è§’è‰²ï¼Œå› ä¸ºå¯ä»¥éšæ—¶å¼€å§‹å’Œç»“æŸï¼Œä¸å—ç¯å¢ƒå’Œå·¥å…·çš„å½±å“ï¼Œå¦ä¸€æ–¹é¢æ•°å­—ç»˜å›¾ä¹Ÿè®©ä»–çš„ä½œå“åœ¨è‰²å½©æ–¹é¢ï¼Œæœ‰äº†æ›´å¤šçš„æå‡ç©ºé—´ã€‚â€</p>
<p><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/22.jpg" alt=""></p>
<p>ä»å®¹åœ°æå‡ºå¹³æ¿ï¼Œåªè¦è‡ªå·±æƒ³ï¼Œå°±èƒ½éšæ—¶è¿˜åŸå‘¨é­çš„ä¸€åˆ‡ã€‚è¿™ç§æ„Ÿè§‰ï¼Œå°±è·Ÿæˆ´é“­çœ‹å¾…ç¨‹åºå‘˜æ—¶çš„è¡¨è¾¾ä¸€æ ·ï¼Œâ€œéƒ½æ˜¯å¾ˆé…·çš„äº‹æƒ…ï¼Œå› ä¸ºæ— è®ºç¨‹åºå‘˜çš„äººè¿˜æ˜¯è‰ºæœ¯å®¶ï¼Œä»–ä»¬éƒ½åœ¨åˆ›é€ æ–°çš„äº‹ç‰©ï¼Œä»…è¿™ä¸€ç‚¹ï¼Œå°±å€¼å¾—è¢«è‚¯å®šã€‚â€</p>
<h3 id="â€œå·¥ä½œä¸ç”¨å¿ƒçš„äººï¼Œç”Ÿæ´»ä¹Ÿä¸ä¼šå¤ªç²¾å½©â€"><a href="#â€œå·¥ä½œä¸ç”¨å¿ƒçš„äººï¼Œç”Ÿæ´»ä¹Ÿä¸ä¼šå¤ªç²¾å½©â€" class="headerlink" title="â€œå·¥ä½œä¸ç”¨å¿ƒçš„äººï¼Œç”Ÿæ´»ä¹Ÿä¸ä¼šå¤ªç²¾å½©â€"></a>â€œå·¥ä½œä¸ç”¨å¿ƒçš„äººï¼Œç”Ÿæ´»ä¹Ÿä¸ä¼šå¤ªç²¾å½©â€</h3><p>ç±»ä¼¼ç”»ç”»è¿™ç§éœ€è¦å¤§é‡æ—¶é—´å»â€œç†¬â€çš„çˆ±å¥½ï¼ŒåšæŒæ€»æ˜¯æœ€éš¾çš„éƒ¨åˆ†ã€‚</p>
<p>â€œæ—¶é—´æ°¸è¿œéƒ½æ˜¯ç´§ç¼ºçš„ï¼Œè¿™æ˜¯è‚¯å®šã€‚å¦‚æœå·¥ä½œå¾ˆå¿™ï¼Œå°±å…ˆæŠŠæ—¶é—´å…¨éƒ¨æŠ•å…¥åˆ°å·¥ä½œä¸Šï¼Œç”¨æœ€å¿«çš„é€Ÿåº¦åšå¥½ã€åšå®Œï¼Œæ‰èƒ½æœ‰æ›´å¤šçš„ç²¾åŠ›å’Œå¿ƒæƒ…å»åšå…¶ä»–äº‹æƒ…â€ã€‚</p>
<p>æˆ´é“­ä¸Šä¸€ä»½å·¥ä½œåœ¨æ»´æ»´ï¼Œåˆšå…¥èŒå°±å¸Œæœ›æ‹“å®½è‡ªå·±çš„èƒ½åŠ›èŒƒå›´ï¼Œå‡ ä¹æ‰¿æ‹…æ•´ä¸ªéƒ¨é—¨çš„ç ”å‘ä»»åŠ¡ï¼Œåæ¥ä¸´è¿‘å‘ç‰ˆ Bug å®åœ¨è§£ä¸å®Œï¼Œç¬¬äºŒå¤©æ¥å…¬å¸å‘ç°éƒ½è¢«é¢†å¯¼é»˜é»˜è§£æ‰äº†ï¼Œæ‰æ„è¯†åˆ°ä¸€ä¸ªäººçš„åŠ›é‡å§‹ç»ˆæœ‰é™ï¼Œâ€œä¸€ä¸ªæ‰‹æŒ‡ï¼Œè‚¯å®šæ¯”ä¸è¿‡ä¸€ä¸ªæ‹³å¤´çš„åŠ›é‡ã€‚â€</p>
<p>å³ä¾¿å¦‚æ­¤ï¼Œæˆ´é“­ä¹Ÿå§‹ç»ˆä¿æŒç€å¯¹å·¥ä½œçš„çƒ­è¡€ï¼Œå½“æ—¶é—´ä¸å¤Ÿç”¨çš„æ—¶å€™ï¼Œä»–ä¼šæ¢ä¸ªè§’åº¦å»çœ‹å¾…é—®é¢˜ã€‚</p>
<p>â€œæˆ‘è§‰å¾—å·¥ä½œä¸Šé¢ä¸ä¸Šå¿ƒã€ä¸æ‹¼å‘½çš„äººï¼Œç”Ÿæ´»ä¹Ÿä¸ä¼šå¤ªç²¾å½©ã€‚å·¥ä½œæ˜¯è·Ÿæ¯ä¸ªäººçš„ä¸€ç”Ÿåˆ‡å®ç›¸å…³çš„äº‹æƒ…ï¼Œå¦‚æœè¿è¿™ä¸ªéƒ½åšä¸å¥½ï¼Œåˆå¦‚ä½•èƒ½åœ¨å…¶ä»–äº‹æƒ…ä¸Šæ›´ç”¨å¿ƒçš„ç»è¥ï¼Ÿâ€</p>
<p><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/23.jpg" alt=""></p>
<p>æ—¶é—´çœ‹é€äº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯åšæŒã€‚</p>
<p>å½“èŠåˆ°åšæŒçš„åŸåŠ¨åŠ›æ—¶ï¼Œé™¤äº†ç”¨å›å¿†å’Œåˆ†äº«å»æ¨åŠ¨è‡ªå·±ï¼Œåœ¨æˆ´é“­èº«ä¸Šæ€»æ•£å‘ç€ä¸€è‚¡åŠ²å„¿ã€‚ä¸€ä¸ªå…´è¶£çˆ±å¥½è€Œå·²ï¼Œè°ˆä¿¡å¿µå¯èƒ½è¿‡äºæ‚²å£®ï¼Œæ‰€ä»¥ä»–è®¤ä¸ºï¼Œè¿™è‚¡åŠ²å„¿æ›´åƒæ˜¯å†³å¿ƒå’Œæ‰§å¿µã€‚</p>
<p>æœ‰åˆšå…¥è¿›å…¥æ»´æ»´æ—¶ï¼Œæƒ³è‚©æ‰›æ‰€æœ‰å·¥ä½œçš„æ‰§å¿µï¼›</p>
<p>æœ‰ä¸ºäº†å…´è¶£ä¸Šä¸€ä¸ªå°é˜¶ï¼ŒåŠªåŠ›è·å¾—å¤®ç¾æœ‹å‹è‚¯å®šçš„æ‰§å¿µï¼›</p>
<p>ä¹Ÿæœ‰æ€•è‡ªå·±çš„ä½œå“ç ´åäº†å¿ƒä¸­çš„å®Œç¾è§’è‰²ï¼Œé‡å¤æ‰“ç£¨çš„æ‰§å¿µã€‚</p>
<h3 id="ç»“å°¾"><a href="#ç»“å°¾" class="headerlink" title="ç»“å°¾"></a>ç»“å°¾</h3><p>æˆ´é“­æ˜¯å¾ˆå¼ºå¤§çš„äººï¼Œä»–è®²è¿‡çš„ä¸€æ®µè¯ä»¤äººå°è±¡æ·±åˆ»ï¼š</p>
<p>â€œå¹¸ç¦æ˜¯é¢å¯¹è¿‡å»ï¼Œææƒ§æ˜¯é¢å¯¹æœªçŸ¥çš„æœªæ¥ã€‚æˆ‘ä¹Ÿå¿˜è®°æ˜¯ä»å“ªé‡Œçœ‹åˆ°çš„è¿™å¥è¯ï¼Œä½†æˆ‘è‡ªå·±ä¼šè¿™æ ·ç†è§£ï¼šå›å¿†æ˜¯è®©äººå¹¸ç¦çš„ï¼ŒæœªçŸ¥æ˜¯ä»¤äººææƒ§çš„ã€‚ä½†å¦‚æœæˆ‘ä»¬æ²‰æ¹åœ¨å›å¿†ä¸­ä¸æ•¢é¢å¯¹æœªæ¥ï¼Œå¹¸ç¦å§‹ç»ˆæ˜¯æœ‰é™çš„ï¼Œå½“æˆ‘ä»¬ç”¨å†³å¿ƒå»é¢å¯¹æœªæ¥ï¼Œå¹¸ç¦å°±ä¼šè¶Šæ¥è¶Šå¤šï¼Œææƒ§ä¹Ÿä¼šè¶Šæ¥è¶Šå°‘ã€‚â€</p>
<p>è£¹ç€å†³å¿ƒè¿™æŠŠåˆ©å‰‘ï¼Œé…·é…·çš„æˆ´é“­å°±è¿™æ ·ç”¨ä»£ç å’Œç”»ç¬”å‹¾å‹’ç€è‡ªå·±çš„ä¸€ç”Ÿï¼Œè€Œç”»å·å±•å¼€çš„éƒ¨åˆ†å°±å·²ç»è¶³å¤Ÿç²¾å½©ï¼Œä½™ä¸‹çš„ï¼Œå®šä¼šæ›´å€¼å¾—æœŸå¾…ã€‚</p>
<p><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/20.jpg" alt=""></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;åœ¨å¿«æ‰‹åšåˆ†äº«&quot;&gt;&lt;a href=&quot;#åœ¨å¿«æ‰‹åšåˆ†äº«&quot; class=&quot;headerlink&quot; title=&quot;åœ¨å¿«æ‰‹åšåˆ†äº«&quot;&gt;&lt;/a&gt;åœ¨å¿«æ‰‹åšåˆ†äº«&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;/uploads/kuaishou-unused-class-swiftui-note-
    
    </summary>
    
      <category term="Programming" scheme="http://ming1016.github.io/categories/Programming/"/>
    
    
      <category term="iOS" scheme="http://ming1016.github.io/tags/iOS/"/>
    
      <category term="Swift" scheme="http://ming1016.github.io/tags/Swift/"/>
    
      <category term="SwiftUI" scheme="http://ming1016.github.io/tags/SwiftUI/"/>
    
  </entry>
  
  <entry>
    <title>æ—¥æœ¬æ¸¸ç©</title>
    <link href="http://ming1016.github.io/2019/12/28/japan-travel/"/>
    <id>http://ming1016.github.io/2019/12/28/japan-travel/</id>
    <published>2019-12-28T01:21:26.000Z</published>
    <updated>2021-04-11T14:42:09.923Z</updated>
    
    <content type="html"><![CDATA[<ol>
<li>ä»ç¾½ç”°æœºåœºåˆ°é…’åº—</li>
<li>ç§‹å¶åŸ</li>
<li>ä»é“¶åº§å›é…’åº—</li>
<li>æµ…è‰å¯º</li>
<li>æ–°å®¿</li>
<li>æ¶‰è°·</li>
<li>è—¤å­ä¸äºŒé›„åšç‰©é¦†</li>
<li>é•°ä»“</li>
<li>å°åœº</li>
<li>ä¸œäº¬è¿ªæ–¯å°¼æµ·æ´‹</li>
<li>å¤§é˜ª</li>
<li>å¤§é˜ªç¯çƒå½±åŸ</li>
<li>å¤§é˜ªæµ·æ´‹é¦†</li>
<li>äº¬éƒ½æ™´é¸­æ¥¼</li>
<li>æ¸…æ°´å¯º</li>
<li>æ™´ç©ºå¡”</li>
<li>å±±é¹°å¸‚</li>
<li>ä¸œäº¬è¿ªæ–¯å°¼</li>
<li>ä¸‹åŒ—æ³½</li>
<li>ä¸œäº¬çš‡å®«</li>
<li>ä¸Šé‡ Mandarake</li>
<li>è¡¨å‚é“</li>
<li>å‰ç¥¥å¯º</li>
<li>äº¬éƒ½ç«™</li>
<li>å²šå±±</li>
<li>äº¬éƒ½å›½é™…æ¼«ç”»åšç‰©é¦†</li>
<li>å¤§é˜ªåŸ</li>
<li>é“é¡¿æ˜</li>
</ol>
<p><img src="/uploads/japan-travel/01.JPG" alt=""><br><img src="/uploads/japan-travel/02.JPG" alt=""><br><img src="/uploads/japan-travel/03.JPG" alt=""><br><img src="/uploads/japan-travel/04.JPG" alt=""><br><img src="/uploads/japan-travel/05.JPG" alt=""><br><img src="/uploads/japan-travel/06.JPG" alt=""><br><img src="/uploads/japan-travel/07.JPG" alt=""><br><img src="/uploads/japan-travel/08.JPG" alt=""><br><img src="/uploads/japan-travel/09.JPG" alt=""><br><img src="/uploads/japan-travel/10.JPG" alt=""></p>
<p><img src="/uploads/japan-travel/11.JPG" alt=""><br><img src="/uploads/japan-travel/12.JPG" alt=""><br><img src="/uploads/japan-travel/13.JPG" alt=""><br><img src="/uploads/japan-travel/14.JPG" alt=""><br><img src="/uploads/japan-travel/15.JPG" alt=""><br><img src="/uploads/japan-travel/16.JPG" alt=""><br><img src="/uploads/japan-travel/17.JPG" alt=""><br><img src="/uploads/japan-travel/18.JPG" alt=""><br><img src="/uploads/japan-travel/19.JPG" alt=""><br><img src="/uploads/japan-travel/20.JPG" alt=""></p>
<p><img src="/uploads/japan-travel/21.JPG" alt=""><br><img src="/uploads/japan-travel/22.JPG" alt=""><br><img src="/uploads/japan-travel/23.JPG" alt=""><br><img src="/uploads/japan-travel/24.JPG" alt=""><br><img src="/uploads/japan-travel/25.JPG" alt=""><br><img src="/uploads/japan-travel/26.JPG" alt=""><br><img src="/uploads/japan-travel/27.JPG" alt=""><br><img src="/uploads/japan-travel/28.JPG" alt=""><br><img src="/uploads/japan-travel/29.JPG" alt=""><br><img src="/uploads/japan-travel/30.JPG" alt=""></p>
<p><img src="/uploads/japan-travel/31.JPG" alt=""><br><img src="/uploads/japan-travel/32.JPG" alt=""><br><img src="/uploads/japan-travel/33.JPG" alt=""><br><img src="/uploads/japan-travel/34.JPG" alt=""><br><img src="/uploads/japan-travel/35.JPG" alt=""><br><img src="/uploads/japan-travel/36.JPG" alt=""><br><img src="/uploads/japan-travel/37.JPG" alt=""><br><img src="/uploads/japan-travel/38.JPG" alt=""><br><img src="/uploads/japan-travel/39.JPG" alt=""><br><img src="/uploads/japan-travel/40.JPG" alt=""></p>
<p><img src="/uploads/japan-travel/41.JPG" alt=""><br><img src="/uploads/japan-travel/42.JPG" alt=""><br><img src="/uploads/japan-travel/43.JPG" alt=""><br><img src="/uploads/japan-travel/44.JPG" alt=""><br><img src="/uploads/japan-travel/45.JPG" alt=""><br><img src="/uploads/japan-travel/46.JPG" alt=""><br><img src="/uploads/japan-travel/47.JPG" alt=""><br><img src="/uploads/japan-travel/48.JPG" alt=""><br><img src="/uploads/japan-travel/49.JPG" alt=""><br><img src="/uploads/japan-travel/50.JPG" alt=""></p>
<p><img src="/uploads/japan-travel/51.JPG" alt=""><br><img src="/uploads/japan-travel/52.JPG" alt=""><br><img src="/uploads/japan-travel/53.JPG" alt=""><br><img src="/uploads/japan-travel/54.JPG" alt=""><br><img src="/uploads/japan-travel/55.JPG" alt=""><br><img src="/uploads/japan-travel/56.JPG" alt=""><br><img src="/uploads/japan-travel/57.JPG" alt=""><br><img src="/uploads/japan-travel/58.JPG" alt=""><br><img src="/uploads/japan-travel/59.JPG" alt=""><br><img src="/uploads/japan-travel/60.JPG" alt=""></p>
<p><img src="/uploads/japan-travel/61.JPG" alt=""><br><img src="/uploads/japan-travel/62.JPG" alt=""><br><img src="/uploads/japan-travel/63.JPG" alt=""><br><img src="/uploads/japan-travel/64.JPG" alt=""><br><img src="/uploads/japan-travel/65.JPG" alt=""><br><img src="/uploads/japan-travel/66.JPG" alt=""><br><img src="/uploads/japan-travel/67.JPG" alt=""><br><img src="/uploads/japan-travel/68.JPG" alt=""><br><img src="/uploads/japan-travel/69.JPG" alt=""></p>
<p><img src="/uploads/japan-travel/70.JPG" alt=""><br><img src="/uploads/japan-travel/71.JPG" alt=""><br><img src="/uploads/japan-travel/72.JPG" alt=""><br><img src="/uploads/japan-travel/73.JPG" alt=""><br><img src="/uploads/japan-travel/74.JPG" alt=""><br><img src="/uploads/japan-travel/75.JPG" alt=""><br><img src="/uploads/japan-travel/76.JPG" alt=""><br><img src="/uploads/japan-travel/77.JPG" alt=""><br><img src="/uploads/japan-travel/78.JPG" alt=""><br><img src="/uploads/japan-travel/79.JPG" alt=""></p>
<p><img src="/uploads/japan-travel/80.JPG" alt=""><br><img src="/uploads/japan-travel/81.JPG" alt=""><br><img src="/uploads/japan-travel/82.JPG" alt=""><br><img src="/uploads/japan-travel/83.JPG" alt=""><br><img src="/uploads/japan-travel/84.JPG" alt=""><br><img src="/uploads/japan-travel/85.JPG" alt=""><br><img src="/uploads/japan-travel/86.JPG" alt=""><br><img src="/uploads/japan-travel/87.JPG" alt=""><br><img src="/uploads/japan-travel/88.JPG" alt=""><br><img src="/uploads/japan-travel/89.JPG" alt=""></p>
<p><img src="/uploads/japan-travel/90.JPG" alt=""><br><img src="/uploads/japan-travel/91.JPG" alt=""><br><img src="/uploads/japan-travel/92.JPG" alt=""><br><img src="/uploads/japan-travel/93.JPG" alt=""><br><img src="/uploads/japan-travel/94.JPG" alt=""><br><img src="/uploads/japan-travel/95.JPG" alt=""><br><img src="/uploads/japan-travel/96.JPG" alt=""><br><img src="/uploads/japan-travel/97.JPG" alt=""><br><img src="/uploads/japan-travel/98.JPG" alt=""><br><img src="/uploads/japan-travel/99.JPG" alt=""></p>
<p><img src="/uploads/japan-travel/100.JPG" alt=""><br><img src="/uploads/japan-travel/101.JPG" alt=""><br><img src="/uploads/japan-travel/102.JPG" alt=""><br><img src="/uploads/japan-travel/103.JPG" alt=""><br><img src="/uploads/japan-travel/104.JPG" alt=""><br><img src="/uploads/japan-travel/105.JPG" alt=""><br><img src="/uploads/japan-travel/106.JPG" alt=""><br><img src="/uploads/japan-travel/107.JPG" alt=""><br><img src="/uploads/japan-travel/108.JPG" alt=""><br><img src="/uploads/japan-travel/109.JPG" alt=""></p>
<p><img src="/uploads/japan-travel/110.JPG" alt=""><br><img src="/uploads/japan-travel/111.JPG" alt=""><br><img src="/uploads/japan-travel/112.JPG" alt=""><br><img src="/uploads/japan-travel/113.JPG" alt=""><br><img src="/uploads/japan-travel/114.JPG" alt=""><br><img src="/uploads/japan-travel/115.JPG" alt=""><br><img src="/uploads/japan-travel/116.JPG" alt=""><br><img src="/uploads/japan-travel/117.JPG" alt=""><br><img src="/uploads/japan-travel/118.JPG" alt=""><br><img src="/uploads/japan-travel/119.JPG" alt=""></p>
<p><img src="/uploads/japan-travel/120.JPG" alt=""><br><img src="/uploads/japan-travel/121.JPG" alt=""><br><img src="/uploads/japan-travel/122.JPG" alt=""><br><img src="/uploads/japan-travel/123.JPG" alt=""><br><img src="/uploads/japan-travel/124.JPG" alt=""><br><img src="/uploads/japan-travel/125.JPG" alt=""><br><img src="/uploads/japan-travel/126.JPG" alt=""><br><img src="/uploads/japan-travel/127.JPG" alt=""><br><img src="/uploads/japan-travel/128.JPG" alt=""><br><img src="/uploads/japan-travel/129.JPG" alt=""></p>
<p><img src="/uploads/japan-travel/130.JPG" alt=""><br><img src="/uploads/japan-travel/131.JPG" alt=""><br><img src="/uploads/japan-travel/132.JPG" alt=""><br><img src="/uploads/japan-travel/133.JPG" alt=""><br><img src="/uploads/japan-travel/134.JPG" alt=""><br><img src="/uploads/japan-travel/135.JPG" alt=""><br><img src="/uploads/japan-travel/136.JPG" alt=""><br><img src="/uploads/japan-travel/137.JPG" alt=""><br><img src="/uploads/japan-travel/138.JPG" alt=""><br><img src="/uploads/japan-travel/139.JPG" alt=""></p>
<p><img src="/uploads/japan-travel/140.JPG" alt=""><br><img src="/uploads/japan-travel/141.JPG" alt=""><br><img src="/uploads/japan-travel/142.JPG" alt=""><br><img src="/uploads/japan-travel/143.JPG" alt=""><br><img src="/uploads/japan-travel/144.JPG" alt=""><br><img src="/uploads/japan-travel/145.JPG" alt=""><br><img src="/uploads/japan-travel/146.JPG" alt=""><br><img src="/uploads/japan-travel/147.JPG" alt=""><br><img src="/uploads/japan-travel/148.JPG" alt=""><br><img src="/uploads/japan-travel/149.JPG" alt=""></p>
<p><img src="/uploads/japan-travel/150.JPG" alt=""><br><img src="/uploads/japan-travel/151.JPG" alt=""><br><img src="/uploads/japan-travel/152.JPG" alt=""><br><img src="/uploads/japan-travel/153.JPG" alt=""><br><img src="/uploads/japan-travel/154.JPG" alt=""><br><img src="/uploads/japan-travel/155.JPG" alt=""><br><img src="/uploads/japan-travel/156.JPG" alt=""><br><img src="/uploads/japan-travel/157.JPG" alt=""><br><img src="/uploads/japan-travel/158.JPG" alt=""><br><img src="/uploads/japan-travel/159.JPG" alt=""></p>
<p><img src="/uploads/japan-travel/160.JPG" alt=""><br><img src="/uploads/japan-travel/161.JPG" alt=""><br><img src="/uploads/japan-travel/162.JPG" alt=""><br><img src="/uploads/japan-travel/163.JPG" alt=""><br><img src="/uploads/japan-travel/164.JPG" alt=""><br><img src="/uploads/japan-travel/165.JPG" alt=""><br><img src="/uploads/japan-travel/166.JPG" alt=""><br><img src="/uploads/japan-travel/167.JPG" alt=""><br><img src="/uploads/japan-travel/168.JPG" alt=""><br><img src="/uploads/japan-travel/169.JPG" alt=""></p>
<p><img src="/uploads/japan-travel/170.JPG" alt=""><br><img src="/uploads/japan-travel/171.JPG" alt=""><br><img src="/uploads/japan-travel/172.JPG" alt=""><br><img src="/uploads/japan-travel/173.JPG" alt=""><br><img src="/uploads/japan-travel/174.JPG" alt=""><br><img src="/uploads/japan-travel/175.JPG" alt=""><br><img src="/uploads/japan-travel/176.JPG" alt=""><br><img src="/uploads/japan-travel/177.JPG" alt=""><br><img src="/uploads/japan-travel/178.JPG" alt=""><br><img src="/uploads/japan-travel/179.JPG" alt=""></p>
<p><img src="/uploads/japan-travel/180.JPG" alt=""><br><img src="/uploads/japan-travel/181.JPG" alt=""><br><img src="/uploads/japan-travel/182.JPG" alt=""><br><img src="/uploads/japan-travel/183.JPG" alt=""><br><img src="/uploads/japan-travel/184.JPG" alt=""><br><img src="/uploads/japan-travel/185.JPG" alt=""><br><img src="/uploads/japan-travel/186.JPG" alt=""><br><img src="/uploads/japan-travel/187.JPG" alt=""><br><img src="/uploads/japan-travel/188.JPG" alt=""><br><img src="/uploads/japan-travel/189.JPG" alt=""></p>
<p><img src="/uploads/japan-travel/190.JPG" alt=""><br><img src="/uploads/japan-travel/191.JPG" alt=""><br><img src="/uploads/japan-travel/192.JPG" alt=""><br><img src="/uploads/japan-travel/193.JPG" alt=""><br><img src="/uploads/japan-travel/194.JPG" alt=""><br><img src="/uploads/japan-travel/195.JPG" alt=""><br><img src="/uploads/japan-travel/196.JPG" alt=""><br><img src="/uploads/japan-travel/197.JPG" alt=""><br><img src="/uploads/japan-travel/198.JPG" alt=""><br><img src="/uploads/japan-travel/199.JPG" alt=""></p>
<p><img src="/uploads/japan-travel/200.JPG" alt=""><br><img src="/uploads/japan-travel/201.JPG" alt=""><br><img src="/uploads/japan-travel/202.JPG" alt=""><br><img src="/uploads/japan-travel/203.JPG" alt=""><br><img src="/uploads/japan-travel/204.JPG" alt=""><br><img src="/uploads/japan-travel/205.JPG" alt=""><br><img src="/uploads/japan-travel/206.JPG" alt=""><br><img src="/uploads/japan-travel/207.JPG" alt=""><br><img src="/uploads/japan-travel/208.JPG" alt=""><br><img src="/uploads/japan-travel/209.JPG" alt=""></p>
<p><img src="/uploads/japan-travel/210.JPG" alt=""><br><img src="/uploads/japan-travel/211.JPG" alt=""><br><img src="/uploads/japan-travel/212.JPG" alt=""><br><img src="/uploads/japan-travel/213.JPG" alt=""><br><img src="/uploads/japan-travel/214.JPG" alt=""><br><img src="/uploads/japan-travel/215.JPG" alt=""><br><img src="/uploads/japan-travel/216.JPG" alt=""><br><img src="/uploads/japan-travel/217.JPG" alt=""><br><img src="/uploads/japan-travel/218.JPG" alt=""><br><img src="/uploads/japan-travel/219.JPG" alt=""></p>
<p><img src="/uploads/japan-travel/220.JPG" alt=""><br><img src="/uploads/japan-travel/221.JPG" alt=""><br><img src="/uploads/japan-travel/222.JPG" alt=""><br><img src="/uploads/japan-travel/223.JPG" alt=""><br><img src="/uploads/japan-travel/224.JPG" alt=""><br><img src="/uploads/japan-travel/225.JPG" alt=""><br><img src="/uploads/japan-travel/226.JPG" alt=""><br><img src="/uploads/japan-travel/227.JPG" alt=""><br><img src="/uploads/japan-travel/228.JPG" alt=""><br><img src="/uploads/japan-travel/229.JPG" alt=""></p>
<p><img src="/uploads/japan-travel/230.JPG" alt=""><br><img src="/uploads/japan-travel/231.JPG" alt=""><br><img src="/uploads/japan-travel/232.JPG" alt=""><br><img src="/uploads/japan-travel/233.JPG" alt=""><br><img src="/uploads/japan-travel/234.JPG" alt=""><br><img src="/uploads/japan-travel/235.JPG" alt=""><br><img src="/uploads/japan-travel/236.JPG" alt=""><br><img src="/uploads/japan-travel/237.JPG" alt=""><br><img src="/uploads/japan-travel/238.JPG" alt=""><br><img src="/uploads/japan-travel/239.JPG" alt=""></p>
<p><img src="/uploads/japan-travel/240.JPG" alt=""><br><img src="/uploads/japan-travel/241.JPG" alt=""><br><img src="/uploads/japan-travel/242.JPG" alt=""><br><img src="/uploads/japan-travel/243.JPG" alt=""><br><img src="/uploads/japan-travel/244.JPG" alt=""><br><img src="/uploads/japan-travel/245.JPG" alt=""><br><img src="/uploads/japan-travel/246.JPG" alt=""><br><img src="/uploads/japan-travel/247.JPG" alt=""><br><img src="/uploads/japan-travel/248.JPG" alt=""><br><img src="/uploads/japan-travel/249.JPG" alt=""></p>
<p><img src="/uploads/japan-travel/250.JPG" alt=""><br><img src="/uploads/japan-travel/251.JPG" alt=""><br><img src="/uploads/japan-travel/252.JPG" alt=""><br><img src="/uploads/japan-travel/253.JPG" alt=""><br><img src="/uploads/japan-travel/254.JPG" alt=""><br><img src="/uploads/japan-travel/255.JPG" alt=""><br><img src="/uploads/japan-travel/256.JPG" alt=""><br><img src="/uploads/japan-travel/257.JPG" alt=""><br><img src="/uploads/japan-travel/258.JPG" alt=""><br><img src="/uploads/japan-travel/259.JPG" alt=""></p>
<p><img src="/uploads/japan-travel/260.JPG" alt=""><br><img src="/uploads/japan-travel/261.JPG" alt=""><br><img src="/uploads/japan-travel/262.JPG" alt=""><br><img src="/uploads/japan-travel/263.JPG" alt=""><br><img src="/uploads/japan-travel/264.JPG" alt=""><br><img src="/uploads/japan-travel/265.JPG" alt=""><br><img src="/uploads/japan-travel/266.JPG" alt=""><br><img src="/uploads/japan-travel/267.JPG" alt=""><br><img src="/uploads/japan-travel/268.JPG" alt=""><br><img src="/uploads/japan-travel/269.JPG" alt=""></p>
<p><img src="/uploads/japan-travel/270.JPG" alt=""></p>
]]></content>
    
    <summary type="html">
    
      &lt;ol&gt;
&lt;li&gt;ä»ç¾½ç”°æœºåœºåˆ°é…’åº—&lt;/li&gt;
&lt;li&gt;ç§‹å¶åŸ&lt;/li&gt;
&lt;li&gt;ä»é“¶åº§å›é…’åº—&lt;/li&gt;
&lt;li&gt;æµ…è‰å¯º&lt;/li&gt;
&lt;li&gt;æ–°å®¿&lt;/li&gt;
&lt;li&gt;æ¶‰è°·&lt;/li&gt;
&lt;li&gt;è—¤å­ä¸äºŒé›„åšç‰©é¦†&lt;/li&gt;
&lt;li&gt;é•°ä»“&lt;/li&gt;
&lt;li&gt;å°åœº&lt;/li&gt;
&lt;li&gt;ä¸œäº¬è¿ªæ–¯å°¼
    
    </summary>
    
      <category term="travel" scheme="http://ming1016.github.io/categories/travel/"/>
    
    
      <category term="Japan" scheme="http://ming1016.github.io/tags/Japan/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•å¯¹ iOS å¯åŠ¨é˜¶æ®µè€—æ—¶è¿›è¡Œåˆ†æ</title>
    <link href="http://ming1016.github.io/2019/12/07/how-to-analyze-startup-time-cost-in-ios/"/>
    <id>http://ming1016.github.io/2019/12/07/how-to-analyze-startup-time-cost-in-ios/</id>
    <published>2019-12-07T01:25:33.000Z</published>
    <updated>2021-04-11T14:42:09.919Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/01.png" alt=""></p>
<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¯åŠ¨ä¼˜åŒ–ä¸€å½¹åï¼Œè¶…é¢„æœŸå°†æ‰€è´Ÿè´£çš„ App åŒç«¯å¯åŠ¨çš„è€—æ—¶éƒ½é™ä½äº†65%ä»¥ä¸Šï¼ŒiOS åœ¨iPhone7ä¸Šé€Ÿåº¦è¾¾åˆ°äº†400æ¯«ç§’ä»¥å†…ã€‚å°±åƒäº§å“ä»¬ç”¨åè¯´çš„ï¼Œå¿«åˆ°ä¸ä¹ æƒ¯ã€‚ç”±äº App æ—¥æ´»ç”¨æˆ·è¿‡äº¿ï¼Œç®—ä¸€ä¸‹æ¯å¤©ä¸ºç”¨æˆ·çœä¸‹çš„æ—¶é—´ï¼Œè¿˜æ˜¯è›®æœ‰æˆå°±æ„Ÿçš„ã€‚</p>
<p><img src="/uploads/how-to-analyze-startup-time-cost-in-ios/01.jpeg" alt=""></p>
<h2 id="å¯åŠ¨é˜¶æ®µæ€§èƒ½å¤šç»´åº¦åˆ†æ"><a href="#å¯åŠ¨é˜¶æ®µæ€§èƒ½å¤šç»´åº¦åˆ†æ" class="headerlink" title="å¯åŠ¨é˜¶æ®µæ€§èƒ½å¤šç»´åº¦åˆ†æ"></a>å¯åŠ¨é˜¶æ®µæ€§èƒ½å¤šç»´åº¦åˆ†æ</h2><p>è¦ä¼˜åŒ–ï¼Œå…ˆè¦åšåˆ°çš„æ˜¯å¯¹å¯åŠ¨é˜¶æ®µå„ä¸ªæ€§èƒ½çº¬åº¦åšåˆ†æï¼ŒåŒ…æ‹¬ä¸»çº¿ç¨‹è€—æ—¶ã€CPUã€å†…å­˜ã€I/Oã€ç½‘ç»œã€‚è¿™æ ·æ‰èƒ½å¤Ÿæ›´åŠ å…¨é¢çš„æŒæ¡å¯åŠ¨é˜¶æ®µçš„å¼€é”€ï¼Œæ‰¾å‡ºä¸åˆç†çš„æ–¹æ³•è°ƒç”¨ã€‚å¯åŠ¨è¶Šå¿«ï¼Œæ›´å¤šçš„æ–¹æ³•è°ƒç”¨å°±åº”è¯¥åšæˆæŒ‰éœ€æ‰§è¡Œï¼Œå°†å¯åŠ¨å‹åŠ›åˆ†æ‘Šï¼Œåªç•™ä¸‹é‚£äº›å¯åŠ¨åæ–¹æ³•éƒ½ä¼šä¾èµ–çš„æ–¹æ³•å’Œåº“çš„åˆå§‹åŒ–ï¼Œæ¯”å¦‚ç½‘ç»œåº“ã€Crash åº“ç­‰ã€‚è€Œå‰©ä¸‹é‚£äº›éœ€è¦é¢„åŠ è½½çš„åŠŸèƒ½å¯ä»¥æ”¾åˆ°å¯åŠ¨é˜¶æ®µåå†æ‰§è¡Œã€‚</p>
<p>å¯åŠ¨æœ‰å“ªå‡ ç§ç±»å‹ï¼Œå¯åŠ¨æœ‰å“ªäº›é˜¶æ®µå‘¢ï¼Ÿ</p>
<p>å¯åŠ¨ç±»å‹åˆ†ä¸ºï¼š</p>
<ul>
<li>Coldï¼šApp é‡å¯åå¯åŠ¨ï¼Œä¸åœ¨å†…å­˜é‡Œä¹Ÿæ²¡æœ‰è¿›ç¨‹å­˜åœ¨ã€‚</li>
<li>Warmï¼šApp æœ€è¿‘ç»“æŸåå†å¯åŠ¨ï¼Œæœ‰éƒ¨åˆ†åœ¨å†…å­˜ä½†æ²¡æœ‰è¿›ç¨‹å­˜åœ¨ã€‚</li>
<li>Resumeï¼šApp æ²¡ç»“æŸï¼Œåªæ˜¯æš‚åœï¼Œå…¨åœ¨å†…å­˜ä¸­ï¼Œè¿›ç¨‹ä¹Ÿå­˜åœ¨ã€‚</li>
</ul>
<p>åˆ†æé˜¶æ®µä¸€èˆ¬éƒ½æ˜¯é’ˆå¯¹ Cold ç±»å‹è¿›è¡Œåˆ†æï¼Œç›®çš„å°±æ˜¯è¦è®©æµ‹è¯•ç¯å¢ƒç¨³å®šã€‚ä¸ºäº†ç¨³å®šæµ‹è¯•ç¯å¢ƒæœ‰æ—¶è¿˜éœ€è¦æ‰¾äº›ç¨³å®šçš„æœºå‹ï¼Œå¯¹äº iOS æ¥è¯´iPhone7æ€§èƒ½ä¸­ç­‰ï¼Œç¨³å®šæ€§ä¹Ÿä¸é”™å°±å¾ˆé€‚åˆï¼ŒAndroid çš„ Vivo ç³»åˆ—ä¹Ÿç›¸å¯¹ç¨³å®šï¼Œåä¸ºå’Œå°ç±³ç³»åˆ—æ•°æ®æ³¢åŠ¨å°±æ¯”è¾ƒå¤§ã€‚é™¤äº†æœºå‹å¤–æ§åˆ¶æµ‹è¯•æœºæ¸©åº¦ä¹Ÿå¾ˆé‡è¦ï¼Œä¸€æ—¦æ¸©åº¦è¿‡é«˜ç³»ç»Ÿè¿˜ä¼šé™é¢‘æ‰§è¡Œå½±å“æµ‹è¯•æ•°æ®ã€‚æœ‰æ—¶å€™è¿˜ä¼šç½®é£è¡Œæ¨¡å¼é‡‡ç”¨ Mock ç½‘ç»œè¯·æ±‚çš„æ–¹å¼æ¥å‡å°‘ä¸ç¨³å®šçš„ç½‘ç»œå½±å“æµ‹è¯•æ•°æ®ã€‚æœ€å¥½æ—¶é‡å¯åé€€ iCloud è´¦å·ï¼Œæ”¾ç½®ä¸€æ®µæ—¶é—´å†æµ‹ï¼Œæ›´åŠ å‡†ç¡®äº›ã€‚</p>
<p><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/05.png" alt=""></p>
<p>äº†è§£å¯åŠ¨çš„é˜¶æ®µç›®çš„å°±æ˜¯èšç„¦èŒƒå›´ï¼Œä»ç”¨æˆ·ä½“éªŒä¸Šæ¥ç¡®å®šå“ªä¸ªé˜¶æ®µè¦å¿«ï¼Œä»¥ä¾¿èƒ½å¤Ÿè®©ç”¨æˆ·å¯è§†å’Œå“åº”ç”¨æˆ·æ“ä½œçš„æ—¶é—´æ›´å¿«ã€‚</p>
<p>ç®€å•æ¥è¯´ iOS å¯åŠ¨åˆ†ä¸ºåŠ è½½ Mach-O å’Œè¿è¡Œæ—¶åˆå§‹åŒ–è¿‡ç¨‹ï¼ŒåŠ è½½ Mach-O ä¼šå…ˆåˆ¤æ–­åŠ è½½çš„æ–‡ä»¶æ˜¯ä¸æ˜¯ Mach-Oï¼Œé€šè¿‡æ–‡ä»¶ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œä¹Ÿå«é­”æ•°æ¥åˆ¤æ–­ï¼Œå½“æ˜¯ä¸‹é¢å››ç§æ—¶å¯ä»¥åˆ¤å®šæ˜¯ Mach-O æ–‡ä»¶ï¼š</p>
<ul>
<li>0xfeedface å¯¹åº”çš„ loader.h é‡Œçš„å®æ˜¯ MH_MAGIC</li>
<li>0xfeedfact å®æ˜¯ MH_MAGIC_64</li>
<li>NXSwapInt(MH_MAGIC) å® MH_GIGAM</li>
<li>NXSwapInt(MH_MAGIC_64) å® MH_GIGAM_64</li>
</ul>
<p>Mach-O åˆ†ä¸ºä¸»è¦åˆ†ä¸º ä¸­é—´å¯¹è±¡æ–‡ä»¶ï¼ˆMH_OBJECTï¼‰ã€å¯æ‰§è¡ŒäºŒè¿›åˆ¶ï¼ˆMH_EXECUTEï¼‰ã€VM å…±äº«åº“æ–‡ä»¶ï¼ˆMH_FVMLIBï¼‰ã€Crash äº§ç”Ÿçš„ Core æ–‡ä»¶ï¼ˆMH_COREï¼‰ã€preloadï¼ˆMH_PRELOADï¼‰ã€åŠ¨æ€å…±äº«åº“ï¼ˆMH_DYLIBï¼‰ã€åŠ¨æ€é“¾æ¥å™¨ï¼ˆMH_DYLINKERï¼‰ã€é™æ€é“¾æ¥æ–‡ä»¶ï¼ˆMH_DYLIB_STUBï¼‰ã€ç¬¦å·æ–‡ä»¶å’Œè°ƒè¯•ä¿¡æ¯ï¼ˆMH_DSYMï¼‰è¿™å‡ ç§ã€‚ç¡®å®šæ˜¯ Mach-O åï¼Œå†…æ ¸ä¼š fork ä¸€ä¸ªè¿›ç¨‹ï¼Œexecve å¼€å§‹åŠ è½½ã€‚æ£€æŸ¥ Mach-O Headerã€‚éšååŠ è½½ dyld å’Œç¨‹åºåˆ° Load Command åœ°å€ç©ºé—´ã€‚é€šè¿‡ dyld_stub_binder å¼€å§‹æ‰§è¡Œ dyldï¼Œdyld ä¼šè¿›è¡Œ rebaseã€bindingã€lazy bindingã€å¯¼å‡ºç¬¦å·ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ DYLD_INSERT_LIBRARIES è¿›è¡Œ hookã€‚dyld_stub_binder ç»™åç§»é‡åˆ° dyld è§£é‡Šç‰¹æ®Šå­—èŠ‚ç  Segment ä¸­ï¼Œä¹Ÿå°±æ˜¯çœŸå®åœ°å€ï¼ŒæŠŠçœŸå®åœ°å€å†™å…¥åˆ° la_symbol_ptr é‡Œï¼Œè·³è½¬æ—¶é€šè¿‡ stub çš„ jump æŒ‡ä»¤è·³è½¬åˆ°çœŸå®åœ°å€ã€‚ dyld åŠ è½½æ‰€æœ‰ä¾èµ–åº“ï¼Œå°†åŠ¨æ€åº“å¯¼å‡ºçš„ trie ç»“æ„ç¬¦å·æ‰§è¡Œç¬¦å·ç»‘å®šï¼Œä¹Ÿå°±æ˜¯ non lazybindingï¼Œç»‘å®šè§£æå…¶ä»–æ¨¡å—åŠŸèƒ½å’Œæ•°æ®å¼•ç”¨è¿‡ç¨‹ï¼Œå°±æ˜¯å¯¼å…¥ç¬¦å·ã€‚</p>
<p>Trie ä¹Ÿå«æ•°å­—æ ‘æˆ–å‰ç¼€æ ‘ï¼Œæ˜¯ä¸€ç§æœç´¢æ ‘ã€‚æŸ¥æ‰¾å¤æ‚åº¦ O(m)ï¼Œm æ˜¯å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚å’Œæ•£åˆ—è¡¨ç›¸æ¯”ï¼Œæ•£åˆ—æœ€å·®å¤æ‚åº¦æ˜¯ O(N)ï¼Œä¸€èˆ¬éƒ½æ˜¯ O(1)ï¼Œç”¨ O(m)æ—¶é—´è¯„ä¼° hashã€‚æ•£åˆ—ç¼ºç‚¹æ˜¯ä¼šåˆ†é…ä¸€å¤§å—å†…å­˜ï¼Œå†…å®¹è¶Šå¤šæ‰€å å†…å­˜è¶Šå¤§ã€‚Trie ä¸ä»…æŸ¥æ‰¾å¿«ï¼Œæ’å…¥å’Œåˆ é™¤éƒ½å¾ˆå¿«ï¼Œé€‚åˆå­˜å‚¨é¢„æµ‹æ€§æ–‡æœ¬æˆ–è‡ªåŠ¨å®Œæˆè¯å…¸ã€‚ä¸ºäº†è¿›ä¸€æ­¥ä¼˜åŒ–æ‰€å ç©ºé—´ï¼Œå¯ä»¥å°† Trie è¿™ç§æ ‘å½¢çš„ç¡®å®šæ€§æœ‰é™è‡ªåŠ¨æœºå‹ç¼©æˆç¡®å®šæ€§éå¾ªç¯æœ‰é™çŠ¶æ€è‡ªåŠ¨ä½“ï¼ˆDAFSAï¼‰ï¼Œå…¶ç©ºé—´å°ï¼Œåšæ³•æ˜¯ä¼šå‹ç¼©ç›¸åŒåˆ†æ”¯ã€‚å¯¹äºæ›´å¤§å†…å®¹ï¼Œè¿˜å¯ä»¥åšæ›´è¿›ä¸€æ­¥çš„ä¼˜åŒ–ï¼Œæ¯”å¦‚ä½¿ç”¨å­—æ¯ç¼©å‡çš„å®ç°æŠ€æœ¯ï¼ŒæŠŠåŸæ¥çš„å­—ç¬¦ä¸²é‡æ–°è§£é‡Šä¸ºè¾ƒé•¿çš„å­—ç¬¦ä¸²ï¼›ä½¿ç”¨å•é“¾å¼åˆ—è¡¨ï¼ŒèŠ‚ç‚¹è®¾è®¡ä¸ºç”±ç¬¦å·ã€å­èŠ‚ç‚¹ã€ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ¥è¡¨ç¤ºï¼›å°†å­—æ¯è¡¨æ•°ç»„å­˜å‚¨ä¸ºä»£è¡¨ ASCII å­—æ¯è¡¨çš„256ä½çš„ä½å›¾ã€‚</p>
<p>å°½ç®¡ Trie å¯¹äºæ€§èƒ½ä¼šåšå¾ˆå¤šä¼˜åŒ–ï¼Œä½†æ˜¯ç¬¦å·è¿‡å¤šä¾ç„¶ä¼šå¢åŠ æ€§èƒ½æ¶ˆè€—ï¼Œå¯¹äºåŠ¨æ€åº“å¯¼å‡ºçš„ç¬¦å·ä¸å®œå¤ªå¤šï¼Œå°½é‡ä¿æŒå…¬å…±ç¬¦å·å°‘ï¼Œç§æœ‰ç¬¦å·é›†ä¸°å¯Œã€‚è¿™æ ·ç»´æŠ¤èµ·æ¥ä¹Ÿæ–¹ä¾¿ï¼Œç‰ˆæœ¬å…¼å®¹æ€§ä¹Ÿå¥½ï¼Œè¿˜èƒ½ä¼˜åŒ–åŠ¨æ€åŠ è½½ç¨‹åºåˆ°è¿›ç¨‹çš„æ—¶é—´ã€‚</p>
<p>ç„¶åæ‰§è¡Œ attribute çš„ constructor å‡½æ•°ã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">__attribute__((constructor))</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, <span class="string">&quot;prepare&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__attribute__((destructor))</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">end</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, <span class="string">&quot;end&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showHeader</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, <span class="string">&quot;header&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ming@mingdeMacBook-Pro macho_demo % ./main <span class="string">&quot;hi&quot;</span></span><br><span class="line">prepare</span><br><span class="line">hi</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œæ—¶åˆå§‹åŒ–è¿‡ç¨‹ åˆ†ä¸ºï¼š</p>
<ul>
<li>åŠ è½½ç±»æ‰©å±•</li>
<li>åŠ è½½ C++é™æ€å¯¹è±¡</li>
<li>è°ƒç”¨+load å‡½æ•°</li>
<li>æ‰§è¡Œ main å‡½æ•°</li>
<li>Application åˆå§‹åŒ–ï¼Œåˆ° applicationDidFinishLaunchingWithOptions æ‰§è¡Œå®Œ</li>
<li>åˆå§‹åŒ–å¸§æ¸²æŸ“ï¼Œåˆ° viewDidAppear æ‰§è¡Œå®Œï¼Œç”¨æˆ·å¯è§å¯æ“ä½œã€‚</li>
</ul>
<p>è¿‡ç¨‹æ¦‚æ‹¬èµ·æ¥å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/02.png" alt=""></p>
<p>ä¹Ÿå°±æ˜¯è¯´å¯¹å¯åŠ¨é˜¶æ®µçš„åˆ†æä»¥ viewDidAppear ä¸ºæˆªæ­¢ã€‚è¿™æ¬¡ä¼˜åŒ–ä¹‹å‰å·²ç»å¯¹ Application åˆå§‹åŒ–ä¹‹å‰åšè¿‡ä¼˜åŒ–ï¼Œæ•ˆæœå¹¶ä¸æ˜æ˜¾ï¼Œæ²¡æœ‰æœ¬è´¨çš„æé«˜ï¼Œæ‰€ä»¥è¿™æ¬¡ä¸»è¦é’ˆå¯¹ Application åˆå§‹åŒ–åˆ° viewDidAppear è¿™ä¸ªé˜¶æ®µå„ä¸ªæ€§èƒ½å¤šçº¬åº¦è¿›è¡Œåˆ†æã€‚å¤šç»´åº¦å…·ä½“åŒ…å«å†…å®¹å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/03.png" alt=""></p>
<p>å·¥å…·çš„é€‰æ‹©å…¶å®ç›®å‰çœ‹æ¥æ˜¯å¾ˆå¤šçš„ï¼ŒApple æä¾›çš„ System Trace ä¼šæä¾›å…¨é¢ç³»ç»Ÿçš„è¡Œä¸ºï¼Œå¯ä»¥æ˜¾ç¤ºåº•å±‚ç³»ç»Ÿçº¿ç¨‹å’Œå†…å­˜è°ƒåº¦æƒ…å†µï¼Œåˆ†æé”ã€çº¿ç¨‹ã€å†…å­˜ã€ç³»ç»Ÿè°ƒç”¨ç­‰é—®é¢˜ã€‚æ€»çš„æ¥è¯´ï¼Œé€šè¿‡ System Trace ä½ èƒ½æ¸…æ¥šçŸ¥é“æ¯æ—¶æ¯åˆ» App å¯¹ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µã€‚</p>
<p>System Trace èƒ½æŸ¥çœ‹çº¿ç¨‹çš„çŠ¶æ€ï¼Œå¯ä»¥äº†è§£é«˜ä¼˜çº¿ç¨‹ä½¿ç”¨ç›¸å¯¹äº CPU æ•°é‡æ˜¯å¦åˆç†ï¼Œå¯ä»¥çœ‹åˆ°çº¿ç¨‹åœ¨æ‰§è¡Œã€æŒ‚èµ·ã€ä¸Šä¸‹æ–‡åˆ‡æ¢ã€è¢«æ‰“æ–­è¿˜æ˜¯è¢«æŠ¢å çš„æƒ…å†µã€‚è™šæ‹Ÿå†…å­˜ä½¿ç”¨äº§ç”Ÿçš„è€—æ—¶ä¹Ÿèƒ½çœ‹åˆ°ï¼Œæ¯”å¦‚åˆ†é…ç‰©ç†å†…å­˜ï¼Œå†…å­˜è§£å‹ç¼©ï¼Œæ— ç¼“å­˜æ—¶è¿›è¡Œç¼“å­˜çš„è€—æ—¶ç­‰ã€‚ç”šè‡³æ˜¯å‘çƒ­æƒ…å†µä¹Ÿèƒ½çœ‹åˆ°ã€‚</p>
<p>System Trace è¿˜æä¾›æ‰‹åŠ¨æ‰“ç‚¹è¿›è¡Œä¿¡æ¯æ˜¾å¼ï¼Œåœ¨ä½ çš„ä»£ç ä¸­ å¯¼å…¥ sys/kdebug_signpost.h åï¼Œé…å¯¹ kdebug_signpost_start å’Œ kdebug_signpost_end å°±å¯ä»¥äº†ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•æœ‰äº”ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ idï¼Œæœ€åä¸€ä¸ªæ˜¯é¢œè‰²ï¼Œä¸­é—´éƒ½æ˜¯é¢„ç•™å­—æ®µã€‚</p>
<p>Xcode11å¼€å§‹ XCTest è¿˜æä¾›äº†æµ‹é‡æ€§èƒ½çš„ Apiã€‚è‹¹æœåœ¨2019å¹´ WWDC å¯åŠ¨ä¼˜åŒ–ä¸“é¢˜ <a href="https://developer.apple.com/videos/play/wwdc2019/423/">Optimizing App Launch - WWDC 2019 - Videos - Apple Developer</a> ä¸Šä¹Ÿä»‹ç»äº† Instruments é‡Œçš„æœ€æ–°æ¨¡æ¿ App launch å¦‚ä½•åˆ†æå¯åŠ¨æ€§èƒ½ã€‚ä½†æ˜¯è¦æƒ³è¾¾åˆ°å¯¹å¯åŠ¨æ•°æ®è¿›è¡Œç•™å­˜å–å‡å€¼ã€Diffã€è¿‡æ»¤ã€å…³è”åˆ†æç­‰è‡ªåŠ¨åŒ–æ“ä½œï¼ŒApp launch ç›®å‰è¿˜æ²¡æ³•åšåˆ°ã€‚</p>
<h3 id="ä¸»çº¿ç¨‹è€—æ—¶"><a href="#ä¸»çº¿ç¨‹è€—æ—¶" class="headerlink" title="ä¸»çº¿ç¨‹è€—æ—¶"></a>ä¸»çº¿ç¨‹è€—æ—¶</h3><p>å¤šä¸ªç»´åº¦æ€§èƒ½çº¬åº¦åˆ†æä¸­æœ€é‡è¦ï¼Œæœ€ç»ˆç”¨æˆ·ä½“æ„Ÿåˆ°çš„æ˜¯ä¸»çº¿ç¨‹è€—æ—¶åˆ†æã€‚å¯¹ä¸»çº¿ç¨‹æ–¹æ³•è€—æ—¶å¯ä»¥ç›´æ¥ä½¿ç”¨<a href="https://everettjf.github.io/2019/05/06/messier/">Messier - ç®€å•æ˜“ç”¨çš„Objective-Cæ–¹æ³•è·Ÿè¸ªå·¥å…· - everettjf - é¦–å…ˆå¾ˆæœ‰è¶£</a><br>ç”Ÿæˆ trace json è¿›è¡Œåˆ†æï¼Œæˆ–è€…å‚çœ‹è¿™ä¸ªä»£ç <a href="https://github.com/ming1016/GCDFetchFeed/blob/master/GCDFetchFeed/GCDFetchFeed/Lib/SMLagMonitor/SMCallTraceCore.c">GCDFetchFeed/SMCallTraceCore.c at master Â· ming1016/GCDFetchFeed Â· GitHub</a>ï¼Œè‡ªå·±æ‰‹åŠ¨ hook objc_msgSend ç”Ÿæˆä¸€ä»½Objective-C æ–¹æ³•è€—æ—¶æ•°æ®è¿›è¡Œåˆ†æã€‚è¿˜æœ‰ç§æ’æ¡©æ–¹å¼ï¼Œå¯ä»¥è§£æ IRï¼ˆåŠ å¿«ç¼–è¯‘é€Ÿåº¦ï¼‰ï¼Œç„¶ååœ¨æ¯ä¸ªæ–¹æ³•å‰åæ’å…¥è€—æ—¶ç»Ÿè®¡å‡½æ•°ã€‚æ–‡ç« åé¢æˆ‘ä¼šç€é‡ä»‹ç»å¦‚ä½•å¼€å‘å·¥å…·è¿›ä¸€æ­¥åˆ†æè¿™ä»½æ•°æ®ï¼Œä»¥è¾¾åˆ°ç›‘æ§å¯åŠ¨é˜¶æ®µæ–¹æ³•è€—æ—¶çš„ç›®çš„ã€‚</p>
<p>hook æ‰€æœ‰çš„æ–¹æ³•è°ƒç”¨ï¼Œå¯¹è¯¦ç»†åˆ†ææ—¶å¾ˆæœ‰ç”¨ï¼Œä¸è¿‡å¯¹äºæ•´ä¸ªå¯åŠ¨æ—¶é—´å½±å“å¾ˆå¤§ï¼Œè¦æƒ³è·å–å¯åŠ¨æ¯ä¸ªé˜¶æ®µæ›´å‡†ç¡®çš„æ—¶é—´æ¶ˆè€—è¿˜éœ€è¦ä¾èµ–æ‰‹åŠ¨åŸ‹ç‚¹ã€‚ä¸ºäº†æ›´å¥½çš„åˆ†æå¯åŠ¨è€—æ—¶é—®é¢˜ï¼Œæ‰‹åŠ¨åŸ‹ç‚¹ä¹Ÿä¼šåŸ‹çš„è¶Šæ¥è¶Šå¤šï¼Œä¹Ÿä¼šå½±å“å¯åŠ¨æ—¶é—´ç²¾ç¡®åº¦ï¼Œç‰¹åˆ«æ˜¯å½“å›¢é˜Ÿå¾ˆå¤šï¼Œæ¨¡å—å¾ˆå¤šæ—¶ï¼Œé—®é¢˜ä¼šçªå‡ºã€‚ä½†ï¼Œæ¯ä¸ªå›¢é˜Ÿåœ¨æ’æŸ¥å¯åŠ¨è€—æ—¶å¾€å¾€åªä¼šå…³æ³¨è‡ªå·±æˆ–ç›¸å…³æŸå‡ ä¸ªæ¨¡å—çš„åˆ†æï¼ŒåŸºäºæ­¤ï¼Œå¯ä»¥æŠŠä¸åŒæ¨¡å—åŸ‹ç‚¹åˆ†ç»„ï¼Œçµæ´»ç»„åˆï¼Œè¿™æ ·å°±å¯ä»¥ç…§é¡¾åˆ°å¤šç§éœ€æ±‚äº†ã€‚</p>
<h3 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h3><p>ä¸ºä»€ä¹ˆåˆ†æå¯åŠ¨æ…¢é™¤äº†åˆ†æä¸»çº¿ç¨‹æ–¹æ³•è€—æ—¶å¤–ï¼Œè¿˜è¦åˆ†æå…¶å®ƒçº¬åº¦çš„æ€§èƒ½å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬å…ˆçœ‹çœ‹å¯åŠ¨æ…¢çš„è¡¨ç°ï¼Œå¯åŠ¨æ…¢æ„å‘³ç€ç•Œé¢å“åº”æ…¢ã€ç½‘ç»œæ…¢ï¼ˆæ•°æ®é‡å¤§ã€è¯·æ±‚æ•°å¤šï¼‰ã€CPU è¶…è´Ÿè·é™é¢‘ï¼ˆå¹¶è¡Œä»»åŠ¡å¤šã€è¿ç®—å¤šï¼‰ï¼Œå¯ä»¥çœ‹å‡ºå½±å“å¯åŠ¨çš„å› ç´ å¾ˆå¤šï¼Œè¿˜éœ€è¦å…¨é¢è€ƒè™‘ã€‚</p>
<p>å¯¹äº CPU æ¥è¯´ï¼ŒWWDC çš„ <a href="https://developer.apple.com/videos/play/wwdc2018/228/">Whatâ€™s New in Energy Debugging - WWDC 2018 - Videos - Apple Developer</a> é‡Œä»‹ç»äº†ç”¨ Energy Log æ¥æŸ¥ CPU è€—ç”µï¼Œå½“å‰å°ä¸‰åˆ†é’Ÿæˆ–åå°ä¸€åˆ†é’Ÿ CPU çº¿ç¨‹è¿ç»­å ç”¨80%ä»¥ä¸Šå°±åˆ¤å®šä¸ºè€—ç”µï¼ŒåŒæ—¶è®°å½•è€—ç”µçº¿ç¨‹å †æ ˆä¾›åˆ†æã€‚è¿˜æœ‰ä¸€ä¸ª <a href="https://developer.apple.com/documentation/xcode/improving_your_app_s_performance">MetrickKit</a> ä¸“é—¨ç”¨æ¥æ”¶é›†ç”µæºå’Œæ€§èƒ½ç»Ÿè®¡æ•°æ®ï¼Œæ¯24å°æ—¶å°±ä¼šå¯¹æ”¶é›†çš„æ•°æ®è¿›è¡Œæ±‡æ€»ä¸ŠæŠ¥ï¼ŒMattt åœ¨ NShipster ç½‘ç«™ä¸Šä¹Ÿå‘äº†ç¯‡æ–‡ç« <a href="https://nshipster.com/metrickit/">MetricKit - NSHipster</a>ä¸“é—¨è¿›è¡Œäº†ä»‹ç»ã€‚é‚£ä¹ˆ CPU çš„è¯¦ç»†ä½¿ç”¨æƒ…å†µå¦‚ä½•è·å–å‘¢ï¼Ÿä¹Ÿå°±æ˜¯è¯´å“ªä¸ªæ–¹æ³•ç”¨äº†å¤šå°‘ CPUã€‚</p>
<p>æœ‰å¥½å‡ ç§è·å–è¯¦ç»† CPU ä½¿ç”¨æƒ…å†µçš„æ–¹æ³•ã€‚çº¿ç¨‹æ˜¯è®¡ç®—æœºèµ„æºè°ƒåº¦å’Œåˆ†é…çš„åŸºæœ¬å•ä½ã€‚CPU ä½¿ç”¨æƒ…å†µä¼šæç°åˆ°çº¿ç¨‹è¿™æ ·çš„åŸºæœ¬å•ä½ä¸Šã€‚task_theads çš„ act_list æ•°ç»„åŒ…å«æ‰€æœ‰çº¿ç¨‹ï¼Œä½¿ç”¨ thread_info çš„æ¥å£å¯ä»¥è¿”å›çº¿ç¨‹çš„åŸºæœ¬ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯å®šä¹‰åœ¨ thread_basic_info_t ç»“æ„ä½“ä¸­ã€‚è¿™ä¸ªç»“æ„ä½“å†…çš„ä¿¡æ¯åŒ…å«äº†çº¿ç¨‹è¿è¡Œæ—¶é—´ã€è¿è¡ŒçŠ¶æ€ä»¥åŠè°ƒåº¦ä¼˜å…ˆçº§ï¼Œå…¶ä¸­ä¹ŸåŒ…å«äº† CPU ä½¿ç”¨ä¿¡æ¯ cpu_usageã€‚è·å–æ–¹å¼å‚çœ‹ <a href="https://stackoverflow.com/questions/43866416/get-detailed-ios-cpu-usage-with-different-states">objective c - Get detailed iOS CPU usage with different states - Stack Overflow</a>ã€‚GT <a href="https://github.com/Tencent/GT">GitHub - Tencent/GT: GT (Great Tit) is a portable debugging tool for bug hunting and performance tuning on smartphones anytime and anywhere just as listening music with Walkman. GT can act as the Integrated Debug Environment by directly running on smartphones.</a> é‡Œä¹Ÿæœ‰è·å– CPU çš„ä»£ç ã€‚</p>
<p>æ•´ä½“ CPU å ç”¨ç‡å¯ä»¥é€šè¿‡ host_statistics å‡½æ•°å¯ä»¥å–åˆ° host_cpu_load_infoï¼Œå…¶ä¸­ cpu_ticks æ•°ç»„æ˜¯ CPU è¿è¡Œçš„æ—¶é’Ÿè„‰å†²æ•°é‡ã€‚é€šè¿‡ cpu_ticks æ•°ç»„é‡Œçš„çŠ¶æ€ï¼Œå¯ä»¥åˆ†åˆ«è·å– CPU_STATE_USERã€CPU_STATE_NICEã€CPU_STATE_SYSTEM è¿™ä¸‰ä¸ªè¡¨ç¤ºä½¿ç”¨ä¸­çš„çŠ¶æ€ï¼Œé™¤ä»¥æ•´ä½“ CPU å°±å¯ä»¥å–åˆ° CPU çš„å æ¯”ã€‚é€šè¿‡ NSProcessInfo çš„ activeProcessorCount è¿˜å¯ä»¥å¾—åˆ° CPU çš„æ ¸æ•°ã€‚çº¿ä¸Šæ•°æ®åˆ†ææ—¶ä¼šå‘ç°ç›¸åŒæœºå‹å’Œç³»ç»Ÿçš„æ‰‹æœºï¼Œæ€§èƒ½è¡¨ç°å´æˆªç„¶ä¸åŒï¼Œè¿™æ˜¯ç”±äºæ‰‹æœºè¿‡çƒ­æˆ–è€…ç”µæ± æŸè€—è¿‡å¤§åç³»ç»Ÿé™ä½äº† CPU é¢‘ç‡æ‰€è‡´ã€‚æ‰€ä»¥å¦‚æœå–å¾— CPU é¢‘ç‡åä¹Ÿå¯ä»¥é’ˆå¯¹é‚£äº›é™é¢‘çš„æ‰‹æœºæ¥è¿›è¡Œé’ˆå¯¹æ€§çš„ä¼˜åŒ–ï¼Œä»¥ä¿è¯æµç•…ä½“éªŒã€‚è·å–æ–¹å¼å¯ä»¥å‚è€ƒ <a href="https://github.com/zenny-chen/CPU-Dasher-for-iOS">GitHub - zenny-chen/CPU-Dasher-for-iOS: CPU Dasher for iOS source code. It only supports ARMv7 and ARMv7s architectures.</a></p>
<h3 id="å†…å­˜"><a href="#å†…å­˜" class="headerlink" title="å†…å­˜"></a>å†…å­˜</h3><p>è¦æƒ³è·å– App çœŸå®çš„å†…å­˜ä½¿ç”¨æƒ…å†µå¯ä»¥å‚çœ‹ WebKit çš„æºç ï¼Œ<a href="https://github.com/WebKit/webkit/blob/52bc6f0a96a062cb0eb76e9a81497183dc87c268/Source/WTF/wtf/cocoa/MemoryFootprintCocoa.cpp">webkit/MemoryFootprintCocoa.cpp at 52bc6f0a96a062cb0eb76e9a81497183dc87c268 Â· WebKit/webkit Â· GitHub</a> ã€‚JetSamä¼šåˆ¤æ–­ App ä½¿ç”¨å†…å­˜æƒ…å†µï¼Œè¶…å‡ºé˜ˆå€¼å°±ä¼šæ€æ­» Appï¼ŒJetSam è·å–é˜ˆå€¼çš„ä»£ç åœ¨ <a href="https://github.com/apple/darwin-xnu/blob/0a798f6738bc1db01281fc08ae024145e84df927/bsd/kern/kern_memorystatus.c">darwin-xnu/kern_memorystatus.c at 0a798f6738bc1db01281fc08ae024145e84df927 Â· apple/darwin-xnu Â· GitHub</a>ã€‚æ•´ä¸ªè®¾å¤‡ç‰©ç†å†…å­˜å¤§å°å¯ä»¥é€šè¿‡ NSProcessInfo çš„ physicalMemory æ¥è·å–ã€‚</p>
<h3 id="ç½‘ç»œ"><a href="#ç½‘ç»œ" class="headerlink" title="ç½‘ç»œ"></a>ç½‘ç»œ</h3><p>å¯¹äºç½‘ç»œç›‘æ§å¯ä»¥ä½¿ç”¨ Fishhook è¿™æ ·çš„å·¥å…· Hook ç½‘ç»œåº•å±‚åº“ CFNetworkã€‚ç½‘ç»œçš„æƒ…å†µæ¯”è¾ƒå¤æ‚ï¼Œæ‰€ä»¥éœ€è¦å®šäº›å’Œæ—¶é—´ç›¸å…³çš„å…³é”®çš„æŒ‡æ ‡ï¼ŒæŒ‡æ ‡å¦‚ä¸‹ï¼š</p>
<ul>
<li>DNS æ—¶é—´</li>
<li>SSL æ—¶é—´</li>
<li>é¦–åŒ…æ—¶é—´</li>
<li>å“åº”æ—¶é—´</li>
</ul>
<p>æœ‰äº†è¿™äº›æŒ‡æ ‡æ‰èƒ½å¤Ÿæœ‰åŠ©äºæ›´å¥½çš„åˆ†æç½‘ç»œé—®é¢˜ã€‚å¯åŠ¨é˜¶æ®µçš„ç½‘ç»œè¯·æ±‚æ˜¯éå¸¸å¤šçš„ï¼Œæ‰€ä»¥ HTTP çš„æ€§èƒ½æ˜¯éå¸¸è¦æ³¨æ„çš„ã€‚ä»¥ä¸‹æ˜¯ WWDC ç½‘ç»œç›¸å…³çš„ Sessionï¼š</p>
<ul>
<li><a href="https://developer.apple.com/videos/play/wwdc2015/719/">Your App and Next Generation Networks - WWDC 2015 - Videos - Apple Developer</a></li>
<li><a href="https://developer.apple.com/videos/play/wwdc2015/711/">Networking with NSURLSession - WWDC 2015 - Videos - Apple Developer</a></li>
<li><a href="https://developer.apple.com/videos/play/wwdc2016/714/">Networking for the Modern Internet - WWDC 2016 - Videos - Apple Developer</a></li>
<li><a href="https://developer.apple.com/videos/play/wwdc2017/707/">Advances in Networking, Part 1 - WWDC 2017 - Videos - Apple Developer</a></li>
<li><a href="https://developer.apple.com/videos/play/wwdc2017/709/">Advances in Networking, Part 2 - WWDC 2017 - Videos - Apple Developer</a></li>
<li><a href="https://developer.apple.com/videos/play/wwdc2018/714/">Optimizing Your App for Todayâ€™s Internet - WWDC 2018 - Videos - Apple Developer</a></li>
</ul>
<h3 id="I-O"><a href="#I-O" class="headerlink" title="I/O"></a>I/O</h3><p>å¯¹äº I/O å¯ä»¥ä½¿ç”¨ <a href="https://www.frida.re/">Frida â€¢ A world-class dynamic instrumentation framework | Inject JavaScript to explore native apps on Windows, macOS, GNU/Linux, iOS, Android, and QNX</a> è¿™ç§åŠ¨æ€äºŒè¿›åˆ¶æ’æ¡©æŠ€æœ¯ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶å»æ’å…¥è‡ªå®šä¹‰ä»£ç è·å– I/O çš„è€—æ—¶å’Œå¤„ç†çš„æ•°æ®å¤§å°ç­‰æ•°æ®ã€‚Frida è¿˜èƒ½å¤Ÿåœ¨å…¶å®ƒå¹³å°ä½¿ç”¨ã€‚</p>
<p>å…³äºå¤šç»´åº¦åˆ†ææ›´å¤šçš„èµ„æ–™å¯ä»¥çœ‹çœ‹å†å±Š WWDC çš„ä»‹ç»ã€‚ä¸‹é¢æˆ‘åˆ—ä¸‹16å¹´æ¥ WWDC å…³äºå¯åŠ¨ä¼˜åŒ–çš„ Sessionï¼Œæ¯åœºéƒ½å¾ˆç²¾å½©ã€‚</p>
<p><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/04.png" alt=""></p>
<ul>
<li><a href="https://developer.apple.com/videos/play/wwdc2016/418/">Using Time Profiler in Instruments - WWDC 2016 - Videos - Apple Developer</a></li>
<li><a href="https://developer.apple.com/videos/play/wwdc2016/719/">Optimizing I/O for Performance and Battery Life - WWDC 2016 - Videos - Apple Developer</a></li>
<li><a href="https://developer.apple.com/videos/play/wwdc2016/406/">Optimizing App Startup Time - WWDC 2016 - Videos - Apple Developer</a></li>
<li><a href="https://developer.apple.com/videos/play/wwdc2017/413/">App Startup Time: Past, Present, and Future - WWDC 2017 - Videos - Apple Developer</a></li>
<li><a href="https://developer.apple.com/videos/play/wwdc2018/407/">Practical Approaches to Great App Performance - WWDC 2018 - Videos - Apple Developer</a></li>
<li><a href="https://developer.apple.com/videos/play/wwdc2019/423/">Optimizing App Launch - WWDC 2019 - Videos - Apple Developer</a> </li>
</ul>
<h2 id="å»¶åä»»åŠ¡ç®¡ç†"><a href="#å»¶åä»»åŠ¡ç®¡ç†" class="headerlink" title="å»¶åä»»åŠ¡ç®¡ç†"></a>å»¶åä»»åŠ¡ç®¡ç†</h2><p>ç»è¿‡å‰é¢æ‰€è¯´çš„å¯¹ä¸»çº¿ç¨‹è€—æ—¶æ–¹æ³•å’Œå„ä¸ªçº¬åº¦æ€§èƒ½åˆ†æåï¼Œå¯¹äºé‚£äº›åˆ†æå‡ºæ¥æ²¡å¿…è¦åœ¨å¯åŠ¨é˜¶æ®µæ‰§è¡Œçš„æ–¹æ³•ï¼Œå¯ä»¥åšæˆæŒ‰éœ€æˆ–å»¶åæ‰§è¡Œã€‚<br>ä»»åŠ¡å»¶åçš„å¤„ç†ä¸èƒ½ç²—çŠ·çš„ä¸€å£æ°”åœ¨å¯åŠ¨å®Œæˆååœ¨ä¸»çº¿ç¨‹ä¸€èµ·æ‰§è¡Œï¼Œé‚£æ ·ç”¨æˆ·ä»…ä»…åªæ˜¯çœ‹åˆ°äº†é¡µé¢ï¼Œä¾ç„¶æ²¡æ³•å“åº”æ“ä½œã€‚é‚£è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿå¥—è·¯ä¸€èˆ¬æ˜¯è¿™æ ·ï¼Œåˆ›å»ºå››ä¸ªé˜Ÿåˆ—ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>å¼‚æ­¥ä¸²è¡Œé˜Ÿåˆ—</li>
<li>å¼‚æ­¥å¹¶è¡Œé˜Ÿåˆ—</li>
<li>é—²æ—¶ä¸»çº¿ç¨‹ä¸²è¡Œé˜Ÿåˆ—</li>
<li>é—²æ—¶å¼‚æ­¥ä¸²è¡Œé˜Ÿåˆ—</li>
</ul>
<p><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/06.png" alt=""></p>
<p>æœ‰ä¾èµ–å…³ç³»çš„ä»»åŠ¡å¯ä»¥æ”¾åˆ°å¼‚æ­¥ä¸²è¡Œé˜Ÿåˆ—ä¸­æ‰§è¡Œã€‚å¼‚æ­¥å¹¶è¡Œé˜Ÿåˆ—å¯ä»¥åˆ†ç»„æ‰§è¡Œï¼Œæ¯”å¦‚ä½¿ç”¨ dispatch_groupï¼Œç„¶åå¯¹æ¯ç»„ä»»åŠ¡æ•°é‡è¿›è¡Œé™åˆ¶ï¼Œé¿å… CPUã€çº¿ç¨‹å’Œå†…å­˜ç¬æ—¶æ¿€å¢å½±å“ä¸»çº¿ç¨‹ç”¨æˆ·æ“ä½œï¼Œå®šä¹‰æœ‰é™æ•°é‡çš„ä¸²è¡Œé˜Ÿåˆ—ï¼Œæ¯ä¸ªä¸²è¡Œé˜Ÿåˆ—åšç‰¹å®šçš„äº‹æƒ…ï¼Œè¿™æ ·ä¹Ÿèƒ½å¤Ÿé¿å…æ€§èƒ½æ¶ˆè€—çŸ­æ—¶é—´çªç„¶æš´æ¶¨å¼•èµ·æ— æ³•å“åº”ç”¨æˆ·æ“ä½œã€‚ä½¿ç”¨ dispatch_semaphore_t åœ¨ä¿¡å·é‡é˜»å¡ä¸»é˜Ÿåˆ—æ—¶å®¹æ˜“å‡ºç°ä¼˜å…ˆçº§åè½¬ï¼Œéœ€è¦å‡å°‘ä½¿ç”¨ï¼Œç¡®ä¿QoSä¼ æ’­ã€‚å¯ä»¥ç”¨dispatch group æ›¿ä»£ï¼Œæ€§èƒ½ä¸€æ ·ï¼ŒåŠŸèƒ½ä¸å·®ã€‚å¼‚æ­¥ç¼–ç¨‹å¯ä»¥ç›´æ¥ GCD æ¥å£æ¥å†™ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é˜¿é‡Œçš„åç¨‹æ¡†æ¶ coobjc <a href="https://github.com/alibaba/coobjc">coobjc</a>ã€‚</p>
<p>é—²æ—¶é˜Ÿåˆ—å®ç°æ–¹å¼æ˜¯ç›‘å¬ä¸»çº¿ç¨‹ runloop çŠ¶æ€ï¼Œåœ¨ kCFRunLoopBeforeWaiting æ—¶å¼€å§‹æ‰§è¡Œé—²æ—¶é˜Ÿåˆ—é‡Œçš„ä»»åŠ¡ï¼Œåœ¨ kCFRunLoopAfterWaiting æ—¶åœæ­¢ã€‚</p>
<h2 id="ä¼˜åŒ–åå¦‚ä½•ä¿æŒï¼Ÿ"><a href="#ä¼˜åŒ–åå¦‚ä½•ä¿æŒï¼Ÿ" class="headerlink" title="ä¼˜åŒ–åå¦‚ä½•ä¿æŒï¼Ÿ"></a>ä¼˜åŒ–åå¦‚ä½•ä¿æŒï¼Ÿ</h2><p>æ”»æ˜“å®ˆéš¾ï¼Œå°±åƒåˆšåˆ°æ–°å›¢é˜Ÿæ—¶å°†åŒ…å¤§å°å‡å°‘äº†48å…†ï¼Œä½†æ˜¯ä¸€å¹´å¤šä¸€ç›´èƒ½å¤Ÿå®ˆä½é™¤äº†å†³å¿ƒè¿˜éœ€è¦æœ‰æ‰‹æ®µã€‚å¯¹äºå¯åŠ¨ä¼˜åŒ–æ¥è¯´ï¼Œå°†å„ä¸ªæ€§èƒ½çº¬åº¦é€šè¿‡ç›‘æ§çš„æ–¹å¼ç›¯ä½æ˜¯å¿…è¦çš„ï¼Œä½†æ˜¯å‘ç°é—®é¢˜åå¿«é€Ÿã€ä¾¿æ·çš„å®šä½åˆ°é—®é¢˜è¿˜æ˜¯éœ€è¦æ‰¾äº›çªç ´å£ã€‚æˆ‘çš„æ€è·¯æ˜¯å°†å¯åŠ¨é˜¶æ®µæ–¹æ³•è€—æ—¶å¤šçš„æŒ‰ç…§æ—¶é—´çº¿ä¸€æ¡ä¸€æ¡æ’å‡ºæ¥ï¼Œæ¯æ¡åŒ…æ‹¬æ–¹æ³•åã€æ–¹æ³•å±‚çº§ã€æ‰€å±ç±»ã€æ‰€å±æ¨¡å—ã€ç»´æŠ¤äººã€‚è€ƒè™‘åˆ°ä¾¿æ·æ€§ï¼Œæœ€å¥½è¿˜èƒ½æ–¹ä¾¿çš„æŸ¥çœ‹æ–¹æ³•ä»£ç å†…å®¹ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘é€šè¿‡å¼€å‘ä¸€ä¸ªå·¥å…·ï¼Œè·Ÿä½ è¯¦ç»†è¯´è¯´æ€ä¹ˆå®ç°è¿™æ ·çš„æ•ˆæœã€‚è®¾è®¡æœ€ç»ˆå¸Œæœ›å±•ç¤ºå†…å®¹å¦‚ä¸‹ï¼š</p>
<p><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/07.png" alt=""></p>
<h3 id="è§£æ-json"><a href="#è§£æ-json" class="headerlink" title="è§£æ json"></a>è§£æ json</h3><p>å¦‚å‰é¢æ‰€è¯´åœ¨è¾“å‡ºä¸€ä»½ Chrome trace è§„èŒƒçš„æ–¹æ³•è€—æ—¶ json åï¼Œå…ˆè¦è§£æè¿™ä»½æ•°æ®ã€‚è¿™ä»½ json æ•°æ®ç±»ä¼¼ä¸‹é¢çš„æ ·å­ï¼š<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;name&quot;</span>:<span class="string">&quot;[SMVeilweaa]upVeilState:&quot;</span>,<span class="attr">&quot;cat&quot;</span>:<span class="string">&quot;catname&quot;</span>,<span class="attr">&quot;ph&quot;</span>:<span class="string">&quot;B&quot;</span>,<span class="attr">&quot;pid&quot;</span>:<span class="number">2381</span>,<span class="attr">&quot;tid&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;ts&quot;</span>:<span class="number">21</span>&#125;,</span><br><span class="line">&#123;<span class="attr">&quot;name&quot;</span>:<span class="string">&quot;[SMVeilweaa]tatLaunchState:&quot;</span>,<span class="attr">&quot;cat&quot;</span>:<span class="string">&quot;catname&quot;</span>,<span class="attr">&quot;ph&quot;</span>:<span class="string">&quot;B&quot;</span>,<span class="attr">&quot;pid&quot;</span>:<span class="number">2381</span>,<span class="attr">&quot;tid&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;ts&quot;</span>:<span class="number">4557</span>&#125;,</span><br><span class="line">&#123;<span class="attr">&quot;name&quot;</span>:<span class="string">&quot;[SMVeilweaa]tatTimeStamp:state:&quot;</span>,<span class="attr">&quot;cat&quot;</span>:<span class="string">&quot;catname&quot;</span>,<span class="attr">&quot;ph&quot;</span>:<span class="string">&quot;B&quot;</span>,<span class="attr">&quot;pid&quot;</span>:<span class="number">2381</span>,<span class="attr">&quot;tid&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;ts&quot;</span>:<span class="number">4686</span>&#125;,</span><br><span class="line">&#123;<span class="attr">&quot;name&quot;</span>:<span class="string">&quot;[SMVeilweaa]tatTimeStamp:state:&quot;</span>,<span class="attr">&quot;cat&quot;</span>:<span class="string">&quot;catname&quot;</span>,<span class="attr">&quot;ph&quot;</span>:<span class="string">&quot;E&quot;</span>,<span class="attr">&quot;pid&quot;</span>:<span class="number">2381</span>,<span class="attr">&quot;tid&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;ts&quot;</span>:<span class="number">4727</span>&#125;,</span><br><span class="line">&#123;<span class="attr">&quot;name&quot;</span>:<span class="string">&quot;[SMVeilweaa]tatLaunchState:&quot;</span>,<span class="attr">&quot;cat&quot;</span>:<span class="string">&quot;catname&quot;</span>,<span class="attr">&quot;ph&quot;</span>:<span class="string">&quot;E&quot;</span>,<span class="attr">&quot;pid&quot;</span>:<span class="number">2381</span>,<span class="attr">&quot;tid&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;ts&quot;</span>:<span class="number">5732</span>&#125;,</span><br><span class="line">&#123;<span class="attr">&quot;name&quot;</span>:<span class="string">&quot;[SMVeilweaa]upVeilState:&quot;</span>,<span class="attr">&quot;cat&quot;</span>:<span class="string">&quot;catname&quot;</span>,<span class="attr">&quot;ph&quot;</span>:<span class="string">&quot;E&quot;</span>,<span class="attr">&quot;pid&quot;</span>:<span class="number">2381</span>,<span class="attr">&quot;tid&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;ts&quot;</span>:<span class="number">5815</span>&#125;,</span><br><span class="line">â€¦</span><br></pre></td></tr></table></figure><br>é€šè¿‡ Chrome çš„ <a href="https://chromium.googlesource.com/catapult/+/HEAD/tracing/README.md">Trace-Viewer</a> å¯ä»¥ç”Ÿæˆä¸€ä¸ªç«ç„°å›¾ã€‚å…¶ä¸­ name å­—æ®µåŒ…å«äº†ç±»ã€æ–¹æ³•å’Œå‚æ•°çš„ä¿¡æ¯ï¼Œcat å­—æ®µå¯ä»¥åŠ å…¥å…¶å®ƒæ€§èƒ½æ•°æ®ï¼Œph ä¸º B è¡¨ç¤ºæ–¹æ³•å¼€å§‹ï¼Œä¸º E è¡¨ç¤ºæ–¹æ³•ç»“æŸï¼Œts å­—æ®µè¡¨ç¤ºã€‚</p>
<h4 id="json-åˆ†è¯"><a href="#json-åˆ†è¯" class="headerlink" title="json åˆ†è¯"></a>json åˆ†è¯</h4><p><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/08.png" alt=""></p>
<p>è¯»å– json æ–‡ä»¶<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ ¹æ®æ–‡ä»¶è·¯å¾„è¿”å›æ–‡ä»¶å†…å®¹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">fileContent</span>(<span class="params">path</span>: <span class="type">String</span>)</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">try</span> <span class="type">String</span>(contentsOfFile: path, encoding: <span class="type">String</span>.<span class="type">Encoding</span>.utf8)</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> â€œâ€</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> bundlePath <span class="operator">=</span> <span class="type">Bundle</span>.main.path(forResource: â€œstartTraceâ€, ofType: â€œjsonâ€)</span><br><span class="line"><span class="keyword">let</span> jsonPath <span class="operator">=</span> bundlePath <span class="operator">??</span> â€œâ€</span><br><span class="line"><span class="keyword">let</span> jsonContent <span class="operator">=</span> <span class="type">FileHandle</span>.fileContent(path: jsonPath)</span><br></pre></td></tr></table></figure></p>
<p>jsonContent å°±æ˜¯ json å†…å®¹å­—ç¬¦ä¸²ã€‚å†™ä¸€ä¸ªå­—ç¬¦åˆ‡å‰²å‡½æ•°å°†å­—ç¬¦ä¸²æŒ‰ç…§è‡ªå®šä¹‰ç¬¦å·é›†æ¥åˆ‡å‰²ã€‚<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">allTkFast</span>(<span class="params">operaters</span>:<span class="type">String</span>)</span> -&gt; [<span class="type">Token</span>] &#123;</span><br><span class="line">    <span class="keyword">var</span> nText <span class="operator">=</span> text.replacingOccurrences(of: â€œ â€œ, with: â€œ starmingspace â€œ)</span><br><span class="line">    nText <span class="operator">=</span> nText.replacingOccurrences(of: â€œ\nâ€, with: â€œ starmingnewline â€œ)</span><br><span class="line">    <span class="keyword">let</span> scanner <span class="operator">=</span> <span class="type">Scanner</span>(string: nText)</span><br><span class="line">    <span class="keyword">var</span> tks <span class="operator">=</span> [<span class="type">Token</span>]()</span><br><span class="line">    <span class="keyword">var</span> <span class="keyword">set</span> <span class="operator">=</span> <span class="type">CharacterSet</span>()</span><br><span class="line">    <span class="keyword">set</span>.insert(charactersIn: operaters)</span><br><span class="line">    <span class="keyword">set</span>.formUnion(<span class="type">CharacterSet</span>.whitespacesAndNewlines)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> <span class="operator">!</span>scanner.isAtEnd &#123;</span><br><span class="line">        <span class="keyword">for</span> operater <span class="keyword">in</span> operaters &#123;</span><br><span class="line">            <span class="keyword">let</span> opStr <span class="operator">=</span> operater.description</span><br><span class="line">            <span class="keyword">if</span> (scanner.scanString(opStr) <span class="operator">!=</span> <span class="literal">nil</span>) &#123;</span><br><span class="line">                tks.append(.id(opStr))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> result:<span class="type">NSString</span>?</span><br><span class="line">        result <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line">        <span class="keyword">if</span> (scanner.scanUpToCharacters(from: <span class="keyword">set</span>) <span class="operator">!=</span> <span class="literal">nil</span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> resultString <span class="operator">=</span> result<span class="operator">!</span> <span class="keyword">as</span> <span class="type">String</span></span><br><span class="line">            <span class="keyword">if</span> resultString <span class="operator">==</span> â€œstarmingnewlineâ€ &#123;</span><br><span class="line">                tks.append(.newLine)</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> resultString <span class="operator">==</span> â€œstarmingspaceâ€ &#123;</span><br><span class="line">                tks.append(.space)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                tks.append(.id(result<span class="operator">!</span> <span class="keyword">as</span> <span class="type">String</span>))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    tks.append(.eof)</span><br><span class="line">    <span class="keyword">return</span> tks</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å°†åˆ‡å‰²çš„å­—ç¬¦ä¿å­˜ä¸º Token ç»“æ„ä½“çš„ä¸€ä¸ªä¸ª tokenã€‚Token ç»“æ„ä½“å®šä¹‰å¦‚ä¸‹ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">Token</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> eof</span><br><span class="line">    <span class="keyword">case</span> newLine</span><br><span class="line">    <span class="keyword">case</span> space</span><br><span class="line">    <span class="keyword">case</span> comments(<span class="type">String</span>)      <span class="comment">// æ³¨é‡Š</span></span><br><span class="line">    <span class="keyword">case</span> constant(<span class="type">Constant</span>)    <span class="comment">// floatã€int</span></span><br><span class="line">    <span class="keyword">case</span> id(<span class="type">String</span>)            <span class="comment">// string</span></span><br><span class="line">    <span class="keyword">case</span> string(<span class="type">String</span>)        <span class="comment">// ä»£ç ä¸­å¼•å·å†…å­—ç¬¦ä¸²</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">Constant</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> string(<span class="type">String</span>)</span><br><span class="line">    <span class="keyword">case</span> integer(<span class="type">Int</span>)</span><br><span class="line">    <span class="keyword">case</span> float(<span class="type">Float</span>)</span><br><span class="line">    <span class="keyword">case</span> boolean(<span class="type">Bool</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä»£ç ä¸­çš„ eof è¡¨ç¤º token æ˜¯æ–‡ä»¶ç»“æŸï¼ŒnewLine æ˜¯æ¢è¡Œ tokenã€‚Constant æ˜¯æšä¸¾å…³è”å€¼ï¼Œé€šè¿‡æšä¸¾å…³è”å€¼å¯ä»¥ä½¿æšä¸¾èƒ½å¤Ÿå…·æœ‰æ›´å¤šå±‚çº§ã€‚åé¢è¿˜éœ€è¦å°†æšä¸¾å€¼è¿›è¡Œåˆ¤ç­‰æ¯”è¾ƒï¼Œæ‰€ä»¥è¿˜éœ€è¦æ‰©å±•æšä¸¾çš„ Equatable åè®®å®ç°ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Token</span>: <span class="title">Equatable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">==</span> (<span class="params">lhs</span>: <span class="type">Token</span>, <span class="params">rhs</span>: <span class="type">Token</span>)</span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (lhs, rhs) &#123;</span><br><span class="line">        <span class="keyword">case</span> (.eof, .eof):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        <span class="keyword">case</span> (.newLine, .newLine):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        <span class="keyword">case</span> (.space, .space):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">let</span> (.constant(left), .constant(right)):</span><br><span class="line">            <span class="keyword">return</span> left <span class="operator">==</span> right</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">let</span> (.comments(left), .comments(right)):</span><br><span class="line">            <span class="keyword">return</span> left <span class="operator">==</span> right</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">let</span> (.id(left), .id(right)):</span><br><span class="line">            <span class="keyword">return</span> left <span class="operator">==</span> right</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">let</span> (.string(left), .string(right)):</span><br><span class="line">            <span class="keyword">return</span> left <span class="operator">==</span> right</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>é€šç”¨çš„ token ç»“æ„è§£æå®Œæˆã€‚æ¥ä¸‹æ¥å°±æ˜¯è®¾è®¡ä¸€ä¸ª json ç‰¹æœ‰çš„ token ç»“æ„ã€‚å¯¹äº json æ¥è¯´æ¢è¡Œå’Œç©ºæ ¼å¯ä»¥è¿‡æ»¤æ‰ï¼Œå†™ä¸ªå‡½æ•°è¿‡æ»¤æ¢è¡Œå’Œç©ºæ ¼çš„ tokenï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">allTkFastWithoutNewLineAndWhitespace</span>(<span class="params">operaters</span>:<span class="type">String</span>)</span> -&gt; [<span class="type">Token</span>] &#123;</span><br><span class="line">    <span class="keyword">let</span> allToken <span class="operator">=</span> allTkFast(operaters: operaters)</span><br><span class="line">    <span class="keyword">let</span> flAllToken <span class="operator">=</span> allToken.filter &#123;</span><br><span class="line">        <span class="variable">$0</span> <span class="operator">!=</span> .newLine</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> fwAllToken <span class="operator">=</span> flAllToken.filter &#123;</span><br><span class="line">        <span class="variable">$0</span> <span class="operator">!=</span> .space</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> fwAllToken</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>json çš„æ“ä½œç¬¦æœ‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#125;[]â€:,</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥ operaters å‚æ•°å¯ä»¥æ˜¯è¿™äº›æ“ä½œç¬¦ã€‚å®Œæ•´çš„ Lexer ç±»ä»£ç åœ¨ <a href="https://github.com/ming1016/MethodTraceAnalyze/blob/master/MethodTraceAnalyze/Core/Lexer.swift">MethodTraceAnalyze/Lexer.swift</a>ã€‚ä½¿ç”¨ Lexer ç±»çš„ allTkFastWithoutNewLineAndWhitespace æ–¹æ³•å¯ä»¥å–å¾— token é›†åˆã€‚</p>
<h4 id="JSONToken"><a href="#JSONToken" class="headerlink" title="JSONToken"></a>JSONToken</h4><p>ä¸ºäº†è½¬æˆ json çš„ tokenï¼Œæˆ‘å…ˆè®¾è®¡ä¸€ä¸ª json token çš„ç»“æ„ JSONTokenã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">JSONToken</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> type: <span class="type">JSONTokenType</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> value: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">JSONTokenType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> startDic   <span class="comment">// &#123;</span></span><br><span class="line">    <span class="keyword">case</span> endDic     <span class="comment">// &#125;</span></span><br><span class="line">    <span class="keyword">case</span> startArray <span class="comment">// [</span></span><br><span class="line">    <span class="keyword">case</span> endArray   <span class="comment">// ]</span></span><br><span class="line">    <span class="keyword">case</span> key        <span class="comment">// key</span></span><br><span class="line">    <span class="keyword">case</span> value      <span class="comment">// value</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ ¹æ® json çš„æœ¬èº«è®¾è®¡ï¼Œä¸»è¦åˆ†ä¸º key å’Œ valueï¼Œå¦å¤–è¿˜éœ€è¦äº›ç¬¦å·ç±»å‹ï¼Œç”¨æ¥è¿›è¡Œè¿›ä¸€æ­¥çš„è§£æã€‚è§£æè¿‡ç¨‹çš„çŠ¶æ€è®¾è®¡ä¸ºä¸‰ç§ï¼Œç”¨ State æšä¸¾è¡¨ç¤ºï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">enum</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> normal</span><br><span class="line">    <span class="keyword">case</span> keyStart</span><br><span class="line">    <span class="keyword">case</span> valueStart</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åœ¨ normal çŠ¶æ€ä¸‹ï¼Œä¼šè®°å½•æ“ä½œç¬¦ç±»å‹çš„ json tokenï¼Œå½“é‡åˆ°{ç¬¦å·åï¼Œä¸‹ä¸€ä¸ªæ˜¯â€œç¬¦å·å°±ä¼šæ›´æ”¹çŠ¶æ€ä¸º keyStartã€‚å¦ä¸€ç§æƒ…å†µå°±æ˜¯åœ¨é‡åˆ°,ç¬¦å·åï¼Œä¸‹ä¸€ä¸ªæ˜¯â€ç¬¦å·ä¹Ÿä¼šæ›´æ”¹çŠ¶æ€ä¸º keyStartã€‚</p>
<p>çŠ¶æ€æ›´æ”¹æˆ valueStart çš„æ¡ä»¶æ˜¯é‡åˆ°:ç¬¦å·ï¼Œå½“ä¸‹ä¸€ä¸ªæ˜¯â€œæ—¶è¿›å…¥ valueStart çŠ¶æ€ï¼Œå¦‚æœä¸æ˜¯â€œç¬¦å·ï¼Œå°±éœ€è¦åšåŒºåˆ†ï¼Œæ˜¯{æˆ–è€…[æ—¶ç›´æ¥è·³è¿‡:ç¬¦å·ï¼Œç„¶åè®°å½•è¿™ä¸¤ä¸ªæ“ä½œç¬¦ã€‚å…¶å®ƒæƒ…å†µè¡¨ç¤º value ä¸æ˜¯å­—ç¬¦è€Œæ˜¯æ•°å­—ï¼Œç›´æ¥è®°å½•ä¸º json token å°±å¯ä»¥äº†ã€‚å®Œæ•´ json token çš„è§£æä»£ç è§ <a href="https://github.com/ming1016/MethodTraceAnalyze/blob/master/MethodTraceAnalyze/JSON/ParseJSONTokens.swift">MethodTraceAnalyze/ParseJSONTokens.swift</a>ã€‚</p>
<p>JSONToken é›†åˆç›®å‰è¿˜åªæ˜¯æ‰å¹³æ€ï¼Œè€Œ json æ•°æ®æ˜¯æœ‰ key å’Œ value çš„å¤šçº§å…³ç³»åœ¨çš„ï¼Œæ¯”å¦‚ value å¯èƒ½æ˜¯å­—ç¬¦ä¸²æˆ–æ•°å­—ï¼Œä¹Ÿå¯èƒ½æ˜¯å¦ä¸€ç»„ key value ç»“æ„æˆ–è€… value çš„æ•°ç»„é›†åˆã€‚æ‰€ä»¥ä¸‹é¢è¿˜éœ€è¦å®šä¹‰ä¸€ä¸ª JSONItem ç»“æ„æ¥å®¹çº³å¤šçº§å…³ç³»ã€‚</p>
<h4 id="JSONItem"><a href="#JSONItem" class="headerlink" title="JSONItem"></a>JSONItem</h4><p><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/09.png" alt=""></p>
<p>JSONItem çš„ç»“æ„ä½“å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">JSONItem</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> type: <span class="type">JSONItemType</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> value: <span class="type">String</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> kvs: [<span class="type">JSONItemKv</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> array: [<span class="type">JSONItem</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç±»å‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">JSONItemType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> keyValue</span><br><span class="line">    <span class="keyword">case</span> value</span><br><span class="line">    <span class="keyword">case</span> array</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// key value ç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">JSONItemKv</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> key: <span class="type">String</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> value: <span class="type">JSONItem</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>JSONItem çš„ç±»å‹åˆ†ä¸‰ç§ï¼Œkey valueã€value å’Œ array çš„ï¼Œå®šä¹‰åœ¨ JSONItemType æšä¸¾ä¸­ã€‚åˆ†åˆ«å¯¹åº”çš„ä¸‰ä¸ªå­˜å‚¨å­—æ®µæ˜¯ kvsï¼Œé‡Œé¢æ˜¯ JSONItemKv ç±»å‹çš„é›†åˆï¼›value ä¸ºå­—ç¬¦ä¸²ï¼›array æ˜¯ JSONItem çš„é›†åˆã€‚</p>
<p>å®šä¹‰å¥½äº†å¤šå±‚çº§çš„ç»“æ„ï¼Œå°±å¯ä»¥å°† JSONToken çš„é›†åˆè¿›è¡Œåˆ†æï¼Œè½¬åˆ° JSONItem ç»“æ„ä¸Šã€‚æ€è·¯æ˜¯åœ¨è§£æè¿‡ç¨‹ä¸­ç¢°åˆ°é—­åˆç¬¦å·æ—¶ï¼Œå°†æ‰å¹³çš„é—­åˆåŒºé—´å†…çš„ JSONToken  æ”¾åˆ°é›†åˆé‡Œï¼Œé€šè¿‡é€’å½’å‡½æ•° recursiveTk é€’å½’å‡ºå¤šå±‚çº§ç»“æ„å‡ºæ¥ã€‚æ‰€ä»¥éœ€è¦è®¾ç½®å››ä¸ªçŠ¶æ€ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">rState</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> normal</span><br><span class="line">    <span class="keyword">case</span> startDic</span><br><span class="line">    <span class="keyword">case</span> startArr</span><br><span class="line">    <span class="keyword">case</span> startKey</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å½“ç¢°åˆ°{ç¬¦å·è¿›å…¥ startDic çŠ¶æ€ï¼Œé‡åˆ°[ç¬¦å·è¿›å…¥ startKey çŠ¶æ€ï¼Œé‡åˆ°}å’Œ]ç¬¦å·æ—¶ä¼šç»“æŸè¿™ä¸¤ä¸ªçŠ¶æ€ã€‚åœ¨ startDic æˆ– startKey çŠ¶æ€ä¸­æ—¶ä¼šæ”¶é›†è¿‡ç¨‹ä¸­çš„ JSONToken åˆ° recursiveTkArr é›†åˆé‡Œã€‚è¿™ä¸ªåˆ†æå®Œæ•´ä»£ç åœ¨è¿™ <a href="https://github.com/ming1016/MethodTraceAnalyze/blob/master/MethodTraceAnalyze/JSON/ParseJSONItem.swift">MethodTraceAnalyze/ParseJSONItem.swift</a>ã€‚</p>
<p>æ¥ä¸€æ®µç®€å•çš„ json æµ‹è¯•ä¸‹ï¼š<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    â€œkey1â€: â€œvalue1â€,</span><br><span class="line">    â€œkey2â€: <span class="number">22</span>,</span><br><span class="line">    â€œkey3â€: &#123;</span><br><span class="line">        â€œsubKey1â€: â€œsubValue1â€,</span><br><span class="line">        â€œsubKey2â€: <span class="number">40</span>,</span><br><span class="line">        â€œsubKey3â€:[</span><br><span class="line">            &#123;</span><br><span class="line">                â€œsub1Key1â€: <span class="number">10</span>,</span><br><span class="line">                â€œsub1Key2â€:&#123;</span><br><span class="line">                    â€œsub3Key1â€: â€œsub3Value1â€,</span><br><span class="line">                    â€œsub3Key2â€: â€œsub3Value2â€</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                â€œsub1Key1â€: <span class="number">11</span>,</span><br><span class="line">                â€œsub1Key2â€: <span class="number">15</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        â€œsubKey4â€: [</span><br><span class="line">            â€œvalue1â€,</span><br><span class="line">            <span class="number">23</span>,</span><br><span class="line">            â€œvalue2â€</span><br><span class="line">        ],</span><br><span class="line">        â€œsubKey5â€: <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨ ParseJSONItem æ¥è§£æ<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> jsonOPath <span class="operator">=</span> <span class="type">Bundle</span>.main.path(forResource: â€œtestâ€, ofType: â€œjsonâ€)</span><br><span class="line"><span class="keyword">let</span> jOrgPath <span class="operator">=</span> jsonOPath <span class="operator">??</span> â€œâ€</span><br><span class="line"><span class="keyword">let</span> jsonOContent <span class="operator">=</span> <span class="type">FileHandle</span>.fileContent(path: jOrgPath)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> item <span class="operator">=</span> <span class="type">ParseJSONItem</span>(input: jsonOContent).parse()</span><br></pre></td></tr></table></figure></p>
<p>å¾—åˆ°çš„ item æ•°æ®å¦‚ä¸‹å›¾æ‰€ç¤º</p>
<p><img src="/uploads/how-to-analyze-startup-time-cost-in-ios/02.png" alt=""></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œitem çš„ç»“æ„å’Œå‰é¢çš„ json ç»“æ„æ˜¯ä¸€è‡´çš„ã€‚</p>
<h4 id="json-å•æµ‹"><a href="#json-å•æµ‹" class="headerlink" title="json å•æµ‹"></a>json å•æµ‹</h4><p>ä¸ºäº†ä¿è¯åé¢å¯¹ json çš„è§£æä¿®æ”¹å’Œå®Œå–„å¯¹ä¸Šé¢åˆ—çš„æµ‹è¯• case è§£æç»“æœä¸ä¼šæœ‰å½±å“ï¼Œå¯ä»¥å†™ä¸ªç®€å•æµ‹è¯•ç±»æ¥åšã€‚è¿™ä¸ªç±»åªéœ€è¦åšåˆ°å°†å®é™…ç»“æœå’Œé¢„æœŸå€¼åšæ¯”è¾ƒï¼Œç›¸ç­‰å³å¯é€šè¿‡ï¼Œä¸ç­‰å³å¯æç¤ºå¹¶ä¸­æ–­ï¼Œæ–¹ä¾¿å®šä½é—®é¢˜ã€‚å› æ­¤ä¼ å…¥å‚æ•°åªéœ€è¦æœ‰è¿è¡Œç»“æœã€é¢„æœŸç»“æœã€æè¿°å°±å¤Ÿç”¨äº†ã€‚æˆ‘å†™ä¸ª Test åè®®ï¼Œé€šè¿‡æ‰©å±•é»˜è®¤å®ç°ä¸€ä¸ªæ¯”è¾ƒçš„æ–¹æ³•ï¼Œä»¥åéœ€è¦å•æµ‹çš„ç±»éµå¾ªè¿™ä¸ªåè®®å°±å¯ä»¥ä½¿ç”¨å’Œæ‰©å±•å•æµ‹åŠŸèƒ½äº†ã€‚Test åè®®å…·ä½“ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">cs</span>(<span class="params">current</span>:<span class="type">String</span>, <span class="params">expect</span>:<span class="type">String</span>, <span class="params">des</span>:<span class="type">String</span>)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// compare string å¯¹æ¯”ä¸¤ä¸ªå­—ç¬¦ä¸²å€¼</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">cs</span>(<span class="params">current</span>:<span class="type">String</span>, <span class="params">expect</span>: <span class="type">String</span>, <span class="params">des</span>: <span class="type">String</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> current <span class="operator">==</span> expect &#123;</span><br><span class="line">            <span class="built_in">print</span>(â€œ<span class="operator">âœ…</span> \(des) okï¼Œç¬¦åˆé¢„æœŸå€¼ï¼š\(expect)â€)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> msg <span class="operator">=</span> â€œ<span class="operator">âŒ</span> \(des) failï¼Œä¸ç¬¦åˆé¢„æœŸå€¼ï¼š\(expect)â€</span><br><span class="line">            <span class="built_in">print</span>(msg)</span><br><span class="line">            <span class="built_in">assertionFailure</span>(msg)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å†™ä¸ª TestJSON éµå¾ª Test åè®®è¿›è¡Œå•æµ‹ã€‚æµ‹è¯•å„ä¸ªè§£æåçš„å€¼ï¼Œæ¯”å¦‚æµ‹è¯• itemç¬¬ä¸€çº§ key value é…å¯¹æ•°é‡å¯ä»¥è¿™æ ·å†™ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr <span class="operator">=</span> item.array[<span class="number">0</span>].kvs</span><br><span class="line">cs(current: â€œ\(arr.count)â€, expect: â€œ<span class="number">3</span>â€, des: â€œall dic countâ€)</span><br></pre></td></tr></table></figure></p>
<p>æ‰“å°çš„ç»“æœå°±æ˜¯ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">âœ… all dic count okï¼Œç¬¦åˆé¢„æœŸå€¼ï¼š3</span><br></pre></td></tr></table></figure></p>
<p>å®Œæ•´å•æµ‹ä»£ç åœ¨è¿™é‡Œï¼š<a href="https://github.com/ming1016/MethodTraceAnalyze/blob/master/MethodTraceAnalyze/JSON/TestJSON.swift">MethodTraceAnalyze/TestJSON.swift</a></p>
<h3 id="è§£æ-Launch-Trace-çš„-json"><a href="#è§£æ-Launch-Trace-çš„-json" class="headerlink" title="è§£æ Launch Trace çš„ json"></a>è§£æ Launch Trace çš„ json</h3><p>å‰é¢è¯´çš„ JSONItem æ˜¯é€šç”¨çš„å¤šå±‚çº§ json ç»“æ„ä½“ã€‚å¯¹äºå¯åŠ¨çš„ jsonï¼Œå®é™…è¦è¡¨ç°çš„æ–¹æ³•è°ƒç”¨é“¾å’Œ json çš„å±‚çº§å¹¶ä¸æ˜¯å¯¹åº”çš„ã€‚æ–¹æ³•è°ƒç”¨é“¾æ˜¯é€šè¿‡ ph å­—æ®µè¡¨ç¤ºï¼ŒB è¡¨ç¤ºæ–¹æ³•å¼€å§‹ï¼ŒE è¡¨ç¤ºæ–¹æ³•ç»“æŸï¼Œä¸­é—´ä¼šæœ‰å…¶å®ƒæ–¹æ³•è°ƒç”¨çš„é—­åˆï¼Œè¿™äº›æ–¹æ³•åœ¨è°ƒç”¨é“¾é‡Œå¯ä»¥è¢«ç§°ä¸ºè°ƒç”¨æ–¹æ³•çš„å­æ–¹æ³•ã€‚</p>
<p>ä¸ºäº†èƒ½å¤Ÿè¡¨ç°å‡ºè¿™æ ·çš„è°ƒç”¨é“¾å…³ç³»ï¼Œæˆ‘è®¾è®¡äº†ä¸‹é¢çš„ LaunchItem ç»“æ„ï¼š</p>
<p><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/10.png" alt=""></p>
<p>ç»“æ„ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">LaunchItem</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> name: <span class="type">String</span>  <span class="comment">// è°ƒç”¨æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> ph: <span class="type">String</span>    <span class="comment">// B ä»£è¡¨å¼€å§‹ã€E ä»£è¡¨ç»“æŸã€BE ä»£è¡¨åˆå¹¶åçš„ Itemã€å…¶å®ƒä»£è¡¨æè¿°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> ts: <span class="type">String</span>    <span class="comment">// æ—¶é—´æˆ³ï¼Œå¼€å§‹æ—¶é—´</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> cost: <span class="type">Int</span>     <span class="comment">// è€—æ—¶ ms</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> times: <span class="type">Int</span>    <span class="comment">// æ‰§è¡Œæ¬¡æ•°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> subItem: [<span class="type">LaunchItem</span>]   <span class="comment">// å­ item</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> parentItem:[<span class="type">LaunchItem</span>] <span class="comment">// çˆ¶ item</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ ParseJSONTokens ç±»æ¥è·å– JSONToken çš„é›†åˆã€‚<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tks <span class="operator">=</span> <span class="type">ParseJSONTokens</span>(input: input).parse()</span><br></pre></td></tr></table></figure></p>
<p>æ‰¾å‡º nameã€phã€ts å­—æ®µæ•°æ®è½¬åˆ° LaunchItem ç»“æ„ä½“ä¸­ã€‚è¿™éƒ¨åˆ†ä»£ç å®ç°åœ¨è¿™é‡Œ <a href="https://github.com/ming1016/MethodTraceAnalyze/blob/master/MethodTraceAnalyze/Launch/ParseLaunchJSON.swift">MethodTraceAnalyze/ParseLaunchJSON.swift</a>ã€‚</p>
<p>éå† LaunchItem é›†åˆï¼Œå®Œå–„ LaunchItem çš„ä¿¡æ¯ï¼Œå…ˆå®Œå–„ LaunchItem çš„ cost å’Œ subItem çš„ä¿¡æ¯ã€‚åœ¨æ–¹æ³•è°ƒç”¨é“¾åŒä¸€çº§æ—¶ä¾æ® ph å­—æ®µå°†ç›¸åŒæ–¹æ³• B å’Œ E ä¹‹é—´çš„ LaunchItem éƒ½æ”¾åˆ°ä¸€ä¸ªæ•°ç»„é‡Œï¼Œé€šè¿‡æ ˆé¡¶å’Œæ ˆåº•çš„ ts å­—æ®µå€¼ç›¸å‡å°±èƒ½å¤Ÿå¾—åˆ° cost çš„å€¼ï¼Œä¹Ÿå°±æ˜¯æ–¹æ³•çš„è€—æ—¶ï¼Œä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> b <span class="operator">=</span> itemArr[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">let</span> e <span class="operator">=</span> itemArr[itemArr.count <span class="operator">-</span> <span class="number">1</span>]</span><br><span class="line"><span class="keyword">let</span> cost <span class="operator">=</span> <span class="type">Int</span>(e.ts)<span class="operator">!</span> <span class="operator">-</span> <span class="type">Int</span>(b.ts)<span class="operator">!</span></span><br></pre></td></tr></table></figure></p>
<p>å½“è¿™ä¸ªæ•°ç»„æ•°é‡å¤§äº2ï¼Œä»£è¡¨æ–¹æ³•é‡Œè¿˜ä¼šè°ƒç”¨å…¶å®ƒçš„æ–¹æ³•ï¼Œé€šè¿‡é€’å½’å°†è°ƒç”¨é“¾ä¸­çš„å­æ–¹æ³•éƒ½å–å‡ºæ¥ï¼Œå¹¶æ”¾åˆ° subItem é‡Œã€‚<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pItem.subItem.append(recusiveMethodTree(parentItem: rPItem, items: newItemArr))</span><br></pre></td></tr></table></figure></p>
<p>ä»£ç è§<a href="https://github.com/ming1016/MethodTraceAnalyze/blob/master/MethodTraceAnalyze/Launch/LaunchJSON.swift">MethodTraceAnalyze/LaunchJSON.swift</a>é‡Œçš„ launchJSON å‡½æ•°ã€‚</p>
<h3 id="å±•ç¤ºå¯åŠ¨æ–¹æ³•é“¾"><a href="#å±•ç¤ºå¯åŠ¨æ–¹æ³•é“¾" class="headerlink" title="å±•ç¤ºå¯åŠ¨æ–¹æ³•é“¾"></a>å±•ç¤ºå¯åŠ¨æ–¹æ³•é“¾</h3><p>å‰é¢é€šè¿‡ launchJSON å‡½æ•°å–åˆ°äº†æ–¹æ³•è°ƒç”¨é“¾çš„æ ¹éƒ¨ LaunchItemã€‚ä½¿ç”¨ recusiveItemTree å‡½æ•°é€’å½’è¿™ä¸ªæ ¹ LaunchItem ï¼Œå¯ä»¥è¾“å‡ºæ–¹æ³•è°ƒç”¨å…³ç³»å›¾ã€‚å¾ˆå¤šå·¥ç¨‹åœ¨å¯åŠ¨é˜¶æ®µä¼šæ‰§è¡Œå¤§é‡æ–¹æ³•ï¼Œå¾ˆå¤šæ–¹æ³•è€—æ—¶å¾ˆå°‘ï¼Œå¯ä»¥è¿‡æ»¤é‚£äº›å°äº10æ¯«ç§’çš„æ–¹æ³•ï¼Œè®©åˆ†ææ›´åŠ èšç„¦ã€‚</p>
<p><img src="/uploads/how-to-analyze-startup-time-cost-in-ios/03.png" alt=""></p>
<p>å±•ç¤ºæ•ˆæœå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå®Œæ•´ä»£ç åœ¨ <a href="https://github.com/ming1016/MethodTraceAnalyze/blob/master/MethodTraceAnalyze/Launch/LaunchJSON.swift">MethodTraceAnalyze/LaunchJSON.swift</a> é‡Œçš„ tree å‡½æ•°é‡Œã€‚å›¾ä¸­çš„é˜¶æ®µåˆ‡æ¢ï¼Œæ¯”å¦‚ T1åˆ° T2çš„åˆ‡æ¢å¯ä»¥åœ¨ recusiveItemTree å‡½æ•°ä¸­è®¾ç½®ï¼Œå¯¹åº”çš„å¤„ç†ä»£ç æ˜¯ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å– T1 åˆ° T5 é˜¶æ®µä¿¡æ¯ï¼Œå…¶ä¸­ updateLauncherState å‡½æ•°åéœ€è¦æ›¿æ¢æˆè‡ªå·±é˜¶æ®µåˆ‡æ¢çš„å‡½æ•°åï¼Œæœ€å¤š5ä¸ªé˜¶æ®µ</span></span><br><span class="line"><span class="keyword">if</span> methodName <span class="operator">==</span> â€œupdateLauncherState:â€ &#123;</span><br><span class="line">    currentT <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> currentT <span class="operator">&gt;</span> <span class="number">5</span> &#123;</span><br><span class="line">        currentT <span class="operator">=</span> <span class="number">5</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è€—æ—¶çš„é«˜ä½ä¹Ÿåšäº†é¢œè‰²çš„åŒºåˆ†ã€‚å¤–éƒ¨è€—æ—¶æŒ‡çš„æ˜¯å­æ–¹æ³•ä»¥å¤–ç³»ç»Ÿæˆ–æ²¡æºç çš„ä¸‰æ–¹æ–¹æ³•çš„è€—æ—¶ï¼Œè§„åˆ™æ˜¯çˆ¶æ–¹æ³•è°ƒç”¨çš„è€—æ—¶å‡å»å…¶å­æ–¹æ³•æ€»è€—æ—¶ã€‚ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–å¤–éƒ¨è€—æ—¶</span></span><br><span class="line"><span class="keyword">var</span> sysCost <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">if</span> aItem.subItem.count <span class="operator">&gt;</span> <span class="number">0</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> aSubItem <span class="keyword">in</span> aItem.subItem &#123;</span><br><span class="line">        sysCost <span class="operator">+=</span> aSubItem.cost</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">sysCost <span class="operator">=</span> (aItem.cost <span class="operator">-</span> sysCost) <span class="operator">/</span> <span class="number">1000</span></span><br></pre></td></tr></table></figure></p>
<p>bundleã€ownerã€ä¸šåŠ¡çº¿è¿™ä¸‰é¡¹éœ€è¦æ ¹æ®è‡ªå·±å·¥ç¨‹æƒ…å†µæ¥ï¼Œå¦‚æœå·¥ç¨‹ä½¿ç”¨çš„æ˜¯ excel åšçš„è®°å½•å¯ä»¥å¯¼å‡ºä¸º csv æ ¼å¼æ–‡ä»¶ï¼Œå‚è€ƒ LaunchJSON ç±»é‡Œçš„ loadSimpleKeyValueDicWithCsv å‡½æ•°è¿›è¡Œ csv æ•°æ®è¯»å–ã€‚å¦‚æœæ•°æ®æ˜¯åœ¨æœåŠ¡ç«¯ï¼Œè¾“å‡ºä¸º json çš„è¯å°±æ›´å¥½åŠäº†ï¼Œä½¿ç”¨å‰é¢å†™çš„ ParseJSONItem ç±»å°±èƒ½å¤Ÿè¿›è¡Œæ•°æ®è§£æäº†ï¼Œå¯ä»¥å‚è€ƒ LaunchJSON ç±»é‡Œçš„ parseBundleOwner å‡½æ•°ã€‚å±•ç¤ºç¤ºä¾‹é‡Œæˆ‘å…ˆç½®ä¸ºé»˜è®¤çš„æš‚æ— äº†ã€‚</p>
<p>ç›®å‰ä¸ºæ­¢é€šè¿‡è¿‡æ»¤è€—æ—¶å°‘çš„æ–¹æ³•è°ƒç”¨ï¼Œå¯ä»¥æ›´å®¹æ˜“å‘ç°é—®é¢˜æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œæœ‰äº›æ–¹æ³•å•æ¬¡æ‰§è¡Œè€—æ—¶ä¸å¤šï¼Œä½†æ˜¯ä¼šæ‰§è¡Œå¾ˆå¤šæ¬¡ï¼Œç´¯åŠ è€—æ—¶ä¼šå¤§ï¼Œè¿™æ ·çš„æƒ…å†µä¹Ÿéœ€è¦ä½“ç°åœ¨å±•ç¤ºé¡µé¢é‡Œã€‚å¦å¤–å¤–éƒ¨è€—æ—¶é«˜æ—¶æˆ–è€…ç¢°åˆ°è‡ªå·±ä¸äº†è§£çš„æ–¹æ³•æ—¶ï¼Œæ˜¯éœ€è¦åˆ°å·¥ç¨‹æºç é‡Œå»æœç´¢å¯¹åº”çš„æ–¹æ³•æºç è¿›è¡Œåˆ†æçš„ï¼Œæœ‰çš„æ–¹æ³•åå¾ˆé€šç”¨æ—¶è¿˜éœ€è¦èŠ±å¤§é‡æ—¶é—´å»è¿‡æ»¤æ— ç”¨ä¿¡æ¯ã€‚</p>
<p>å› æ­¤æ¥ä¸‹æ¥è¿˜éœ€è¦åšä¸¤ä»¶äº‹æƒ…ï¼Œé¦–å…ˆç´¯åŠ æ–¹æ³•è°ƒç”¨æ¬¡æ•°å’Œè€—æ—¶ï¼Œä½“ç°åœ¨å±•ç¤ºé¡µé¢ä¸­ï¼Œå¦ä¸€ä¸ªæ˜¯ä»å·¥ç¨‹ä¸­è·å–æ–¹æ³•æºç èƒ½å¤Ÿåœ¨å±•ç¤ºé¡µé¢ä¸­è¿›è¡Œç‚¹å‡»æ˜¾ç¤ºã€‚</p>
<p>å¯¹äºæ–¹æ³•è°ƒç”¨æ¬¡æ•°å’Œæ€»è€—æ—¶çš„ç»Ÿè®¡æˆ‘å†™åœ¨äº† LaunchJSON ç±»çš„ allMethodAndSubMethods å‡½æ•°é‡Œï¼Œæ€è·¯å°±æ˜¯éå†æ‰€æœ‰çš„ LaunchItemï¼Œç¢°åˆ°ç›¸åŒçš„ item name å°±å¯¹æ¬¡æ•°å’Œè€—æ—¶è¿›è¡Œç´¯åŠ ã€‚ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> allItems <span class="operator">=</span> <span class="type">LaunchJSON</span>.leaf(fileName: fileName, isGetAllItem: <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mergeDic <span class="operator">=</span> [<span class="type">String</span>:<span class="type">LaunchItem</span>]()</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> allItems &#123;</span><br><span class="line">    <span class="keyword">let</span> mergeKey <span class="operator">=</span> item.name <span class="comment">// æ–¹æ³•åä¸ºæ ‡è¯†</span></span><br><span class="line">    <span class="keyword">if</span> mergeDic[mergeKey] <span class="operator">!=</span> <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> newItem <span class="operator">=</span> mergeDic[mergeKey]</span><br><span class="line">        newItem<span class="operator">?</span>.cost <span class="operator">+=</span> item.cost <span class="comment">// ç´¯åŠ è€—æ—¶</span></span><br><span class="line">        newItem<span class="operator">?</span>.times <span class="operator">+=</span> <span class="number">1</span> <span class="comment">// ç´¯åŠ æ¬¡æ•°</span></span><br><span class="line">        mergeDic[mergeKey] <span class="operator">=</span> newItem</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        mergeDic[mergeKey] <span class="operator">=</span> item</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å±•ç¤ºæ—¶åˆ¤æ–­æ¬¡æ•°å¤§äº1æ—¶ï¼Œè€—æ—¶å¤§äº0æ—¶å±•ç¤ºå‡ºæ¥ã€‚<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mergeStr <span class="operator">=</span> â€œâ€</span><br><span class="line"><span class="keyword">if</span> preMergeItemDic.keys.contains(â€œ\(bundleName<span class="operator">+</span>className<span class="operator">+</span>methodName)â€) &#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="keyword">let</span> mItem <span class="operator">=</span> preMergeItemDic[â€œ\(bundleName<span class="operator">+</span>className<span class="operator">+</span>methodName)â€]</span><br><span class="line">    <span class="keyword">if</span> mItem<span class="operator">?</span>.times <span class="operator">??</span> <span class="number">0</span> <span class="operator">&gt;</span> <span class="number">1</span> <span class="operator">&amp;&amp;</span> (mItem<span class="operator">?</span>.cost <span class="operator">??</span> <span class="number">0</span>) <span class="operator">/</span> <span class="number">1000</span> <span class="operator">&gt;</span> <span class="number">0</span> &#123;</span><br><span class="line">        mergeStr <span class="operator">=</span> â€œ(æ€»æ¬¡æ•°\(mItem<span class="operator">?</span>.times <span class="operator">??</span> <span class="number">0</span>)<span class="operator">ã€</span>æ€»è€—æ—¶\((mItem<span class="operator">?</span>.cost <span class="operator">??</span> <span class="number">0</span>) <span class="operator">/</span> <span class="number">1000</span>))â€</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å±•ç¤ºçš„æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="/uploads/how-to-analyze-startup-time-cost-in-ios/04.png" alt=""></p>
<h3 id="å±•ç¤ºæ–¹æ³•æºç "><a href="#å±•ç¤ºæ–¹æ³•æºç " class="headerlink" title="å±•ç¤ºæ–¹æ³•æºç "></a>å±•ç¤ºæ–¹æ³•æºç </h3><p>åœ¨é¡µé¢ä¸Šå±•ç¤ºæºç éœ€è¦å…ˆè§£æ .xcworkspace æ–‡ä»¶ï¼Œé€šè¿‡ .xcworkspaceæ–‡ä»¶å–åˆ°å·¥ç¨‹é‡Œæ‰€æœ‰çš„ .xcodeproj æ–‡ä»¶ã€‚åˆ†æ .xcodeproj æ–‡ä»¶å–åˆ°æ‰€æœ‰ .m å’Œ.mm æºç æ–‡ä»¶è·¯å¾„ï¼Œè§£ææºç ï¼Œå–åˆ°æ–¹æ³•çš„æºç å†…å®¹è¿›è¡Œå±•ç¤ºã€‚</p>
<h4 id="è§£æ-xcworkspace"><a href="#è§£æ-xcworkspace" class="headerlink" title="è§£æ .xcworkspace"></a>è§£æ .xcworkspace</h4><p><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/11.png" alt=""></p>
<p>æ‰“å¼€.xcworkspaceï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªåŒ…å†…ä¸»è¦æ–‡ä»¶æ˜¯ contents.xcworkspacedataã€‚å†…å®¹æ˜¯ä¸€ä¸ª xmlï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Workspace</span></span></span><br><span class="line"><span class="tag">   <span class="attr">version</span> = <span class="string">&quot;1.0&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">FileRef</span></span></span><br><span class="line"><span class="tag">      <span class="attr">location</span> = <span class="string">&quot;group:GCDFetchFeed.xcodeproj&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">FileRef</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">FileRef</span></span></span><br><span class="line"><span class="tag">      <span class="attr">location</span> = <span class="string">&quot;group:Pods/Pods.xcodeproj&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">FileRef</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Workspace</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>æ‰€ä»¥ä¸‹é¢éœ€è¦å¯¹ xml è¿›è¡Œåˆ†æã€‚xml çš„æ“ä½œç¬¦æœ‰ &lt;&gt;=\â€/?![]ï¼Œé€šè¿‡è¿™äº›æ“ä½œç¬¦èƒ½å¤Ÿå–åˆ°é€šç”¨çš„ token é›†åˆ tokensã€‚<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tokens <span class="operator">=</span> <span class="type">Lexer</span>(input: input, type: .plain).allTkFast(operaters: â€œ<span class="operator">&lt;&gt;=</span>\â€<span class="operator">/?!</span>[]â€)</span><br></pre></td></tr></table></figure></p>
<p>æ ¹æ® xml çš„è§„åˆ™ï¼Œå°†è§£æçŠ¶æ€åˆ†ä¸º normalã€startTagã€cdata ä¸‰ç§ã€‚å®šä¹‰çš„æšä¸¾ä¸ºï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">enum</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> normal</span><br><span class="line">    <span class="keyword">case</span> startTag</span><br><span class="line">    <span class="keyword">case</span> cdata</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å½“é‡åˆ°&lt;ç¬¦å·æ—¶ï¼Œæ›´æ”¹è§£æçŠ¶æ€ä¸º startTagã€‚å¦‚æœ&lt;ç¬¦å·åé¢è·Ÿçš„æ˜¯![CDATA[è¡¨ç¤ºæ˜¯ cdata æ ‡ç­¾ï¼ŒçŠ¶æ€éœ€è¦æ”¹æˆ cdataã€‚å®ç°ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &lt;tagname â€¦&gt; å’Œ &lt;![CDATA[</span></span><br><span class="line"><span class="keyword">if</span> currentState <span class="operator">==</span> .normal <span class="operator">&amp;&amp;</span> currentToken <span class="operator">==</span> .id(â€œ<span class="operator">&lt;</span>â€œ) &#123;</span><br><span class="line">    <span class="comment">// &lt;![CDATA[</span></span><br><span class="line">    <span class="keyword">if</span> peekTk() <span class="operator">==</span> .id(â€œ<span class="operator">!</span>â€) <span class="operator">&amp;&amp;</span> peekTkStep(step: <span class="number">2</span>) <span class="operator">==</span> .id(â€œ[â€œ) <span class="operator">&amp;&amp;</span> peekTkStep(step: <span class="number">3</span>) <span class="operator">==</span> .id(â€œ<span class="type">CDATA</span>â€) <span class="operator">&amp;&amp;</span> peekTkStep(step: <span class="number">4</span>) <span class="operator">==</span> .id(â€œ[â€œ) &#123;</span><br><span class="line">        currentState <span class="operator">=</span> .cdata</span><br><span class="line">        advanceTk() <span class="comment">// jump &lt;</span></span><br><span class="line">        advanceTk() <span class="comment">// jump !</span></span><br><span class="line">        advanceTk() <span class="comment">// jump [</span></span><br><span class="line">        advanceTk() <span class="comment">// jump CDATA</span></span><br><span class="line">        advanceTk() <span class="comment">// jump [</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// &lt;tagname â€¦&gt;</span></span><br><span class="line">    <span class="keyword">if</span> currentTokens.count <span class="operator">&gt;</span> <span class="number">0</span> &#123;</span><br><span class="line">        addTagTokens(type: .value) <span class="comment">// ç»“æŸä¸€ç»„</span></span><br><span class="line">    &#125;</span><br><span class="line">    currentState <span class="operator">=</span> .startTag</span><br><span class="line">    advanceTk()</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åœ¨ startTag å’Œ cdata çŠ¶æ€æ—¶ä¼šå°†é‡åˆ°çš„ token è£…åˆ° currentTokens é‡Œï¼Œåœ¨ç»“æŸçŠ¶æ€æ—¶åŠ å…¥åˆ° XMLTagTokens è¿™ä¸ªç»“æ„é‡Œè®°å½•ä¸‹æ¥ã€‚XMLTagTokens çš„å®šä¹‰å¦‚ä¸‹ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">XMLTagTokens</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> type: <span class="type">XMLTagTokensType</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> tokens: [<span class="type">Token</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>currentTokens ä¼šåœ¨çŠ¶æ€ç»“æŸæ—¶è®°å½•åˆ° XMLTagTokens çš„ tokens é‡Œã€‚startTag ä¼šåœ¨&gt;ç¬¦å·æ—¶ç»“æŸã€‚cdata ä¼šåœ¨]]&gt;æ—¶ç»“æŸã€‚è¿™éƒ¨åˆ†å®ç°ä»£ç è§ <a href="https://github.com/ming1016/MethodTraceAnalyze/blob/master/MethodTraceAnalyze/XML/ParseStandXMLTagTokens.swift">MethodTraceAnalyze/ParseStandXMLTagTokens.swift</a> ã€‚</p>
<p>æ¥ä¸‹æ¥å¯¹ XMLTagTokens é›†åˆè¿›è¡Œè¿›ä¸€æ­¥åˆ†æï¼ŒXML çš„ tag èŠ‚ç‚¹åˆ†ä¸ºå•æ ‡ç­¾æ¯”å¦‚<br/>ã€å¼€æ ‡ç­¾æ¯”å¦‚<p>ã€é—­åˆæ ‡ç­¾æ¯”å¦‚</p>ã€æ ‡ç­¾å€¼ã€xml æ ‡è¯†è¯´æ˜ï¼Œè¿™äº”ç±»ã€‚å› æ­¤æˆ‘å®šä¹‰äº†æ ‡ç­¾èŠ‚ç‚¹çš„ç±»å‹æšä¸¾ XMLTagNodeTypeï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">XMLTagNodeType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> xml</span><br><span class="line">    <span class="keyword">case</span> single <span class="comment">// å•ä¸ªæ ‡ç­¾</span></span><br><span class="line">    <span class="keyword">case</span> start  <span class="comment">// å¼€æ ‡ç­¾ &lt;p&gt;</span></span><br><span class="line">    <span class="keyword">case</span> value  <span class="comment">// æ ‡ç­¾çš„å€¼ &lt;p&gt;value&lt;/p&gt;</span></span><br><span class="line">    <span class="keyword">case</span> end    <span class="comment">// é—­åˆçš„æ ‡ç­¾ &lt;/p&gt;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ ‡ç­¾èŠ‚ç‚¹é™¤äº†ç±»å‹ä¿¡æ¯ï¼Œè¿˜éœ€è¦æœ‰å±æ€§é›†åˆã€æ ‡ç­¾åå’Œæ ‡ç­¾å€¼ï¼Œç»“æ„ä½“å®šä¹‰ä¸ºï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">XMLTagNode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> type: <span class="type">XMLTagNodeType</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> value: <span class="type">String</span> <span class="comment">// æ ‡ç­¾å€¼</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> name: <span class="type">String</span>  <span class="comment">// æ ‡ç­¾å</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> attributes: [<span class="type">XMLTagAttribute</span>] <span class="comment">// æ ‡ç­¾å±æ€§</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è§£æ XML æ ‡ç­¾èŠ‚ç‚¹ç›¸æ¯”è¾ƒäº HTML æ¥è¯´ä¼šç®€åŒ–äº›ï¼ŒHTMLçš„è§„åˆ™æ›´åŠ çš„å¤æ‚ï¼Œä»¥å‰ä½¿ç”¨çŠ¶æ€æœºæ ¹æ® W3C æ ‡å‡†<a href="https://html.spec.whatwg.org/multipage/parsing.html#html-parser">HTML Standard</a>ä¸“é—¨è§£æè¿‡ï¼ŒçŠ¶æ€æœºæ¯”è¾ƒé€‚åˆäºå¤æ‚çš„åœºæ™¯ï¼Œå…·ä½“ä»£ç åœ¨è¿™é‡Œ <a href="https://github.com/ming1016/HTN/blob/master/Sources/Core/HTML/HTMLTokenizer.swift">HTN/HTMLTokenizer.swift</a> ã€‚å¯ä»¥çœ‹åˆ°æŒ‰ç…§ W3C çš„æ ‡å‡†ï¼Œè®¾è®¡äº†ä¸€ä¸ª HTNStateType çŠ¶æ€æšä¸¾ï¼ŒçŠ¶æ€ç‰¹åˆ«å¤šã€‚å¯¹äº XML æ¥è¯´çŠ¶æ€ä¼šå°‘äº›ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">pTagState</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> start</span><br><span class="line">    <span class="keyword">case</span> questionMark</span><br><span class="line">    <span class="keyword">case</span> xml</span><br><span class="line">    <span class="keyword">case</span> tagName</span><br><span class="line">    <span class="keyword">case</span> attributeName</span><br><span class="line">    <span class="keyword">case</span> equal</span><br><span class="line">    <span class="keyword">case</span> attributeValue</span><br><span class="line">    <span class="keyword">case</span> startForwardSlash</span><br><span class="line">    <span class="keyword">case</span> endForwardSlash</span><br><span class="line">    <span class="keyword">case</span> startDoubleQuotationMarks</span><br><span class="line">    <span class="keyword">case</span> backSlash</span><br><span class="line">    <span class="keyword">case</span> endDoubleQuotationMarks</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>XML  æ ‡ç­¾èŠ‚ç‚¹çš„è§£ææˆ‘æ²¡æœ‰ç”¨çŠ¶æ€æœºï¼Œå°†è§£æç»“æœè®°å½•åˆ°äº† XMLTagNode ç»“æ„ä½“ä¸­ã€‚æ ‡ç­¾èŠ‚ç‚¹è§£æè¿‡ç¨‹ä»£ç åœ¨è¿™é‡Œ <a href="https://github.com/ming1016/MethodTraceAnalyze/blob/master/MethodTraceAnalyze/XML/ParseStandXMLTags.swift">MethodTraceAnalyze/ParseStandXMLTags.swift</a> ã€‚æ ‡ç­¾èŠ‚ç‚¹è§£æå®Œåè¿˜éœ€è¦è§£å†³ XML çš„å±‚çº§é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯æ ‡ç­¾åŒ…å«æ ‡ç­¾çš„é—®é¢˜ã€‚</p>
<p>å…ˆå®šä¹‰ä¸€ä¸ªç»“æ„ä½“ XMLNodeï¼Œç”¨æ¥è®°å½• XML çš„èŠ‚ç‚¹æ ‘ï¼š</p>
<p><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/12.png" alt=""></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">XMLNode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> attributes: [<span class="type">XMLTagAttribute</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> value: <span class="type">String</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> subNodes: [<span class="type">XMLNode</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ subNodes æ˜¯ XMLNode çš„å­èŠ‚ç‚¹é›†åˆï¼Œè§£æå‡º XMLNode çš„æ€è·¯æ˜¯æ ¹æ®å‰é¢è¾“å‡ºçš„ XMLTagNode çš„ç±»å‹æ¥åˆ†æï¼Œå½“é‡åˆ°ç±»å‹æ˜¯ start åˆ°é‡åˆ°ç›¸åŒ name çš„ end ä¹‹é—´ä¸æ–­æ”¶é›† XMLTagNode åˆ° currentTagNodeArr æ•°ç»„é‡Œï¼Œend æ—¶å°†è¿™ä¸ªæ•°ç»„æ·»åŠ åˆ° tagNodeArrs é‡Œï¼Œç„¶åå¼€å§‹æ”¶é›†ä¸‹ä¸€ç»„ start å’Œ endã€‚å…³é”®ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å½“é‡åˆ°.end ç±»å‹æ—¶å°†ä¸€ç»„ XMLTagNode åŠ åˆ° tagNodeArrs é‡Œã€‚ç„¶åé‡ç½®ã€‚</span></span><br><span class="line"><span class="keyword">if</span> node.type <span class="operator">==</span> .end <span class="operator">&amp;&amp;</span> node.name <span class="operator">==</span> currentTagName &#123;</span><br><span class="line">    currentState <span class="operator">=</span> .end</span><br><span class="line">    currentTagNodeArr.append(node)</span><br><span class="line">    <span class="comment">// æ·»åŠ åˆ°ä¸€çº§</span></span><br><span class="line">    tagNodeArrs.append(currentTagNodeArr)</span><br><span class="line">    <span class="comment">// é‡ç½®</span></span><br><span class="line">    currentTagNodeArr <span class="operator">=</span> [<span class="type">XMLTagNode</span>]()</span><br><span class="line">    currentTagName <span class="operator">=</span> â€œâ€</span><br><span class="line">    <span class="keyword">continue</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¯¹äº xml ç±»å‹æ ‡ç­¾å’Œ single ç±»å‹çš„ä¼šç›´æ¥ä¿å­˜åˆ° tagNodeArrs é‡Œã€‚æ¥ä¸‹æ¥å¯¹ tagNodeArrs è¿™äº›ç”± XMLTagNode ç»„æˆçš„æ•°ç»„é›†è¿›è¡Œåˆ†æã€‚å¦‚æœ tagNodeArr çš„æ•°ç»„æ•°é‡æ˜¯1æ—¶ï¼Œè¡¨ç¤ºè¿™ä¸€å±‚çº§çš„ tag æ˜¯ xml æˆ–è€…å•æ ‡ç­¾çš„æƒ…å†µæ¯”å¦‚&lt;?xml version=â€1.0â€ encoding=â€UTF-8â€?&gt; æˆ– <link href=â€œ/atom.xmlâ€ rel=â€œselfâ€/> è¿™ç§ã€‚æ•°é‡æ˜¯2æ—¶è¡¨ç¤ºå¼€é—­æ ‡ç­¾é‡Œæ²¡æœ‰å…¶ä»–çš„æ ‡ç­¾ï¼Œç±»ä¼¼<p></p>è¿™ç§ã€‚å½“ tagNodeArr çš„æ•°é‡å¤§äº2æ—¶ï¼Œå¯èƒ½æœ‰ä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯ tagNode ä¸º value ç±»å‹æ¯”å¦‚<p>section value</p>ï¼Œå…¶ä»–æƒ…å†µå°±æ˜¯æ ‡ç­¾é‡Œä¼šåµŒå¥—æ ‡ç­¾ï¼Œéœ€è¦é€’å½’è°ƒç”¨ recusiveParseTagNodes å‡½æ•°è¿›è¡Œä¸‹ä¸€çº§çš„è§£æã€‚è¿™éƒ¨åˆ†é€»è¾‘åœ¨ recusiveParseTagNodes å‡½æ•°é‡Œï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> tagNodeArr <span class="keyword">in</span> tagNodeArrs &#123;</span><br><span class="line">    <span class="keyword">if</span> tagNodeArr.count <span class="operator">==</span> <span class="number">1</span> &#123;</span><br><span class="line">        <span class="comment">// åªæœ‰ä¸€ä¸ªçš„æƒ…å†µï¼Œå³ xml å’Œ single</span></span><br><span class="line">        <span class="keyword">let</span> aTagNode <span class="operator">=</span> tagNodeArr[<span class="number">0</span>]</span><br><span class="line">        pNode.subNodes.append(tagNodeToNode(tagNode: aTagNode))</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> tagNodeArr.count <span class="operator">==</span> <span class="number">2</span> &#123;</span><br><span class="line">        <span class="comment">// 2ä¸ªçš„æƒ…å†µï¼Œå°±æ˜¯æ¯”å¦‚ &lt;p&gt;&lt;/p&gt;</span></span><br><span class="line">        <span class="keyword">let</span> aTagNode <span class="operator">=</span> tagNodeArr[<span class="number">0</span>] <span class="comment">// å– start çš„ä¿¡æ¯</span></span><br><span class="line">        pNode.subNodes.append(tagNodeToNode(tagNode: aTagNode))</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> tagNodeArr.count <span class="operator">&gt;</span> <span class="number">2</span> &#123;</span><br><span class="line">        <span class="comment">// å¤§äº2ä¸ªçš„æƒ…å†µ</span></span><br><span class="line">        <span class="keyword">let</span> startTagNode <span class="operator">=</span> tagNodeArr[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">var</span> startNode <span class="operator">=</span> tagNodeToNode(tagNode: startTagNode)</span><br><span class="line">        <span class="keyword">let</span> secondTagNode <span class="operator">=</span> tagNodeArr[<span class="number">1</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åˆ¤æ–­æ˜¯å¦æ˜¯ value è¿™ç§æƒ…å†µæ¯”å¦‚ &lt;p&gt;paragraph&lt;/p&gt;</span></span><br><span class="line">        <span class="keyword">if</span> secondTagNode.type <span class="operator">==</span> .value &#123;</span><br><span class="line">            <span class="comment">// æœ‰ value çš„å¤„ç†</span></span><br><span class="line">            startNode.value <span class="operator">=</span> secondTagNode.value.trimmingCharacters(in: <span class="type">CharacterSet</span>.whitespacesAndNewlines)</span><br><span class="line">            pNode.subNodes.append(startNode)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// æœ‰å­æ ‡ç­¾çš„æƒ…å†µ</span></span><br><span class="line">            <span class="comment">// é€’å½’å¾—åˆ°ç»“æœ</span></span><br><span class="line">            <span class="keyword">var</span> newTagNodeArr <span class="operator">=</span> tagNodeArr</span><br><span class="line">            newTagNodeArr.remove(at: tagNodeArr.count <span class="operator">-</span> <span class="number">1</span>)</span><br><span class="line">            newTagNodeArr.remove(at: <span class="number">0</span>)</span><br><span class="line">            pNode.subNodes.append(recusiveParseTagNodes(parentNode: startNode, tagNodes: newTagNodeArr))</span><br><span class="line">        &#125; <span class="comment">// end else</span></span><br><span class="line">    &#125; <span class="comment">// end else if</span></span><br><span class="line">&#125; <span class="comment">// end for</span></span><br></pre></td></tr></table></figure></p>
<p>å®Œæˆ xcworkspace çš„ XML è§£æï¼Œè·å– XML çš„èŠ‚ç‚¹æ ‘å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="/uploads/how-to-analyze-startup-time-cost-in-ios/05.png" alt=""></p>
<p>å†™ä¸ªå•æµ‹ï¼Œä¿è¯åé¢å¢åŠ åŠŸèƒ½å’Œæ›´æ–°ä¼˜åŒ–è§£æåä¸ä¼šå½±å“ç»“æœã€‚å•æµ‹ä»£ç åœ¨è¿™é‡Œ <a href="https://github.com/ming1016/MethodTraceAnalyze/blob/master/MethodTraceAnalyze/XML/TestXML.swift">MethodTraceAnalyze/TestXML.swift</a>ã€‚</p>
<h4 id="è§£æ-xcodeproj"><a href="#è§£æ-xcodeproj" class="headerlink" title="è§£æ .xcodeproj"></a>è§£æ .xcodeproj</h4><p><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/13.png" alt=""></p>
<p>é€šè¿‡ XML çš„è§£æå¯ä»¥è·å– FileRef èŠ‚ç‚¹å†…å®¹ï¼Œ xcodeproj çš„æ–‡ä»¶è·¯å¾„å°±åœ¨ FileRef èŠ‚ç‚¹çš„ location å±æ€§é‡Œã€‚æ¯ä¸ª xcodeproj æ–‡ä»¶é‡Œä¼šæœ‰ project å·¥ç¨‹çš„æºç æ–‡ä»¶ã€‚ä¸ºäº†èƒ½å¤Ÿè·å–æ–¹æ³•çš„æºç è¿›è¡Œå±•ç¤ºï¼Œé‚£ä¹ˆå°±å…ˆè¦å–å‡ºæ‰€æœ‰ project å·¥ç¨‹é‡ŒåŒ…å«çš„æºæ–‡ä»¶çš„è·¯å¾„ã€‚</p>
<p>å– xcodeproj æ–‡ä»¶è·¯å¾„çš„æ–¹å¼å¦‚ä¸‹ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> aFile.fileName <span class="operator">==</span> â€œcontents.xcworkspacedataâ€ &#123;</span><br><span class="line">    <span class="keyword">let</span> root <span class="operator">=</span> <span class="type">ParseStandXML</span>(input: aFile.content).parse()</span><br><span class="line">    <span class="keyword">let</span> workspace <span class="operator">=</span> root.subNodes[<span class="number">1</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> fileRef <span class="keyword">in</span> workspace.subNodes &#123;</span><br><span class="line">        <span class="keyword">var</span> fileRefPath <span class="operator">=</span> fileRef.attributes[<span class="number">0</span>].value</span><br><span class="line">        fileRefPath.removeFirst(<span class="number">6</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åˆ¤æ–­æ˜¯ç›¸å¯¹è·¯å¾„è¿˜æ˜¯ç»å¯¹è·¯å¾„</span></span><br><span class="line">        <span class="keyword">let</span> arr <span class="operator">=</span> fileRefPath.split(separator: â€œ<span class="operator">/</span>â€œ)</span><br><span class="line">        <span class="keyword">var</span> projectPath <span class="operator">=</span> â€œâ€</span><br><span class="line">        <span class="keyword">if</span> arr.count <span class="operator">&gt;</span> <span class="number">2</span> &#123;</span><br><span class="line">            projectPath <span class="operator">=</span> â€œ\(fileRefPath)<span class="operator">/</span>project.pbxprojâ€</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            projectPath <span class="operator">=</span> â€œ<span class="operator">/</span>\(pathStr)<span class="operator">/</span>\(fileRefPath)<span class="operator">/</span>project.pbxprojâ€</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è¯»å– project æ–‡ä»¶å†…å®¹åˆ†æ</span></span><br><span class="line">        allSourceFile <span class="operator">+=</span> <span class="type">ParseXcodeprojSource</span>(input: projectPath).parseAllFiles()</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="comment">// end for fileRef in workspace.subNodes</span></span><br><span class="line">&#125; <span class="comment">// end for</span></span><br></pre></td></tr></table></figure></p>
<p>å¦‚ä¸Šé¢ä»£ç æ‰€ç¤ºï¼ŒParseXcodeprojSource æ˜¯ä¸“é—¨ç”¨æ¥è§£æ xcodeproj çš„ï¼ŒparseAllFiles æ–¹æ³•æ ¹æ®è§£æçš„ç»“æœï¼Œå–å‡ºæ‰€æœ‰ xcodeproj åŒ…å«çš„æºç æ–‡ä»¶ã€‚</p>
<p>xcodeproj çš„æ–‡ä»¶å†…å®¹çœ‹èµ·æ¥å¤§æ¦‚æ˜¯ä¸‹é¢çš„æ ·å­ã€‚</p>
<p><img src="/uploads/how-to-analyze-startup-time-cost-in-ios/06.png" alt=""></p>
<p>å…¶å®å†…å®¹è¿˜æœ‰å¾ˆå¤šï¼Œéœ€è¦ä¸€ä¸ªä¸ªè§£æå‡ºæ¥ã€‚</p>
<p>åˆ†æååˆ†è¯çš„åˆ†å‰²ç¬¦å·æœ‰ /*={};\â€,() è¿™äº›ï¼Œæ ¹æ®è¿™äº›åˆ†å‰²ç¬¦å·è®¾è®¡åˆ†è¯çš„ token ç±»å‹ XcodeprojTokensTypeï¼ŒXcodeprojTokensType ä¸ºæšä¸¾åŒ…å«ä¸‹é¢åä¸ªç±»å‹ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">XcodeprojTokensType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> codeComment <span class="comment">// æ³¨é‡Š</span></span><br><span class="line">    <span class="keyword">case</span> string</span><br><span class="line">    <span class="keyword">case</span> id</span><br><span class="line">    <span class="keyword">case</span> leftBrace <span class="comment">// &#123;</span></span><br><span class="line">    <span class="keyword">case</span> rightBrace <span class="comment">// &#125;</span></span><br><span class="line">    <span class="keyword">case</span> leftParenthesis <span class="comment">// (</span></span><br><span class="line">    <span class="keyword">case</span> rightParenthesis <span class="comment">// )</span></span><br><span class="line">    <span class="keyword">case</span> equal <span class="comment">// =</span></span><br><span class="line">    <span class="keyword">case</span> semicolon <span class="comment">// ;</span></span><br><span class="line">    <span class="keyword">case</span> comma <span class="comment">// ,</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>codeCommentã€stringã€id è¿™äº›ç±»å‹ä¼šç”±å¤šä¸ª token ç»„æˆï¼Œæ‰€ä»¥æœ€å¥½å°† xcodeproj çš„åŸºç¡€ token è®¾è®¡ä¸ºä¸‹é¢çš„æ ·å­ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">XcodeprojTokens</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> type: <span class="type">XcodeprojTokensType</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> tokens: [<span class="type">Token</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç”± tokens å­—æ®µè®°å½•å¤šä¸ª tokenã€‚å®ç°åˆ†è¯ä»£ç åœ¨è¿™ <a href="https://github.com/ming1016/MethodTraceAnalyze/blob/master/MethodTraceAnalyze/Xcodeproj/ParseXcodeprojTokens.swift">MethodTraceAnalyze/ParseXcodeprojTokens.swift</a></p>
<p>xcodeproj æ–‡ä»¶è™½ç„¶ä¸æ˜¯ jsonï¼Œä½†æ˜¯å¤§å°æ‹¬å·çš„è§„åˆ™å’Œ json è¿˜æ¯”è¾ƒç±»ä¼¼ï¼Œå¤§æ‹¬å·é‡Œçš„æ•°æ®ç±»ä¼¼å­—å…¸å¯ä»¥ç”¨ keyã€value é…å¯¹è®°å½•ï¼Œå°æ‹¬å·æ•°æ®ç±»ä¼¼æ•°ç»„ï¼Œè®°å½• value å°±å¯ä»¥ã€‚è¿™æ ·å¯ä»¥è®¾è®¡ xcodeproj çš„èŠ‚ç‚¹ç±»å‹ä¸ºï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">XcodeprojNodeType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> normal</span><br><span class="line">    <span class="keyword">case</span> root <span class="comment">// æ ¹èŠ‚ç‚¹</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">case</span> dicStart <span class="comment">// &#123;</span></span><br><span class="line">    <span class="keyword">case</span> dicKey</span><br><span class="line">    <span class="keyword">case</span> dicValue</span><br><span class="line">    <span class="keyword">case</span> dicEnd   <span class="comment">// &#125;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">case</span> arrStart <span class="comment">// (</span></span><br><span class="line">    <span class="keyword">case</span> arrValue</span><br><span class="line">    <span class="keyword">case</span> arrEnd   <span class="comment">// )</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¦‚ä¸Šé¢å®šä¹‰ XcodeprojNodeType æšä¸¾ï¼Œå…¶å¤§æ‹¬å·å†…æ•°æ®çš„ key ç±»å‹ä¸º dicKeyï¼Œvalue ç±»å‹ä¸º dicValueã€‚å°æ‹¬å·çš„ value ç±»å‹ä¸º arrValueã€‚èŠ‚ç‚¹è®¾è®¡ä¸ºï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">XcodeprojNode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> type: <span class="type">XcodeprojNodeType</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> value: <span class="type">String</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> codeComment: <span class="type">String</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> subNodes: [<span class="type">XcodeprojNode</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è§£æä»£ç éƒ½åœ¨è¿™é‡Œ <a href="https://github.com/ming1016/MethodTraceAnalyze/blob/master/MethodTraceAnalyze/Xcodeproj/ParseXcodeprojNode.swift">MethodTraceAnalyze/ParseXcodeprojNode.swift</a> ã€‚</p>
<p>xcodeproj ä¹Ÿæœ‰å±‚çº§ï¼Œæ‰€ä»¥ä¹Ÿéœ€è¦æ„å»ºä¸€ä¸ªæ ‘ç»“æ„ã€‚ç»“æ„ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">XcodeprojTreeNode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> type: <span class="type">XcodeprojTreeNodeType</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> value: <span class="type">String</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> comment: <span class="type">String</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> kvs: [<span class="type">XcodeprojTreeNodeKv</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> arr: [<span class="type">XcodeprojTreeNodeArrayValue</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">XcodeprojTreeNodeType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> value</span><br><span class="line">    <span class="keyword">case</span> keyValue</span><br><span class="line">    <span class="keyword">case</span> array</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">XcodeprojTreeNodeKey</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> comment: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">XcodeprojTreeNodeArrayValue</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> comment: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">XcodeprojTreeNodeKv</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> key: <span class="type">XcodeprojTreeNodeKey</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> value: <span class="type">XcodeprojTreeNode</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è€ƒè™‘åˆ° xcodeproj é‡Œçš„æ³¨é‡Šå¾ˆå¤šï¼Œä¹Ÿéƒ½å¾ˆæœ‰ç”¨ï¼Œå› æ­¤ä¼šå¤šè®¾è®¡äº›ç»“æ„æ¥ä¿å­˜å€¼å’Œæ³¨é‡Šã€‚æ€è·¯æ˜¯æ ¹æ® XcodeprojNode çš„ç±»å‹æ¥åˆ¤æ–­ä¸‹ä¸€çº§æ˜¯ key value ç»“æ„è¿˜æ˜¯ array ç»“æ„ã€‚å¦‚æœ XcodeprojNode çš„ç±»å‹æ˜¯ XcodeprojNode çš„ç±»å‹æ˜¯ dicStart è¡¨ç¤ºä¸‹çº§æ˜¯ key value ç»“æ„ã€‚å¦‚æœç±»å‹æ˜¯ arrStart å°±æ˜¯ array ç»“æ„ã€‚å½“ç¢°åˆ°ç±»å‹æ˜¯ dicEnd åŒæ—¶å’Œæœ€åˆ dicStart æ˜¯åŒçº§æ—¶ï¼Œé€’å½’ä¸‹ä¸€çº§æ ‘ç»“æ„ã€‚è€Œ arrEnd ä¸ç”¨é€’å½’ï¼Œxcodeproj é‡Œçš„ array åªæœ‰å€¼ç±»å‹çš„æ•°æ®ã€‚ç”ŸæˆèŠ‚ç‚¹æ ‘ç»“æ„è¿™éƒ¨åˆ†ä»£ç å®ç°åœ¨è¿™é‡Œ <a href="https://github.com/ming1016/MethodTraceAnalyze/blob/master/MethodTraceAnalyze/Xcodeproj/ParseXcodeprojTreeNode.swift">MethodTraceAnalyze/ParseXcodeprojTreeNode.swift</a></p>
<p>æ–­ç‚¹çœ‹ç”Ÿæˆçš„ç»“æ„å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/uploads/how-to-analyze-startup-time-cost-in-ios/07.png" alt=""></p>
<p>å…¶ä¸­ section å†…å®¹éƒ½åœ¨ objects é‡Œ</p>
<p><img src="/uploads/how-to-analyze-startup-time-cost-in-ios/08.png" alt=""></p>
<p>æœ‰äº†åŸºæœ¬èŠ‚ç‚¹æ ‘ç»“æ„ä»¥åå°±å¯ä»¥è®¾è®¡ xcodeproj é‡Œå„ä¸ª section çš„ç»“æ„ã€‚ä¸»è¦æœ‰ä¸€ä¸‹çš„ sectionï¼š</p>
<ul>
<li>PBXBuildFileï¼šæ–‡ä»¶ï¼Œæœ€ç»ˆä¼šå…³è”åˆ° PBXFileReference</li>
<li>PBXContainerItemProxyï¼šéƒ¨ç½²çš„å…ƒç´ </li>
<li>PBXFileReferenceï¼šå„ç±»æ–‡ä»¶ï¼Œæœ‰æºç ã€èµ„æºã€åº“ç­‰æ–‡ä»¶</li>
<li>PBXFrameworksBuildPhaseï¼šç”¨äº framework çš„æ„å»º</li>
<li>PBXGroupï¼šæ–‡ä»¶å¤¹ï¼Œå¯åµŒå¥—ï¼Œé‡Œé¢åŒ…å«äº†æ–‡ä»¶ä¸æ–‡ä»¶å¤¹çš„å…³ç³»</li>
<li>PBXNativeTargetï¼šTarget çš„è®¾ç½®</li>
<li>PBXProjectï¼šProject çš„è®¾ç½®ï¼Œæœ‰ç¼–è¯‘å·¥ç¨‹æ‰€éœ€ä¿¡æ¯</li>
<li>PBXResourcesBuildPhaseï¼šç¼–è¯‘èµ„æºæ–‡ä»¶ï¼Œæœ‰ xibã€storyboardã€plistä»¥åŠå›¾ç‰‡ç­‰èµ„æºæ–‡ä»¶</li>
<li>PBXSourcesBuildPhaseï¼šç¼–è¯‘æºæ–‡ä»¶ï¼ˆ.mï¼‰</li>
<li>PBXTargetDependencyï¼š Taget çš„ä¾èµ–</li>
<li>PBXVariantGroupï¼š.storyboard æ–‡ä»¶</li>
<li>XCBuildConfigurationï¼šXcode ç¼–è¯‘é…ç½®ï¼Œå¯¹åº” Xcode çš„ Build Setting é¢æ¿å†…å®¹</li>
<li>XCConfigurationListï¼šæ„å»ºé…ç½®ç›¸å…³ï¼ŒåŒ…å«é¡¹ç›®æ–‡ä»¶å’Œ target æ–‡ä»¶</li>
</ul>
<p>æ ¹æ® xcodeproj çš„ç»“æ„è§„åˆ™è®¾è®¡ç»“æ„ä½“ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// project.pbxproj ç»“æ„</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">Xcodeproj</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> archiveVersion <span class="operator">=</span> â€œâ€</span><br><span class="line">    <span class="keyword">var</span> classes <span class="operator">=</span> [<span class="type">XcodeprojTreeNodeArrayValue</span>]()</span><br><span class="line">    <span class="keyword">var</span> objectVersion <span class="operator">=</span> â€œâ€ <span class="comment">// åŒºåˆ† xcodeproj ä¸åŒåè®®ç‰ˆæœ¬</span></span><br><span class="line">    <span class="keyword">var</span> rootObject <span class="operator">=</span> <span class="type">PBXValueWithComment</span>(name: â€œâ€, value: â€œâ€)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> pbxBuildFile <span class="operator">=</span> [<span class="type">String</span>:<span class="type">PBXBuildFile</span>]()</span><br><span class="line">    <span class="keyword">var</span> pbxContainerItemProxy <span class="operator">=</span> [<span class="type">String</span>:<span class="type">PBXContainerItemProxy</span>]()</span><br><span class="line">    <span class="keyword">var</span> pbxFileReference <span class="operator">=</span> [<span class="type">String</span>:<span class="type">PBXFileReference</span>]()</span><br><span class="line">    <span class="keyword">var</span> pbxFrameworksBuildPhase <span class="operator">=</span> [<span class="type">String</span>:<span class="type">PBXFrameworksBuildPhase</span>]()</span><br><span class="line">    <span class="keyword">var</span> pbxGroup <span class="operator">=</span> [<span class="type">String</span>:<span class="type">PBXGroup</span>]()</span><br><span class="line">    <span class="keyword">var</span> pbxNativeTarget <span class="operator">=</span> [<span class="type">String</span>:<span class="type">PBXNativeTarget</span>]()</span><br><span class="line">    <span class="keyword">var</span> pbxProject <span class="operator">=</span> [<span class="type">String</span>:<span class="type">PBXProject</span>]()</span><br><span class="line">    <span class="keyword">var</span> pbxResourcesBuildPhase <span class="operator">=</span> [<span class="type">String</span>:<span class="type">PBXResourcesBuildPhase</span>]()</span><br><span class="line">    <span class="keyword">var</span> pbxSourcesBuildPhase <span class="operator">=</span> [<span class="type">String</span>:<span class="type">PBXSourcesBuildPhase</span>]()</span><br><span class="line">    <span class="keyword">var</span> pbxTargetDependency <span class="operator">=</span> [<span class="type">String</span>:<span class="type">PBXTargetDependency</span>]()</span><br><span class="line">    <span class="keyword">var</span> pbxVariantGroup <span class="operator">=</span> [<span class="type">String</span>:<span class="type">PBXVariantGroup</span>]()</span><br><span class="line">    <span class="keyword">var</span> xcBuildConfiguration <span class="operator">=</span> [<span class="type">String</span>:<span class="type">XCBuildConfiguration</span>]()</span><br><span class="line">    <span class="keyword">var</span> xcConfigurationList <span class="operator">=</span> [<span class="type">String</span>:<span class="type">XCConfigurationList</span>]()</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">init</span>()</span> &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å…·ä½“æ¯ä¸ªå­—æ®µé›†åˆå…ƒç´ çš„ç»“æ„ä½“æ¯”å¦‚ PBXBuildFile å’Œ PBXFileReference å¯¹åº”çš„ç»“æ„ä½“å’Œ xcodeproj çš„ section ç»“æ„å¯¹åº”ä¸Šã€‚ç„¶åä½¿ç”¨ ParseXcodeprojTreeNode è§£æçš„èŠ‚ç‚¹æ ‘ç»“æ„ç”Ÿæˆæœ€ç»ˆçš„ Xcodeproj section çš„ç»“æ„ä½“ã€‚è§£æè¿‡ç¨‹åœ¨è¿™é‡Œ <a href="https://github.com/ming1016/MethodTraceAnalyze/blob/master/MethodTraceAnalyze/Xcodeproj/ParseXcodeprojSection.swift">MethodTraceAnalyze/ParseXcodeprojSection.swift</a>ã€‚</p>
<p>è°ƒè¯•çœ‹åˆ° Xcodeproj çš„ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="/uploads/how-to-analyze-startup-time-cost-in-ios/09.png" alt=""></p>
<p>å¯¹ xcodeproj çš„è§£æä¹Ÿå†™äº†å•æµ‹æ¥ä¿è¯åæœŸ <a href="https://github.com/ming1016/MethodTraceAnalyze/blob/master/MethodTraceAnalyze/Xcodeproj/TestXcodeproj.swift">MethodTraceAnalyze/TestXcodeproj.swift</a>ã€‚</p>
<p><img src="/uploads/how-to-analyze-startup-time-cost-in-ios/10.png" alt=""></p>
<p>å¾—åˆ° section ç»“æ„ Xcodeproj åï¼Œå°±å¯ä»¥å¼€å§‹åˆ†ææ‰€æœ‰æºæ–‡ä»¶çš„è·¯å¾„äº†ã€‚æ ¹æ®å‰é¢åˆ—å‡ºçš„ section çš„è¯´æ˜ï¼ŒPBXGroup åŒ…å«äº†æ‰€æœ‰æ–‡ä»¶å¤¹å’Œæ–‡ä»¶çš„å…³ç³»ï¼ŒXcodeproj çš„ pbxGroup å­—æ®µçš„ key æ˜¯æ–‡ä»¶å¤¹ï¼Œå€¼æ˜¯æ–‡ä»¶é›†åˆï¼Œå› æ­¤å¯ä»¥è®¾è®¡ä¸€ä¸ªç»“æ„ä½“ XcodeprojSourceNode ç”¨æ¥å­˜å‚¨æ–‡ä»¶å¤¹å’Œæ–‡ä»¶å…³ç³»ã€‚XcodeprojSourceNode ç»“æ„å¦‚ä¸‹ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">XcodeprojSourceNode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> fatherValue: <span class="type">String</span> <span class="comment">// æ–‡ä»¶å¤¹</span></span><br><span class="line">    <span class="keyword">let</span> value: <span class="type">String</span> <span class="comment">// æ–‡ä»¶çš„å€¼</span></span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span> <span class="comment">// æ–‡ä»¶å</span></span><br><span class="line">    <span class="keyword">let</span> type: <span class="type">String</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>é€šè¿‡éå† pbxGroup å¯ä»¥å°†æ–‡ä»¶å¤¹å’Œæ–‡ä»¶å¯¹åº”ä¸Šï¼Œæ–‡ä»¶åå¯ä»¥é€šè¿‡ pbxGroup çš„ value åˆ° PBXFileReference é‡Œå»å–ã€‚ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> nodes <span class="operator">=</span> [<span class="type">XcodeprojSourceNode</span>]()</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬ä¸€æ¬¡æ‰¾å‡ºæ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="keyword">for</span> (k,v) <span class="keyword">in</span> proj.pbxGroup &#123;</span><br><span class="line">    <span class="keyword">guard</span> v.children.count <span class="operator">&gt;</span> <span class="number">0</span> <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> child <span class="keyword">in</span> v.children &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæ»¡è¶³æ¡ä»¶è¡¨ç¤ºæ˜¯ç›®å½•</span></span><br><span class="line">        <span class="keyword">if</span> proj.pbxGroup.keys.contains(child.value) &#123;</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ»¡è¶³æ¡ä»¶æ˜¯æ–‡ä»¶</span></span><br><span class="line">        <span class="keyword">if</span> proj.pbxFileReference.keys.contains(child.value) &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> fileRefer <span class="operator">=</span> proj.pbxFileReference[child.value] <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">        </span><br><span class="line">            nodes.append(<span class="type">XcodeprojSourceNode</span>(fatherValue: k, value: child.value, name: fileRefer.path, type: fileRefer.lastKnownFileType))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="comment">// end for children</span></span><br><span class="line">    </span><br><span class="line">&#125; <span class="comment">// end for group</span></span><br></pre></td></tr></table></figure></p>
<p>æ¥ä¸‹æ¥éœ€è¦å–å¾—å®Œæ•´çš„æ–‡ä»¶è·¯å¾„ã€‚é€šè¿‡ recusiveFatherPaths å‡½æ•°è·å–æ–‡ä»¶å¤¹è·¯å¾„ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯éœ€è¦å¤„ç† ../ è¿™ç§æ–‡ä»¶å¤¹è·¯å¾„ç¬¦ï¼Œè·å–å®Œæ•´è·¯å¾„çš„å®ç°ä»£ç å¯ä»¥çœ‹è¿™é‡Œ <a href="https://github.com/ming1016/MethodTraceAnalyze/blob/master/MethodTraceAnalyze/Xcodeproj/ParseXcodeprojSource.swift">MethodTraceAnalyze/ParseXcodeprojSource.swift</a>ã€‚</p>
<p>æœ‰äº†æ¯ä¸ªæºæ–‡ä»¶çš„è·¯å¾„ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥å¯¹è¿™äº›æºæ–‡ä»¶è¿›è¡Œè§£æäº†ã€‚</p>
<h4 id="è§£æ-m-mm-æ–‡ä»¶"><a href="#è§£æ-m-mm-æ–‡ä»¶" class="headerlink" title="è§£æ .m .mm æ–‡ä»¶"></a>è§£æ .m .mm æ–‡ä»¶</h4><p><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/14.png" alt=""></p>
<p>å¯¹ Objective-C è§£æå¯ä»¥å‚è€ƒ LLVMï¼Œè¿™é‡Œåªéœ€è¦æ‰¾åˆ°æ¯ä¸ªæ–¹æ³•å¯¹åº”çš„æºç ï¼Œæ‰€ä»¥è‡ªå·±ä¹Ÿå¯ä»¥å®ç°ã€‚åˆ†è¯å‰å…ˆçœ‹çœ‹ LLVM æ˜¯æ€ä¹ˆå®šä¹‰ token çš„ã€‚å®šä¹‰æ–‡ä»¶åœ¨è¿™é‡Œ <a href="https://opensource.apple.com/source/lldb/lldb-69/llvm/tools/clang/include/clang/Basic/TokenKinds.def">https://opensource.apple.com/source/lldb/lldb-69/llvm/tools/clang/include/clang/Basic/TokenKinds.def</a> ã€‚æ ¹æ®è¿™ä¸ªå®šä¹‰æˆ‘è®¾è®¡äº† token çš„ç»“æ„ä½“ï¼Œä¸»ä½“éƒ¨åˆ†å¦‚ä¸‹ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ‡å‰²ç¬¦å· []()&#123;&#125;.&amp;=*+-&lt;&gt;~!/%^|?:;,#@</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">OCTK</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> unknown <span class="comment">// ä¸æ˜¯ token</span></span><br><span class="line">    <span class="keyword">case</span> eof <span class="comment">// æ–‡ä»¶ç»“æŸ</span></span><br><span class="line">    <span class="keyword">case</span> eod <span class="comment">// è¡Œç»“æŸ</span></span><br><span class="line">    <span class="keyword">case</span> codeCompletion <span class="comment">// Code completion marker</span></span><br><span class="line">    <span class="keyword">case</span> cxxDefaultargEnd <span class="comment">// C++ default argument end marker</span></span><br><span class="line">    <span class="keyword">case</span> comment <span class="comment">// æ³¨é‡Š</span></span><br><span class="line">    <span class="keyword">case</span> identifier <span class="comment">// æ¯”å¦‚ abcde123</span></span><br><span class="line">    <span class="keyword">case</span> numericConstant(<span class="type">OCTkNumericConstant</span>) <span class="comment">// æ•´å‹ã€æµ®ç‚¹ 0x123ï¼Œè§£é‡Šè®¡ç®—æ—¶ç”¨ï¼Œåˆ†æä»£ç æ—¶å¯ä¸ç”¨</span></span><br><span class="line">    <span class="keyword">case</span> charConstant <span class="comment">// â€˜aâ€™</span></span><br><span class="line">    <span class="keyword">case</span> stringLiteral <span class="comment">// â€œfooâ€</span></span><br><span class="line">    <span class="keyword">case</span> wideStringLiteral <span class="comment">// Lâ€fooâ€</span></span><br><span class="line">    <span class="keyword">case</span> angleStringLiteral <span class="comment">// &lt;foo&gt; å¾…å¤„ç†éœ€è¦è€ƒè™‘ä½œä¸ºå°äºç¬¦å·çš„é—®é¢˜</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ ‡å‡†å®šä¹‰éƒ¨åˆ†</span></span><br><span class="line">    <span class="comment">// æ ‡ç‚¹ç¬¦å·</span></span><br><span class="line">    <span class="keyword">case</span> punctuators(<span class="type">OCTkPunctuators</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//  å…³é”®å­—</span></span><br><span class="line">    <span class="keyword">case</span> keyword(<span class="type">OCTKKeyword</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// @å…³é”®å­—</span></span><br><span class="line">    <span class="keyword">case</span> atKeyword(<span class="type">OCTKAtKeyword</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å®Œæ•´çš„å®šä¹‰åœ¨è¿™é‡Œ <a href="https://github.com/ming1016/MethodTraceAnalyze/blob/master/MethodTraceAnalyze/OC/ParseOCTokensDefine.swift">MethodTraceAnalyze/ParseOCTokensDefine.swift</a>ã€‚åˆ†è¯è¿‡ç¨‹å¯ä»¥å‚çœ‹ LLVM çš„å®ç° <a href="http://clang.llvm.org/doxygen/Lexer_8cpp_source.html">clang: lib/Lex/Lexer.cpp Source File</a>ã€‚æˆ‘åœ¨å¤„ç†åˆ†è¯æ—¶ä¸»è¦æ˜¯æŒ‰ç…§åˆ†éš”ç¬¦ä¸€ä¸€å¯¹åº”å¤„ç†ï¼Œé’ˆå¯¹ä»£ç æ³¨é‡Šå’Œå­—ç¬¦ä¸²è¿›è¡Œäº†ç‰¹æ®Šå¤„ç†ï¼Œä¸€ä¸ªæ³¨é‡Šä¸€ä¸ª tokenï¼Œä¸€ä¸ªå®Œæ•´å­—ç¬¦ä¸²ä¸€ä¸ª tokenã€‚æˆ‘åˆ†è¯å®ç°ä»£ç  <a href="https://github.com/ming1016/MethodTraceAnalyze/blob/master/MethodTraceAnalyze/OC/ParseOCTokens.swift">MethodTraceAnalyze/ParseOCTokens.swift</a>ã€‚</p>
<p>ç”±äºåªè¦å–åˆ°ç±»åå’Œæ–¹æ³•é‡Œçš„æºç ï¼Œæ‰€ä»¥è¯­æ³•åˆ†ææ—¶ï¼Œåªéœ€è¦å¯¹ç±»å®šä¹‰å’Œæ–¹æ³•å®šä¹‰åšè§£æå°±å¯ä»¥ï¼Œè¯­æ³•æ ‘ä¸­èŠ‚ç‚¹è®¾è®¡ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// OC è¯­æ³•æ ‘èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">OCNode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> type: <span class="type">OCNodeType</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> subNodes: [<span class="type">OCNode</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> identifier: <span class="type">String</span>   <span class="comment">// æ ‡è¯†</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> lineRange: (<span class="type">Int</span>,<span class="type">Int</span>) <span class="comment">// è¡ŒèŒƒå›´</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> source: <span class="type">String</span>       <span class="comment">// å¯¹åº”ä»£ç </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// èŠ‚ç‚¹ç±»å‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">OCNodeType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> `default`</span><br><span class="line">    <span class="keyword">case</span> root</span><br><span class="line">    <span class="keyword">case</span> `import`</span><br><span class="line">    <span class="keyword">case</span> `class`</span><br><span class="line">    <span class="keyword">case</span> method</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å…¶ä¸­ lineRange è®°å½•äº†æ–¹æ³•æ‰€åœ¨æ–‡ä»¶çš„è¡ŒèŒƒå›´ï¼Œè¿™æ ·å°±èƒ½å¤Ÿä»æ–‡ä»¶ä¸­å–å‡ºä»£ç ï¼Œå¹¶è®°å½•åœ¨ source å­—æ®µä¸­ã€‚</p>
<p>è§£æè¯­æ³•æ ‘éœ€è¦å…ˆå®šä¹‰å¥½è§£æè¿‡ç¨‹çš„ä¸åŒçŠ¶æ€ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">enum</span> <span class="title">RState</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> normal</span><br><span class="line">    <span class="keyword">case</span> eod                   <span class="comment">// æ¢è¡Œ</span></span><br><span class="line">    <span class="keyword">case</span> methodStart           <span class="comment">// æ–¹æ³•å¼€å§‹</span></span><br><span class="line">    <span class="keyword">case</span> methodReturnEnd       <span class="comment">// æ–¹æ³•è¿”å›ç±»å‹ç»“æŸ</span></span><br><span class="line">    <span class="keyword">case</span> methodNameEnd         <span class="comment">// æ–¹æ³•åç»“æŸ</span></span><br><span class="line">    <span class="keyword">case</span> methodParamStart      <span class="comment">// æ–¹æ³•å‚æ•°å¼€å§‹</span></span><br><span class="line">    <span class="keyword">case</span> methodContentStart    <span class="comment">// æ–¹æ³•å†…å®¹å¼€å§‹</span></span><br><span class="line">    <span class="keyword">case</span> methodParamTypeStart  <span class="comment">// æ–¹æ³•å‚æ•°ç±»å‹å¼€å§‹</span></span><br><span class="line">    <span class="keyword">case</span> methodParamTypeEnd    <span class="comment">// æ–¹æ³•å‚æ•°ç±»å‹ç»“æŸ</span></span><br><span class="line">    <span class="keyword">case</span> methodParamEnd        <span class="comment">// æ–¹æ³•å‚æ•°ç»“æŸ</span></span><br><span class="line">    <span class="keyword">case</span> methodParamNameEnd    <span class="comment">// æ–¹æ³•å‚æ•°åç»“æŸ</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">case</span> at                    <span class="comment">// @</span></span><br><span class="line">    <span class="keyword">case</span> atImplementation      <span class="comment">// @implementation</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">case</span> normalBlock           <span class="comment">// ocæ–¹æ³•å¤–éƒ¨çš„ block &#123;&#125;ï¼Œç”¨äº c æ–¹æ³•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å®Œæ•´è§£æå‡ºæ–¹æ³•æ‰€å±ç±»ã€æ–¹æ³•è¡ŒèŒƒå›´çš„ä»£ç åœ¨è¿™é‡Œ <a href="https://github.com/ming1016/MethodTraceAnalyze/blob/master/MethodTraceAnalyze/OC/ParseOCNodes.swift">MethodTraceAnalyze/ParseOCNodes.swift</a></p>
<p>è§£æ .m å’Œ .mm æ–‡ä»¶ï¼Œä¸€ä¸ªä¸€ä¸ªä¸²è¡Œè§£çš„è¯ï¼Œå¯¹äºå¤§å·¥ç¨‹ï¼Œæ¯æ¬¡è§£çš„é€Ÿåº¦å¾ˆéš¾æ¥å—ï¼Œæ‰€ä»¥é‡‡ç”¨å¹¶è¡Œæ–¹å¼å»è¯»å–è§£æå¤šä¸ªæ–‡ä»¶ï¼Œç»è¿‡æµ‹è¯•ï¼Œå‘ç°æ¯ç»„åœ¨60ä¸ªä»¥ä¸Šæ—¶èƒ½å¤Ÿæœ€å¤§åˆ©ç”¨æˆ‘æœºå™¨ï¼ˆ2.5 GHz åŒæ ¸Intel Core i7ï¼‰çš„ CPUï¼Œå†…å­˜å ç”¨åªæœ‰60Mï¼Œä¸€ä¸‡å¤š.mæ–‡ä»¶çš„å·¥ç¨‹å¤§æ¦‚2åˆ†åŠèƒ½è§£å®Œã€‚åˆ†ç»„å¹¶è¡Œçš„ä»£ç å®ç°å¦‚ä¸‹ï¼š<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> allPath <span class="operator">=</span> <span class="type">XcodeProjectParse</span>.allSourceFileInWorkspace(path: workspacePath)</span><br><span class="line"><span class="keyword">var</span> allNodes <span class="operator">=</span> [<span class="type">OCNode</span>]()</span><br><span class="line"><span class="keyword">let</span> groupCount <span class="operator">=</span> <span class="number">60</span> <span class="comment">// ä¸€ç»„å®¹çº³ä¸ªæ•°</span></span><br><span class="line"><span class="keyword">let</span> groupTotal <span class="operator">=</span> allPath.count<span class="operator">/</span>groupCount <span class="operator">+</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> groups <span class="operator">=</span> [[<span class="type">String</span>]]()</span><br><span class="line"><span class="keyword">for</span> <span class="type">I</span> <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span>groupTotal &#123;</span><br><span class="line">    <span class="keyword">var</span> group <span class="operator">=</span> [<span class="type">String</span>]()</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="type">I</span><span class="operator">*</span>groupCount<span class="operator">..&lt;</span>(<span class="type">I</span><span class="operator">+</span><span class="number">1</span>)<span class="operator">*</span>groupCount &#123;</span><br><span class="line">        <span class="keyword">if</span> j <span class="operator">&lt;</span> allPath.count &#123;</span><br><span class="line">            group.append(allPath[j])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> group.count <span class="operator">&gt;</span> <span class="number">0</span> &#123;</span><br><span class="line">        groups.append(group)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> group <span class="keyword">in</span> groups &#123;</span><br><span class="line">    <span class="keyword">let</span> dispatchGroup <span class="operator">=</span> <span class="type">DispatchGroup</span>()</span><br><span class="line">    <span class="keyword">for</span> node <span class="keyword">in</span> group &#123;</span><br><span class="line">        dispatchGroup.enter()</span><br><span class="line">        <span class="keyword">let</span> queue <span class="operator">=</span> <span class="type">DispatchQueue</span>.global()</span><br><span class="line">        queue.async &#123;</span><br><span class="line">            <span class="keyword">let</span> ocContent <span class="operator">=</span> <span class="type">FileHandle</span>.fileContent(path: node)</span><br><span class="line">            <span class="keyword">let</span> node <span class="operator">=</span> <span class="type">ParseOCNodes</span>(input: ocContent).parse()</span><br><span class="line">            <span class="keyword">for</span> aNode <span class="keyword">in</span> node.subNodes &#123;</span><br><span class="line">                allNodes.append(aNode)</span><br><span class="line">            &#125;</span><br><span class="line">            dispatchGroup.leave()</span><br><span class="line">        &#125; <span class="comment">// end queue async</span></span><br><span class="line">    &#125; <span class="comment">// end for</span></span><br><span class="line">    dispatchGroup.wait()</span><br><span class="line">&#125; <span class="comment">// end for</span></span><br></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨çš„æ˜¯ dispatch group çš„ waitï¼Œä¿è¯å¹¶è¡Œçš„ä¸€ç»„å®Œæˆå†è¿›å…¥ä¸‹ä¸€ç»„ã€‚</p>
<p><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/15.png" alt=""></p>
<p>ç°åœ¨æœ‰äº†æ¯ä¸ªæ–¹æ³•å¯¹åº”çš„æºç ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥å’Œå‰é¢ trace çš„æ–¹æ³•å¯¹åº”ä¸Šã€‚é¡µé¢å±•ç¤ºåªéœ€è¦å†™æ®µ js å°±èƒ½å¤Ÿæ§åˆ¶ç‚¹å‡»æ—¶å±•ç¤ºå¯¹åº”æ–¹æ³•çš„æºç ã€‚</p>
<h4 id="é¡µé¢å±•ç¤º"><a href="#é¡µé¢å±•ç¤º" class="headerlink" title="é¡µé¢å±•ç¤º"></a>é¡µé¢å±•ç¤º</h4><p>åœ¨è¿›è¡Œ HTML é¡µé¢å±•ç¤ºå‰ï¼Œéœ€è¦å°†ä»£ç é‡Œçš„æ¢è¡Œå’Œç©ºæ ¼æ›¿æ¢æˆ HTML é‡Œçš„å¯¹åº”çš„</br>å’Œ &nbsp; ã€‚<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> allNodes <span class="operator">=</span> <span class="type">ParseOC</span>.ocNodes(workspacePath: â€œ<span class="operator">/</span><span class="type">Users</span><span class="operator">/</span>ming<span class="operator">/</span><span class="type">Downloads</span><span class="operator">/</span><span class="type">GCDFetchFeed</span><span class="operator">/</span><span class="type">GCDFetchFeed</span><span class="operator">/</span><span class="type">GCDFetchFeed</span>.xcworkspaceâ€)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sourceDic <span class="operator">=</span> [<span class="type">String</span>:<span class="type">String</span>]()</span><br><span class="line"><span class="keyword">for</span> aNode <span class="keyword">in</span> allNodes &#123;</span><br><span class="line">    sourceDic[aNode.identifier] <span class="operator">=</span> aNode.source.replacingOccurrences(of: â€œ\nâ€, with: â€œ<span class="operator">&lt;/</span>br<span class="operator">&gt;</span>â€).replacingOccurrences(of: â€œ â€œ, with: â€œ<span class="operator">&amp;</span>nbsp;â€)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç”¨ p æ ‡ç­¾ä½œä¸ºæºç å±•ç¤ºçš„æ ‡ç­¾ï¼Œæ–¹æ³•æ‰§è¡Œé¡ºåºçš„ç¼–å·åŠ æ–¹æ³•åä½œä¸º p æ ‡ç­¾çš„ idï¼Œç„¶åç”¨ display: none; å°† p æ ‡ç­¾éšè—ã€‚æ–¹æ³•åç”¨ a æ ‡ç­¾ï¼Œclick å±æ€§æ‰§è¡Œä¸€æ®µ js ä»£ç ï¼Œå½“ a æ ‡ç­¾ç‚¹å‡»æ—¶èƒ½å¤Ÿæ˜¾ç¤ºæ–¹æ³•å¯¹åº”çš„ä»£ç ã€‚è¿™æ®µ js ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sourceShowHidden</span>(<span class="params">sourceIdName</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> sourceCode = <span class="built_in">document</span>.getElementById(sourceIdName);</span><br><span class="line">    sourceCode.style.display = â€œblockâ€;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æœ€ç»ˆæ•ˆæœå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/uploads/how-to-analyze-startup-time-cost-in-ios/11.png" alt=""></p>
<p>å°†åŠ¨æ€åˆ†æå’Œé™æ€åˆ†æè¿›è¡Œäº†ç»“åˆï¼Œåé¢å¯ä»¥é€šè¿‡ä¸åŒç‰ˆæœ¬è¿›è¡Œå¯¹æ¯”ï¼Œå‘ç°å“ªäº›æ–¹æ³•çš„ä»£ç å®ç°æ”¹å˜äº†ï¼Œèƒ½å±•ç¤ºåœ¨é¡µé¢ä¸Šã€‚è¿˜å¯ä»¥è¿›ä¸€æ­¥é™æ€åˆ†æå‡ºå“ªäº›æ–¹æ³•ä¼šè°ƒç”¨åˆ° I/O å‡½æ•°ã€èµ·æ–°çº¿ç¨‹ã€æ–°é˜Ÿåˆ—ç­‰ï¼Œç„¶åå±•ç¤ºåˆ°é¡µé¢ä¸Šï¼Œæ–¹ä¾¿åˆ†æã€‚</p>
<p>è¯»åˆ°æœ€åï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–¹æ³•åˆ†æå·¥å…·å¹¶æ²¡æœ‰ç”¨ä»»ä½•ä¸€ä¸ªè½®å­ï¼Œå…¶å®æœ‰äº›æ˜¯å¯ä»¥ä½¿ç”¨ç°æœ‰è½®å­çš„ï¼Œæ¯”å¦‚ jsonã€xmlã€xcodeprojã€Objective-C è¯­æ³•åˆ†æç­‰ï¼Œä¹‹æ‰€æœ‰æ²¡æœ‰ç”¨æ˜¯å› ä¸ºä¸åŒè½®å­ä½¿ç”¨çš„è¯­è¨€å’ŒæŠ€æœ¯åŒºåˆ«è¾ƒå¤§ï¼Œå½“æ ¼å¼æ›´æ–°æ—¶å¦‚æœä½¿ç”¨çš„å•ä¸ªè½®å­æ²¡æœ‰æ›´æ–°ä¼šå½±å“æ•´ä¸ªå·¥å…·ã€‚å¼€å‘è¿™ä¸ªå·¥å…·ä¸»è¦å·¥ä½œæ˜¯åœ¨è§£æä¸Šï¼Œæ‰€ä»¥ä½¿ç”¨è‡ªæœ‰è§£ææŠ€æœ¯ä¹Ÿèƒ½å¤Ÿè®©æ‰€åšçš„åŠŸèƒ½æ›´èšç„¦ï¼Œä¸åšæ²¡ç”¨çš„åŠŸèƒ½ï¼Œå‡å°‘ä»£ç ç»´æŠ¤é‡ï¼Œæ‰€è¦è§£ææ ¼å¼æ›´æ–°åï¼Œä¹Ÿèƒ½å¤Ÿè‡ªä¸»å»æ›´æ–°è§£ææ–¹å¼ã€‚æ›´é‡è¦çš„ä¸€ç‚¹æ˜¯å¯ä»¥äº²æ‰‹æ¥è§¦ä¸‹è¿™äº›æ ¼å¼çš„è¯­æ³•è®¾è®¡ã€‚</p>
<h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>ä»Šå¤©è¯´äº†ä¸‹å¯åŠ¨ä¼˜åŒ–çš„æŠ€æœ¯æ‰‹æ®µï¼Œæ€»çš„è¯´ï¼Œå¯¹å¯åŠ¨è¿›è¡Œä¼˜åŒ–çš„å†³å¿ƒé‡è¦ç¨‹åº¦æ˜¯è¿œå¤§äºæŠ€æœ¯æ‰‹æ®µçš„ï¼Œå†³å®šç€æ˜¯å¦èƒ½å¤Ÿä¼˜åŒ–çš„æ›´å¤šã€‚æŠ€æœ¯æ‰‹æ®µæœ‰å¾ˆå¤šï¼Œæˆ‘è§‰å¾—æ‰‹æ®µçš„å¥½ååŒºåˆ«åªæ˜¯åœ¨æ•ˆç‡ä¸Šï¼Œæœ€å·®çš„æƒ…å†µå…¨ç”¨æ‰‹åŠ¨ä¸€ä¸ªä¸ªå»æŸ¥è€—æ—¶ä¹Ÿæ˜¯èƒ½å¤Ÿè§£é¢˜çš„ã€‚</p>
<p>æœ€è¿‘çœ‹äº†é²è¿…çš„ä¸€æ®µè¯ï¼Œå¾ˆæœ‰æ„Ÿè§¦ï¼Œåˆ†äº«ä¸€ä¸‹ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">æˆ‘ä»¬å¥½åƒéƒ½æ˜¯çˆ±ç”Ÿç—…çš„äºº</span><br><span class="line">è‹¦çš„å¾ˆ</span><br><span class="line">æˆ‘çš„ä¸€ç”Ÿ</span><br><span class="line">å¥½åƒæ˜¯åœ¨ä¸æ–­ç”Ÿç—…å’Œéª‚äººä¸­å°±è¿‡å»å¤šåŠäº†</span><br><span class="line">æˆ‘ä¸‰åå²ä¸åˆ°ï¼Œç‰™é½¿å°±æ‰å…‰äº†</span><br><span class="line">æ»¡å£ä¹‰é½¿</span><br><span class="line">æˆ‘æˆ’é…’</span><br><span class="line">åƒé±¼è‚æ²¹</span><br><span class="line">ä»¥æœ›å»¶é•¿æˆ‘çš„ç”Ÿå‘½</span><br><span class="line">å€’ä¸å°½æ˜¯ä¸ºäº†æˆ‘çš„çˆ±äºº</span><br><span class="line">å¤§åŠæ˜¯ä¸ºäº†æˆ‘çš„æ•Œäºº</span><br><span class="line">æˆ‘è‡ªå·±çŸ¥é“çš„ï¼Œæˆ‘å¹¶ä¸å¤§åº¦</span><br><span class="line">è¯´åˆ°å¹¸ç¦</span><br><span class="line">åªå¾—é¢å‘è¿‡å»</span><br><span class="line">æˆ–è€…é¢å‘é™¤äº†åŸå¢“ä»¥å¤–æ¯«æ— ä»»ä½•å¸Œæœ›çš„å°†æ¥</span><br><span class="line">æ¯ä¸ªæˆ˜å£«éƒ½æ˜¯å¦‚æ­¤</span><br><span class="line">æˆ‘ä»¬æ´»åœ¨è¿™æ ·çš„åœ°æ–¹</span><br><span class="line">æˆ‘ä»¬æ´»åœ¨è¿™æ ·çš„æ—¶ä»£</span><br></pre></td></tr></table></figure></p>
<p><img src="/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/16.png" alt=""></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/uploads/kuaishou-unused-class-swiftui-note-binary-tree-interview/01.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerli
    
    </summary>
    
      <category term="Programming" scheme="http://ming1016.github.io/categories/Programming/"/>
    
    
      <category term="iOS" scheme="http://ming1016.github.io/tags/iOS/"/>
    
      <category term="Swift" scheme="http://ming1016.github.io/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>2019å¹´æ¶‚å›¾</title>
    <link href="http://ming1016.github.io/2019/12/06/draw-in-2019/"/>
    <id>http://ming1016.github.io/2019/12/06/draw-in-2019/</id>
    <published>2019-12-06T05:48:40.000Z</published>
    <updated>2021-04-11T14:42:09.916Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/uploads/draw-in-2019/01.jpg" alt=""><br><img src="/uploads/draw-in-2019/02.jpg" alt=""><br><img src="/uploads/draw-in-2019/03.jpg" alt=""><br><img src="/uploads/draw-in-2019/04.jpg" alt=""><br><img src="/uploads/draw-in-2019/05.jpg" alt=""><br><img src="/uploads/draw-in-2019/06.jpg" alt=""><br><img src="/uploads/draw-in-2019/07.jpg" alt=""><br><img src="/uploads/draw-in-2019/08.jpg" alt=""><br><img src="/uploads/draw-in-2019/09.jpg" alt=""><br><img src="/uploads/draw-in-2019/10.jpg" alt=""><br><img src="/uploads/draw-in-2019/11.jpg" alt=""><br><img src="/uploads/draw-in-2019/12.jpg" alt=""><br><img src="/uploads/draw-in-2019/13.jpg" alt=""><br><img src="/uploads/draw-in-2019/14.jpg" alt=""><br><img src="/uploads/draw-in-2019/15.jpg" alt=""><br><img src="/uploads/draw-in-2019/16.jpg" alt=""><br><img src="/uploads/draw-in-2019/18.jpg" alt=""><br><img src="/uploads/draw-in-2019/19.jpg" alt=""><br><img src="/uploads/draw-in-2019/20.jpg" alt=""><br><img src="/uploads/draw-in-2019/21.jpg" alt=""><br><img src="/uploads/draw-in-2019/22.jpg" alt=""><br><img src="/uploads/draw-in-2019/23.jpg" alt=""><br><img src="/uploads/draw-in-2019/24.jpg" alt=""><br><img src="/uploads/draw-in-2019/25.jpg" alt=""><br><img src="/uploads/draw-in-2019/26.jpg" alt=""><br><img src="/uploads/draw-in-2019/27.jpg" alt=""><br><img src="/uploads/draw-in-2019/28.jpg" alt=""><br><img src="/uploads/draw-in-2019/29.jpg" alt=""><br><img src="/uploads/draw-in-2019/30.jpg" alt=""><br><img src="/uploads/draw-in-2019/31.jpg" alt=""><br><img src="/uploads/draw-in-2019/32.jpg" alt=""><br><img src="/uploads/draw-in-2019/33.jpg" alt=""><br><img src="/uploads/draw-in-2019/34.jpg" alt=""><br><img src="/uploads/draw-in-2019/35.jpg" alt=""><br><img src="/uploads/draw-in-2019/36.jpg" alt=""><br><img src="/uploads/draw-in-2019/37.jpg" alt=""><br><img src="/uploads/draw-in-2019/38.jpg" alt=""><br><img src="/uploads/draw-in-2019/39.jpg" alt=""><br><img src="/uploads/draw-in-2019/40.jpg" alt=""><br><img src="/uploads/draw-in-2019/41.jpg" alt=""><br><img src="/uploads/draw-in-2019/42.jpg" alt=""><br><img src="/uploads/draw-in-2019/43.jpg" alt=""><br><img src="/uploads/draw-in-2019/44.jpg" alt=""><br><img src="/uploads/draw-in-2019/45.jpg" alt=""></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/uploads/draw-in-2019/01.jpg&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;img src=&quot;/uploads/draw-in-2019/02.jpg&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;img src=&quot;/uploads/draw-in-2019/03.
    
    </summary>
    
      <category term="My painting" scheme="http://ming1016.github.io/categories/My-painting/"/>
    
    
      <category term="Painting" scheme="http://ming1016.github.io/tags/Painting/"/>
    
      <category term="iPad" scheme="http://ming1016.github.io/tags/iPad/"/>
    
      <category term="Procreate" scheme="http://ming1016.github.io/tags/Procreate/"/>
    
  </entry>
  
  <entry>
    <title>iOS å¼€å‘èˆ†å›¾</title>
    <link href="http://ming1016.github.io/2019/07/29/ios-map/"/>
    <id>http://ming1016.github.io/2019/07/29/ios-map/</id>
    <published>2019-07-29T04:49:06.000Z</published>
    <updated>2021-04-11T14:42:09.923Z</updated>
    
    <content type="html"><![CDATA[<p>43ç¯‡ <a href="https://time.geekbang.org/column/intro/161">ã€ŠiOSå¼€å‘é«˜æ‰‹è¯¾ã€‹</a>å·²å®Œæˆï¼Œåé¢ä¼šå¯¹å†…å®¹è¿›è¡Œè¿­ä»£ï¼Œä¸°å¯Œä¸‹å†…å®¹å’Œé…å›¾ã€‚æœ€è¿‘ç”»äº†å¼  iOS å¼€å‘å…¨æ™¯èˆ†å›¾ï¼Œè¿˜æœ‰ç›¸å…³ä¸€äº›èµ„æ–™æ•´ç†ï¼Œæ–¹ä¾¿æˆ‘å¹³æ—¶å¼€å‘ App æ—¶å‚çœ‹ã€‚èˆ†å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="/uploads/ios-map/1.png" alt=""><br><img src="/uploads/ios-map/2.png" alt=""><br><img src="/uploads/ios-map/3.png" alt=""><br><img src="/uploads/ios-map/4.png" alt=""><br><img src="/uploads/ios-map/5.png" alt=""><br><img src="/uploads/ios-map/6.png" alt=""></p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘æŒ‰ç…§ iOS å¼€å‘åœ°å›¾çš„é¡ºåºï¼Œå’Œä½ æ¨èä¸€äº›ç›¸å…³çš„å­¦ä¹ èµ„æ–™ã€‚</p>
<h2 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h2><p>å­¦ä¹  iOS å¼€å‘æœ€å¥½æ˜¯ä»å­¦ä¹ ä¸€ä¸ªå®Œæ•´çš„ App å…¥æ‰‹ï¼ŒGitHubä¸Šçš„<a href="https://github.com/dkhamsing/open-source-ios-apps">Open-Source iOS Apps</a><br>é¡¹ç›®ï¼Œæ”¶å½•äº†å¤§é‡å¼€æºçš„å®Œæ•´ App ä¾‹å­ï¼Œæ¯”å¦‚ <a href="https://github.com/Dimillian/SwiftHN">Hacker News Reader</a> ç­‰å·²ç»ä¸Šæ¶äº† App Store çš„åº”ç”¨ç¨‹åºï¼Œæ‰€æœ‰ä¾‹å­éƒ½ä¼šæ ‡æ³¨æ˜¯å¦ä¸Šæ¶ App Storeçš„ã€æ‰€ä½¿ç”¨å¼€å‘è¯­è¨€ã€æ¨èç­‰çº§ç­‰ä¿¡æ¯ï¼Œæœ‰åˆ©äºè¿›è¡Œé€‰æ‹©å­¦ä¹ ã€‚</p>
<p>å¼€å‘ä¸€ä¸ªå®Œæ•´çš„ App ä¹Ÿæœ‰æœ€ä½³å®è·µï¼Œè¿™é‡Œæœ‰ä»½<a href="https://github.com/futurice/ios-good-practices">æœ€ä½³å®è·µ</a>å¯ä»¥å‚è€ƒã€‚</p>
<p>ä¸‹é¢ä¸¤ä¸ªæ•™ç¨‹ç½‘ç«™éƒ½ä¼šæ‰‹æŠŠæ‰‹é€šè¿‡å®ä¾‹æ•™ä½ æ€ä¹ˆåŠ¨æ‰‹å­¦ä¹  iOS å„ä¸ªçŸ¥è¯†ç‚¹ã€‚</p>
<ol>
<li><a href="https://www.appcoda.com/">AppCoda</a></li>
<li><a href="https://www.raywenderlich.com/library">Raywenderlich</a></li>
</ol>
<h2 id="iOS-åŸºç¡€"><a href="#iOS-åŸºç¡€" class="headerlink" title="iOS åŸºç¡€"></a>iOS åŸºç¡€</h2><p>å®Œæ•´å¼€å‘äº†å¤šä¸ª App åï¼Œä¸ºäº†æ›´å¥½ã€æ›´å¿«çš„æŒæ¡å¼€å‘ï¼Œä½ å°±ä¼šæœ‰éœ€è¦äº†è§£æ›´å¤š iOS åŸºç¡€çŸ¥è¯†çš„è¯‰æ±‚ï¼ŒåŒ…æ‹¬åˆ—è¡¨çš„ä¼˜åŒ–ã€é«˜æ•ˆç•Œé¢å¸ƒå±€å¼€å‘ã€å›¾è¡¨å›¾å½¢ã€å›¾ç‰‡å¤„ç†ã€åŠ¨ç”»å¤šåª’ä½“ç­‰ç­‰ã€‚</p>
<p>å›¾å½¢æ¸²æŸ“ Metal æ¡†æ¶çš„å­¦ä¹ å¯ä»¥å‚çœ‹ä¸‹é¢å››ç¯‡æ–‡ç« </p>
<ol>
<li><a href="https://objccn.io/issue-18-2/">Metal</a></li>
<li><a href="https://juejin.im/post/5a225ffcf265da432153daa4">åŸºäº Metal çš„ ARKit ä½¿ç”¨æŒ‡å—ï¼ˆä¸Šï¼‰</a></li>
<li><a href="https://juejin.im/post/59bb2a99f265da0650750e56">åŸºäº Metal çš„ ARKit ä½¿ç”¨æŒ‡å—ï¼ˆä¸‹ï¼‰</a></li>
<li><a href="https://xiaozhuanlan.com/topic/6927418053">åŸºäº Metal çš„ç°ä»£æ¸²æŸ“æŠ€æœ¯</a></li>
</ol>
<h2 id="iOS-ç³»ç»Ÿ"><a href="#iOS-ç³»ç»Ÿ" class="headerlink" title="iOS ç³»ç»Ÿ"></a>iOS ç³»ç»Ÿ</h2><p>iOS åŸºç¡€å­¦ä¹ åˆ°ä¸€å®šç¨‹åº¦å°±éœ€è¦äº†è§£ App æ˜¯å¦‚ä½•åœ¨ç³»ç»Ÿä¸­å·¥ä½œçš„ï¼Œç³»ç»Ÿæä¾›äº†ä»€ä¹ˆåŸºç¡€åŠŸèƒ½ï¼Œæä¾›äº†å“ªäº›ç•Œé¢æ§ä»¶ç­‰ç­‰ã€‚</p>
<p>æ‰©å±•çŸ¥è¯†å¯ä»¥é˜…è¯»ä¸‹é¢å››æœ¬ä¹¦ï¼š</p>
<ol>
<li>ã€Šæ·±å…¥è§£æMac OS X &amp; iOSæ“ä½œç³»ç»Ÿã€‹</li>
<li>ã€Šç°ä»£æ“ä½œç³»ç»Ÿã€‹</li>
<li>ã€Šæ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿã€‹</li>
<li>ã€Šç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»ã€‹</li>
</ol>
<h2 id="ç¼–ç¨‹è¯­è¨€"><a href="#ç¼–ç¨‹è¯­è¨€" class="headerlink" title="ç¼–ç¨‹è¯­è¨€"></a>ç¼–ç¨‹è¯­è¨€</h2><p>ç¼–ç¨‹è¯­è¨€çš„å­¦ä¹ å¯ä»¥å‚è€ƒå®˜æ–¹æ‰‹å†Œï¼Œå¯¹äº Runtime çš„æ‰©å±•æ–‡ç« é˜…è¯»ï¼š</p>
<ol>
<li><a href="http://yulingtianxia.com/blog/2016/06/15/Objective-C-Message-Sending-and-Forwarding/">Objective-C æ¶ˆæ¯å‘é€ä¸è½¬å‘æœºåˆ¶åŸç†</a></li>
<li><a href="https://halfrost.com/objc_runtime_isa_class/">ç¥ç»ç—…é™¢Objective-C Runtimeå…¥é™¢ç¬¬ä¸€å¤©â€”â€”isaå’ŒClass</a>ï¼ˆ <a href="https://halfrost.com/objc_runtime_isa_class/">https://halfrost.com/objc_runtime_isa_class/</a> ï¼‰</li>
<li><a href="https://halfrost.com/objc_runtime_objc_msgsend/">ç¥ç»ç—…é™¢ Objective-C Runtime ä½é™¢ç¬¬äºŒå¤©â€”â€”æ¶ˆæ¯å‘é€ä¸è½¬å‘</a></li>
<li><a href="https://halfrost.com/how_to_use_runtime/">ç¥ç»ç—…é™¢ Objective-C Runtime å‡ºé™¢ç¬¬ä¸‰å¤©â€”â€”å¦‚ä½•æ­£ç¡®ä½¿ç”¨</a></li>
</ol>
<p>ç¼–ç¨‹è¯­è¨€ Swift æ¨èé˜…è¯»ä¹¦ç±æ˜¯ã€ŠSwift è¿›é˜¶ã€‹ã€ã€Šå‡½æ•°å¼Swiftã€‹ã€‚å¤§é‡Swift Playground å¯ä»¥äº†è§£ Swift ç¼–ç¨‹è¯­è¨€çš„ç‰¹æ€§ï¼Œè¿™é‡Œæœ‰ä»½æ•´ç† <a href="https://github.com/uraimo/Awesome-Swift-Playgrounds">GitHub - uraimo/Awesome-Swift-Playgrounds: A List of Awesome Swift Playgrounds</a> ã€‚è¿™ä»½èµ„æ–™æ±‡æ€»äº† SwiftUI çš„èµ„æ–™  <a href="https://github.com/Juanpe/About-SwiftUI">GitHub - Juanpe/About-SwiftUI: Gathering all info published, both by Apple and by others, about new framework SwiftUI.</a> ã€‚è¿™é‡Œæœ‰æœ¬åœ¨çº¿ä¹¦è¯¦ç»†è®²è§£äº† Combine<br> <a href="https://heckj.github.io/swiftui-notes/">ã€ŠUsing Combineã€‹</a> ã€‚</p>
<p>æ¶æ„ç›¸å…³æ‰©å±•é˜…è¯»å¯ä»¥å‚çœ‹  <a href="https://kangzubin.com/ios-component-articles/">iOS ç»„ä»¶åŒ–ç›¸å…³è®¨è®ºæ–‡ç« æ±‡æ€» | KANGZUBIN</a> ã€‚</p>
<p>è®¾è®¡æ¨¡å¼æ¨èä¹¦ç±å¦‚ä¸‹ï¼š</p>
<ul>
<li>ã€Šè®¾è®¡æ¨¡å¼ å¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„åŸºç¡€ã€‹</li>
<li>ã€ŠObjective-C ç¼–ç¨‹ä¹‹é“ï¼šiOSè®¾è®¡æ¨¡å¼è§£æã€‹</li>
<li>ã€ŠHead First è®¾è®¡æ¨¡å¼ã€‹</li>
<li>ã€Šå¤§è¯è®¾è®¡æ¨¡å¼ã€‹</li>
</ul>
<h2 id="å¼€å‘å·¥å…·"><a href="#å¼€å‘å·¥å…·" class="headerlink" title="å¼€å‘å·¥å…·"></a>å¼€å‘å·¥å…·</h2><p>å¼€å‘çš„ä»£ç å¤šäº†ï¼Œå¼€å‘æ•ˆç‡å’Œå¼€å‘è´¨é‡çš„æå‡å°±è¶Šæ¥è¶Šç¦»ä¸å¼€å¼€å‘å·¥å…·äº†ã€‚</p>
<p>iOS å¼€å‘å·¥å…· Xcodeã€Instrument çš„ä½¿ç”¨å­¦ä¹ ï¼Œæ¨èçœ‹è‹¹æœå¼€å‘è€…å¤§ä¼š WWDC çš„ Session è§†é¢‘ã€‚</p>
<p>æ‰©å±•é˜…è¯»æ–‡ç« æ¨èï¼š</p>
<ol>
<li><a href="http://www.aosabook.org/en/llvm.html">The Architecture of Open Source Application</a></li>
<li><a href="https://manu343726.github.io/2017-02-11-writing-ast-matchers-for-libclang/">Writing AST matchers for libclang</a></li>
<li><a href="http://yulingtianxia.com/blog/2019/01/27/MVVM-Rules-for-OCLint/">ä½¿ç”¨ OCLint è‡ªå®šä¹‰ MVVM è§„åˆ™</a></li>
<li><a href="https://mp.weixin.qq.com/s/vCzUNHyLfjQKF23Biq9z-g">iOS å¢é‡ä»£ç è¦†ç›–ç‡æ£€æµ‹å®è·µ</a></li>
</ol>
<p>é˜…è¯»ä¹¦ç±æ¨èï¼š</p>
<ol>
<li>ã€ŠGetting Started with LLVM Core Librariesã€‹</li>
<li>ã€ŠModern Compiler Implementation in Cã€‹</li>
<li>ã€ŠCompilerã€‹</li>
</ol>
<h2 id="å¼€å‘å®Œæˆ"><a href="#å¼€å‘å®Œæˆ" class="headerlink" title="å¼€å‘å®Œæˆ"></a>å¼€å‘å®Œæˆ</h2><p>å½“å¼€å‘å®Œæˆåå°±éœ€è¦è¿›è¡Œè°ƒè¯•ã€æŒç»­åŒ–äº¤ä»˜ã€æµ‹è¯•ã€‚</p>
<p>LLDB è°ƒè¯•æ¨èå…ˆçœ‹<a href="https://developer.apple.com/library/archive/documentation/IDEs/Conceptual/gdb_to_lldb_transition_guide/document/Introduction.html">å®˜æ–¹æŒ‡å—</a>ï¼Œå†çœ‹è¿™ç¯‡<a href="https://objccn.io/issue-19-2/">â€œä¸è°ƒè¯•å™¨å…±èˆ - LLDB çš„åå°”å…¹â€</a>ã€‚ä¸ºäº†æ›´å¥½çš„è°ƒè¯•ä½“éªŒæ‰©å±• LLDB å¯ä»¥å‚çœ‹è¿™ç¯‡æ–‡ç« <a href="https://pspdfkit.com/blog/2018/how-to-extend-lldb-to-provide-a-better-debugging-experience/">â€œHow to Extend LLDB to Provide a Better Debugging Experienceâ€</a>ã€‚</p>
<p>å¦å¤–ï¼Œè¿™ä¸ª<a href="https://github.com/MattPD/cpplinks/blob/master/debugging.md">ç½‘å€</a>æ”¶å½•äº†å„ç§è°ƒè¯•èµ„æ–™ã€‚</p>
<p>æŒç»­åŒ–äº¤ä»˜å¯ä»¥å‚çœ‹å„å¤§å…¬å¸çš„å®è·µï¼Œæ¯”å¦‚ï¼š</p>
<ol>
<li><a href="https://zhuanlan.zhihu.com/p/69526642">çŸ¥ä¹ iOS å®¢æˆ·ç«¯å·¥ç¨‹åŒ–å·¥å…· - Venom</a></li>
<li><a href="https://mp.weixin.qq.com/s/Oa52PvsHw8wS-OvYb3ArZg">ç™¾åº¦App iOSå·¥ç¨‹åŒ–å®è·µ: EasyBoxç ´å†°ä¹‹æ—…</a></li>
<li><a href="https://mp.weixin.qq.com/s/6WAq_fM0znjO5eY12vjxFw">å¦‚ä½•å®ç°â€œæŒç»­é›†æˆâ€ï¼Ÿæ·˜ç³»é—²é±¼æŠŠç ”å‘æ•ˆç‡ç¿»äº†ä¸ªç¿»</a></li>
</ol>
<p>æµ‹è¯•æ‰©å±•é˜…è¯»æ¨èæ–‡ç« å¦‚ä¸‹ï¼š</p>
<ol>
<li><a href="https://onevcat.com/2014/02/ios-test-with-kiwi/">TDDçš„iOSå¼€å‘åˆæ­¥ä»¥åŠKiwiä½¿ç”¨å…¥é—¨</a></li>
<li><a href="https://onevcat.com/2014/05/kiwi-mock-stub-test/">Kiwi ä½¿ç”¨è¿›é˜¶ Mock, Stub, å‚æ•°æ•è·å’Œå¼‚æ­¥æµ‹è¯•</a></li>
<li><a href="https://nshipster.com/unit-testing/">Unit Testing</a></li>
<li><a href="https://tech.meituan.com/2017/06/23/mobile-app-automation.html">å®¢æˆ·ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•ç ”ç©¶</a></li>
<li><a href="https://mp.weixin.qq.com/s/5rt-uxApK-MeKYn0eKLVcQ?from_safari=1&amp;scene=40#wechat_redirect">PICKä¸€ä¸‹ï¼ŒiOSè‡ªåŠ¨åŒ–æµ‹è¯•æ–°æ–¹æ¡ˆå‡ºé“</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzIzMzk2NDQyMw==&amp;mid=2247488757&amp;idx=1&amp;sn=22465225abd30e56181ad68cdcb60e88&amp;chksm=e8fcc21ddf8b4b0bc97126bb41d95ab8df24c9db20eb9b6efd36ba969ce2e1df000b702ef639&amp;mpshare=1&amp;scene=1&amp;srcid=0221Rpn12CYSXPIE0D1ndrNi&amp;pass_ticket=QDFhyHIsSuU8LkeDk3P%2Bsli%2FL%2BwfD5Y55dNIk2PcCwbawmrDVExKHNGlflrh0dhL#rd">çˆ±å¥‡è‰ºåŸºäºAIçš„ç§»åŠ¨ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶çš„è®¾è®¡</a></li>
</ol>
<h2 id="ä¸Šçº¿å"><a href="#ä¸Šçº¿å" class="headerlink" title="ä¸Šçº¿å"></a>ä¸Šçº¿å</h2><p>å¼€å‘å®Œæˆåï¼Œåšå®Œæµ‹è¯•ï¼Œå°±å¯ä»¥ä¸Šçº¿äº†ã€‚ä¸Šçº¿åè¿˜éœ€è¦åšå¤§é‡ç›‘æ§ä¿è¯ç”¨æˆ·ä½¿ç”¨ App çš„é«˜å¯ç”¨æ€§å’Œå¥½ä½“éªŒã€‚åŠ¨æ€åŒ–ä¿è¯å‘ç‰ˆçµæ´»å’Œé—®é¢˜çš„å¿«é€Ÿä¿®å¤ã€‚</p>
<p>æ¨èçš„æ‰©å±•é˜…è¯»å¦‚ä¸‹ï¼š</p>
<ol>
<li><a href="https://everettjf.github.io/2018/08/06/ios-launch-performance-collection/">iOSåº”ç”¨å¯åŠ¨æ€§èƒ½ä¼˜åŒ–èµ„æ–™</a></li>
<li><a href="http://www.zoomfeng.com/blog/launch-time.html">iOSå¯åŠ¨æ—¶é—´ä¼˜åŒ–</a></li>
<li><a href="https://developer.apple.com/library/archive/technotes/tn2151/_index.html">Understanding and Analyzing Application Crash Reports</a></li>
<li><a href="http://www.zoomfeng.com/blog/plcrashreporter-1.html">PLCrashreporteræºç åˆ†æå…¶ä¸€</a></li>
<li><a href="http://www.zoomfeng.com/blog/plcrashreporter-2.html">PLCrashreporteræºç åˆ†æå…¶äºŒ</a></li>
<li><a href="https://inessential.com/hownottocrash">How Not to Crash</a></li>
<li><a href="https://mp.weixin.qq.com/s/XM4bhncHzRFB7zMJa-g2-Q">Loganï¼šç¾å›¢ç‚¹è¯„çš„å¼€æºç§»åŠ¨ç«¯åŸºç¡€æ—¥å¿—åº“</a></li>
<li><a href="http://yulingtianxia.com/blog/2018/02/28/Hook-Objective-C-Block-with-Libffi/">Hook Objective-C Block with Libffi</a></li>
<li><a href="https://www.fireeye.com/blog/threat-research/2016/01/hot_or_not_the_bene.html">Hot or Not? The Benefits and Risks of iOS Remote Hot Patching</a></li>
</ol>
<h2 id="è®¡ç®—æœºåŸºç¡€"><a href="#è®¡ç®—æœºåŸºç¡€" class="headerlink" title="è®¡ç®—æœºåŸºç¡€"></a>è®¡ç®—æœºåŸºç¡€</h2><p>ç»å†å¤šæ¬¡ App å¼€å‘åˆ°ä¸Šçº¿åçš„è¿‡ç¨‹ï¼Œç¢°åˆ°é—®é¢˜ï¼Œè§£å†³é—®é¢˜ï¼Œè¶Šå‘è§‰å¾—è®¡ç®—æœºåŸºç¡€çš„é‡è¦æ€§ã€‚ç‰¢å›ºçš„åŸºç¡€èƒ½æœ‰åˆ©äºç¢°åˆ°é—®é¢˜æ—¶å¿«é€Ÿå®šä½å’Œè§£å†³ã€‚</p>
<p>æ¨èæ‰©å±•é˜…è¯»æ–‡ç« å’Œèµ„æºå¦‚ä¸‹ï¼š</p>
<ol>
<li><a href="https://github.com/raywenderlich/swift-algorithm-club">Algorithms and data structures in Swift, with explanations!</a></li>
<li><a href="https://developer.apple.com/videos/play/wwdc2018/416/">iOS Memory Deep Dive</a></li>
<li><a href="https://developer.apple.com/videos/play/wwdc2012/242/">iOS App Performance: Memory</a></li>
<li><a href="http://newosxbook.com/articles/MemoryPressure.html">No pressure, Mon! Handling low memory conditions in iOS and Mavericks</a></li>
<li><a href="https://swift.gg/2017/09/07/friday-qa-2015-09-04-lets-build-dispatch_queue/">ä»é›¶æ„å»º Dispatch Queue</a></li>
<li><a href="http://yulingtianxia.com/blog/2017/08/28/Threading-Programming-Guide-1/">Threading Programming Guide(1)</a></li>
<li><a href="http://yulingtianxia.com/blog/2017/09/17/Threading-Programming-Guide-2/">Threading Programming Guide(2)</a></li>
<li><a href="http://yulingtianxia.com/blog/2017/10/08/Threading-Programming-Guide-3/">Threading Programming Guide(3)</a></li>
<li><a href="https://swift.gg/2018/06/07/friday-qa-2015-02-06-locks-thread-safety-and-swift/">Swift ä¸­çš„é”å’Œçº¿ç¨‹å®‰å…¨</a></li>
<li><a href="http://satanwoo.github.io/2016/10/23/multithread-dangling-pointer/">æµ…è°ˆä¸€ç§è§£å†³å¤šçº¿ç¨‹é‡æŒ‡é’ˆçš„æ–°æ€è·¯</a></li>
<li><a href="https://bestswifter.com/deep-gcd/">æ·±å…¥ç†è§£ GCD</a></li>
<li><a href="https://xiaozhuanlan.com/Grand-Central-Dispatch">æ·±å…¥æµ…å‡ºGCD</a></li>
<li><a href="http://mrpeak.cn/blog/ios-runloop/">è§£å¯† Runloop</a></li>
<li><a href="https://mp.weixin.qq.com/s/gPZnR7sF_22KSsqepohgNg">Matrix-iOS å¡é¡¿ç›‘æ§</a></li>
</ol>
<h2 id="é€šç”¨çŸ¥è¯†"><a href="#é€šç”¨çŸ¥è¯†" class="headerlink" title="é€šç”¨çŸ¥è¯†"></a>é€šç”¨çŸ¥è¯†</h2><p>iOS å¼€å‘ä¸­è¿˜æœ‰å¾ˆå¤šå’Œå…¶ä»–è®¡ç®—æœºé¢†åŸŸç›¸é€šçš„çŸ¥è¯†ï¼Œæ¯”å¦‚æ¸²æŸ“ã€æ•°æ®åº“ã€ç½‘ç»œç­‰ã€‚</p>
<p>æ¨èæ‰©å±•é˜…è¯»æ–‡ç« æœ‰ï¼š</p>
<ol>
<li><a href="https://lision.me/ios_rendering_process/">æ·±å…¥ç†è§£ iOS Rendering Process</a></li>
<li><a href="https://objccn.io/issue-3-1/">ç»˜åˆ¶åƒç´ åˆ°å±å¹•ä¸Š</a></li>
<li><a href="https://swift.gg/2017/04/25/how-do-I-build-a-network-layer/">æ‰‹æŠŠæ‰‹æ•™ä½ å°è£…ç½‘ç»œå±‚</a></li>
<li><a href="https://github.com/Ikiga/IkigaJSON">A high performance JSON library in Swift</a></li>
</ol>
<p>ç½‘ç»œç›¸å…³æ–‡ç« æ¨èå¦‚ä¸‹ï¼š</p>
<ol>
<li><a href="https://mp.weixin.qq.com/s/BIfya6eVaWZW9ZEVz8RRcg">ç™¾åº¦Appç½‘ç»œæ·±åº¦ä¼˜åŒ–ç³»åˆ—ã€Šä¸‰ã€‹å¼±ç½‘ä¼˜åŒ–</a> </li>
<li><a href="http://zhoulingyu.com/2018/05/30/ios-network-traffic/">iOS æµé‡ç›‘æ§åˆ†æ | å‘¨å°é±¼ã®CODE_HOME</a> </li>
<li><a href="https://github.com/bestswifter/blog/blob/master/articles/tcp-ip-1.md">TCP/IPï¼ˆä¸€ï¼‰ï¼šæ•°æ®é“¾è·¯å±‚</a> </li>
<li><a href="https://github.com/bestswifter/blog/blob/master/articles/tcp-ip-2.md">TCP/IPï¼ˆäºŒï¼‰ï¼šIP åè®®</a> </li>
<li><a href="https://github.com/bestswifter/blog/blob/master/articles/tcp-ip-3.md">TCP/IPï¼ˆä¸‰ï¼‰ï¼šIP åè®®ç›¸å…³æŠ€æœ¯</a> </li>
<li><a href="https://github.com/bestswifter/blog/blob/master/articles/tcp-ip-4.md">TCP/IPï¼ˆå››ï¼‰ï¼šTCP ä¸ UDP åè®®ç®€ä»‹</a> </li>
<li><a href="https://github.com/bestswifter/blog/blob/master/articles/tcp-ip-5.md">TCP/IPï¼ˆäº”ï¼‰ï¼šTCP åè®®è¯¦è§£</a> </li>
<li><a href="https://github.com/bestswifter/blog/blob/master/articles/tcp-ip-6.md">TCP/IPï¼ˆå…­ï¼‰ï¼šHTTP ä¸ HTTPS ç®€ä»‹</a> </li>
<li><a href="http://chuansong.me/n/2577464">æºç¨‹Appçš„ç½‘ç»œæ€§èƒ½ä¼˜åŒ–å®è·µ</a> </li>
<li><a href="http://tech.meituan.com/SharkSDK.html">ç¾å›¢ç‚¹è¯„ç§»åŠ¨ç½‘ç»œä¼˜åŒ–å®è·µ</a> </li>
<li><a href="http://course.tuicool.com/course/details/58058f15a826b5f9e86678fb">ä¸‡äººä½å¤´æ—¶ä»£ï¼Œæ”¯ä»˜å®APPæ— çº¿ç½‘ç»œæ€§èƒ½è¯¥å¦‚ä½•ä¿éšœ</a> </li>
<li><a href="https://mp.weixin.qq.com/s/qD9-Xj0CEil0Wtwq5eiPTg">QQç©ºé—´åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨QUICåè®®çš„ç»éªŒ</a> </li>
<li><a href="https://mp.weixin.qq.com/s/mRcz8o0usoqm_cEoGg9btg">ç¾å›¾HTTPSä¼˜åŒ–æ¢ç´¢ä¸å®è·µ</a> </li>
<li><a href="https://github.com/bestswifter/blog/blob/master/articles/https-9-questions.md">ä¹ä¸ªé—®é¢˜ä»å…¥é—¨åˆ°ç†Ÿæ‚‰ HTTPS</a> </li>
<li><a href="https://github.com/bestswifter/blog/blob/master/articles/quic.md">è¯•å›¾å–ä»£ TCP çš„ QUIC åè®®åˆ°åº•æ˜¯ä»€ä¹ˆ</a> </li>
<li><a href="https://github.com/bestswifter/blog/blob/master/articles/http-encoding.md">å°è°ˆ HTTP ä¸­çš„ç¼–ç </a> </li>
<li><a href="https://github.com/bestswifter/blog/blob/master/articles/wireshark.md">åˆ©ç”¨ WireShark æ·±å…¥è°ƒè¯•ç½‘ç»œè¯·æ±‚</a> </li>
<li><a href="https://juejin.im/post/59caf86ef265da06484467e5">å…³äº iOS HTTP2.0 çš„ä¸€æ¬¡å­¦ä¹ å®è·µ - æ˜é‡‘</a> </li>
<li><a href="http://blog.cnbang.net/tech/3531/">ç§»åŠ¨ APP ç½‘ç»œä¼˜åŒ–æ¦‚è¿° Â« bangâ€™s blog</a> </li>
<li><a href="http://wereadteam.github.io/2016/02/25/GYHttpMock/">GYHttpMockï¼šiOS HTTPè¯·æ±‚æ¨¡æ‹Ÿå·¥å…· | WeReadå›¢é˜Ÿåšå®¢</a> </li>
<li><a href="https://knightsj.github.io/2017/07/18/YTKNetwork%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/">YTKNetworkæºç è§£æ | J<em>Knight</em></a> </li>
<li><a href="https://github.com/lefex/LefexWork/blob/master/blog/iOS/iOS%20%E9%9C%80%E8%A6%81%E6%8E%8C%E6%8F%A1%E7%9A%84%20HTTP%20%E7%9F%A5%E8%AF%86.md">LefexWork/iOS éœ€è¦æŒæ¡çš„ HTTP çŸ¥è¯†.md at master Â· lefex/LefexWork Â· GitHub</a> </li>
<li><a href="https://github.com/lefex/LefexWork/blob/master/blog/iOS/%E4%BB%A5%E4%B8%8D%E4%B8%80%E6%A0%B7%E7%9A%84%E6%96%B9%E5%BC%8F%E7%90%86%E8%A7%A3SDWebImage.md">LefexWork/ä»¥ä¸ä¸€æ ·çš„æ–¹å¼ç†è§£SDWebImage.md at master Â· lefex/LefexWork Â· GitHub</a> </li>
<li><a href="https://blog.csdn.net/Hello_Hwc/article/details/72853786">Alamofireçš„è®¾è®¡ä¹‹é“ - Leoçš„ä¸“æ  - CSDNåšå®¢</a> </li>
</ol>
<h2 id="ä¸“æœ‰çŸ¥è¯†"><a href="#ä¸“æœ‰çŸ¥è¯†" class="headerlink" title="ä¸“æœ‰çŸ¥è¯†"></a>ä¸“æœ‰çŸ¥è¯†</h2><p>ä¸“æœ‰çŸ¥è¯†æˆ‘å°±ä¸å±•å¼€è¯´äº†ï¼Œå‚è€ƒä¸Šé¢èˆ†å›¾ä¸­æ ‡æ³¨çš„çŸ¥è¯†ç‚¹å»æ£€ç´¢ä½ éœ€è¦çš„å°±å¯ä»¥äº†ã€‚</p>
<h2 id="è§†é‡"><a href="#è§†é‡" class="headerlink" title="è§†é‡"></a>è§†é‡</h2><p>æ¨èæ‰‹å†Œï¼š</p>
<ol>
<li><a href="https://developer.apple.com/documentation/">Apple Developer Documentation</a></li>
<li><a href="https://swiftgg.gitbook.io/swift/huan-ying-shi-yong-swift">Swift å¼€å‘æ‰‹å†Œ</a></li>
</ol>
<p>å¼€æºæ§ä»¶ï¼š</p>
<ol>
<li><a href="https://iosexample.com">iOS Example</a></li>
<li><a href="https://www.cocoacontrols.com">Cocoa Controls</a></li>
<li><a href="https://github.com/matteocrippa/awesome-swift">awesome-swift</a></li>
<li><a href="https://xiaozhuanlan.com/topic/5796328014">Swift å¼€æºé¡¹ç›®ç²¾é€‰ - åº”ç”¨æ¶æ„è§’åº¦</a></li>
<li><a href="https://xiaozhuanlan.com/topic/5271086934">Swift å¼€æºé¡¹ç›®ç²¾é€‰å¯¼å›¾</a></li>
<li><a href="https://github.com/ipader/SwiftGuide">SwiftGuide</a></li>
<li><a href="https://xiaozhuanlan.com/topic/7314260859">Swift å¼€æºé¡¹ç›®å›¢é˜Ÿä»‹ç»</a></li>
<li><a href="https://xiaozhuanlan.com/topic/9687124530">Swift çŸ¥åå¼€å‘è€…ä»‹ç»</a></li>
</ol>
<p>è§†é¢‘æ¨è  <a href="https://talk.objc.io/">Swift Talk - objc.io</a> ã€‚</p>
<p>è¿™é‡Œçš„ iOS åšå®¢éƒ½å¾ˆå€¼å¾—è®¢é˜…ï¼Œ<a href="https://github.com/awesome-tips/blogs">GitHub - awesome-tips/blogs: è¡Œä¸šä¼˜è´¨åšå®¢æ±‡æ€»</a>ã€‚</p>
<p>å…¶ä»–èµ„æºå‚çœ‹ä¸Šé¢çš„åœ°å›¾ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;43ç¯‡ &lt;a href=&quot;https://time.geekbang.org/column/intro/161&quot;&gt;ã€ŠiOSå¼€å‘é«˜æ‰‹è¯¾ã€‹&lt;/a&gt;å·²å®Œæˆï¼Œåé¢ä¼šå¯¹å†…å®¹è¿›è¡Œè¿­ä»£ï¼Œä¸°å¯Œä¸‹å†…å®¹å’Œé…å›¾ã€‚æœ€è¿‘ç”»äº†å¼  iOS å¼€å‘å…¨æ™¯èˆ†å›¾ï¼Œè¿˜æœ‰ç›¸å…³ä¸€äº›èµ„æ–™æ•´ç†ï¼Œæ–¹ä¾¿æˆ‘å¹³æ—¶å¼€å‘ App æ—¶å‚
    
    </summary>
    
      <category term="Programming" scheme="http://ming1016.github.io/categories/Programming/"/>
    
    
      <category term="iOS" scheme="http://ming1016.github.io/tags/iOS/"/>
    
      <category term="Swift" scheme="http://ming1016.github.io/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>ç™½é¾™ç­</title>
    <link href="http://ming1016.github.io/2019/06/19/white-dragon-class/"/>
    <id>http://ming1016.github.io/2019/06/19/white-dragon-class/</id>
    <published>2019-06-19T11:24:38.000Z</published>
    <updated>2021-04-11T14:42:09.935Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¿™æ˜¯æˆ‘åäºŒå¹´å‰å†™çš„ä¸€ç¯‡å°è¯´ã€‚å½“å¹´æ¯å¤©æ—©ä¸Š8ç‚¹åŠä¸Šç­ï¼Œä¸ºäº†å†™è¿™ç¯‡ï¼Œæˆ‘å››ç‚¹èµ·åºŠï¼Œå†™åˆ°æ—©é¥­å‰ï¼ŒåšæŒäº†å¥½å‡ å‘¨æ‰å®Œæˆã€‚</p>
<h2 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h2><p>ç§‹å¤©çš„ç™½é¾™å±±ä¸Šï¼ŒèŒ‚å¯†çš„æ ‘å¶æ¸æ¸æ¯èï¼Œé£ä¸­å¼€å§‹é€ç€ä¸ä¸å¯’æ„ã€‚ç™½é¾™ç­é‡Œå¤šäº†äº”åæ¥ä¸ªä¸€çº§æˆå‘˜ã€‚è¿™äº›ä¼˜ç§€çš„å­¦ç”Ÿåˆ†å¸ƒåœ¨ä¸åŒçš„è€å¸ˆæ‰‹ä¸Šï¼Œå¦‚ä»Šé£é€¸è€å¸ˆæ‰‹ä¸‹å·²ç»æœ‰äº†ä¹ä¸ªä¸€çº§æˆå‘˜ï¼Œä¸¤ä¸ªäºŒçº§æˆå‘˜ã€‚</p>
<p>åœ¨è¿™ä¹åä¸€çº§æˆå‘˜ä¸­ï¼Œæœ‰ä¸€ä¸ªå­¦ç”Ÿåå«æš´ï¼Œæ²™è¥¿å¾·æ˜Ÿäººï¼Œç™½å‘ï¼Œå¸¸ç©¿ä¸€å¥—æ·±ç´«åº•è‰²é»‘èŠ±çº¹ç´§èº«è¡£ï¼Œå¸¦ç€è§å…‰å å­ã€‚å¥¹åªç”¨ä¸€å¹´æ—¶é—´å°±å‡çº§æˆä¸ºä¸€çº§æˆå‘˜ã€‚å¥¹ä¸ºäººååˆ†å†·æ·¡ï¼Œè¡Œäº‹å†·é™ï¼Œæå°‘ä¸äººäº¤è°ˆã€‚åœ¨å‡çº§ç«èµ›ä¸­å¥¹é€‰æ‹©çš„ç§‘ç›®æ˜¯ä½œæ›²ï¼Œå¥¹çš„å‚èµ›ä¹è°±ã€Šæ¸…å¿ƒå®é™ã€‹ï¼Œ â€œå®«ï¼Œå•†ï¼Œè§’ï¼Œå¾µï¼Œç¾½â€äº”éŸ³åè°ƒï¼Œå¹åƒå™¨å¥å‡ºï¼Œè¿™æ˜¯éå¸¸ä¼ ç»Ÿçš„ä¸€ç§è°±æ›²ï¼Œç°åœ¨ä½¿ç”¨çš„å¹¶ä¸å¾ˆå¤šã€‚è¯„å§”èµ·åˆå°±è§‰å¾—æ›²å­ååˆ†å¥½å¬ï¼Œåªæ˜¯è§‰å¾—ç”±è¿™å°å§‘å¨˜å¹åƒå™¨è€Œå‡ºï¼Œå¤ªè¿‡ä¼ ç»Ÿä¸æ¼”å¥è€…å½¢è±¡ä¸å¤ªåè°ƒã€‚ä½†è¿™æ›²å­å®ä¹ƒæš´æ‰€è°±ã€‚åˆ°äº†åé¢éƒ¨åˆ†ï¼ŒèŠ‚æ‹æ¸æ¸åŠ å¿«ï¼Œäº”éŸ³åˆåŠ ä¸Šä¸¤éŸ³ï¼Œä½¿å¾—æ›²å­æ·³åŒ–å…¥è€³ï¼Œæ­£å½“è¯„å§”å¬å¾—å¿ƒæƒ…éœ‡è¡ï¼Œå¦‚ç—´å¦‚é†‰ä¹‹æ—¶ï¼Œæ›²å­æé€Ÿè¿›å…¥é«˜æ½®ï¼Œä¸¤ä¸‰ä¸ªå›æ—‹ä¹‹åæˆ›ç„¶è€Œæ­¢ï¼Œä½™éŸµç»•æ¢ï¼Œæ„çŠ¹æœªå°½ã€‚æš´å°†åƒå™¨æ”¾ä¸‹ï¼Œä¸€ä¸ªè¯„å§”ä¸Šå‰æ‹¿èµ·è¿™åƒå™¨ä»”ç»†è§‚æ‘©ï¼Œæ˜¾ç„¶è¿™ä½å¹´è½»çš„è¯„å§”è¿˜æ²¡æœ‰è§è¿‡è¿™å¤è€çš„ä¹å™¨ã€‚</p>
<p>å¹´è½»è¯„å§”é—®é“ï¼šâ€œä½ è¿™ç©æ„å¹å‡ºæ¥çš„å£°éŸ³å¾ˆå¥‡ç‰¹ä¹Ÿå¾ˆå¥½å¬ï¼Œèƒ½å‘Šè¯‰æˆ‘è¿™æ˜¯ä»€ä¹ˆå—ï¼Ÿâ€</p>
<p>æš´è¡¨æƒ…å¹³æ·¡åœ°è¯´é“ï¼šâ€œè¿™æ˜¯æ²™è¥¿å¾·æ˜Ÿç‰¹æœ‰çš„å¹å¥ä¹å™¨ï¼Œæˆ‘ä»¬å«å®ƒåƒå™¨ï¼Œåƒå™¨å½¢ä½“ä¸ºå¹³åº•åµå½¢ï¼Œæ‹¿åœ¨æ‰‹ä¸­ä¾¿å¯è¿æŒ‡æ¼”å¥ï¼Œä¸ºäº†å‡å°‘å¤æ‚çš„å‰å£æŒ‡æ³•ï¼Œæˆ‘å°†å…¶éŸ³å­”æŒ‰ç›¸ä¼¼äºå†¥æ˜Ÿç¬›å­çš„éŸ³å­”é¡ºåºæ’åˆ—ã€‚åƒå™¨çš„å¹å¥è€…å¯å¹å‡ºäºŒåå…­éŸ³ï¼ŒåŒ…æ‹¬ä¸¤ä¸ªå…«åº¦å†…çš„å…¨éƒ¨åŠéŸ³å’Œä¸€ä¸ªæ³›éŸ³ã€‚â€</p>
<p>å¹´è½»è¯„å§”è¯´ï¼šâ€œåŸæ¥æ˜¯åƒå™¨å•Šï¼Œåƒå™¨çš„æ›²å­æˆ‘ä»¥å‰ä¹Ÿæ›¾å¬è¿‡ï¼Œä½†æ˜¯æ€ä¹ˆå¬ä½ æ¼”å¥çš„å‘³é“ä¸ä»¥å‰æˆ‘ä»¬å¬è¿‡çš„å®Œå…¨ä¸åŒã€‚â€</p>
<p>æš´è¯´ï¼šâ€œé‚£æ˜¯å½“ç„¶ï¼Œæˆ‘å¾ˆæ—©å°±å¼€å§‹åˆ¶ä½œä»¿å¤çš„åƒå™¨ï¼ŒæŠŠå¤åˆ¶æ¢¨å½¢å…­å­”éª¨åƒå™¨æ”¹é€ ä¸ºæ–°å‹çš„ä¹å­”åƒå™¨ï¼Œææ–™ä½¿ç”¨çš„æ˜¯æ²™è¥¿å¾·çš„ç´«é™¶ã€‚è¿™ä¹å­”åƒå™¨åœ¨ä¿ç•™äº†åŸå…­å­”éª¨åƒå™¨çš„å¤–å½¢å’ŒéŸ³è‰²ä¸Šåˆå¢å¤§äº†éŸ³é‡ï¼Œæ‰©å±•äº†éŸ³åŸŸï¼Œèƒ½å¹å‡ºå…¨éŸ³é˜¶å’ŒåŠéŸ³é˜¶ï¼Œä½¿å®ƒæˆä¸ºå¯ä»¥è½¬è°ƒçš„ä¹å™¨ã€‚â€</p>
<p>å¹´è½»è¯„å§”è¯´ï¼šâ€œéš¾æ€ªè¿™éŸ³è‰²è¿™ä¹ˆå¤æœ´é†‡åšï¼Œä½æ²‰æ‚²å£®ï¼Œæå¯Œç‰¹è‰²ã€‚ä½ æ”¹å˜ä»¥å‰åƒå™¨çš„éŸ³å­”æ’åˆ—æ–¹å¼ï¼Œä½¿æ¼”å¥æ›´ä¸ºæ–¹ä¾¿å®¹æ˜“äº†ã€‚æˆ‘è¿˜æƒ³é—®ä¸€ä¸‹ï¼Œæ˜¯ä¸æ˜¯ç”¨å®ƒæ—¢å¯ä»¥ç‹¬å¥ï¼Œåˆå¯ä»¥åˆå¥æˆ–ä¼´å¥ï¼Ÿâ€</p>
<p>æš´å›ç­”è¯´ï¼šâ€œåˆå¥ä¼´å¥å°±ä¸å¿…äº†ï¼Œæˆ‘ä¸€ç›´éƒ½æ˜¯ç”¨å®ƒç‹¬å¥ã€‚â€</p>
<p>å¹´è½»è¯„å§”ç»§ç»­é—®é“ï¼šâ€œæˆ‘ä»¥å‰å¬è¯´åƒå™¨éš¾å¥é«˜éŸ³ï¼Œä¸çŸ¥ä½ çš„ã€Šæ¸…å¿ƒå®é™ã€‹ååŠéƒ¨åˆ†èƒ½æ¼”å¥å‡ºé«˜éŸ³æ˜¯ä½•ç¼˜æ•…ã€‚ä¹Ÿæ˜¯å› ä¸ºä½ æ”¹é€ äº†åƒå™¨çš„ç¼˜æ•…å—ï¼Ÿâ€</p>
<p>æš´è¯´ï¼šâ€œæ­£æ˜¯ã€‚ä½†æ˜¯æˆ‘åé¢é‚£éƒ¨åˆ†æ›²å­å¹¶ä¸æ˜¯æˆ‘å‚èµ›æ›²å­ã€Šæ¸…å¿ƒå®é™ã€‹ï¼Œè€Œæ˜¯æˆ‘å¦å¤–ä¸€éƒ¨ã€Šå¿ƒæ— ç‚¹å°˜ã€‹ï¼Œæˆ‘ä¸€æ—¶å…´èµ·å°†å®ƒå¥äº†å‡ºæ¥ã€‚å¦‚è¦è®©åƒå™¨å¥å‡ºé«˜éŸ³ï¼Œå¹¶ä¸éš¾ï¼Œåªæ˜¯æ¼”å¥é«˜éŸ³çš„æ–¹æ³•è¿˜éœ€å¤šå¤šç ”ç©¶ã€‚ä½ ä»”ç»†çœ‹çœ‹æˆ‘çš„é‚£ä¸ªåƒå™¨ã€‚â€</p>
<p>å¹´è½»è¯„å§”æ¥è¿‡æš´é€’è¿‡æ¥çš„åƒå™¨ï¼Œä»”ç»†å¯Ÿçœ‹ã€‚è§é‚£åƒå™¨å¹³åº•åµå½¢ï¼Œç´«é™¶é“¸å°±ï¼Œé«˜å¤§çº¦å…«å˜ç±³ï¼Œè…¹å¾„ä¸ƒå˜ç±³ï¼Œå¤–è¡¨é•¶åµŒä¸€å—çº¢æœ¨ï¼Œçº¢æœ¨é¥°ç‰‡ä¸Šåˆ»ç»˜ç€ä¸€æ¡ç™½é¾™å’Œå‡ å—äº‘çº¹ã€‚éŸ³å­”å‰ä¸ƒåäºŒï¼ŒåŠ ä¸Šä¾§é¢ä¸€ä¸ªè¾ƒå¤§çš„å­”ï¼Œå…±ä¸ºåå­”ã€‚å¹´è½»è¯„å§”çœ‹åˆ°è¿™é‡Œï¼Œå¤§æ‚Ÿèˆ¬è¯´é“ï¼šâ€œæˆ‘æ˜ç™½äº†ï¼Œå…¨å‡­å¤šå‡ºçš„è¿™ä¸€ä¸ªå¤§å­”ã€‚â€</p>
<p>æš´å†·å†·çš„è¯´ï¼šâ€œä¸æ˜¯ã€‚æ˜¯å› ä¸ºæ‰€ç”¨ç´«é™¶çš„ç¼˜æ•…ã€‚é‚£ä¸ªè¾ƒå¤§çš„å­”æ˜¯å¹å­”ï¼Œåˆšæ‰æˆ‘å¹å¥æ—¶ä½ æ²¡æ³¨æ„åˆ°å—ï¼Ÿâ€</p>
<p>å¹´è½»è¯„å§”çš„è„¸ä¸€ä¸‹å­çº¢äº†èµ·æ¥ï¼ŒåŸæ¥åˆšæ‰ä»–å¬å¾—å¦‚é†‰å¦‚ç—´ï¼Œä¼¼å…¥ä»™å¢ƒä¸€èˆ¬ï¼Œçœ¼çœ¼ä¸€ç›´çœ‹ç€ç¾ä¸½å†·è‰³çš„æš´ï¼Œå¦‚åŒå¬ç€æ‚¦è€³æ›²å­æ—¶æ¬£èµç€ä¸€å‰¯èµå¿ƒæ‚¦ç›®çš„ç”»ä¸€èˆ¬ã€‚è‡³äºé‚£éŸ³ä¹å¦‚ä½•å‘å‡ºçš„ä»–å“ªé‡Œé¡¾å¾—ç®¡å•Šã€‚</p>
<p>æš´ä¼¸æ‰‹å°†å¹´è½»è¯„å§”æ‰‹ä¸­æ‹¿ç€çš„åƒå™¨æ‹¿äº†è¿‡æ¥ï¼Œè½¬èº«å°†å…¶æ”¾å…¥æŒåŒ…é‡Œï¼Œé¡ºæ‰‹å–å‡ºä¸€åªå—¤ï¼Œä¼—è¯„å§”çŒœæƒ³è¿™ä¸€å®šåˆæ˜¯ä¸€ä»¶è¢«æ”¹é€ è¿‡çš„å¤ä¹å™¨ï¼Œäºæ˜¯æ²¡æœ‰å†å¤šé—®äº›ä»€ä¹ˆï¼Œç¤ºæ„æš´ç»§ç»­æ¼”å¥ã€‚</p>
<p>ä¸€æ®µæ‚ é•¿çš„é¢¤åŠ¨æ³¢è¿‡åï¼Œæ›²å­å¾ˆå¿«è¿›å…¥æ¬¢å¿«é˜¶æ®µï¼ŒèŠ‚å¥è™½å¿«ï¼Œå´ä¸æ‚ä¹±ï¼Œæ¬¢å¿«æ„‰æ‚¦ä¹‹æƒ…éšå³è€Œæ¥ï¼Œè€è€…å¬æ­¤ä¾¿ä¼šå¿†èµ·å„¿æ—¶æ¬¢å¿«æ—¶å…‰ï¼Œä¸­å¹´äººå¬æ—¶ä¾¿è§‰ä½™åŠ›æœªå‡ï¼Œé’å¹´å¬æ—¶é¡¿æ„Ÿçƒ­è¡€æ²¸è…¾ã€‚å—¤åŸæœ¬åªæœ‰å…­å­”ï¼Œè¿˜åŒ…æ‹¬äº†ä¸Šå‡ºå­”ï¼Œæ˜¯åº•ç«¯å°é—­çš„ä¸€ç§æ¨ªå¹ç«¹ç®¡ä¹å™¨ï¼Œå—¤å’Œç¬›ç”¨æ–™ç›¸åŒï¼Œè¯»éŸ³ç›¸è¿‘ï¼Œä½†æ˜¯æ‰€å¥ä¹‹éŸ³å´å¤§ä¸ç›¸åŒã€‚æš´æ‰‹ä¸­è¿™ä¸ªå—¤å¦‚åƒå™¨èˆ¬è¢«æ”¹é€ ä¸ºåå­”ã€‚ä½¿ç”¨åŠå­”æŒ‡æ³•ï¹å¯å¹å…¨åäºŒå¾‹ã€‚</p>
<p>ä¼—è¯„å§”çœ‹ç€æš´ç†Ÿç»ƒçš„è¿æŒ‡åŠ¨ä½œï¼Œæ‰‹ä¸­æ— ä¸æ‘äº†ä¸€æŠŠå†·æ±—ï¼Œä½†å‡¡ä½¿ç”¨è¿‡ä¹å™¨åˆç‰¹åˆ«ç²¾é€šç¬›å’Œå¼¦å¥ä¹å™¨ç±»çš„äººï¼Œæ— ä¸æƒŠå¹æš´çš„è¿™åŒæ‰‹èƒ½å¤Ÿåœ¨åŒä¸€èŠ‚æ‹ä¸­åŒæ—¶å¥å‡ºè®¸å¤šç§éŸ³ï¼Œå¬èµ·æ¥å¦‚åŒå››äº”ä¸ªäººåˆå¥ä¸€èˆ¬ã€‚ç›‘ç®¡äººå‘˜ä¹Ÿå½“åœºç¡®å®šæš´æ²¡ç”¨é­”æ³•èˆå¼Šã€‚</p>
<p>æ­£å½“å¤§å®¶å…¨ç¥å…³æ³¨æš´çš„æ¼”å¥ä¹‹æ—¶ã€‚æœ‰ä¸€ä½å¥³è¯„å§”å®åœ¨å¿ä¸ä½äº†ï¼Œå¥¹çªç„¶ç«™èµ·æ¥è¯´é“ï¼šâ€œç­‰ç­‰ã€‚â€</p>
<p>æš´ç«‹å³åœæ­¢å¹å—¤åŠ¨ä½œï¼Œå¥‡æ€ªçš„çœ‹ç€å¥¹ã€‚å‘ç°è¿™ä¸ªå¥³è¯„å§”æ–¹å½¢è„¸è›‹ï¼Œå¸¦ç€ä¸€å‰¯çœ¼é•œï¼Œå…¶ä½™æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«ä¹‹å¤„ã€‚</p>
<p>å¥³è¯„å§”è¯´é“ï¼šâ€œä½ åœåœï¼Œä½ å†å°†å…ˆå‰é‚£ã€Šæ¸…å¿ƒå®é™ã€‹é‡å¥ä¸€éï¼Œå½“ç„¶èƒ½å¤Ÿé¡ºä¾¿å°†ã€Šå¿ƒæ— ç‚¹å°˜ã€‹ä¹Ÿå¹å¥å‡ºæ¥é‚£æ˜¯æœ€å¥½ï¼Œæˆ‘å¾ˆæƒ³å†å¬ä¸€éã€‚â€</p>
<p>æš´æ¼ è§†çš„è¯´é“ï¼šâ€œæˆ‘é‚£ã€Šæ¸…å¿ƒå®é™ã€‹æœ‰ä¹åå…«æ®µï¼Œã€Šå¿ƒæ— ç‚¹å°˜ã€‹äºŒç™¾é›¶ä¸€æ®µã€‚æˆ‘æ€èƒ½åœ¨è¿™ä¸€ä¸‹å­å¥å®Œã€‚è¿™äº›æ›²æ®µéƒ½æ˜¯æˆ‘æ ¹æ®æ‰€é‡ä¸åŒäº‹æƒ…æ—¶çš„ä¸åŒå¿ƒæƒ…è°±å†™å‡ºæ¥çš„ã€‚ç«èµ›å¼€å§‹æ—¶æˆ‘æœ‰å‡ åˆ†ç´§å¼ ï¼Œæ‰€ä»¥æˆ‘å¹å¥äº†å…¶ä¸­ä¸€æ®µâ€œé—­æœˆç¾èŠ±â€ã€‚æ—¶é—´ä¸€é•¿ï¼Œæˆ‘å°±ä¸å†ç´§å¼ ï¼Œæˆ‘ä¾¿éšæ€§å¹å¥äº†ã€Šå¿ƒæ— ç‚¹å°˜ã€‹ä¸­çš„ä¸€æ®µçŸ­æ›²â€œå‚¬æƒ…â€ï¼Œåè§‰ä¸å¦¥ï¼Œä¾¿å°†å…¶ç¼©çŸ­ï¼Œè‰è‰ç»“æŸã€‚ä½ ç«ç„¶å«æˆ‘æŠŠå®ƒä»¬å…¨éƒ¨é‡å¥ä¸€éï¼Œæˆ‘æ€èƒ½åŠåˆ°å‘¢ï¼Ÿâ€</p>
<p>å¥³è¯„å§”çœ‹æš´å¹¶æ— å–„æ„ï¼Œå¥¹ç”¨çœ¼ç¥ä½™å…‰å‘å‘¨å›´ç§å»ï¼Œçœ‹åˆ°çš„éƒ½æ˜¯ä¼—è¯„å§”å¯¹è‡ªå·±çš„è´£æ€ªï¼Œå°±è¯†è¶£çš„åäº†ä¸‹æ¥ã€‚</p>
<p>åœ¨åœºçš„è¿˜æœ‰å†¥æ˜Ÿå¤§å‹é›†å›¢çš„è®¸å¤šé«˜å±‚äººç‰©ï¼Œä»–ä»¬ä¸€çœ¼å°±çœ‹å‡ºäº†æš´çš„å•†ç”¨ä»·å€¼ï¼Œå¥¹é‚£ä¸¤éƒ¨æ›²è°±å’Œæ¥è¿‘ä¸‰ç™¾ä¸ªæå…·ç‰¹è‰²çš„æ›²æ®µå¦‚æœç”¨äºå•†ä¸šæ¼”å‡ºï¼Œä¸€å®šèƒ½åˆ›é€ å¾ˆå¤§çš„åˆ©æ¶¦ã€‚è€Œä¸”æš´è¿˜å¾ˆå¹´è½»ï¼Œä»…åå…­å²ï¼Œä¸”ç›¸è²Œå‡ºä¼—ï¼Œèº«æåŒ€ç§°ã€‚å½“å³åœ¨åœºçš„é‚£äº›é«˜å±‚äººç‰©äº‰ç›¸è¯¢é—®èµ·æš´çš„ç›¸å…³æƒ…å†µæ¥ã€‚</p>
<p>æš´æ­£å‡†å¤‡ç¦»å¼€ç«èµ›èˆå°ï¼Œä¸»è¯„å§”å«ä½äº†å¥¹ã€‚</p>
<p>æš´æ‰­è¿‡åŠè¾¹è„¸ä½å£°è¯´ï¼šâ€œæˆ‘å·²å¥å®Œï¼Œå¦‚ä½•è¯„æ–­ä½ ä»¬å•†é‡å»å§ï¼Œå¦‚ä½ ä»¬ä¸æ˜¯å› ä¸ºæˆ‘çš„æ›²å­è€Œæ˜¯æˆ‘æœ¬äººçš„ç¼˜æ•…è¯„åˆ¤ä¸å…¬ï¼ŒæŸåçš„åªæ˜¯ä½ ä»¬ç™½é¾™ç­çš„åèª‰ï¼Œä¸æˆ‘æ— å…³ã€‚â€</p>
<p>ä¸»è¯„å§”ä¸€è„¸å§”å±ˆåœ°è¯´é“ï¼šâ€œæˆ‘ä¸æ˜¯è¿™ä¸ªæ„æ€ï¼Œæˆ‘æƒ³æˆ‘ä»¬åœ¨åº§å„ä½è¯„å§”å¯¹ä½ çš„æ›²å­éƒ½ååˆ†å–œæ¬¢çš„ï¼Œä½ ä¹Ÿä¸ç”¨æ‹…å¿ƒå‡çº§ä¸€äº‹ã€‚å¤šå°‘å¹´æ¥ï¼Œç™½é¾™ç­å¾ˆå°‘æœ‰äººèƒ½åƒä½ è¿™æ ·ï¼Œä¸ä»…èƒ½è°±å‡ºç¾å¦™çš„æ›²å­ï¼Œè¿˜èƒ½å°†å¤ä¹å™¨æ”¹é€ ä¸ºé€‚åˆæ¼”å¥æ‰€è°±æ›²è°±çš„ä¹å™¨ã€‚æˆ‘å¹¶ä¸æ˜¯è¦å‹‰å¼ºä½ å†å¥ä¸€éï¼Œæˆ‘åªæ˜¯è§‰å¾—ä½ ä½¿ç”¨çš„æ˜¯å¤§å®¶æ‰€ä¸ç†Ÿæ‚‰çš„ä¹å™¨ï¼Œä½ å¹å¥ä¸€éå°±è®©ä¼—è¯„å§”å¯¹ä½ åšå‡ºæ­£ç¡®è¯„ä»·æ˜¯æœ‰ä¸€å®šéš¾åº¦çš„ã€‚ä½ ä¸ºä½•ä¸ç”¨ä¸€ä»¶é€šç”¨ä¹å™¨æ¥æ¼”å¥ä¸€éå‘¢ï¼Ÿâ€</p>
<p>æš´å¿ƒæƒ³ï¼šâ€œè¿™èˆ¬ç»•å¼¯å­ï¼Œå°±æ˜¯ä¸ç›¸ä¿¡æˆ‘äº†ã€‚éš¾é“ä»–ä»¬è¿˜ä»¥ä¸ºæˆ‘è¿™ä¹å™¨ä¸­æœ‰çŒ«è…»å—ï¼Ÿâ€</p>
<p>æš´èµ°ä¸‹èˆå°ï¼Œå°†ä¸‹ä¸ªå‡†å¤‡ç™»åœºå­¦å‘˜æ‰‹ä¸­çš„ç¬›å­ä¸€æŠŠå¤ºè¿‡æ¥ï¼Œååœ¨èˆå°è¾¹èƒŒå¯¹ç€è¯„å§”ï¼Œç‹¬è‡ªå¹äº†èµ·æ¥ã€‚è¿™æ›²å­åƒæ˜¯ç”¨åƒå™¨å’Œå—¤å¹å‡ºï¼Œç”±äºè¿™ä¸¤ç§ä¹å™¨çš„éŸ³å¾‹è¯„å§”ä»¬ä»¥å‰å¾ˆå°‘å¬åˆ°ï¼Œä¿—è¯è¯´éŸ³ä¹æ•ˆæœä¸‰åˆ†åœ¨æ›²ï¼Œä¸ƒåˆ†åœ¨éŸ³ã€‚ç”±äºå¤§å®¶å¯¹ç¬›å­å£°éå¸¸ç†Ÿæ‚‰ï¼Œæ‰€ä»¥æ›²å­çš„ç²¾å¦™ä¹‹å¤„ç”¨ç¬›å£°å®Œå…¨å±•éœ²å‡ºæ¥ï¼Œä¼—è¯„å§”è¿™æ‰æ„è¯†åˆ°æ–¹æ‰æ‰€å¬åƒå™¨å’Œå—¤ä¹‹éŸ³ä¼˜ç¾å¹¶ä¸æ˜¯é‚£åƒå™¨å’Œå—¤æœ‰ä»€ä¹ˆå¥‡å¦™ï¼Œè€Œæ˜¯æ¼”å¥è€…æŠ€è‰ºé«˜è¶…ã€‚äºæ˜¯å¯¹æš´æ›´åŠ ä½©æœèµ·æ¥ã€‚</p>
<p>åŸæ¥æš´ä»å°å°±ä¼šå¹å¥ç¬›å­ç±»ä¸»æµä¹å™¨ï¼Œåªæ˜¯æœ€è¿‘å‡ å¹´ï¼Œä¸ºé‡‡é›†å¤šæ ·éŸ³è‰²ï¼Œå¼€å§‹ç ”ç©¶èµ·æ”¹é€ å¤ä¹å™¨æ¥ã€‚è™½ç„¶å¥½ä¹…æ²¡æœ‰ä½¿ç”¨ç¬›å­äº†ï¼Œè¿™ä¸‹å¹èµ·ç¬›å­æ¥ä»ç„¶å¨´ç†Ÿä¸å‡å½“å¹´ã€‚</p>
<p>å¤©è‰²æ¸é»‘ï¼Œæ’åœ¨å¥¹åé¢ç­‰å¾…ç«èµ›çš„å­¦å‘˜è§‰å¾—æš´æ‰€å¥æ›²å­å¼ºäºè‡ªå·±å¤ªå¤šï¼Œæ¸æ¸åœ°å·®ä¸å¤šéƒ½è‡ªå·±ç¦»å¼€äº†ã€‚å¤§å¤šæ•°å­¦å‘˜ç”±äºå¾ªè§„è¹ˆçŸ©ï¼Œåœ¨æ›²é£æŠŠæ¡ä¸Šæ²¡æœ‰çªç ´ï¼Œä¸€å¹´èƒ½è°±å››äº”æ®µæ–°æ›²å·²ç®—è¾ƒå¤šï¼Œä½†å¦‚æœè¿½ç©¶è¿™äº›æ–°æ›²çš„æ¥æºï¼Œæ€»æ˜¯èƒ½å¤Ÿæ‰¾åˆ°ç›¸å¯¹åº”çš„æ›²è°±æ¥ã€‚æš´æ‰€è°±æ›²æ®µå´é£æ ¼ä¼—å¤šï¼Œè™½æ˜¾ç¹æ‚å´ä¸å¤±èŠ‚å¥ï¼Œå°½æ˜¾æ–°æ„ï¼Œéšå¿ƒæ‰€æ¬²ï¼ŒæœçœŸæ˜¯ä¿¡æ‰‹æ²¾æ¥ï¼Œçš†æˆæ–°æ›²ã€‚</p>
<p>æœ€ååœ¨åœºçš„åªå‰©ä¸‹å‡ åå¯¹ä½œæ›²ç—´è¿·çš„å­¦å‘˜ã€‚è¯„å§”ä¸€ä¸ªéƒ½æ²¡æœ‰ç¦»å¼€ï¼Œè°éƒ½ä¸æ„¿æ„ä¸¢æ‰è¿™æ ·ä¸€ä¸ªèƒ½å¤Ÿå°†ã€Šæ¸…å¿ƒå®é™ã€‹æ¬£èµå®Œçš„æœºä¼šã€‚æ¬¡æ—¥æ—©ä¸Šï¼Œä¹Ÿä¸çŸ¥é“æš´æ¼”å¥åˆ°ç¬¬å¤šå°‘æ®µäº†ï¼Œæ€»ä¹‹æ²¡æœ‰ä¸€æ®µæ˜¯é‡å¤çš„ï¼Œæ®µä¸æ®µä¹‹é—´è¡”æ¥å¤„ç†å¾—å¤©è¡£æ— ç¼ï¼Œæ¯å½“ä»ä¸€æ®µä¸çŸ¥ä¸è§‰åˆ‡æ¢åˆ°å¦ä¸€æ®µæ—¶ï¼Œä¼—è¯„å§”æ— ä¸â€œå•Šâ€çš„ä¸€å£°æç„¶å¤§æ‚Ÿï¼Œéšå³é¼“æŒè¡¨ç¤ºè‡ªå·±çš„é’¦ä½©ä¹‹æƒ…ã€‚æš´å¹å¾—æœ‰äº›å€¦äº†ï¼Œæœ›ä¸€çœ¼è¿œæ–¹åˆšå‡èµ·çš„çº¢å½¤å½¤çš„å¤ªé˜³ï¼Œä¼¸äº†ä¸€ä¸ªæ‡’è…°ï¼Œä¸¢ä¸‹è¿˜æ²‰é†‰åœ¨éŸ³ä¹ä¸­çš„è¯„å§”ä»¬ï¼Œæ‹›å‘¼æ²¡æ‰“ä¸€å£°å°±ç¦»å¼€äº†ã€‚</p>
<p>è¿™ä¸€æ™šé£é€¸ä¹Ÿä¸€ç›´å‘†ç€é‚£é‡Œï¼Œè™½ç„¶å¥¹ä¸æ˜¯è¯„å§”ï¼Œä¹Ÿä¸æ˜¯å¾ˆç²¾é€šä¹ç†ï¼Œä½†æ˜¯ä»é‚£äº›ä¸“å®¶çš„è®®è®ºä¸­ï¼Œå¥¹å·²ç»æ„Ÿåˆ°æš´çš„äº†ä¸èµ·ï¼Œå¯¹å¥¹äº§ç”Ÿäº†å¥½æ„Ÿã€‚åå¾—çŸ¥æš´å°†åˆ†é…åˆ°è‡ªå·±æ‰‹ä¸‹ï¼Œå¿ƒä¸­æ›´æ˜¯æ¬£æ‚¦æ— æ¯”ã€‚</p>
<h2 id="é›ªå¶å½’æ¥"><a href="#é›ªå¶å½’æ¥" class="headerlink" title="é›ªå¶å½’æ¥"></a>é›ªå¶å½’æ¥</h2><p>è¿™å¤©ï¼Œé›ªå¶æ›¾ç»å‘†ä½äº†ä¸€å¹´ã€å—å°½è‹¦éš¾çš„æˆ¿å±‹é—¨çªç„¶æ‰“å¼€äº†ï¼Œè¸æ­¥èµ°è¿›ä¸€ä¸ªäººæ¥ã€‚æ­¤æ—¶æˆ¿é—´é‡Œå·²å †ç§¯äº†åšåšçš„ä¸€å±‚ç°ï¼Œæˆ¿è§’ä¸Šå¸ƒæ»¡äº†èœ˜è››ç½‘ï¼Œç ´çƒ‚çš„è¢«è¤¥è¿˜æ¨ªä¸ƒç«–å…«åœ°æ‘Šåœ¨åºŠä¸Šï¼Œè¢«è¤¥ä¸Šé¢ä¹Ÿå·²ç»è’™ä¸Šåšåšä¸€å±‚ç°ã€‚æ˜¾ç„¶ä¸¤å¹´æ¥è¿™é‡Œæ²¡æœ‰äººæ¥è¿‡ã€‚æ¥äººè¡£è¡«æ´å‡€ï¼Œè„šç©¿ä¸€åŒç²‰çº¢è‰²é•¿ç­’é´ã€‚è¿™äººèµ°åˆ°åºŠè¾¹é‚£é¢é•œå­æ—ï¼Œç”¨æ‰‹æŠ“ä½è¢–å£ï¼Œæ…¢æ…¢æ‹­å»é•œä¸Šçš„ç°å°˜ï¼Œä¸€å¼ å¦–å¨†å¨‡åªšï¼Œä¼¼ç‰ç”Ÿé¦™çš„è„¸åºæ¸æ˜¾å‡ºæ¥ã€‚è¿™æ—¶ï¼Œå¥¹åŒçœ¼æµå‡ºæ³ªæ°´ï¼Œé•œå°æ¸æ¸çš„è¢«æ³ªæ°´ç»™æ´—å¹²å‡€äº†ã€‚è¿™æ—¶ï¼Œå¥¹å¥½è±¡çœ‹åˆ°é•œä¸­æµ®ç°å‡ºä¸€ä¸ªå¤´å‘æ•£ä¹±ï¼Œæ¯çš®ç˜¦è„¸ï¼Œè¡£è¡«è¤´è¤›ï¼Œå´åŒè‡ªå·±ä¸€èˆ¬æ³ªæµæ»¡é¢çš„è‹¦å¥³å­ã€‚</p>
<p>è¿™äººååœ¨åºŠå¤´çœ‹ç€æ•å¼€çš„é—¨å‘»åŸé“ï¼šâ€œç±³ç”Ÿï¼Œæˆ‘è¿˜åœ¨è¿™é‡Œç­‰ä½ å•Šï¼æˆ‘ä¸€ç›´æƒ³å¿µç€ä½ ï¼Œä½ çŸ¥é“å—ï¼Ÿæˆ‘ä¸€å®šè¦ç­‰ä½ å›æ¥ï¼â€</p>
<p>è¿™äººä¸€ç›´ååœ¨é‚£ï¼Œä¹…ä¹…æ²¡æœ‰èµ·èº«ã€‚</p>
<p>å¥¹å°±æ˜¯é›ªå¶ï¼Œå¦‚ä»Šå¥¹å·²åœ¨æ˜æœå­¦åºœçš„å¦å¤–ä¸€ä¸ªå«åšæ–‘å›½ç­çš„ç­ä¸Šå–å¾—äº†ä¸€çº§æˆå‘˜èº«ä»½ï¼Œç°åœ¨åŠç†äº†è½¬ç­æ‰‹ç»­ï¼Œä»Šå¤©å›åˆ°äº†ç™½é¾™ç­ï¼Œä¾æ—§åœ¨é£é€¸è€å¸ˆæ‰‹ä¸‹åšå­¦ç”Ÿã€‚å½“é£é€¸çœ‹åˆ°è½¬ç­ç”Ÿçš„åå­—å«é›ªå¶çš„æ—¶å€™ï¼Œæ›¾ç»å¤§åƒä¸€æƒŠï¼Œä¸€åº¦æ¨è¾ä¸æ„¿æ¥çº³ã€‚ä½†ç”±äºå…¶ä»–è€å¸ˆæ²¡äººæ„¿æ„æ¥çº³è¿™ä¸ªä¼ å¥‡å¼çš„å­¦ç”Ÿï¼Œå› ä¸ºé›ªå¶æ›¾æ˜¯è‡ªå·±çš„å­¦ç”Ÿè€Œç»ˆäºä¸å¾—å·²å°†å¥¹æ¥çº³ä¸‹æ¥ã€‚</p>
<p>è¿™æ—¶çš„é›ªå¶ï¼Œæ— è®ºæ˜¯è¡£ç€è¿˜æ˜¯è¨€è°ˆä¸¾æ­¢å·²ä¸å¾€æ—¥å¤§ä¸ç›¸åŒï¼Œä¸¤å¹´çš„å˜åŒ–ç€å®è®©ä»¥å‰æ‰€æœ‰è®¤è¯†é›ªå¶çš„äººåƒäº†ä¸€æƒŠã€‚é›ªå¶ä¸€å›åˆ°ç™½é¾™ç­ï¼Œå°±åˆ°ç±³ç”Ÿä½å¤„å»æ‰¾ç±³ç”Ÿï¼Œé•¿å·è´ç­‰äººå‘Šè¯‰é›ªå¶ï¼Œç±³ç”Ÿå¤–å‡ºå»ç»™ç™½é¾™ç­åŠäº‹æƒ…å»äº†ï¼Œä»€ä¹ˆæ—¶å€™å›æ¥ä»–ä¹Ÿè¯´ä¸å‡†ã€‚é›ªå¶ç™½å¤©åœ¨ç™½é¾™ç­é‡Œå­¦ä¹ ï¼Œå¤œæ™šå°±å›åˆ°å±±ä¸‹é‚£é—´å°å±‹ä¸­å»ç­‰ç±³ç”Ÿã€‚</p>
<p>é£é€¸çœ‹é›ªå¶æ¯å¤©æ™šä¸Šæ€»æ˜¯ç‹¬è‡ªç¦»å¼€ç™½é¾™ç­ï¼Œå»ä½å±±ä¸‹ã€‚ä¸€å¤©ï¼Œå¥¹è·Ÿè¸ªé›ªå¶æ¥åˆ°ç™½é¾™å±±ä¸‹ã€‚é›ªå¶æ›¾ç»ä½è¿‡çš„è¿™é—´æˆ¿å±‹ä¸é•‡ä¸Šå…¶å®ƒæˆ¿å­ç›¸è·å¾ˆè¿œï¼Œå¤„åœ¨é¦™å·äº•é•‡çš„è¾¹ç¼˜åœ°å¸¦ã€‚åœ¨è¿™ç§‹å°½å†¬æ¥çš„å­£èŠ‚é‡Œï¼Œè¿™é—´ç ´æ—§çš„æˆ¿å±‹å‘¨å›´çš„æ ‘æœ¨å¶å­å·²å°½è„±è½ï¼Œé—¨å‰é‚£æ¡æ˜¥å¤æ½ºæ½ºæµæ·Œç€çš„å°æºªæ—©å·²æ¯ç«­ã€‚é£é€¸çœ‹ç€é›ªå¶å¼€é—¨èµ°è¿›é‚£é—´å°å±‹ï¼Œå¥¹ä¾¿æ‚„æ‚„çš„èº²åœ¨å¤–è¾¹å¬é‡Œé¢çš„åŠ¨é™ã€‚</p>
<p>å¤œé‡Œå››å¤„ä¸€ç‰‡æ¼†é»‘ï¼Œå¯’é£é£•é£•åˆ®ç€ï¼Œæ¯æå‘å‡ºå”°å”°å”°çš„å“å£°â€¦â€¦å¿½ç„¶ï¼Œå±‹ä¸­ä¼ æ¥å‡„å‡‰çš„å“­å£°ï¼Œè¿™å“­å£°æ’•å¿ƒè£‚è‚ºï¼Œå¬ç€å«äººä¸å¯’è€Œæ —ã€‚</p>
<p>å°±è¿™æ ·é£é€¸ä¸€è¿è·Ÿè¸ªäº†é›ªå¶åŠä¸ªå¤šæœˆï¼Œå‘è§‰é›ªå¶é™¤äº†æ¯æ™šå»ç™½é¾™å±±ä¸‹çš„å°å±‹å¤–ï¼Œæ²¡æœ‰ä»»ä½•å¼‚çŠ¶ï¼Œä¹Ÿæ²¡æœ‰å’Œå…¶ä»–å¤–æ¥ç­çº§äººå‘˜è”ç»œï¼Œæ–¹æ‰æ”¾ä¸‹å¿ƒæ¥ã€‚</p>
<h2 id="ç™½ç¾½å·"><a href="#ç™½ç¾½å·" class="headerlink" title="ç™½ç¾½å·"></a>ç™½ç¾½å·</h2><p>é£é€¸é—¨ä¸‹é™¤äº†é›ªå¶å¤–ï¼Œå…¶ä»–åä¸ªä¸€ã€äºŒçº§æˆå‘˜éƒ½å­¦ä¹ å’Œç”Ÿæ´»åœ¨å¥¹ç”¨å°½æ¯•ç”Ÿå¿ƒè¡€ç ”åˆ¶çš„ä¸€è‰˜å«åšâ€œç™½ç¾½å·â€çš„å·¨å‹å¤ªç©ºé£èˆ¹ä¸Šï¼Œè¿™æ¶å¤ªç©ºé£èˆ¹æ”¾ç½®åœ¨ç™½é¾™ç­äº”å±‚ï¼Œæ­¤å±‚æ˜¯ç™½é¾™ç­ä¸“é—¨ç”¨æ¥å»ºé€ å’Œå­˜æ”¾å¤§å‹é£èˆ¹çš„å…µå·¥å‚åŸºåœ°ã€‚</p>
<p>æ˜æœå­¦åºœä¸€çº§æˆå‘˜è¦æˆä¸ºäºŒçº§æˆå‘˜ä¹Ÿéœ€è¦é€šè¿‡ç«èµ›ï¼Œä½†æ˜¯è¿™ä¸ªç«èµ›çš„èŒƒå›´æ‰©å±•åˆ°äº†æ•´ä¸ªæ˜æœå­¦åºœï¼Œæ¯ä¸€ä¸ªå­¦ç§‘çš„ç«èµ›è€…éƒ½æ¥è‡ªæ‰€æœ‰æ˜æœå­¦åºœå„ç­ã€‚å“ªå¹´å“ªä¸ªç­è¦æ˜¯èƒ½å¤Ÿæœ‰ä¸€ä¸ªäººæˆä¸ºäºŒçº§æˆå‘˜ï¼Œé‚£å°±æ˜¯ååˆ†äº†ä¸å¾—çš„äº‹æƒ…äº†ã€‚ç™½é¾™ç­ä»…é£é€¸è€å¸ˆä¸€äººæ‰‹ä¸‹å°±èƒ½å¤Ÿæœ‰ä¸¤ä¸ªäºŒçº§æˆå‘˜å®å±ä¸æ˜“ï¼Œå½“ç„¶è¿™ä¹Ÿå¾—äºé£é€¸åœ¨æ•´ä¸ªæ˜æœå­¦åºœä¸­æ˜¯ä¸€ä½ååˆ†æœ‰åçš„é£èˆ¹è®¾è®¡å¸ˆï¼Œé‚£ä¸¤ä¸ªäºŒçº§æˆå‘˜éƒ½æ˜¯åœ¨é£é€¸è€å¸ˆçš„æŒ‡å¯¼ä¸‹ï¼Œä¾é ç”µå­å­¦çŸ¥è¯†è®¾è®¡äº†æ–°çš„æœºå™¨äººï¼Œæ‰åœ¨ç«èµ›ä¸­å–èƒœè€Œæˆä¸ºäºŒçº§æˆå‘˜çš„ï¼Œè¿™è‡ªç„¶ä¹Ÿæˆäº†å¸å¼•å…¶ä»–ä¼˜ç§€å­¦ç”ŸæŠ•å…¥å¥¹é—¨ä¸‹çš„é‡è¦åŸå› ã€‚</p>
<p>é›ªå¶æ¯å¤©ç©¿æ¢­äºé£é€¸â€œç™½ç¾½å·â€å¤ªç©ºé£èˆ¹å’Œå°å±‹ä¹‹é—´ï¼Œæ…¢æ…¢ä½“ä¼šç€å½“å¹´ç±³ç”Ÿæ¥å›å¥”æ³¢çš„è¾›è‹¦ã€‚è¿™ä¸¤å¹´é‡Œå†¥æ˜Ÿè®®å‘˜çš„å¥³å„¿æœˆæ¹–å’Œæ•™ç±³ç”Ÿæ‹›å¼çš„å¾·æ–¯éƒ½é™†ç»­æˆä¸ºäº†ä¸€çº§æˆå‘˜ï¼Œå…¶ä»–çš„ä¸€çº§æˆå‘˜åˆ†åˆ«æ˜¯ä¸ªå­è¾ƒå°çš„ä¹å¤©æ´¾çˆ±ç¬‘å¥³æ˜“æ…§ï¼Œæ–¹è„¸é•¿é¬“è§’çš„å®‹è—é‡‘,å¹´é¾„åå¤§ä¸“æ”»å•æŒ‘ç«èµ›çš„åæˆ¿æ˜Ÿ,æœˆæ¹–çš„å¦¹å¦¹åŠæœˆ,çˆ±çƒ­é—¹çš„å°ä¾ƒå’Œå–œå¥½ä¹å™¨èˆè¹ˆçš„æš´ã€‚å¦å¤–ä¸¤ä¸ªäºŒçº§æˆå‘˜æ˜¯å¸¦çº¢å®çŸ³è€³ç¯ï¼Œèº«æé«˜æŒ‘ï¼ŒæŠšåªšçš„ç´®æƒ‘æµ®å’Œå¤´æˆ´é»‘è‰²é­”å¥³å‘å† ï¼Œèƒ¸å‰å¸¦çº¢å®çŸ³èƒ¸é’ˆï¼Œè¡¨æƒ…ä¸¥è‚ƒçš„å‡Œç©†ã€‚é›ªå¶å½“å¹´ä¸€èµ·å­¦ä¹ çš„é‚£äº›äººç”±äºéš¾ä»¥å–å¾—ä¸€çº§æˆå‘˜èº«ä»½è€Œé™†ç»­ç¦»å»ï¼ŒåŠ ä¹‹è¿™ä¸¤å¹´é›ªå¶ä¸€ç›´éƒ½æ²¡æœ‰éœ²é¢ï¼Œç™½é¾™ç­æå°‘æœ‰äººè®¤è¯†å¥¹ã€‚</p>
<p>åœ¨ç™½é¾™ç­é‡Œå­¦ä¹ ï¼Œä¸ç®¡çº§åˆ«é«˜ä½ï¼Œä¸Šåˆçš„è¯¾ç¨‹éƒ½æ˜¯åœ¨ä¸€èµ·å­¦ä¹ ï¼Œä¸‹åˆä¸€èˆ¬å„è‡ªç ”ä¹ å„è‡ªå­¦ç§‘é¡¹ç›®ã€‚é£é€¸é—¨ä¸‹å­¦ç”Ÿåœ¨â€œç™½ç¾½å·â€å»ºè®¾åˆæœŸå°±å¼€å§‹åœ¨å®ƒä¸Šé¢å­¦ä¹ ã€‚å†¥æ˜Ÿå…«å…­ä¹å…«å¹´åäºŒæœˆäºŒåä¸€æ—¥ï¼Œè¿™å¤©ï¼Œæ˜¯â€œç™½ç¾½å·â€å³»å·¥çš„æ—¥å­ï¼Œé£é€¸ä¸Šåˆåœ¨ä¼ æˆå®Œæ¨è¿›å™¨åŸç†åï¼Œå°†æ‰€æœ‰ä¸€çº§ä»¥ä¸Šæˆå‘˜å«åˆ°è‡ªå·±çš„æˆ¿é—´ã€‚é£é€¸çš„æˆ¿é—´åœ¨â€œç™½ç¾½å·â€å‰èº«éƒ¨ä½ï¼Œç¬¬äº”æ®µï¼Œå››åä¸‰åŒºï¼Œ301å·é—´ã€‚é£é€¸çš„æˆ¿é—´ä¸€å…±ä¸ƒç™¾å¤šå¹³æ–¹ç±³ï¼Œåˆ†ä¸ºä¸¤å±‚ï¼šç¬¬ä¸€å±‚æœ‰é¤å…ï¼Œå®¢å…å’Œå«ç”Ÿé—´ï¼›äºŒå±‚æ˜¯å®éªŒå®¤ï¼Œå¨±ä¹å®¤å’Œå§å®¤ã€‚é£é€¸æ‹›å‘¼ä»–ä»¬äº”äººååœ¨å®¢å…æ²™å‘ä¸Šï¼Œè‡ªå·±å»é¤å…åœ¨ç‚¹é¤æœºå™¨ä¸Šé€‰æ‹©äº†å‡ ä»½å¿«é¤ï¼Œå‡ åˆ†é’Ÿæ—¶é—´å¿«é¤ä¾¿é€šè¿‡ä¸“ç”¨ç®¡é“è¾“é€è¿‡æ¥ã€‚</p>
<p>é£é€¸å°†åƒçš„åˆ†å‘ç»™æ¯ä¸ªäººï¼Œè‡ªå·±æ‹¿äº†ä¸€ä»½ï¼Œåƒäº†ä¸€å£è¯´é“ï¼šâ€œæˆ‘ä»¬è¾¹åƒè¾¹è¯´ï¼Œä»¥åæˆ‘ä»¬æ¯å¤©ä¸‹åˆéƒ½è¦è¿™æ ·åœ¨è¿™é‡Œèšé¤ï¼Œä¸€èµ·è®¨è®ºç™½ç¾½å·çš„æ”¹è¿›å’Œç™½é¾™ç­çš„å‰é€”ã€‚â€</p>
<p>æ˜“æ…§è¯´ï¼šâ€œæˆ‘ä»¬è¿™äº›äººé‡Œè¿˜æ²¡æœ‰ä¼šåˆ¶é€ é£èˆ¹çš„äººï¼Œç´®æƒ‘æµ®å’Œå‡Œç©†ä¹Ÿåªæ˜¯å¯¹æœºå™¨äººåˆ¶ä½œç²¾é€šè€Œå·²ã€‚æˆ‘ä»¬æƒ³å¸®ä½ ä¹Ÿå¸®ä¸äº†å•Šã€‚â€</p>
<p>å°ä¾ƒæ¥ç€è¯´é“ï¼šâ€œæ˜¯å•Šï¼Œæˆ‘ä»¬ç°åœ¨è¿˜éœ€è¦å­¦ä¹ ï¼Œç°åœ¨é£èˆ¹æŠ€æœ¯å¯¹æˆ‘ä»¬æ¥è¯´è¿˜æ˜¯å¾ˆé™Œç”Ÿçš„ã€‚â€</p>
<p>å¾·æ–¯è¡¥å……é“ï¼šâ€œå¦‚æœè¯´é‚£äº›æ‰¹é‡ç”Ÿäº§çš„é£èˆ¹ï¼Œä¸ç”¨å¤šä¹…æˆ‘ä»¬å°±èƒ½å¤Ÿå­¦ä¼šæ“ä½œï¼ŒåŸç†çš„å­¦ä¹ ä¹Ÿç”¨ä¸äº†å¤šä¹…ã€‚ä½†æ˜¯è€å¸ˆè¿™é£èˆ¹è®¾è®¡å·§å¦™ï¼ŒåŠŸèƒ½ä¼—å¤šï¼Œä½“ç§¯å·¨å¤§å´ä»ç„¶èƒ½å¤Ÿçµæ´»è¿åŠ¨ç­‰ç­‰ï¼ŒçœŸæ˜¯éš¾ä»¥å­¦ä¼šæ“ä½œï¼Œæ›´ä¸ç”¨è¯´å¯¹å®ƒè¿›è¡Œæ”¹è¿›äº†ã€‚â€</p>
<p>åŠæœˆè¯´ï¼šâ€œéƒ½è¿™ä¹ˆé•¿æ—¶é—´äº†ï¼Œæˆ‘è¿˜æ²¡æœ‰èµ°éè¿‡è¿™â€œç™½ç¾½å·â€ï¼Œå®ƒçœŸçš„æ˜¯å¤ªå¤§äº†ã€‚â€</p>
<p>å°ä¾ƒè¯´ï¼šâ€œåˆ«çš„é‚£äº›æˆ‘ä»¬è¿˜ä¸äº†è§£çš„å…ˆåˆ«è¯´ï¼Œå…‰æ˜¯çœ‹çœ‹è€å¸ˆæˆ¿é—´çš„è¿™ä¸ªå®¢å…å°±çŸ¥é“è¿™é£èˆ¹çš„è®¾è®¡æœ‰å¤šç²¾å¦™äº†ã€‚å¢™é‚£è¾¹çš„é‚£ç›†å«ç¾è‰æ˜¯ä¸€ä¸ªéŸ³ä¹æ’­æ”¾å™¨ï¼Œè½»è½»è§¦ç¢°å®ƒçš„å¶ç‰‡å®ƒå°±ä¼šç«‹åˆ»ç´§é—­ä¸‹å‚ï¼Œåƒå®³ç¾å°‘å¥³ä¸€èˆ¬ï¼Œå«ç¾è‰çš„ç»†èƒæ˜¯ç”±ç»†å°å¦‚ç½‘çŠ¶çš„è›‹ç™½è´¨å³è‚¡åŠ¨è›‹ç™½æ‰€æ”¯æ’‘ã€‚äº§ç”Ÿé—­åˆè¿åŠ¨æ—¶ï¼Œè‚¡åŠ¨è›‹ç™½çš„ç£·é…¸ä¼šè„±è½ï¼Œå½“è‚¡åŠ¨è›‹ç™½æŸæ•£å¼€æ—¶ï¼Œç»†èƒè¢«ç ´åï¼Œç»“æœæ°´åˆ†è·‘å‡ºæ¥ï¼Œä»¥è‡´äº§ç”Ÿé—­åˆè¿åŠ¨ã€‚è¿™ç§è‚¡åŠ¨è›‹ç™½ä¸€èˆ¬å­˜åœ¨äºåŠ¨ç‰©çš„è‚Œè‚‰çº¤ç»´é‡Œï¼Œé£é€¸è€å¸ˆå°†è¿™ç§è‚¡åŠ¨è›‹ç™½æ™ºèƒ½åŒ–ï¼Œå¦‚åŒåŒ»ç”ŸæŠŠè„‰ä¸€èˆ¬ï¼Œä½¿ä¹‹èƒ½å¤Ÿå¾—åˆ°è§¦ç¢°è€…çš„å¿ƒæƒ…æ•°æ®ï¼Œæ ¹æ®è¿™å¿ƒæƒ…æ•°æ®æ’­æ”¾å‡ºè§¦ç¢°è€…æƒ³å¬çš„éŸ³ä¹ã€‚è¿˜æœ‰è¿™é£èˆ¹çš„å¢™å£ï¼Œåœ°æ¿å’Œå¤©èŠ±æ¿å…¨æ˜¯å…‰å£°æ„Ÿåº”å±ï¼Œåˆ«çœ‹ä¸Šé¢æ˜¾ç¤ºçš„æ˜¯å±±æ°´ã€ç€‘å¸ƒã€å°æºªã€æ ‘æ—çš„é£æ™¯ç”»ï¼Œé£é€¸è€å¸ˆå·¥ä½œæ—¶ï¼Œè¿™äº›æ„Ÿåº”å±å¹•å°±å˜æˆäº†ç³»ç»Ÿæ˜¾ç¤ºå™¨ã€‚å®ƒé€šè¿‡æ¥å—æ§åˆ¶å™¨å‘å‡ºçš„å…‰æ„Ÿä¿¡å·è¿›è¡Œæ“ä½œï¼Œåœ°é¢å¯é€‰åŒºåŸŸè¿›è¡Œå…¨æ¯å›¾åƒæ˜¾ç¤ºã€‚æ§åˆ¶å™¨ä½¿ç”¨çš„æ˜¯è¡¨é¢å£°æ³¢å¼è§¦æ‘¸å±ï¼Œä¹‹æ‰€ä»¥æ²¡æœ‰ç”¨å…¶å®ƒå¦‚ç”µé˜»å¼ï¼Œç”µå®¹æ„Ÿåº”å¼ï¼Œçº¢å¤–çº¿å¼è§¦æ‘¸å±ï¼Œæ˜¯å› ä¸ºè¡¨é¢å£°æ³¢è§¦æ‘¸å±å…·æœ‰æ¸…æ™°åº¦è¾ƒé«˜ï¼Œé€å…‰ç‡å¥½çš„ç‰¹ç‚¹ï¼Œè€ç”¨æ€§ï¼ŒæŠ—åˆ®ä¼¤æ€§è‰¯å¥½ã€‚ç”µé˜»å¼å’Œç”µå®¹æ„Ÿåº”å¼ç­‰è¡¨é¢æœ‰å±‚åº¦è†œï¼Œä½¿å¾—æ¸…æ™°åº¦å’Œçµæ•åº¦ç¨å·®ã€‚è¡¨é¢å£°æ³¢å¼è¾ƒå…¶å®ƒç±»å‹è§¦æ‘¸å±ç¼ºé™·åœ¨äºè¦ç»å¸¸å»å°˜ï¼Œç°å°˜ä¼šé˜»å¡è§¦æ‘¸å±è¡¨é¢çš„å¯¼æ³¢æ§½ï¼Œä½¿å£°æ³¢ä¸èƒ½æ­£å¸¸å‘å°„ï¼Œæˆ–ä½¿æ³¢å½¢æ”¹å˜å¯¼è‡´æ§åˆ¶å™¨æ— æ³•æ­£å¸¸è¯†åˆ«ï¼Œä½†æ˜¯è¿™ä¸ªç¼ºé™·åœ¨ç™½ç¾½å·é‡Œå®Œå…¨å¯ä»¥ä¸ç®¡ï¼Œå› ä¸ºç™½ç¾½å·å†…å¯¹ç©ºæ°”çš„å‡€åŒ–å·¥åºç›¸å¯¹äºå…¶å®ƒé‡äº§å’Œéé‡äº§é£èˆ¹æ¥è¯´æ˜¯æœ€å¥½çš„ï¼Œé‡Œé¢å‡ ä¹ä¸€å°˜ä¸æŸ“ã€‚â€</p>
<p>æ˜“æ…§è¯´ï¼šâ€œæˆ‘ä¹Ÿå–œæ¬¢è¡¨é¢å£°æ³¢å±ï¼Œç‰¹åˆ«æ˜¯å®ƒå°‘äº†é‚£å±‚åº¦è†œï¼Œæœ‰é‚£å±‚åº¦è†œä¼šä½¿å±å¹•æ¨¡ç³Šï¼Œå½±å“ä½¿ç”¨æ•ˆæœã€‚å°ä¾ƒä½ çŸ¥é“å®ƒçš„åŸç†å—ï¼Ÿæ”¹å¤©æˆ‘ä»¬ä¹Ÿå°†æˆ‘çš„é‚£ä¸ªç”µé˜»å¼è§¦æ‘¸å±æ§åˆ¶å™¨æ”¹é€ æˆå£°æ³¢å±çš„å§ï¼â€</p>
<p>å°ä¾ƒæ„£äº†ä¸€ä¸‹ï¼Œçœ‹çœ‹å‘¨å›´ï¼Œè§æ²¡äººç­”è¯ã€‚å¥¹è¿™æ—¶çœ‹è§é£é€¸è€å¸ˆåœ¨ä¸€æ—å¾®ç¬‘ç€åœ¨å¬å¥¹ä»¬å¯¹è¯ã€‚</p>
<p>å°ä¾ƒå°´å°¬åœ°è¯´ï¼šâ€œæˆ‘ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“è¿™åŸç†ï¼Œå…¶å®æˆ‘è¿é‚£äº›è€å¼çš„åŸç†éƒ½ä¸æ¸…æ¥šã€‚æˆ‘ä»¬ä¸€çº§æˆå‘˜æ€ä¹ˆå¯èƒ½çŸ¥é“è¿™äº›ï¼Œä½ è¦é—®å°±é—®ç´®æƒ‘æµ®æˆ–å‡Œç©†å¥½äº†ã€‚å¥¹ä»¬ä¿©éƒ½æ˜¯ä¸“æ”»ç”µå­å­¦ç§‘çš„ã€‚â€</p>
<p>æš´çªç„¶è¯´é“ï¼šâ€œè¿™ä¸ªç®€å•ï¼Œæˆ‘çŸ¥é“ï¼Œä¸ç”¨å»é—®å¥¹ä»¬ã€‚å£°æ³¢å±çš„ä¸‰ä¸ªè§’åˆ†åˆ«ç²˜è´´ç€ä¸œã€è¥¿ã€å—ã€åŒ—å››ä¸ªæ–¹å‘çš„å‘å°„å’Œæ¥æ”¶å£°æ³¢çš„æ¢èƒ½å™¨ï¼Œå››è¾¹åˆ»ç€åå°„è¡¨é¢è¶…å£°æ³¢çš„åå°„æ¡çº¹ã€‚å½“æ‰‹æŒ‡æˆ–è½¯æ€§ç‰©ä½“è§¦æ‘¸å±å¹•çš„æ—¶å€™ï¼Œéƒ¨åˆ†å£°æ³¢èƒ½é‡è¢«å¸æ”¶ï¼Œå˜ä¸ºæ¥æ”¶ä¿¡å·ï¼Œè¿™äº›ä¿¡å·ç»è¿‡æ§åˆ¶å™¨å¤„ç†åæˆä¸ºè§¦æ‘¸è€…æ‰€è¦çš„ä¸œã€è¥¿ã€å—ã€åŒ—åæ ‡ã€‚â€</p>
<p>æ˜“æ…§é—®é“ï¼šâ€œä»€ä¹ˆæ˜¯æ¢èƒ½å™¨ã€‚â€</p>
<p>æš´è¯´ï¼šâ€œæˆ‘çœŸå¥‡æ€ªä½ æ˜¯æ€ä¹ˆå‡ä¸Šä¸€çº§æˆå‘˜çš„ã€‚æ¢èƒ½å™¨æ˜¯ç”¨ç‰¹æ®Šé™¶ç“·ææ–™åˆ¶æˆçš„ï¼Œåˆ†ä¸ºå‘å°„æ¢èƒ½å™¨å’Œæ¥æ”¶æ¢èƒ½å™¨ã€‚å®ƒçš„åŠŸèƒ½æ˜¯æŠŠæ§åˆ¶å™¨é€šè¿‡è§¦æ‘¸å±ç”µç¼†é€æ¥çš„ç”µä¿¡å·è½¬åŒ–ä¸ºå£°æ³¢èƒ½å’Œç”±åå°„æ¡çº¹æ±‡èšæˆçš„è¡¨é¢å£°æ³¢èƒ½å˜ä¸ºç”µä¿¡å·ã€‚â€</p>
<p>é£é€¸åœ¨ä¸€æ—å¬ç€æš´é‚£æœ‰æ¡ä¸ç´Šçš„åŸç†è®²è§£ï¼Œå¿ƒä¸­æš—å–œã€‚</p>
<p>å¾·æ–¯å†·å˜²çƒ­è®½é“ï¼šâ€œæƒ³ä¸åˆ°ä½ ä»¬å¯¹è¿™äº›åé—¨çš„å°ç©æ„è¿™ä¹ˆæœ‰å…´è¶£ï¼ŒçŸ¥é“çš„ä¸œè¥¿ä¸å°‘å•Šï¼â€</p>
<p>å°ä¾ƒè¿™æ—¶æ‹¿èµ·èŒ¶å‡ å‰çš„æ§åˆ¶å™¨ï¼Œè¾“å…¥ä¸€ä¸²å¯†ç ã€‚å¢™å£ï¼Œåœ°æ¿å’Œå¤©èŠ±æ¿çš„é£æ™¯ç”»ç«‹åˆ»å˜ä¸ºç™½ç¾½å·å„ä¸ªéƒ¨ä½çš„ç»“æ„å›¾ï¼ŒèŒ¶å‡ å’Œä¸€äº›è£…é¥°ç”¨çš„æ¤ç‰©éƒ½è¢«ç§»åˆ°åœ°æ¿ä¸‹ä¸€å±‚éšè—èµ·æ¥ï¼Œæ²™å‘æ ¹æ®æ‰€åäººæ•°å°†å¤šä½™çš„éƒ¨åˆ†ä¹ŸåŸ‹è¿›ä¸‹å±‚ï¼Œå¤§å®¶å›´åæˆä¸€ä¸ªåœ†åœˆï¼Œä¸­é—´å‘ˆç°ä¸€ä¸ªå·¨å¤§çš„ç™½ç¾½å·å…¨æ¯å›¾ã€‚</p>
<p>å°ä¾ƒå¥‡æ€ªçš„è¯´é“ï¼šâ€œåŸæ¥è€å¸ˆæ—©å·²ç»ç»™æˆ‘ä»¬å‡†å¤‡å¥½äº†ã€‚â€</p>
<p>é£é€¸æ¥è¿‡å°ä¾ƒæ‰‹ä¸­çš„æ§åˆ¶å™¨ï¼Œè¿™æ§åˆ¶å™¨æœ‰åäºŒå¯¸å¤§å°ï¼Œæ•´ä¸ªæ§åˆ¶å™¨ä»…æ˜¯ä¸€å—å¯è§¦æ‘¸å±å¹•ï¼Œå¥¹éšæ‰‹åœ¨ä¸Šé¢ç‚¹äº†å‡ ä¸‹ï¼Œæ¯ä¸ªæ²™å‘è¢«åˆ†ä¸ºä¸Šä¸‹ä¸¤å—æ‹‰å¼€ï¼Œé‡Œé¢å‡ºæ¥ä¸€ä¸ªæ”¯æ¶ï¼Œéšåæ²™å‘åˆåˆå¹¶ä¸Šï¼Œæ¯ä¸ªæ”¯æ¶ä¸Šéƒ½æ¶ç€ä¸€ä¸ªå’Œé£é€¸æ‰‹ä¸­ä¸€æ ·çš„è§¦æ‘¸å±æ§åˆ¶å™¨ï¼Œå¯ä»¥éšæ„å–ä¸‹å®‰ä¸Šã€‚è§¦æ‘¸å±æ§åˆ¶å™¨æ—è¿˜é…æœ‰ä¸€å°å«ç¾è‰éŸ³ä¹æ’­æ”¾å™¨ã€‚</p>
<p>é£é€¸è¯´ï¼šâ€œç‚¹å‡»æ§åˆ¶å™¨å±å¹•å³ä¸‹è§’å›¾æ ‡ï¼Œå¯ä»¥é€‰æ‹©å°†æ²™å‘ç§»åŠ¨åˆ°ä¸åŒåŒºåŸŸï¼Œæˆ‘å·²ç»å®šåˆ¶å¥½ä¸ƒåå…«ä¸ªåŒºåŸŸï¼Œè¿™äº›åŒºåŸŸåˆ†åˆ«æ¨¡æ‹Ÿäº†ç™½ç¾½å·çš„å„ä¸ªéƒ¨ä½ï¼Œåœ¨è¿™ä¸ªæˆ¿é—´é‡Œå¯ä»¥å¯¹ç™½ç¾½å·è¿›è¡Œæ¨¡æ‹Ÿæ”¹è¿›ï¼Œä¸ƒåå…«ä¸ªåŒºåŸŸå‰éƒ½æœ‰ç›¸å¯¹åº”éƒ¨ä½çš„å…¨æ¯å›¾ï¼Œä¸­é—´æ˜¯æ•´ä¸ªç™½ç¾½å·è¿ä½œæ•ˆæœå…¨æ¯å›¾ã€‚ä½ ä»¬å¯ä»¥å…ˆè¯•è¯•çœ‹ã€‚â€</p>
<p>å°ä¾ƒä»–ä»¬éƒ½é€‰æ‹©äº†ï¼Œæ¥ç€æ²™å‘å¼€å§‹ç§»åŠ¨åˆ°å„ä¸ªåŒºåŸŸå»ï¼Œå¦‚æœå‡ ä¸ªäººé€‰æ‹©çš„åŒºåŸŸç›¸åŒï¼Œæ²™å‘ä¼šè‡ªåŠ¨æ’åˆ—å¥½ï¼Œå½“æ²™å‘ç§»åˆ°å¯¹åº”åŒºåŸŸæ—¶ï¼Œæ§åˆ¶å™¨ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°å¯¹åº”éƒ¨ä½çš„å¯ç¼–å†™ç³»ç»Ÿä¸­ï¼Œç¼–å†™ä»£ç ä¹Ÿæ˜¯ä½¿ç”¨è§¦æ‘¸æ–¹å¼ï¼Œäººä»¬å¯ä»¥éšæ—¶è°ƒç”¨æ“ä½œç³»ç»Ÿå±å¹•ä¸‹äº”åˆ†ä¹‹äºŒåŒºåŸŸä½œä¸ºä»£ç è¾“å…¥åŒºã€‚</p>
<p>é£é€¸çœ‹ä»–ä»¬å·²ç»å„å°±å„ä½ï¼Œè¯´é“ï¼šâ€œæˆ‘çŸ¥é“ä½ ä»¬å¯¹å¤ªç©ºé£èˆ¹ä¸å¤Ÿäº†è§£ï¼Œæ›´åˆ«è¯´æˆ‘ç ”åˆ¶çš„è¿™ä¸ªç™½ç¾½å·äº†ã€‚æˆ‘è™½ç„¶æ˜¯ä½ ä»¬çš„è€å¸ˆï¼Œä½†æ˜¯ä»çº§åˆ«ä¸Šæ¥è¯´æˆ‘è¿˜æ˜¯å’Œç´®æƒ‘æµ®ï¼Œå‡Œç©†ä¸€æ ·æ˜¯ä¸ªäºŒçº§æˆå‘˜ã€‚æŒ‰ç…§æ˜æœå­¦åºœçš„è§„å®šï¼Œè¦æˆä¸ºä¸‰çº§æˆå‘˜ï¼Œé¦–å…ˆè¦ç”³è¯·ä¸ºè€å¸ˆï¼Œé—¨ä¸‹å¿…é¡»æœ‰ä¸‰åå­¦ç”Ÿå‡çº§æˆä¸ºäºŒçº§æˆå‘˜ã€‚è¿˜æœ‰ä¸€ä¸ªæ¡ä»¶å°±æ˜¯åœ¨æŸä¸€ä¸“ä¸šé‡Œçš„æˆå°±è·å¾—å­¦åºœå†…é˜æ‰¿è®¤ï¼Œæœ€åæ–¹èƒ½å‡çº§æˆä¸ºä¸‰çº§æˆå‘˜ã€‚å¦‚ä»Šæˆ‘å·²æœ‰ç´®æƒ‘æµ®å’Œå‡Œç©†ä¸¤ä¸ªäºŒçº§æˆå‘˜ï¼ŒåŠ ä¸Šç™½ç¾½å·è¿™ä¸ªå·²ç»ç ”ç©¶æˆåŠŸçš„æˆæœï¼Œå°±å·®ä¸€ä¸ªäºŒçº§æˆå‘˜å­¦ç”Ÿå’Œç™½ç¾½å·çš„è¿›ä¸€æ­¥å®Œå–„äº†ï¼Œæˆ‘å‡çº§ä¸ºä¸‰çº§æˆå‘˜æŒ‡æ—¥å¯å¾…ã€‚æˆ‘å«ä½ ä»¬ä¸‹åˆåˆ°è¿™é‡Œæ¥å¸®åŠ©æˆ‘ä¹Ÿæ˜¯è¿™ä¸ªç¼˜æ•…ï¼Œæˆ‘è¦åœ¨è¿™ä¸€å¹´é‡Œä»ä½ ä»¬è¿™äº›ä¸€çº§æˆå‘˜ä¸­åŸ¹å…»å‡çº§ä¸€ä¸ªäºŒçº§æˆå‘˜ã€‚å…¶ä»–äººæˆ‘å°†æ•™ç»™ä½ ä»¬é£èˆ¹çš„ç›¸å…³çŸ¥è¯†ï¼Œä»¥ä¾¿å’Œæˆ‘ä¸€èµ·å®Œå–„ç™½ç¾½å·ï¼Œä½¿ç™½ç¾½å·èƒ½å¤Ÿå°½å¿«è·å¾—æ˜æœå­¦åºœå†…é˜çš„æ‰¿è®¤ã€‚â€</p>
<p>æ˜“æ…§ï¼Œå°ä¾ƒï¼Œæœˆæ¹–ï¼ŒåŠæœˆç­‰éƒ½ä¸ºé£é€¸æ„Ÿåˆ°é«˜å…´ï¼Œæƒ³åˆ°è‡ªå·±è€å¸ˆé©¬ä¸Šå°±èƒ½å¤Ÿæˆä¸ºä¸‰çº§æˆå‘˜ï¼Œæ— ä¸æ„Ÿåˆ°è„¸ä¸Šæœ‰å…‰ã€‚ç´®æƒ‘æµ®å’Œå‡Œç©†ä¹Ÿå› ç›®å‰è‡ªå·±æ— æ³•é€šè¿‡å­¦åºœå®¡æ ¸è€Œç‹¬ç«‹å¸ˆé—¨ï¼Œåªå¥½å†³å®šç»§ç»­è·Ÿé£é€¸å­¦ä¹ æ›´å¤šçš„å¤ªç©ºé£èˆ¹çŸ¥è¯†ã€‚</p>
<p>é›ªå¶å¿ƒæƒ³ï¼šâ€œç™½é¾™ç­å­¦ç”Ÿè‡ªç§å’ŒåŠ¿åˆ©ï¼ŒåŸæ¥éƒ½æ˜¯è‡ªè€å¸ˆå­¦æ¥ã€‚é£é€¸è€å¸ˆä¸ºäº†è‡ªå·±å°½æ—©å‡çº§ï¼Œä¸é¡¾ä»–äººå¦‚ä½•æƒ³æ³•ï¼Œå°±ä¸€èµ·å–Šæ¥å¸®å¿™ã€‚ä¸è¿‡çœ‹æ¥åŒå­¦ä»¬ä¹ŸæŒºå¼€å¿ƒä¼¼çš„ï¼Œæ¯•ç«Ÿé£é€¸è¿˜è¦ä»ä»–ä»¬ä¸­é—´åŸ¹å…»ä¸€ä¸ªäºŒçº§æˆå‘˜ï¼Œå¥¹ä¸€å®šä¼šå°†è‡ªå·±çš„çŸ¥è¯†å…¨éƒ¨ä¼ æˆå‡ºæ¥ã€‚ç°åœ¨æˆ‘ä»¬ä¸€å…±æœ‰ä¹åä¸€çº§æˆå‘˜ï¼Œé£é€¸ä¼šé‡ç‚¹åŸ¹å…»è°å‘¢ã€‚ä¸ç®¡å¥¹å¿ƒä¸­äººé€‰æ˜¯è°ï¼Œæˆ‘éƒ½è¦å…¨åŠ›äº‰å–ï¼Œæˆ‘è¦è®©ç±³ç”Ÿå›æ¥æ—¶çœ‹è§æˆ‘çš„çº§åˆ«é«˜é«˜çš„ï¼Œè€Œä¸æ˜¯ä»¥å‰é‚£ä¸ªå¯æ€œçš„é›ªå¶ï¼Œè®©ä»–ç¦»å¼€æœˆæ¹–ï¼Œè·Ÿæˆ‘è¿‡ä¸Šå¥½æ—¥å­ã€‚â€</p>
<p>é£é€¸çœ‹è§é›ªå¶ä¸€ä¸ªäººä½ç€å¤´åœ¨æƒ³ä»€ä¹ˆï¼Œå°±æ²¡æœ‰å»ç†ä¼šå¥¹ã€‚å¥¹åˆçœ‹äº†ä¸€çœ¼æš´ï¼Œç„¶åå¯¹å¤§å®¶è¯´é“ï¼šâ€œä½ ä»¬è‡ªå·±å…ˆåœ¨è¿™é‡Œçœ‹çœ‹ç™½ç¾½å·å†…éƒ¨ç»“æ„çš„èµ„æ–™ï¼Œæœ‰ä¸æ‡‚çš„é—®é¢˜åˆ°äºŒå±‚æ¥é—®æˆ‘ï¼Œæˆ‘åœ¨äºŒå±‚å®éªŒå®¤é‡Œä¸€ç›´å·¥ä½œåˆ°æ™šä¸Šåä¸€ç‚¹ï¼Œåªè¦æ˜¯é—®çš„æœ‰å…³ç™½ç¾½å·çš„é—®é¢˜æˆ‘éƒ½ä¼šå›ç­”ã€‚å¦‚æœä½ ä»¬å­¦ä¹ æ„Ÿåˆ°ç´¯äº†ï¼Œå¯ä»¥åˆ°äºŒå±‚å¨±ä¹å®¤é‡Œä¼‘æ¯ä¼‘æ¯ã€‚ä»¥åæ¯å¤©éƒ½è¿™æ ·å®‰æ’ã€‚â€</p>
<p>é£é€¸è¯´å®Œå°±èµ°å‘æš´ï¼Œè·Ÿæš´è¯´äº†å‡ å¥è¯åå°±ä¸Šæ¥¼å»äº†ã€‚é›ªå¶å°†è¿™ä¸€åˆ‡çœ‹åœ¨çœ¼é‡Œã€‚å¿ƒæƒ³ï¼šâ€œé£é€¸ä¸€å®šæœ‰æ„è¦åŸ¹å…»æš´ï¼Œæš´èµ„è´¨å¥‡å¥½ï¼Œå¯æ˜¯é£é€¸å¥¹è‚¯å®šä¹ŸçŸ¥é“æˆ‘åœ¨æ–‘å›½ç­å‡çº§ä¹Ÿåªç”¨äº†ä¸€å¹´æ—¶é—´ï¼Œè€Œä¸”å»å¹´æˆ‘åŒæ—¶å¾—åˆ°äº†å•æŒ‘ï¼Œç”µå­ï¼Œé­”æ³•ä¸‰ä¸ªå­¦ç§‘çš„ç¬¬ä¸€ï¼Œæˆ‘çš„æˆç»©å†³ä¸æ¯”æš´å·®ã€‚è‡ªæˆ‘å›æ¥åï¼Œé£é€¸æ€»æ˜¯é¿å¼€æˆ‘ï¼Œä¸çŸ¥æ˜¯ä½•ç¼˜æ•…ï¼Œè¿™æˆ‘å¾—å¥½å¥½é—®é—®ã€‚â€</p>
<h2 id="ç™½è‰³å…¬ä¸»"><a href="#ç™½è‰³å…¬ä¸»" class="headerlink" title="ç™½è‰³å…¬ä¸»"></a>ç™½è‰³å…¬ä¸»</h2><p>æ™šé¥­æ—¶åˆ†ï¼Œé›ªå¶æ­£æ‰“ç®—ç¦»å¼€é£èˆ¹å›åˆ°å±±ä¸‹å°å±‹å»ï¼Œå‘ç°æš´èµ·èº«å‘é£é€¸äºŒå±‚å·¥ä½œé—´èµ°å»ï¼Œé›ªå¶è·Ÿä¸Šæš´ï¼Œå°†å¥¹å«ä½ã€‚é—®é“ï¼šâ€œæ˜¯é£é€¸è€å¸ˆå«ä½ è¿™ä¸ªæ—¶å€™ä¸Šå»æ‰¾å¥¹çš„å—ï¼Ÿâ€</p>
<p>æš´æ„Ÿåˆ°å¥‡æ€ªï¼Œå¥¹è¯´ï¼šâ€œä½ æ€ä¹ˆçŸ¥é“çš„ã€‚â€</p>
<p>é›ªå¶ç¬‘äº†ç¬‘ï¼Œè¯´é“ï¼šâ€œæ²¡ä»€ä¹ˆï¼Œæˆ‘ä»¬ä¸€èµ·ä¸Šå»ã€‚â€</p>
<p>æš´ç‚¹äº†ç‚¹å¤´å’Œé›ªå¶ä¸€èµ·èµ°ä¸Šé£èˆ¹äºŒå±‚ã€‚é£èˆ¹çš„äºŒå±‚å’Œä¸€å±‚é¢ç§¯ä¸€èˆ¬å¤§å°ï¼Œä¸€ä¸Šæ¥å°±æ˜¯ä¸€ä¸ªå¨±ä¹å¤§å…ï¼Œå¤§å…ä¸œä¾§â€œé‡‘ç åŠâ€è®¾æœ‰å§å°ï¼Œè¥¿ä¾§â€œèµ¢ç åŠâ€è®¾æœ‰åå¤šå¼ èµŒå°å’ŒäºŒåå¤šå°è§’å­æœºã€‚åŒ—ä¾§â€œå¾¡åŒ¾æ‰€â€åœ°é¢ä¸ºç»¿è‰åœ°ï¼Œç¢çŸ³å­é“ºè·¯ï¼Œâ€œå¾¡åŒ¾æ‰€â€ä¸­å¤®æœ‰ç™½æœˆæ± ï¼Œæ± è¾¹å‡å±±ç¯ç»•ï¼Œæ± ä¸Šæœ‰ä¸€åº§æ‹±æ¡¥å«ç™½æœˆæ¡¥ï¼Œè¿‡æ¡¥æ± ä¸­é—´æœ‰ä¸€é£æªäº­ï¼Œäº­æ—æœ‰æ¾ï¼Œæœ‰æ¢…ï¼Œæœ‰ç«¹ã€‚è¿™é‡Œçš„ç«¹æ—æŒºæ‹”ç¿ ç»¿ï¼Œä¸”æˆä¸»ä½“ã€‚å› ç«¹è¡¨ä¼šå‹æ„ï¼Œæ•…æ­¤å¤„äº­å­åä¼šå‹äº­ã€‚é£é€¸æ¥åˆ°ä¼šå‹äº­æ˜¾ç„¶å·²æœ‰å¤šæ—¶ï¼Œå½“å¥¹çœ‹è§é›ªå¶å’Œæš´ä¸€åŒä¸Šæ¥æ—¶ï¼Œè„¸è‰²ä¸€æ²‰ï¼Œå¹äº†å£æ°”ã€‚</p>
<p>æš´å¿«æ­¥èµ°è¿‘é£é€¸ï¼Œè¯´é“ï¼šâ€œè€å¸ˆï¼Œä½ æ‰¾æˆ‘æœ‰äº‹å—ï¼Ÿâ€</p>
<p>é£é€¸çœ‹äº†ä¸€çœ¼æš´èº«è¾¹çš„é›ªå¶ï¼Œè¯´ï¼šâ€œæš´ï¼Œé›ªå¶ï¼Œä½ ä»¬ä¿©å’Œå…¶ä»–çš„ä¸€çº§æˆå‘˜ç›¸æ¯”å…·æœ‰å¾ˆå¤§ä¼˜åŠ¿ï¼Œä»ä½ ä»¬å‡çº§ç«èµ›æƒ…å†µçœ‹æ¥ï¼Œä½ ä»¬èƒ½åŠ›å¹¶æœªå®Œå…¨å‘æŒ¥å‡ºæ¥ã€‚é›ªå¶ï¼Œä½ æ“…é•¿çš„å­¦ç§‘è¾ƒå¤šï¼Œè™½ç„¶äºŒçº§æˆå‘˜ç«èµ›æ˜¯åœ¨æ•´ä¸ªå­¦åºœè¿›è¡Œï¼Œä½†ä½ æœºä¼šå´æ¯”å…¶ä»–å­¦ç”Ÿè¦å¤šï¼Œé‚£æ¬¡ä½ åœ¨æ–‘å›½ç­ä¸€è¿å–å¾—ä¸‰ä¸ªç¬¬ä¸€åï¼Œç€å®åœ¨ä»–ä»¬ç­é£å…‰äº†ä¸€å›ï¼Œæˆ‘ä¹Ÿè€³æœ‰æ‰€é—»ã€‚ä½ ä»¥å‰æ˜¯æˆ‘ä»¬ç­çš„ï¼Œæˆ‘æ‰“å¿ƒåº•ä¸ºä½ æ„Ÿåˆ°é«˜å…´ã€‚æš´ï¼Œæˆ‘æ€»çœ‹è§ä½ é©¾é©¶ç€ä¸€ä¸ªç™½è‰²æœºå™¨äººï¼Œæ˜¯å«â€˜ç™½è‰³å…¬ä¸»â€™å¯¹å§ã€‚é‚£ä¸ªæ˜¯ä½ åšçš„å—ï¼Ÿâ€</p>
<p>æš´ç‚¹äº†ç‚¹å¤´ã€‚</p>
<p>é£é€¸æ¥ç€å¯¹æš´è¯´ï¼šâ€œæˆ‘è¿˜ä»¥ä¸ºä½ ä¼šå‚åŠ ç”µå­ç«èµ›ï¼Œç»“æœä½ ä»…ä»…æŠ¥åå‚åŠ äº†ä½œæ›²ä¸€é—¨ç«èµ›ã€‚ä½ é‚£åœºä½œæ›²ç«èµ›æˆ‘çœ‹äº†ï¼Œç›¸å½“ç²¾å½©ï¼Œäººä»¬éƒ½å¬å¾—å…¥äº†ç¥ï¼Œå½“æ—¶äººä»¬æ„Ÿè§‰æ—¶é—´è¿‡å¾—å¾ˆå¿«ï¼Œè½¬çœ¼é—´ä¸€æ™šä¸Šå°±è¿‡å»äº†ã€‚â€</p>
<p>æš´è¯´ï¼šâ€œæˆ‘è¿™äººå¯¹ä½œæ›²æ„Ÿå…´è¶£ï¼Œå°±è§‰å¾—æ²¡å¿…è¦å‚åŠ é‚£ä¹ˆå¤šé—¨ç±»ç«èµ›äº†ã€‚â€</p>
<p>é£é€¸è¯´ï¼šâ€œéš¾å¾—ä½ è¿™ä¹ˆè‡ªä¿¡ï¼Œä½ æ¥ç™½é¾™ç­ä¹‹å‰å°±åˆ¶é€ äº†â€˜ç™½è‰³å…¬ä¸»â€™æœºå™¨äººï¼Œæ˜¯è°æ•™ä½ åšçš„ï¼Ÿâ€</p>
<p>æš´è¯´ï¼šâ€œæ˜¯æˆ‘æ¯äº²æ•™æˆ‘åšçš„ã€‚â€</p>
<p>é£é€¸å¾®å¾®ä¸€æƒŠï¼Œå¥¹è¯´ï¼šâ€œèƒ½é—®é—®ä½ æ¯äº²æ˜¯è°å—ï¼Ÿâ€</p>
<p>æš´è¯´é“ï¼šâ€œä½ é—®æˆ‘æ¯äº²å¹²å˜›ï¼Ÿâ€</p>
<p>é£é€¸ä¸€è„¸å°´å°¬ã€‚</p>
<p>æš´é©¬ä¸Šæ„Ÿè§‰åˆ°è¿™æ ·å›ç­”å¯¹è€å¸ˆæœ‰äº›ä¸æ•¬ï¼Œå°±æ”¹å£è¯´é“ï¼šâ€œæˆ‘æ¯äº²æ˜¯æ²™è¥¿å¾·æ˜Ÿå¾·æ¯”å­¦åºœçš„è€å¸ˆã€‚â€</p>
<p>é£é€¸è¯´ï¼šâ€œå“¦ï¼ŒåŸæ¥ä¸æ˜¯æ˜æœå­¦åºœçš„ï¼Œéš¾æ€ªã€‚æˆ‘å«ä½ æ¥å°±æ˜¯æƒ³å¤šäº†è§£äº†è§£ä½ ã€‚è¿˜æœ‰ï¼Œå»å¹´ä½ ä¸ºä»€ä¹ˆä¼šé€‰æ‹©æ¥ç™½é¾™ç­å‘¢ï¼Ÿâ€</p>
<p>æš´è¯´ï¼šâ€œæˆ‘åˆ°ç™½é¾™ç­æ¥åŸå› å¾ˆç®€å•ï¼Œå…¨éƒ½æ˜¯å› ä¸ºè¿™åœºå­¦åºœå¤§æˆ˜ã€‚ç”±äºçˆ†å‘æˆ˜äº‰ï¼Œæ¯äº²è¢«è¿«å‚æˆ˜ï¼Œç»“æœå‰å¹´åœ¨ä½ ä»¬ç™½é¾™ç­é¢†åŸŸæ­»å»ã€‚æˆ‘è‡ªå°æ˜¯æ¯äº²å¸¦å¤§ï¼Œæ¯äº²æ€§æ ¼å€”å¼ºï¼Œæ ‘æ•Œæ— æ•°ï¼Œæˆ‘éƒ½ä¸çŸ¥é“å¥¹æ˜¯æˆ˜æ­»æ²™åœºçš„è¿˜æ˜¯è¢«è‡ªå·±äººå®³æ­»çš„ã€‚æˆ‘å¦‚æœå›æ²™è¥¿å¾·æ˜Ÿï¼Œå®šæ˜¯å‡¶å¤šå‰å°‘ã€‚æˆ‘å¬è¯´å†¥æ˜Ÿæ”¿åºœä¸èƒ½æ§åˆ¶å„å­¦åºœé—´çˆ†å‘æˆ˜äº‰ï¼Œå„å­¦åºœé‡Œå„ä¸ªç­çº§ç«‹åœºä¹Ÿæœ‰ä¸åŒï¼Œç™½é¾™ç­å¤„äºä¸­ç«‹ï¼Œæˆ‘è‡ªç„¶å°±é€‰æ‹©äº†è¿›ç™½é¾™ç­ï¼Œä¸å…¶è¯´æ˜¯åŠ å…¥ç™½é¾™ç­æ¥å­¦ä¹ ï¼Œä¸å¦‚è¯´æ˜¯é€ƒéš¾æ¥äº†ã€‚â€</p>
<p>é£é€¸è¯´ï¼šâ€œè¯´èµ·è¿™åœºæˆ˜äº‰ï¼Œæˆ‘è™½æ˜¯å†¥æ˜Ÿäººï¼Œä½†ä¹Ÿä¸æ€ªä½ ä»¬æ²™è¥¿å¾·äººã€‚ä½ ä»¬æ˜Ÿçƒçš„äººæ°‘ä¹Ÿæ— æ³•æŒæ¡è‡ªå·±çš„å‘½è¿ï¼Œå…¨çƒå±…æ°‘å’Œå­¦åºœé‡Œçš„äººéƒ½è¦æœä»æ²™è¥¿å¾·å›½ç‹æ”¿æƒï¼Œå›½ç‹è¯´è¦æ‰“è°ä½ ä»¬å°±å¾—å»æ‰“è°ï¼Œæ”¿åºœå¯¹ä½ ä»¬è¿›è¡Œçš„æ˜¯æ´—è„‘å¼æ•™è‚²ï¼Œä»å°ç»™ä½ ä»¬çŒè¾“çš„æ˜¯æ•ˆå¿ å›½ç‹çš„æ€æƒ³ã€‚å†¥æ˜Ÿæ”¿åºœæ— æ³•æ§åˆ¶å­¦åºœï¼Œæ˜æœå­¦åºœé‡Œå„ä¸ªç­çº§éƒ½æ˜¯å„è‡ªä¸ºæ”¿ï¼Œå„è¾–ä¸€æ–¹ã€‚æˆ‘ä¸è®¤ä¸ºæˆ‘ä»¬å†¥æ˜Ÿæ¯”ä½ ä»¬æ²™è¥¿å¾·æ˜Ÿå¥½ã€‚ä½ çœ‹è¿™æ¬¡é—®é¢˜å°±æš´éœ²å‡ºæ¥äº†ï¼Œå†¥æ˜Ÿé‡åˆ°äº†å¤–æ•Œä¾µç•¥ï¼Œåä¾µç•¥å¾—ä¸åˆ°æ›´å¤šäººçš„æ”¯æŒï¼Œçˆ±å›½è€…è¢«äººç§°ä¸ºä¸çˆ±å’Œå¹³çš„äººï¼Œå†¥æ˜Ÿåœ¨å—åˆ°å¤–æ•Œä¾µç•¥çš„åŒæ—¶å‘ç”Ÿäº†å†…æˆ˜å±æœºã€‚â€</p>
<p>æš´è¯´ï¼šâ€œæ­¤è¯ä¸å‡ï¼Œå®¶å®¶éƒ½æœ‰æœ¬éš¾å¿µçš„ç»ã€‚æˆ‘æ¥ç™½é¾™ç­è¿™ä¸€å¹´é‡Œï¼Œå°±çœ‹åˆ°äº†ç”±äºç™½é¾™ç­å’Œæ²™è¥¿å¾·æ˜Ÿç­¾è®¢äº†ä¸æˆ˜æ¡çº¦ï¼Œç™½é¾™ç­å±¡é­æ˜æœå­¦åºœå…¶ä»–ç­çº§è¢­å‡»çš„è®¸å¤šäº‹æƒ…ã€‚â€</p>
<p>é£é€¸è¯´ï¼šâ€œç°åœ¨å†¥æ˜Ÿå°±åƒä¸€ç›˜æ•£æ²™ï¼Œæ­£è¢«æ²™è¥¿å¾·æ˜Ÿå’Œç‹±æ˜Ÿä¸€èµ·æ¬ºè´Ÿã€‚å¥½äº†ï¼Œæˆ‘è¯´è¿™äº›å’Œç™½é¾™ç­å®—æ—¨æ— å…³çš„è¯å¹²ä»€ä¹ˆï¼Ÿâ€</p>
<p>æš´è¯´ï¼šâ€œå¥½å§ï¼Œä½ çš„é—®è¯æˆ‘éƒ½å›ç­”äº†ï¼Œé‚£æˆ‘å…ˆèµ°äº†ã€‚â€</p>
<p>æš´è¯´å®Œä¾¿è½¬èº«æ¬²èµ°ï¼Œé£é€¸å¿™è¯´ï¼šâ€œç­‰ç­‰ã€‚â€</p>
<p>æš´åœä¸‹æ­£è¦ç§»åŠ¨çš„è„šæ­¥ï¼Œè½¬è¿‡åŠè¾¹èº«å­è¯´ï¼šâ€œè€å¸ˆè¿˜æœ‰ä»€ä¹ˆè¦é—®çš„å—ï¼Ÿâ€</p>
<p>é£é€¸çœ‹äº†çœ‹æš´å†·æ¼ çš„çœ¼ç¥ï¼Œåˆçœ‹äº†çœ‹é›ªå¶ï¼Œå¿ƒæƒ³ï¼šâ€œæš´å¹´é¾„è™½å°ï¼Œä½†ç”±äºå¥¹æ¯äº²ä»å°å°±æ•™ç»™äº†å¥¹è‘—åçš„å¾·æ¯”å­¦åºœé‡Œçš„ä¸Šä¹˜çŸ¥è¯†ï¼Œå¥¹è‡ªç„¶æ˜¯ä¸åœ¨ä¹å…¶ä»–çš„çŸ¥è¯†ã€‚å¦‚æœå¥¹ä¸ç”¨æ˜æœå­¦åºœé‡Œçš„æŠ€æœ¯å‡çº§ï¼Œåªæ€•å­¦åºœè¯„ä¼°æ—¶ä¸ä¼šå°†å¥¹ç®—åšæˆ‘çš„å­¦ç”Ÿã€‚é™¤äº†é›ªå¶å¤–ï¼Œå…¶ä»–é‚£äº›ä¸€çº§æˆå‘˜ç¦»äºŒçº§æˆå‘˜çš„å‡çº§æ¡ä»¶ç›¸å·®å¤ªè¿œã€‚æˆ‘å‡åˆ°ä¸‰çº§æˆå‘˜çš„å¸Œæœ›å°±åªèƒ½å¤Ÿå¯„æ‰˜åœ¨é›ªå¶ä¸€ä¸ªäººèº«ä¸Šäº†ï¼Œä½†é›ªå¶â€¦â€¦â€</p>
<p>é£é€¸å¯¹æš´è¯´ï¼šâ€œä½ ç°åœ¨æ²¡æœ‰äº†äº²äººï¼Œå·²ç»æ˜¯ç™½é¾™ç­çš„å­¦ç”Ÿï¼Œå°±æŠŠè¿™é‡Œå½“ä½œä½ çš„å®¶å§ï¼ä»¥åæœ‰ä»€ä¹ˆå›°éš¾ä½ ç›´æ¥è·Ÿæˆ‘è®²ï¼Œæˆ‘ä¼šå°†æˆ‘æ‰€æœ‰çš„çŸ¥è¯†æ•™ç»™ä½ ã€‚ä½ å…ˆå›å»å§ï¼Œæˆ‘è¿˜è¦è¯è¦è·Ÿé›ªå¶è¯´ã€‚â€</p>
<h2 id="ç±³ç”Ÿ"><a href="#ç±³ç”Ÿ" class="headerlink" title="ç±³ç”Ÿ"></a>ç±³ç”Ÿ</h2><p>æš´ç­”åº”ä¸€å£°å°±ä¸‹æ¥¼å»äº†ã€‚é£é€¸çœ‹æš´èµ°åï¼Œå¯¹é›ªå¶è¯´ï¼šâ€œè‡ªä½ å›ç™½é¾™ç­åï¼Œæˆ‘ä¸€ç›´éƒ½æœ‰é—®é¢˜æƒ³é—®ä½ ã€‚â€</p>
<p>é›ªå¶è¯´ï¼šâ€œå¦‚æœä»Šå¤©æˆ‘ä¸æ˜¯è‡ªå·±ä¸Šæ¥ï¼Œåªæ€•ä½ æ˜¯ä¸ä¼šé—®æˆ‘çš„äº†ã€‚â€</p>
<p>é£é€¸è¯´ï¼šâ€œä¸æ˜¯ã€‚æˆ‘åªæ˜¯å¹³æ—¶å¤ªå¿™ï¼Œä¸€ç›´æ²¡æœ‰æŠ½å‡ºæ—¶é—´æ¥ã€‚â€</p>
<p>é›ªå¶å¿ƒæƒ³ï¼šâ€œå“¼ï¼æˆ‘å›ç™½é¾™ç­åä½ å°±ä¸€ç›´å¯¹æˆ‘ä¸é—»ä¸é—®ï¼Œè¿˜å¤„å¤„èº²ç€æˆ‘ï¼Œä½ çŸ¥é“æˆ‘æ€»æ˜¯æ™šé¥­æ—¶åˆ†ç¦»å¼€ï¼Œå°±å«æš´è¿™ä¸ªæ—¶å€™ä¸Šæ¥ï¼Œåˆ†æ˜æ˜¯æ•…æ„ä¸è®©æˆ‘çŸ¥é“ã€‚çœŸæ˜¯è™šä¼ªï¼Œéš¾æ€ªç±³ç”Ÿä¸å–œæ¬¢ä½ ã€‚ä½ ä¸æƒ³æ•™æˆ‘ï¼Œæˆ‘å°±åä¸æœè¿™ä¸ªæ°”ï¼Œå°±æ˜¯å·å­¦æˆ‘ä¹Ÿè¦å°†ä½ çš„æœ¬äº‹å­¦åˆ°æ‰‹ã€‚â€</p>
<p>é›ªå¶æƒ³åˆ°è¿™é‡Œï¼Œä¾¿ç¬‘ç€è¯´é“ï¼šâ€œé£é€¸è€å¸ˆéš¾å¾—æœ‰ç©ºï¼Œç°åœ¨ä½ æƒ³é—®æˆ‘ä»€ä¹ˆå°±é—®å§ï¼â€</p>
<p>é£é€¸è¯´ï¼šâ€œä½ åœ¨æ–‘å›½ç­çš„æ—¥å­è¿‡å¾—è¿˜å¥½å§ï¼Ÿâ€</p>
<p>é›ªå¶è¯´ï¼šâ€œè°¢è°¢è€å¸ˆå…³å¿ƒï¼Œæˆ‘åœ¨æ–‘å›½ç­çš„æ—¥å­è¿‡å¾—å¾ˆå¥½ï¼Œé‚£é‡Œçš„è€å¸ˆå¯¹æˆ‘å¾ˆäº²åˆ‡ï¼Œè¯´å¥å®è¯ï¼Œæˆ‘è¿˜çœŸä¸æƒ³ç¦»å¼€é‚£é‡Œå‘¢ï¼â€</p>
<p>é£é€¸è¯´ï¼šâ€œé‚£ä½ ä¸ºä»€ä¹ˆåˆå›æ¥äº†å‘¢ï¼Ÿâ€</p>
<p>é›ªå¶è¯´ï¼šâ€œå½“ç„¶æ˜¯ä¸ºäº†å’Œç±³ç”Ÿåœ¨ä¸€èµ·äº†ï¼æˆ‘å¬é•¿å·è´è¯´ä»–å»ç»™ç™½é¾™ç­åŠäº‹å»äº†ï¼Œä½ çŸ¥é“ä»–ä»€ä¹ˆæ—¶å€™å›æ¥å—ï¼Ÿâ€</p>
<p>é£é€¸å¬åˆ°é›ªå¶ä¸ºç±³ç”Ÿè€Œå›ï¼Œä¸è‡ªè§‰åœ°åé€€äº†ä¸€æ­¥ï¼Œå…³ä¸Šå†’å‡ºæ±—æ¥ï¼Œç´§å¼ å¾—è„¸è‰²è‹ç™½ã€‚å¥¹ç»“ç»“å·´å·´åœ°è¯´ï¼šâ€œæˆ‘â€¦â€¦æˆ‘ä¸çŸ¥é“ï¼Œä½ è¿˜æƒ³è§ç±³ç”Ÿå¹²ä»€ä¹ˆï¼Œä»–å¯¹ä½ é‚£æ ·â€¦â€¦éš¾é“ä½ æ˜¯æ¥æ‰¾ä»–æŠ¥ä»‡çš„å—ï¼Ÿâ€</p>
<p>é›ªå¶ä¾ç„¶ç¬‘ç€å›ç­”è¯´ï¼šâ€œä½ ä»¬è¯¯è§£æˆ‘äº†ã€‚æˆ‘æ¥åªæ˜¯æƒ³å’Œç±³ç”Ÿé‡å½’äºå¥½ï¼Œå’Œä»–ä¸€èµ·è¿‡ä¸Šå¥½æ—¥å­ã€‚ç±³ç”Ÿè‡ªæ¥ç™½é¾™ç­åå°±ä¸€ç›´æ²¡æœ‰è¿‡è¿‡å¥½æ—¥å­ï¼Œä»–ä»¥å‰é‚£æ ·å¯¹æˆ‘æ˜¯ç¯å¢ƒæ‰€é€¼ï¼Œå¹¶éçœŸå¿ƒå–œæ¬¢ä»–äººã€‚ç°åœ¨æˆ‘å·²ç»æ˜¯ä¸ªä¸€çº§æˆå‘˜äº†ï¼Œæˆ‘ä»¬å°±ä¸ç”¨å†è¿‡è‹¦æ—¥å­äº†ã€‚è€Œä¸”æˆ‘è¿˜è¦ç»§ç»­å‡çº§ï¼Œå¸®ç±³ç”Ÿå®ç°ä»–çš„æ¢¦æƒ³ã€‚â€</p>
<p>é£é€¸çœ‹é›ªå¶ä¸€å­—ä¸€å¥è¯´å¾—è®¤çœŸï¼Œç¥æƒ…ä¹Ÿååˆ†çœŸè¯šï¼ŒçŸ¥é“å¥¹çš„è¯å‡å‡ºè‡ªçœŸå¿ƒï¼Œå°±è¯´é“ï¼šâ€œé‚£å¤©ä½ ç¦»å¼€ç™½é¾™ç­ï¼Œæœˆæ¹–æŠ¢è¿‡ç±³ç”Ÿæ‰‹ä¸­çš„ç”µå­è®°äº‹æœ¬ï¼ŒçŸ¥é“äº†ä¸€åˆ‡ã€‚å› ä¸ºä½ å·²ç»ä¸­äº†ç±³ç”Ÿä¸‹çš„æ¯’ï¼Œæˆ‘ä»¬è¿˜ä»¥ä¸ºä½ å·²ç»æ­»äº†ã€‚ç±³ç”Ÿä»–è¿™æ ·å¯¹ä½ ï¼Œä½ å°±ä¸æ¨ä»–å—ï¼Ÿâ€</p>
<p>é›ªå¶è¯´ï¼šâ€œæˆ‘ä»æ¥æ²¡æœ‰æ¨è¿‡ä»–ï¼Œè™½ç„¶å½“æ—¶æˆ‘å¾ˆéš¾è¿‡ï¼Œä½†åæ¥æƒ³æƒ³ä¹Ÿæ˜¯ï¼Œæˆ‘å½“æ—¶é‚£å‰¯æ¨¡æ ·è°ç§è§ä¼šå–œæ¬¢æˆ‘å‘¢ï¼Ÿæˆ‘ç°åœ¨æœ€å¤§çš„æ„¿æœ›å°±æ˜¯é©¬ä¸Šè§åˆ°ç±³ç”Ÿï¼Œè®©ä»–çŸ¥é“æˆ‘ä»¬åœ¨ä¸€èµ·ä»¥åä¼šå¾ˆå¹¸ç¦ã€‚â€</p>
<p>é£é€¸å¿ƒæƒ³ï¼šâ€œç±³ç”Ÿåªæ˜¯ä¸ªè§åˆ©å¿˜ä¹‰çš„å°äººï¼Œè€Œä¸”å¿ƒç‹ æ‰‹è¾£ï¼ŒçœŸæ˜¯å¯æ€œé›ªå¶äº†ã€‚å¦‚é›ªå¶è¯´çš„æ˜¯çœŸå¿ƒè¯ï¼Œé‚£ä¹ˆâ€¦â€¦â€</p>
<p>é£é€¸è¯´ï¼šâ€œä½ ç°åœ¨è¿™èº«ä»½ï¼Œåªæ€•ç±³ç”Ÿé«˜æ”€ä¸ä¸Šäº†ã€‚â€</p>
<p>é›ªå¶è¯´ï¼šâ€œç±³ç”Ÿå°±æ˜¯å†æ²¡æœ¬äº‹ï¼Œæˆ‘éƒ½ä¸ä¼šå«Œå¼ƒä»–ã€‚é£é€¸è€å¸ˆï¼Œä½ èƒ½å‘Šè¯‰æˆ‘ç±³ç”Ÿåˆ°åº•å»å“ªé‡Œäº†ï¼Œä»€ä¹ˆæ—¶å€™å›æ¥å—ï¼Ÿæˆ‘é—®äº†å…¶ä»–è€å¸ˆï¼Œä»–ä»¬éƒ½è¯´ä¸çŸ¥é“ï¼Œä»–æ˜¯ä½ çš„å­¦ç”Ÿï¼Œå¦‚æœä½ è¯´ä¸çŸ¥é“ï¼Œæˆ‘è¿˜èƒ½å¤Ÿå»é—®è°å‘¢ï¼Ÿâ€</p>
<p>é£é€¸è¯´ï¼šâ€œæˆ‘è¦æ˜¯çŸ¥é“ä¸€å®šä¼šå‘Šè¯‰ä½ çš„ã€‚ä½ é‚£æ¬¡ä¸­äº†ç±³ç”Ÿä¸‹çš„æ¯’æ˜¯æ€ä¹ˆå¥½çš„å‘¢ï¼Ÿâ€</p>
<p>é›ªå¶è¯´ï¼šâ€œé‚£å¤©ç±³ç”Ÿå›æ¥ä¸è®¤æˆ‘ï¼Œæˆ‘ä¸€ä¸ªäººæææƒšæƒšè·‘ä¸‹å±±åï¼Œè¢«é¦™å·äº•é•‡çš„äººæŠ“ä½ï¼Œä»–ä»¬å°†æˆ‘é£é€å›åå°”è¾ï¼Œé€”ä¸­ç”¨è¯ç»™æˆ‘è§£äº†æ¯’ã€‚æˆ‘è¿è§„ä½åœ¨æ˜æœå­¦åºœï¼Œå¦‚å›åˆ°åå°”è¾å¿…å®šè¦å—æƒ©ç½šï¼Œå¯èƒ½è¦åœ¨ç›‘ç‹±é‡Œå‘†ä¸Šåå‡ å¹´ç”šè‡³æ›´é•¿æ—¶é—´ã€‚é‚£æ—¶æˆ‘å”¯ä¸€æ‹…å¿ƒçš„æ˜¯è¿™æ¬¡å’Œç±³ç”Ÿä¸€åˆ«ï¼Œæ—¥åå†æ— æ³•ç›¸è§ã€‚äºæ˜¯è·¯ç»æ–‘å›½ç­é¢†åŸŸæ—¶ï¼Œæˆ‘å°±æ‹¼æ­»ä»é£èˆ¹ä¸Šè·³äº†ä¸‹å»ï¼Œä¾¥å¹¸è½åˆ°æ¹–æ°´ä¸­ï¼Œåè¢«æ–‘å›½ç­é‡Œçš„äººæ•‘èµ·ï¼Œæˆ‘æ‰æœ‰äº†ä»Šå¤©ã€‚â€</p>
<p>é›ªå¶è¯´åˆ°åé¢çš„é­é‡æ—¶è¡¨æƒ…å¼‚æ ·ï¼Œå®Œå…¨æ²¡æœ‰äº†è°ˆåŠç±³ç”Ÿæ—¶çš„é‚£è‚¡å…´å¥‹ï¼Œé£é€¸å¿ƒæƒ³ï¼šâ€œè¿™ä¸¤å¹´é‡Œï¼Œé›ªå¶å¥¹ä¸€å®šå—è¿‡å¾ˆå¤šå§”å±ˆï¼Œæ–¹æ‰å¥¹é‚£ç•ªè¯è™½è¯´æœªå¿…å±å®ã€‚ä½†æˆ‘ä¼°è®¡ï¼Œè¿™ä¸¤å¹´æ—¶é—´é‡Œæ”¯æ’‘å¥¹æ´»ä¸‹æ¥å¹¶æ‹¼å‘½åŠªåŠ›çš„å”¯ä¸€åŠ¨åŠ›å°±æ˜¯ç±³ç”Ÿäº†ã€‚â€</p>
<p>é£é€¸é¼“åŠ±å¥¹è¯´ï¼šâ€œä½ çš„æ½œåŠ›å¾ˆå¤§ï¼Œå½“å¹´å®Œå…¨æ²¡æœ‰å¿…è¦æŠŠæœºä¼šè®©ç»™ç±³ç”Ÿï¼Œå¦‚æœå½“å¹´æ˜¯ä½ ç•™åœ¨ç™½é¾™ç­ï¼Œè¯´ä¸å®šä½ ä»¬çš„ç”Ÿæ´»æ—©å°±è¿‡å¾—å¾ˆå¥½äº†ã€‚å¦‚ä»Šä½ å†åŠ æŠŠåŠ²ï¼Œè®©ç±³ç”Ÿå›æ¥çœ‹åˆ°ä½ çš„å¤§æœ‰ä½œä¸ºï¼Œä¸ºä»¥å‰è‡ªå·±çš„ç»æƒ…æ„Ÿåˆ°å†…ç–šå§ã€‚â€</p>
<p>é›ªå¶åˆå¼€å¿ƒèµ·æ¥ï¼Œè¯´ï¼šâ€œå¯¹ï¼Œè¦ä»–å†…ç–šä¸€ä¸‹ä¹Ÿå¥½ï¼Œæˆ‘è¦è®©ä»–çŸ¥é“è¦çæƒœæˆ‘ã€‚æ—¥åæˆ‘è¿˜éœ€è¦è€å¸ˆä½ å¤šå¤šçš„å¸®åŠ©å‘¢ï¼Œåªæœ‰è€å¸ˆä½ å¸®åŠ©æˆ‘ï¼Œæˆ‘æ‰èƒ½è¿›ä¸€æ­¥å‡çº§å•Šã€‚â€</p>
<p>é£é€¸è¯´ï¼šâ€œå’Œæˆ‘ä¸ç”¨è¿™æ ·å®¢æ°”ï¼Œä½ æ˜¯æˆ‘çš„å­¦ç”Ÿï¼Œæœ‰ä»€ä¹ˆä¸æ‡‚çš„ï¼Œé—®æˆ‘ä¾¿æ˜¯ã€‚â€</p>
<p>é›ªå¶è¯´ï¼šâ€œè¿™æ˜¯å½“ç„¶äº†ï¼Œæˆ‘åˆæ€ä¹ˆä¼šå’Œè€å¸ˆæ‚¨å®¢æ°”ï¼Œæˆ‘åªæ˜¯å¸Œæœ›è€å¸ˆå¤šå…³ç…§æˆ‘ä¸€ä¸‹ã€‚â€è¯´å®Œï¼Œé›ªå¶æŠ¬å¤´çœ‹äº†çœ‹å¤§é’Ÿï¼Œè¯´ï¼šâ€œè€å¸ˆï¼Œå¯¹ä¸èµ·ï¼æ—¶é—´ä¸æ—©äº†ï¼Œæˆ‘è¦ä¸‹å±±äº†ã€‚</p>
<p>é£é€¸è¯´ï¼šâ€œä½ ä¸ºä½•æ¯å¤©éƒ½è¦ä¸‹å±±ã€‚â€œç™½ç¾½å·â€é‡Œä½ä¸ä¹ æƒ¯å—ï¼Ÿâ€</p>
<p>é›ªå¶ç¬‘ç€è¯´ï¼šâ€œä¸æ˜¯ï¼Œæˆ‘å–œæ¬¢ä½åœ¨æˆ‘ä»¥å‰ä½è¿‡çš„é‚£ä¸ªå°å±‹é‡Œï¼Œåœ¨é‚£é‡Œæœ‰ç±³ç”Ÿå’Œæˆ‘ç”Ÿæ´»çš„è®¸å¤šè®°å¿†ã€‚å›å¿†è™½ç„¶è‹¦å¤šç”œå°‘ï¼Œä½†å´ä»¤æˆ‘éš¾ä»¥å¿˜æ€€ã€‚â€</p>
<p>é£é€¸è¯´ï¼šâ€œæˆ‘èƒ½å¤Ÿç†è§£ä½ çš„å¿ƒæƒ…ï¼Œæˆ‘ä¹Ÿæœ‰è¿‡ä½ è¿™æ ·çš„å¹´é¾„ï¼Œä¹Ÿæ›¾æœ‰è¿‡ç±»ä¼¼ä½ çš„æ„Ÿè§‰ã€‚ç­‰ä½ å†é•¿å¤§äº›ï¼Œè¿™äº›æ„Ÿæƒ…çš„äº‹å¯èƒ½å¯¹ä½ å°±ä¸å†é‚£ä¹ˆé‡è¦äº†ã€‚â€</p>
<p>é›ªå¶ç¬‘ç€æ‘‡äº†æ‘‡å¤´ï¼Œç¦»å¼€äº†ã€‚é£é€¸ç«™åœ¨åŸåœ°å¾ˆä¹…æ²¡åŠ¨ï¼Œå¿ƒä¸­å¾ˆæ˜¯æ„Ÿæ…¨ã€‚</p>
<h2 id="æ±‚çŸ¥"><a href="#æ±‚çŸ¥" class="headerlink" title="æ±‚çŸ¥"></a>æ±‚çŸ¥</h2><p>åæ¥çš„æ—¥å­é‡Œï¼Œä¸€çº§æˆå‘˜ä»¬æ¯æ—¥ä¸Šåˆå’Œå­¦å‘˜ä¸€èµ·å­¦ä¹ ï¼Œä¸‹åˆå°±åˆ°é£é€¸çš„æˆ¿é—´é‡Œè¿›è¡Œâ€œç™½ç¾½å·â€çš„ç ”ç©¶ã€‚é™¤äº†æš´ä»¥å¤–ï¼Œé£é€¸ç»™ä¸€çº§æˆå‘˜æ¯äººéƒ½åˆ¶å®šäº†å­¦ä¹ è®¡åˆ’ï¼Œè®¡åˆ’çš„èŒƒå›´ï¼Œå‡ ä¹éƒ½æ˜¯äº›æ“ä½œé£èˆ¹çš„æŠ€èƒ½ã€‚é›ªå¶æƒ³æ·±ç©¶å´å¾—ä¸åˆ°è¶³å¤Ÿçš„å¸®åŠ©ï¼Œå¥¹ä¸ŠäºŒå±‚æˆ¿é—´æ‰¾é£é€¸æ—¶ï¼Œé£é€¸æ€»æ˜¯å’Œæš´å•ç‹¬åœ¨ä¸€èµ·ã€‚å¯¹é›ªå¶æå‡ºçš„é—®é¢˜ï¼Œé£é€¸æ¯æ¬¡éƒ½åªæ˜¯ç®€å•å›ç­”äº†äº‹ã€‚é›ªå¶å¿ƒä¸­ååˆ†æ°”æ„¤ï¼Œå¯¹é£é€¸è€¿è€¿äºæ€€ã€‚</p>
<p>ä¸€æ¬¡ï¼Œé›ªå¶åœ¨ç™½æœˆæ¡¥ä¸Šç¢°åˆ°é£é€¸ï¼Œå¥¹æé—®è¯´ï¼šâ€œæˆ‘çœ‹èµ„æ–™ä¸­æåˆ°â€˜ç™½ç¾½å·â€™å·¦ä¾§è£…ç”²æ¿åœ¨ä½œæˆ˜æ—¶ä¼šæ³¨å…¥ä¸€ç§å«åšâ€˜çŒ›ç¦½â€™çš„ç‰©è´¨ï¼Œå¯¼è‡´å½¢çŠ¶å˜åŒ–ï¼Œç»“æ„å¼ºåº¦å¢å¤§ï¼Œå¹¶ä¸”ä¼šæ‹¥æœ‰è‡ªæˆ‘ä¿®å¤åŠŸèƒ½ï¼Œç‰¹åˆ«èƒ½å¤Ÿæœ‰æ•ˆçš„é˜²å¾¡é…å¤‡æ–©èˆ°åˆ€çš„æœºå™¨äººã€‚æ–‘å›½ç­å´æœ‰ä¸€ç§éé‡äº§æœºå™¨äººå«â€˜å­”é›€çº¢â€™ï¼Œç”±å°¤ç§‘æ–¯è€å¸ˆåˆ¶ä½œï¼Œè¿™ä¸ªæœºå™¨äººé…æœ‰ä¸€æŠŠæ–©èˆ°åˆ€ï¼Œæ¯”ä¹‹å…¶å®ƒåˆ€æ˜¾å¾—æ›´é•¿æ›´é”‹åˆ©ï¼Œåˆ€èº«ç”±é«˜å¯†åº¦çš„é‡é‡‘å±ç²’å­åˆ¶æˆï¼Œå¹³æ—¶å‹ç¼©æ”¾ç½®åœ¨â€˜å­”é›€çº¢â€™å·¦è‚©çš„æŠ¤ç”²ä¸Šã€‚å¯¹å¤§å‹æˆ˜èˆ°æœ‰ä¸€åˆ€ä¸¤æ–­çš„å¨åŠ›ï¼Œå®ƒä¸»è¦é’ˆå¯¹çš„å°±æ˜¯é‚£ç§æ‹¥æœ‰è‡ªæˆ‘ä¿®å¤åŠŸèƒ½çš„æˆ˜èˆ°ã€‚é£é€¸è€å¸ˆï¼Œä½ è¯´ï¼Œä½ çš„â€˜ç™½ç¾½å·â€™å’Œå°¤ç§‘æ–¯çš„â€˜å­”é›€çº¢â€™éƒ½è¯´è‡ªå·±æ˜¯å¯¹æ–¹çš„å…‹æ˜Ÿï¼Œä¸çŸ¥é“è¾ƒé‡èµ·æ¥è°æ¯”è°å‰å®³ã€‚ç°åœ¨ä½ ç»™æˆ‘ä»¬çœ‹çš„èµ„æ–™å…¨æ˜¯å°è£…å¥½çš„ï¼Œæˆ‘æƒ³æ·±ç©¶å´æ— ä»ä¸‹æ‰‹ã€‚æˆ‘çœ‹è¿™èµ„æ–™åªé€‚ç”¨äºå­¦ä¹ é©¾é©¶ã€‚â€</p>
<p>é£é€¸å€’ååˆ†é•‡å®šçš„è¯´ï¼šâ€œè¿™æœ¬æ¥å°±æ˜¯ä¸€ä¸ªå¾ªåºæ¸è¿›çš„è¿‡ç¨‹ï¼Œä¸å¯æ“ä¹‹è¿‡æ€¥ã€‚æˆ‘è¿™æ ·åšä¸è¿‡æ˜¯å¸Œæœ›ä½ ä»¬å…ˆèƒ½å¤Ÿç³»ç»Ÿçš„äº†è§£â€˜ç™½ç¾½å·â€™ã€‚â€</p>
<p>é›ªå¶æ°”æ„¤çš„è¯´ï¼šâ€œé‚£ä½ æ¯å¤©ç»™æš´è®²çš„ä¹Ÿéƒ½æ˜¯è¿™äº›çš®æ¯›çŸ¥è¯†å—ï¼Ÿâ€</p>
<p>é£é€¸çœ‹äº†çœ‹ä¸€æ—çš„æš´ï¼Œæš´æ­£ååœ¨äº­è¾¹æ¤…å­ä¸ŠæŠŠç©æŒä¸Šè§¦æ‘¸å±æ§åˆ¶å™¨ï¼Œå¯¹å¥¹ä»¬çš„è°ˆè¯å¹¶æ²¡åœ¨æ„ã€‚</p>
<p>äºæ˜¯é£é€¸è¯´ï¼šâ€œæš´å› ä»¥å‰æ‰€å­¦çš„ç”µå­å­¦å¹¶éæˆ‘ä»¬æ˜æœå­¦åºœé‡Œçš„ç”µå­å­¦çŸ¥è¯†ï¼Œæˆ‘æ‹…å¿ƒå¥¹ç«èµ›æ—¶ä¼šå› ä¸ºè¿™ä¸ªåŸå› è€Œæ— æ³•å‡çº§ï¼Œæ‰€ä»¥æˆ‘æŠŠæˆ‘ä»¬ç™½é¾™ç­çš„ç”µå­å­¦çŸ¥è¯†ä»åŸºç¡€å¼€å§‹å¯¹å¥¹ä¸ªåˆ«è¾…å¯¼ã€‚â€</p>
<p>é›ªå¶è¯´ï¼šâ€œä½ éª—æˆ‘ï¼Œç”µå­å­¦ç§‘çŸ¥è¯†æ˜æ˜å¯ä»¥ç›¸äº’é€šç”¨çš„ã€‚â€</p>
<p>æš´è¿™æ—¶ç«™èµ·èº«æ¥è¯´é“ï¼šâ€œæ˜æœå­¦åºœå’Œå¾·æ¯”å­¦åºœåœ¨ç”µå­å­¦æ–¹é¢æ•™çš„çŸ¥è¯†åŒºåˆ«å¾ˆå¤§ï¼Œä½†æ˜¯é£é€¸è€å¸ˆä¹Ÿå¹¶ä¸æ˜¯ä»å¤´æ•™æˆ‘ã€‚èä¼šè´¯é€šæˆ‘è¿˜æ˜¯ä¼šçš„ã€‚ä½ åˆšæ‰é—®çš„é—®é¢˜éœ€è¦æ¸…æ¥šçš„çŸ¥é“ï¼Œä¸¤ä¸ªæœºä½“æ‰€ç”¨æè´¨æ€§èƒ½å’Œå®ƒä»¬çš„èƒ½é‡äº§ç”ŸåŸç†ï¼Œè¿™æ‰èƒ½å¤Ÿé€šè¿‡è®¡ç®—å¾—å‡ºå“ªä¸ªæœºä½“å¯¹æ‹¼èµ·æ¥æ¯”è¾ƒå ä¼˜çš„ç»“è®ºã€‚ä¸€å±‚é‚£äº›ç™½ç¾½å·çš„èµ„æ–™ç¡®å®å¤ªè¿‡æµ…æ˜¾ï¼Œä½œä¸ºé©¾é©¶çš„å‚è€ƒè¿˜è¡Œï¼Œä½œä¸ºä¸€åä¼˜ç§€é©¾é©¶å‘˜æŒæ¡è¿™äº›çŸ¥è¯†è¿˜æ˜¯è¿œè¿œä¸å¤Ÿçš„ã€‚é©¾é©¶å‘˜é™¤äº†ç»éªŒå¤–ï¼Œäº†è§£å…¶é©¾é©¶æœºä½“çš„åŸç†å’Œæè´¨æ˜¯å¿…è¦çš„ã€‚æ¯”å¦‚è¯´ï¼Œæ•Œäººæ”»è¿‡æ¥ï¼Œæœºå¸ˆæ ¹æ®è‡ªèº«æœºä½“æƒ…å†µè¦åˆ¤å®šå®ˆè¿˜æ˜¯å›å‡»ã€‚è¿™æ—¶è°å¯¹è‡ªå·±é©¾é©¶çš„æœºä½“äº†è§£çš„å¤šè°çš„åˆ¤æ–­å°±ä¼šæ›´å‡†ç¡®ã€‚â€</p>
<p>é£é€¸å…ˆä»¥ä¸ºæš´æ˜¯å› ä¸ºè‡ªå·±ç»™å¥¹ä¼ æˆäº†ä¸Šä¹˜çŸ¥è¯†ï¼Œæ‰é‡‡ç”¨ä¸ç†ç¬çš„æ€åº¦æ¥å›é¿ã€‚æ²¡æƒ³åˆ°æš´ä¸ºäººè€¿ç›´ï¼Œä»æ¥éƒ½ä¸ç©è™šçš„ã€‚</p>
<p>é›ªå¶ç”Ÿæ°”åœ°å¯¹é£é€¸è¯´ï¼šâ€œä½ çœ‹ï¼Œæš´è¿™æ ·ä¸€ä¸ªå¤–æ˜Ÿå­¦ç”Ÿéƒ½è§‰å¾—ä½ ç»™æˆ‘ä»¬çš„èµ„æ–™å¤ªæµ…ã€‚â€</p>
<p>é£é€¸æ— è¯­ã€‚</p>
<p>æš´å¯¹é£é€¸è¯´ï¼šâ€œé›ªå¶æ—¢ç„¶è¿™ä¹ˆæƒ³ç ”ç©¶ä½ çš„â€˜ç™½ç¾½å·â€™ï¼Œä½ å°±æ•™å¥¹å§ã€‚ä¸ç”¨åœ¨æˆ‘èº«ä¸ŠèŠ±æ—¶é—´ï¼Œå‡ä¸å‡çº§å¯¹æˆ‘æ¥è¯´æ„ä¹‰ä¸å¤§ã€‚â€</p>
<p>é£é€¸è¯´ï¼šâ€œæˆ‘å½“ç„¶å¸Œæœ›ä½ ä»¬ä¿©éƒ½èƒ½å¤Ÿå‡çº§ã€‚ä½†æ˜¯åŒä¸€é—¨å­¦ç§‘ä¸€å¹´åªæœ‰ä¸€ä¸ªäººå¤ºå¾—å† å†›å‡çº§ã€‚â€</p>
<p>é›ªå¶è¯´ï¼šâ€œé‚£ä½ çš„æ„æ€å°±æ˜¯æš´æ¯”æˆ‘æ›´æœ‰èƒ½åŠ›å¤ºç¬¬ä¸€äº†ã€‚â€</p>
<p>æš´è¯´ï¼šâ€œè€å¸ˆå¦‚æœæ˜¯è¿™ä¸ªæ„æ€ï¼Œæˆ‘æ„¿æ„é€€å‡ºã€‚è€å¸ˆä¸ç”¨æ‹…å¿ƒæˆ‘ä¸èƒ½å‡çº§ï¼Œæˆ‘å¯ä»¥åœ¨ä½œæ›²å­¦ç§‘ä¸Šæ‹¼ä¸€æ‹¼ã€‚â€</p>
<p>é›ªå¶å¯¹æš´è¯´ï¼šâ€œä½ è¦æ˜¯é€€å‡ºï¼Œé£é€¸è€å¸ˆåªæ€•æ˜¯ä¸æ„¿æ„ï¼Œä½ è¦æ˜¯åœ¨å…¶å®ƒå­¦ç§‘ä¸Šå‡çº§äº†ï¼Œå¥¹å°±æ²¡æ³•å‡çº§äº†ï¼Œå­¦åºœæœºæ„è¯„ä¼°ä¼šå¾—å‡ºä½ ç«èµ›æ‰€ç”¨çŸ¥è¯†éé£é€¸æ‰€æ•™ã€‚é‚£æ ·é£é€¸é—¨ä¸‹è¿˜æ˜¯åªæœ‰ä¸¤ä¸ªäºŒçº§æˆå‘˜ã€‚â€</p>
<p>é›ªå¶è½¬è¿‡è„¸æ¥å¯¹é£é€¸è¯´ï¼šâ€œä½ å°±å¥½å¥‡æ€ªäº†ã€‚æ˜æ˜æš´ç”¨ä¸ç€ä½ æ•™ï¼Œä½ å´è¦å¦‚æ­¤æ­»ç¼ ç€å¥¹ï¼Œæˆ‘å¦‚æ­¤æ¸´æœ›è·å¾—ä½ çš„æ•™å¯¼ï¼Œä½ å´å¯¹æˆ‘ç½®ä¹‹ä¸ç†ã€‚è¿™åˆ°åº•æ˜¯ä»€ä¹ˆåŸå› ã€‚â€</p>
<p>é¡¿æ—¶ä¸€ç‰‡æ²‰å¯‚ã€‚è¿ç™½æœˆæ± ä¸­é‡‘é±¼æ¸¸åŠ¨æ—¶è¡èµ·çš„æ°´æ³¢å£°éƒ½èƒ½æ¸…æ™°å¬è§ã€‚é›ªå¶ä¸€è„¸å§”å±ˆï¼Œé£é€¸æ»¡é¢å°´å°¬ã€‚</p>
<p>æš´æ‰“ç ´è¿™æ²‰å¯‚è¯´é“ï¼šâ€œæˆ–è®¸é£é€¸è€å¸ˆæ˜¯æ€•ä½ å°†â€˜ç™½ç¾½å·â€™çš„ç§˜å¯†å‘Šè¯‰æ–‘å›½ç­å§ã€‚æˆ‘å¬è¯´æ–‘å›½ç­æ˜¯åä¾µç•¥æ´¾çš„ï¼Œä½ ä»é‚£é‡Œè½¬æ¥ï¼Œè€å¸ˆå¥¹å¯¹ä½ æœ‰äº›é˜²èŒƒä¹Ÿæ˜¯æƒ…æœ‰å¯åŸçš„å—ï¼â€</p>
<p>é›ªå¶å¯¹æš´è¯´ï¼šâ€œè¿™è¯ä¸èƒ½æˆç«‹ã€‚è¦æ˜¯è¿™æ ·çš„è¯ï¼Œä½ æ¥è‡ªæ²™è¥¿å¾·æ˜Ÿï¼Œè™½ç„¶æˆ‘ä»¬ç­å’Œä½ ä»¬æ²™è¥¿å¾·æ˜Ÿç­¾è®¢äº†ä¸æˆ˜æ¡çº¦ï¼Œä½†æ˜¯æ¯•ç«Ÿæ›¾æ˜¯æ•Œäººã€‚è¦æˆ‘è¯´ï¼Œåº”è¯¥é˜²èŒƒçš„æ˜¯ä½ æ‰å¯¹ã€‚â€</p>
<p>é£é€¸å¤§å£°å¼é“ï¼šâ€œä½ ä»¬éƒ½åˆ«äº‰äº†ã€‚é›ªå¶ï¼Œä½ å…ˆä¸‹å»ï¼ç­‰æš´å‡çº§åæˆ‘å†æ¥æ•™ä½ ã€‚ä½ ä¹Ÿä¸è¦æƒ³å¾—å¤ªå¤šï¼Œæˆ‘ç›¸ä¿¡ä½ ç»ä¸æ˜¯æ–‘å›½ç­çš„å¯†æ¢ï¼Œå†µä¸”æ–‘å›½ç­ç°åœ¨è¿˜æ²¡æœ‰å®£å¸ƒä¸æˆ‘ä»¬ä¸ºæ•Œå‘¢ï¼â€</p>
<p>é›ªå¶å¿ƒæƒ³ï¼šâ€œé£é€¸è¿˜å½“æˆ‘æ˜¯ä»€ä¹ˆéƒ½ä¸æ‡‚çš„å°æ¯›å­©å‘¢ï¼ç­‰æš´é é£é€¸çš„é‚£äº›çŸ¥è¯†å‡çº§åï¼Œé£é€¸å°±æˆäº†ä¸‰çº§æˆå‘˜ï¼Œä¸‰çº§æˆå‘˜åšä»€ä¹ˆï¼Œä¸‰çº§æˆå‘˜å°±ä¸éœ€è¦å†æ•™å­¦ç”Ÿäº†ï¼Œå»åšè‡ªå·±çš„ç ”ç©¶å»äº†ï¼Œè¿›ä¸€æ­¥å»å­¦ä¹ å˜é¾™æœ¯é‚£ç§ä¸æ­»èƒ½åŠ›å»äº†ã€‚é£é€¸ä¸å°±æ˜¯ä¸ºäº†è¿™ä¸ªå—ï¼Ÿä»¥åå¥¹è¿˜æ€ä¼šæ¥æ•™æˆ‘è¿™äº›ç”µå­å­¦çŸ¥è¯†å‘¢ï¼Ÿâ€</p>
<h2 id="å–ç¬‘"><a href="#å–ç¬‘" class="headerlink" title="å–ç¬‘"></a>å–ç¬‘</h2><p>é›ªå¶è¶Šæƒ³è¶Šç°å¿ƒï¼Œè¿ˆç€æ²‰é‡çš„æ­¥å­æ…¢æ…¢èµ°ä¸‹å»ã€‚ä¸€å±‚çš„é‚£äº›æˆå‘˜ç§é›ªå¶å¿ƒæƒ…æ²‰é‡çš„èµ°ä¸‹æ¥ï¼Œäº’ç›¸äº¤å¤´æ¥è€³èµ·æ¥ã€‚</p>
<p>å¾·æ–¯èµ°åˆ°é›ªå¶è·Ÿå‰é—®é“ï¼šâ€œæ€ä¹ˆäº†ï¼Œåˆç¢°é’‰å­äº†ã€‚è€å¸ˆæ˜¯ä¸æ˜¯æ­£å¿™ç€å’Œå¿ƒçˆ±çš„æš´åœ¨å…±åº¦ç¾å¥½æ—¶å…‰ï¼Œæ²¡ç©ºç†ä½ ã€‚å“ˆå“ˆï¼â€</p>
<p>å®‹è—é‡‘ç­‰äººå¬äº†å¾·æ–¯è¿™è¯ä¸€èµ·å“„ç¬‘èµ·æ¥ã€‚é›ªå¶æœ¬æ¥å°±ç”Ÿæ°”ï¼Œå¬åˆ°å…¶ä»–äººçš„å˜²ç¬‘ï¼Œå¿ƒæƒ…è¶Šå‘çƒ¦èºã€‚å¾·æ–¯è§é›ªå¶ç”Ÿæ°”ä¸ç­”ï¼ŒçŸ¥é“è¯´ä¸­äº†å¥¹çš„è¦å®³ï¼Œäºæ˜¯ç»§ç»­è¯´èµ·é£å‡‰è¯æ¥ã€‚</p>
<p>å¾·æ–¯è¯´ï¼šâ€œé£é€¸è¿˜ä¸æ˜¯çœ‹ä¸­äº†æš´æ˜¯æ²™è¥¿å¾·å­¦åºœè€å¸ˆçš„å¥³å„¿ï¼Œä½ å‘¢ï¼Œå­¤è‹¦ä¼¶ä»ƒçš„ä¸€ä¸ªäººï¼Œä»€ä¹ˆèƒŒæ™¯éƒ½æ²¡æœ‰ï¼Œä½ è¿˜æŒ‡æœ›å¥¹ä¼šå¯¹ä½ ä¸ªåˆ«è¾…å¯¼ï¼ŒæŠŠå¥¹å¹³ç”Ÿæœ€ä¸Šä¹˜çŸ¥è¯†æ•™ç»™ä½ å—ã€‚â€</p>
<p>é›ªå¶æ°”æ„¤åœ°å“¼äº†ä¸€å£°é“:â€œé‚£ä½ å‘¢ï¼Œä½ ä¸€å‰¯å…¬å­æ¨¡æ ·ï¼Œå®¶å¢ƒåˆé‚£ä¹ˆå¥½ï¼Œå¥¹æ€åœ°ä¸æ•™ä½ ã€‚è¿˜æœ‰æœˆæ¹–ï¼Œå¥¹æ˜¯å†¥æ˜Ÿè®®å‘˜çš„å¥³å„¿ï¼Œè¯´åˆ°å®¶æ—èƒŒæ™¯å¥¹æ€»è¯¥å¼ºäºæš´å§ï¼Œé‚£ä¸ºä½•é£é€¸ä¹Ÿä¸æ•™å¥¹å‘¢ï¼Ÿâ€</p>
<p>å¾·æ–¯å†·ç¬‘è¯´ï¼šâ€œä½ æ˜¯ä¸æ˜¯å­¤é›¶é›¶ä¸€ä¸ªäººç‹¬å±…æ—¶é—´å¤ªé•¿äº†ï¼Œè¿ç°åœ¨æ˜¯ä»€ä¹ˆå½¢åŠ¿éƒ½ä¸çŸ¥é“äº†ï¼Œç°åœ¨å†¥æ˜Ÿè¢«æ²™è¥¿å¾·æ˜Ÿå’Œç‹±æ˜Ÿå·²ç»å æ®äº†å¤§åŠã€‚é£é€¸å€’ä¹Ÿå¾ˆæœ‰è¿œè§ï¼Œå¦‚æœæˆ‘ä»¬å†¥æ˜Ÿè¢«æ²™è¥¿å¾·æ˜Ÿè¿™å¸®ç™½å‘ä½¬ç»Ÿæ²»äº†ï¼Œå¥¹è¿™æ ·åšä¸ä¹Ÿæ˜¯ç»™è‡ªå·±ç•™äº†ä¸ªåè·¯å—ï¼Ÿæ”¹æ˜ï¼Œæˆ‘æˆäºŒçº§æˆå‘˜åä¹Ÿå¤šæ•™å‡ ä¸ªæ²™è¥¿å¾·å­¦ç”Ÿæ¥å“¦ã€‚â€</p>
<p>å®‹è—é‡‘è·Ÿç€èµ·å“„ï¼Œä»–å¯¹ååœ¨è¥¿å—è¾¹çš„ç´®æƒ‘æµ®å’Œå‡Œç©†è¯´ï¼šâ€œä½ ä»¬ä¿©å¬è§äº†ï¼Œèµ¶å¿«å»ç”³è¯·è€å¸ˆå§ï¼Œæ—¥åå¤šæ‰¾å‡ ä¸ªç™½å‘å­¦ç”Ÿæ•™ï¼Œä¹Ÿç»™ä½ ä»¬ç•™æ¡åè·¯å•Šã€‚â€</p>
<p>ç´®æƒ‘æµ®å’Œå‡Œç©†éƒ½æ˜¯é£é€¸è€å¸ˆæ‰‹æŠŠæ‰‹æ•™è¿‡æ¥çš„ï¼Œä½†å½“æ—¶æ²™è¥¿å¾·æ˜Ÿå’Œç‹±æ˜Ÿè¿›æ”»å†¥æ˜Ÿï¼Œä¼˜åŠ¿ä¸å¤§ã€‚æ­¤åˆ»å¬åˆ°å¾·æ–¯ç­‰äººçš„è¯´è¯ï¼Œè™½è§‰æœ‰äº›é“ç†ï¼Œä¹Ÿä¸æ„¿è¯´è¿™äº›å¯¹é£é€¸è€å¸ˆä¸æ•¬çš„è¯ã€‚ä¸¤äººä¸ç¬ä¼—äººï¼Œä»–ä»¬æˆ´ä¸Šè€³æœºï¼Œä¼¸æ‰‹è§¦æ‘¸ä¸€ä¸‹å«ç¾è‰æ’­æ”¾å™¨ï¼Œä¸€é¢çœ‹â€˜ç™½ç¾½å·â€™èµ„æ–™ï¼Œä¸€é¢å¬èµ·æ­Œæ¥ã€‚æ˜“æ…§å’Œå°ä¾ƒéƒ½ä¸æ˜¯å¯Œå®¶å­å¼Ÿï¼Œä»–ä»¬æ°”å†²å†²çš„ç«™åœ¨ä¸€æ—ï¼Œæ­¤æ—¶æ°”å¾—è¯´ä¸å‡ºè¯æ¥ã€‚</p>
<p>é›ªå¶è¯´ï¼šâ€œä½ ä»¬è¿™å«åƒä¸åˆ°è‘¡è„è¯´è‘¡è„é…¸ï¼Œé£é€¸è€å¸ˆå°±æ˜¯çœ‹ä½ ä»¬å¤ªä¸–ä¿—ï¼Œåˆæ²¡ä»€ä¹ˆçœŸæœ¬äº‹ï¼Œæ‰ä¸æ„¿ä¼ æˆä½ ä»¬ä¸Šä¹˜çš„çŸ¥è¯†çš„ã€‚ä¼°è®¡å¾·æ–¯å’Œæœˆæ¹–ä¸€çº§æˆå‘˜çš„èº«ä»½ï¼Œéƒ½æ˜¯é ä¹°é€šç™½é¾™ç­è¯„å§”æˆå‘˜å¾—æ¥çš„å§ï¼æš´çš„é‚£ä¸ªâ€˜ç™½è‰³å…¬ä¸»â€™æœºå™¨äººä½ ä»¬èƒ½å¤Ÿåšå¾—å‡ºå—ï¼Ÿâ€</p>
<p>å¾·æ–¯ç¬‘é“ï¼šâ€œå“ˆå“ˆï¼ŒçœŸæ˜¯å¥½ç¬‘ï¼Œåšä¸å‡ºåˆæœ‰ä½•ç›¸å¹²ã€‚ä½ è¯´æˆ‘ä»¬ä¸–ä¿—ï¼Œæˆ‘çœ‹ä½ æ‰æ˜¯å°äººï¼Œä»¥å°äººä¹‹å¿ƒåº¦å›å­ä¹‹è…¹ï¼ä½ ä»¥ä¸ºç™½é¾™ç­è¯„å§”é‚£ä¹ˆå¥½ä¹°é€šï¼Œè¿™äº›è¯„å§”éƒ½æ˜¯ä»å„ç­ä¸‰çº§ä»¥ä¸Šæˆå‘˜ä¸­ç²¾æŒ‘ç»†æ£€å‡ºæ¥çš„ï¼Œä¸ªä¸ªåœ°ä½é«˜äºè€å¸ˆã€‚å­¦åºœçš„æ¯æ¬¡ç«èµ›éƒ½æœ‰å…¨æ–¹ä½è®°å½•ï¼Œå¦‚è¯„å§”ä½œå‡è¢«æ˜æœå­¦åºœå†…é˜å‘ç°ï¼Œé‚£æ˜¯è¦è¢«å–‚é¾™çš„ã€‚æœ‰å‡ ä¸ªä¸æ€•æ­»çš„è¯„å§”æ•¢ä¹°å–æˆå‘˜çº§åˆ«ï¼Ÿå†è¯´ï¼Œå°±ç®—æˆ‘å’Œæœˆæ¹–çš„ä¸€çº§æˆå‘˜æ˜¯ä¹°é€šçš„åˆæ€ä¹ˆäº†ï¼Œè¿™ä¹Ÿæ˜¯æœ¬äº‹ï¼Œè¿™æœ¬äº‹ä½ æœ‰å—ï¼Ÿâ€</p>
<p>é›ªå¶è¯´ï¼šâ€œæˆ‘è‡ªç„¶æ²¡ä½ ä»¬è¿™æœ¬äº‹ï¼â€</p>
<p>å¾·æ–¯å‘µå‘µå¤§ç¬‘é“ï¼šâ€œæˆ‘çœ‹ä½ å¾ˆæœ‰æœ¬äº‹ï¼ä½ é‚£å¹´ä»æˆ‘ä»¬ç™½é¾™ç­é€ƒè·‘åï¼Œæ— åæ— åˆ†ï¼Œåƒä¸ªä¹ä¸ï¼Œè¿˜ä¸­æ¯’åœ¨èº«ã€‚è°çŸ¥é“ä½ æ˜¯çˆ¬ä¸Šäº†å“ªä¸€ä½ä¸Šæµç”·äººçš„åºŠï¼Œåšäº†ä¸è¦è„¸çš„äº‹ã€‚ä¸ç„¶æ€ä¹ˆä»…ä»…ä¸¤å¹´æ—¶é—´å°±è½»è€Œæ˜“ä¸¾åœ°å–å¾—äº†ä¸ªä¸€çº§æˆå‘˜èº«ä»½ã€‚â€</p>
<p>çªç„¶é‡é‡ä¸€æ‹³ï¼Œé›ªå¶æŒ¥æ‹³æ‰“åˆ°å¾·æ–¯è„¸ä¸Šã€‚</p>
<p>å¾·æ–¯æ‚ä½è„¸è¿˜åœ¨å¥¸ç¬‘ï¼šâ€œä½ ä»¬çœ‹å•Šï¼æˆ‘è¯´ä¸­äº†å§ï¼Œä½ çœŸä¸è¦è„¸ã€‚ä½ å†æ‰“å‘€ï¼Œä½ è¶Šè¿™æ ·è¶Šè¯´æ˜ä½ å¿ƒè™šã€‚è¿™é‡Œçš„æ‰€æœ‰äººéƒ½å’Œæˆ‘æƒ³çš„ä¸€æ ·ï¼Œåªæ˜¯ä¸æ„¿æ„å½“ç€ä½ é¢è¯´ç½¢äº†ã€‚æˆ‘çœŸä¸ºä½ æ„Ÿåˆ°ä¸¢è„¸ï¼Œè¿ç±³ç”Ÿé‚£ä¸ªå¤§å‚»ç“œéƒ½æƒ³æ¯’æ­»ä½ ï¼Œä½ æ­»äº†å°±æ²¡äººç»™ä»–ä¸¢è„¸äº†ã€‚æ¯’æ­»ä½ æ´»è¯¥ï¼â€</p>
<p>é›ªå¶è¿™æ—¶å¬åˆ°å¾·æ–¯æåŠç±³ç”Ÿå½“å¹´å®³è‡ªå·±çš„äº‹ï¼Œä¸ç¦æ³ªæµæ»¡é¢ï¼Œå’¬ç‰™åˆ‡é½¿ï¼Œæ¡ç´§æ‹³å¤´æ¬²å’Œå¾·æ–¯æ‹¼å‘½ã€‚è¿™æ—¶æœˆæ¹–ä¸€æŠŠæŠ“ä½äº†é›ªå¶çš„æ‰‹ã€‚</p>
<p>æœˆæ¹–æŒ‡ç€å¾·æ–¯å¼é“ï¼šâ€œå¾·æ–¯ï¼Œä½ ä¸è¦èƒ¡è¯´ï¼è¿˜æé‚£ç±³ç”Ÿå¹²å˜›ï¼Ÿä½ æ˜¯å­˜å¿ƒè¦æ°”æˆ‘ä¸æˆï¼Ÿâ€</p>
<p>æœˆæ¹–è½¬è¿‡æ¥åŠé›ªå¶è¯´ï¼šâ€œé›ªå¶ï¼Œä½ ä¸è¦å»ç†å¾·æ–¯ï¼Œä»–æ˜¯ç‹—å˜´é‡Œåä¸å‡ºè±¡ç‰™æ¥ã€‚ä½ è¦æ˜¯å’Œä»–å¯¹ç€æ¥ï¼Œä»–ä»€ä¹ˆéš¾å¬çš„è¯éƒ½èƒ½å¤Ÿè¯´å‡ºæ¥ï¼Œä»–è¯´çš„è¿™äº›éƒ½æ˜¯èµŒæ°”è¯ï¼Œä½ å¯åƒä¸‡ä¸è¦å½“çœŸï¼â€</p>
<p>é›ªå¶çŸ¥é“è¿™æ˜¯æœˆæ¹–åœ¨å®‰æ…°è‡ªå·±ï¼Œå…¶å®å¾·æ–¯æ‰€è¯´çš„è¯çš„ç¡®æ˜¯å¤§å®¶é—²èŠæ—¶éƒ½æ›¾è¯´è¿‡çš„ï¼Œæœˆæ¹–å¶å°”ä¹Ÿå¬åˆ°è¿‡è¿™äº›é—²è¨€ç§½è¯­ï¼Œåªæ˜¯å½“ç€é›ªå¶çš„é¢æåŠå½“å¹´ç±³ç”Ÿä¸‹æ¯’çš„äº‹ï¼Œå´æ˜¯é›ªå¶æ— æ³•æ¥å—çš„ï¼Œå¥¹å°±æ²¡å»åŠé›ªå¶æ”¾å¼ƒç±³ç”Ÿçš„è¯ã€‚é›ªå¶æ‰­å¤´çœ‹ç€æœˆæ¹–æ¸©æŸ”çš„çœ‹ç€è‡ªå·±ï¼Œæœˆæ¹–æ¨¡æ ·é›å®¹åè´µï¼Œæ°”è´¨ä¸å‡¡ï¼Œé›ªå¶è¶Šçœ‹è¶Šè§‰å¾—è‡ªå·±ç›¸å½¢è§ç»Œã€‚å…¶å®ç°åœ¨çš„é›ªå¶æ—©å·²ä¸æ˜¯ä»¥å‰é‚£ä¸ªè½é­„çš„é›ªå¶äº†ï¼Œé›ªå¶æ— è®ºç›¸è²Œè¿˜æ˜¯ç©¿ç€ç°åœ¨ä¸æ¯«ä¹Ÿä¸å·®äºæœˆæ¹–ï¼Œåªä¸è¿‡é›ªå¶å¿ƒä¸­å§‹ç»ˆä¸èƒ½å¿˜è®°ç±³ç”Ÿæ—¥è®°ä¸­æ‰€å†™çš„è‡ªå·±é‚£æ—¶æ†”æ‚´ä¸å ªçš„å½¢è±¡ï¼Œå¿ƒå­˜é˜´å½±ç½¢äº†ã€‚</p>
<p>é›ªå¶æŠ¬èµ·å¤´çœ‹ç€æœˆæ¹–è¯´ï¼šâ€œæœˆæ¹–å§ï¼Œä½ çŸ¥é“ç±³ç”Ÿåˆ°å“ªé‡Œå»äº†å—ï¼Ÿâ€</p>
<p>æœˆæ¹–ç­”é“ï¼šâ€œå¥½å¦¹å¦¹ï¼Œä½ å›æ¥åä¸‰å¤©ä¸¤æ—¥å°±è¦é—®æˆ‘ä¸€æ¬¡è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬ä¿©è¿™ä¹ˆå¥½ï¼Œæˆ‘å¦‚æœçŸ¥é“ç±³ç”Ÿçš„æƒ…å†µæ€ä¼šä¸å‘Šè¯‰ä½ ï¼Ÿâ€</p>
<p>å¾·æ–¯å¬ä¸ä¸‹å»äº†ï¼Œæ€¥å¿™æ’è¯è¯´ï¼šâ€œçœŸä¸å¯ç†å–»ï¼Œé›ªå¶ï¼Œä½ åˆ°åº•æœ‰å®Œæ²¡å®Œï¼Ÿæ¯æ¬¡ç¢°åˆ°ä½ éƒ½æ˜¯å‰ä¸€å¥é—®ç±³ç”Ÿåœ¨å“ªï¼Œåä¸€å¥ç±³ç”Ÿä»€ä¹ˆæ—¶å€™å›æ¥ã€‚ä½ çœŸå¯ç¬‘ï¼Œç±³ç”Ÿä¸è¦ä½ äº†ï¼Œä»–æƒ³ä½ æ­»ï¼Œä½ äººä¸æ­»ï¼Œå°±æ­»äº†è¿™æ¡å¿ƒï¼Œå›ä½ é‚£ä¸ªä»€ä¹ˆæ–‘å›½ç­å»å§ï¼é‚£é‡Œçš„è€å¸ˆä¼šå¥½å¥½ç–¼ä½ çš„ï¼Œå“ˆå“ˆï¼â€</p>
<h2 id="é»‘ç†Šé¬¼å°†"><a href="#é»‘ç†Šé¬¼å°†" class="headerlink" title="é»‘ç†Šé¬¼å°†"></a>é»‘ç†Šé¬¼å°†</h2><p>é›ªå¶æ€’æ°”åˆšæ¶ˆï¼Œä½†ç»å¾·æ–¯åˆè¿™ä¹ˆä¸€è¯´ï¼Œé¡¿æ—¶æ»¡è„¸ç›´å†’æ€æ°”ï¼Œå¥¹åœ¨å¿ƒä¸­é»˜å¿µä¸€æ®µå’’è¯­ï¼Œèº«åç«‹å³æµ®ç°ä¸€å¤´å·¨å¤§çš„é»‘è‰²ç†Šå¹»å½±ã€‚é»‘ç†Šå¼ å¼€å¤§å£ï¼Œå¼å£°éœ‡åŠ¨æ•´ä¸ªæˆ¿é—´ï¼Œå¾·æ–¯å…ˆæ˜¯åƒäº†ä¸€æƒŠï¼Œéšåæ‹”å‡ºå•æ‰‹å‰‘æ¥ä¸ç†Šæ ¼æ–—ã€‚é»‘ç†Šæ‰‹æŒå·¨é”¤ï¼Œé›ªå¶æµ®åœ¨ç©ºä¸­ï¼Œå¥¹èº«ä½“å››å‘¨ç¯ç»•ç€é»‘è‰²å…‰åœˆï¼Œé›ªå¶åšä»€ä¹ˆåŠ¨ä½œï¼Œé‚£é»‘ç†Šå°±åšä»€ä¹ˆåŠ¨ä½œï¼Œå¦‚åŒé›ªå¶çš„å‚€å„¡ã€‚é»‘ç†ŠæŒ¥å¤§é”¤å‘å¾·æ–¯ç ¸å»ï¼Œå¾·æ–¯æ¨ªå‰‘ä¸€æŒ¡æ²¡æœ‰æŒ¡ä½ï¼Œå¤§é”¤ç ¸åˆ°å¾·æ–¯èº«ä¸Šã€‚ä½†è¿™é­”æ³•ç»ˆå› é›ªå¶é­”åŠ›ä¸å¤Ÿæ²¡èƒ½å¯¹å¾·æ–¯é€ æˆè‡´å‘½çš„ä¼¤å®³ï¼Œä¸è¿‡è¿™é”¤ç¢°åˆ°å¾·æ–¯å¤´éƒ¨æ—¶è¿˜æ˜¯ä½¿ä»–å¤´ä¸Šæ„Ÿè§‰ä¸­äº†å¾ˆé‡ä¸€é”¤ä¼¼çš„ï¼Œå¾·æ–¯â€œè½°â€çš„ä¸€å£°èº«ä½“æ‘”å€’åœ°ä¸Šã€‚åˆ¹æ—¶åªè§ä¸¤é“ç™½å…‰å‘å¾·æ–¯è¿™è¾¹æé€Ÿåˆ’è¿‡æ¥ã€‚â€œé“›â€çš„ä¸€å£°ï¼Œåˆä¸€é“ç™½å…‰åˆ’äº†è¿‡å»ï¼Œä¸‰é“ç™½å…‰ç›¸ç¢°åˆ°ä¸€èµ·ï¼Œç«æ˜Ÿå››æº…ã€‚é›ªå¶è§å¾·æ–¯å€’åœ°ï¼ŒåŒæ‰‹æ‹¿ç€å¥¹çš„é‚£å¯¹ç™½é¾™çˆªåŒåˆ€ï¼Œä¿¯èº«çªå‰ç æ¥ï¼Œæ­£å¥½ç åœ¨ä¸€æŠŠé•¿åˆ€ä¸Šã€‚è¿™åˆ€æ˜¯ç´®æƒ‘æµ®çš„çº¢å‡¤é•¿åˆ€ã€‚ç´®æƒ‘æµ®æ¥ä½é›ªå¶çš„ç™½é¾™çˆªåŒåˆ€ï¼Œå°†é•¿åˆ€å‘ä¸Šä¸€æŒ‘ï¼Œé›ªå¶é¡ºåŠ¿åé€€ä¸€æ­¥ï¼Œæ”¶èµ·åˆ€æ¥ã€‚</p>
<p>ç´®æƒ‘æµ®æ‰‹æŒé•¿åˆ€å¤§å£°å¼é“ï¼šâ€œä½ ä»¬è¦æ‰“å°±åˆ°å¤–é¢å»æ‰“ï¼Œä¸è¦æŠŠé£èˆ¹é‡Œçš„è´µé‡è®¾å¤‡æ‰“åäº†ï¼â€</p>
<p>é›ªå¶æ”¶èµ·é­”æ³•ï¼Œé»‘è‰²å…‰åœˆæ¸æ¸æ¶ˆå¤±ï¼Œå¥¹è¯´ï¼šâ€œç´®æƒ‘æµ®å‰è¾ˆè¯´çš„æ˜¯ã€‚æˆ‘ä»¬ä¸è¯¥åœ¨è¿™é‡ŒåŠ¨æ‰‹ã€‚ä½†åˆšæ‰å¾·æ–¯çš„ååº”è¡¨ç°è¶³ä»¥è¯´æ˜ä»–æˆä¸ºç™½é¾™ç­å­¦å‘˜é çš„ä¸æ˜¯æœ¬é¢†ï¼Œå¤©çŸ¥é“ä»–æ˜¯é ä»€ä¹ˆå‡çº§ä¸ºä¸€çº§æˆå‘˜çš„ã€‚â€</p>
<p>å¾·æ–¯è¢«é›ªå¶è¿™ä¸€å“ï¼Œä¸€æ—¶æ²¡æ•¢å†ä¸ºè‡ªå·±è¾©è§£ã€‚</p>
<p>ç´®æƒ‘æµ®å°†é•¿åˆ€æ’å…¥å‰‘å¥—ï¼Œè¯´ï¼šâ€œæ–‘å›½ç­çš„â€˜é»‘ç†Šé¬¼å°†â€™ä»Šå¤©æˆ‘ç®—æ˜¯äº²çœ¼è§åˆ°äº†ã€‚â€</p>
<p>é›ªå¶ä¹Ÿå°†åŒåˆ€æ”¶èµ·ï¼Œæ‘‡æ‘‡å¤´è¯´ï¼šâ€œæˆ‘è¿™ä¸èƒ½ç®—æ˜¯æ–‘å›½ç­çœŸæ­£çš„â€˜é»‘ç†Šé¬¼å°†â€™ã€‚â€˜é»‘ç†Šé¬¼å°†â€™è™½ç„¶åªæ˜¯æ–‘å›½ç­å…¥é—¨åŠŸå¤«ï¼Œä½†æ˜¯æ‹›å¼å´æ˜¯ååˆ†ä¸°å¯Œï¼Œå¨åŠ›ä¹Ÿå¾ˆå¤§ï¼Œçº§åˆ«ä½å’Œé«˜çš„äººä½¿èµ·æ¥çœ‹ä¼¼ç›¸åŒï¼Œå®é™…å´æœ‰å¤©å£¤ä¹‹åˆ«ã€‚ä½ åˆšæ‰è§æˆ‘è€çš„åªæ˜¯å…¶ä¸­ä¸€ç§æ‹›å¼ç½¢äº†ã€‚â€</p>
<p>ç´®æƒ‘æµ®å¾®ç¬‘ç€è¯´ï¼šâ€œé‚£æ”¹æ—¥æˆ‘ä»¬å†åˆ‡ç£‹åˆ‡ç£‹ï¼â€</p>
<p>é›ªå¶ç‚¹å¤´åº”é“ï¼šâ€œæ²¡é—®é¢˜ã€‚åªæ˜¯æˆ‘è§‰å¾—å¾ˆå¥‡æ€ªï¼Œåˆšæ‰æˆ‘å‡ºåˆ€æ—¶çœ‹ä½ å¹¶ä¸åœ¨è¿™é‡Œï¼Œè¿˜åœ¨å¾ˆè¿œçš„åœ°æ–¹ï¼Œç¬é—´ä½ å°±è¿‡æ¥äº†ã€‚ä½ æ€ä¹ˆæ¥å¾—è¿™ä¹ˆå¿«ï¼Ÿã€‚â€</p>
<p>ç´®æƒ‘æµ®è¯´ï¼šâ€œä½ å¯ä¸è¦å°ç§äº†ç™½é¾™ç­çš„åŠŸå¤«ï¼é€‚æ‰ï¼Œæˆ‘ç”¨çš„æ˜¯â€˜åœé™·æœ¯â€™ï¼Œè¿™ä¸ªé­”æ³•çš„ä½œç”¨æ˜¯é™ä½å¯¹æ‰‹çš„ç‰©ç†æ”»å‡»é€Ÿåº¦ã€‚æ­¤æ³•è™½éš¾å‡»è´¥å¯¹æ‰‹ï¼Œä½†å¯¹æ–¹æƒ³è¦è´¥æˆ‘ä¹Ÿéæ˜“äº‹ã€‚â€</p>
<p>é›ªå¶è¯´ï¼šâ€œä¸€ç”Ÿèƒ½å¤Ÿç²¾é€šä¸€é—¨æ­¦åŠŸè¶³å·²ï¼â€</p>
<h2 id="ç»è‰²ä¸ƒå½©"><a href="#ç»è‰²ä¸ƒå½©" class="headerlink" title="ç»è‰²ä¸ƒå½©"></a>ç»è‰²ä¸ƒå½©</h2><p>ç´®æƒ‘æµ®ç»§ç»­è¯´é“ï¼šâ€œå› ä¸ºå½“æ—¶å’Œä½ ç›¸è·å¤ªè¿œï¼Œè¦æƒ³é©¬ä¸Šèµ¶è¿‡æ¥å¾ˆå›°éš¾ï¼Œäºæ˜¯æˆ‘ç”¨äº†â€˜ç»è‰²ä¸ƒå½©â€™ä¸­çš„ â€˜è½»çµå¦‚èˆâ€™æ‹›æ•°ï¼Œ æˆ‘å°†é­”åŠ›èµ‹äºˆçº¢å‡¤é•¿åˆ€ï¼Œè¿…é€Ÿä¼°ç®—å‡ºä½ æŒ¥åˆ€ç åˆ°å¾·æ–¯èº«ä¸Šçš„æ—¶é—´ï¼Œå‡†ç¡®åˆ©ç”¨ç®—å‡ºçš„æ—¶é—´å·®ï¼Œæˆ‘å°†çº¢å‡¤åˆ€é€‚åŠ›æŠ•æ·å‡ºå»ï¼Œé•¿åˆ€ä¸€è„±èº«ï¼Œæˆ‘çš„èº«ä½“ä¾¿è½»ç›ˆæ— æ¯”èµ·æ¥ï¼Œè¿™æ—¶ç”¨â€˜è½»çµå¦‚èˆâ€™çš„é­”æ³•å’’è¯­ï¼Œæ‰“æ•£æˆ‘èº«ä½“çš„åˆ†å­ï¼Œè¿™äº›åˆ†å­å°±åƒé“¶å…‰å¾®å°˜ä¸€èˆ¬å½“å³è¢«çº¢å‡¤åˆ€å¸ä½ï¼Œè¿™æ—¶çº¢å‡¤åˆ€ä¸€è¢«æ’å‡»ï¼Œæˆ‘èº«ä½“çš„åˆ†å­é©¬ä¸Šå°±ç»„åˆæ¢å¤æˆäººå½¢ã€‚ä½ åˆšæ‰é‚£ä¸€ç æœçœŸåŠ›å¤§ï¼Œæˆ‘é¡¿æ—¶å°±æ¢å¤è¿‡æ¥äº†ã€‚â€</p>
<p>é›ªå¶å¿ƒæƒ³ï¼šâ€œç™½é¾™ç­çš„â€˜ç»è‰²ä¸ƒå½©â€™åŸæ¥è¿™èˆ¬ç²¾å¦™ï¼Œå®Œå…¨ä¸æ˜¯å½“å¹´ç±³ç”Ÿæ‰€è€çš„é‚£æ ·ã€‚æˆ‘å¯æ€œçš„ç±³ç”Ÿï¼Œä½ è¢«ç™½é¾™ç­è€å¸ˆæ¬ºéª—äº†å•Šï¼ä»–ä»¬å®Œå…¨æ²¡æœ‰æ•™ä½ é‚£äº›å¥½çš„ä¸œè¥¿ã€‚é£é€¸åå¿ƒï¼Œä¸æ„¿æ•™ä½ ï¼Œåªå°†çœŸæœ¬é¢†æ•™ç»™ç´®æƒ‘æµ®å’Œæš´ä»–ä»¬ï¼Œæˆ‘ä¸€å®šè¦å°†è¿™äº›çœŸæœ¬äº‹å­¦åˆ°æ‰‹ï¼ä½ å¿«å›æ¥å•Šï¼Œæˆ‘å­¦ä¼šäº†å¥½å¥½æ•™ä½ ã€‚â€</p>
<p>æƒ³åˆ°è¿™é‡Œï¼Œé›ªå¶é©¬ä¸Šè·ªåœ¨åœ°ä¸Šä½ç€å¤´æ³è¯·é“ï¼šâ€œç´®æƒ‘æµ®å‰è¾ˆï¼Œè¯·ä½ æ”¶ä¸‹æˆ‘è¿™ä¸ªå¼Ÿå­ï¼Œå°†è¿™äº›æ•™æˆ‘ï¼Œä½ è¦æˆ‘åšä»€ä¹ˆæˆ‘éƒ½æ„¿æ„ã€‚â€</p>
<p>åœ¨åœºä¼—äººçœ‹é›ªå¶å½“ä¼—è·ªä¸‹ï¼Œä¸ªä¸ªæƒŠå¾—ç›®çªå£å‘†ã€‚ç´®æƒ‘æµ®ä¸€æ—¶ä¹Ÿè§‰å°´å°¬ï¼Œé¡¿æ—¶æ‰‹è¶³æ— æªï¼Œä¸€æ—¶ä¸çŸ¥è¯´ä»€ä¹ˆå¥½ã€‚</p>
<p>é£é€¸å’Œæš´å¬åˆ°ç™½ç¾½å·é‡Œé­”æ³•è­¦æŠ¥å™¨å‘å‡ºè®¯å·ï¼Œæç¤ºæ¥¼ä¸‹æœ‰äººæ–½é­”æ³•ï¼Œè¿…é€Ÿä»ä¸Šå±‚èµ°ä¸‹æ¥ï¼Œå¬äº†é›ªå¶å’Œç´®æƒ‘æµ®çš„å¯¹è¯ï¼Œåˆçœ‹åˆ°é›ªå¶è·ªåœ¨åœ°ä¸Šè¦æ‹œç´®æƒ‘æµ®ä¸ºå¸ˆå­¦è‰ºï¼Œé£é€¸ä¸Šå‰è¯´é“ï¼šâ€œé›ªå¶ï¼Œå¿«èµ·æ¥ï¼è¿™è±¡ä»€ä¹ˆè¯ã€‚ä½ å½“æˆ‘ä»¬ç™½é¾™ç­æ˜¯ä»€ä¹ˆåœ°æ–¹ï¼Œæ±‚å­¦éœ€è¦è¿™ä¹ˆä½å£°ä¸‹æ°”çš„å—ï¼Ÿä½ æ—¢ç„¶å·²æ˜¯æˆ‘ä»¬ç™½é¾™ç­çš„å­¦ç”Ÿï¼Œè¿™äº›åŠŸå¤«è‡ªç„¶ä¼šæ•™ä½ çš„ï¼Œç”¨å¾—ç€è¿™æ ·å—ï¼Ÿâ€</p>
<p>é›ªå¶ä¾ç„¶è·ªç€ä¸èµ·ï¼Œçœ¼ä¸­å«ç€æ³ªèŠ±ç»§ç»­è¯´é“ï¼šâ€œé™¤éè€å¸ˆç°åœ¨è®¸è¯ºé©¬ä¸Šå°±æ•™æˆ‘ï¼Œä¸ç„¶æˆ‘å°±ä¸èµ·æ¥äº†ã€‚â€</p>
<p>æ˜“æ…§å’Œå°ä¾ƒçœ‹é›ªå¶å¦‚æ­¤ï¼Œä¸ºé›ªå¶æ±‚å­¦çš„ç²¾ç¥æ‰€æ„ŸåŠ¨ï¼Œé½å£°å¸®é›ªå¶æ±‚é“ï¼šâ€œé£é€¸è€å¸ˆï¼Œæ•™æˆçŸ¥è¯†æœ¬æ¥å°±æ˜¯è€å¸ˆå¤©èŒï¼Œä½ å°±ç­”åº”å¥¹å§ã€‚â€</p>
<p>é£é€¸æ°”æ„¤åœ°è¯´ï¼šâ€œæˆ‘åˆæ²¡è¯´ä¸æ•™ï¼â€˜ç»è‰²ä¸ƒå½©â€™æœ¬æ¥å°±æ˜¯ä¸€çº§æˆå‘˜åº”è¯¥æŒæ¡çš„ä¸€é—¨æ­¦è‰ºï¼Œåªæ˜¯æˆ‘ç°åœ¨å¿™äºç»™æš´è¡¥ä¹ ä¸€äº›â€˜ç™½ç¾½å·â€™çš„çŸ¥è¯†ï¼Œä¸€æ—¶æŠ½ä¸å‡ºæ—¶é—´æ¥ã€‚â€</p>
<p>é£é€¸è¯´åˆ°è¿™é‡Œåœé¡¿ä¸‹æ¥ï¼Œå¥¹æƒ³äº†ä¸€ä¼šï¼Œè½¬å¤´å¯¹ç´®æƒ‘æµ®è¯´ï¼šâ€œè¿™æ ·å§ï¼Œç´®æƒ‘æµ®ã€‚ä½ å°†ä½ åˆšæ‰ä½¿çš„é‚£æ‹›â€˜è½»çµå¦‚èˆâ€™å°±å…ˆæ•™é›ªå¶å§ï¼Œä½†ä»¥åä¸€å®šè¦è®°ä½ï¼Œä¸åˆ°ä¸‡ä¸å¾—å·²ï¼Œä¸è¦å’Œå¥¹è¾ƒæ‰‹ã€‚â€</p>
<p>ç´®æƒ‘æµ®å¬è€å¸ˆè¿™ä¹ˆä¸€è¯´ï¼Œå½“å³ç­”åº”ä¸‹æ¥ï¼Œå¥¹å¯¹è·ªåœ¨åœ°ä¸Šçš„é›ªå¶è¯´ï¼šâ€œé›ªå¶ï¼Œå¿«èµ·æ¥ï¼æˆ‘æ˜æ—¥å°±æ•™ä½ æˆ‘åˆšæ‰ä½¿çš„é‚£æ‹›ã€‚æˆ‘å³ä½¿å·²ç»ç”³è¯·æˆäº†è€å¸ˆï¼Œä½ ä¹Ÿä¸ç”¨å«æˆ‘è€å¸ˆå•Šã€‚æˆ‘ä»¬æ˜¯åŒå­¦ï¼Œä½ åˆèªæ˜ï¼Œåˆå‹¤å¥‹ï¼Œåœ¨æ–‘å›½ç­ä»…ä¸¤å¹´å°±èƒ½å¤Ÿå‡çº§æˆä¸ºä¸€çº§æˆå‘˜ã€‚æˆ‘å¯æ˜¯è‡ªæ„§ä¸å¦‚å‘µï¼æˆ‘æƒ³ï¼Œä¸è¶…å‡ºä¸¤å¹´ï¼Œä½ ä¸€å®šèƒ½å¤Ÿé¡ºåˆ©æˆä¸ºä¸€ä¸ªè€å¸ˆã€‚â€</p>
<p>é›ªå¶æ…¢æ…¢ç«™èµ·æ¥ï¼Œå¿ƒæƒ³ï¼šâ€œé£é€¸å«ç´®æƒ‘æµ®ä¸è¦å’Œæˆ‘è¾ƒæ‰‹ï¼Œå°±æ˜¯æ€•æˆ‘å’Œå¥¹åˆ‡ç£‹åŠŸå¤«ï¼Œæ€•æˆ‘çœ‹åˆ°ç™½é¾™ç­é‡Œçš„æ›´å¤šå¥½åŠŸå¤«ï¼Œé£é€¸ä¸ºä½•è¿™æ ·æ’æ–¥æˆ‘ï¼Ÿè¿ç´®æƒ‘æµ®è‡ªå·±éƒ½çŸ¥é“æˆ‘æ¯”å¥¹å¼ºï¼Œé£é€¸å½“å¹´å´é‚£ä¹ˆç”¨å¿ƒæ•™å¥¹ã€‚ç°åœ¨å¥¹å†·æ¼ æˆ‘ï¼Œéš¾é“å¥¹æ˜¯çœŸçš„æ€€ç–‘æˆ‘æ˜¯æ–‘å›½ç­æ´¾åˆ°è¿™æ¥çš„å¥¸ç»†å—ï¼Ÿæˆ‘æ€å¯èƒ½æ˜¯æ–‘å›½ç­å¥¸ç»†å‘¢ï¼Ÿæˆ‘å¯¹æ–‘å›½ç­åˆæ²¡æœ‰å¤šå°‘å¥½æ„Ÿã€‚ç®—äº†ï¼Œä»¥å‰çš„äº‹å°±ä¸è¦å†æƒ³äº†ï¼Œç°ä¸‹å­¦ä¸€æ‹›æ˜¯ä¸€æ‹›ï¼Œå½“ç€é£é€¸çš„é¢ï¼Œç´®æƒ‘æµ®è‚¯å®šæ²¡æ³•ç­”åº”æ•™æˆ‘ç™½é¾™ç­çš„å…¶å®ƒåŠŸå¤«ï¼Œå¾…æˆ‘å’Œç´®æƒ‘æµ®å•ç‹¬åœ¨ä¸€èµ·çš„æ—¶å€™å†æ±‚å¥¹æ•™æˆ‘ä¹Ÿä¸è¿Ÿã€‚â€</p>
<p>äºæ˜¯é›ªå¶å¯¹ç´®æƒ‘æµ®è¯´ï¼šâ€œè°¢è°¢ç´®æƒ‘æµ®å‰è¾ˆï¼ä½ è¿‡å¥–äº†ã€‚â€</p>
<p>é£é€¸å’Œæš´å»ä¸Šå±‚æˆ¿é—´åï¼Œæœˆæ¹–ï¼Œæ˜“æ…§å’Œå°ä¾ƒä¸‰äººé©¬ä¸Šå›´äº†è¿‡æ¥ï¼Œ</p>
<p>æœˆæ¹–èµ°è¿‘é›ªå¶ï¼Œæ‹‰ç€å¥¹çš„æ‰‹ï¼Œå…³åˆ‡çš„è¯´ï¼šâ€œè¦æ˜¯ç´®æƒ‘æµ®ä¸å¥½å¥½æ•™ä½ ï¼Œä½ å°±æ‰¾æˆ‘å¥½äº†ã€‚â€</p>
<p>æ˜“æ…§æŒºç€èƒ–å¤§çš„è‚šå­ï¼Œå¥¹è¯´ï¼šâ€œç»è‰²ä¸ƒå½©â€™æˆ‘ä¹Ÿä¼šç‚¹ï¼Œé£é€¸è€å¸ˆæ²¡æ—¶é—´çš„è¯ï¼Œæˆ‘å¯ä»¥æŠŠæˆ‘å­¦ä¼šçš„éƒ½æ•™ç»™ä½ ã€‚æˆ‘è¿˜æ”¶é›†äº†å¥½å¤šèµ„æ–™å‘¢ã€‚ç´®æƒ‘æµ®å¹³æ—¶ä»ä¸è¯´å¥‰æ‰¿äººçš„è¯ï¼Œå¥¹ä»Šå¤©éƒ½è¯´ä½ èªæ˜ï¼Œé‚£æˆ‘æ”¶é›†çš„è¿™äº›èµ„æ–™å¯¹ä½ ä¸€å®šå¾ˆæœ‰ä½œç”¨ï¼Œæˆ‘è„‘è¢‹ç“œå­ç¬¨ï¼Œè‡ªå·±è¯»äº†è¿™äº›èµ„æ–™ä¹Ÿæ‚Ÿä¸å‡ºä»€ä¹ˆï¼Œè¿™ä¹ˆå¤šå¹´æ²¡å¤šå¤§è¿›æ­¥ï¼Œåªå­¦åˆ°äº†é£é€¸è€å¸ˆæ•™æˆ‘çš„ä¸€äº›çŸ¥è¯†ã€‚å¦‚æœä½ ä¸å«Œå¼ƒæˆ‘ï¼Œå¯ä»¥å’Œæˆ‘ä¸€èµ·ç ”ä¹ è¿™äº›èµ„æ–™ã€‚â€</p>
<p>å°ä¾ƒç¬‘å˜»å˜»çš„å°†æ˜“æ…§å¾€åä¸€æ‹‰ï¼Œå¯¹é›ªå¶è¯´é“ï¼šâ€œå¦‚æœä½ ä¸å«Œå¼ƒï¼Œæˆ‘ä¹Ÿæœ‰å¾ˆå¤šèµ„æ–™ï¼Œä¹Ÿå¯ä»¥å’Œæˆ‘ä¸€èµ·ç ”ä¹ å•Šï¼â€</p>
<p>é›ªå¶å¬åˆ°è¿™ä¸‰äººå¯¹è‡ªå·±è¿™ä¹ˆå¥½ï¼Œå¿ƒä¸­ååˆ†æ„ŸåŠ¨ï¼Œå¥¹æ¿€åŠ¨åœ°è¯´ï¼šâ€œæˆ‘å…ˆå‰ä»¥ä¸ºç™½é¾™ç­é‡Œä¸ªä¸ªéƒ½æ˜¯è‡ªç§çš„å°äººã€‚ä»Šå¤©ä¸ç®¡ä½ ä»¬ä¸‰äººæ˜¯å¯æ€œæˆ‘è¿˜æ˜¯çœŸå¿ƒå¸®æˆ‘ï¼Œæˆ‘éƒ½å¾ˆå¼€å¿ƒã€‚æœ‰ä½ ä»¬å¸®æˆ‘æˆ‘å°±å®‰å¿ƒäº†ã€‚â€</p>
<p>æœˆæ¹–è¯´ï¼šâ€œé›ªå¶å¦¹å¦¹ï¼Œå…‰æ˜¯æˆ‘ä»¬ä¸‰äººå¸®ä½ è¿˜æ˜¯ä¸å¤Ÿçš„ï¼Œä½ è¿˜æ˜¯è¦å¤šå¤šè¯·æ•™ç´®æƒ‘æµ®å’Œå‡Œç©†ï¼Œå¥¹ä»¬ä¿©å¯ä»¥æ•™ä½ å¾ˆå¤šå‡åˆ°äºŒçº§çš„ç»éªŒã€‚è¿˜å¥½ä½ æ˜¯åœ¨é£é€¸è€å¸ˆé—¨ä¸‹ï¼Œå¥¹ç°ä»Šé—¨ä¸‹å°±æœ‰ä¸¤ä¸ªäºŒçº§æˆå‘˜ï¼Œäºä½ çš„è¿›æ­¥æ¥è¯´çœŸæ˜¯å¤ªä¾¿åˆ©äº†ã€‚â€</p>
<p>æœˆæ¹–è¯´å®Œå¾€å‡Œç©†å¥¹ä»¬é‚£è¾¹çœ‹äº†ä¸€çœ¼ï¼Œå‡Œç©†è¯´ï¼šâ€œæˆ‘æ˜¯æ²¡æœ‰é—®é¢˜ï¼Œç´®æƒ‘æµ®éƒ½å½“ç€é£é€¸çš„é¢ç­”åº”æ•™å¥¹ï¼Œé‚£æˆ‘è¿™æ‹›â€˜è½»çµå¦‚èˆâ€™æ˜¯ä¸€å®šè¦è®©é›ªå¶å­¦ä¼šçš„äº†ã€‚â€</p>
<p>é›ªå¶é»˜é»˜ä¸è¯­ï¼Œä¸€ç‰‡æ²‰å¯‚ã€‚ç´®æƒ‘æµ®çœ‹é›ªå¶ä½å¤´ä¸è¯´è¯ï¼ŒçŸ¥é“å¥¹æ˜¯å› ä¸ºè‡ªå·±åªç­”åº”æ•™å¥¹ä¸€æ‹›è€Œä¸ç—›å¿«ã€‚</p>
<p>ç´®æƒ‘æµ®è¯´ï¼šâ€œé›ªå¶ï¼Œä½ ä¸ç”¨æ‹…å¿ƒã€‚é€‚æ‰æˆ‘å½“ç€é£é€¸çš„é¢ï¼Œè¯´åªæ•™ä½ ä¸€æ‹›ï¼Œæ˜¯å› ä¸ºæ€•è¯´å‡ºâ€˜ç»è‰²ä¸ƒå½©â€™éƒ½æ•™ç»™ä½ è¿™è¯ï¼Œé£é€¸ä¼šé˜»æ­¢æˆ‘ï¼Œå…¶å®å¤§å®¶éƒ½çœ‹å‡ºæ¥äº†ï¼Œé£é€¸ä¸æ˜¯å¾ˆæ„¿æ„æ•™ä½ ï¼Œä½†æˆ‘æ€ä¹ˆå¯èƒ½åªæ•™ä½ é‚£ä¸€æ‹›å‘¢ï¼Ÿå®é™…ä¸Šï¼Œâ€˜è½»çµå¦‚èˆâ€™è¿™æ‹›ç‰µæ¶‰é¢å¾ˆå¹¿ï¼Œå‡ ä¹æ¶‰åŠåˆ° â€˜ç»è‰²ä¸ƒå½©â€™å…¨éƒ¨æ‹›æ•°ã€‚åŸºäºè¿™ç‚¹ï¼Œæˆ‘å°†è¿™ä¸€å¥—æ‹›æ•°éƒ½æ•™ç»™ä½ ä¹Ÿä¸ä¸ºè¿‡ï¼Œæ—¢æ²¡æœ‰è¿èƒŒæˆ‘æ‰€ç­”åº”è€å¸ˆçš„ï¼Œä¹Ÿèƒ½å¤Ÿä½¿ä½ æŒæ¡â€˜ç»è‰²ä¸ƒå½©â€™å…¨éƒ¨å†…å®¹ã€‚åªæ˜¯æœ‰ç‚¹æˆ‘å¼„ä¸æ˜ç™½ï¼Œå°±æ˜¯ä¸ºä»€ä¹ˆé£é€¸è€å¸ˆä¸æ„¿æ•™ä½ å‘¢ï¼Ÿâ€</p>
<p>é›ªå¶å¼€å§‹å¬åˆ°ç´®æƒ‘æµ®è¯´æ„¿æ„æ•™å¥¹æ—¶ï¼Œå¿ƒä¸­é¡¿æ—¶å‡èµ·å‡ åˆ†æ¬¢å–œä¹‹æƒ…ï¼Œåå¬åˆ°ç´®æƒ‘æµ®é—®å¥¹é£é€¸ä¸ºä»€ä¹ˆä¸æ„¿æ•™å¥¹æ—¶ï¼Œå¿ƒä¸­ä¹Ÿè§‰å¾—ç–‘æƒ‘ï¼Œä¸€æ—¶ä¸çŸ¥å¦‚ä½•å›ç­”ã€‚</p>
<p>é›ªå¶éšå£è¯´ï¼šâ€œå¯èƒ½å¥¹çœŸçš„æ˜¯è§‰å¾—æˆ‘å®¶æ²¡æœ‰èƒŒæ™¯ï¼Œä¸åƒæš´å®¶é‚£æ ·æœ‰æƒæœ‰åŠ¿ï¼Œä»¥ä¸ºæˆ‘æ²¡æœ‰ä»€ä¹ˆåˆ©ç”¨ä»·å€¼å§ã€‚â€</p>
<p>ç´®æƒ‘æµ®å¬åè¿è¿æ‘‡æ‰‹ï¼Œå“ˆå“ˆç¬‘é“ï¼šâ€œè¿™å°±å¥½ç¬‘äº†ï¼Œæš´åªæ˜¯ä¸€ä¸ªè¢«æ²™è¥¿å¾·æ˜ŸæŠ›å¼ƒçš„å£«å…µè€Œå·²ï¼Œäººä»¬ä¹Ÿè®¸ä¼šè®¤ä¸ºå¥¹æ˜¯æ²™è¥¿å¾·æ´¾æ¥çš„å¥¸ç»†ï¼Œä½†æ˜¯ä½ æƒ³ï¼ŒæŠŠä¸€ä¸ªå¥¸ç»†æ”¾åœ¨è‡ªå·±çš„ç­é‡Œï¼Œåˆé‡ç‚¹åŸ¹å…»å¥¹ï¼Œé£é€¸è€å¸ˆä¸æ˜¯å¤ªå‚»äº†å—ï¼Ÿè¿™æ ·å§ï¼Œå°±ç®—æš´çœŸçš„å¦‚ä½ æ‰€è¯´å®¶é‡Œæœ‰æƒåŠ¿ï¼Œæœ‰åˆ©ç”¨ä»·å€¼ï¼Œé‚£æˆ‘å‘¢ï¼Ÿæˆ‘çˆ¶æ¯ååˆ†æ™®é€šï¼Œå°±æ˜¯å†¥æ˜Ÿé‡Œçš„ä¸€èˆ¬å±…æ°‘ï¼Œé‚£é£é€¸æ€ä¹ˆä¼šæ•™æˆ‘æ•™çš„é‚£ä¹ˆç—›å¿«ï¼Œè¿˜æœ‰å‡Œç©†ï¼Œæ˜“æ…§ï¼Œå°ä¾ƒç­‰ã€‚é™¤äº†å¯¹ä½ å¤–ï¼Œé£é€¸è€å¸ˆå¯¹å…¶ä»–äººéƒ½ååˆ†çƒ­å¿ƒï¼Œä»æ¥å¯¹è°éƒ½ä¸åå¿ƒï¼Œåœ¨ç™½é¾™ç­è¿™ç‚¹æ˜¯å…¬è®¤çš„ã€‚â€</p>
<p>é›ªå¶è¯´ï¼šâ€œæˆ‘çœ‹å¥¹ç°åœ¨å°±æ˜¯åå¿ƒã€‚å¥¹è®©å¤§å®¶åœ¨è¿™é‡Œçœ‹è¿™äº›æµ…æ˜¾çš„èµ„æ–™ï¼Œå´å•ç‹¬æ•™æš´é‚£äº›çœŸæ­£æœ‰ç”¨çš„çŸ¥è¯†ã€‚â€</p>
<p>å‡Œç©†ç«™èµ·æ¥è¯´é“ï¼šâ€œä½ æƒ³å¾—å¤ªå¤šäº†ï¼é›ªå¶ï¼Œä½ æ‰€è¯´çš„é‚£äº›æœ‰ç”¨çš„çŸ¥è¯†ï¼Œå…¶å®æˆ‘ä»¬è¿Ÿæ—©éƒ½ä¼šå­¦åˆ°çš„ã€‚é£é€¸ä¹‹æ‰€ä»¥ç°åœ¨å…ˆæ•™æš´ï¼Œè¿™ä¸ªæ˜¯å¥¹ç´ æ¥çš„ä¹ æƒ¯ã€‚å¯¹äºé‚£äº›å¥¹è‡ªå·±ç ”ç©¶å‡ºçš„çŸ¥è¯†ï¼Œå¥¹æ€»æ˜¯å…ˆæ•™ä¼šå¥¹è®¤ä¸ºæœ€æœ‰èµ„è´¨çš„å­¦ç”Ÿï¼Œç„¶åè®©è¿™ä¸ªå­¦ç”Ÿå»æ•™ç¨å·®çš„å­¦ç”Ÿï¼Œç¨å·®çš„å­¦ç”Ÿå†æ•™æ¯”è‡ªå·±è¿˜å·®çš„å­¦ç”Ÿã€‚å¦‚æ­¤å•å¯¹å•ç›¸ä¼ ï¼Œä¸€æ¥è¿™äº›ç²¾å¦™çš„çŸ¥è¯†å…ˆå­¦åˆ°çš„å­¦ç”Ÿèƒ½å¤Ÿå¾ˆæ¸…æ™°çš„ä¼ è¾¾ä¸‹å»ï¼›äºŒæ¥ï¼Œæƒ³å­¦è¿™äº›çŸ¥è¯†çš„å­¦ç”Ÿå­¦ä¹ å‰ä¼šå¯¹è¿™äº›çŸ¥è¯†å……æ»¡ç¥ç§˜æ„Ÿè€Œååˆ†åŠªåŠ›ï¼Œä»–ä»¬å­¦ä¹ çš„æ—¶å€™å°±èƒ½å¤Ÿæ¯”è¾ƒé›†ä¸­ç²¾åŠ›ï¼Œèƒ½å¤Ÿå‘æ„¤ç”¨åŠŸã€‚å…¶å®æˆ‘ä¹Ÿå’Œç´®æƒ‘æµ®æœ‰åŒæ ·çš„ç–‘é—®ï¼Œé‚£å°±æ˜¯ä¸ºä»€ä¹ˆé£é€¸ç¬¬ä¸€ä¸ªä¸æ•™ä½ ï¼Œåœ¨èµ„è´¨æ–¹é¢ä½ å¹¶ä¸å·®äºæš´ï¼Œæœ€é‡è¦çš„æ˜¯ï¼Œä½ æ¯”æš´è¦æ›´åŠ æ¸´æœ›è·å¾—è¿™ä»½çŸ¥è¯†ã€‚â€</p>
<p>é›ªå¶è¯´ï¼šâ€œé‚£ä½ è¯´è¿™æ˜¯ä¸ºä»€ä¹ˆã€‚â€</p>
<p>ç´®æƒ‘æµ®è¯´ï¼šâ€œæˆ‘ä»¬ä¹Ÿä¸çŸ¥é“ã€‚ä½†æˆ‘ä¸ªäººè§‰å¾—ï¼Œè¿™ä¸ªå¯èƒ½è·Ÿç±³ç”Ÿçš„çªç„¶æ¶ˆå¤±æœ‰å…³ã€‚â€</p>
<p>é›ªå¶ç¬æ—¶ä¸€æƒŠï¼Œè¯´ï¼šâ€œç±³ç”Ÿä¸æ˜¯å‡ºå»ç»™ç™½é¾™ç­åŠäº‹äº†å—ï¼Ÿâ€</p>
<p>å‡Œç©†å·å·åœ¨ç´®æƒ‘æµ®èƒŒåæäº†ä¸€æŠŠï¼Œç´®æƒ‘æµ®é©¬ä¸Šæ”¹å£è¯´ï¼šâ€œæ˜¯ï¼Œæ˜¯å»åŠäº‹äº†ï¼Œåªæ˜¯èµ°å¾—çªç„¶äº†ç‚¹ã€‚â€</p>
<p>é›ªå¶é—®é“ï¼šâ€œä½ ä»¬å€’æ˜¯å‘Šè¯‰æˆ‘ï¼Œç±³ç”Ÿä»–åˆ°åº•æ˜¯å»åŠä»€ä¹ˆäº‹äº†ï¼Ÿâ€</p>
<p>å‡Œç©†è¯´ï¼šâ€œæˆ‘ä»¬ä¹Ÿä¸çŸ¥é“ã€‚çŸ¥é“æ—©å°±å‘Šè¯‰ä½ äº†ã€‚â€</p>
<p>é›ªå¶ä½å¤´å¹äº†å£æ°”ï¼Œä½å£°å˜€å’•è¯´ï¼šâ€œæ€ä¹ˆè°éƒ½ä¸æ„¿å‘Šè¯‰æˆ‘â€¦â€¦è°éƒ½ä¸æ„¿å‘Šè¯‰æˆ‘â€¦â€¦â€å¥¹è¿™æ ·åå¤å˜€å’•ç€èµ°å‡ºäº†æˆ¿é—´ã€‚æœˆæ¹–å«äº†é›ªå¶å‡ å£°ï¼Œé›ªå¶éƒ½æ²¡æœ‰ç­”åº”ï¼Œæœˆæ¹–çŸ¥é“é›ªå¶æ­¤æ—¶è‚¯å®šå¯¹è°éƒ½ä¸ç›¸ä¿¡äº†ã€‚</p>
<h2 id="æœˆæ¹–å¾€äº‹"><a href="#æœˆæ¹–å¾€äº‹" class="headerlink" title="æœˆæ¹–å¾€äº‹"></a>æœˆæ¹–å¾€äº‹</h2><p>åæ¥å‡ å¤©æ—¶é—´ï¼Œéƒ½ä¸è§é›ªå¶åˆ°â€˜ç™½ç¾½å·â€™é‡Œæ¥ï¼Œæœˆæ¹–å››å¤„å¯»æ‰¾ï¼Œåœ¨ç™½é¾™ç­é‡Œæœäº†ä¸ªéï¼Œç™½é¾™åƒï¼Œåäººå ‚ï¼Œåœ£æ°´äº•ï¼Œæ‚¬ç©ºèˆå°ï¼Œè¿˜æœ‰å„ä¸ªç­çº§å’Œæ‰€æœ‰å­¦ç”Ÿä½æ‰€ã€‚å¥¹ä¹‹æ‰€ä»¥è¿™æ ·æ‹¼å‘½çš„æ‰¾é›ªå¶ï¼Œä¸æ˜¯ä¸ºäº†å»å±¥è¡Œæ•™é›ªå¶çš„çº¦å®šã€‚æœˆæ¹–çŸ¥é“é›ªå¶ä¹‹æ‰€ä»¥è¿™ä¹ˆè¿«åˆ‡çš„æƒ³å­¦ä¹ çŸ¥è¯†éƒ½æ˜¯ä¸ºäº†ç±³ç”Ÿï¼Œä¸ºäº†è®©ç±³ç”Ÿå¼€å¿ƒã€‚å†è¯´å¥¹è‡ªå·±çš„èƒ½åŠ›ä¹Ÿä¸å¯èƒ½å¯¹é›ªå¶æœ‰ä»€ä¹ˆå®è´¨çš„å¸®åŠ©ã€‚å¥¹æ‰¾é›ªå¶çš„ä¸»è¦åŸå› åªæ˜¯æƒ³å’Œé›ªå¶è°ˆè°ˆå¿ƒï¼Œä½†æ˜¯å‡ å¤©ä¸è§é›ªå¶ï¼Œå¥¹ä¾¿è¶Šå‘çš„æ‹…å¿ƒèµ·æ¥ã€‚</p>
<p>æœˆæ¹–å¾€ç™½é¾™å±±ä¸‹èµ°å»ï¼Œçªç„¶çœ‹è§è·¯è¾¹ä¸€ä¸ªæ—å­çš„å°æºªæ—ï¼Œä¸€ä¸ªå¥³å­æ­£ååœ¨æ°´ä»™èŠ±ä¸›ä¸­ã€‚æ°´ä»™èŠ±å¼€æ»¡äº†æ•´ä¸ªæ—å­ï¼Œé‚£å¥³å­çœ‹è¿™æ°´ä»™èŠ±ååˆ†ç¾ä¸½ï¼Œéšæ‰‹æ‘˜ä¸‹ä¸€æŸï¼Œæ‹¿åˆ°é¼»å°–ç»†é—»ã€‚æœˆæ¹–å¿«æ­¥èµ°åˆ°å¥¹èº«è¾¹ï¼Œä¸€æŠŠå°†å¥¹æ‰‹ä¸­çš„æ°´ä»™èŠ±å¤ºè¿‡æ¥ï¼Œé‚£å¥³å­ä¸€æŠ¬å¤´ã€‚æœˆæ¹–é«˜å…´åœ°è¯´é“ï¼šâ€œé›ªå¶ï¼Œæ€»ç®—æ‰¾åˆ°ä½ äº†ï¼è¿™èŠ±æœ‰æ¯’ï¼Œä½ çŸ¥é“å—ï¼Ÿâ€</p>
<p>é›ªå¶æ‰­è¿‡å¤´æ¥åé—®é“ï¼šâ€œè¿™ä¹ˆç¾çš„èŠ±æ€ä¹ˆä¼šæœ‰æ¯’å‘¢ï¼Ÿâ€</p>
<p>æœˆæ¹–è¯´ï¼šâ€œè¿™èŠ±æœ‰å¦‚é‡‘ç›é“¶å°ï¼Œé«˜é›…ç»ä¿—ï¼Œå©€å¨œå¤šå§¿ï¼Œæ¸…ç§€ç¾ä¸½ï¼Œæ¸…é¦™é¦¥éƒï¼Œæ´ç™½å¯çˆ±ã€‚ä½†æ˜¯å´æ˜¯æ¯’èŠ±ã€‚â€</p>
<p>é›ªå¶è¯´ï¼šâ€œæ€ä¹ˆä¼šæ˜¯è¿™æ ·å‘¢ï¼Ÿâ€</p>
<p>æœˆæ¹–è¯´ï¼šâ€œè¿™å¯ä¸æ˜¯æˆ‘ä¹±è¯´çš„ã€‚ä½ çœ‹ï¼Œè¿™èŠ±å’Œå¶çš„æ±æ¶²é‡Œå«çš„æ˜¯çŸ³è’œç¢±ï¼ŒçŸ³è’œç¢±æ˜¯ä¸€ç§æœ‰æ¯’ç‰©è´¨ï¼Œå¯¹äººä½“æœ‰å®³ï¼Œè§¦åˆ°å®ƒèƒ½ä½¿äººçš®è‚¤çº¢è‚¿ï¼›èŠ±èŒå†…å«æœ‰æ‹‰ä¸å¯æ¯’ç´ ï¼Œäººå—…åˆ°æˆ–åƒè¿›å®ƒä¼šå¼•èµ·å‘•åï¼Œè…¹æ³»ï¼Œç”šè‡³æ‰‹è„šå‘å†·ï¼Œè‡´äººä¼‘å…‹ï¼Œæ—¶é—´ä¸€é•¿ï¼Œäººä¼šå› ä¸­æ¢éº»é†‰æ­»äº¡ã€‚â€</p>
<p>é›ªå¶æ‰“äº†ä¸€ä¸ªå¯’é¢¤ï¼Œè¯´é“ï¼šâ€œè¿™ç—‡çŠ¶æˆ‘å¥½è±¡æœ‰è¿‡ã€‚æœˆæ¹–å§ï¼Œä½ æ‰¾æˆ‘å¹²å˜›ã€‚â€</p>
<p>æœˆæ¹–è¯´ï¼šâ€œé‚£æ—¶ç±³ç”Ÿç»™ä½ ä¸‹çš„æ¯’å°±æ˜¯è¿™æ°´ä»™èŠ±æ¯’ã€‚æˆ‘æ¥æ˜¯æƒ³æ‰¾ä½ è¯´è¯´è¯ã€‚â€</p>
<p>æœˆæ¹–çœ‹é›ªå¶ä¸è¯­ï¼ŒçŸ¥å¥¹ä¸æ„¿åˆ«äººæèµ·ç±³ç”Ÿä¸‹æ¯’ä¹‹äº‹ã€‚ç»§ç»­è¯´é“ï¼šâ€œé›ªå¶å¦¹å¦¹ï¼Œæˆ‘æƒ³è·Ÿä½ è¯´è¯´æˆ‘ä»¥å‰çš„äº‹ï¼Œä½ æƒ³å¬å¬å—ï¼Ÿâ€</p>
<p>é›ªå¶è½¬å¿§ä¸ºå–œåœ°è¯´é“ï¼šâ€œä½ çš„äº‹æˆ‘å½“ç„¶æƒ³å¬äº†ã€‚æˆ‘ä»¬å°±åœ¨è¿™é‡ŒèŠå§ï¼Œè¦èŠå¤šä¹…å°±å¤šä¹…ï¼Œåæ­£é£é€¸ç°åœ¨ä¹Ÿæ²¡æ‰“ç®—å°†ä»€ä¹ˆå¥½ä¸œè¥¿æ•™ç»™æˆ‘ï¼Œæˆ‘å»å’Œä¸å»â€˜ç™½ç¾½å·â€™éƒ½æ— æ‰€è°“äº†ã€‚â€</p>
<p>æœˆæ¹–å¼€å¿ƒåœ°è¯´é“ï¼šâ€œé‚£å¤ªå¥½äº†ã€‚â€</p>
<p>æ¥ç€æœˆæ¹–å¼€å§‹è¯´è‡ªå·±çš„å¾€äº‹ã€‚æœˆæ¹–è¯´é“ï¼šâ€œä½ ä¹ŸçŸ¥é“ï¼Œæˆ‘çˆ¶äº²æ˜¯å†¥æ˜Ÿè®®ä¼šçš„è®®å‘˜ã€‚æœ‰ä¸€å¤©æ™šä¸Šï¼Œæˆ‘çˆ¶äº²å°†æˆ‘å’Œæˆ‘çš„ä¸ˆå¤«çš“æœˆå«åˆ°èº«è¾¹ï¼Œé—®æˆ‘ä»¬å°ä¿©å£ï¼Œä½ ä»¬å¦‚æœç°åœ¨è¿‡çš„æ˜¯æ™®é€šå±…æ°‘çš„ç”Ÿæ´»ï¼Œæ„Ÿæƒ…ä¼šä¸ä¼šæœ‰å˜åŒ–ã€‚é‚£æ—¶çš„æˆ‘æ‰åå…«å²ï¼Œç”Ÿæ´»æ— å¿§æ— è™‘ï¼Œæ„Ÿæƒ…ä¸Šæµªæ¼«è°›å…‹ï¼Œè€Œä¸”çš“æœˆå¯¹æˆ‘æ— å¾®ä¸è‡³ï¼Œå…³çˆ±è‡³å¾®ï¼Œæˆ‘å½“ä¸‹æœæ–­å›ç­”çˆ¶äº²è¯´ï¼Œæ— è®ºç”Ÿæ´»å¤šä¹ˆè‰°éš¾ï¼Œæˆ‘å’Œçš“æœˆéƒ½ä¼šé•¿ç›¸å®å®ˆã€‚çˆ¶äº²çœ‹æˆ‘ååˆ†åšå®šï¼Œå°±è®©æˆ‘å’Œçš“æœˆæ¬å‡ºå®¶é—¨ï¼Œè®©æˆ‘ä»¬åˆ°åå°”è¾çš„å…ƒæœ”ç¤¾åŒºå»ç”Ÿæ´»ã€‚æˆ‘æœ¬æ¥å°±ä¸€ç›´çœ‹ä¸æƒ¯çˆ¶äº²çš„ä¸–ä¿—ä½œé£ï¼Œåˆè§‰å¾—è¿™ä¸€æ¬¡çˆ¶äº²æ˜¯è€ƒéªŒæˆ‘å’Œçš“æœˆçš„æ„Ÿæƒ…ï¼Œå› ä¸ºçš“æœˆå®¶å¢ƒä¸å¥½ï¼Œå’Œæˆ‘å®¶ä¸æ˜¯é—¨å½“æˆ·å¯¹ï¼Œæˆ‘ä¸€æ°”ä¹‹ä¸‹è¿é“åˆ«éƒ½æ²¡é“åˆ«ä¸€å£°å°±èµ°äº†ã€‚â€</p>
<p>é›ªå¶è¯´ï¼šâ€œè¿™ä¸¤å¹´æˆ‘ä¹Ÿå»åå°”è¾å‘†è¿‡ ï¼Œæ–‘å›½ç­ç¦»åå°”è¾å°±å¾ˆè¿‘ï¼Œä»¥å‰ä½ åœ¨åå°”è¾å“ªä¸ªç¤¾åŒºç”Ÿæ´»ï¼Ÿâ€</p>
<p>æœˆæ¹–è¯´ï¼šâ€œæˆ‘ä»å°ç”Ÿæ´»åœ¨åå°”è¾ï¼Œåå°”è¾åˆ†ä¸ºä¸œè¥¿å—åŒ—å››ä¸ªåŒºï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯åæ—¥ï¼Œå°”è¾°ï¼Œè¾æ­£ï¼Œå…ƒæœ”ã€‚â€˜åå°”è¾â€™è¿™ä¸‰å­—æ¥è‡ªè¿™å››ä¸ªåŒºå‰ä¸‰ä¸ªçš„å¼€å¤´ï¼Œè¿™è¯´æ˜å‰ä¸‰ä¸ªåŒºæ˜¯åå°”è¾çš„ä¸»è¦ç¤¾åŒºï¼Œå…¶æ’åå…ˆåé¡ºåºæ˜¯ï¼Œåæ—¥ç¬¬ä¸€ï¼Œç»æµæœ€å‘è¾¾ï¼Œåœ°å¤„åå°”è¾åŒ—éƒ¨ï¼Œæ”¿åºœæœºå…³å°±è®¾åœ¨é‚£ä¸ªåŒºã€‚å°”è¾°æ’ç¬¬äºŒï¼Œåœ°å¤„åå°”è¾è¥¿éƒ¨ï¼Œå•†ä¸šè¾ƒå‘è¾¾ï¼Œæœ‰å°‘é‡éƒ¨é˜Ÿé©»æ‰ã€‚è¾æ­£æ’ç¬¬ä¸‰ï¼Œæ˜¯åå°”è¾ä¸œéƒ¨çš„ä¸€ä¸ªåŒºï¼Œè¿™é‡Œä¸»è¦ä»¥æ–‡åŒ–å¨±ä¹ä¸ºä¸»ã€‚è¿™ä¸‰ä¸ªåŒºé‡Œèšé›†äº†å†¥æ˜Ÿé‡Œé‚£äº›æœ‰æƒæœ‰åŠ¿çš„äººã€‚åœ¨å—è¾¹æ˜¯å…ƒæœ”ï¼Œå®ƒæ˜¯åå°”è¾ä¸­æœ€è´«å›°çš„ä¸€ä¸ªåŒºï¼Œé‚£é‡Œçš„äººå¸¸å¹´ç”Ÿæ´»åœ¨ç¤¾ä¼šæœ€åº•å±‚ã€‚â€</p>
<p>é›ªå¶æ‚²ä¼¤çš„å›å¿†é“ï¼šâ€œæˆ‘å½“å¹´å°±æ˜¯ä½åœ¨å…ƒæœ”åŒºã€‚é‚£é‡Œçš„äººç‰¹åˆ«å¤šï¼Œé‡Œé¢ä½çš„äººå¤§éƒ¨åˆ†éƒ½ä¸æ˜¯åå°”è¾å’Œæ˜æœå­¦åºœçš„å±…æ°‘ï¼Œä»–ä»¬å‡ ä¹éƒ½æ˜¯å¤–æ¥ç§»æ°‘ã€‚åå°”è¾çš„ä¼ä¸šå®¶å’Œæ˜æœå­¦åºœçš„å¸ˆç”Ÿç»Ÿæ²»ç€å…ƒæœ”åœ°åŒºçš„äººæ°‘ï¼Œå…ƒæœ”åœ°åŒºå¯¹å¤–æ¥äººæ­§è§†ç°è±¡ä¸¥é‡ï¼Œèƒ½åšæŒç•™åœ¨é‚£é‡Œçš„å—æ­§è§†çš„äººéƒ½æ˜¯æ€•ä»è¿™é‡Œå›å»ä¸¢è„¸ï¼Œæˆ–è€…æœŸå¾…åœ¨è¿™é‡Œæ—©æ™šèƒ½å¤Ÿé‡ä¸Šä¸€ä¸ªå‡ºäººå¤´åœ°çš„æœºä¼šã€‚æœˆæ¹–å§ï¼Œåæ¥ä½ ä»¬åœ¨å…ƒæœ”é‚£é‡Œæ€ä¹ˆäº†ã€‚â€</p>
<p>æœˆæ¹–æ¥ç€è¯´ï¼šâ€œæˆ‘å…ˆæ‰¾äº†ä»½è¡Œæ”¿ç®¡ç†çš„å·¥ä½œï¼Œçš“æœˆæ‰¾äº†ä»½èµŒåœºå‘ç‰Œçš„å·¥ä½œã€‚åŠå¹´åï¼Œæˆ‘ä»å®¶é‡Œå¸¦å‡ºæ¥çš„åŒ–å¦†å“ï¼Œç‰™è†ï¼Œè¿˜æœ‰å„ç§æ—¥ç”¨å“éƒ½ç”¨å®Œäº†ï¼Œå¸¦çš„ä¸€äº›é’±ä¹Ÿå¿«ç”¨å®Œäº†ï¼Œç§Ÿä½çš„æˆ¿å­æ¢ä¸€ä¸ªæ¯”ä¸€ä¸ªå·®ã€‚æˆ‘çš„è„¾æ°”è¶Šæ¥è¶Šåï¼Œåœ¨å…¬å¸é‡Œç»å¸¸å¾—ç½ªäººï¼Œè„¾æ°”æ¥äº†ï¼Œæˆ‘å¯¹ä¸Šå¸ä¹Ÿä¸å°Šæ•¬äº†ï¼Œå·¥ä½œèŒä½ä¸å‡åé™ã€‚åœ¨å…¬å¸é‡Œæˆ‘æ„Ÿåˆ°æœ‰å¾ˆå¤šä¸å…¬å¹³ã€‚åªè¦æ˜¯æ˜æœå­¦åºœé‡Œå‡ºæ¥çš„äººè°éƒ½èƒ½å¤Ÿåšåˆ°é«˜å±‚ï¼Œå…¶ä»–çš„äººæƒ³çˆ¬ä¸Šå»ä¸‡åˆ†è‰°éš¾ã€‚åœ¨å…¬å¸ï¼Œæˆ‘ä»¥å‰é‚£å…»å°Šå¤„ä¼˜ã€éšä¾¿ä½¿å”¤åˆ«äººçš„æ€§å­æ— å¤„å‘æŒ¥ï¼Œå¿ƒé‡Œæ€»æ˜¯æ†‹å¾—æ…Œï¼Œå›åˆ°å®¶åæŠŠæ°”éƒ½å‘åˆ°çš“æœˆèº«ä¸Šã€‚çš“æœˆå·¥ä½œçš„èµŒåœºåœ¨ä¸œéƒ¨è¾æ­£ï¼Œæ¥å›è½¦è´¹å¾ˆè´µï¼Œä»–å·¥èµ„çš„ä¸‰åˆ†ä¹‹ä¸€éƒ½èŠ±åœ¨è½¦ä¸Šäº†ã€‚è€Œä¸”è·¯ä¸ŠèŠ±çš„æ—¶é—´é•¿ï¼Œæ¯æ™šéƒ½æ˜¯åç‚¹å¤šæ‰å›åˆ°å®¶ï¼Œå¦‚æœå¿™èµ·æ¥ï¼Œåˆå¤œè½¬é’Ÿåå›åˆ°å®¶æ˜¯å¸¸æœ‰çš„äº‹ã€‚çš“æœˆå°æ—¶å€™æ²¡æœ‰åƒè¿‡ä»€ä¹ˆè‹¦ï¼Œä½†æ˜¯å½“æ—¶ä»–ä¸ºäº†æˆ‘ï¼Œè¯´åšä»€ä¹ˆéƒ½æ„¿æ„ã€‚åœ¨èµŒåœºåšæœåŠ¡å·¥ä½œæ˜¯ååˆ†å±é™©çš„äº‹ï¼Œé‚£äº›æœ‰é’±çš„ä¸»å„¿ï¼Œèµ¢äº†é’±å°±èµç‚¹æœåŠ¡ç”Ÿï¼Œå¦‚æœè¾“äº†ï¼Œä¸è€çƒ¦èµ·æ¥ï¼Œå¯¹æœåŠ¡ç”Ÿåˆæ˜¯éª‚åˆæ˜¯æ‰“ï¼ŒèµŒåœºçš„ç»ç†ä¸€èˆ¬éƒ½ä¸ç®¡ã€‚è¾æ­£åœ°åŒºæ¥èµŒé’±çš„äººéƒ½æ˜¯å„ä¸ªæ˜Ÿçƒæœ‰å¤´æœ‰è„¸çš„äººï¼Œçš“æœˆæœ‰å¥½å‡ ä¸ªåŒäº‹éƒ½æ˜¯å› ä¸ºå—ä¸äº†è™å¾…ï¼Œæœ‰æ‰€åæŠ—ï¼Œç»“æœåœ¨å›å®¶è·¯ä¸Šè¢«äººå®³æ­»äº†ã€‚</p>
<p>â€œæˆ‘é‚£æ—¶åªé¡¾è‡ªå·±çš„æ„Ÿå—è€æ€§å­ï¼Œå¯¹çš“æœˆçš„å›°è‹¦å¤„å¢ƒä»æ¥éƒ½æ²¡æ”¾åœ¨å¿ƒä¸Šï¼Œåªè§‰å¾—è‡ªå·±ç”Ÿæ´»æ¡£æ¬¡èŠ‚èŠ‚ä¸‹è·Œï¼Œæ— æ³•é€‚åº”ï¼Œæ€ªä»–æ²¡èƒ½åŠ›è®©æˆ‘è¿‡ä¸Šå¥½ç”Ÿæ´»ã€‚å‡ å‘¨åæˆ‘è¢«å…¬å¸è§£é›‡äº†ï¼Œå›å®¶çš„è·¯ä¸Šæˆ‘é¦–å…ˆæƒ³åˆ°äº†æˆ‘çˆ¶äº²ï¼Œå½“æ™šï¼Œæˆ‘å°†å®¶é‡Œæ‰€æœ‰çš„é’±æ‹¿å»ä¹°äº†å¼ é£æœºç¥¨èµ¶å›çˆ¶æ¯å®¶ä¸­ã€‚ä¸€è¿›å®¶é—¨ï¼Œçœ‹è§å±‹å­é‡Œä¸€ç‰‡ç‹¼è—‰ï¼Œä¸œè¥¿å…¨è¢«ç¿»ä¹±äº†ï¼Œç»ç’ƒé¥°å“ï¼Œç“·å™¨èŠ±ç“¶ï¼Œéƒ½æ‰“ç¢äº†ã€‚åæ¥æˆ‘æ‰çŸ¥é“æ˜¯å› ä¸ºçˆ¶äº²æ‰€æ”¯æŒçš„å…šæ´¾è¢«å¦ä¸€å…šæ´¾å¤ºäº†æƒã€‚çˆ¶äº²ä¸ºäº†é¿éš¾ï¼Œç°åœ¨èº²äº†èµ·æ¥ã€‚åå¯¹æ´¾æ‰¾ä¸åˆ°äººï¼Œå°±æŠŠæˆ‘å®¶ç¿»äº†ä¸ªåº•æœå¤©ã€‚æˆ‘è¿™æ‰æ˜ç™½é‚£æ—¥çˆ¶äº²ä¸ºä½•å«æˆ‘å’Œçš“æœˆç¦»å¼€åæ—¥ï¼Œé¡¿æ—¶å¿ƒä¸­ååˆ†æ„Ÿæ¿€çˆ¶äº²ï¼Œè„‘æµ·é‡Œæµ®ç°å‡ºæˆ‘å’Œçˆ¶äº²ä¸€èµ·ç”Ÿæ´»æ—¶çš„ç‚¹ç‚¹æ»´æ»´ã€‚æƒ³åˆ°æˆ‘ä»¥å‰å¤ªæ·˜æ°”ï¼Œæ€»æ˜¯ä¸å¬çˆ¶äº²çš„è¯ï¼Œè¿å©šå§»å¤§äº‹ä¹Ÿä¸é¡¾çˆ¶äº²åå¯¹è‡ªå·²åšä¸»ï¼Œçˆ¶äº²è¯´çš„å¾ˆå¯¹ï¼Œçš“æœˆäººè™½å¥½ï¼Œä½†æ˜¯å´æ²¡æœ‰åšå¤§äº‹ä¸šçš„é£åº¦ï¼Œæ ¹æ®ç›®å‰æƒ…æ™¯æ¥çœ‹ï¼Œåªæ€•æˆ‘è¦è¿‡ä¸€è¾ˆå­è‹¦æ—¥å­äº†ã€‚æƒ³åˆ°è¿™é‡Œï¼Œæˆ‘å¼€å§‹åæ‚”å’Œçš“æœˆç»“å©šäº†ã€‚ä»¥å‰çˆ¶äº²èƒ½å¤Ÿä½¿æˆ‘ç”Ÿæ´»çš„æ— å¿§æ— è™‘ï¼Œæœ‰æ±‚å¿…åº”ï¼Œèƒ½è®©æˆ‘å‘¼é£å”¤é›¨ï¼Œæ— æ‰€ä¸èƒ½ã€‚æˆ‘çœŸæ˜¯ç”Ÿåœ¨ç¦ä¸­ä¸çŸ¥ç¦ï¼Œç°åœ¨è„±ç¦»äº†çˆ¶äº²ï¼Œæˆ‘ä¸€æ— æ‰€æœ‰äº†ã€‚</p>
<p>â€œæˆ‘é‡æ–°å›åˆ°å…ƒæœ”æˆ‘å’Œçš“æœˆä½çš„åœ°æ–¹ï¼Œå›åˆ°å®¶çš„æ—¶å€™ï¼Œæˆ‘çœ‹åˆ°çš“æœˆè¶´åœ¨æ¡Œå­ä¸Šç¡ç€äº†ï¼Œæˆ‘ç‹ ç‹ åœ°æ‰“äº†ä»–è„‘è¢‹ä¸¤æ¢¨å¼“ï¼Œè¯´ï¼šâ€œä½ ä¸å»ä¸Šç­å¾…åœ¨å®¶é‡Œç¡å¤§è§‰ï¼Œä½ æ‹¿ä»€ä¹ˆæ¥å…»æ´»æˆ‘å•Šï¼Ÿâ€æ¥ç€è¨€è¯­ä¸­æˆ‘ä¸çŸ¥ä¸è§‰åˆå°†ä»–å’Œæˆ‘çˆ¶äº²å¯¹æ¯”èµ·æ¥ï¼Œè¯´ä»–è¿™æ ·å­ä¸€è¾ˆå­ä¹Ÿä¸å¯èƒ½åšåˆ°æˆ‘çˆ¶äº²é‚£æ ·çš„æˆå°±ã€‚çš“æœˆè¿·è¿·ç³Šç³Šçš„çå¼€çœ¼ç›çœ‹ç€æˆ‘ï¼Œå¼€å§‹è§æˆ‘å›æ¥å¾ˆæ˜¯é«˜å…´ï¼Œåæ¥å¬æˆ‘è¶Šè¯´è¶Šæ°”ï¼Œå¯¹ä»–ååˆ†ä¸¥å‰ï¼Œå°±æ²¡æœ‰ä½œå£°ï¼Œåæ¥å¹²è„†æ‹¿èµ·çš®åŒ…ï¼Œç©¿ä¸Šå¤–å¥—åŒ†åŒ†èµ°å‡ºé—¨å»ã€‚åœ¨ä»–è½¬èº«çš„ä¸€ç¬é—´ï¼Œæˆ‘çœ‹è§ä»–è„¸è‰²ä¸å¥½ï¼Œçªç„¶æ„Ÿè§‰åˆ°ä»–æœ‰äº›ç”Ÿæ°”äº†ã€‚é‚£æ—¶æˆ‘å¾ˆæƒ³å«ä½ä»–ï¼Œå¯¹ä»–è§£é‡Šè¯´æˆ‘çš„å¿ƒæƒ…ä¸å¥½ï¼Œè¯·ä»–åŸè°…æˆ‘ã€‚å¯æ˜¯è™šè£å¿ƒå´è®©æˆ‘æ²¡æœ‰è¿™æ ·åšã€‚æˆ‘ç«™åœ¨é˜³å°ä¸Šï¼Œçœ‹ç€æ¥¼ä¸‹åˆšèµ°å‡ºå¤§é—¨çš„çš“æœˆï¼Œå¿ƒä¸­æœ‰ç§è¯´ä¸å‡ºçš„æ»‹å‘³ï¼Œè¿™æ—¶çš“æœˆçªç„¶æŠ¬å¤´çœ‹è§äº†æˆ‘ï¼Œè„¸ä¸Šéœ²å‡ºç¬‘å®¹ï¼Œä¸€ç‚¹æ²¡æœ‰æ€ªç½ªæˆ‘çš„æ„æ€ï¼Œçœ‹èµ·æ¥åƒæ˜¯åœ¨å‘Šè¯‰æˆ‘ï¼šâ€˜ä½ å›æ¥çœŸå¥½ï¼â€™æˆ‘ä»¬åˆšåˆ°å…ƒæœ”æ—¶ï¼Œä»–æ¯æ—¥å‡ºå»ä¸Šç­ï¼Œèµ°å‡ºå¤§é—¨éƒ½è¦æŠ¬å¤´å¾€é˜³å°ä¸Šçœ‹ä¸€çœ¼ã€‚é‚£æ—¶æˆ‘æ¯æ—¥éƒ½åœ¨é˜³å°ä¸Šçœ‹ç€ä»–èµ°å‡ºå¤§é—¨ï¼Œç„¶åæ…¢æ…¢èµ°è¿œï¼Œç›´åˆ°æ¶ˆå¤±çœ‹ä¸è§ï¼Œä¸¤äººæ€»æ˜¯ä¾ä¾ä¸èˆã€‚åæ¥å·¥ä½œå’Œç”Ÿæ´»çš„å‹åŠ›ï¼Œä½¿å¾—æˆ‘çš„è¿™äº›æ„Ÿæƒ…æ…¢æ…¢æ·¡è–„äº†ï¼Œä¸‰å‘¨åæˆ‘ä¾¿å†æ²¡æ¯å¤©å»é˜³å°é‚£ç›®é€ä»–å‡ºé—¨äº†ã€‚ç°ä¸‹æˆ‘çœ‹ç€ä»–ï¼Œä»–çœ‹ç€æˆ‘ï¼Œä¸€äººåœ¨é˜³å°ä¸Šï¼Œä¸€äººåœ¨æ¥¼ä¸‹é©¬è·¯ä¸Šã€‚æˆ‘æ„ŸåŠ¨äº†ï¼Œçœ¼æ³ªä¸è‡ªè§‰åœ°æµä¸‹æ¥ï¼ŒåŸæ¥è¿™åŠå¹´æ¥çš“æœˆä¸€ç›´éƒ½åœ¨ç­‰æˆ‘å‡ºç°åœ¨é˜³å°ä¸Šã€‚çš“æœˆçœ‹æˆ‘çœ¼æ³ªæµä¸‹ï¼Œä»–çš„çœ¼åœˆä¹Ÿæ¸æ¸çº¢äº†èµ·æ¥ï¼Œçªç„¶çŒ›ä¸€è½¬èº«å¤§è¸æ­¥çš„å‘è¿œå¤„èµ°å»ã€‚è¿™ä¸€è½¬èº«å¥½è±¡æ˜¯åœ¨å‘Šè¯‰æˆ‘ï¼Œæˆ‘çš„å›æ¥æ˜¯ä»–çš„æœ€å¤§æ»¡è¶³å’Œå¿«æ´»ï¼Œä»–å·²ç»ä¸å†ç”Ÿæ°”äº†ã€‚</p>
<p>â€œæˆ‘åˆå›åˆ°ä¸¥é…·çš„ç°å®ç”Ÿæ´»ä¸­æ¥äº†ã€‚æ¥ä¸‹æ¥çš„æ—¥å­é‡Œï¼Œæˆ‘åˆæ‰¾äº†å¥½å‡ æ¬¡å·¥ä½œï¼Œæ²¡æœ‰ä¸€ä»½å·¥ä½œèƒ½å¤Ÿè®©æˆ‘æ»¡æ„ã€‚ä»å°åˆ°å¤§å…»æˆçš„å°å§è„¾æ°”å®³äº†æˆ‘ï¼Œå°æ—¶è´ªç©çš„æˆ‘å¤±å»äº†å¾ˆå¤šå¥½çš„å­¦ä¹ æœºä¼šã€‚ä¸¥é…·çš„ç°å®ç”Ÿæ´»æ•™è‚²äº†æˆ‘ï¼Œæˆ‘æš—æš—ä¸‹å®šå†³å¿ƒï¼šå¦‚æœ‰æœºä¼šä¸€å®šè¦è¿›æ˜æœå­¦åºœï¼ŒåŠªåŠ›å­¦ä¹ è‡ªé£Ÿå…¶åŠ›çš„æœ¬é¢†ï¼Œä¹Ÿå¸Œæœ›è‡ªå·±å°†æ¥èƒ½å¸®çˆ¶äº²ä¸€æŠŠã€‚åæ¥ï¼Œçš“æœˆå·¥ä½œæ¸æ¸æœ‰äº†èµ·è‰²ï¼Œä»–å‡èŒæˆä¸ºå¤§å ‚ç»ç†ï¼Œä»–è™½ç„¶èµ„è´¨ä¸é«˜ï¼Œä½†ä»–ä¸ºäººè°¦æ­ï¼Œæ€§æ ¼æ¸©å’Œå´æ˜¯å¾ˆå¾—ä¸Šã€ä¸‹å±‚å–œæ¬¢ï¼Œè¿™å¯æ˜¯é‚£æ—¶æˆ‘æ‰€ä¸å…·æœ‰çš„ã€‚â€</p>
<p>é›ªå¶è¯´é“ï¼šâ€œå¯æ˜¯ä½ ç°åœ¨ä¸ºäººçƒ­æƒ…ã€æ€§æ ¼æ¸©å’Œå´æ˜¯å’Œé‚£æ—¶çš„çš“æœˆå“¥ä¸€æ ·äº†å•Šã€‚â€</p>
<p>æœˆæ¹–è¯´ï¼šâ€œæ˜¯çš„ï¼Œæˆ‘ç°åœ¨çš„å˜åŒ–å°±æ˜¯çš“æœˆå½±å“çš„ç»“æœã€‚â€</p>
<p>é›ªå¶è¯´ï¼šâ€œé‚£ä½ ä»¬åæ¥ç”Ÿæ´»å¥½èµ·æ¥äº†ï¼Œå¯¹å—ï¼Ÿç„¶åä½ å°±å®ç°äº†è‡ªå·±çš„æ„¿æœ›ï¼Œåˆ°ç™½é¾™ç­æ¥äº†ã€‚â€</p>
<p>æœˆæ¹–è¯´ï¼šâ€œèµ·åˆæ˜¯å¥½äº†ä¸€äº›ï¼Œå¯æ˜¯åæ¥çš“æœˆä¸ºå¸®åŠ©ä¸€ä¸ªä¸‹å±ï¼ŒèƒŒäº†é»‘é”…ï¼Œä¸å…‰å·¥ä½œæ²¡äº†ï¼Œè¿˜è¢«ç½šäº†é’±ã€‚æˆ‘åˆšæ„Ÿåˆ°ç”Ÿæ´»å¥½äº†äº›ï¼Œæ‰‹å¤´å®½æ¾ç‚¹ï¼Œèƒ½å¤Ÿä¹°ä¸Šå‡ ä»¶æ–°è¡£è£³äº†çš„æ—¶å€™ï¼Œå´å› ä¸ºä»–çš„å–„è‰¯åˆå«æˆ‘ä»¬çš„ç”Ÿæ´»ä¸‹äº†åœ°ç‹±ï¼Œæˆ‘ä¸ä½åœ°åŸ‹æ€¨ä»–ï¼Œç»å¸¸åœ°éª‚ä»–å‚»ï¼Œå¤©å¤©å‚¬ä¿ƒä»–å‡ºå»èµšé’±ï¼Œå¯¹ä»–çš„ä¸æ»¡ä¸€æ—¥ç”šäºä¸€æ—¥ã€‚çš“æœˆçš„çˆ¶æ¯å¹´è€å¤±å»äº†å·¥ä½œèƒ½åŠ›ï¼Œä¹Ÿå…¨é ä»–èµšé’±ç”Ÿæ´»ã€‚åœ¨åå°”è¾ï¼Œå¯¹æ¯ä¸ªäººçš„ä¿¡èª‰éƒ½æœ‰è®°å½•å’Œè¯„ä¼°ï¼Œå¹¶ä¸”è”ç½‘å…¬å¼€ã€‚ä»–èƒŒçš„è¿™ä¸ªé»‘é”…å½±å“äº†ä»–çš„ç¤¾ä¼šä¿¡èª‰ï¼Œåå°”è¾é‡Œå¥½ç‚¹çš„ä¼ä¸šåœ¨è˜äººçš„æ—¶å€™ä¸€æŸ¥ï¼Œçœ‹åˆ°çš“æœˆçš„ä¿¡èª‰åº¦å¾ˆä½å°±ä¸æ„¿æ‹›ä»–ï¼Œä»–åªå¾—åˆ°å…ƒæœ”åŒºé‡Œæ‰¾äº›æ¯”è¾ƒç²—é‡çš„æ´»å¹²ï¼Œæ¯”å¦‚åšæ¬è¿ä»€ä¹ˆçš„ã€‚ç”±äºæˆ‘çš„å·¥ä½œæ€åº¦å·®ï¼Œæˆ‘çš„ä¿¡èª‰åº¦ä¹Ÿæ¸æ¸é™ä½ï¼Œæå°‘æœ‰äººæ„¿æ„è˜æˆ‘åšäº‹ï¼Œåæ¥æˆ‘å¹²è„†å‘†åœ¨å®¶é‡Œä»€ä¹ˆä¹Ÿä¸åšäº†ã€‚å…¶å®æˆ‘ä»¬å½“æ—¶çš„é‚£ä¸ªå®¶å®Œå…¨ä¸èƒ½å¤Ÿç®—æ˜¯ä¸€ä¸ªå®¶ã€‚æœ€åç”±äºæ‹®æ®ï¼Œæˆ‘ä»¬åªå¾—æ¬åˆ°ä¸€ä¸ªç ´çƒ‚çš„ç”±é“çš®è½¦ç®±æ”¹æˆçš„æˆ¿é—´é‡Œå±…ä½ã€‚ä¸‹é›¨æ—¶å±‹é‡Œä¸œè¾¹åœ°ä¸Šæ”¾ä¸Šä¸€ä¸ªç›†ï¼Œè¥¿è¾¹åœ°ä¸Šæ”¾ä¸Šä¸€ä¸ªç¢—ï¼Œåˆ°å¤„æ¥æ¼é›¨ã€‚å¤œé—´é›¨æ¼æ»´ç­”æ»´ç­”çš„æƒ¹äººçƒ¦ï¼Œæ‰°äººç¡ã€‚å¦‚æœé‡åˆ°åˆ®é£å¤©ï¼Œé£åˆé€è¿‡é“çš®ç¼éš™å‘¼å•¸è¿›æ¥ï¼Œå†·ä¸è¯´ï¼Œå°–å•¸çš„é£å£°å°±åµå¾—äººç¡ä¸ç€ã€‚é‡åˆ°æ™´æœ—å¤©æ°”ï¼Œè¿™æˆ¿å­ç»å¤ªé˜³ä¸€æ™’ï¼Œåˆå˜æˆäº†ä¸€ä¸ªå¤§è’¸ç¬¼ï¼Œäººåœ¨é‡Œé¢çƒ­å¾—å–˜ä¸è¿‡æ°”æ¥ã€‚ä½åœ¨è¿™æ ·çš„æˆ¿å­é‡Œç®€ç›´æ˜¯åœ¨å—ç…ç†¬ï¼Œå“ªé‡Œè¿˜èƒ½æµªæ¼«èµ·æ¥ã€‚é‚£æ—¶æˆ‘æ—¥å¤œéƒ½åœ¨å›æƒ³è¿‡å»çš„æ—¥å­ï¼Œæƒ³ç€çˆ¶äº²å¯¹æˆ‘è¯´çš„è¯ï¼Œå¿ƒé‡Œåæ‚”æäº†ã€‚åæ¥æ¸æ¸æ ‘ç«‹ä¸€ä¸ªä¿¡å¿µï¼Œé‚£å°±æ˜¯å¬çˆ¸çˆ¸çš„è¯ï¼Œæ…é‡é€‰æ‹©ä¸ˆå¤«ï¼Œä¸è¦å…‰çœ‹é‚£äººçš„ä¸ºäººå¥½æˆ–æ€§æ ¼å¥½ï¼Œæ›´é‡è¦çš„æ˜¯è¦çœ‹ä»–æ˜¯å¦æœ‰èƒ½åŠ›ã€‚â€</p>
<p>é›ªå¶è¯´ï¼šâ€œçœŸæ²¡æœ‰æƒ³åˆ°ä½ ç«Ÿç„¶ä¹Ÿæœ‰è¿™æ ·çš„ç»å†ï¼Œå’Œæˆ‘çš„ç»å†å€’ä¹Ÿæœ‰å‡ åˆ†ç›¸åƒä¹‹å¤„ã€‚â€</p>
<p>æœˆæ¹–è‹¦ç¬‘é“ï¼šâ€œè™½ç„¶èº«å¤„çš„ç¯å¢ƒç±»ä¼¼ï¼Œä½†é‚£æ—¶æˆ‘çš„æ€æƒ³å´ä¸ä½ é‚£æ—¶å¤§ä¸ç›¸åŒã€‚åœ¨æˆ‘ä»¬ä½é“çš®å±‹çš„æ—¥å­é‡Œï¼Œçš“æœˆç™½å¤©åšçš„æ˜¯ç²—é‡çš„ä½“åŠ›æ´»ï¼Œæ¯å¤©ç´¯å¾—æ™šä¸Šä¸€å€’å¤´å°±ç¡ï¼Œä½†åˆ°åˆ®é£ä¸‹é›¨çš„æ™šä¸Šå¸¸è¢«é£å£°å’Œæ¼é›¨å£°åµé†’ï¼Œå±‹å­é‡Œåˆ°å¤„æ¹¿æ¼‰æ¼‰ã€‚ä¸‹è¿‡é›¨åï¼Œå±‹é‡Œçš„åœ°ä¸Šä»æ˜¯æ³¥æµ†ä¸€ç‰‡ã€‚è¢«å­å¸¸æ•£å‘å‡ºä¸€ç§å‘éœ‰æ°”å‘³ã€‚çš“æœˆç»ˆäºå¤§ç—…ä¸€åœºã€‚ä»¥å‰æˆ‘ä»å°è¯´æˆå‰§é‡Œçš„çˆ±æƒ…ç‰‡æ®µä¸­çœ‹åˆ°ï¼Œä¸€å¯¹æ‹äººæœ‰ä¸€äººç—…äº†ï¼Œå¯¹æ–¹æ€»æ˜¯å¯¹ä»–ç»†å¾®ç…§é¡¾ï¼Œä¸¤äººä»¥å‰å‘ç”Ÿçš„çŸ›ç›¾å°±åŒ–è§£äº†ï¼Œååˆ†æµªæ¼«ã€‚ä½†æ˜¯ç°å®ä¸­çš„æˆ‘çš„ä½“ä¼šå´æ˜¯é‚£ä¹ˆçš„ä¸åŒï¼Œä¸çŸ¥é“æ˜¯å› ä¸ºé‚£äº›ä¹¦å’Œæˆå‰§çš„ä½œè€…å¤ªè¿‡æµªæ¼«è¿˜æ˜¯ç°å®å¤ªæ®‹é…·ã€‚æ¯æ¬¡çœ‹ç€èººåœ¨é‚£ç”±ç¢ç –ç Œæˆçš„åºŠä¸Šçš„çš“æœˆæ—¶ï¼Œæˆ‘å¿ƒé‡Œä¸æ¯«æ²¡æœ‰é‚£ç§æ€œçˆ±çš„æ„Ÿè§‰ï¼Œå¿ƒé‡Œæ€»åœ¨åŸ‹æ€¨ä»–ä¸ºä»€ä¹ˆè¦ç—…ï¼Œæ€ä¹ˆä¸å¿«å¿«å¥½èµ·æ¥ï¼Œä½ å†ç—…ä¸‹å»ä¸èµ·æ¥æˆ‘å°±è¦é¥¿è‚šå­äº†ã€‚çš“æœˆä¸€æ—¦å¥½èµ·æ¥äº†ï¼Œä»–æ€»æ˜¯è¯´æœ‰æˆ‘åœ¨ä¸€æ—ç…§æ–™ï¼Œæ˜¯ä»–çš„ç¦æ°”ã€‚è¿™è¯æˆ‘å“ªé‡Œå½“å¾—èµ·å‘µï¼</p>
<p>â€œæˆ‘åˆåŸ‹æ€¨èµ·æˆ‘ä»¬ä½çš„é“çš®å±‹æ¥ï¼Œåˆšå¼€å§‹æˆ‘è¯´è¿™äº›åŸ‹æ€¨è¯æ—¶ï¼Œä»–æ€»æ˜¯åŠæˆ‘ä¸è¦å¿ƒæ€¥ï¼Œå®‰æ…°æˆ‘è¯´æ—¥å­æ€»ä¼šå¥½èµ·æ¥ã€‚æˆ‘ä¸ç›¸ä¿¡ä»–çš„è¯ï¼Œå¸¸å¸¸æ‹¿ä»–é‚£æ¬¡æ›¿åˆ«äººèƒŒé»‘é”…çš„äº‹æƒ…è®¥è®½ä»–ã€‚æ—¶é—´é•¿äº†ï¼Œæˆ‘å†å‘èµ·è„¾æ°”ï¼Œè¯´èµ·åŸ‹æ€¨è¯æ¥ï¼Œä»–å°±ä½ç€å¤´åœ¨ä¸€æ—åªæ˜¯å¹æ¯ï¼Œä¸å†è¯´é‚£äº›æœ‰å¸Œæœ›çš„è¯æ¥å®‰æ…°æˆ‘äº†ã€‚</p>
<p>â€œæˆ‘ä»¬çš„äº¤æµåœæ­¢äº†ï¼Œè¿åƒé¥­æ—¶ä¸¤äººéƒ½æ˜¯æ— è¨€ç›¸å¯¹ï¼Œå±‹å­é‡Œåªæœ‰æ¼é›¨å£°ã€é£å£°ã€ç¢—ç­·ç›¸ç¢°å£°ï¼Œå¼€é—¨å£°ã€å…³é—¨å£°ã€æ¸æ¸è¿œå»çš„è„šæ­¥å£°â€¦â€¦â€</p>
<p>é›ªå¶è¯´ï¼šâ€œæˆ‘é‚£ä¸ªæ—¶å€™å’Œä½ ä¸€æ ·ï¼Œç±³ç”Ÿä¸åœ¨æˆ‘èº«è¾¹çš„æ—¶å€™æˆ‘ä¹Ÿæ€»è§‰å¾—ç”Ÿæ´»ä¸­å¿½ç„¶æ²¡æœ‰äº†ä¸€ç‚¹ç”Ÿæœºï¼Œæ•´ä¸ªäººå°±åƒæ­»äº†ä¸€æ ·ã€‚ä½†æ˜¯åªè¦ä»–ä¸€æ¥åˆ°æˆ‘çš„ä½å¤„ï¼Œæˆ‘å¥½è±¡ç«‹é©¬åˆæ´»äº†è¿‡æ¥ã€‚ä»–åœ¨æˆ‘èº«è¾¹ç»™æˆ‘è®²å¤–é¢çœ‹åˆ°å¬åˆ°çš„è®¸è®¸å¤šå¤šæ–°é²œäº‹ï¼Œæˆ‘é©¬ä¸Šå°±ä¸è§‰å¾—å­¤å¯‚äº†ã€‚â€</p>
<p>æœˆæ¹–è§é›ªå¶è¿˜æ˜¯å¯¹ç±³ç”Ÿæ— æ³•å¿˜å´ã€‚å¥¹å¿ƒé‡Œæƒ³ï¼šâ€œç±³ç”Ÿé‚£æ—¶ç»™é›ªå¶è®²ä¸€äº›å¤–é¢çš„æ–°é²œäº‹å¹¶ä¸æ˜¯è¦å®‰æ…°å¥¹ï¼Œçƒ­æƒ…æ˜¯è£…å‡ºæ¥çš„ï¼Œå®é™…ä¸Šæ˜¯ä¸ºäº†æ©é¥°ä»–è‡ªå·±å¿ƒä¸­çš„ç½ªæ¶ã€‚è¿™äº›åœ¨ä»–çš„ç”µå­è®°äº‹æœ¬é‡Œä¸æ˜¯éƒ½æ¸…æ¸…æ¥šæ¥šåœ°å†™ç€å—ï¼Œé›ªå¶çœ‹äº†ä»–çš„ç”µå­è®°äº‹æœ¬ä¸ºä½•è¿˜è¦ç›¸ä¿¡ä»–çˆ±å¥¹ï¼Œå¯¹ä»–æ‹æ‹ä¸å¿˜å‘¢ï¼Ÿâ€<br />é›ªå¶ä¸çŸ¥æœˆæ¹–ä¸ºä»€ä¹ˆè¯´ç€è¯´ç€åœäº†ä¸‹æ¥ï¼Œå°±é—®é“ï¼šâ€œåæ¥æ€æ ·äº†ï¼Œä½ æ˜¯ä¸æ˜¯è§‰å¾—çš“æœˆä¸å¥½ï¼Œä¸æƒ³ä¸ä»–åœ¨ä¸€èµ·äº†å—ï¼Ÿâ€</p>
<p>æœˆæ¹–è¯´ï¼šâ€œæˆ‘é‚£æ—¶çš„ç¡®æœ‰è¿‡è¿™ä¸ªæƒ³æ³•ã€‚æˆ‘å½“æ—¶ç¦»å¼€æµ©æœˆï¼Œæ‰¾åˆ°æˆ‘ä»¥å‰ç»“äº¤çš„æœ‹å‹ï¼Œåœ¨å‡ ä¸ªæœ‹å‹å®¶æˆ‘åˆ†åˆ«ä½è¿‡ä¸€æ®µæ—¶é—´ï¼Œå¼€å§‹æ—¶ä»–ä»¬è¿˜ä»¥ç¤¼ç›¸å¾…ï¼Œä½†æ—¥å­ä¸€é•¿ï¼Œæˆ‘å°±æˆäº†æœ‹å‹çš„ç´¯èµ˜äº†ã€‚æˆ‘åœ¨ä¸€ä¸ªæœ€è¦å¥½çš„æœ‹å‹å®¶æ›¾ç»ä½äº†ä¸€ä¸ªå¤šæœˆï¼Œè™½ç„¶æœ‹å‹å¯¹æˆ‘ä¸€ç›´å¾ˆå¥½ï¼Œä½†åæ¥ç»ˆäºå› ä¸ºä»–çš„å®¶äººæ€ æ…¢äº†æˆ‘è€Œè‡ªè§‰æ²¡è¶£ç¦»å¼€ã€‚æˆ‘çš„é‚£äº›äº²æˆšä¹Ÿå› æˆ‘çˆ¶äº²ç°åœ¨çš„å¤„å¢ƒè€Œé¿å¼€æˆ‘ã€‚ç°åœ¨æƒ³åˆ°å½“æ—¶çš„æ™¯å†µæˆ‘è¿˜æ„Ÿåˆ°å¿ƒé…¸ï¼æƒ³æƒ³ä»¥å‰äº²æˆšæœ‹å‹å¯¹æˆ‘çš„æ¯•æ­æ¯•æ•¬ï¼Œæˆ‘åœ¨ä»–ä»¬é¢å‰æ— è®ºæ€æ ·è€æ€§å­ï¼Œä»–ä»¬å¯¹æˆ‘éƒ½æ˜¯ç™¾èˆ¬å¿è®©ï¼Œæˆ‘è¿˜ä»¥ä¸ºè¿™æ˜¯ç†æ‰€åº”å½“çš„äº‹ã€‚ç°ä¸‹æ‰æ˜ç™½é‚£éƒ½æ˜¯å› ä¸ºçˆ¶äº²çš„åœ°ä½å’Œä»–å¯¹æˆ‘å® çˆ±çš„æ€åº¦ï¼Œæ²¡æœ‰çˆ¶äº²åšé å±±ï¼Œæˆ‘ä¾¿ä¸€æ— æ‰€æœ‰ã€‚</p>
<p>â€œåœ¨æ²¡æœ‰äººæ„¿æ„å¸®æˆ‘çš„æƒ…å†µä¸‹ï¼Œæˆ‘åªå¾—åˆå›åˆ°äº†é‚£é“çš®å±‹ã€‚æˆ‘å›åˆ°é“çš®å±‹çš„æ—¶å€™ï¼Œçš“æœˆå·²ç»ç—…å€’äº†ï¼Œè€Œè¿™æ¬¡ä»–å®³çš„å´æ˜¯ä¸€åœºå¤§ç—…ã€‚å› ä¸ºè¿™æ®µæ—¶é—´æˆ‘ä¸åœ¨å®¶ï¼Œçš“æœˆç”Ÿæ´»ä¸Šæ²¡äººç…§é¡¾ï¼Œç—…äº†è¿˜æ˜¯å¼ºæ’‘ç€å¹²æ´»ï¼Œé•¿æœŸå’³å—½æ²¡æ²»ï¼Œç°åœ¨å’³å‡ºè‚ºç‚æ¥äº†ã€‚æˆ‘è¿™æ—¶ä¹Ÿæ²¡æœ‰äº†åŠæ³•ï¼Œæ‰¾äº²æœ‹å¥½å‹å€Ÿçš„é’±é©¬ä¸Šå°±è¦ç”¨å®Œï¼Œæˆ‘çœŸæ€•çš“æœˆä¼šè¿™æ ·æ­»æ‰ã€‚å¦‚æœçš“æœˆæ­»äº†ï¼Œæˆ‘ä»¥åçš„ç”Ÿæ´»æ€ä¹ˆè¿‡å•Šï¼é‚£æ™šï¼Œæˆ‘ç»æœ›çš„å“­äº†ï¼Œçš“æœˆä¹Ÿæµä¸‹äº†çœ¼æ³ªã€‚æˆ‘é‚£æ—¶å“­æ˜¯å› ä¸ºæ‹…å¿ƒè‡ªå·±å¤±å»ä¾é ï¼Œçš“æœˆä»–å“­å´æ˜¯ç—›æ¨è‡ªå·±æ²¡èƒ½è®©æˆ‘è¿‡ä¸Šå¥½æ—¥å­ã€‚</p>
<p>â€œç¬¬äºŒå¤©ï¼Œæ­£å¥½æ˜¯ä¸€å¹´ä¸€åº¦æ”¿å…šç«é€‰çš„æ—¥å­ï¼Œè¿™æ—¶ç¦»æˆ‘çˆ¶äº²å¼ƒå®¶å‡ºèµ°å·²æœ‰ä¸‰å¹´äº†ï¼Œè¿™ä¸‰å¹´ï¼Œæˆ‘å’Œçš“æœˆåœ¨ä¸€èµ·æ²¡æœ‰è¿‡ä¸Šä¸€å¤©çš„å¥½æ—¥å­ã€‚ä»¥å¾€å¯¹æ”¿æ²»æ¯«ä¸å…³å¿ƒçš„æˆ‘ï¼Œè¿™å¤©ä¹Ÿèµ°å‡ºå®¶é—¨ï¼Œæ¥åˆ°å¹¿åœºï¼Œç­‰å¾…çœ‹å¤§å±å¹•æ’­æ”¾ç«é€‰æƒ…å†µã€‚æˆ‘çœ‹åˆ°äº†ï¼Œçœ‹åˆ°äº†æˆ‘çš„çˆ¶äº²ï¼Œä»–å¸¦ç€ä»–çš„å‡ ååŒå…šæ­£æ„æ°”é£å‘çš„åœ¨é‚£é‡Œæ¼”è®²ã€‚æˆ‘èº«æ—ä¸€èµ·è§‚çœ‹å¤§å±å¹•çš„äººéƒ½åœ¨å…´è‡´å‹ƒå‹ƒåœ°è®®è®ºã€‚å¬ç€ä»–ä»¬çš„è®®è®ºï¼Œæˆ‘æ‰çŸ¥é“æˆ‘çš„çˆ¶äº²ä»–ä»¬ä¸ºäº†å¤ºå›æ”¿æƒï¼Œæ¸¸è¯´äº†æ˜æœå­¦åºœé‡Œå¾ˆå¤šåä¾µç•¥ç­çº§ï¼Œç­”åº”ç»™ä»–ä»¬å…µæƒï¼Œè°ƒé…äº†å¾ˆå¤šé›‡ä½£å…µç»™ä»–ä»¬ä½¿ç”¨ã€‚æ˜æœå­¦åºœåœ¨å†¥æ˜Ÿé‡Œæ”¯æŒç‡ç›¸å½“é«˜ï¼Œæœ‰å¥½å‡ ä¸ªåæˆ˜äº‰çš„ç­çº§éƒ½è¢«çˆ¶äº²è¯´æœï¼Œå†¥æ˜Ÿå±…æ°‘æœ‰äº†ä¸€äº›å®‰å…¨æ„Ÿã€‚çˆ¶äº²è¿™ä¸‰å¹´é‡Œå’Œå¥½å‡ ä¸ªå­¦åºœè€å¸ˆç»“äº¤æˆä¸ºæœ‹å‹ï¼Œé‚£äº›è€å¸ˆæ´¾å‡ºè‡ªå·±æœ€å¥½çš„å­¦ç”Ÿä¿æŠ¤æˆ‘çˆ¶äº²ä»–ä»¬ï¼Œå½“æƒå…šæ´¾çš„é‚£äº›äººå››å¤„è¿½æ€æ²¡æœ‰ç»“æœã€‚â€</p>
<p>é›ªå¶é—®é“ï¼šâ€œå½“æƒå…šæ´¾ä¸€å®šè¦è¿™æ ·åšå—ï¼Ÿâ€</p>
<p>æœˆæ¹–è¯´ï¼šâ€œæ­£æ˜¯ï¼Œè¿™æ ·åšæ˜¯å·©å›ºè‡ªå·±æ”¿æƒçš„éœ€è¦ã€‚â€</p>
<p>é›ªå¶è¯´ï¼šâ€œè¿™æ ·æ˜¯ä¸æ˜¯å¤ªæ— æ³•æ— å¤©äº†ã€‚â€</p>
<p>æœˆæ¹–è¯´ï¼šâ€œå½“ç„¶ä¸æ˜¯æ‰€æœ‰å½“æƒå…šæ´¾éƒ½æ˜¯è¿™æ ·ã€‚åªå› ä¸ºæˆ‘çˆ¶äº²ä»–ä»¬å…šæ´¾å¤ªå‘é„™ï¼Œæ€»æ˜¯é‡‡å–ä¸æ­£å½“æ‰‹æ®µè·å¾—ç«é€‰æˆåŠŸï¼Œæ‰€ä»¥ä»–ä»¬çš„å¯¹å¤´æ‰ä»¥å…¶äººä¹‹é“æ¥æ²»å…¶äººä¹‹èº«ã€‚â€</p>
<p>é›ªå¶é—®é“ï¼šâ€œé‚£è¿™æ¬¡ä½ çˆ¶äº²å¦‚æœç«é€‰æˆåŠŸï¼Œå½“æƒåä¸æ˜¯ä¹Ÿè¦å»è¿½æ€ä»¥å‰è¿½æ€ä»–çš„é‚£äº›äººå—ï¼Ÿâ€</p>
<p>æœˆæ¹–è¯´ï¼šâ€œä¾æˆ‘çˆ¶äº²çš„æ€§æ ¼ï¼Œä»–ä¼šè¿™ä¹ˆåšçš„ã€‚â€</p>
<p>é›ªå¶å¿½ç„¶æƒ³åˆ°äº†ä»€ä¹ˆï¼Œå¥¹çªç„¶é—®æœˆæ¹–ï¼šâ€œä½ çˆ¶äº²å«ä»€ä¹ˆåå­—ï¼Ÿâ€</p>
<p>æœˆæ¹–ç­”é“ï¼šâ€œä»–å«æœˆæ€ä¸¸ã€‚â€</p>
<p>é›ªå¶ä¸€æƒŠï¼Œä½å¤´è‡ªè¨€è‡ªè¯­é“ï¼šâ€œåŸæ¥æ˜¯ä»–ï¼Œä»–æ˜¯è®®å‘˜ï¼â€</p>
<p>æœˆæ¹–å¬é›ªå¶è¿™ä¹ˆè¯´ï¼Œé—®é“ï¼šâ€œä½ è®¤è¯†æˆ‘çˆ¶äº²ä¹ˆï¼Ÿâ€</p>
<p>é›ªå¶æ…Œå¿™æ©é¥°ï¼ŒæŠ¬å¤´ç­”é“ï¼šâ€œå“¦ï¼ä¸ï¼Œæˆ‘â€¦â€¦æˆ‘æ€ä¹ˆä¼šè®¤è¯†ä½ çˆ¶äº²é‚£æ ·çš„å¤§äººç‰©ï¼Ÿâ€</p>
<p>æœˆæ¹–çå¤§çœ¼ç›ï¼Œå¥‡æ€ªçš„çœ‹ç€é›ªå¶ï¼Œåªè§‰å¾—é›ªå¶ä»¿ä½›æœ‰ä»€ä¹ˆäº‹åœ¨ç’ç€å¥¹ã€‚</p>
<p>é›ªå¶ç§æœˆæ¹–è¿™èˆ¬çœ‹ç€è‡ªå·±ï¼Œæ„Ÿåˆ°ä¸è‡ªåœ¨ã€‚å¥¹è¯´ï¼šâ€œæ²¡äº‹ï¼Œä½ ç»§ç»­è¯´ï¼Œåæ¥ä½ å»è§ä½ çˆ¶äº²äº†å—ï¼Ÿâ€</p>
<p>æœˆæ¹–å¹äº†å£æ°”ï¼Œè¯´ï¼šâ€œå”‰ï¼åæ¥æˆ‘è‡ªç„¶æ˜¯å»æ‰¾çˆ¶äº²äº†ã€‚å½“æˆ‘æ‰¾åˆ°çˆ¶äº²çš„æ—¶å€™ï¼Œä»–çœ‹è§æˆ‘é¢é»„è‚Œç˜¦ï¼Œå¥½æ˜¯å¿ƒç–¼ã€‚ä»æ­¤æˆ‘ä»€ä¹ˆéƒ½å¬çˆ¶äº²å®‰æ’ï¼Œåæ¥å«ç»™äº†é‡‘å‘æœ¬å…‹æ˜Ÿä¸€åå¹´è½»æœ‰ä¸ºçš„è®®å‘˜ã€‚â€</p>
<p>é›ªå¶å¯¹çš“æœˆæ‹…å¿ƒèµ·æ¥ï¼Œæ…Œå¿™é—®é“ï¼šâ€œé‚£çš“æœˆå‘¢ï¼Ÿä»–åæ¥æ€æ ·äº†ï¼Ÿâ€</p>
<p>æœˆæ¹–è¯´ï¼šâ€œæˆ‘æ‰¾åˆ°çˆ¶äº²ä»¥åï¼Œå¾ˆä¹…éƒ½æ²¡å»é‚£é“çš®å±‹ã€‚â€</p>
<p>è¯´åˆ°è¿™é‡Œæœˆæ¹–çœ¼åœˆå¼€å§‹æ¹¿æ¶¦èµ·æ¥ã€‚ç»§ç»­è¯´é“ï¼šâ€œæˆ‘å«ç»™çš„é‚£ä¸ªé‡‘å‘è®®å‘˜å«å¤œå½±é£ï¼Œç›¸è²Œè‹±ä¿Šï¼Œå€œå‚¥æ½‡æ´’ï¼Œé«˜ç¿˜çš„é¼»æ¢ï¼Œè“è‰²å¤§çœ¼ç›ï¼Œæ˜¯è®¸å¤šå°‘å¥³å¿ƒä¸­çš„ç™½é©¬ç‹å­ã€‚è·Ÿçš“æœˆç›¸æ¯”ï¼Œæ— è®ºæ˜¯ç›¸è²Œè¿˜æ˜¯æ‰èƒ½éƒ½å¼ºä»–ä¸çŸ¥é“å¤šå°‘å€ã€‚æˆ‘å«ä»–ä¹‹åï¼Œåªèº«ä¸€äººæ¥åˆ°æœ¬å…‹æ˜Ÿï¼Œé™¤ä»–ä»¥å¤–ï¼Œæ— äº²æ— æ•…ã€‚å¤œå½±é£çœ‹æˆ‘æ•´æ—¥æ— èŠï¼Œæ€»æ˜¯æ‰¾æœºä¼šå’Œæˆ‘èŠå¤©ã€‚èŠå¤©ä¸»é¢˜æ€»æ˜¯ä»–ä»¬æœ¬å…‹æ˜Ÿé‡Œçš„ä¸€äº›å¥³å¼ºäººå¦‚ä½•ä¸ºå›½æ•ˆåŠ›çš„æ•…äº‹ï¼Œæˆ‘æ˜ç™½ä»–çš„æ„æ€ï¼Œæ˜¯å«æˆ‘æ•ˆä»¿å¥¹ä»¬ï¼Œä¸ºæœ¬å…‹æ˜Ÿå‡ºä»½åŠ›ã€‚æœ¬å…‹æ˜Ÿä»¥å‰å’Œæ²™è¥¿å¾·å’Œç‹±æ˜Ÿä¸€æ ·ï¼Œéƒ½æ˜¯çš‡æ—ç»Ÿæ²»çš„å›½å®¶ï¼Œä½†å­¦æœ¯ç§‘æŠ€å’Œç»æµå®åŠ›ä¸Šå´è¿œè¿œè½åäºä»–ä»¬ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæœ¬å…‹æ˜Ÿæœ‰å¾ˆå¤šæ€æƒ³å®¶å¿§å›½å¿§æ°‘ï¼Œä¸ºå›½å®¶æ‘†è„±è´«å›°ç§¯ææ¢ç´¢ã€‚ä»–ä»¬å½“æ—¶è®¤ä¸ºå†¥æ˜Ÿæ˜¯ä»–ä»¬æœ€å¥½çš„å­¦ä¹ å¯¹è±¡ï¼Œå°±è®¾æ³•å’Œå†¥æ˜Ÿæ”€äº²ã€‚åæ¥æˆ‘æ‰å‘è§‰ï¼Œæˆ‘çš„è¿™ä¸ªçœ‹ä¼¼åœ†æ»¡çš„å©šå§»åŸæ¥æ˜¯ä¸ªç›®çš„æ€§éå¸¸å¼ºçš„æ”¿æ²»å©šå§»ã€‚å¤œå½±é£å¨¶æˆ‘ï¼Œä¸€æ˜¯ä¸ºäº†å’Œå†¥æ˜Ÿç»“ä¸Šå§»äº²ï¼ŒäºŒï¼Œä¹Ÿæ˜¯æ›´é‡è¦çš„ï¼Œæ˜¯ä¸ºäº†ä»æˆ‘èº«ä¸Šè·å¾—æ›´å¤šçš„å†¥æ˜Ÿçš„å…ˆè¿›æ€æƒ³ã€‚ä½†ä»å°åˆ°å¤§ï¼Œæˆ‘å¯¹æ”¿æ²»ä»æ¥å°±æ²¡æœ‰å‘ç”Ÿè¿‡å…´è¶£ï¼Œè¦æˆ‘ç»™å¤œå½±é£å‡ºè°‹åˆ’ç­–ç®€ç›´éš¾äºä¸Šé’å¤©ã€‚</p>
<p>â€œå¤œå½±é£ä»æˆ‘èº«ä¸Šä¸èƒ½å¾—åˆ°ä»–æ‰€éœ€è¦çš„ä¸œè¥¿ï¼Œäºæ˜¯è§‰å¾—æˆ‘åº¸ä¿—ä¹‹æï¼Œç”±å¼€å§‹çš„çƒ­è¨€ç»†è¯­é€æ¸è½¬ä¸ºå†·è¨€å†·è¯­ï¼Œæœ€åå¹²è„†å°±ä¸å’Œæˆ‘è¯´è¯äº†ã€‚æˆ‘å¿ƒé‡Œå¾ˆä¸æ˜¯æ»‹å‘³ï¼Œä¹Ÿæ²¡è§‰å¾—è‡ªå·±æœ‰ä»€ä¹ˆä¸å¯¹ï¼Œå€’çœ‹å‡ºä»–å¨¶æˆ‘çš„çœŸæ­£ç›®çš„ï¼Œåªæ˜¯æƒ³åˆ©ç”¨æˆ‘ï¼Œå¯¹æˆ‘å¹¶æ²¡æ„Ÿæƒ…ã€‚å¤œé—´ï¼Œæˆ‘ä¸€ä¸ªäººç¡åœ¨é‚£é»‘é»‘çš„ã€çš‡å®«èˆ¬å®½å¤§çš„æˆ¿å­é‡Œï¼Œæœ›ç€é‚£å››æ ¹æ”¯æ’‘æˆ¿å­çš„å¤§æŸ±å­ï¼Œå¬ç€å±‹å¤–æµ·æ°´çš„æ¶›æ¶›å£°ï¼Œè§‰å¾—å­¤ç‹¬æäº†ã€‚</p>
<p>â€œæˆ‘å‡ºå«ä»¥åï¼Œçˆ¶äº²ç»™æˆ‘å‘æ¥è®¸å¤šä¿¡ï¼Œå†…å®¹éƒ½æ˜¯è¯¢é—®æœ¬å…‹æ˜Ÿçš„æƒ…å†µï¼Œæˆ‘ä¸€å°ä¹Ÿæ²¡å›å¤ã€‚è¿™äº›æ—¥å­ï¼Œæˆ‘ä¹Ÿæ‚Ÿå‡ºäº†çˆ¶äº²å«æˆ‘åˆ°æœ¨å…‹æ˜Ÿæ¥ï¼Œå¹¶ä¸åªæ˜¯ä¸ºæˆ‘å¥½ï¼Œä¹Ÿæœ‰ä»–è‡ªå·±çš„ç›®çš„ã€‚æˆ‘æ™šä¸Šå‡æœ›ç€å¤©ç©ºï¼Œä¸çŸ¥ä¸è§‰åœ°æƒ³èµ·çš“æœˆæ¥äº†ã€‚æˆ‘ä»”ç»†ç¢ç£¨ï¼Œåå¤å¯¹æ¯”ï¼Œçªç„¶æ„Ÿè§‰åˆ°ï¼Œæˆ‘æ´»åˆ°ç°åœ¨é‡åˆ°çš„äººä¸­åªæœ‰çš“æœˆå¯¹æˆ‘æœ€å¥½ï¼Œä»–å¾ˆæƒ³ç»™æˆ‘å¹¸ç¦ï¼Œä½†ä»–å´æ²¡æœ‰é‚£ç§èƒ½åŠ›ã€‚æ˜¯ä¸æ˜¯å¤©ä¸‹æ²¡æœ‰èƒ½åŠ›çš„ç”·å„¿éƒ½ä¼šå’Œçš“æœˆä¸€æ ·å¯¹æˆ‘å¥½å‘¢ï¼Ÿæˆ‘æ›¾ç»è¿™æ ·æƒ³ã€‚â€</p>
<p>é›ªå¶çªç„¶åƒæ˜ç™½äº†ä»€ä¹ˆä¼¼çš„ï¼Œå¿½ç„¶çªå¤§çœ¼ç›æœ›ç€æœˆæ¹–ï¼Œç„¶åé—®é“ï¼šâ€œä½ æ˜¯è¯´å½“å¹´ç±³ç”Ÿå¯¹ä½ å¥½ï¼Œæ˜¯å› ä¸ºä»–â€˜æ²¡æœ‰èƒ½åŠ›â€™ï¼Œå¯¹å—ï¼Ÿâ€</p>
<p>æœˆæ¹–æ˜¾å¾—å¾ˆå°´å°¬ï¼Œä»–ä¸å¥½æ„æ€åœ°è¯´ï¼šâ€œå“¦ï¼ä½ è¿˜çœŸçš„æ—¶æ—¶åˆ»åˆ»éƒ½æƒ³ç€ä»–å•Šã€‚â€</p>
<p>é›ªå¶å®³ç¾åœ°ä½ä¸‹å¤´ï¼Œå’§å˜´ä¸å¥½æ„æ€åœ°ç¬‘äº†ä¸€ä¸‹ã€‚</p>
<p>æœˆæ¹–çœ‹ç€å¦‚æ­¤ç—´æƒ…çš„é›ªå¶ï¼Œå¿ƒä¸­æ»¡æ˜¯æ„Ÿæ…¨ã€‚è¯´é“ï¼šâ€œæˆ‘çœŸç¾¡æ…•ä½ ã€‚å¦‚æœå½“æ—¶æˆ‘èƒ½å’Œä½ ä¸€æ ·ï¼Œå°±ä¸ä¼šé”™è¿‡çš“æœˆäº†ã€‚â€</p>
<p>é›ªå¶è¯´ï¼šâ€œä½ è¿˜æ²¡å‘Šè¯‰æˆ‘çš“æœˆå“¥åæ¥æ€æ ·äº†å‘¢ã€‚çš“æœˆå“¥æ˜¯ä¸ªå¥½äººï¼ŒçœŸå¸Œæœ›ä»–åæ¥èƒ½å¤ŸæŒ¯ä½œç²¾ç¥ï¼Œèµšåˆ°å¤§é’±æŠŠä½ è¿™ä¸ªæ‹œé‡‘å¥³å¨¶å›å»ã€‚â€</p>
<p>æœˆæ¹–å¬åˆ°é›ªå¶è¿™ä¹ˆä¸€è¯´ï¼Œâ€œå—¤â€çš„ä¸€å£°ç¬‘äº†å‡ºæ¥ã€‚è¯´é“ï¼šâ€œåœ¨æœ¬å…‹æ˜Ÿé‚£æ®µæ—¶é—´ï¼Œæˆ‘æ—¥å¤œéƒ½åœ¨å›å¿†ç€å’Œçš“æœˆä¸€èµ·çš„æ—¶å…‰ï¼Œæˆ‘æ¸æ¸å‘ç°ï¼Œçš“æœˆå¯¹æˆ‘çš„å¥½è®©æˆ‘æ°¸è¿œè®°å¾—ä»–ã€‚åæ¥å€Ÿå›å»çœ‹çˆ¶äº²çš„ç†ç”±ï¼Œæˆ‘å»äº†ä¸€è¶Ÿåå°”è¾ï¼Œèµ°åœ¨é€šå¾€ä»¥å‰æˆ‘ä»¬å±…ä½çš„é“çš®å±‹çš„é‚£æ¡å°è·¯ä¸Šï¼Œæˆ‘æ”¾çœ¼æœç´¢ï¼Œé“çš®å±‹å·²ç»ä¸åœ¨äº†ã€‚æˆ‘æƒ³ï¼Œå››å¹´äº†ï¼Œçš“æœˆå¯èƒ½å·²ç»æ”¹å˜äº†ç©·å›°çš„ç”Ÿæ´»ï¼Œç°åœ¨æœ‰èƒ½åŠ›ç»™æˆ‘å¹¸ç¦äº†ï¼Œè€Œæˆ‘å´æ— ç¦æ¶ˆå—äº†ã€‚æˆ‘æ²¿ç€è¿™é‚£æ¡å°è·¯å¾€å›èµ°ï¼Œé£å¹åŠ¨è·¯è¾¹çš„ç™½æ¨æ ‘ï¼Œå‘å‡ºâ€˜æ²™æ²™â€™çš„å£°éŸ³ï¼Œä»¿ä½›æ˜¯åœ¨å˜²ç¬‘æˆ‘ã€‚æˆ‘ä½å¤´èµ°ç€ï¼Œçœ‹ç€è·¯ä¸Šçš„ç¢çŸ³å­ï¼Œæƒ³ç€çš“æœˆæ¯å¤©è¸ç€è¿™äº›çŸ³å­ï¼Œæ›¾ç»ä¸ºäº†èƒ½å¤Ÿå…»æ´»æˆ‘ï¼Œæ‹¼å‘½æ¥å›å¥”æ³¢ã€‚å½“æˆ‘å†æ¬¡æŠ¬èµ·å¤´ï¼Œæœå°è·¯æ—é‚£æ¡å°æ²³å¯¹å²¸æœ›å»æ—¶ï¼Œçœ‹è§æœ‰ä¸€ä¸ªå­©å­æ­£åœ¨å’Œä»–çš„çˆ¶äº²å¬‰æˆï¼Œæ¯äº²ä¸€åŠ¨ä¸åŠ¨åœ°é—­ç›®ååœ¨æ²³è¾¹ã€‚è¿™æ—¶å°å­©ä¸€ä¸å°å¿ƒè·Œå€’åœ°ä¸Šï¼Œâ€˜å“‡â€™çš„ä¸€å£°å“­èµ·æ¥ï¼Œæ¯äº²é©¬ä¸Šç«™èµ·èº«ï¼Œä¼¸æ‰‹å‘å‰æ¢ç´¢ç€æœå°å­©å“­å£°ä¼ æ¥çš„æ–¹å‘å¥”å»ï¼Œçœ‹æ¥å¥¹æ˜¯åŒç›®å·²ç»å¤±æ˜ã€‚çˆ¶äº²è¿™æ—¶æ²¡æœ‰å»ç®¡é‚£å°å­©ï¼Œèµ¶ç´§è¿‡æ¥æ‰¶ä½ç›²äººæ¯äº²ä¸€èµ·æœå°å­©èµ°å»ã€‚æˆ‘æœ›ç€è¿™åœºé¢ï¼Œå¿ƒé‡Œæ„Ÿè§‰ååˆ†çš„ç”œèœœï¼Œä¼šå¿ƒåœ°ç¬‘äº†ç¬‘ï¼Œç»§ç»­å¾€å‰èµ°ã€‚èµ°äº†ä¸åˆ°ä¸€ç™¾ç±³è¿œçš„åœ°æ–¹ï¼Œæˆ‘çªç„¶çœ‹è§ä¸€ä¸ªéå¸¸ç†Ÿæ‚‰çš„é“å±‹ï¼Œè¿˜æ˜¯é‚£æ ·çš„ç ´æ—§ï¼Œä¸åŒçš„æ˜¯ç ´é“çš®å±‹é¡¶ä¸Šå¤šäº†äº›æœ¨å¤´å‹ç€çš„å¡‘æ–™è¢‹ã€‚â€</p>
<p>é›ªå¶å¬åˆ°è¿™é‡Œï¼ŒæŠ‘åˆ¶ä¸ä½å†…å¿ƒçš„æ¿€åŠ¨ï¼Œç«‹å³æ’å˜´é—®é“ï¼šâ€œæ˜¯ä½ å’Œçš“æœˆä½çš„é‚£ä¸ªé“çš®å±‹å—ï¼Ÿâ€</p>
<p>æœˆæ¹–è¯´ï¼šâ€œæ˜¯çš„ã€‚ä½†æˆ‘å½“æ—¶é©¬ä¸Šæƒ³åˆ°äº†é‚£ä¸€å®¶äººï¼Œé¡¿æ—¶æ˜ç™½è¿‡æ¥ã€‚æ€ªä¸å¾—é‚£ä¸ªçˆ¶äº²çš„ä¸¾æ­¢é‚£ä¹ˆç†Ÿæ‚‰ï¼Œé‚£ä¹ˆä»¤æˆ‘æ„ŸåŠ¨ï¼ŒåŸæ¥ä»–å°±æ˜¯çš“æœˆï¼Œåªæœ‰çš“æœˆé‚£æ ·çš„ç”·äººæ‰ä¼šé‚£æ ·ç»†å¿ƒï¼Œä¸€èˆ¬ç”·äººåœ¨æœ‰äº†å­å¥³åå¯¹å¦»å­å°±å¤§ä¸å¦‚å‰äº†ï¼Œä»–ä»¬çš„çˆ±éƒ½ä¼šè½¬ç§»åˆ°å­©å­èº«ä¸Šã€‚ä½†æ˜¯æˆ‘ç›¸ä¿¡çš“æœˆä¸ä¼šè¿™æ ·ï¼Œå­©å­è¹’è·šå­¦æ­¥ï¼Œæ‘”å€’ä¸€ä¸‹ä¸ä¼šæ€æ ·ï¼Œè€Œå¤±èªæ¯äº²çš„æ— æ‰€é€‚ä»æ‰æ˜¯çœŸæ­£å€¼å¾—å…³å¿ƒçš„ã€‚æˆ‘ç›¸ä¿¡é‚£ä¸ªçˆ¶äº²ä¸€å®šå°±æ˜¯çš“æœˆã€‚å½“æ—¶æˆ‘æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼Œä¸€ä¸ªå°±æ˜¯å’Œçš“æœˆç›¸è®¤ï¼ŒæŠŠçš“æœˆå¤ºå›æ¥ï¼›ä¸€ä¸ªå°±æ˜¯é™é™çš„ç¦»å¼€ï¼Œä¸å»æ‰“æ‰°ä»–ä»¬å¹³é™çš„ç”Ÿæ´»ã€‚â€</p>
<p>é›ªå¶å¿ä¸ä½é—®é“ï¼šâ€œä½ å’Œä»–ç›¸è®¤äº†ï¼Ÿâ€</p>
<p>æœˆæ¹–ç¬‘ç€è¯´ï¼šâ€œæ²¡æœ‰ï¼Œæˆ‘ç¦»å¼€äº†ã€‚æˆ‘è§‰å¾—æˆ‘å·²ç»å¾ˆå¯¹ä¸èµ·çš“æœˆäº†ï¼Œä»¥å‰ä»–å¯¹æˆ‘é‚£ä¹ˆå¥½ï¼Œæˆ‘å…¨ç„¶æ²¡å½“å›äº‹ã€‚æˆ‘çŸ¥é“ï¼Œæˆ‘å½“æ—¶è¯´çš„ä¸€äº›è¯å¯¹ä»–çš„ä¼¤å®³å¾ˆå¤§ï¼Œåœ¨ä»–æ‚£ç—…æœ€éœ€è¦æˆ‘ç…§é¡¾çš„æ—¶å€™ï¼Œæˆ‘ä¸å‘Šè€Œè¾ä¸€å®šå¯¹ä»–æ‰“å‡»æ²‰é‡ã€‚è€Œä¸”ç°åœ¨ä»–å·²ç»æœ‰äº†è‡ªå·±çš„å¹¸ç¦ç”Ÿæ´»ï¼Œæˆ‘ä¸èƒ½ç ´åï¼Œä¸ç„¶å¤ªå¯¹ä¸èµ·ä»–äº†ï¼Œå†è¯´æˆ‘å¤ºå›çš“æœˆï¼Œæ— ä¾æ— é çš„ç›²å¥³æ€ä¹ˆåŠï¼Ÿâ€</p>
<p>é›ªå¶ç¬‘ç€è¯´é“ï¼šâ€œä»é‚£æ—¶å€™å¼€å§‹ï¼Œä½ å¿ƒä¸­å®šæ˜¯ä¸€ç›´æ€€å¿µç€çš“æœˆï¼Œä½ ç°åœ¨æ€§æ ¼éƒ½æ¸æ¸å˜å¾—å’Œä»–ä¸€æ ·äº†ã€‚â€</p>
<p>æœˆæ¹–è¯´ï¼šâ€œæˆ‘å½“æ—¶å¾ˆæƒ³å†çœ‹çš“æœˆä¸€çœ¼ï¼Œæƒ³çœ‹çœ‹å¹¸ç¦æ—¶çš„çš“æœˆæ˜¯ä»€ä¹ˆæ ·çš„ï¼Œé‚£ä¸€å®šæ˜¯å¾ˆå¯çˆ±çš„å½¢è±¡ã€‚ä½†æˆ‘ç»ˆç©¶æ²¡æœ‰å‹‡æ°”è¿‡å»çœ‹ä»–ä¸€çœ¼ã€‚â€</p>
<p>é›ªå¶æ€¥äºçŸ¥é“ç»“æœï¼Œåˆèµ¶ç´§é—®é“ï¼šâ€œåæ¥å‘¢ï¼Ÿâ€</p>
<p>æœˆæ¹–è¯´ï¼šâ€œåæ¥æˆ‘å°±å†æ²¡å»é“çš®å±‹ï¼Œä¹Ÿæ²¡æœ‰å›é‡‘å‘æ˜Ÿã€æœ¬å…‹æ˜Ÿäº†ã€‚æˆ‘ä¹Ÿä¸æ„¿å¸®çˆ¶äº²åšäº‹ï¼Œçˆ¶äº²æ‹¿æˆ‘ä¹Ÿæ²¡åŠæ³•ã€‚åæ¥ï¼Œæˆ‘çœ‹çˆ¶äº²å·²ç»å¯¹æˆ‘ä¸è€çƒ¦äº†ï¼Œå°±è¯·æ±‚çˆ¶äº²é€æˆ‘å»æ˜æœå­¦åºœå­¦ä¹ ï¼Œä»–å°±çˆ½å¿«çš„ç­”åº”äº†ã€‚æ¥åˆ°ç™½é¾™ç­åï¼Œæˆ‘æ‰çŸ¥é“ä»–é€æˆ‘æ¥ä»æœ‰ä»–è‡ªå·±çš„æ„å›¾ã€‚â€</p>
<p>é›ªå¶é—®ï¼šâ€œæ˜¯ä»€ä¹ˆæ„å›¾å‘¢ï¼Ÿâ€</p>
<p>æœˆæ¹–è¯´ï¼šâ€œç™½é¾™ç­ä¸´è¿‘åå°”è¾ï¼Œå¦‚ä»Šç¯ç»•åå°”è¾çš„æ˜æœå­¦åºœå·²ç»è¢«æ²™è¥¿å¾·å’Œç‹±æ˜Ÿéƒ¨é˜ŸæŠ¢å äº†ä¸‰åˆ†ä¹‹äºŒçš„åœ°ç›˜ã€‚è®¸å¤šåä¾µç•¥çš„ç­çº§éƒ½å’Œæ²™ã€ç‹±å†›ç­¾è®¢äº†æŠ•é™æ¡çº¦ï¼Œæ”¯æŒå†¥æ˜Ÿæ”¿åºœçš„å­¦åºœç­çº§è¶Šæ¥è¶Šå°‘äº†ã€‚ç™½é¾™ç­ä¸€ç›´ä¿æŒä¸­ç«‹ï¼Œè€Œä¸”å®åŠ›å¾ˆå¼ºï¼Œçˆ¶äº²æ˜¯æƒ³é€šè¿‡æˆ‘æ¥å½±å“ç™½é¾™ç­é‡Œçš„è€å¸ˆï¼Œä½¿ç™½é¾™ç­èƒ½å¤Ÿä»ä¸­ç«‹ç«‹åœºè½¬å‘å¸®åŠ©å†¥æ˜Ÿæ”¿åºœå¯¹æŠ—å¤–æ˜Ÿæ•Œäººã€‚â€</p>
<p>é›ªå¶å¬åˆ°è¿™é‡Œï¼Œæ„Ÿæ…¨åœ°è¯´ï¼šâ€œè¯´æ¥è¯´å»ï¼Œä½ çˆ¶äº²å¿ƒä¸­æƒ³çš„éƒ½æ˜¯å†¥æ˜Ÿæ”¿åºœå•Šã€‚ä»–è¿™ä¸ªäººè¿˜çœŸæ˜¯â€¦â€¦â€</p>
<h2 id="é›ªå¶ä¹‹è°œ"><a href="#é›ªå¶ä¹‹è°œ" class="headerlink" title="é›ªå¶ä¹‹è°œ"></a>é›ªå¶ä¹‹è°œ</h2><p>æœˆæ¹–å¬é›ªå¶è¯´è¯å£°éŸ³è¶Šæ¥è¶Šå°ï¼Œè§‰å¾—å¾ˆå¥‡æ€ªã€‚çªç„¶å¬è§è¿œå¤„ä¼ æ¥è¯´è¯å£°ã€‚æœˆæ¹–è½¬èº«é¡ºæ‰‹å°†é›ªå¶æ‹‰ä½å¾€ä¸‹ä¸€æŒ‰ï¼Œä¸¤äººä¼åœ¨èŠ±ä¸›ä¸­ï¼Œçœ‹è§è¿œå¤„ä¸€è¡Œäººæ­£å‘é›ªå¶ä½çš„æˆ¿å­èµ°æ¥ã€‚è¿™ä¸€è¡Œäººè¶Šèµ°è¶Šè¿‘ï¼Œä¸€è¾¹èµ°è¿˜ä¸€è¾¹åœ¨è°ˆè®ºç€ä»€ä¹ˆã€‚æ¸æ¸åœ°çœ‹æ¸…æ¥šäº†ï¼ŒåŸæ¥ä»–ä»¬å¤§éƒ¨åˆ†éƒ½æ˜¯ç™½é¾™ç­çš„è€å¸ˆã€‚</p>
<p>å¾…è€å¸ˆä»¬èµ°è¿œï¼Œæœˆæ¹–é—®é›ªå¶ï¼šâ€œä»–ä»¬å»ä½ é‚£é‡Œå¹²ä»€ä¹ˆï¼Ÿâ€</p>
<p>é›ªå¶è¯´ï¼šâ€œæˆ‘ä¹Ÿä¸çŸ¥é“ã€‚ä¸ä¼šæ˜¯æ‰¾æˆ‘æœ‰äº‹å§ï¼Ÿâ€</p>
<p>æœˆæ¹–è¯´ï¼šâ€œä½ ä¸è¿‡åªæœ‰å‡ å¤©æ²¡åˆ°ç­ä¸Šæ¥ï¼Œç­è§„è¿˜æ²¡é‚£ä¹ˆä¸¥ï¼›å†è¯´å°±ç®—æ˜¯æ‰¾ä½ ï¼Œé£é€¸ä¸€ä¸ªäººä¹Ÿå¤Ÿäº†ï¼Œæ²¡å¿…è¦è¿™ä¹ˆå…´å¸ˆåŠ¨ä¼—çš„å§ã€‚â€</p>
<p>é›ªå¶è¯´ï¼šâ€œæ²¡æƒ³åˆ°ç™½é¾™ç­ä¼šè¿™ä¹ˆçœ‹é‡æˆ‘ï¼â€</p>
<p>æœˆæ¹–è¯´ï¼šâ€œæˆ‘çœ‹äº‹æƒ…æ²¡é‚£ä¹ˆç®€å•ã€‚ä¸ºä»€ä¹ˆä¸€ä»¶äº‹è¦ä¸€ç¾¤äººå»åšï¼Ÿé‚£æ˜¯å› ä¸ºé‚£ä»¶äº‹ä¸€ä¸ªäººå®Œæˆä¸äº†ã€‚å¦‚æœä»…ä»…æ˜¯æ‰¾ä½ æœ‰äº‹åŠæˆ–æœ‰è¯è¯´ï¼Œå“ªæœ‰å¿…è¦ä¸€ç¾¤äººä¸€èµ·åˆ°ä½ å®¶æ¥ï¼Œæ›´ä½•å†µè¿™ç¾¤äººä¸æ˜¯ä¸€èˆ¬äººï¼ŒåŸºæœ¬éƒ½æ˜¯ç™½é¾™ç­çš„é¢†å¯¼è€…å•Šï¼â€</p>
<p>é›ªå¶é•‡é™è‡ªè‹¥ï¼Œç¬‘ç€å›ç­”æœˆæ¹–è¯´ï¼šâ€œå“ˆå“ˆï¼Œéš¾é“ä»–ä»¬æ€•æˆ‘ä¸æˆï¼Ÿâ€</p>
<p>æœˆæ¹–æ…Œå¿™è§£é‡Šè¯´ï¼šâ€œæˆ‘ä¸å°±æ˜¯ä¸æ¸…æ¥šæ˜¯æ€ä¹ˆå›äº‹ï¼Œæ‰æ‹…å¿ƒä½ ä¹ˆï¼Ÿèµ°ï¼æˆ‘ä»¬è·Ÿè¿‡å»çœ‹ä¸ªç©¶ç«Ÿã€‚â€</p>
<p>è¯´å®Œèµ·èº«å°±è¦èµ°ã€‚é›ªå¶ä¼¸æ‰‹å°†å¥¹æ‹‰ä½ï¼Œè¯´ï¼šâ€œä½ åˆšæ‰è·Ÿæˆ‘è®²çš„ä½ çš„æ•…äº‹è¿˜æ²¡è®²å®Œå‘¢ã€‚â€</p>
<p>æœˆæ¹–å›å¤´è¦æ‹¿å¼€é›ªå¶æ‹‰å¥¹çš„æ‰‹ï¼Œé›ªå¶ç¬‘ç€æ²¡æ¾æ‰‹ã€‚æœˆæ¹–æœ‰äº›ä¸è€çƒ¦åœ°è¯´é“ï¼šâ€œé›ªå¶å¦¹å¦¹ï¼Œæˆ‘çŸ¥é“ä½ æ˜¯æƒ³çŸ¥é“æˆ‘å’Œç±³ç”Ÿçš„äº‹æƒ…ï¼Œä½†æ˜¯ç°åœ¨æˆ‘å‘Šè¯‰ä½ ï¼Œæˆ‘è§‰å¾—è¿™ç¾¤è€å¸ˆæœ‰äº›ä¸å¯¹åŠ²ï¼Œä»Šå¤©è¿™ä¸€è¡Œäººæ¥æ‰¾ä½ ï¼Œå¾ˆå¯èƒ½æ˜¯å¯¹ä½ ä¸åˆ©ã€‚â€</p>
<p>é›ªå¶æ¾äº†æ‰‹ç¬‘é“ï¼šâ€œæˆ‘åˆæ²¡åšä»€ä¹ˆäºå¿ƒäº‹ï¼Œæˆ‘æ‰ä¸æ€•ä»–ä»¬å¯¹æˆ‘ä¼šæœ‰ä»€ä¹ˆä¸åˆ©å‘¢ï¼â€</p>
<p>æœˆæ¹–è¯´ï¼šâ€œä½ ä¸çŸ¥é“ï¼Œæœ€è¿‘å¤§å®¶éƒ½åœ¨è®®è®ºé£é€¸è€å¸ˆå’Œä½ çš„äº‹ã€‚ä½ æ¥ç™½é¾™ç­åï¼Œé£é€¸å°±å¾ˆåå¸¸ï¼Œæœ‰æ—¶è®²è¯¾çš„æ—¶å€™ï¼Œçªç„¶åœä¸‹æ¥å‘å‘†ï¼Œæˆ‘ä»¬çœ‹å¥¹çš„ç¥æ€ï¼Œå‘ç°å¥¹æ˜¯åœ¨è§‚å¯Ÿä½ ã€‚â€</p>
<p>å¬äº†æœˆæ¹–è¿™ç•ªè¯ï¼Œé›ªå¶æ‚ç€å˜´ç¬‘èµ·æ¥ï¼Œå¥¹è¯´ï¼šâ€œæ˜¯ä¸æ˜¯å› ä¸ºæˆ‘é‚£æ—¶ç¡ç€äº†ã€‚â€</p>
<p>æœˆæ¹–è¯´ï¼šâ€œä¸æ˜¯ï¼Œä»¥å‰æœ‰äººç¡è§‰å¥¹ä»ä¸ç®¡ã€‚å¤§å®¶æ„Ÿè§‰åˆ°å¥¹å¥½åƒå¤„å¤„èº²ç€ä½ ä¼¼çš„ï¼Œæˆ‘ä»¬å¤§å®¶å¾ˆå¥‡æ€ªï¼šåƒä½ è¿™æ ·èªæ˜æœ‰æ‰çš„å­¦ç”Ÿï¼Œå¥¹ä¸ºä»€ä¹ˆä¸æ„¿æ•™å‘¢ï¼Ÿè¿˜æœ‰ï¼Œè‡ªä»ä½ æ¥ç™½é¾™ç­ä»¥åï¼Œæ¯æ¬¡è®²å®Œè¯¾åï¼Œä¸€ç›´åˆ°æ™šä¸Šæˆ‘ä»¬å¤§å®¶éƒ½å†ä¹Ÿæ‰¾ä¸åˆ°å¥¹äº†ã€‚â€</p>
<p>é›ªå¶æ„Ÿåˆ°äº†äº‹æƒ…çš„ä¸¥é‡ï¼Œè„¸ä¸€æ²‰ï¼Œä½å£°è¯´é“ï¼šâ€œéš¾é“å¥¹ä¸€ç›´åœ¨è·Ÿè¸ªæˆ‘ï¼â€</p>
<p>æœˆæ¹–å¿ƒé‡Œä¸€æƒŠï¼šâ€œå•Šï¼ä»€ä¹ˆï¼Ÿâ€</p>
<p>é›ªå¶è¯´ï¼šâ€œä»–ä»¬å‰å»çš„æ–¹å‘å°±æ˜¯æˆ‘ä½çš„æˆ¿å­å•Šã€‚â€</p>
<p>æœˆæ¹–å¿™è¯´ï¼šâ€œé‚£ä»Šå¤©ä»–ä»¬æ›´æ˜¯å¯ç–‘äº†ã€‚æˆ‘ä»¬èµ¶å¿«è·Ÿä¸Šå»ï¼â€</p>
<p>é›ªå¶ç‚¹ç‚¹å¤´ã€‚å¥¹ä»¬ä¿©èµ¶å¿«å°¾è¿½ä¸Šå»ã€‚é€”ä¸­é›ªå¶æ²¡æœ‰å†é—®æœˆæ¹–ä»€ä¹ˆï¼Œæœˆæ¹–è¶Šå‘æœ‰äº›æ‹…å¿ƒèµ·æ¥ã€‚</p>
<p>ä¸€è¾¹æœå‰èµ¶è·¯ï¼Œæœˆæ¹–ä¸€è¾¹å°å£°å¯¹é›ªå¶è¯´ï¼šâ€œç±³ç”Ÿå¼€å§‹å¯¹æˆ‘å¾ˆç—´æƒ…ï¼Œæˆ‘è¿˜ä»¥ä¸ºæ˜¯è€å¤©å«çš“æœˆå†ä¸–å‘¢ï¼å¼€å§‹æ—¶æˆ‘ç»™ä»–é’±ç”¨ï¼Œä»–å°±ç”¨æˆ‘çš„é’±ä¹°äººæ•™ä»–å­¦ä¹ ä¸€äº›åŠŸå¤«çš„æ‹›å¼ï¼Œä½†æ˜¯å´å¸¸å¸¸è¢«éª—ã€‚å¥½æ™¯ä¸é•¿ï¼Œæˆ‘çˆ¶äº²åæ¥çœ‹æˆ‘åœ¨ç™½é¾™ç­ä¾ç„¶æ²¡æœ‰å¸®ä»–çš„æ„æ€ï¼Œä¸€æ°”ä¹‹ä¸‹æ–­äº†æˆ‘çš„ä¾›ç»™ã€‚æˆ‘å†æ²¡é’±ç»™ä»–ç”¨äº†ï¼Œè¿™æ—¶æˆ‘æ‰çœ‹åˆ°ç±³ç”Ÿçš„çœŸé¢ç›®ã€‚ä»–ä¸€æ‹¿ä¸åˆ°é’±ï¼Œå°±è¯´æˆ‘ä»¬æœ‰é’±äººå°æ°”ï¼Œåæ¥åˆæ€ªæˆ‘æ˜¯æŠŠé’±ç»™æˆ‘å‰å¤«äº†ã€‚æˆ‘æ²¡æœ‰å¯¹ä»–è§£é‡Šä»€ä¹ˆï¼Œæˆ‘å¤±æœ›æäº†ã€‚æˆ‘çœ‹é€äº†ç±³ç”Ÿï¼Œä»–æ— å¾·æ— èƒ½ï¼Œè‡ªç§è‡ªåˆ©ï¼Œå¯¹æˆ‘å¥½å®Œå…¨æ˜¯ä¸ºäº†æ–¹ä¾¿è‡ªå·±ç”¨é’±ã€‚æˆ‘è¶Šå‘æ€å¿µèµ·çš“æœˆæ¥ï¼Œåªè§‰å¾—å¹³ç”Ÿèƒ½å¾—åˆ°ä¸€ä¸ªå¯¹è‡ªå·±çœŸå¥½çš„äººå®åœ¨ä¸å®¹æ˜“ï¼â€</p>
<p>é›ªå¶æ­¤æ—¶å¹¶æ²¡ä»”ç»†æœˆæ¹–è®²è¯ï¼Œå¥½åƒåœ¨æ‹…å¿ƒä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…ï¼Œåªé¡¾èµ°è·¯ä¸è¯´è¯ã€‚</p>
<p>æœˆæ¹–ç»§ç»­è¯´é“ï¼šâ€œæˆ‘è§‰å¾—ä½ å’Œå½“æ—¶çš„çš“æœˆå·®ä¸å¤šï¼Œç±³ç”Ÿå’Œæˆ‘å´æœ‰æ ¹æœ¬æ€§çš„ä¸åŒã€‚ç±³ç”Ÿéå¸¸è™šä¼ªï¼Œäººé¢å…½å¿ƒï¼Œä¸ºäº†è‡ªå·±çš„å‰é€”ï¼Œç«ç„¶è¦æ¯’æ­»ä½ ï¼â€</p>
<p>é›ªå¶æ–œçœ¼çœ‹ç€æœˆæ¹–ï¼Œåå”‡ç›¸è®¥é“ï¼šâ€œé‚£ä½ å½“æ—¶ä¸ºäº†è„±ç¦»å›°è‹¦ç”Ÿæ´»ï¼Œä¸¢ä¸‹ç—…å¾—è‡¥åºŠä¸èµ·çš„çš“æœˆè‡ªå·±èµ°äº†ï¼Œä½ è¿™å’Œç±³ç”Ÿå½“åˆå¯¹æˆ‘çš„å¤„ç†ï¼Œæ€§è´¨æœ‰ä»€ä¹ˆä¸ä¸€æ ·ï¼Ÿåªæ˜¯äººéƒ½ä¼šå˜çš„ï¼Œä½ ç°åœ¨ä¸æ˜¯å˜å¾—å¾ˆå¥½äº†å—ï¼Ÿå¤§å®¶éƒ½å–œæ¬¢ä½ ï¼Œä½ çš„å°å§è„¾æ°”æ²¡æœ‰äº†ã€‚ç±³ç”Ÿä¹Ÿåº”è¯¥èƒ½å¤Ÿå˜å¥½çš„ï¼Œè€Œä¸”ä»–æœ¬æ¥å°±å¾ˆå¥½ï¼Œåªæ˜¯å› ä¸ºé‚£æ—¶ä»–ç”Ÿæ´»å¤ªè‹¦äº†ï¼Œå¤§å®¶éƒ½ç§ä¸èµ·ä»–ï¼Œè¿è€å¸ˆä¹Ÿä¸æ„¿æ•™ä»–ï¼Œä»–æ‰ä¼šå˜åçš„ã€‚â€</p>
<p>æœˆæ¹–è¯´ï¼šâ€œé‚£ç±³ç”Ÿä¸ºäº†æ»¡è¶³ä»–çš„è™šè£å¿ƒï¼Œç°åœ¨è¿˜è¦å’Œæˆ‘åœ¨ä¸€èµ·ï¼Œè€Œä¸æ„¿é‡æ–°å’Œä½ åœ¨ä¸€èµ·ç”Ÿæ´»ï¼Œä½ ä¼šæ€ä¹ˆåŠï¼Ÿâ€</p>
<p>é›ªå¶å¾®ç¬‘ç€è¯´ï¼šâ€œä»–æ„¿æ„å’Œè°åœ¨ä¸€èµ·å°±å’Œè°åœ¨ä¸€èµ·ï¼Œæˆ‘å†³ä¸ä¼šç”Ÿæ°”å’Œä¸å®‰ã€‚åªè¦ä»–å¿ƒé‡ŒçœŸçš„å–œæ¬¢æˆ‘æˆ‘å°±æ»¡è¶³äº†ã€‚æˆ‘çŸ¥é“ï¼Œä»–å’Œä½ åœ¨ä¸€èµ·æ˜¯å–œæ¬¢ä½ çš„å®¶å¢ƒå’ŒèƒŒæ™¯ï¼Œä¸æ˜¯å–œæ¬¢ä½ çš„äººï¼Œä»–çœŸå¿ƒå–œæ¬¢çš„äººæ˜¯æˆ‘ã€‚æˆ‘åªè¦ä»–è¿™æ ·å°±å¤Ÿäº†ã€‚çˆ±ä¸€ä¸ªäººä¸ä¸€å®šè¦å’Œè¿™ä¸ªäººå®å®ˆåœ¨ä¸€èµ·ï¼Œå’Œä¸€ä¸ªäººç”Ÿæ´»åœ¨ä¸€èµ·å¯èƒ½æ›´å¤šçš„åªæ˜¯è´£ä»»ï¼Œå¹¶ä¸æ˜¯çˆ±æƒ…ã€‚â€</p>
<p>æœˆæ¹–å¬äº†é›ªå¶è¿™ä¸€ç•ªå¯¹çˆ±æƒ…çš„ç†è®ºï¼Œå¾ˆæ˜¯æƒŠè®¶ã€‚å¥¹ç”¨ä¸€ç§ä½©æœçš„çœ¼å…‰çœ‹ç€é›ªå¶ï¼Œä¸€æ—¶ä¸çŸ¥é“è¯¥è¯´ä»€ä¹ˆå¥½ã€‚</p>
<p>å¥¹ä»¬è¯´ç€èµ°ç€ï¼Œä¸çŸ¥ä¸è§‰è·Ÿè¸ªé‚£ä¸€è¡Œäººæ¥åˆ°é›ªå¶ä½çš„å°å±‹æ—çš„ä¸€ç‰‡æ ‘æ—é‡Œï¼Œä¼åœ¨çŒæœ¨ä¸›ä¸­ï¼Œè¿™æ—¶å¤©è‰²è¶Šæ¥è¶Šé»‘ï¼Œè€Œä¸”åˆ®èµ·äº†å¤§é£ï¼Œæ¥ç€ç”µé—ªé›·é¸£èµ·æ¥ï¼Œä¼´éšç€è½°éš†éš†çš„é›·å£°ï¼Œå€¾ç›†å¤§é›¨â€˜å“—å“—å“—â€™ä¸‹äº†ä¸‹æ¥ã€‚è¿™æ—¶ï¼Œç™½é¾™ç­è€å¸ˆä¸€è¡Œäººæ¥åˆ°å°å±‹å‰ï¼Œä½†å¹¶æ²¡æœ‰æ¨é—¨è¿›å»ã€‚æœˆæ¹–å’Œé›ªå¶ä¼åœ¨çš„ä»–ä»¬é™„è¿‘çš„è‰ä¸›ä¸­ï¼Œè™½ç„¶ç¦»é‚£è¡Œäººå¾ˆè¿‘ï¼Œä½†ç”±äºå¥¹ä»¬é­”åŠ›å¾ˆå¼±ï¼ŒåŠ ä¹‹å¥¹ä»¬é—­ä½äº†è‡ªå·±çš„é­”åŠ›ï¼Œé‚£è¡Œäººä¸€ç‚¹ä¹Ÿæ²¡æœ‰å¯Ÿè§‰åˆ°ã€‚</p>
<p>é›ªå¶éšéšçœ‹è§æš´å’Œå¦å¤–ä¸¤ä¸ªé£é€¸æ‰‹ä¸‹çš„äºŒçº§æˆå‘˜ç´®æƒ‘æµ®å’Œå‡Œç©†ä¹Ÿåœ¨é‚£ä¸€è¡Œäººé‡Œé¢ã€‚</p>
<p>å¥¹ä»¬å¿½ç„¶å¬è§é£é€¸å¯¹èº«è¾¹ä¸€ä½èº«æé«˜å¤§çš„è€å¸ˆè¯´ï¼šâ€œå°±æ˜¯è¿™é‡Œï¼Œä½ ç¡®å®šé›ªå¶å°±æ˜¯é‚£äººå—ï¼Ÿâ€</p>
<p>é‚£é«˜ä¸ªè€å¸ˆé“ï¼šâ€œè¿™ä¸ªæ—¶å€™ä½ è¿˜ä¸ç›¸ä¿¡æˆ‘çš„è¯ï¼Œè¿˜è¦æˆ‘å†è¯´ä¸€éå—ï¼Ÿâ€</p>
<h2 id="é˜´é˜³äºŒæ°”è¯€"><a href="#é˜´é˜³äºŒæ°”è¯€" class="headerlink" title="é˜´é˜³äºŒæ°”è¯€"></a>é˜´é˜³äºŒæ°”è¯€</h2><p>é£é€¸è¯´ï¼šâ€œä½ è¯´çš„é‚£ä¸ªé­”æ³•å¤ªé‚ªï¼Œè¯´èµ·æ¥å€’æ˜¯æœ‰å¯èƒ½å®ç°ï¼Œä½†æ˜¯è¦åšåˆ°æ˜¯å¤ªéš¾äº†ã€‚â€</p>
<p>é‚£è€å¸ˆç¬‘é“ï¼šâ€œå¯¹æˆ‘ä»¬æ¥è¯´æ˜¯å¾ˆå›°éš¾ã€‚ä½†æ˜¯å¯¹æ–‘å›½ç­è¿™ä¸ªç”±æ“…é•¿é­”æ³•çš„é‡‘å‘æœ¬å…‹æ˜Ÿäººç»„æˆçš„ç­çº§æ¥è¯´ï¼Œå°±ä¸æ˜¯æ²¡æœ‰å¯èƒ½çš„äº‹äº†ã€‚å†¥æ˜Ÿæ”¿åºœçš„é‡è¦è®®å‘˜æœˆæ€ä¸¸ï¼Œç°åœ¨å·²ç»å°†ä»–çš„å¥³å„¿æœˆæ¹–å«ç»™äº†æœ¬å…‹æ˜Ÿçš„å¤œå½±é£ï¼Œæœ¬å…‹æ˜Ÿå’Œä»–ä»¬ç»“ç›Ÿäº†ï¼Œæ­£å…¨åŠ›å¸®åŠ©ä»–ä»¬æŠµæŠ—æ²™ã€ç‹±å†›ã€‚æœˆæ€ä¸¸è¿™äººä¸ºè¾¾ç›®çš„æ€»æ˜¯ä¸æ‹©æ‰‹æ®µï¼Œä»–æŒæƒåï¼Œå¤šå°‘ä¸­ç«‹ç­çº§éƒ½è¢«ä»–æ§åˆ¶äº†ï¼Œéƒ½å»å‚åŠ äº†é‚£ç§æ— æ„ä¹‰çš„æˆ˜æ–—ã€‚ç°åœ¨æœˆæ€ä¸¸åˆå°†ç›®æ ‡é”å®šäº†æˆ‘ä»¬ç™½é¾™ç­ã€‚ä½ çœ‹ï¼Œæœˆæ¹–ä¸æ˜¯è¢«ä»–é€åˆ°æˆ‘ä»¬è¿™å„¿æ¥äº†å—ï¼Ÿä½ è¯´æœˆæ¹–å¥¹å‡­è‡ªå·±æœ¬äº‹èƒ½æˆä¸ºæˆ‘ä»¬ç­æˆå‘˜å—ï¼Ÿè¿™è¿˜ä¸æ˜¯å› ä¸ºæœˆæ€ä¸¸æ“çºµäº†æ˜æœå­¦åºœå†…é˜çš„ç»“æœã€‚â€</p>
<p>é£é€¸è¯´ï¼šâ€œé›ªå¶ä¹Ÿæ˜¯æœˆæ€ä¸¸ä¸ºäº†æ§åˆ¶æˆ‘ä»¬ï¼Œé€šè¿‡è¿™æ‰‹æ®µé€è¿‡æ¥çš„å—ï¼Ÿâ€</p>
<p>é«˜ä¸ªè€å¸ˆå›ç­”è¯´ï¼šâ€œå¯¹å‘€ï¼Œè¿™ä¸ªé›ªå¶å¹¶ä¸æ˜¯ä»¥å‰ä½ æ•™çš„é‚£ä¸ªé›ªå¶ï¼Œå½“åˆç±³ç”Ÿå¯¹å¥¹ä¸‹äº†æ¯’ï¼Œå¥¹æ€èƒ½ä¸æ­»å‘¢ï¼Ÿç°åœ¨çš„é›ªå¶åªæ˜¯å¥¹çš„èº¯ä½“ï¼Œæ–½æ³•äººåˆ©ç”¨æ–‘å›½ç­å°¤ç§‘æ–¯è€å¸ˆåˆšåˆšåˆ›é€ çš„â€˜é˜´é˜³äºŒæ°”è¯€â€™é­”æ³•ï¼Œå°†ä»–çš„æ€æƒ³å’Œé›ªå¶çš„èº¯ä½“åˆäºŒä¸ºä¸€ã€‚è¿™æ˜¯æˆ‘å®‰ç½®åœ¨æ–‘å›½ç­é‡Œçš„ä¸€ä¸ªå¯†æ¢è¯´çš„ï¼Œä»–è¯´è¿™ä¸ªåˆä½“çš„äººçš„æ€æƒ³æ˜¯æ–½æ³•äººçš„ï¼Œè®°å¿†å’Œèƒ½åŠ›æ˜¯èº¯ä½“åŸæ¥äººçš„ã€‚â€</p>
<p>é£é€¸å¬åˆ°è¿™é‡Œï¼Œå¿ƒç†ååˆ†å®³æ€•ï¼Œå¥¹è¯´ï¼šâ€œå¦‚æœæ˜¯è¿™æ ·ï¼Œé›ªå¶å¥¹ä»¬è¦æ§åˆ¶æˆ‘ä»¬å²‚ä¸æ˜¯å¾ˆå®¹æ˜“ï¼Œå¥¹åªè¦åˆ©ç”¨â€˜é˜´é˜³äºŒæ°”è¯€â€™é­”æ³•ï¼Œä¸€ä¸ªä¸€ä¸ªå°†æˆ‘ä»¬åˆä½“äº†ï¼Œå¥¹ä»¬çš„ç›®çš„ä¸å°±è¾¾åˆ°äº†å—ï¼Ÿâ€</p>
<p>é«˜ä¸ªè€å¸ˆè¯´ï¼šâ€œä½ ä¸è¦æ€¥å—ï¼æˆ‘å¬è¯´ä½¿ç”¨è¿™ç§é­”æ³•æœ‰ä¸ªå¾ˆå¤§çš„å±€é™ã€‚æ™šä¸Šåç‚¹å·¦å³åˆæˆäººå°±ä¼šå˜å›æ–½æ³•äººæ¨¡æ ·ï¼Œè€Œä¸”èº«ä½“ä¼šå˜å†·ï¼Œæ–½æ³•äººæ¯å¤šåˆä½“ä¸€ä¸ªäººä»–èº«ä¸Šçš„å¯’å†·å°±ä¼šå¢åŠ ä¸€æˆï¼Œå¦‚æœå¯’å†·è¶…è¿‡æ–½æ³•äººæ‰¿å—åº•çº¿å°±ä¼šè¢«å†»æ­»ã€‚æˆ‘ç›¸ä¿¡æ²¡å“ªä¸ªæ–½æ³•äººä¼šä¸é¡¾è‡ªå·±æ­»æ´»ï¼Œè´ªå©ªçš„å»åˆå¹¶è®¸å¤šäººã€‚â€</p>
<p>é£é€¸å¿½ç„¶æ˜ç™½äº†ä»€ä¹ˆä¼¼çš„è¯´ï¼šâ€œå™¢ï¼æˆ‘è¯´æ™šä¸Šåœ¨è¿™å°å±‹æ—ï¼Œæ€ä¹ˆæ€»å¬è§é‡Œé¢å‘å‡ºé‚£ä¹ˆå‡„å‡‰çš„å“­å£°ï¼ŒåŸæ¥æ˜¯å†»å¾—å—ä¸äº†ã€‚æ€ªä¸å¾—å¥¹æ€»æ˜¯åœ¨æˆ‘è®²è¯¾æ—¶ç¡è§‰ï¼ŒåŸæ¥å¥¹æ¯æ™šå†·å¾—ç¡ä¸ç€ã€‚â€</p>
<p>é«˜ä¸ªè€å¸ˆä¸¥è‚ƒèµ·æ¥ï¼Œå‰å£°è¯´é“ï¼šâ€œæˆ‘ä»¬è¦ä¹˜å¥¹è¿˜æ²¡æœ‰æ¥å¾—åŠåˆå¹¶æˆ‘ä»¬ä¹‹å‰ç«‹å³æŠŠå¥¹é™¤æ‰ï¼Œè¿™ä¸ªæ—¶å€™å¥¹æ²¡æ³•è—åŒ¿æ–‘å›½ç­çš„é­”æ³•ã€‚å¦‚æœç­‰å¥¹åˆå¹¶äº†æˆ‘ä»¬ä¸­æŸä¸€ä¸ªäººï¼Œå¥¹èº«ä¸Šé©¬ä¸Šå°±ä¼šæœ‰ç™½é¾™ç­çš„é­”æ³•ï¼Œæˆ‘ä»¬å†æƒ³æŸ¥å‡ºå¥¹çš„çœŸå®èº«ä»½å°±æ²¡é‚£ä¹ˆå®¹æ˜“äº†ã€‚å¦‚æœæˆ‘ä»¬ä¹‹é—´äº’ç›¸çŒœç–‘èµ·æ¥ï¼Œç™½é¾™ç­å²‚ä¸è¦æ¯åœ¨é›ªå¶æ‰‹ä¸Šã€‚æˆ‘è¿˜å¬è¯´ï¼Œä½¿ç”¨â€˜é˜´é˜³äºŒæ°”è¯€â€™é­”æ³•çš„äººæ¯æœˆéƒ½è¦å–ä¸€ä¸ªæ´»äººçš„è¡€æ‰èƒ½å¤Ÿç»§ç»­ç”Ÿå­˜ã€‚æˆ‘ç®—äº†ç®—é›ªå¶æ¥æˆ‘ä»¬è¿™é‡Œçš„å¤©æ•°ï¼Œå’Œé¦™å·äº•é•‡è¿™å‡ ä¸ªæœˆæ¥å¤±è¸ªçš„äººæ•°å‡ ä¹ä¸€æ ·ã€‚â€</p>
<p>é£é€¸å¬åˆ°è¿™é‡Œï¼Œå‡ ä¹å“æ˜è¿‡å»ï¼Œå¥¹æ€¥å¿™å‘½ä»¤æš´å’Œç´®æƒ‘æµ®è¿›å°å±‹é‡Œå»æŠ“é›ªå¶ã€‚è¿™æ—¶é«˜ä¸ªè€å¸ˆæ…Œå¿™å«ä½å¥¹ä»¬ã€‚ä»–ä»èº«ä¸Šæå‡ºä¸€ä¸ªæŒä¸Šä»ªå™¨ï¼Œåˆçœ‹çœ‹æ‰‹è¡¨ï¼Œè¯´ï¼šâ€œå¤§å®¶ä¸è¦æ…Œï¼Œè¿˜æœ‰åå‡ åˆ†é’Ÿå°±åç‚¹äº†ï¼Œç­‰å¥¹å˜å›åŸå½¢ï¼Œæˆ‘ä»¬å†è¿›å»ï¼šä¸€æ¥å¯ä»¥ç¡®å®šè¿™ä»¶äº‹æƒ…æ˜¯å¦å±å®ï¼Œä»¥å…çŠ¯ä¸‹å¤„ç†ç±³ç”Ÿæ—¶çŠ¯çš„é”™è¯¯ï¼›äºŒæ¥ï¼Œé‚£ä¸ªæ—¶å€™å¥¹å†æ²¡æ³•æ–½å±•â€˜é˜´é˜³äºŒæ°”è¯€â€™ é­”æ³•ï¼Œè™½ç„¶å¥¹çš„é­”åŠ›å¯èƒ½å¢å¼ºï¼Œä½†æ˜¯è¿™é­”åŠ›éœ€è¦å¥¹æ¢å¤æœ¬ä½“æ‰èƒ½å¤Ÿæ–½å±•ï¼Œè€Œåˆ°æ—¶å€™å¥¹æ˜¯æ¥ä¸åŠæ¢å¤æœ¬ä½“çš„ã€‚â€</p>
<p>æœˆæ¹–ä¼åœ¨è‰ä¸›ä¸­å¬åˆ°é£é€¸å’Œé«˜ä¸ªè€å¸ˆçš„å¯¹è¯ï¼Œå¿ƒä¸­ç”šæ˜¯æ‹…å¿§ï¼Œä¸æ—¶ç”¨å®³æ€•çš„çœ¼å…‰çŸå‘é›ªå¶ï¼Œå¿ƒä¸­å……æ»¡ææƒ§ï¼Œæƒ³ç€é«˜ä¸ªè€å¸ˆè¯´çš„è¯å¦‚æ˜¯çœŸçš„ï¼Œè‡ªå·±å¯è¦é­æ®ƒäº†ã€‚ä½†å¥¹åˆç›¼æœ›è¿™ä¸€åˆ‡éƒ½ä¸æ˜¯çœŸçš„ã€‚</p>
<p>è¿™æ—¶é›ªå¶æ­£ç´§æŒ¨ç€æœˆæ¹–å¹¶è‚©è¶´åœ¨è‰ä¸›ä¸­ï¼Œæœˆæ¹–æ‰­å¤´çœ‹äº†ä¸€çœ¼é›ªå¶ï¼Œå¥¹æ­£æ»¡è„¸æ„¤æ€’åœ°çœ‹ç€é£é€¸ä»–ä»¬ã€‚æœˆæ¹–å‡è§†äº†é›ªå¶è®¸ä¹…ï¼Œçªç„¶å‘ç°é›ªå¶è¿™æ—¶æ‰­å¤´æœè‡ªå·±çœ‹æ¥ï¼Œåªè§é›ªå¶è¿™æ—¶å¦ä¸€ä¾§é‚£åŠè¾¹è„¸å…¨æ˜¯éª¨çš®ï¼Œæ¯«æ— è¡€è‚‰ï¼Œçœ¼ä¸­å°„å‡ºå‡¶ç‹ çš„å…‰ï¼Œå¤´å‘æŠ«æ•£å¼€å»ï¼Œæ­£åœ¨å†²è‡ªå·±ææ€–çš„ç¬‘ç€ã€‚æœˆæ¹–çªç„¶è§‰å¾—é¼»å­å‘é…¸ï¼Œçœ¼ç›å‘èƒ€ï¼Œæ‰‹è„šå‘è½¯ï¼Œä¸€æ—¶å“å¾—æƒ³å–Šå£°éŸ³å´å‘ä¸å‡ºæ¥äº†ã€‚</p>
<p>é£é€¸ä»–ä»¬æ­£åœ¨ç”¨é­”æ³•æœç´¢å‘¨å›´çš„é­”åŠ›ï¼Œçªç„¶å‘ç°èº«åæœ‰è‚¡å¼ºå¤§é­”åŠ›ä¼ æ¥ï¼Œé‚£ä½èº«æé«˜å¤§çš„è€å¸ˆå¤§å£°å–Šé“ï¼šâ€œé›ªå¶åœ¨æˆ‘ä»¬åé¢ï¼ä½ ä»¬æ„Ÿè§‰åˆ°æ²¡æœ‰ï¼Œè¿™é­”åŠ›å’Œæ–‘å›½ç­çš„é­”åŠ›ä¸€æ ·ï¼Ÿâ€</p>
<p>å¬åˆ°å–Šå£°ï¼Œä¼—äººä¸€é½è½¬è¿‡èº«å»ï¼Œåªè§ä¸€ä¸ªç©¿ç€ç™½é¾™ç­ä¸€çº§æˆå‘˜ç­æœçš„å¥³å­ä»è‰ä¸›ä¸­ä¸€è·ƒè€Œèµ·ï¼Œæ‹”è…¿å°±å‘è¿œå¤„è·‘å»ã€‚åœ¨é‚£å¥³å­èµ·èº«çš„ä¸€ç¬é—´ï¼Œæš´çœ‹æ¸…äº†å¥¹çš„è„¸ï¼Œé‚£æ­£æ˜¯é›ªå¶ã€‚æš´å’Œç´®æƒ‘æµ®èµ¶ç´§è¿½å»ï¼Œä¼—äººä¹Ÿä¸€èµ·è·Ÿä¸Šè¿½å»ã€‚</p>
<p>æ‹è¿‡ç¬¬ä¸‰ä¸ªè·¯å£ï¼Œé›ªå¶çš„èº«å½±çªç„¶æ¶ˆå¤±äº†ã€‚è¿™é‡Œå››å¤„éƒ½æ˜¯é«˜å¤§çš„ä¹”æœ¨å’ŒçŒæœ¨è‰ä¸›ã€‚é›·å£°ä¼´ç€é›¨æ°´è¶Šä¸‹è¶Šå¤§ï¼Œä¼—äººèº«ä¸Šæ·‹å¾—é€æ¹¿ï¼Œä¸€é˜µå†·é£åˆ®è¿‡ï¼Œå¤§å®¶ä¸ç¦æ‰“ä¸ªå¯’é¢¤ï¼Œæœ‰çš„äººå†»å¾—å‘èµ·æŠ–æ¥ã€‚</p>
<p>é«˜ä¸ªè€å¸ˆè¯´ï¼šâ€œç°åœ¨å¤§å®¶éƒ½å°†æ°”æ¯å’Œé­”åŠ›é—­ä½ã€‚é›ªå¶ç°åœ¨ä¸€å®šæ¯”æˆ‘ä»¬è°éƒ½å†·ï¼Œå¥¹ä¸€å®šä¼šæµ‘èº«å‘æŠ–çš„ã€‚â€</p>
<p>è¯´å®Œï¼Œé«˜ä¸ªè€å¸ˆä½¿ç”¨è‡ªå·±çš„é­”åŠ›ï¼Œå¼€å§‹ä»”ç»†æœå¯»è¿™å››å‘¨ã€‚æœç„¶é›ªå¶çš„å‘æŠ–å£°è¢«é«˜ä¸ªè€å¸ˆæ¢åˆ°ï¼Œæš´å’Œç´®æƒ‘æµ®èµ¶ç´§æœè€å¸ˆæŒ‡ç¤ºçš„æ–¹å‘å†²å»ã€‚çªç„¶ï¼Œä¸€å¤´å¤§é»‘ç†Šä»çŒæœ¨ä¸›ä¸­çŒ›åœ°çªœå‡ºã€‚ç´®æƒ‘æµ®ç«‹å³æ„è¯†åˆ°è¿™å°±æ˜¯é›ªå¶æ›¾ä½¿ç”¨è¿‡çš„é‚£æ‹›â€œé»‘ç†Šé¬¼å°†â€ã€‚äºæ˜¯å¤§å£°å–Šé“ï¼šâ€œæ–‘å›½ç­çš„ç•œç”Ÿï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“ä½ ä¸æ˜¯é›ªå¶ï¼Œè¿˜ä¸èµ¶å¿«ç»™æˆ‘ä»¬ç°å‡ºåŸå½¢ï¼â€</p>
<p>çŒæœ¨ä¸›ä¸­ç«‹åˆ»ä¼ æ¥å‡„æƒ¨çš„å¼å£°ï¼šâ€œæˆ‘å°±æ˜¯é›ªâ€¦â€¦é›ªå¶ã€‚ä½ â€¦â€¦ä½ ä»¬æƒ³æŠŠæˆ‘æ€æ ·ï¼Ÿâ€</p>
<p>ç´®æƒ‘æµ®ä¸€å¬è¿™å£°éŸ³è™½ç„¶æœ‰äº›é¢¤æŠ–ï¼Œä½†çš„ç¡®æ˜¯é›ªå¶æœ¬äººçš„å£°éŸ³ï¼Œä¸€æ—¶ä¸çŸ¥å¦‚ä½•å›ç­”æ˜¯å¥½ã€‚</p>
<p>å…¶ä»–äººéƒ½å°†å¤´è½¬å‘é‚£é«˜ä¸ªè€å¸ˆï¼Œé«˜ä¸ªè€å¸ˆæƒ³äº†ä¸€æƒ³ï¼Œå¤§å£°è¯´é“ï¼šâ€œå“¼ï¼Œä½ åˆ«æƒ³éª—æˆ‘ä»¬ï¼Œä½ å­¦é›ªå¶çš„å£°éŸ³å°±èƒ½éª—å¾—äº†æˆ‘ä»¬å—ï¼Ÿå°±ç®—ä½ çœŸæ˜¯é›ªå¶ï¼Œä½ æ€äº†é‚£ä¹ˆå¤šé¦™å·äº•é•‡çš„å±…æ°‘ï¼Œè¿™ç½ªä½ ä¹Ÿæ‰¿å—ä¸èµ·äº†ã€‚â€</p>
<p>é›ªå¶å“ˆå“ˆå¤§ç¬‘ï¼Œç¬‘å£°å‡„å‡‰ä¸­å¸¦ç€é¢¤æŠ–ã€‚é‚£å¤´é»‘ç†Šå‘å¤§å®¶å†²äº†è¿‡æ¥ã€‚ç´®æƒ‘æµ®æ‹”å‡ºçº¢å‡¤é•¿åˆ€â€œé“›â€çš„ä¸€å£°æŒ¡ä½äº†é»‘ç†ŠæŒ¥è¿‡æ¥çš„å·¨é”¤ã€‚ç´®æƒ‘æµ®æ„Ÿå¹é›ªå¶çš„é­”åŠ›ç«Ÿç„¶æ¯”ä¸Šæ¬¡å¢é•¿äº†è®¸å¤šå€ã€‚å…¶ä»–è€å¸ˆä¹Ÿçº·çº·å‘å‡ºé­”åŠ›ï¼Œå¯¹é»‘ç†Šè¿›è¡Œé­”æ³•æ”»å‡»ã€‚ä¸ä¸€ä¼šï¼Œé»‘ç†Šæ¶ˆå¤±äº†ï¼Œé›ªå¶çš„å¤§ç¬‘å£°ä¹Ÿæ¶ˆå¤±äº†ï¼Œå¤§å®¶å‘¨å›´æ²¡æœ‰äº†æ–‘å›½ç­çš„é­”åŠ›ã€‚</p>
<h2 id="ç¥ç§˜çš„æ¶ˆå¤±"><a href="#ç¥ç§˜çš„æ¶ˆå¤±" class="headerlink" title="ç¥ç§˜çš„æ¶ˆå¤±"></a>ç¥ç§˜çš„æ¶ˆå¤±</h2><p>é‚£ä»¥åï¼Œé›ªå¶å†æ²¡æœ‰å›åˆ°ç™½é¾™ç­æ¥ã€‚ä¸‰å¹´æ—¶é—´è¿‡å»äº†ï¼Œé£é€¸çš„é£èˆ¹ä¾ç„¶æ²¡æœ‰å®Œæˆã€‚è¿™æ˜¯å¥¹å¤©æ‰çš„é£èˆ¹åˆ›é€ æ‰èƒ½å®³äº†å¥¹ã€‚é£é€¸åœ¨åˆ¶é€ é£èˆ¹è¿‡ç¨‹ä¸­ä¸æ–­æ¶Œç°ä¸€äº›æ–°çš„æƒ³æ³•ï¼Œç”±äºæ•´ä¸ªé£èˆ¹ä½“ç³»è¿‡äºåºå¤§ï¼Œåˆ°æœ€åï¼Œæ•´åˆèµ·æ¥å›°éš¾é‡é‡ï¼Œç›´åˆ°è¿™ç¬¬ä¸‰ä¸ªå¹´å¤´æ‰æœ‰äº†äº›è½¬æœºã€‚é£é€¸åˆ¶é€ é£èˆ¹å·¥æœŸçš„æ¨è¿Ÿï¼Œå¯¼è‡´å¥¹æ‰‹ä¸‹çš„å­¦ç”Ÿé™¤äº†æœˆæ¹–ä»¥å¤–ï¼Œéƒ½æ²¡æœ‰èƒ½å¤Ÿå¾—åˆ°å‡çº§ã€‚</p>
<p>ç¬¬ä¸€å¹´ï¼Œæœˆæ¹–åœ¨ç«èµ›å•æŒ‘é¡¹ç›®ä¸Šå–å¾—ç¬¬ä¸€ï¼Œæ™‹å‡åˆ°äºŒçº§æˆå‘˜ã€‚å› ä¸ºæœˆæ¹–æ˜¯å‡­å•æŒ‘é¡¹ç›®å‡çš„çº§ï¼Œè€Œä¸æ˜¯å‡­çš„é£é€¸æ•™æˆçš„ç”µå­æœºæ¢°é¡¹ç›®å‡çº§ï¼Œæ‰€ä»¥é£é€¸æ²¡èƒ½å› æ­¤æ™‹å‡ä¸ºä¸‰çº§æˆå‘˜ã€‚</p>
<p>ç¬¬äºŒå¹´ï¼Œæœˆæ¹–ç”³è¯·è€å¸ˆæˆåŠŸï¼Œæœˆæ¹–çš„çˆ¶äº²æœˆæ€ä¸¸åˆ©ç”¨è‡ªå·±çš„æƒåˆ©ï¼Œå«äº†å‡ åæœ€æœ‰å¸Œæœ›åœ¨å•æŒ‘ï¼Œé­”æ³•å’Œç”Ÿç‰©ç«æŠ€é¡¹ç›®ä¸­å¾—å† çš„äººåŠ å…¥åˆ°ç™½é¾™ç­æˆä¸ºæœˆæ¹–çš„å­¦ç”Ÿï¼Œäºæ˜¯ï¼Œå½“å¹´è¿™ä¸‰é¡¹ç«æŠ€çš„å† å†›å¾—ä¸»å…¨æ˜¯æœˆæ¹–çš„å­¦ç”Ÿã€‚æœˆæ€ä¸¸åˆç”¨æ‰‹ä¸Šçš„æ”¿æ²»æƒåˆ©å¯¹æ˜æœå­¦åºœå†…é˜æ–½åŠ å‹åŠ›ï¼Œè®©æœˆæ¹–é¡ºåˆ©æ™‹å‡ä¸ºä¸‰çº§æˆå‘˜ã€‚</p>
<p>ç¬¬ä¸‰ä¸ªå¹´å¤´ï¼Œæœˆæ¹–å¾ˆå¿«çš„å­¦åˆ°äº†å˜èº«ç™½é¾™çš„æœ¬é¢†ï¼Œæˆä¸ºä¸æ­»ä¹‹èº«ã€‚</p>
<p>è¿™å¤©ï¼Œé£é€¸å’Œæš´æ­£åœ¨ç™½ç¾½å·é£èˆ¹é‡Œè®¨è®ºé£èˆ¹çš„é—®é¢˜ã€‚æš´çªç„¶å¯¹é£é€¸æèµ·æœˆæ¹–ï¼Œå¥¹è¯´ï¼šâ€œä½ è§‰å¾—æœˆæ¹–è¿™ä¸‰å¹´çš„å‡çº§ä¹‹è·¯æ­£å¸¸å—ï¼Ÿâ€</p>
<p>é£é€¸ç¬‘é“ï¼šâ€œå½“ç„¶ä¸æ­£å¸¸äº†ã€‚å“ˆå“ˆï¼åŸæ¥æš´ä¹Ÿä¼šå«‰å¦’å•Šã€‚ä½†æ˜¯è°å«äººå®¶æ˜¯è®®å‘˜çš„å¥³å„¿å‘¢ï¼è¿™ç‚¹ä½ ä¸å¾—ä¸æœå•Šã€‚â€</p>
<p>æš´è¯´é“ï¼šâ€œäº‹æƒ…å¹¶ä¸æ˜¯è¿™æ ·ç®€å•å•Šï¼æˆ‘è§‰å¾—ç°åœ¨çš„æœˆæ¹–ä¸æ˜¯åŸæ¥çš„æœˆæ¹–ï¼Œå…¶å®æ˜¯è¢«é›ªå¶åˆä½“äº†çš„æœˆæ¹–ã€‚é‚£æ—¶ï¼Œåˆšä»æ–‘å›½ç­å›æ¥çš„é›ªå¶ï¼Œåº”è¯¥å°±æ˜¯é›ªå¶æœ¬äººï¼Œå¦‚æœå¥¹å½“æ—¶ä¸æ˜¯é›ªå¶ï¼Œè€Œæ˜¯è¢«æ–‘å›½ç­åˆä½“äº†çš„äººï¼Œå¥¹æ—©å°±å’Œç™½é¾™ç­æœ¬é¢†æœ€é«˜çš„äººåˆä½“äº†ï¼Œä½•å¿…ä¸€æ‹–å†æ‹–ï¼Œè€Œä¸”æ¯å¤©éƒ½ä¸ºç±³ç”Ÿç‰µè‚ æŒ‚è‚šï¼Œå¥½è±¡è§ä¸ç€ç±³ç”Ÿå°±æ²¡æ³•æ´»ä¸‹å»ä¸€èˆ¬å‘¢ï¼Ÿå¦‚æœå¥¹å·²ç»è¢«åˆä½“äº†ï¼Œä½†æ˜¯å¥¹çš„æ€æƒ³ä»ç„¶æ˜¯é›ªå¶çš„ï¼Œè‡³äºå¥¹æ˜¯æ€ä¹ˆåšåˆ°èƒ½å¤Ÿç”¨è¢«åˆä½“äººçš„æ€æƒ³ä¸»å¯¼åˆä½“äººçš„ï¼Œè¿™æˆ‘å´å¼„ä¸æ¸…æ¥šã€‚é‚£æ™šæˆ‘çœ‹è§ä»è‰ä¸›ä¸­è·‘èµ°çš„äººçš„ç¡®æ˜¯é›ªå¶ï¼Œè€Œæˆ‘ä»¬åœ¨è‰ä¸›ä¸­å¹¶æ²¡æœ‰å‘ç°è¿˜æœ‰ä¸€ä¸ªæœˆæ¹–ã€‚æ‰€ä»¥å½“æ—¶å¥¹ä¸€å®šæ˜¯ä¸æœˆæ¹–åˆä½“äº†ï¼Œæ®è¯´æ–‘å›½ç­å°¤ç§‘æ–¯è€å¸ˆçš„â€˜é˜´é˜³äºŒæ°”è¯€â€™é­”æ³•å°†ä¸¤äººåˆä½“æ—¶ï¼Œæ–½æ³•äººä¸èƒ½ä¸€ä¸‹å­å°±æ¶ˆå¤±è‡ªå·±çš„ä½“è²ï¼Œå°†æ€æƒ³æ¤å…¥è¢«åˆä½“äººä½“å†…ï¼Œå®Œæˆè¿™ä¸ªè¿‡ç¨‹éœ€è¦ä¸€ä¼šå„¿æ—¶é—´ã€‚ä¸ç„¶å¥¹é‚£æ—¶ä¸€å®šä¸æ˜¯é›ªå¶çš„æ¨¡æ ·ï¼Œè€Œåº”è¯¥æ˜¯æœˆæ¹–çš„æ¨¡æ ·äº†ã€‚â€</p>
<p>é£é€¸é—®é“ï¼šâ€œä½ æ€ä¹ˆé‚£ä¹ˆè‚¯å®šæ˜¯ä¸æœˆæ¹–åˆä½“çš„ã€‚â€</p>
<p>æš´è¯´ï¼šâ€œå½“æ—¶æˆ‘è¿½é›ªå¶å›æ¥ï¼Œåœ¨é‚£è‰ä¸›ä¸­å‘ç°äº†è¿™ä¸ªã€‚â€æš´æ‹¿å‡ºä¸€ä¸ªæ¢…èŠ±ç°ªå­ã€‚è¯´ï¼šâ€œè¿™æ˜¯æœˆæ¹–çš„æ¢…èŠ±ç°ªå­ï¼Œé‚£å‡ å¤©æˆ‘å¬è¯´æœˆæ¹–åœ¨åˆ°å¤„æ‰¾é›ªå¶ã€‚æˆ‘æƒ³é‚£å¤©å¥¹ä»¬è‚¯å®šç¢°ä¸Šäº†ï¼Œåæ¥çœ‹åˆ°æˆ‘ä»¬å»æŠ“é›ªå¶ï¼Œå°±è·Ÿè¸ªæˆ‘ä»¬æƒ³çœ‹ä¸ªç©¶ç«Ÿã€‚å½“é›ªå¶å‘ç°è‡ªå·±èº«ä»½è´¥éœ²ï¼Œå°±ç´¢æ€§å’Œæ—è¾¹çš„æœˆæ¹–åˆä½“ã€‚å¥¹è¿™æ ·åšå¯ä»¥ä¸€ä¸¾ä¸¤å¾—ï¼Œæ—¢å¯æ©äººè€³ç›®ç»§ç»­ç•™åœ¨ç™½é¾™ç­ï¼Œåˆå¯åˆ©ç”¨æœˆæ¹–çš„ç‰¹æ®Šèº«ä»½å°½å¿«å‡çº§æˆä¸ºä¸‰çº§æˆå‘˜ã€‚åœ¨æ˜æœå­¦åºœï¼Œä¸‰çº§æˆå‘˜å¯ä»¥æŸ¥çœ‹æ˜æœå­¦åºœæ‰€æœ‰æˆå‘˜å’Œå­¦å‘˜çš„æ¡£æ¡ˆï¼Œåªè¦éœ€è¦ï¼Œé‚£äº›åŠ å¯†è¿‡çš„æ–‡ä»¶ä¹Ÿå¯å€Ÿé˜…ã€‚åœ¨è¿™äº›æ–‡ä»¶é‡Œï¼Œå¥¹ä¸€å®šå¯ä»¥çœ‹åˆ°å¥¹ä¸€ç›´éƒ½æƒ³çŸ¥é“çš„æœ‰å…³ç±³ç”Ÿçš„æƒ…å†µã€‚â€</p>
<p>é£é€¸ä¸€æƒŠé“ï¼šâ€œä½ æ€ä¹ˆçŸ¥é“è¿™äº›äº‹æƒ…çš„ã€‚â€</p>
<p>æš´éª„å‚²åœ°è¯´ï¼šâ€œé€šè¿‡åˆ†ææ¨æ–­å‡ºæ¥çš„å•Šã€‚ä½ æƒ³æƒ³ï¼Œå½“åˆä½ åƒèˆ¬é˜»æ‰°é›ªå¶å‡çº§æ˜¯ä¸ºä»€ä¹ˆã€‚å³ä½¿å¥¹æ˜¯æ–‘å›½ç­æ´¾æ¥çš„æ¢å­ï¼Œå°±ä½ æ€§æ ¼è€Œè¨€ï¼Œä½ æ€ä¹ˆä¼šä¸å¸Œæœ›å¥¹å‡çº§å‘¢ï¼Ÿå¥¹å‡çº§äº†ï¼Œä½ ä¸å°±èƒ½å¤Ÿæˆä¸ºä½ æ—¥æ€å¤œæƒ³çš„ä¸‰çº§æˆå‘˜äº†å—ï¼Ÿä½ é‚£ä¹ˆæ‹…å¿ƒå¥¹å‡çº§åˆ°åº•æ˜¯ä»€ä¹ˆåŸå› ï¼Ÿæˆ‘åæ¥è”ç³»é›ªå¶ä¸€å¿ƒè¦æ‰¾ç±³ç”Ÿçš„æ‰€ä¸ºï¼Œè”æƒ³åˆ°æ˜æœå­¦åºœå‡çº§ä¸ºä¸‰çº§æˆå‘˜åå¯ä»¥æŸ¥çœ‹å­¦å‘˜æ¡£æ¡ˆçš„è§„å®šï¼Œå‘ç°ä½ æ˜¯æ€•é›ªå¶çŸ¥é“ç±³ç”Ÿçš„æƒ…å†µã€‚â€</p>
<p>é£é€¸å“ˆå“ˆå¤§ç¬‘ï¼Œé«˜å…´åœ°è¯´é“ï¼šâ€œå¥½ä¸ªæš´ï¼Œæˆ‘æœç„¶æ²¡çœ‹é”™ï¼Œä½ ç¡®å®æ˜¯ä¸ªå‰å®³çš„å­¦ç”Ÿï¼Œè¿æˆ‘çš„è¿™ä¸ªå¿ƒäº‹ä½ éƒ½èƒ½å¤ŸçŒœå‡ºæ¥ã€‚â€</p>
<h2 id="è´¥éœ²"><a href="#è´¥éœ²" class="headerlink" title="è´¥éœ²"></a>è´¥éœ²</h2><p>â€œå’šå’šå’šâ€ï¼Œä¸€ä¸²ä¸‹æ¥¼æ¢¯çš„å£°éŸ³ä»å¤–é¢ä¼ æ¥ã€‚æš´è¯´ï¼šâ€œä¸€å®šæ˜¯æœˆæ¹–å¬è§æˆ‘ä»¬è°ˆè¯äº†ã€‚â€é£é€¸ç–¾æ­¥å¥”å‘æ¥¼æ¢¯ï¼Œæ‰­å¤´å«é“ï¼šâ€œæš´ï¼Œæˆ‘ä»¬èµ¶ç´§å»é˜»æ­¢å¥¹ï¼Œä¸è¦å«å¥¹çœ‹è§äº†é‚£äº›å¯†ä»¶ã€‚â€</p>
<p>æš´å’Œé£é€¸èµ¶åˆ°æ¯èˆ°ä¸­å¤®æ§åˆ¶å®¤ï¼Œçœ‹è§æœˆæ¹–åŒæ‰‹æ’‘åœ¨æ§åˆ¶å°ä¸Šï¼Œæ­£ä½å¤´ç—›å“­ï¼Œå£°éŸ³å‡„æƒ¨é˜´æ£®ï¼Œå¤§å±å¹•ä¸Šæ˜¾ç¤ºå‡ºä¸€æ®µè§†é¢‘ï¼Œç±³ç”Ÿåœ¨ç‰¢é‡Œè¢«åˆ’ç ´èƒ¸è„¯ï¼Œèº«ä½“é‡Œçš„å†…è„è¢«æŒ–å‡ºæ¥ï¼Œç™½é¾™ç­é‡Œçš„è€å¸ˆåœ¨å››å‘¨å›´è§‚ã€‚è§†é¢‘ä¸‹æ˜¾ç¤ºä¸€æ¡ä¿¡æ¯ï¼šâ€œç±³ç”Ÿï¼ŒäºŒåå…«å²ï¼ŒçŠ¯æŠ•æ¯’æ€äººç½ªï¼Œåˆ¤å¤„æ­»åˆ‘ï¼Œäº¤ç™½é¾™ç­æ‰§è¡Œã€‚æ˜æœå­¦åºœå†…é˜ã€‚â€</p>
<p>é£é€¸æ‰‹è¶³æ— æªï¼Œç«™åœ¨é—¨å£æ— æ‰€é€‚ä»ã€‚æœˆæ¹–è½¬è¿‡èº«æ¥æ¶ç‹ ç‹ çš„çœ‹ç€é£é€¸ï¼Œçœ¼ä¸­æ³ªæ°´ä¸æ–­ã€‚</p>
<p>æœˆæ¹–å“­ç€å¤§å«é“ï¼šâ€œä½ ä»¬ä¸ºä»€ä¹ˆè¦è¿™æ ·å¯¹å¾…ç±³ç”Ÿï¼Œè®©ä»–æ­»å¾—è¿™æ ·æƒ¨ï¼ç±³ç”Ÿæ€æ ·å¯¹æˆ‘ä¸ä½ ä»¬ä½•å¹²ï¼Ÿæˆ‘ä»æ–‘å›½ç­å›æ¥ï¼Œè¯æ˜ç±³ç”Ÿå¹¶æ²¡æœ‰çŠ¯ä¸‹æ€äººç½ªï¼Œæ˜¯ä½ ä»¬çŠ¯äº†ä¾®å‘Šç½ªï¼Œä½ ä¸ºä»€ä¹ˆä¸å»è‡ªé¦–ï¼Ÿæ˜¯ä¸æ˜¯æ€•å› ä¸ºè¿™å½±å“ä½ çš„å‡çº§ï¼Ÿä½ ä»¬è¿™ç¾¤æ¶é­”ï¼â€</p>
<p>é£é€¸è¯´ï¼šâ€œä½ æ˜¯æ–‘å›½ç­è€å¸ˆç”¨â€˜é˜´é˜³äºŒæ°”è¯€â€™åˆæˆçš„åˆä½“äººï¼Œä½ å¹¶ä¸æ˜¯çœŸçš„é›ªå¶ã€‚å¯¹å§ï¼Ÿâ€</p>
<p>æœˆæ¹–æ–©é’‰æˆªé“åœ°è¯´ï¼šâ€œæˆ‘å°±æ˜¯é›ªå¶ï¼â€</p>
<p>é£é€¸ç”¨ä¸€ç§ç–‘é—®çš„è¯­æ°”æ¢é—®é“ï¼šâ€œé›ªå¶è¢«ä½¿ç”¨â€˜é˜´é˜³äºŒæ°”è¯€â€™åˆä½“åï¼Œæ€ä¹ˆè¿˜èƒ½å¤Ÿæœ‰å¥¹çš„æ€æƒ³ï¼Ÿâ€</p>
<p>é›ªå¶è¯´ï¼šâ€œå“¼ï¼è¿™ä½ å“ªé‡Œæ˜ç™½ï¼Œæ–‘å›½ç­çš„å°¤ç§‘æ–¯è€å¸ˆä½¿ç”¨è‡ªå·±çš„ä¸€åŠå¿ƒçµè¿›å…¥æˆ‘çš„èº«ä½“ï¼Œè¿™æ ·æ—¢èƒ½ä¿å…¨å¥¹çš„æœ¬ä½“ï¼Œä¹Ÿèƒ½å°†æˆ‘æ•‘æ´»ï¼Œè¿™æ˜¯å¥¹åˆ›é€ çš„æœ€æ–°â€˜é˜´é˜³äºŒæ°”è¯€â€™é­”æ³•ï¼Œè¿™æ ·çš„æ–¹æ³•åªæœ‰å¥¹ä¸€ä¸ªäººèƒ½å¤Ÿåšåˆ°ã€‚ç”±äºå°¤ç§‘æ–¯çš„å¿ƒçµæ²¡æœ‰å®Œå…¨è¿›å…¥æˆ‘çš„èº«ä½“ï¼Œè¿™æ ·åšçš„ç»“æœï¼Œå°±æ˜¯æ€æƒ³è¿˜æ˜¯æˆ‘çš„ï¼Œä½†æˆ‘çš„èº«ä½“å´å…·æœ‰äº†å°¤ç§‘æ–¯è€å¸ˆè®°å¿†å’Œé­”åŠ›çš„ä¸€åŠã€‚â€</p>
<p>æš´åœ¨ä¸€æ—ä¸€è¾¹å¬ä¸€è¾¹ç‚¹å¤´ç§°å¥‡ï¼Œç„¶åæ’è¯è¯´ï¼šâ€œå°¤ç§‘æ–¯æœç„¶èƒœäººä¸€ç­‰ï¼Œè¿™æ ·çš„æ‹›æœ¯éƒ½èƒ½å¤Ÿæƒ³åˆ°ï¼Œå¥¹ä¸ä»…å°†ä¸€ä¸ªå¿«æ­»çš„äººç»™æ•‘æ´»äº†ï¼Œè¿˜æŠŠè‡ªå·±çš„æœ¬é¢†è½»è€Œæ˜“ä¸¾åœ°ä¼ ç»™äº†ä½ ã€‚â€</p>
<p>é›ªå¶è‹¦ç¬‘é“ï¼šâ€œå¥½æ˜¯å¥½ï¼Œåªæ˜¯å¾—åˆ°â€˜é˜´é˜³äºŒæ°”è¯€â€™ä¸æ˜¯é‚£ä¹ˆå¥½å—ï¼Œæ¯å¤©å¤œæ™šï¼Œèº«ä½“å†°å†·æ— æ³•å…¥çœ çš„æ»‹å‘³ä½ ä»¬æ˜¯ä½“ä¼šä¸åˆ°çš„ã€‚é£é€¸å•Šï¼Œé£é€¸ï¼Œä½ å¾ˆå¸Œæœ›æˆ‘é›ªå¶æ­»å»ï¼Œå¯¹å§ï¼Ÿè¿™æ ·ä½ å°±ä¸ç”¨èƒŒè´Ÿè¯¯æ€ç±³ç”Ÿçš„ç½ªåäº†æ˜¯å§ï¼Ÿå¯æ€œæˆ‘ç°åœ¨å˜æˆäº†æœˆæ¹–çš„æ¨¡æ ·ï¼Œè¿™å°±å†æ²¡æ³•è¯æ˜é›ªå¶æ²¡æ­»äº†ï¼Œä¹Ÿæ²¡æ³•è®©æ˜æœå­¦åºœå†…é˜å¤„ç½®ä½ ä»¬è¿™ç¾¤æ€äººæ¶é­”äº†ã€‚å“ˆå“ˆå“ˆâ€¦â€¦ä½ èµ¢äº†ï¼æœ€ç»ˆè¿˜æ˜¯ä½ èµ¢äº†ï¼â€</p>
<p>é›ªå¶è¿™å‡ å£°ç¬‘ï¼Œç¬‘å¾—ç”šæ˜¯å‡„æƒ¨ï¼Œå¥¹çªç„¶æ—‹è½¬èº«å­ï¼Œé€Ÿåº¦è½¬å¾—è¶Šæ¥è¶Šå¿«ï¼Œéšå³å˜ä¸ºé‡‘è‰²çš„æ²™å­å¼¥æ¼«æ•´ä¸ªæ§åˆ¶å®¤é‡Œï¼Œç„¶åæ…¢æ…¢çš„æ¶ˆå¤±å¾—æ— å½±æ— è¸ªã€‚</p>
<p>é£é€¸è¯´ï¼šâ€œæ–‘å›½ç­çš„â€˜é£ç ‚èµ°çŸ³â€™é­”æ³•ï¼â€</p>
<p>â€œæ˜¯å•Šï¼Œèº«ä½“ä¸€ä¸‹å­å˜æˆé‡‘å…‰é—ªé—ªçš„æ²™å­ï¼Œè¿™é­”æœ¯åªæœ‰æ–‘å›½ç­æ‰æœ‰ã€‚â€æš´èµå¹é“ã€‚</p>
<p>é£é€¸é•¿é•¿å¹äº†ä¸€å£æ°”ï¼Œè¯´é“ï¼šâ€œé›ªå¶è¿™ä¹ˆå¹´è½»ï¼Œå°±ä¸ä»…æˆä¸ºäº†æ˜æœå­¦åºœå››çº§æˆå‘˜ï¼Œå·²ç»å˜èº«ä¸ºç™½é¾™è€Œé•¿ç”Ÿä¸è€ï¼Œå¥¹è¿˜åŒæ—¶æŒæ¡äº†ç™½é¾™ç­å’Œæ–‘å›½ç­çš„ä¸€äº›ç»æ‹›ã€‚å¸Œæœ›å¥¹ä¸è¦è¢«æœˆæ€ä¸¸åˆ©ç”¨äº†å•Šã€‚â€</p>
<p>æ¬¡æ—¥ï¼Œé£é€¸å’Œæš´ç”¨å®Œæ™šé¤ï¼Œåœ¨å»é£èˆ¹äºŒå±‚é£é€¸æˆ¿é—´â€œå¾¡åŒ¾æ‰€â€çš„è·¯æ—è‰åœ°ä¸Šé—²èŠã€‚æš´å¯¹é£é€¸è¯´ï¼Œé›ªå¶è¿™æ¬¡è™½ç„¶ç¦»å¼€äº†é£èˆ¹ï¼Œä½†å¥¹ä¸ä¼šå–„ç½¢ç”˜ä¼‘ï¼Œå¥¹ä¼šåˆ©ç”¨æœˆæ¹–çš„èº«åƒæŒ‘æ‹¨å†¥å†›å’Œç™½é¾™ç­çš„å…³ç³»ï¼Œå¯¹ç™½é¾™ç­ä¸åˆ©ã€‚è€Œä¸”é›ªå¶æœ¬èº«å°±å·²ç»æ˜¯å››çº§æˆå‘˜ï¼Œå¥¹è¿˜èƒ½å¤Ÿå˜èº«ä¸ºç™½é¾™ï¼Œè¿™æ¬¡ç™½é¾™ç­æƒ¨äº†ã€‚è¯´åˆ°è¿™é‡Œï¼Œå¿½ç„¶å¬è§æ¥¼ä¸‹ä¸€ç‰‡åµæ‚å£°éŸ³ä¼ æ¥ï¼Œæ¥ç€ä¸€ä¸²æ…Œå¼ çš„è„šæ­¥å£°ï¼Œæœ‰äººè·‘äº†ä¸Šæ¥ã€‚</p>
<p>é£é€¸å¯¹è·‘ä¸Šæ¥çš„å­¦ç”Ÿå¼é“ï¼šâ€œæ˜¯ä»€ä¹ˆå¤§ä¸äº†çš„äº‹æŠŠä½ æ€¥æˆè¿™æ ·ï¼Œæ…Œä»€ä¹ˆï¼Ÿä»€ä¹ˆäº‹ï¼Œå¿«è¯´ï¼â€</p>
<p>æ€¥æ­¥è·‘ä¸Šæ¥çš„æ˜¯ç´®æƒ‘æµ®å’Œå‡Œç©†ã€‚ç´®æƒ‘æµ®æ°”å–˜ååçš„è¯´ï¼šâ€œé£â€¦â€¦é£é€¸è€å¸ˆï¼Œæœ‰â€¦â€¦æœ‰ä½è€å¸ˆæ­»äº†ã€‚â€</p>
<p>é£é€¸å¤§åƒä¸€æƒŠï¼Œé—®é“ï¼šâ€œæ…¢æ…¢è¯´ï¼ä¸è¦æ…Œï¼Œé‚£è€å¸ˆæ˜¯æ€ä¹ˆæ­»çš„ï¼Ÿç—…æ­»çš„å—ï¼Ÿâ€</p>
<p>å‡Œç©†è¯´ï¼šâ€œä¸æ˜¯ï¼Œä¸æ˜¯çš„ã€‚åˆšæ‰æˆ‘å’Œç´®æƒ‘æµ®åœ¨é£èˆ¹å¤–é¢æ•£æ­¥ï¼Œå¬è§å¤§å®¶æ­£åœ¨å¤–é¢è®®è®ºçº·çº·ï¼Œè¯´ä¸€ä¸ªè€å¸ˆè¢«äººæ€æ­»äº†ã€‚æˆ‘ä»¬èµ¶ç´§å›åˆ°é£èˆ¹å†…ï¼ŒæŸ¥åˆ°ç™½é¾™ç­å¯¹è¿™ä»¶äº‹æƒ…çš„æŠ¥é“ï¼Œçœ‹åˆ°é‚£ä½è€å¸ˆçš„èƒ¸è„¯è¢«åˆ’å¼€ï¼Œå†…è„æŠ›åœ¨ä¸€æ—ï¼Œè¡€æµæ»¡åœ°ã€‚çœŸçš„å¥½æƒ¨å•Šï¼â€</p>
<p>é£é€¸å€’å¸äº†ä¸€å£æ°”ï¼Œæ–¹å¯¸ä¹±æäº†ã€‚åœäº†ä¸€ä¼šï¼Œå¥¹å¯¹ç´®æƒ‘æµ®å’Œå‡Œç©†è¯´ï¼šâ€œä½ ä»¬èµ¶å¿«è”ç³»æ˜æœå­¦åºœå†…é˜å’Œå…¶å®ƒçš„ç­çº§ã€‚å°†æ­¤äº‹èµ¶å¿«ä¸ŠæŠ¥å†…é˜å’Œé€šå‘Šæ‰€æœ‰äººã€‚â€</p>
<p>å‡Œç©†å’Œç´®æƒ‘æµ®åº”äº†ä¸€å£°æ€¥å¿™å¥”å‘ä¸‹å±‚æ‰§è¡Œå‘½ä»¤å»äº†ã€‚é£é€¸å’Œæš´ä¹Ÿç´§è·Ÿå¥¹ä»¬èµ°åˆ°ä¸‹å±‚ã€‚</p>
<p>é£é€¸è„¸ä¸Šå†’ç€å†·æ±—ï¼Œèµ°åˆ°ä¸‹å±‚ï¼Œåœ¨â€˜ç™½ç¾½å·â€™çš„ä¸­å¤®æ§åˆ¶å®¤é‡Œèšé›†èµ·å¥¹çš„æˆå‘˜å’Œå­¦ç”Ÿã€‚</p>
<p>ç´®æƒ‘æµ®å¾ˆå¿«è·‘è¿‡æ¥ï¼Œå¥¹æŠ¥å‘Šé£é€¸ï¼šâ€œæˆ‘ä»¬è¿æ¥ä¸ä¸Šå¤–éƒ¨ç½‘ç»œï¼Œä¸èƒ½å’Œå¤–éƒ¨è¿›è¡Œé€šè®¯ã€‚åªæœ‰ç™½é¾™ç­çš„å†…éƒ¨ç½‘ç»œè¿˜èƒ½ç”¨ã€‚â€</p>
<p>å¿½ç„¶å¬åˆ°æœ‰äººæƒŠå«ç€è·‘è¿›æ¥ï¼šâ€œå“å‘€ï¼Œåˆä¸€ä¸ªè€å¸ˆæ­»äº†ï¼ä¹Ÿæ˜¯èƒ¸è„¯è¢«åˆ’å¼€ã€‚å¥½å¯æ€•å‘€ï¼â€</p>
<p>é£é€¸å’Œç´®æƒ‘æµ®ç­‰äººåŒæ—¶ä¸€æƒŠã€‚é£é€¸çš„å£°éŸ³å¸¦ç€é¢¤æŠ–å‘½ä»¤é“ï¼šâ€œä½ â€¦â€¦ä½ ä»¬èµ¶ç´§â€¦â€¦æŠŠé£èˆ¹çš„å¤§é—¨å…³å¥½â€¦â€¦â€</p>
<p>ä¼—äººçº·çº·è·‘å‘é£èˆ¹å¤§é—¨ã€‚</p>
<p>è¿™æ—¶ä¸­å¤®æ§åˆ¶å®¤é‡Œè¿˜å‰©ä¸‹é£é€¸ï¼Œæš´ï¼Œç´®æƒ‘æµ®ï¼Œæœˆæ¹–çš„å¦¹å¦¹åŠæœˆå’Œè´µå…¬å­å¾·æ–¯ï¼Œå…¶ä»–æˆå‘˜å…³å¥½é£èˆ¹å¤§é—¨ï¼Œå¸¦é¢†ç€é›‡ä½£å…µå„å°±å„ä½ï¼Œæ•´ä¸ªé£èˆ¹è¿›å…¥çº¢è‰²è­¦æˆ’çŠ¶æ€ã€‚</p>
<p>å¾·æ–¯è¿™æ—¶çœ‹åˆ°é£é€¸ä¸€è„¸ç´§å¼ ï¼Œè‡ªè¨€è‡ªè¯­åœ°è¯´ï¼šâ€œè¿æ­»äº†ä¸¤ä¸ªè€å¸ˆï¼Œé£é€¸è€å¸ˆä¹Ÿå®³æ€•äº†å‘€ã€‚â€</p>
<p>â€œå¾·æ–¯ï¼Œä½ æ˜¯æ€ä¹ˆå›äº‹ï¼Œè¿™ä¸ªæ—¶å€™è¿˜èƒ¡ä¹±è¯´è¯ã€‚â€ç´®æƒ‘æµ®åˆ¶æ­¢å¾·æ–¯ä¹±è¯´ï¼Œæ˜¯è¦ç¼“å’Œç´§å¼ å½¢åŠ¿ï¼Œç¨³å®šå¤§å®¶æƒ…ç»ªã€‚</p>
<p>é£é€¸æ‹äº†æ‹ç´®æƒ‘æµ®çš„è‚©è†€ï¼Œæ„æ€æ˜¯èµæ‰¬å¥¹åšå¾—å¯¹ã€‚ç„¶åå¥¹å¯¹å¾·æ–¯è¯´ï¼šâ€œä½ è¯´çš„å¾ˆå¯¹ï¼Œæˆ‘ç¡®å®æ˜¯æœ‰äº›å®³æ€•ã€‚æˆ‘å’Œå…¶ä»–è€å¸ˆä»¬çŠ¯äº†ä¸€ä¸ªæ— æ³•åŸè°…çš„é”™è¯¯ï¼Œåœ¨æ²¡æœ‰è°ƒæŸ¥æ¸…æ¥šäº‹æƒ…çš„æƒ…å†µä¸‹ï¼Œä¸ºäº†é¡¾å…¨æˆ‘ä»¬ç™½é¾™ç­çš„åèª‰è¯¯æ€äº†ç±³ç”Ÿã€‚ç±³ç”Ÿç¡®å®ç½ªä¸è¯¥æ­»ã€‚è¿™æ¬¡é›ªå¶æ‰¾æˆ‘ä»¬æŠ¥ä»‡æ¥äº†ã€‚â€</p>
<p>å¬äº†é£é€¸è€å¸ˆçš„è¯ï¼Œé™¤äº†æš´ä»¥å¤–ï¼Œå…¶ä»–äººå‡æ„Ÿåˆ°éœ‡æƒŠã€‚</p>
<p>å¾·æ–¯è¯´ï¼šâ€œé›ªå¶ç¦»å¼€æˆ‘ä»¬å·²ç»ä¸‰å¹´å¤šäº†ï¼Œå¥¹ä»€ä¹ˆæ—¶å€™å›æ¥çš„ï¼Ÿå¥¹å‡­ä»€ä¹ˆæœ¬äº‹èƒ½å¤Ÿæ€æ­»ç™½é¾™ç­çš„è€å¸ˆï¼Ÿâ€</p>
<p>æš´åé—®å¾·æ–¯è¯´ï¼šâ€œå¦‚æœæ˜¯æœˆæ¹–ï¼Œå¥¹èƒ½åŠåˆ°å—ï¼Ÿâ€</p>
<p>å¾·æ–¯æ›´å¤§æƒ‘ä¸è§£äº†ï¼Œå¥¹è¯´ï¼šâ€œè¿™å’Œæœˆæ¹–åˆæœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿå¦‚æœæ˜¯æœˆæ¹–é‚£æˆ‘å°±ä¸æ•¢è¯´äº†ã€‚å“¼ï¼æˆ‘çœŸå¼„ä¸æ‡‚ï¼Œæœˆæ¹–åˆ°åº•æ˜¯å‡­ä»€ä¹ˆè¿›æ­¥è¿™ä¹ˆå¿«çš„ï¼Ÿæ˜¯å‡­å¥¹çš„çœŸæœ¬äº‹è¿˜æ˜¯é å…¶ä»–ä¸‹ä¸‰çƒ‚æ‰‹æ®µã€‚â€</p>
<p>æš´å¸¦ç€ç§ä¸èµ·çš„è¯­æ°”é—®å¾·æ–¯è¯´ï¼šâ€œä½ å¬è¯´è¿‡â€˜é˜´é˜³äºŒæ°”è¯€â€™è¿™ä¸ªé­”æ³•æ²¡æœ‰ï¼Ÿâ€</p>
<p>å¾·æ–¯ä¸å±‘åœ°ç­”é“ï¼šâ€œè¿™è°ä¸çŸ¥é“ï¼Œâ€˜é˜´é˜³äºŒæ°”è¯€â€™æ˜¯æ–‘å›½ç­è€å¸ˆå°¤ç§‘æ–¯åˆ›é€ çš„é­”æ³•ï¼Œèƒ½å¤Ÿå’Œåˆ«äººåˆä¸ºä¸€ä½“å€Ÿç”¨ä»–äººçš„èƒ½åŠ›â€¦â€¦â€</p>
<p>å¾·æ–¯è¯´ç€è¯´ç€å¥½åƒæ˜ç™½äº†ä»€ä¹ˆï¼Œä»–è¯é¢˜ä¸€è½¬ï¼Œè¯´ï¼šâ€œéš¾é“â€¦â€¦â€</p>
<p>â€œä¸é”™ï¼Œé›ªå¶å°±æ˜¯ç”¨è¿™é­”æ³•å’Œæœˆæ¹–åˆä½“äº†ï¼Œç°åœ¨ï¼Œå¥¹çŸ¥é“äº†ç±³ç”Ÿçš„æ­»å› ï¼Œæ‰€ä»¥å¥¹â€¦â€¦â€æš´æŠŠé›ªå¶å¦‚ä½•ä¸æœˆæ¹–åˆä½“ï¼Œå¦‚ä½•åŠªåŠ›å‡çº§è·å–æŸ¥é˜…å­¦ç”Ÿæ¡£æ¡ˆçš„èµ„æ ¼ï¼Œå¦‚ä½•æŸ¥é˜…ç§˜å¯†æ¡£æ¡ˆçœ‹åˆ°ç±³ç”Ÿè¢«å¤„æ­»çš„æƒ…æ™¯çš„äº‹ä»å¤´è‡³å°¾ç®€ç•¥åœ°è§£è¯´äº†ä¸€éã€‚</p>
<p>åŠæœˆå¬åä¸ä¿¡ï¼Œæ€¥å¿™è¯´é“ï¼šâ€œä¸ä¼šçš„ï¼Œä½ éª—äººï¼æˆ‘å§å§æ€ä¹ˆä¼šè¢«é›ªå¶åˆä½“å‘¢ï¼Ÿå¦‚æœä½ è¿™æ ·è¯´æ˜¯çœŸçš„ï¼Œé‚£æˆ‘å§å§ä¸å°±æ­»äº†å—ï¼Ÿâ€</p>
<p>çªç„¶ï¼Œé£èˆ¹è¢«ä»€ä¹ˆé‡é‡æ’äº†ä¸€ä¸‹ï¼Œå‰§çƒˆæ™ƒåŠ¨èµ·æ¥ã€‚ç”±äºæ²¡æœ‰å‡†å¤‡ï¼Œå¤§å®¶ä¸€ä¸‹å­ç«™ç«‹ä¸ç¨³ï¼Œè·Œå€’åœ°ä¸Šã€‚é£é€¸çˆ¬èµ·æ¥ï¼Œè¿…é€Ÿæ‰“å¼€è§†é¢‘å¯Ÿçœ‹é£èˆ¹å¤–æƒ…å†µï¼ŒæŸ¥æ‰¾é£èˆ¹è¢«æ’çš„åŸå› ã€‚å¥¹çœ‹è§é£èˆ¹å¤–é¢ç‹¼è—‰ä¸€ç‰‡ï¼Œå…¶ä»–å°å‹é£èˆ¹å¾ˆå¤šå·²è¢«ç ´åï¼Œåœ°ä¸Šåˆ°å¤„éƒ½æ˜¯æ­»äººï¼Œè‚‰è¡€å°†åœ°é¢å‡ ä¹å…¨æŸ“çº¢äº†ï¼Œæœ‰å¾ˆå¤šå­¦å‘˜å’Œé›‡ä½£å…µåœ¨å¥”è·‘é€ƒå‘½ã€‚</p>
<p>åŠæœˆåœ¨è§†é¢‘ä¸­çœ‹åˆ°å¤–é¢çš„æ™¯è±¡ï¼Œå“å¾—å“†å“†å—¦å—¦åœ°è¯´ï¼šâ€œæˆ‘ä»¬å¾—â€¦â€¦å¾—æƒ³ã€‚ã€‚ã€‚æƒ³ç‚¹åŠæ³•ï¼Œè¿™æ ·ä¸‹å»â€¦â€¦ç™½é¾™ç­ã€‚ã€‚ã€‚å²‚ã€‚ã€‚ã€‚å²‚ä¸æ˜¯è¦æ¯äº†ã€‚â€</p>
<p>é£é€¸è¯´ï¼šâ€œä¸è¦æ…Œï¼å¤§å®¶éƒ½ååˆ°å„è‡ªæ§åˆ¶å°é‡Œå»ï¼Œæ³¨æ„ç›‘è§†é£èˆ¹å‘¨å›´ï¼Œå‘ç°æœ‰ç›®æ ‡æ”»å‡»é£èˆ¹å°±å¯¹å®ƒå¼€ç‚®ã€‚â€</p>
<p>ç­‰äº†å››ã€äº”ä¸ªå°æ—¶æ—¶é—´ï¼Œå§‹ç»ˆæ²¡å‘ç°ç›®æ ‡ã€‚è¿™æ—¶å¤©è‰²æ¸æ¸æš—ä¸‹æ¥ã€‚å‡Œç©†ï¼Œå°ä¾ƒï¼Œåæˆ¿æ˜Ÿï¼Œå®‹è—é‡‘ï¼Œæ˜“æ…§ç­‰æˆå‘˜å›åˆ°ä¸­å¤®æ§åˆ¶å®¤ã€‚</p>
<p>å‡Œç©†å¯¹é£é€¸è¯´ï¼šâ€œå…¨éƒ¨é›‡ä½£å…µéƒ½å®‰ç½®åˆ°å²—äº†ï¼Œæœºå™¨äººå…µä¹Ÿå…¨éƒ¨é›†ä¸­åœ¨æœºå™¨äººèˆ¹èˆ±å€™å‘½äº†ã€‚â€</p>
<p>é£é€¸è¯´ï¼šâ€œç™½é¾™ç­çš„å†…éƒ¨ç½‘ç»œé€šè®¯åäº†ï¼Œæˆ‘ä»¬åœ¨èˆ¹å†…ï¼Œä¹Ÿä¸çŸ¥é“å¤–é¢çš„æƒ…å†µæ€ä¹ˆæ ·äº†ã€‚ç°åœ¨å¤©é»‘äº†ï¼Œæš´å’Œç´®æƒ‘æµ®å‡ºå»è°ƒæŸ¥ä¸€ä¸‹ã€‚æˆ‘ç°åœ¨è¦å»æˆ‘æˆ¿é—´é‡Œç¼–å†™å‡ å¥—åº”å¯¹å˜èº«ç™½é¾™å’Œæ–‘å›½ç­é­”æ³•çš„ç¨‹åºã€‚å‡Œç©†ï¼æ§åˆ¶å®¤è¿™é‡Œäº¤ç»™ä½ äº†ï¼Œå¦‚æœå‘ç°å¤–é¢æœ‰æ”»å‡»ï¼Œå°±æŒ‰ç…§æˆ‘æ•™ç»™ä½ çš„æ–¹æ¡ˆå®æ–½é˜²å¾¡å’Œåå‡»ã€‚å¾…ä¼šæˆ‘ä¼šå°†æ–°æ–¹æ¡ˆä¼ ç»™ä½ ã€‚â€</p>
<p>æš´å’Œç´®æƒ‘æµ®æ€¥å¿™æ¥åˆ°æœºå™¨äººèˆ±ã€‚ä¸€ä¼šå„¿ï¼Œæœºå™¨äººèˆ¹èˆ±èˆ±é—¨æ‰“å¼€ï¼Œâ€œå—–â€“å—–â€“å—–â€“â€åæ¥ä¸ªæœºå™¨äººä»èˆ¹èˆ±é£äº†å‡ºå»ã€‚ç´®æƒ‘æµ®é©¾é©¶ç€é‡äº§æœºå™¨äººåœ¨å‰å¸¦è·¯ï¼Œæš´é©¾é©¶ç€å¥¹çš„â€˜ç™½è‰³å…¬ä¸»â€™æœºå™¨äººç´§è·Ÿå…¶åï¼Œé›‡ä½£å…µæœºå™¨äººæ’æˆä¸€å­—é˜µå‹è·Ÿéšç€ä»–ä»¬ã€‚å¤œå¹•å·²ç»é™ä¸´ï¼Œä»–ä»¬æ‰“å¼€æ¢ç…§ç¯ï¼Œçœ‹åˆ°æ»¡å±±éé‡å°½æ˜¯å°¸ä½“ï¼Œæ²³æ°´å·²è¢«è¡€æ°´æŸ“çº¢ã€‚å½“ä»–ä»¬æ¥åˆ°ç¢‘äº­é‚£é‡Œçš„åäººå ‚æ—¶ï¼Œä¸€è¿›é—¨å°±è¿œè¿œçœ‹è§ä¸­é—´é‚£ä¸ªå¢“ç¢‘æœ‰åˆšè¢«åŠ¨è¿‡çš„è¿¹è±¡ï¼Œæ—è¾¹æœ‰ä¸€å…·éª¸éª¨ã€‚æœºå™¨äººåœ¨å¢“ç¢‘é™„è¿‘åœä¸‹æ¥ï¼Œä¸€è¡Œäººä»æœºå™¨äººé‡Œèµ°å‡ºæ¥ã€‚</p>
<p>ç´®æƒ‘æµ®å‘½ä»¤ä¸€ä¸ªä½£å…µï¼šâ€œä½ ï¼Œå»å¢“ç¢‘é‚£ç§ç§ã€‚â€</p>
<p>é‚£ä½£å…µå‘å‰èµ°äº†ä¸¤ä¸‰æ­¥ï¼Œæƒ³åˆ°æ²¿è·¯çœ‹åˆ°é‚£äº›æƒ¨æ™¯ï¼Œé¡¿è§‰è…¿è„šå‘è½¯ï¼Œä¸çŸ¥è„šä¸‹è¢«ä»€ä¹ˆç»Šäº†ä¸€ä¸‹ï¼Œä¾¿è·Œå€’åœ°ä¸Šï¼Œç„¶åçˆ¬èµ·æ¥å°±æé€Ÿè½¬èº«å¾€å›è·‘ã€‚</p>
<p>â€œæ²¡ç”¨çš„ä¸œè¥¿ï¼Œä½ æ€•ä»€ä¹ˆï¼Ÿäºä½ è¿˜æ˜¯æˆ‘ä»¬ç™½é¾™ç­çš„å…µï¼â€ ç´®æƒ‘æµ®æ°”æ„¤åœ°å¼é“ã€‚ä»–ä¸€è„šå°†è¿™ä½£å…µè¸¢å¼€ï¼Œæ‹¿è¿‡ä¸€åªæ¢ç…§ç¯ï¼Œèµ°è¿‘ç¢‘å‰ï¼Œç”¨ç¯ä¸€ç…§ï¼Œçœ‹è§ç¢‘ä¸Šå†™çš„æ–‡å­—ï¼Œå°–å«ä¸€å£°ï¼ŒæŠ›ä¸‹æ¢ç…§ç¯ï¼Œå“å¾—åªå¾€åé€€ã€‚å…¶ä»–ä½£å…µå¬åˆ°è¿™å°–å«å£°ä¸ªä¸ªå“å¾—æµ‘èº«å‘æŠ–ï¼Œçº·çº·ä¸¢æ‰æ‰‹ä¸­ç¯ï¼Œç›´å¾€åé€€ã€‚æš´ä¸æ˜ç™½æ˜¯æ€ä¹ˆå›äº‹ï¼Œä¸€ä¸ªäººæ‹¿ç€ç¯æœ¨å‘†çš„ç«™åœ¨ä¸€æ—ã€‚</p>
<p>ç´®æƒ‘æµ®é¢¤æŠ–ç€å£°éŸ³å¯¹æš´è¯´ï¼šâ€œè¿™æ˜¯å‘å‰è¾ˆçš„åŸå¢“ï¼Œç¢‘ä¸Šçš„åå­—ï¼Œæ€åœ°â€¦â€¦æ€ä¹ˆâ€¦â€¦â€</p>
<p>â€œåˆ«æ…Œï¼Œæˆ‘æ¥çœ‹çœ‹ï¼â€ æš´è¯´ã€‚å¥¹ä¸€ç›´éƒ½é•‡å®šè‡ªè‹¥ï¼Œæ­¤æ—¶è¨€è¯­ä¸­ä¹Ÿé€å‡ºå‡ åˆ†æƒŠæ…Œæ¥ã€‚æš´æ‹¿ç€ç¯èµ°åˆ°å¢“å‰ï¼Œå¼¯è…°å¯Ÿçœ‹ã€‚ â€œç±³ã€‚ã€‚ã€‚ç±³ç”Ÿã€‚â€å¥¹è¯´ï¼Œâ€œè¿™é›ªå¶ç«Ÿç„¶æŠŠè¿™åŸå¢“æŒ–äº†ï¼ŒæŠŠç±³ç”Ÿçš„å°¸ä½“åŸ‹åˆ°è¿™é‡Œäº†ã€‚çœ‹æ¥å¥¹æ˜¯ç–¯äº†ï¼Œç°åœ¨è¿˜æƒ³ç€è¦ç±³ç”Ÿæˆä¸ºç™½é¾™ç­çš„åäººã€‚â€</p>
<p>ä¸€ä¸ªä½£å…µå¸¦ç€å‘é¢¤çš„å£°éŸ³é—®é“ï¼šâ€œé‚£æ—è¾¹çš„éª¨éª¸æ˜¯â€¦â€¦æ˜¯ä¸æ˜¯â€¦â€¦å‘å‰è¾ˆçš„â€¦â€¦â€</p>
<p>ä»–çš„è¯è¿˜æ²¡è¯´å®Œï¼Œå¿½ç„¶å¬è§è¿œå¤„ä¼ æ¥ä¸€é˜µé˜µå¥³äººçš„ç‹‚ç¬‘å£°ï¼Œç¬‘å£°è¿‡åï¼Œä¸€é˜µæ²‰å¯‚ã€‚åœ¨è¿™æ— å£°æ— æ¯çš„æ—¶å€™ï¼Œæ¯ä¸ªäººçš„å¿ƒéƒ½åœ¨é¢¤æŠ–ã€‚å¤§å®¶å±ä½å‘¼å¸ï¼Œä»”ç»†è¾¨è§†å››å‘¨æƒ…å†µã€‚</p>
<p>åªå¬æš´å¤§å«ä¸€å£°ï¼šâ€œä¸å¥½ï¼â€å¥¹æ‰‹ä¸­çš„ç¯â€œå“å™¹â€ä¸€å£°æ‰åœ¨åœ°ä¸Šï¼Œé‚£äº›ä½£å…µè§çŠ¶ï¼Œå››å¤„ä¹±è·‘å¼€å»ã€‚æš´å’Œç´®æƒ‘æµ®æ‰‹æ‹‰ç€æ‰‹ï¼ŒèƒŒé ç€èƒŒï¼Œæ‰‹ä¸­æ‹¿ç€æ­¦å™¨ï¼Œåšå¥½è¿æ•Œçš„å‡†å¤‡ã€‚çªç„¶ï¼Œä¼ æ¥ä¸€é˜µä½£å…µçš„æƒ¨å«å£°ï¼Œå…¶ä¸­è¿˜æ‚æœ‰é‡å…½çš„æ€’å¼å£°ï¼Œå£°éŸ³åƒæ˜¯å¾ˆè¿œï¼Œåˆåƒå°±åœ¨èº«è¾¹å‘ç”Ÿã€‚ä¸€ä¼šï¼Œåˆé™äº†ä¸‹æ¥ã€‚æš´å¯¹èƒŒåçš„ç´®æƒ‘æµ®è¯´ï¼šâ€œç´®æƒ‘æµ®å‰è¾ˆï¼Œæˆ‘ä»¬åœ¨æ˜å¤„ï¼Œæ•Œäººåœ¨æš—å¤„ï¼Œæˆ‘ä»¬è¢«åŠ¨ï¼Œå¿«ç‚¹èµ°å§ã€‚â€åŠå“ï¼Œç´®æƒ‘æµ®æ²¡æœ‰ç­”è¯ï¼Œæš´å¿ƒæƒ³ï¼šâ€œç´®æƒ‘æµ®æ˜¯ä¸æ˜¯æ„åœ¨å«æˆ‘ä¸è¦å‡ºå£°ï¼Œå¾…æ•Œäººèµ°è¿œæˆ‘ä»¬å†èµ°ï¼Ÿâ€</p>
<h2 id="é›ªå¶å¯¹å†³æš´"><a href="#é›ªå¶å¯¹å†³æš´" class="headerlink" title="é›ªå¶å¯¹å†³æš´"></a>é›ªå¶å¯¹å†³æš´</h2><p>æƒ³åˆ°è¿™é‡Œï¼Œæš´å¿ƒé‡Œå¹³é™ä¸‹æ¥ï¼Œè½¬è¿‡è„¸å»ï¼Œçœ‹åˆ°ç´®æƒ‘æµ®æœ¨ç„¶ä¸åŠ¨ã€‚æš´æ„Ÿè§‰ä¸å¯¹åŠ²ï¼Œå¾€åœ°ä¸‹ä¸€çœ‹ï¼Œæœˆå…‰ä¸‹å¿½ç„¶å‘ç°æœ‰ä¸ªå¾ˆå¤§çš„é¾™çˆªå°ã€‚æš´å¿ƒé‡Œä¸€æƒŠï¼Œèº«å­ä¸€è½¬ï¼Œç´®æƒ‘æµ®çš„èº«ä½“å¤±å»æ”¯æ’‘å€’åœ¨äº†åœ°ä¸Šï¼Œåœ°ä¸Šèººç€çš„ç´®æƒ‘æµ®èƒ¸å£å·²è¢«åˆ’ç ´ã€‚å¥¹æŠ¬å¤´ä¸€çœ‹ï¼Œæœˆæ¹–æ¨¡æ ·çš„é›ªå¶æ­£å¨æ­¦åœ°ç«™åœ¨æš´çš„é¢å‰ã€‚</p>
<p>æš´è¿™æ—¶å·²ç»ä¸çŸ¥é“å®³æ€•äº†ï¼Œå¥¹é•‡å®šåœ°è¯´ï¼šâ€œé›ªå¶ï¼Œä½ ä¹Ÿæƒ³æ€äº†æˆ‘å—ï¼Ÿä½ ä»Šå¤©æ€äº†è¿™ä¹ˆå¤šäººï¼Œä»–ä»¬å¤§å¤šæ•°å¯¹ç±³ç”Ÿçš„æ˜¯ä¸çŸ¥æƒ…çš„ï¼Œä½ ä¸ºä»€ä¹ˆè¿™æ ·æ®‹é…·ï¼Ÿæ»¥æ€æ— è¾œï¼â€</p>
<p>é›ªå¶è¯´ï¼šâ€œä½ æ€ä¹ˆè¯´éƒ½æ²¡æœ‰ç”¨ï¼Œæˆ‘çš„æ€æƒ³ç°åœ¨å·²ç»ä¸å®Œå…¨å±äºæˆ‘äº†ã€‚æ€äººçš„ä¸€ç¬é—´ï¼Œæˆ‘çš„æ€æƒ³æ˜¯å°¤ç§‘æ–¯æ§åˆ¶çš„ã€‚ä½†æ˜¯æˆ‘ä¸åæ‚”ï¼Œæˆ‘æ¨ç™½é¾™ç­ï¼Œæ¨é‡Œé¢æ‰€æœ‰çš„äººï¼Œå…¶ä¸­ä¹ŸåŒ…æ‹¬ä½ ï¼ä½ ä¸è¦ä»¥ä¸ºé£é€¸å–œæ¬¢ä½ ï¼Œä½ å°±æœ‰å¤šä¹ˆäº†ä¸èµ·ã€‚æˆ‘ç°åœ¨å°±ç”¨ç™½é¾™ç­çš„åŠŸå¤«å’Œä½ è¾ƒé‡ä¸€ä¸‹ï¼Œçœ‹çœ‹ä½ åˆ°åº•æœ‰å¤šå¼ºã€‚â€</p>
<p>æš´è¯´ï¼šâ€œæˆ‘ä»æ¥æ²¡è¯´æˆ‘æ¯”ä½ å¼ºï¼åœ¨å­¦åºœçš„å‡çº§ç«èµ›ä¸­å·²ç»è¯æ˜äº†ä½ æœ€å¼ºã€‚æˆ‘å½“ç„¶ä¸æ˜¯ä½ çš„å¯¹æ‰‹ã€‚â€</p>
<p>é›ªå¶è¯´ï¼šâ€œé‚£æ˜¯å› ä¸ºä½ ç§ä¸èµ·æˆ‘ï¼Œä»¥ä¸ºä¸å±‘å’Œæˆ‘ä¸€æ¯”ï¼Œæ”¾å¼ƒäº†å‚åŠ å‡çº§ç«èµ›ã€‚ç°åœ¨æˆ‘éè¦ä½ å’Œæˆ‘æ¯”ä¸€æ¯”ä¸å¯ï¼â€</p>
<p>è¯´å®Œï¼Œé›ªå¶åŒè„šè·³èµ·ï¼ŒæŒ¥èµ·ç™½é¾™çˆªåŒåˆ€å¥‹åŠ›å‘æš´ç å»ã€‚æš´ä¾§èº«å·¦æ»šç¿»ï¼Œèº²è¿‡è¿™ä¸€åˆ€ã€‚ç„¶ååŠè·ªåœ°ä¸Šï¼Œè¿…é€Ÿæ‹”å‡ºèƒŒåçš„é¾™çˆªé•¿åˆ€ï¼Œä¸€åœºé•¿åˆ€å¯¹åŒåˆ€çš„å†³æ–—å¼€å§‹äº†ã€‚é›ªå¶çš„åŒåˆ€è™½ç„¶æ²¡æœ‰æš´çš„é•¿åˆ€é‚£ä¹ˆé•¿ï¼Œå´åˆ©äºè¿‘èº«ä¿æŠ¤ï¼Œè€Œä¸”å‡ºæ‹›é¢‘ç‡æ¯”é•¿åˆ€é«˜è®¸å¤šã€‚é›ªå¶è¿™æ—¶ä½¿å‡ºç™½é¾™ç­ä¸Šä½çš„è¾…åŠ©é­”æ³•â€œè²æ­¥è½»èˆâ€ï¼Œä½¿å¾—æœ¬å°±å‡ºæ‹›é€Ÿåº¦å¾ˆå¿«çš„åŒåˆ€å˜å¾—æ›´å¿«ã€‚æš´æ‰€æŒçš„é•¿åˆ€èˆåŠ¨èŒƒå›´å¤§ï¼Œè™½è¿›æ”»é¢‘ç‡ä¸é«˜ï¼Œä½†å’Œé›ªå¶çš„åŒåˆ€ä¸€æ ·å–„äºé˜²å¾¡ã€‚æš´ä¾¿ç”¨ç™½é¾™ç­ä¸‹ä½æ‹›å¼â€œç™½é¾™èŠ±å¦–â€ï¼Œ å¥‹åŠ›èˆåŠ¨é•¿åˆ€å·¦å³ä¸Šä¸‹æŠµæŒ¡è¿›æ”»ï¼Œâ€œå™¹â€“å™¹ï¼Œå™¹â€“å™¹â€ï¼Œç«æ˜Ÿå››æº…ã€‚é›ªå¶ä¸æ–­é€¼è¿«ï¼Œæš´æ¸æ¸æ˜¾å¾—æ‹›æ¶ä¸ä½ï¼Œä½†å¥¹æƒ…æ€¥ä¸æ…Œï¼Œå½“é›ªå¶ä¸æ–­å°†æ”»å‡»é¢‘ç‡è°ƒé«˜ï¼Œç›´åˆ°é¢‘ç‡å¿«åˆ°æœ€é«˜ç‚¹æ”¶ä¸ä½æ‰‹æ—¶ï¼Œæš´å°†åŒæ‰‹æ¡åˆ€æ”¹ä¸ºåªæ‰‹æ¡åˆ€ï¼Œèº«å­æ¥ä¸€ä¸ªä¸€ç™¾å…«ååº¦å¤§æ—‹è½¬ï¼Œè¿…é€Ÿå°†åˆ€ä¸€ä¸‹æ”¶å›ï¼Œå†æ¥æ—‹è½¬ä¸€ä¸ªä¸€ç™¾å…«ååº¦ï¼Œè·¨å‰ä¸€æ­¥ï¼ŒåŒæ‰‹æ¡åˆ€ï¼Œä¸€ä¸ªåŠæœˆæ–©ç å‘é›ªå¶èƒŒéƒ¨ï¼Œé›ªå¶è¿™æ—¶ç”±äºè¿›æ”»é€Ÿåº¦å¤ªå¿«ï¼Œèº«ä½“ç›´å‘å‰å†²ï¼Œæ¡åˆ€çš„åŒæ‰‹æ¥ä¸åŠæ”¶å›ï¼Œçœ¼çœ‹æš´çš„é•¿åˆ€å°±è¦å°†è‡ªå·±ä¸€åŠˆä¸¤åŠï¼Œåªå¾—çŒ›åœ°å‘å‰ä¸€æ‰‘ã€‚æš´çš„è¿™ä¸€ç é…ä¸Šäº†â€œç»è‰²ä¸ƒå½©â€é‡Œâ€œä¸–å¤–æ¡ƒæºâ€é­”æ³•ï¼Œä½¿å¾—é»‘æš—çš„å¤œç©ºäº®å‡ºä¸€ç‰‡ç‰‡æ¡ƒèŠ±å¹»å½±ï¼Œæ¡ƒèŠ±ç“£è¢«æš´çš„åŠæœˆæ–©çš„ä½™æ³¢åˆ’æˆä¸¤åŠç‰‡ç‰‡è½ä¸‹ï¼Œé•¿åˆ€ä¸€ç›´ç å‘é›ªå¶çš„èƒŒéƒ¨ï¼Œé›ªå¶è™½ç„¶çŒ›å‘å‰å†²ï¼Œä½†ä»æ²¡èº²è¿‡è¿™ä¸€åˆ€ï¼Œåªæ˜¯æ²¡è¢«ç æ–­èº«ä½“ã€‚ä½†ç”±äºé›ªå¶ä»Šå¤©æ²¡ç©¿å± é¾™æŠ¤èº«è¡£ï¼Œç»“æœèƒŒéƒ¨è¢«åˆ’å¼€ä¸€æ¡å¤§å£å­ï¼Œæ‰‘çš„æ¶Œå‡ºè¡€æ¥ã€‚é›ªå¶ä¸€åªæ‰‹æ’‘ç€åœ°é¢ï¼Œå¦ä¸€åªæ‰‹èƒŒå‘èº«åæ‚ä½èƒŒä¸Šçš„ä¼¤å£è½¬è¿‡èº«æ¥ï¼Œå£ä¸­å«ç€è¡€ï¼Œçœ¼ç›æ¶ç‹ ç‹ åœ°çœ‹ç€æš´ã€‚æš´ç«™åœ¨é‚£é‡Œæ‰‹æ¡é•¿åˆ€å²¿ç„¶ä¸åŠ¨ã€‚</p>
<p>é›ªå¶å°†å£ä¸­çš„è¡€å¾€åœ°ä¸Šä¸€åï¼ŒæŠ¬èµ·æ‰‹è…•ç”¨è¢–å­æ‹­å»å£è§’çš„è¡€è¿¹ï¼Œå¯¹æš´è¯´ï¼šâ€œä½ ç«Ÿç„¶åªç”¨ç™½é¾™ç­ä¸‹ä½æ‹›å¼å°±èƒ½å¤Ÿå‡»ä¸­æˆ‘ï¼Œä½©æœï¼â€</p>
<p>æš´å¿ƒæƒ³ï¼šâ€œé›ªå¶æœ¬å°±ä¸æ“…é•¿ç™½é¾™ç­çš„æ­¦åŠŸï¼ŒåŒåˆ€å¯¹ä»˜èº«ä½“åºå¤§è¡ŒåŠ¨ç¼“æ…¢çš„äººæ¯”è¾ƒåˆé€‚ï¼Œè€Œå¥¹å´ä½¿ç”¨åŒåˆ€è¿™ç§æ­¦å™¨å¯¹ä»˜æˆ‘è¿™ä¸ªæœºçµçš„å¥³å­ï¼Œè¿™è¯´æ˜å¥¹ä½¿ç”¨ç™½é¾™ç­çš„æ­¦åŠŸè¿˜ä¸å¤Ÿå¨´ç†Ÿã€‚ä½†æ˜¯å¦‚æœå¥¹ä½¿ç”¨æ–‘å›½ç­çš„é­”æ³•ï¼Œæˆ‘å°±æ²¡æ³•å¯¹ä»˜äº†ï¼Œå¥¹ç«èµ›æ—¶éƒ½æ˜¯ç”¨æ–‘å›½ç­çš„é­”æ³•æˆ˜èƒœçš„å¯¹æ‰‹ã€‚å¦‚ä»Šæˆ‘ç”Ÿæ­»æ”¸å…³ï¼Œè¯¥æ€æ ·å¯¹ä»˜å¥¹å‘¢ï¼Ÿâ€</p>
<p>é›ªå¶çœ‹æš´ç«™åœ¨å¯¹é¢æ­£çŠ¹è±«ä¸å†³ï¼Œå¥¹å¯¹æš´è¯´ï¼šâ€œæˆ‘åˆšæ‰è¯´äº†ï¼Œè¿™æ¬¡æˆ‘åªç”¨ç™½é¾™ç­çš„åŠŸå¤«å’Œä½ æ¯”è¯•ã€‚æˆ‘è¯´è¯ç®—æ•°ï¼Œæˆ‘è®¤è¾“äº†ã€‚â€</p>
<p>æš´æ¾äº†ä¸€å£æ°”ï¼Œå°†æ¡ç´§é•¿åˆ€çš„æ‰‹æ¾å¼€äº†ã€‚</p>
<p>é›ªå¶å¿½ç„¶ç‹‚ç¬‘ç€é“ï¼šâ€œæˆ‘è™½ç„¶è¾“äº†ï¼Œä½†æ˜¯ä½ çš„å‘½æˆ‘è¿˜æ˜¯è¦çš„ã€‚å“ˆå“ˆï¼â€</p>
<p>æš´ä¸€å“ï¼Œæ¡åˆ€çš„æ‰‹é©¬ä¸Šåˆç´§äº†èµ·æ¥ã€‚</p>
<h2 id="é£é€¸ä¹‹æ­»"><a href="#é£é€¸ä¹‹æ­»" class="headerlink" title="é£é€¸ä¹‹æ­»"></a>é£é€¸ä¹‹æ­»</h2><p>ç™½ç¾½å·é£èˆ¹é‡Œï¼Œé£é€¸æ­£åœ¨å¥¹çš„æˆ¿é—´é‡Œç¼–å†™ç¨‹åºï¼Œçªç„¶å±å¹•ä¸Šé¢å¼¹å‡ºæ¶ˆæ¯ï¼šæš´è¯·æ±‚é£èˆ¹å¼€èˆ±ã€‚é£é€¸å¯å¼€é£èˆ¹å¤–ç›‘è§†å±å¹•ï¼Œçœ‹è§åªæœ‰æš´é©¾é©¶çš„â€˜ç™½è‰³å…¬ä¸»â€™æœºå™¨äººåœ¨é£èˆ¹å¤–ç©ºå¾˜å¾Šï¼Œç´®æƒ‘æµ®å’Œå…¶ä»–ä½£å…µçš„æœºå™¨äººéƒ½æ²¡çœ‹è§ã€‚é£é€¸æ‹¨é€šä¸­å¤®æ§åˆ¶å®¤ï¼Œä¸å‡Œç©†é€šè¯ã€‚</p>
<p>é£é€¸çš„å½¢è±¡å‡ºç°åœ¨ç™½ç¾½å·é£èˆ¹ä¸­å¤®æ§åˆ¶å®¤å¤§å±å¹•ä¸Šï¼Œå¥¹å¯¹å‡Œç©†è¯´ï¼šâ€œå¬æˆ‘çš„å‘½ä»¤ï¼Œåƒä¸‡ä¸è¦å¼€èˆ±ï¼Œå¾…æˆ‘è§‚å¯Ÿè§‚å¯Ÿå†ä½œå†³å®šã€‚â€</p>
<p>å°èƒ–æ˜“æ…§å¥‡æ€ªçš„è¯¢é—®é“ï¼šâ€œä¸ºä»€ä¹ˆä¸å¼€èˆ±å•Šï¼Ÿä½ è¿™ä¸æ˜¯è¦å®³æ­»æš´å—ï¼Ÿâ€</p>
<p>é£é€¸è¯´ï¼šâ€œä½ ä»¬å¬æˆ‘çš„å°±è¡Œäº†ã€‚ä¸ç”¨é—®é‚£ä¹ˆå¤šï¼â€</p>
<p>æ˜“æ…§éå¸¸ç”Ÿæ°”ï¼Œç¤ºæ„å°ä¾ƒå»åŠé£é€¸è€å¸ˆï¼Œå°ä¾ƒè§æ²¡äººæ•¢åå¯¹é£é€¸ï¼Œä»–ä¹Ÿå°±åƒæ²¡çœ‹åˆ°å°æ˜“çš„ç¤ºæ„ä¸€æ ·æ²¡æœ‰å­å£°ã€‚</p>
<p>é£é€¸æ…Œå¿™å°†ç¼–å†™å®Œæˆçš„éƒ¨åˆ†ç¨‹åºä¼ ç»™å‡Œç©†ï¼Œå¦å¤–è¿˜é™„ä¸Šäº†å‡ åå¥—åº”å¯¹ä¸åŒæƒ…å†µçš„æ–¹æ¡ˆã€‚å‡Œç©†ä»”ç»†ç¢ç£¨è¿™äº›æ–¹æ¡ˆæ¥ã€‚æ„Ÿåˆ°è¿™äº›æ–¹æ¡ˆé¢„æƒ³åˆ°äº†æ‰€æœ‰å¯èƒ½å‘ç”Ÿçš„æƒ…å†µï¼Œè¶Šå‘ä½©æœèµ·é£é€¸è€å¸ˆæ¥äº†ã€‚</p>
<p>å‡Œç©†å¿ƒæƒ³ï¼šâ€œé£é€¸ä¸æ„§æ˜¯ç™½ç¾½å·çš„è®¾è®¡å¸ˆï¼Œå¥¹å¯¹ç™½ç¾½å·æ¯å¤„è®¾ç½®æ¯ä¸ªéƒ¨ä»¶éƒ½äº†å¦‚æŒ‡æŒï¼Œåªæœ‰å¥¹æ‰èƒ½å¤Ÿå†™å‡ºè¿™ä¹ˆå¥½çš„åº”å¯¹æ–¹æ¡ˆæ¥ã€‚éš¾æ€ªæ•Œäººä¸€ç›´ä¸æ•¢å¯¹ç™½ç¾½å·åŠ¨æ‰‹ã€‚ä»¥å‰é™¤äº†é£é€¸ä»¥å¤–ï¼Œå¯¹ç™½ç¾½å·è¿™ä¹ˆäº†è§£çš„åªæœ‰æš´ã€‚ç°åœ¨é£é€¸æ€€ç–‘æš´è¢«é›ªå¶ç”¨â€˜é˜´é˜³äºŒæ°”è¯€â€™åˆä½“äº†ï¼Œä¸è®©è¿›å…¥é£èˆ¹æ¥ï¼Œæˆ‘å¯ä»¥ä¹˜è¿™ä¸ªæœºä¼šå¥½å¥½äº†è§£ä¸€ä¸‹ç™½ç¾½å·ã€‚é£é€¸ç¡®å®æ˜¯åˆ¶é€ é£èˆ¹çš„å¤©æ‰ï¼Œå¥¹ä½¿ç”¨å…¶ä»–ç™½é¾™ç­é£èˆ¹æ²¡æœ‰çš„æ–°æŠ€æœ¯ï¼Œåœ¨ç™½ç¾½å·é£èˆ¹ä¸Šè£…å¤‡äº†éš”çƒ­èƒ¶ä½“ï¼Œå› æ­¤é£èˆ¹å¯ä»¥è¿›å…¥å¤§æ°”åœˆï¼›å®ƒè¡¨é¢è¿˜è£…å¤‡äº†å å±‚è£…ç”²ï¼Œå› æ­¤åœ¨æˆ˜æ–—ä¸­ä¸æ˜“è¢«å‡»æ¯ã€‚åœ¨æ­¦å™¨è£…å¤‡æ–¹é¢ï¼Œç™½ç¾½å·ä¸»è¦çš„æ­¦å™¨æ˜¯åŒé‡é˜³ç”µå­ç ´åŸç‚®ï¼Œå®‰è£…åœ¨é£èˆ¹â€œä¸¤è…¿â€çš„å‰ç«¯ã€‚ç™½ç¾½å·é£èˆ¹è¿˜è£…å¤‡æœ‰å…¶ä»–ä¸€ç³»åˆ—æ­¦å™¨ï¼Œä¾‹å¦‚â€˜è²å°”å¾·â€™å…‰æŸç‚®ï¼Œâ€˜ç“¦å†·ç‰¹â€™çº¿æ€§æªï¼Œâ€˜è‰¾æ ¼æ–¯æ‹‰æ ¼â€™å·´å°”å¹²ç‚®ï¼Œè¿˜æœ‰å¤§é‡é£å¼¹å‘å°„ç®¡ã€‚è¿™äº›éƒ½æ˜¯ç™½é¾™ç­çš„è‘—åå‰è¾ˆç²¾å¿ƒç ”ç©¶çš„å­¦æœ¯æˆæœï¼Œé£é€¸å­¦ä¹ å’Œç»§æ‰¿ä»–ä»¬çš„æˆæœï¼Œå¹¶åŠ ä»¥æ”¹è¿›ï¼Œç„¶åéƒ½ç”¨åˆ°äº†ç™½ç¾½å·ä¸Šï¼Œä½¿å¾—è¿™ä¸ªæˆ˜æ–—æ€§é£èˆ¹æˆä¸ºç™½é¾™ç­åå‰¯å…¶å®çš„æœ€ä¼˜ç§€çš„é£èˆ¹ã€‚åªå¯æƒœç™½ç¾½å·é£èˆ¹é€ ä»·å®åœ¨å¤ªé«˜ï¼Œæ— æ³•æ‰¹é‡ç”Ÿäº§ï¼Œä¸ç„¶ï¼Œæˆ‘ä»¬ç™½é¾™ç­è¿˜å®³æ€•å…¶ä»–äººæ¥ä¾µçŠ¯å—ï¼Ÿâ€</p>
<p>æš´çœ‹ç™½ç¾½å·è¿Ÿè¿Ÿä¸å¼€èˆ±ï¼Œå¼€å¯è§†é¢‘é€šè¯å‘¼å«ã€‚æš´è¿™æ—¶å‡ºç°åœ¨ç™½ç¾½å·ä¸­å¤®æ§åˆ¶å®¤å¤§å±å¹•ä¸Šï¼Œå¥¹ç¥æƒ…ç´§å¼ åœ°å–Šé“ï¼šâ€œé£é€¸è€å¸ˆï¼Œè¯·ä½ èµ¶å¿«ç»™æˆ‘æ‰“å¼€èˆ±é—¨ï¼Œé›ªå¶é©¬ä¸Šå°±è¦è¿½è¿‡æ¥äº†ã€‚â€</p>
<p>é£é€¸åœ¨é£èˆ¹é‡Œçœ‹åˆ°å±å¹•ä¸Šæš´ç„¦æ€¥çš„æ ·å­ï¼Œå¿ƒæƒ³ï¼šâ€œè£…å¾—çœŸå¤Ÿåƒçš„ï¼Œå½“å¹´é›ªå¶ä½ æ‰®æœˆæ¹–ç’äº†æˆ‘é‚£ä¹ˆä¹…ï¼Œä»Šå¤©è¿˜æƒ³è£…æ‰®æˆæš´å†æ¥éª—æˆ‘å—ï¼Ÿå¦‚æœçœŸçš„è¿˜æœ‰å¦å¤–ä¸€ä¸ªé›ªå¶è¿½ä½ ï¼Œå¥¹æ—©å°±è¯¥è¿½æ¥äº†ï¼Œè¿˜èƒ½ç»™ä½ è¿™ä¹ˆå¤šæ—¶é—´ã€‚ä½•å†µé‚£ä¹ˆå¤šäººéƒ½æ­»äº†ï¼Œæš´æ€ä¹ˆå¯èƒ½ä¸€ä¸ªäººå›æ¥ï¼Ÿé›ªå¶å•Šé›ªå¶ï¼Œä½ ä»¥ä¸ºæˆ‘åçˆ±æš´å°±ä¼šå¯¹æš´æ”¾æ¾è­¦æƒ•ï¼Œä½ å°±æƒ³åˆ©ç”¨åˆä½“æš´æ··è¿›é£èˆ¹ï¼Œå¦‚æ­¤å°ä¼ä¿©è¿˜æƒ³éª—æˆ‘ï¼Œä½ å¤ªå°çœ‹æˆ‘äº†ï¼â€</p>
<p>é£é€¸åœ¨å¤§å±å¹•ä¸Šå¯¹å‡Œç©†ä¸‹å‘½ä»¤è¯´ï¼šâ€œå‡Œç©†ï¼Œå®æ–½æ–¹æ¡ˆä¸€ï¼Œç«‹å³å‘æš´æ”»å‡»ã€‚â€</p>
<p>å‡Œç©†å‘½ä»¤æœºå™¨äººä½£å…µéƒ¨é˜Ÿå‡ºåŠ¨ï¼Œå››å°ç»„æˆä¸€é˜Ÿï¼Œæ´¾å‡ºå…«é˜Ÿï¼Œé˜µå‹ä¸ºæ¯ä¸¤é˜Ÿå æ®ä¸œè¥¿å—åŒ—ä¸€æ–¹ï¼Œæ¯æ–¹å‘æœ‰ä¸¤é˜Ÿï¼Œè¿™ä¸¤é˜Ÿå†å›´æˆä¸€ä¸ªå°æ–¹åœˆã€‚è¿™æ ·ä¾¿åœ¨åŒä¸€ä¸ªå¹³é¢ä¸Šåšåˆ°äº†å¤©è¡£æ— ç¼ï¼Œä¸ºé˜²æ­¢è¢«å›°æ•Œäººå‘ä¸Šé£è¡Œä»¥æ±‚è„±é€ƒï¼Œç”±ç™½ç¾½å·é£èˆ¹ç›‘è§†é˜µå‹ä¸Šä¸‹æ–¹ï¼Œå®ƒçš„åŒé‡é˜³ç”µå­ç ´åŸç‚®åˆ†åˆ«è£…åœ¨é£èˆ¹å·¦å³ä¸¤ä¾§å·¨å¤§çš„â€œé•¿è…¿â€ä¸Šï¼Œå·¦ä¾§è´Ÿè´£ä¸Šæ–¹ï¼Œå³ä¾§è´Ÿè´£ä¸‹æ–¹ã€‚æš´çœ‹è§è¿™å…«é˜Ÿæœºå™¨äººï¼Œæ’ç€æ•´æ•´é½é½çš„é˜Ÿå½¢å‘è‡ªå·±å†²è¿‡æ¥ï¼Œè¿˜æ²¡ç­‰ä»–ä»¬å±•å¼€é˜µåŠ¿ï¼Œæš´ç«‹å³é©¾é©¶â€˜ç™½è‰³å…¬ä¸»â€™æœºå™¨äººå¾€åä¸€è½¬ï¼ŒåŠ å¤§é©¬åŠ›è¿…é€Ÿåæ’¤ï¼Œä¹Ÿä¸é«˜é£ï¼Œä¹Ÿä¸é™ä½ã€‚é‚£å…«é˜Ÿæœºå™¨äººå°†é˜µå‹å±•å¼€ï¼Œå›´ä½â€˜ç™½è‰³å…¬ä¸»â€™ï¼Œä¸æ–­å‘å®ƒå¼€ç«ã€‚å½“ç«åŠ›é›†ä¸­åˆ°ä¸€ç‚¹æ—¶ï¼Œæš´æ€¥é€Ÿä¸€ä¾§èº«ï¼ŒåŒæ—¶æ¥ä¸ªå¤§ç¿»è½¬ï¼Œæå‡ºé«˜èƒ½é‡å…‰æŸæ­¥æªï¼Œå¯¹å‡†æœ€å·¦ä¾§ä¸€æ¶æœºå™¨äººè¿å‘äº”æªç™¾åˆ†ä¹‹äºŒè·Ÿè¸ªå…‰é€Ÿå¼¹å°†å…¶æ‰“å¾—ç²‰ç¢ã€‚å¦‚æ­¤åå¤æ•°æ¬¡ï¼Œä¸€è¡Œä¸‰åäºŒæ¶æœºå™¨äººåªå‰©ä¸‹äº†äºŒåæ¥æ¶ã€‚</p>
<p>é£é€¸çœ‹åˆ°è¿™é‡Œå¤§å‘é›·éœ†ï¼Œå¥¹å¼é“ï¼šâ€œåºŸç‰©ï¼Œä½ ä»¬è¿™ç¾¤é›‡ä½£å…µæ˜¯æ€ä¹ˆè®­ç»ƒçš„ï¼Œä¸‰åå¤šæ¶å±…ç„¶æ²¡æ³•å›´ä½ä¸€å°æœºå™¨äººã€‚â€</p>
<p>å‡Œç©†çœ‹ç€å±å¹•ä¸Šçš„æˆ˜æ–—ç”»é¢ï¼Œå¿ƒæƒ³ï¼šâ€œé£é€¸å¹³æ—¥æå°‘é¡¾åŠç™½ç¾½å·ä¸Šé›‡ä½£å…µçš„è®­ç»ƒï¼Œé‚£æ˜¯å› ä¸ºå¥¹è‡ªå·±åªæ³¨æ„é‡ç‚¹å°–å­ï¼Œåˆå‡ ä¹å°†æ‰€æœ‰æ—¶é—´éƒ½ç”¨åˆ°è®¾è®¡é£èˆ¹å’Œæ”¹è¿›é£èˆ¹ä¸Šäº†ï¼Œè¿™ç‚¹å¥¹è‡ªå·±åº”è¯¥ååˆ†æ¸…æ¥šã€‚å¥¹è¿™æ ·çš„å‘ç«ï¼Œæ— éæ˜¯å› ä¸ºæš´çš„é©¾é©¶æŠ€æœ¯è¿œè¿œé«˜äºè¿™ç¾¤é›‡ä½£å…µï¼Œä»–ä»¬æœªèƒ½æŠŠæš´å¼•å…¥ç™½ç¾½å·çš„å°„ç¨‹ï¼Œä½¿å¾—é£é€¸å¼•ä»¥ä¸ºè±ªçš„ç™½ç¾½å·æ— æ³•å‘æŒ¥å¨åŠ›ç½¢äº†ã€‚â€</p>
<p>è¿‡äº†ä¸€ä¼šï¼Œé£é€¸è§é›‡ä½£å…µæœºå™¨äººå®åœ¨æ— èƒ½ï¼Œä¾¿å¯¹å‡Œç©†è¯´ï¼šâ€œå°†â€˜å·¦è…¿â€™ç ´åŸç‚®å°„å‘æ°´å¹³æ–¹å‘ã€‚â€</p>
<p>å‡Œç©†å¬åˆ°è¿™è¯ååˆ†ä¸è§£ï¼Œè¯´ï¼šâ€œé‚£äº›é›‡ä½£å…µæ€ä¹ˆåŠã€‚â€</p>
<p>   â€œè¿™æ ·è€—ä¸‹å»ï¼Œä»–ä»¬è¿Ÿæ—©éƒ½è¦è¢«å‡»æ¯™ï¼Œè¿˜ä¸å¦‚è®©ä»–ä»¬çš„ç‰ºç‰²èµ·äº›ä½œç”¨ã€‚â€ é£é€¸ä¸è€çƒ¦çš„è¯´ã€‚</p>
<p>â€œæˆ‘è§‰å¾—è¿™æ ·åšå¾ˆä¸å¥½ã€‚â€å‡Œç©†å¿™è¯´ï¼Œâ€œè¿™æ ·åšä¸€æ¥ä¼šå¼•èµ·è¿˜åœ¨ç™½ç¾½å·é‡Œçš„å…¶ä»–é›‡ä½£å…µä¸æ»¡ï¼Œè‡´ä½¿ç™½ç¾½å·å†…éƒ¨äººå¿ƒæµ®åŠ¨ã€‚äºŒæ¥ï¼Œç ´åŸç‚®å°„å‡»èŒƒå›´å¤§ï¼Œå¯æ˜¯å°„é€Ÿå´å¾ˆæ…¢ã€‚å®ƒå¯¹äºå‘ä¸Šçˆ¬é«˜å’Œå‘ä¸‹ä¿¯å†²çš„æœºå™¨äººï¼Œå› ä¸ºä»–ä»¬ä¸­é€”æ— æ³•æ€¥é€Ÿæ”¹å˜æ–¹å‘ï¼Œå°„é€Ÿæ…¢çš„å€’ä¸æ˜¯é—®é¢˜ã€‚ä½†æ˜¯å¯¹äºå¤„äºæ°´å¹³é£è¡Œçš„æœºå™¨äººï¼Œè­¦å‘Šæç¤ºä¸€å‡ºç°ï¼Œå®ƒåªè¦é©¬ä¸Šæœä¸Šæˆ–å‘ä¸‹ä¸€é£ï¼Œå¾ˆè½»æ¾åœ°å°±èƒ½èº²è¿‡ç ´åŸç‚®çš„å°„å‡»ã€‚â€</p>
<p>é£é€¸å¬å®Œå‡Œç©†è¿™ç•ªè¯ï¼Œç¬‘ç€è¯´é“ï¼šâ€œå‡Œç©†ï¼Œæˆ‘æ²¡æœ‰çœ‹é”™ä½ ï¼Œä½ ä¸æ„§æ˜¯ä¸ªå¥½å­¦ç”Ÿã€‚ä½†æ˜¯ä½ å¤šè™‘äº†ï¼ç°åœ¨æ˜¯ä½•ç­‰æƒ…å†µï¼Ÿä½ çœ‹ç°åœ¨ï¼Œæ•´ä¸ªç™½é¾™ç­å‡ ä¹å°±è¦ç­äº¡ï¼Œæ— æ•°é›‡ä½£å…µå…„å¼Ÿéƒ½å·²æˆ˜æ­»ã€‚ç°åœ¨ä»–ä»¬å¿ƒé‡Œæƒ³çš„å°±åªæœ‰æ¶ˆç­æ•Œäººçš„å¿µå¤´ã€‚çœ¼å‰è¿™ç‚¹ç‰ºç‰²ç®—å¾—äº†ä»€ä¹ˆï¼Ÿä½ è¯´çš„ç¬¬äºŒä¸ªé—®é¢˜ç¡®å®å­˜åœ¨ã€‚æˆ‘ä»¬åŒæ—¶å¼€å¯ä¸¤ä¾§çš„ç”µå­ç ´åŸç‚®ï¼Œé›ªå¶ï¼ˆæš´èº«ï¼‰ä¸ä¼šçŸ¥é“æ‰“å¥¹çš„ç‚®æ˜¯ç„å‘ä¸Šæ–¹è¿˜æ˜¯å‘ä¸‹æ–¹çš„ã€‚æˆ‘ä»¬ç°åœ¨ç”¨ç„å‘ä¸Šæ–¹çš„å·¦ä¾§ç ´åŸç‚®å‘æ°´å¹³æ–¹å‘å‘å°„ã€‚ç™½ç¾½å·å¤§èŒƒå›´çš„ç‚®é™¤äº†è¿™ä¸¤å°ç ´åŸç‚®å¤–ï¼Œç™½ç¾½å·ä¸­éƒ¨è¿˜æœ‰ä¸€å°â€˜è‰¾æ ¼æ–¯æ‹‰æ ¼â€™å·´å°”å¹²ç‚®å°„å‡»èŒƒå›´æœ€å¤§ã€‚ä½†ç™½ç¾½å·æ­¤å‰å°šæœªåšå¥½ä½œæˆ˜å‡†å¤‡ï¼Œç°åœ¨é£èˆ¹çš„èƒ½é‡è¿˜ä¸è¶³ä»¥å¼€å¯è¿™å°å·´å°”å¹²ç‚®ï¼Œä¸ç„¶è¿™æ¬¡é›ªå¶å®šæ­»æ— ç–‘ã€‚å°‘äº†è¿™å°å¤§ç‚®ï¼Œä¸ºé˜²æ­¢å¥¹å‘ä¸Šé€ƒï¼Œæˆ‘ä»¬å°±å¯ç”¨æ‰©éœ°å¼¹å¤´é£å¼¹ï¼Œæ¥æ‰“å¥¹ä¸ªå¤©ç½—åœ°ç½‘ã€‚â€</p>
<p>å‡Œç©†è¯´ï¼šâ€œé£é€¸è€å¸ˆè€ƒè™‘å¾—å‘¨åˆ°ï¼Œæˆ‘é©¬ä¸Šç…§åšã€‚â€</p>
<p>è¿™æ—¶ï¼Œå¤§å±å¹•ä¸Šçªç„¶å‡ºç°æš´çš„å¤´åƒï¼Œæš´è¯´ï¼šâ€œæˆ‘æ˜¯æš´å•Šï¼Œä½ ä»¬åœ¨å¹²ä»€ä¹ˆï¼Œé£é€¸è€å¸ˆâ€¦â€¦â€æ¥ç€è®¯å·çªç„¶æ¶ˆå¤±ï¼Œå¦ä¸€ä¾§å±å¹•ä¸Šæ˜¾ç¤ºæš´åˆä¸€ä¸ªçªç„¶è½¬èº«å°†å¦ä¸€å°æœºå™¨äººå‡»æ¯™ã€‚</p>
<p>é£é€¸å¯¹å‡Œç©†è¯´ï¼šâ€œä¸è¦çŠ¹è±«ï¼Œèµ¶ç´§æ‰§è¡Œå‘½ä»¤ï¼â€</p>
<p>å‡Œç©†ç«‹åˆ»è°ƒå¥½æ§åˆ¶å°ä¸Šæ•°æ®ï¼Œç ´åŸç‚®è½°åœ°ä¸€å£°å°„å‘é›‡ä½£å…µæœºå™¨äººå’Œæš´çš„â€˜ç™½è‰³å…¬ä¸»â€™ï¼Œæš´é©¾é©¶ç€â€˜ç™½è‰³å…¬ä¸»â€™è¿…é€Ÿå‘ä¸Šæ–œé£è¿‡å»ï¼Œâ€˜ç™½è‰³å…¬ä¸»â€™æ­£å‡†å¤‡å‘ä¸Šçˆ¬é«˜é£è¡Œï¼Œå‘ç°èº«è¾¹æœ‰é¢—ä¸è‡ªå·±å¹¶æ’é£è¡Œçš„æ‰©éœ°å¼¹å¤´ï¼Œä¾¿ä¼¸æ‰‹æŠ“ä½å®ƒï¼Œç”¨åŠ›æŠ›å‘ä¸‹æ–¹ï¼Œæ‰©éœ°å¼¹åœ¨è¢«æŠ›å‡ºçš„ç¬é—´çˆ†ç‚¸æ•£å¼€ï¼Œå´æ¯«æœªä¼¤åŠâ€˜ç™½è‰³å…¬ä¸»â€™ã€‚åŸæ¥è¿™æ‰©éœ°å¼¹æ˜¯é£é€¸ç‰¹åˆ«ç ”åˆ¶çš„å®šæ—¶ç‚¸å¼¹ï¼Œæ‰©éœ°å¼¹çš„çˆ†ç‚¸æ—¶é—´æ­£æ˜¯ç™½é›ªå…¬ä¸»å‘ä¸Šçˆ¬é«˜é£è¡Œçš„æ—¶é—´ï¼Œåœ¨è¿™å³å°†çˆ†ç‚¸çš„ä¸€ç¬é—´æš´æ­£å¥½æŠ“ä½æ‰©éœ°å¼¹å¹¶å‘ä¸‹æŠ›å»ï¼Œå› æ­¤æŠ›å‡ºå°±çˆ†ç‚¸äº†ã€‚å‘ä¸‹æŠ›çš„åŸå› æ˜¯ï¼Œè¿™æ‰©éœ°å¼¹ä¸ºäº†æ‰©å¤§çˆ†ç‚¸èŒƒå›´ï¼Œçˆ†ç‚¸çš„æ—¶å€™æ˜¯æ‰©æ•£å‘ä¸‹ï¼Œä¸‹æ–¹ç™¾ç±³èŒƒå›´å…¨è¢«è¦†ç›–ã€‚</p>
<p>é£é€¸çœ‹åˆ°å±å¹•ä¸Šçš„æƒ…æ™¯ï¼Œæ€¥å¿™èµ¶åˆ°ä¸­å¤®æ§åˆ¶å®¤å»ï¼Œå¥¹è¦äº²è‡ªæ“ä½œå°„å‡»ã€‚</p>
<p>é£é€¸ç«™åœ¨å‡Œç©†æ—å¯¹å¥¹è¯´ï¼šâ€œæˆ‘è¿™äºŒåå…­ä¸ªæ–¹æ¡ˆé‡Œé¢ï¼Œå‰åä¸ªæ˜¯ç™½ç¾½å·é…åˆæœºå™¨äººéƒ¨é˜Ÿå¯¹ä»˜ä¸€åˆ°åä¸ªæ•°ç›®æ•Œäººçš„æˆ˜ç•¥ï¼Œä»åä¸€åˆ°åä¹æ˜¯ç™½ç¾½å·é…åˆä¸€åç‹ç‰Œé©¾é©¶å‘˜å¯¹ä»˜ä¸€ä¸ªå¼ºå¤§æ•Œäººçš„æˆ˜ç•¥ï¼ŒäºŒååˆ°äºŒåå…­æ˜¯ç™½ç¾½å·é…åˆä¸¤åç‹ç‰Œé©¾é©¶å‘˜å¯¹ä»˜ä¸€ä¸ªå¼ºå¤§æ•Œäººçš„æˆ˜ç•¥ã€‚å¦‚ä»Šç™½ç¾½å·é‡Œèƒ½å¤Ÿç§°å¾—ä¸Šç‹ç‰Œçš„é©¾é©¶å‘˜å°±åªæœ‰ä½ å’Œæˆ‘äº†ï¼Œæˆ‘ä»¬ç°åœ¨å¼€å§‹å®æ–½ç¬¬åä¸€å·æ–¹æ¡ˆï¼Œä½ èµ¶ç´§å»é©¾é©¶ä½ çš„æœºå™¨äººå‡ºå»æŒ‰ç…§é¢„å®šæ–¹æ¡ˆä¸æ•Œäººå‘¨æ—‹ï¼Œä¸æˆ‘éšæ—¶ä¿æŒé€šè®¯è”ç»œã€‚â€</p>
<p>é£é€¸é©¬ä¸Šåœ¨æ§åˆ¶å°äº²è‡ªè°ƒæ•´éƒ¨ç½²èµ·ç™½ç¾½å·æ¥ã€‚</p>
<p>å‡Œç©†èµ°åˆ°ä¸­å¤®æ§åˆ¶å®¤é—¨å£ï¼ŒåˆçŠ¹ç–‘åœ°è½¬è¿‡èº«æ¥å¯¹é£é€¸è¯´ï¼šâ€œä»åˆšæ‰æš´çš„ä¸¾åŠ¨çœ‹ï¼Œå¥¹å¯¹ä½ çš„æ–¹æ¡ˆååˆ†äº†è§£ï¼Œä½ è¿˜è®¤ä¸ºå¥¹æ˜¯é›ªå¶å—ï¼Ÿâ€</p>
<p>é£é€¸åŒæ‰‹æ’‘åœ¨æ§åˆ¶å°ä¸Šï¼Œç¼“ç¼“æ‰­è¿‡å¤´æ¥ï¼Œä½†å¥¹è„¸æœä¸‹ä½ç€å¤´ï¼Œå¹¶æ²¡çœ‹å‡Œç©†ä¸€çœ¼ï¼Œåªæ˜¯ä½å£°è¯´ï¼šâ€œè¿™äº›æˆ‘å¿ƒé‡Œæœ‰æ•°ï¼Œä½ ç…§æˆ‘çš„è¯åšå°±æ˜¯äº†ï¼Œä¸å¿…å¤šé—®ï¼â€å‡Œç©†æ‹…å¿ƒåœ°è¯´é“ï¼šâ€œå¦‚æœå¥¹ä¸æ˜¯é›ªå¶ï¼Œæˆ‘ä»¬è¿™æ ·åšâ€¦â€¦é‚£â€¦â€¦â€</p>
<p>é£é€¸å’¬äº†å’¬ä¸‹å˜´å”‡ï¼Œçªå¤§çœ¼ç›çœ‹ç€å‡Œç©†è¯´ï¼šâ€œæ€ä¹ˆè¯´å‘¢ï¼Ÿæˆ‘ä¹‹æ‰€ä»¥ä¸€ç›´æ€€ç–‘æš´æ˜¯é›ªå¶ï¼Œæ˜¯å› ä¸ºåˆ°ç°åœ¨é›ªå¶çš„çœŸèº«éƒ½æœªå‡ºç°ï¼Œæˆ‘çœŸæ‹…å¿ƒå¥¹å°†æˆ‘è·Ÿæš´è®²çš„é‚£äº›ä¸œè¥¿éƒ½å­¦äº†è¿‡å»ï¼Œå…¶ä¸­ä¹ŸåŒ…æ‹¬è¿™äºŒåå…­å¥—ç™½ç¾½å·ä½œæˆ˜æ–¹æ¡ˆã€‚â€</p>
<p>å‡Œç©†é»˜é»˜ç‚¹äº†ç‚¹å¤´ï¼Œå°±ä»€ä¹ˆå†ä¹Ÿæ²¡æœ‰è¯´ï¼Œå¤§æ­¥è·¨å‡ºäº†å¤§é—¨ã€‚</p>
<p>é£é€¸æ§åˆ¶ç€ç™½ç¾½å·å’Œé©¾é©¶æœºå™¨äººçš„å‡Œç©†é…åˆï¼Œå°†é‚£ä¹å¥—æ–¹æ¡ˆä¹±åºæ’åˆ—ä½¿äº†ä¸ªéï¼Œç»“æœéƒ½è¢«æš´ç ´è§£äº†ã€‚é£é€¸é©¬ä¸ŠæŠŠæ˜“æ…§å«åˆ°æ§åˆ¶å°å‰ã€‚</p>
<p>é£é€¸è¯´ï¼šâ€œç°åœ¨å½¢åŠ¿éå¸¸ä¸¥å³»ï¼Œæˆ‘ç°åœ¨å°†ç™½ç¾½å·äº¤ç»™ä½ æ¥æ“ä½œã€‚â€</p>
<p>æ¥ç€é£é€¸å¼€å¯äºŒåä»¥åçš„æ–¹æ¡ˆï¼ŒæŒ‡ç€å±å¹•å¯¹æ˜“æ…§è¯´ï¼šâ€œæˆ‘ç°åœ¨é©¾é©¶æœºå™¨äººå‡ºå»å¸®åŠ©å‡Œç©†ï¼Œä½ æŒ‰ç…§æç¤ºè¿›è¡Œè®¾ç½®é€‰æ‹©ï¼Œå¥½å¥½é…åˆæˆ‘ä»¬å¯¹æ•Œä½œæˆ˜ã€‚éšæ—¶ä¿æŒè”ç»œï¼ŒæŒ‰ç…§æˆ‘çš„å‘½ä»¤è¿›è¡Œæ“ä½œï¼Œä¸è¦éšä¾¿è‡ªå·±å†³å®šï¼Œæœ‰ç–‘é—®ä¸€å®šè¦å…ˆé—®æˆ‘ï¼Œä¸ç„¶æˆ‘ä»¬å°±éƒ½å®Œäº†ã€‚â€</p>
<p>æ˜“æ…§ç¬‘ç€æ¥å—äº†ä»»åŠ¡ï¼Œå¹¶å«é£é€¸æ”¾å¿ƒï¼Œé£é€¸è¿˜æ˜¯æœ‰äº›æ‹…å¿ƒï¼Œè™½ç„¶çŠ¹è±«ä¸å†³ï¼Œä½†å¥¹è¿˜æ˜¯æ¯…ç„¶é©¾é©¶èµ·æœºå™¨äººé£å‡ºäº†ç™½ç¾½å·èˆ±é—¨ã€‚</p>
<p>é£é€¸é©¾é©¶ç€æœºå™¨äººé…åˆç™½ç¾½å·å’Œå‡Œç©†ä½¿ç”¨äº†ä¸¤ä¸‰å¥—æ–¹æ¡ˆåï¼Œæš´ç»ˆäºè¢«å‡»ä¸­ï¼Œæš´çš„â€˜ç™½è‰³å…¬ä¸»â€™å·¦è‡‚è¢«æ‰“çƒ‚ã€‚è¿™æ—¶è¿œå¤„çªç„¶ä¼ æ¥ä¸€é˜µé˜µé‡å…½èˆ¬çš„å¼å«å£°ï¼Œç¬æ—¶ä¸€é“ç™½å…‰ä»é»‘æš—ä¸­é—ªç”µèˆ¬åˆ’è¿‡ï¼Œä¸€æ¡å¤§ç™½é¾™ï¼Œæ‘‡æ‘†ç€è›‡å½¢èº«èº¯æ€¥é€Ÿè¿‡æ¥ï¼Œéšä¹‹ä¼ æ¥ä¸€å£°å·¨å¤§çš„è¸å‡»å£°ï¼Œå‡Œç©†çš„æœºå™¨äººè¢«è¸©æ‰ï¼Œæ¥ç€ï¼Œè½°éš†ä¸€å£°ï¼Œç‚¸å¾—ç²‰ç¢ã€‚</p>
<p>é£é€¸è¿™ä¸€ç¬é—´æ‰æ˜ç™½è¿‡æ¥ï¼Œæš´æ²¡æœ‰è¢«é›ªå¶åˆä½“ï¼Œé›ªå¶åˆ©ç”¨å¥¹çš„é˜²èŒƒç–‘å¿ƒï¼Œèº²åœ¨ä¸€æ—åå±±è§‚è™æ–—ï¼Œè®©å¥¹è‡ªå·±æŠŠå¥¹è¾›è‹¦åŸ¹å…»çš„æš´æ€äº†ï¼Œè¿™æ—¶å¥¹å¿ƒä¸­æ‚”æ¨äº¤åŠ ï¼Œæ„Ÿåˆ°åæ‚”æäº†ã€‚</p>
<p>é£é€¸å¤±å£°å¤§å«å‡Œç©†å’Œç´®æƒ‘æµ®çš„åå­—ï¼Œå«å£°æ‚²æ„¤å‡„æƒ¨ã€‚</p>
<p>ç™½é¾™åœåœ¨é£é€¸é©¾é©¶çš„æœºå™¨äººé¢å‰ï¼Œå°†å¤´å‘åä¸€æ˜‚ï¼Œå–‰å’™é‡Œå‘å‡ºå’•å™œå’•å™œçš„å£°éŸ³ã€‚é£é€¸ç«‹åˆ»é•‡é™ä¸‹æ¥ï¼Œå½“ç™½é¾™å¼ å£æ²¿æ–œä¸‹å››åäº”åº¦è§’å–·å‡ºç«æŸ±æ—¶ï¼Œå¥¹å¼€å¯æœºå™¨äººèƒŒéƒ¨å‘ä¸Šå–·æ°”è£…ç½®ï¼Œæœºå™¨äººç«‹åˆ»å‘ä¸‹ä¿¯å†²èº²è¿‡ç«æŸ±ï¼Œå°±åœ¨å‘ä¸‹ä¿¯å†²çš„ç¬é—´ï¼Œé£é€¸è®©æœºå™¨äººå‘æš´çš„â€˜ç™½è‰³å…¬ä¸»â€™æ‰€åœ¨çš„åœ°é¢å¼€å‡ºä¸€ç‚®ï¼Œæš´æ‰€åœ¨åœ°ä¸‹ä¸€å¡Œé™·ï¼Œæš´çš„â€˜ç™½é›ªå…¬ä¸»â€™ç«‹åˆ»åŸ‹äº†è¿›å»ï¼Œä½¿å¾—æš´æ­£å¥½èº²è¿‡ä¸Šæ–¹å‘ä¸‹å–·å°„è¿‡æ¥çš„ç«æŸ±ï¼Œç ´åäº†ç™½é¾™å¦„å›¾ä¸€ä¸¾ä¸¤å¾—çš„ä¸€å‡»ã€‚é£é€¸åœ¨ç™½é¾™æ¬²æŒºç›´èº«ä½“å†æ¬¡å‘èµ·æ”»å‡»çš„é—´éš™ï¼Œæ‹‰èµ·åœŸå †é‡Œçš„ç™½è‰³å…¬ä¸»ï¼Œè¿…é€Ÿå‘ä¸Šç©ºé£å»ã€‚ç™½é¾™æ‘†åŠ¨é¾™å¤´ä»å³ä¸‹æ–¹æ²¿å››åäº”åº¦è§’åŸè·¯å†å–·ç«æŸ±æ—¶ã€‚é£é€¸æ€¥å¿™å°†æœºå™¨äººå‘åä¸€é€€ï¼Œè½¬èº«æœç™½ç¾½å·é£å»ã€‚</p>
<p>æ˜“æ…§æ­¤åˆ»é‡åˆ°è¿™çªå¦‚å…¶æ¥çš„æƒ…å†µï¼Œä¸€ä¸‹å­æ²¡äº†åŠæ³•ã€‚</p>
<p>é£é€¸æ‰“å¼€é€šè®¯é¢‘é“å¯¹æ˜“æ…§è¯´ï¼šâ€œæ˜“æ…§ï¼Œæ˜“æ…§ï¼Œä½ ä¸è¦ç´§å¼ â€¦â€¦èµ¶ç´§æ‰“å¼€é£èˆ¹èˆ±é—¨ï¼Œå¾…æˆ‘å’Œç™½é¾™è¿›å…¥åï¼Œå¬æˆ‘å‘½ä»¤å¼€å¯ç¬¬ä¸‰ç™¾ä¹åä¸€é¢‘é“ï¼Œè¾“å…¥â€˜éª¨ç‰¢â€™åç¡®å®šï¼Œè¿™æ—¶æ—è¾¹ä¼šå‡ºç°â€˜å¯åŠ¨â€™æŒ‰é’®ï¼Œæˆ‘å«ä½ æŒ‰æ—¶ï¼Œä½ å†æŒ‰ã€‚è®°ä½äº†ï¼Œä¸è¦æŒ‰æ—©äº†ï¼Œä¹Ÿä¸è¦æŒ‰æ™šäº†ã€‚â€</p>
<p>æ˜“æ…§è¿å¿™åº”ç­”ã€‚é£é€¸é©¾é©¶æœºå™¨äººæ‰‹æ‰˜ç€é‡é‡å¤§äºè‡ªå·±ä¸€å€å¤šçš„â€˜ç™½è‰³å…¬ä¸»â€™ï¼Œæ²‰é‡åœ°å‘é£èˆ¹é£å»ï¼Œé€Ÿåº¦é™äº†å°†è¿‘ä¸‰åˆ†ä¹‹ä¸€ã€‚çœ¼çœ‹ç™½é¾™ç´§è·Ÿåœ¨åé¢è¿½èµ¶çš„é€Ÿåº¦è¶Šæ¥è¶Šå¿«ï¼Œé£é€¸å¿ƒæ€¥å¦‚ç„šï¼Œç«‹åˆ»å†™ä¸ªä¿¡æ¯å‘ç»™äº†æš´ã€‚æ¥è¿‘èˆ±é—¨æ—¶ï¼Œç™½é¾™å·²è¿‘åœ¨å’«å°ºã€‚ç™½é¾™å°†å¤§çˆªä¸€æŒ¥ï¼Œé£é€¸æ—‹è½¬ç€å‘ä¸Šä¸€é£ï¼Œåˆ©ç”¨æ—‹è½¬çš„åŠ›é‡ä½¿åŠ²å°†â€˜ç™½è‰³å…¬ä¸»â€™ç”©è¿›èˆ±é—¨ï¼Œè‡ªå·±å´è¢«ç™½é¾™ä¸€å£å’¬ä½ï¼Œç”±äºæƒ¯æ€§ï¼Œç™½é¾™ä¸€å¤´æ‰è¿›é£èˆ¹èˆ±é—¨ã€‚ç™½é¾™ç”±äºèº«å½¢å·¨å¤§ï¼Œè¿›èˆ±æ—¶æ’å¾—ç™½ç¾½å·å‰§çƒˆæ™ƒåŠ¨èµ·æ¥ã€‚æ­¤æ—¶æ˜“æ…§åˆšåˆšè¾“å®Œâ€œéª¨ç‰¢â€æŒ‰ä¸‹â€˜ç¡®å®šâ€™ï¼Œè¿™ä¸€æ™ƒåŠ¨çªç„¶å°†å¥¹è·Œå€’ï¼Œå¥¹èµ¶ç´§çˆ¬èµ·æ¥ï¼Œä¼¸æ‰‹å°±å»æŠ“æ§åˆ¶å°ï¼Œä¸€ä¸å°å¿ƒç¢°åˆ°äº†â€˜å¯åŠ¨â€™æŒ‰é’®ï¼Œå‡ºèˆ±å®¤ç«‹åˆ»å“å•·å“å•·çš„å“äº†èµ·æ¥ã€‚æš´è¢«è¿™å‰§çƒˆçš„éœ‡åŠ¨å£°æƒŠé†’ï¼Œç«‹åˆ»æ˜ç™½äº†è‡ªå·±çš„å¤„å¢ƒï¼Œæ€¥å¿™å¼€åŠ¨å¤±å»å¹³è¡¡çš„â€˜ç™½è‰³å…¬ä¸»â€™ï¼Œæ–œç€èº«å­è‰°éš¾åœ°æœæœ€è¿‘çš„èˆ±å®¤é£å»ã€‚è¿™æ—¶ï¼Œå‡ºèˆ±å®¤ä¸Šä¸‹å·¦å³å››ä¾§éš”æ¿ç¼“ç¼“æ‰“å¼€ï¼Œå››å¤§å—ç”±ç™½é¾™éª¨æ„æˆçš„æ …æ å½¢æˆä¸€ä¸ªå·¨å¤§çš„ç‰¢ç¬¼ï¼Œå°†è¿›èˆ±æ¥çš„ç™½é¾™æ­»æ­»å›°ä½ã€‚ç„¶åï¼Œèˆ¹èˆ±åº•éƒ¨èˆ±é—¨æŠ˜å æ‰“å¼€ï¼Œå°†è¿™ç‰¢ç¬¼ä¸¢äº†ä¸‹å»ï¼Œç™½ç¾½å·é£èˆ¹æ‘†è„±ç´¯èµ˜ï¼Œå¿«é€Ÿå‘è¿œå¤„é£å»ã€‚</p>
<p>ç™½é¾™ç”©æ‰å£ä¸­çš„æœºå™¨äººï¼Œå‘å‡ºä¸€é“å…‰é—ªï¼Œé›ªå¶ç«‹å³å˜å›åŸå½¢ã€‚é£é€¸ä»æŸåäº†çš„æœºå™¨äººé©¾é©¶èˆ±ç¼“ç¼“çˆ¬å‡ºã€‚é›ªå¶ç«™åœ¨ä¸€æ—æ‰‹æŒç™½é¾™çˆªåŒåˆ€ï¼Œæ°”åŠ¿æ±¹æ±¹åœ°çœ‹ç€é£é€¸ã€‚</p>
<p>é£é€¸çœ‹äº†é›ªå¶ä¸€çœ¼ï¼Œå¿ä¸ä½å“ˆå“ˆå¤§ç¬‘ï¼šâ€œèµ·åˆæˆ‘è¿˜æ‹…å¿ƒæš´ä¼šå’Œä½ ä¸€èµ·å›°åœ¨è¿™éª¨ç‰¢é‡Œï¼Œç°åœ¨å¥¹è„±é™©äº†ï¼Œçœ‹æ¥ç™½é¾™ç­ä¸ä¼šå°±è¿™ä¹ˆå®Œäº†ã€‚å“ˆå“ˆï¼è®ºå•æŒ‘ï¼Œæˆ‘ä¸æ˜¯ä½ çš„å¯¹æ‰‹ï¼Œè¦æ€è¦åˆ®è¯·ä¾¿å§ã€‚â€</p>
<p>é›ªå¶çªç„¶æ‰‘å€’åœ¨åœ°ä¸Šï¼ŒåŒæ‰‹æŠ±ä½å¤´ï¼Œæ¥å›ç¿»æ»šèµ·æ¥ï¼Œä¸€å‰¯ç–¼ç—›éš¾å¿çš„æ¨¡æ ·ã€‚</p>
<p>ç–¼ç—›è¿‡åï¼Œé›ªå¶è‡ªè¨€è‡ªè¯­èµ·æ¥ï¼šâ€œå¯æ¶ï¼Œè¿˜æ˜¯è®©é‚£ä¹ˆå¤šäººè·‘äº†â€¦â€¦è·‘äº†â€¦â€¦è¡Œäº†ï¼Œå°±æ­¤æ‰“ä½å§ï¼Œä½ å·²ç»æ€äº†é‚£ä¹ˆå¤šäººäº†ï¼Œå¿«â€¦â€¦å¿«æ‰“ä½å§ã€‚ä¸è¡Œï¼Œç±³ç”Ÿä¸åœ¨äº†ï¼Œæˆ‘ä¹Ÿä¸æƒ³æ´»äº†ï¼ä½ â€¦â€¦ä½ æ€äº†æˆ‘å§ï¼ä¸â€¦â€¦æˆ‘è¿˜æƒ³è§çš“æœˆâ€¦â€¦æˆ‘ä¸èƒ½æ­»â€¦â€¦æˆ‘ä¸€å®šè¦è§â€¦â€¦â€</p>
<p>é£é€¸è§é›ªå¶åå¤ä¸æ–­åœ°åœ¨é‚£å„¿å˜€å’•ç€ä»€ä¹ˆï¼Œè§‰å¾—é›ªå¶ä¸€å®šæ˜¯å—åˆ°äº†ä»€ä¹ˆåˆºæ¿€ï¼Œç–¯äº†ï¼äºæ˜¯ä¸ä½çš„æ‘‡ç€å¤´ï¼Œå¹ç€æ°”ã€‚</p>
<p>è½¬çœ¼é—´ï¼Œéª¨ç‰¢é‡Œå¼¥æ¼«å‡ºä¸€è‚¡é»‘çƒŸã€‚åŸæ¥æ˜¯é›ªå¶åœ¨ä¸æ–­è½¬æ¢é­”æ³•ï¼Œå¦„å›¾åŒ–è§£è‡ªå·±èº«ä½“åˆ†å­ä»éª¨ç‰¢çš„ç¼éš™é€ƒç¦»ï¼Œå¯æ˜¯çœ‹ä¼¼æ …æ çš„éª¨ç‰¢ï¼Œå´å¦‚åŒé“œå¢™é“å£ä¸€èˆ¬å››å‘¨ä»€ä¹ˆä¹Ÿé’»ä¸å‡ºå»ã€‚</p>
<p>é£é€¸è§é›ªå¶ä½¿å‡ºåå…«èˆ¬æ­¦è‰ºçš†éƒ½æ‹¿è¿™éª¨ç‰¢æ²¡æœ‰åŠæ³•ï¼Œç¬‘é“ï¼šâ€œè¿™éª¨ç‰¢å¯æ˜¯ç”±é˜¿æ–¯æ¥ç­è‘—åçš„é­”æ³•ä¸“å®¶æŸ¥ç©†å°”è€å¸ˆè®¾è®¡åˆ¶é€ çš„ï¼Œè™½ç„¶ä½ æŒæ¡äº†ä»¥é­”æ³•è‘—ç§°çš„æ–‘å›½ç­çš„é­”æ³•å’Œå°¤ç§‘æ–¯çš„ä¸€åŠé­”åŠ›ï¼Œä½†æ˜¯å…‰å‡­è¿™äº›è¿˜æ˜¯ä¸å¤Ÿçš„ï¼Œè¿˜éœ€è¦ä¸€å®šæ—¶æ—¥çš„ä¿®ç‚¼æ‰èƒ½å°†ä½ çš„é­”åŠ›æåˆ°èƒ½å¤Ÿç ´è§£æŸ¥ç©†å°”è€å¸ˆçš„é­”æ³•çš„é«˜åº¦ï¼Œå¯æ˜¯åœ¨ä½ ä¿®ç‚¼åˆ°è¿™ä¸ªç¨‹åº¦ä»¥å‰ä½ å°±è¦é¥¿æ­»åœ¨è¿™é‡Œã€‚å“ˆå“ˆï¼ä½ ç»ˆäºå¯ä»¥è§åˆ°ä½ çš„ç±³â€¦â€¦â€</p>
<p>è¯è¿˜æ²¡æœ‰è¯´å®Œï¼Œé›ªå¶å·¦æ‰‹ä¸€åˆ€å·²åˆ’å¼€é£é€¸çš„å–‰å’™ï¼ŒåŒæ—¶å³æ‰‹é‚£åˆ€å‰–å¼€äº†é£é€¸çš„èƒ¸è„¯ã€‚</p>
<p>é›ªå¶å°†æ‰‹ä¸­çš„åŒåˆ€æ’åœ¨åœ°ä¸‹ï¼Œä½ç€å¤´ä¸ä½å“­æ³£ï¼Œå¥¹å“­å•Šå“­å•Šï¼Œçœ¼çœ¶éƒ½å“­å¾—æµå‡ºè¡€æ¥ï¼Œå¥¹è¿˜æ˜¯ç™½å¤©é»‘å¤œä¸ä½å“­ã€‚åœ¨å¥¹å››å‘¨å…¨æ˜¯ç™½é¾™éª¨æ …æ ï¼Œä¸€ç‚¹èƒ½åƒçš„ä¸œè¥¿éƒ½æ²¡æœ‰ã€‚è¿™æ—¶ï¼Œå¥¹æ‰€è§ä¹‹ç‰©å·²å‘ˆæ¨¡ç³ŠçŠ¶ï¼Œå†è¿™æ ·å“­æ³£å‡ å¤©ï¼Œå¥¹åŒç›®å°±è¦å¤±æ˜äº†ã€‚</p>
<p>è¿™å¤©å¤œé—´ï¼Œé›ªå¶æ¨¡ç³Šé—´è§åˆ°ä¸€ä¸ªçº¢å‘å°‘å¹´ï¼Œä»–ä¸Šèº«ç©¿ç€çº¢èƒŒå¿ƒï¼ŒæŠ«ç€ä¸€ä»¶é»‘è‰²é•¿é£è¡£ï¼ŒèƒŒä¸ŠèƒŒç€ä¸€æŠŠé‡‘è‰²å¤§é•¿åˆ€ï¼Œä¸‹èº«ç©¿ç€ä¸€ä»¶é»‘è‰²å¸ƒè£¤å­ï¼Œç‰µç€ä¸€åŒ¹èƒŒç”²é¾™ã€‚å“¼ç€å°æ›²ï¼Œè¸ç€è½»è½»çš„æ­¥å­æœè‡ªå·±è¿™è¾¹èµ°è¿‡æ¥ã€‚</p>
<p>é›ªå¶ä»åœ°ä¸Šç¼“ç¼“çˆ¬èµ·ï¼ŒåŒæ‰‹æŠ“ç€éª¨ç‰¢çš„ç™½é¾™éª¨ï¼Œé¢¤å£°å–Šé“ï¼šâ€œç±³â€¦â€¦ç±³ç”Ÿï¼Œç±³ç”Ÿï¼Œæ˜¯ä½ å—ï¼Ÿâ€</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;è¿™æ˜¯æˆ‘åäºŒå¹´å‰å†™çš„ä¸€ç¯‡å°è¯´ã€‚å½“å¹´æ¯å¤©æ—©ä¸Š8ç‚¹åŠä¸Šç­ï¼Œä¸ºäº†å†™è¿™ç¯‡ï¼Œæˆ‘å››ç‚¹èµ·åºŠï¼Œå†™åˆ°æ—©é¥­å‰ï¼ŒåšæŒäº†å¥½å‡ å‘¨æ‰å®Œæˆã€‚&lt;/p&gt;
&lt;h2 id=&quot;æ­£æ–‡&quot;
    
    </summary>
    
      <category term="My novel" scheme="http://ming1016.github.io/categories/My-novel/"/>
    
    
      <category term="Novel" scheme="http://ming1016.github.io/tags/Novel/"/>
    
  </entry>
  
  <entry>
    <title>è¿™æ¬¡swiftå¤§ä¼šåˆ†äº«å‡†å¤‡çš„å¹»ç¯ç‰‡å’Œ demo</title>
    <link href="http://ming1016.github.io/2018/09/17/produce-slides-of-third-at-swift-conference/"/>
    <id>http://ming1016.github.io/2018/09/17/produce-slides-of-third-at-swift-conference/</id>
    <published>2018-09-17T02:04:11.000Z</published>
    <updated>2021-04-11T14:42:09.926Z</updated>
    
    <content type="html"><![CDATA[<p>ç¬¬ä¸‰å±Šåœ¨åŒ—äº¬ä¸¾åŠçš„@swiftå¤§ä¼šï¼Œæˆ‘åˆ†äº«äº†ç”¨ swift å†™è§£é‡Šå™¨çš„æ€è·¯ï¼Œè¿™ä¸ªè§£é‡Šå™¨ demo æˆ‘æ”¾åœ¨äº† github ä¸Šï¼Œåœ°å€åœ¨ <a href="https://github.com/ming1016/HTN/tree/master/Sources/Core/OC">https://github.com/ming1016/HTN/tree/master/Sources/Core/OC</a> ã€‚demo æ”¯æŒç®€å•çš„å‡ ä¸ª OC è¯­æ³•ï¼ŒæŒ‰ç…§è¿™ä¸ªæ¶å­å’Œæ€è·¯å¤§å®¶å¯ä»¥å½“ä½œä¸€ä¸ªå»æ”¯æŒä¸€ä¸ªè¯­è¨€ï¼Œå’Œè®¾è®¡è‡ªå·±ç‰¹å®šè¯­æ³•çš„é›å½¢æ¥ç»ƒæ‰‹ã€‚å½“å¹´å‰ç«¯äººäººéƒ½åœ¨ç”¨çš„ babel è½¬ä¹‰å™¨çš„ä½œè€…ä¹Ÿå†™è¿‡ä¸€ä¸ªé›å‹ä¾‹å­ï¼Œçœ‹å®Œè¿™ä¸ªé›å‹å°±å¤§è‡´äº†è§£äº† babel è¿™ä¸ªå·¥ç¨‹æ•´ä¸ªè§£æçš„æ€è·¯ï¼Œå·¥ç¨‹ä»£ç çœ‹èµ·æ¥è½»æ¾ä¸å°‘ï¼Œä»é‡Œé¢ä¹Ÿèƒ½å¾ˆå¿«çš„å­¦åˆ°äº†å¾ˆå¤šè‡ªå·±éœ€è¦çš„çŸ¥è¯†ã€‚å¤§ä¼šä¸Šæˆ‘è¿˜æåˆ°äº†ä¸€ä¸ª demoï¼Œåœ°å€<a href="https://github.com/ming1016/ArchitectureDemo">https://github.com/ming1016/ArchitectureDemo</a>ã€‚è¿™ä¸ª demo æ˜¯å¯¹ casatwy çš„ <a href="https://github.com/casatwy/CTMediator">CTMediator</a> æ‰©å±•äº†ä¸€äº› aop å’ŒçŠ¶æ€ç®¡ç†åŠŸèƒ½çš„ä¸€ä¸ªä¾‹å­ï¼ŒåŠ äº†äº›é“¾å¼å†™æ³•ï¼Œåœ¨æ¥å£é‡Œç•™äº†ä¸€ä¸ª eval çš„æ–¹æ³•ã€‚æœ‰å…´è¶£ä¹Ÿå¯ä»¥ç»“åˆå‰ä¸€ä¸ª demo çš„æ€è·¯å»å®ç°è¿™ä¸ªæ¥å£çš„æ–¹æ³•ï¼Œè®©è¿™ä¸ªæ¥å£å¯ä»¥æ”¯æŒç¨‹åºè¿è¡Œä¸­è§£é‡Šæ‰§è¡Œæƒ³æ”¯æŒçš„è¯­æ³•å†…å®¹ã€‚</p>
<p>è¿™æ¬¡å¤§ä¼šåˆ†äº«çš„å¹»ç¯ç‰‡åˆ¶ä½œæ–¹æ³•é‡‡ç”¨äº†æ¼«ç”»åˆ¶ä½œçš„æ‰‹æ³•ï¼Œå…ˆå‰çœ‹è¿‡ NHK çš„æ¼«å‹‰è¿™ä¸ªèŠ‚ç›®äº†è§£äº†ä¸€äº›æ—¥æœ¬æ¼«ç”»å®¶ç”»æ¼«ç”»æµç¨‹ã€‚æˆ‘åœ¨è¿™æ¬¡çš„åˆ¶ä½œè¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨äº†æ›´å¤šçš„è§†è§’ï¼Œä¸è¿‡è¿ç”¨çš„è¿˜ä¸å¤Ÿå¥½ï¼Œä»¥åä¼šåœ¨è¿™æ–¹é¢å¤šå­¦ä¹ ä¸‹ã€‚é¾™ç è¶…ç¬¬3é›†æœ€åå‡ é¡µç™»å‡ºä¸€è®¿è°ˆé¸Ÿå±±æ˜å’Œé¾™ç è¶…çš„æ¼«ç”»å®¶ã€‚æœ€æ–°çš„é¾™ç è¶…é‡Œï¼Œï¼Œå¦ä¸€ä½æ¼«ç”»å®¶è´Ÿè´£æ¥ç”»ï¼Œé¸Ÿå±±æ˜è´Ÿè´£å†™é¾™ç è¶…çš„æ•…äº‹å’Œä¿®æ”¹ä¸€äº›è‰å›¾è®¾è®¡ã€‚é‡‡è®¿æ—¶é‡‡è®¿è€…è¦é¸Ÿå±±æ˜ç»™é‚£æ¼«ç”»å®¶æå»ºè®®ï¼Œé¸Ÿå±±æ˜è¯´å¸Œæœ›èƒ½å¤Ÿåˆæ›´å¤šçš„è§†è§’æ¥è¡¨ç°äººç‰©å’Œåœºæ™¯ã€‚æˆ‘ç¿»äº†ä¸‹ä»¥å‰é¾™ç çš„ä¹¦å‘ç°è¿™ä¸ªå»ºè®®æœç„¶æ˜¯é¾™ç åˆ†é•œå¸å¼•äººçš„ä¸€ä¸ªå¾ˆå…³é”®çš„åŸå› ã€‚å–ææ–¹é¢ï¼Œæˆ‘åœ¨å›½å®¶å›¾ä¹¦é¦†é‡Œæ‰¾äº†å¾ˆå¤šèµ„æ–™ï¼Œè¿˜æœ‰éƒ¨åˆ†æ˜¯æŠŠä¸Šæ¬¡å»æ—¥æœ¬ç©çœ‹åˆ°å–œæ¬¢çš„åŠ äº†è¿›å»ï¼Œæ¯”å¦‚æµ…è‰å¯ºçš„æ ‘ï¼Œç™½ç‹ç‹¸å’Œé•¿é¼»é¬¼çš„é¢å…·ï¼Œåœ¨å·å´å¸‚çš„è—¤å­Fä¸äºŒé›„å“†å•¦Aæ¢¦ä¸»é¢˜é¦†é‡Œçš„çœ‹è¿‡çš„åŸç”»ç¨¿ï¼Œè¿˜æœ‰å¤å­£çƒŸç«å¤§ä¼šçš„åˆæœæµ´è¡£ã€‚å¤§ä¼šå®Œæ•´å¹»ç¯ç‰‡å’Œè‰å›¾çš„åŸå°ºå¯¸ï¼ˆè¾ƒå¤§ï¼‰ï¼Œæˆ‘æ”¾åœ¨äº†ç½‘ç›˜é‡Œï¼š<a href="https://pan.baidu.com/s/1WlqTRodrVVksdc_43QO1Zw">https://pan.baidu.com/s/1WlqTRodrVVksdc_43QO1Zw</a></p>
<h2 id="å¹»ç¯ç‰‡"><a href="#å¹»ç¯ç‰‡" class="headerlink" title="å¹»ç¯ç‰‡"></a>å¹»ç¯ç‰‡</h2><p><img src="/uploads/produce-slides-of-third-at-swift-conference/1.PNG" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/2.PNG" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/3.PNG" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/4.PNG" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/5.PNG" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/6.PNG" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/7.PNG" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/8.PNG" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/9.PNG" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/10.PNG" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/11.PNG" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/12.PNG" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/13.PNG" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/14.PNG" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/15.PNG" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/16.PNG" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/17.PNG" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/18.PNG" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/19.PNG" alt="image"></p>
<h2 id="éƒ¨åˆ†è‰å›¾"><a href="#éƒ¨åˆ†è‰å›¾" class="headerlink" title="éƒ¨åˆ†è‰å›¾"></a>éƒ¨åˆ†è‰å›¾</h2><p><img src="/uploads/produce-slides-of-third-at-swift-conference/20.jpg" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/22.jpg" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/23.jpg" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/24.jpg" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/25.jpg" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/26.jpg" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/27.jpg" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/28.jpg" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/29.jpg" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/30.jpg" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/31.jpg" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/32.jpg" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/33.jpg" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/34.jpg" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/35.jpg" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/36.jpg" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/39.jpg" alt="image"></p>
<h2 id="å¤§ä¼šç°åœº"><a href="#å¤§ä¼šç°åœº" class="headerlink" title="å¤§ä¼šç°åœº"></a>å¤§ä¼šç°åœº</h2><p><img src="/uploads/produce-slides-of-third-at-swift-conference/42.JPG" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/43.JPG" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/44.JPG" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/45.JPG" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/46.JPG" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/47.JPG" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/48.JPG" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/40.JPG" alt="image"><br><img src="/uploads/produce-slides-of-third-at-swift-conference/41.JPG" alt="image"></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç¬¬ä¸‰å±Šåœ¨åŒ—äº¬ä¸¾åŠçš„@swiftå¤§ä¼šï¼Œæˆ‘åˆ†äº«äº†ç”¨ swift å†™è§£é‡Šå™¨çš„æ€è·¯ï¼Œè¿™ä¸ªè§£é‡Šå™¨ demo æˆ‘æ”¾åœ¨äº† github ä¸Šï¼Œåœ°å€åœ¨ &lt;a href=&quot;https://github.com/ming1016/HTN/tree/master/Sources/Core/OC&quot;&gt;
    
    </summary>
    
      <category term="Programming" scheme="http://ming1016.github.io/categories/Programming/"/>
    
    
      <category term="iOS" scheme="http://ming1016.github.io/tags/iOS/"/>
    
      <category term="Slides" scheme="http://ming1016.github.io/tags/Slides/"/>
    
      <category term="swift" scheme="http://ming1016.github.io/tags/swift/"/>
    
      <category term="ç¼–è¯‘" scheme="http://ming1016.github.io/tags/%E7%BC%96%E8%AF%91/"/>
    
  </entry>
  
  <entry>
    <title>18å¹´ä¸ŠåŠå¹´procreateçš„ç»ƒä¹ å›¾å›¾</title>
    <link href="http://ming1016.github.io/2018/09/14/draw-with-procreate-in-ipad-during-pre-half-in-20182/"/>
    <id>http://ming1016.github.io/2018/09/14/draw-with-procreate-in-ipad-during-pre-half-in-20182/</id>
    <published>2018-09-14T15:08:12.000Z</published>
    <updated>2021-04-11T14:42:09.917Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/uploads/draw-with-procreate-in-ipad-during-pre-half-in-2018/1.jpg" alt=""><br><img src="/uploads/draw-with-procreate-in-ipad-during-pre-half-in-2018/2.jpg" alt=""><br><img src="/uploads/draw-with-procreate-in-ipad-during-pre-half-in-2018/3.jpg" alt=""><br><img src="/uploads/draw-with-procreate-in-ipad-during-pre-half-in-2018/4.jpg" alt=""><br><img src="/uploads/draw-with-procreate-in-ipad-during-pre-half-in-2018/5.jpg" alt=""><br><img src="/uploads/draw-with-procreate-in-ipad-during-pre-half-in-2018/6.jpg" alt=""><br><img src="/uploads/draw-with-procreate-in-ipad-during-pre-half-in-2018/7.jpg" alt=""><br><img src="/uploads/draw-with-procreate-in-ipad-during-pre-half-in-2018/8.jpg" alt=""><br><img src="/uploads/draw-with-procreate-in-ipad-during-pre-half-in-2018/9.jpg" alt=""><br><img src="/uploads/draw-with-procreate-in-ipad-during-pre-half-in-2018/10.jpg" alt=""><br><img src="/uploads/draw-with-procreate-in-ipad-during-pre-half-in-2018/11.jpg" alt=""><br><img src="/uploads/draw-with-procreate-in-ipad-during-pre-half-in-2018/12.jpg" alt=""><br><img src="/uploads/draw-with-procreate-in-ipad-during-pre-half-in-2018/13.jpg" alt=""><br><img src="/uploads/draw-with-procreate-in-ipad-during-pre-half-in-2018/14.jpg" alt=""><br><img src="/uploads/draw-with-procreate-in-ipad-during-pre-half-in-2018/15.jpg" alt=""><br><img src="/uploads/draw-with-procreate-in-ipad-during-pre-half-in-2018/16.jpg" alt=""><br><img src="/uploads/draw-with-procreate-in-ipad-during-pre-half-in-2018/17.jpg" alt=""></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/uploads/draw-with-procreate-in-ipad-during-pre-half-in-2018/1.jpg&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;img src=&quot;/uploads/draw-with-procreate-in-ipad-d
    
    </summary>
    
      <category term="My painting" scheme="http://ming1016.github.io/categories/My-painting/"/>
    
    
      <category term="Painting" scheme="http://ming1016.github.io/tags/Painting/"/>
    
      <category term="iPad" scheme="http://ming1016.github.io/tags/iPad/"/>
    
      <category term="Procreate" scheme="http://ming1016.github.io/tags/Procreate/"/>
    
  </entry>
  
  <entry>
    <title>æ·±å…¥å‰–æ JavaScriptCore</title>
    <link href="http://ming1016.github.io/2018/04/21/deeply-analyse-javascriptcore/"/>
    <id>http://ming1016.github.io/2018/04/21/deeply-analyse-javascriptcore/</id>
    <published>2018-04-21T07:40:35.000Z</published>
    <updated>2021-04-11T14:42:09.906Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ€è¿‘å¼€å§‹æ¶‰åŠ JS çš„è§£æå’Œå¤„ç†å·¥ä½œï¼Œæ‰€ä»¥ä¸“é—¨ç ”ç©¶äº†ä¸‹è¿™å—ã€‚ç‰¹åˆ«æ˜¯åŠ¨æ€ç±»å‹çš„å¤„ç†ä»¥åŠä¸åŒå¼•æ“å¯¹äºå¹³å°æ— å…³çš„å­—èŠ‚ç çš„è®¾è®¡å’Œå¤„ç†ä¼šæœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚</p>
<h1 id="JavaScriptCore-ä»‹ç»"><a href="#JavaScriptCore-ä»‹ç»" class="headerlink" title="JavaScriptCore ä»‹ç»"></a>JavaScriptCore ä»‹ç»</h1><p>JavaScriptCore æ˜¯ JavaScript å¼•æ“ï¼Œé€šå¸¸ä¼šè¢«å«åšè™šæ‹Ÿæœºï¼Œä¸“é—¨è®¾è®¡æ¥è§£é‡Šå’Œæ‰§è¡Œ JavaScript ä»£ç ã€‚æœ€å¼€å§‹çš„ JavaScriptCore  æ˜¯ä» KJSï¼ˆKDE çš„ JavaScript å¼•æ“ï¼‰ä»¥åŠ PCRE æ­£åˆ™è¡¨è¾¾å¼çš„åŸºç¡€ä¸Šå¼€å‘çš„ï¼Œæ˜¯åŸºäºæŠ½è±¡è¯­æ³•æ ‘çš„è§£é‡Šå™¨ã€‚2008 å¹´é‡å†™äº†ï¼Œå«åš SquirrelFishï¼Œåæ¥æ˜¯ SquirrelFish Extremeï¼Œåˆå« Nitroã€‚ç›®å‰ JavaScript å¼•æ“è¿˜æœ‰ Google çš„ V8 ï¼ŒMozilla çš„ SpiderMonkeyã€‚</p>
<p>JavaScriptCore è¿˜èƒ½å¤Ÿåœ¨ Objective-C ç¨‹åºä¸­æ¥æ‰§è¡Œ JavaScript çš„ä»£ç ï¼Œä¹Ÿå¯ä»¥åœ¨ JavaScript ç¯å¢ƒä¸­æ’å…¥è‡ªå®šä¹‰å¯¹è±¡ã€‚</p>
<h1 id="JavaScriptCore-å…¨è²Œ"><a href="#JavaScriptCore-å…¨è²Œ" class="headerlink" title="JavaScriptCore å…¨è²Œ"></a>JavaScriptCore å…¨è²Œ</h1><p>ä¸‹é¢æ˜¯è§£æ JavaScript æºç è§£æç¼–è¯‘çš„è¯¦ç»†æµç¨‹å›¾ï¼š<br><img src="/uploads/deeply-analyse-javascriptcore/01.png" alt=""></p>
<h2 id="ä¸»è¦æ¨¡å—"><a href="#ä¸»è¦æ¨¡å—" class="headerlink" title="ä¸»è¦æ¨¡å—"></a>ä¸»è¦æ¨¡å—</h2><ul>
<li><p>Lexerï¼šè¯æ³•åˆ†æå™¨ï¼Œç”Ÿæˆ tokensï¼Œå¤§éƒ¨åˆ†ä»£ç éƒ½åœ¨ parser/Lexer.cpp é‡Œã€‚</p>
</li>
<li><p>Parserï¼šè¯­æ³•åˆ†æï¼ŒåŸºäº Lexer çš„ tokens ç”Ÿæˆè¯­æ³•æ ‘ã€‚æ‰‹å†™äº†ä¸ª recusive descent parser é€’å½’ä¸‹é™è§£æå™¨ï¼Œä»£ç ä¸»è¦åœ¨ parser/Parser.cpp é‡Œã€‚</p>
</li>
<li><p>LLIntï¼šLow Level Interpreter æ‰§è¡Œ Parser ç”Ÿæˆçš„ Byte codeã€‚ä»£ç åœ¨ llint/ é‡Œï¼Œä½¿ç”¨æ±‡ç¼–ï¼Œåœ¨  offlineasm/ é‡Œï¼Œå¯ä»¥ç¼–è¯‘ä¸º x86 å’Œ ARMv7 çš„æ±‡ç¼–å’Œ C ä»£ç ã€‚LLInt å¸Œæœ›è¾¾æˆé™¤äº†è¯æ³•å’Œè¯­æ³•åˆ†æå¤–é›¶å¯åŠ¨æ¶ˆè€—ï¼ŒåŒæ—¶éµå®ˆç”¨ JIT åœ¨è°ƒç”¨ï¼Œå †æ ˆå’Œèµ·å­˜å™¨çš„çº¦å®šã€‚</p>
</li>
<li><p>Baseline JITï¼šå®æ—¶ç¼–è¯‘ï¼Œæ€§èƒ½ä¸å¥½ç”¨è¿™ä¸ªã€‚åœ¨å‡½æ•°è°ƒç”¨äº† 6 æ¬¡ï¼Œæˆ–è€…æŸæ®µä»£ç å¾ªç¯äº†å¤§äº100æ¬¡ä¼šè¢«è§¦å‘ã€‚BaseLine JIT çš„ä»£ç åœ¨ jit/ é‡Œã€‚BaseLine JIT è¿˜å¯¹å‡ ä¹æ‰€æœ‰å †çš„è®¿é—®æ‰§è¡Œäº†å¤æ‚çš„å¤šæ€å†…è”é«˜é€Ÿç¼“å­˜ï¼ˆPolymorphic inline cachesï¼‰ã€‚å¤šæ€å†…è”ç¼“å­˜æ˜¯ Smalltalk ç¤¾åŒºä¼˜åŒ–åŠ¨æ€åˆ†å‘çš„ä¸€ä¸ªç»å…¸æŠ€æœ¯ã€‚</p>
</li>
<li><p>DFG JITï¼šä½å»¶è¿Ÿä¼˜åŒ– JITï¼Œæ›´å·®æ€§èƒ½å°±ç”¨è¿™ä¸ªç”Ÿæˆæ›´ä¼˜åŒ–çš„æœºå™¨ç æ¥æ‰§è¡Œã€‚åœ¨å‡½æ•°è¢«è°ƒç”¨äº†60æ¬¡æˆ–è€…ä»£ç å¾ªç¯äº†1000æ¬¡ä¼šè§¦å‘ã€‚åœ¨ LLInt å’Œ Baseline JIT ä¸­ä¼šæ”¶é›†ä¸€äº›åŒ…æ‹¬æœ€è¿‘å‚æ•°ï¼Œå †ä»¥åŠè¿”å›å€¼ä¸­çš„æ•°æ®ç­‰è½»é‡çº§çš„æ€§èƒ½ä¿¡æ¯ï¼Œæ–¹ä¾¿ DFG è¿›è¡Œç±»å‹åˆ¤æ–­ã€‚å…ˆè·å–ç±»å‹ä¿¡æ¯å¯ä»¥å‡å°‘å¤§é‡çš„ç±»å‹æ£€æŸ¥ï¼Œæ¨æµ‹å¤±è´¥ DFG ä¼šå–æ¶ˆä¼˜åŒ–ï¼Œä¹Ÿå« OSR exitã€‚å–æ¶ˆå¯ä»¥æ˜¯åŒæ­¥çš„ä¹Ÿå¯ä»¥æ˜¯å¼‚æ­¥çš„ã€‚å–æ¶ˆåä¼šå›åˆ° Baseline JITï¼Œé€€å›ä¸€å®šæ¬¡æ•°ä¼šè¿›è¡Œé‡æ–°ä¼˜åŒ–ï¼Œæ”¶é›†æ›´å¤šç»Ÿè®¡ä¿¡æ¯ï¼Œçœ‹æƒ…å†µå†æ¬¡è°ƒç”¨ DFGã€‚é‡æ–°ä¼˜åŒ–ä½¿ç”¨çš„æ˜¯æŒ‡æ•°å¼å›é€€ç­–ç•¥åº”å¯¹ä¸€äº›æ€ªå¼‚çš„ä»£ç ã€‚DFG ä»£ç åœ¨ dfg/ é‡Œã€‚</p>
</li>
<li><p>FTLï¼šé«˜ååé‡ä¼˜åŒ– JITï¼Œå…¨ç§° Faster Than Lightï¼ŒDFG é«˜å±‚ä¼˜åŒ–é…åˆ B3 åº•å±‚ä¼˜åŒ–ã€‚ä»¥å‰å…¨ç§°æ˜¯ Fourth Tier LLVM åº•å±‚ä¼˜åŒ–ä½¿ç”¨çš„æ˜¯ LLVMã€‚B3 å¯¹ LLVM åšäº†è£å‰ªï¼Œå¯¹ JavaScriptCore åšäº†ç‰¹æ€§å¤„ç†ï¼ŒB3 IR çš„æ¥å£å’Œ LLVM IR å¾ˆç±»ä¼¼ã€‚B3 å¯¹ LLVM çš„æ›¿æ¢ä¸»è¦æ˜¯è€ƒè™‘å‡å°‘å†…å­˜å¼€é”€ï¼ŒLLVM ä¸»è¦æ˜¯é’ˆå¯¹ç¼–è¯‘å™¨ï¼Œç¼–è¯‘å™¨åœ¨è¿™æ–¹é¢ä¼˜åŒ–åŠ¨åŠ›å¿…ç„¶æ²¡æœ‰ JIT éœ€æ±‚é«˜ã€‚B3 IR å°†æŒ‡é’ˆæ”¹æˆäº†æ›´ç´§å‡‘çš„æ•´æ•°æ¥è¡¨ç¤ºå¼•ç”¨å…³ç³»ã€‚ä¸å¯å˜çš„å¸¸ç”¨çš„ä¿¡æ¯ä½¿ç”¨å›ºå®šå¤§å°çš„ç»“æ„æ¥è¡¨ç¤ºï¼Œå…¶å®ƒçš„éƒ½æ”¾åˆ°å¦å¤–çš„åœ°æ–¹ã€‚ç´§å‡‘çš„æ•°æ®æ”¾åˆ°æ•°ç»„ä¸­ï¼Œæ›´å¤šçš„æ•°ç»„æ›´å°‘çš„é“¾è¡¨ã€‚è¿™æ ·å½¢æˆçš„ IR æ›´çœå†…å­˜ã€‚<a href="http://www.filpizlo.com/">Filip Pizlo</a> ä¸»å¯¼çš„è¿™ä¸ªæ”¹åŠ¨ï¼ŒDFG JIT ä¹Ÿæ˜¯ä»–å¼„çš„ï¼Œä¸ºäº†èƒ½å¤Ÿæ›´å¤šçš„å‡å°‘å†…å­˜ä¸Šçš„å¼€é”€ï¼Œä»–åˆ©ç”¨åœ¨ DFG é‡Œå·²ç»åšçš„ InsertionSet å°† LLVM IR é‡Œçš„ def-use å¹²æ‰äº†ï¼Œå¤§æ¦‚æ€è·¯æ˜¯æŠŠå•å‘é“¾è¡¨é‡Œæ‰¹é‡æ’å…¥æ–° IR èŠ‚ç‚¹å…ˆæ”¾åˆ° InsertionSet é‡Œï¼Œåœ¨ä¸‹æ¬¡éå† IR æ—¶å†æ‰¹é‡æ’å…¥ã€‚Filip Pizlo è¿˜æŠŠ DFG é‡Œçš„ UpsilonValue æ›¿ä»£ LLVM SSA ç»„æˆéƒ¨åˆ†ã€‚B3 åé¢ä¼šæŠŠ LLVM çš„å¯„å­˜å™¨åˆ†é…ç®—æ³• Greedy ä¸€ç›´åˆ° B3 ä¸­ã€‚</p>
</li>
</ul>
<p>æ‰§è¡Œé€Ÿåº¦çš„å¯¹æ¯”ï¼š<br><img src="/uploads/deeply-analyse-javascriptcore/02.png" alt=""><br>ç›¸å¯¹é€Ÿåº¦ï¼Œè¶Šé«˜è¡¨ç¤ºè¶Šå¥½ã€‚</p>
<p>æ›´å¤šçš„è¯´æ˜å¯ä»¥å‚çœ‹ WebKit å®˜ç½‘ JavaScriptCore çš„ Wiki é¦–é¡µéƒ¨åˆ†ï¼š<a href="https://trac.webkit.org/wiki/JavaScriptCore">https://trac.webkit.org/wiki/JavaScriptCore</a></p>
<h2 id="ä¸»è¦çš„æºç ç›®å½•ç»“æ„"><a href="#ä¸»è¦çš„æºç ç›®å½•ç»“æ„" class="headerlink" title="ä¸»è¦çš„æºç ç›®å½•ç»“æ„"></a>ä¸»è¦çš„æºç ç›®å½•ç»“æ„</h2><ul>
<li>APIï¼šJavaScriptCore å¯¹å¤–çš„æ¥å£ç±»</li>
<li>assemblerï¼šä¸åŒ CPU çš„æ±‡ç¼–ç”Ÿæˆï¼Œæ¯”å¦‚ ARM å’Œ X86</li>
<li>b3ï¼šftl é‡Œçš„ Backend</li>
<li>bytecodeï¼šå­—èŠ‚ç çš„å†…å®¹ï¼Œæ¯”å¦‚ç±»å‹å’Œè®¡ç®—è¿‡ç¨‹</li>
<li>bytecompilerï¼šç¼–è¯‘å­—èŠ‚ç </li>
<li>Configurationsï¼šXcode çš„ç›¸å…³é…ç½®</li>
<li>Debuggerï¼šç”¨äºæµ‹è¯•è„šæœ¬çš„ç¨‹åº</li>
<li>dfgï¼šDFG JIT ç¼–è¯‘å™¨</li>
<li>disassemblerï¼šåæ±‡ç¼–</li>
<li>heapï¼šè¿è¡Œæ—¶çš„å †å’Œåƒåœ¾å›æ”¶æœºåˆ¶</li>
<li>ftlï¼šç¬¬å››å±‚ç¼–è¯‘</li>
<li>interpreterï¼šè§£é‡Šå™¨ï¼Œè´Ÿè´£è§£ææ‰§è¡Œ ByteCode</li>
<li>jitï¼šåœ¨è¿è¡Œæ—¶å°† ByteCode è½¬æˆæœºå™¨ç ï¼ŒåŠ¨æ€åŠæ—¶ç¼–è¯‘ã€‚</li>
<li>llintï¼šLow Level Interpreterï¼Œç¼–è¯‘å››å±‚é‡Œçš„ç¬¬ä¸€å±‚ï¼Œè´Ÿè´£è§£é‡Šæ‰§è¡Œä½æ•ˆå­—èŠ‚ç </li>
<li>parserï¼šè¯æ³•è¯­æ³•åˆ†æï¼Œæ„å»ºè¯­æ³•æ ‘</li>
<li>profilerï¼šä¿¡æ¯æ”¶é›†ï¼Œèƒ½æ”¶é›†å‡½æ•°è°ƒç”¨é¢‘ç‡å’Œæ¶ˆè€—æ—¶é—´ã€‚</li>
<li>runtimeï¼šè¿è¡Œæ—¶å¯¹äº js çš„å…¨å¥—æ“ä½œã€‚</li>
<li>wasmï¼šå¯¹ WebAssembly çš„å®ç°ã€‚</li>
<li>yarrï¼šYet Another Regex Runtimeï¼Œè¿è¡Œæ—¶æ­£åˆ™è¡¨è¾¾å¼çš„è§£æ</li>
</ul>
<h1 id="JavaScriptCore-ä¸-WebCore"><a href="#JavaScriptCore-ä¸-WebCore" class="headerlink" title="JavaScriptCore ä¸ WebCore"></a>JavaScriptCore ä¸ WebCore</h1><p>ScriptController ä¼šè°ƒç”¨ JavaScriptCore çš„ evaluate å’Œ checkSyntax ä¸¤ä¸ªæ¥å£ã€‚DOM èŠ‚ç‚¹çš„ JSBindings é€šè¿‡å›æº¯åˆ° JSC::JSNonFinalObject å®ç°å’Œ JavaScriptCore çš„ç»‘å®šã€‚</p>
<p>VM æ˜¯ JavaScript çš„ Runtime ç¯å¢ƒã€‚GlobalObject æ˜¯å…¨å‰§å¯¹è±¡ï¼Œè´Ÿè´£ç®¡ç†æ‰§è¡Œç¯å¢ƒå’Œ Object çš„ã€‚ExecState æ˜¯æ‰§è¡Œè„šæœ¬çš„å¯¹è±¡ï¼Œç”± GlobalObject ç®¡ç†çš„ï¼Œè´Ÿè´£è®°å½•è„šæœ¬æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚</p>
<p>æ¥å£æ‰§è¡Œè„šæœ¬ï¼Œåˆ›å»ºä¸€ä¸ª ProgramExecutable å¯¹è±¡æ¥è¡¨ç¤ºè¦æ‰§è¡Œçš„è„šæœ¬è´Ÿè´£ç¼–è¯‘æˆ ByteCodeï¼Œè°ƒç”¨ Interpreter æ‰§è¡Œè¿™ä¸ª ByteCodeã€‚</p>
<p>Binding æ˜¯ WebCore ä¸º JavaScriptCore æä¾›çš„å°è£…å±‚ã€‚è¿™ä¸€å±‚çš„å®šä¹‰å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ï¼š<a href="https://trac.webkit.org/wiki/WebKitIDL">https://trac.webkit.org/wiki/WebKitIDL</a>ã€‚WebKit å‚ç…§çš„æ˜¯ W3C Web IDL <a href="https://www.w3.org/TR/WebIDL-1/">https://www.w3.org/TR/WebIDL-1/</a>ã€‚</p>
<p>ä½¿ç”¨ IDL å®šä¹‰æ¥å£è§„èŒƒï¼ŒWebKit ä½¿ç”¨ä¸€ç»„ perl è„šæœ¬æ¥è½¬æ¢ IDLï¼Œåˆå§‹è„šæœ¬æ˜¯ generate-binding.plã€‚ç”Ÿæˆæ¥å£ä¸ DOM ç»„ä»¶å…³è”æ˜¯é€šè¿‡ JSNode æ¥çš„ã€‚æ‰§è¡Œè„šæœ¬å’Œ Frame çš„ setDocument ä¼šæ›´æ–° document å¯¹è±¡åˆ° JavaScriptCoreï¼Œé€šè¿‡ JSDomWindowBase::updateDocument æ›´æ–°åˆ° JSC::Heap é‡Œã€‚</p>
<h1 id="è¯æ³•è¯­æ³•åˆ†æ"><a href="#è¯æ³•è¯­æ³•åˆ†æ" class="headerlink" title="è¯æ³•è¯­æ³•åˆ†æ"></a>è¯æ³•è¯­æ³•åˆ†æ</h1><p>è¯æ³•å’Œè¯­æ³•åˆ†æç¨‹åº JavaScriptCore æ˜¯è‡ªå·±ç¼–å†™çš„ã€‚è¯æ³•åˆ†æä¼šæŠŠæ–‡æœ¬ç†è§£æˆå¾ˆå¤š tokenï¼Œæ¯”å¦‚ a = 5; å°±ä¼šè¢«è¯†åˆ«æˆä¸‹é¢è¿™äº› tokenï¼ŒVARIABLE EQUAL CONSTANT ENDã€‚ç„¶åé€šè¿‡è¯­æ³•åˆ†æï¼Œè¾“å‡ºè¯­æ³•æ ‘ã€‚<br><img src="/uploads/deeply-analyse-javascriptcore/03.png" alt=""></p>
<p>éœ€è¦å…ˆè®¾è®¡å¥½ Nodeï¼ŒNode çš„ç±»å…³ç³»å›¾å¦‚ä¸‹ï¼š<br><img src="/uploads/deeply-analyse-javascriptcore/04.png" alt=""><br>ä¸¾ä¸ªåŒ…å«åŠ å’Œä¹˜çš„ statement æ˜¯å¦‚ä½•ç»„æˆ AST çš„<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">o.x * o.x + o.y * o.y</span><br></pre></td></tr></table></figure><br><img src="/uploads/deeply-analyse-javascriptcore/05.png" alt=""><br>heap ä»£è¡¨çš„æ˜¯å¯è§æ•°æ®ï¼Œpure ä»£è¡¨çš„æ˜¯æŠ½è±¡è¯´æ˜ã€‚</p>
<p>ä¸‹é¢çœ‹çœ‹ Object çš„æ„é€ <br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> o = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">o.f = <span class="number">1</span>;</span><br><span class="line">o.g = <span class="number">2</span>;</span><br><span class="line">o.h = <span class="number">3</span>;</span><br></pre></td></tr></table></figure><br><img src="/uploads/deeply-analyse-javascriptcore/06.png" alt=""></p>
<p>æ¥ä¸‹æ¥çœ‹çœ‹ function çš„<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">o</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (o.f &amp;&amp; o.f() == <span class="number">42</span>)</span><br><span class="line">        print(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (o.g &amp;&amp; o.g() == <span class="number">63</span>)</span><br><span class="line">        print(<span class="string">&quot;bye&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><img src="/uploads/deeply-analyse-javascriptcore/07.png" alt=""></p>
<p>è¿˜æœ‰äº›å…¶å®ƒçš„ parser æ¯”å¦‚ Esprima æä¾›äº†ä¸€ä¸ªåœ¨çº¿ <a href="http://esprima.org/demo/parse.html">demo</a> å¯ä»¥åœ¨çº¿ Parserã€‚å®ç°çš„ä»£ç åœ¨è¿™é‡Œï¼š<a href="https://github.com/jquery/esprima/tree/master/src">https://github.com/jquery/esprima/tree/master/src</a> ä¸»è¦ä½¿ç”¨çš„æ˜¯é€’å½’ä¸‹é™å’Œè¿ç®—ç¬¦ä¼˜å…ˆçº§æ··åˆå¼æ¥åšçš„ parserã€‚</p>
<p>æˆ‘åœ¨ HTN ï¼ˆ<a href="https://github.com/ming1016/HTN">https://github.com/ming1016/HTN</a>ï¼‰é¡¹ç›®ä¸­åšäº†ä¸ª js çš„ AST çš„ builderï¼š<a href="https://github.com/ming1016/HTN/tree/master/Sources/Core/JavaScript">https://github.com/ming1016/HTN/tree/master/Sources/Core/JavaScript</a> åˆ†è¯å’Œè¯­æ³•æ ‘ç”Ÿæˆä½¿ç”¨çš„æ˜¯çŠ¶æ€æœºå¤„ç†é€’å½’ä¸‹é™ã€‚</p>
<p>WebKit çš„æ€§èƒ½ç›®å½•é‡Œæœ‰ç”¨ ES6 æ ‡å‡†å®ç°çš„ ECMA-55 BASIC è¿™ä¸ªè¯æ³•è¯­æ³•åˆ†æçš„æµ‹è¯•ã€‚ä»£ç åœ¨ï¼š<a href="https://trac.webkit.org/browser/trunk/PerformanceTests/ARES-6/Basic?rev=211697">https://trac.webkit.org/browser/trunk/PerformanceTests/ARES-6/Basic?rev=211697</a></p>
<p>ç¨‹åºä¼šè¢«è¡¨ç¤ºæˆæ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸å…¶ç›¸å…³çš„ä»£ç ï¼Œè¿™äº›ä»£ç éƒ½å¯ä»¥é€’å½’çš„è°ƒç”¨æ ‘ä¸­çš„å­èŠ‚ç‚¹ã€‚Basic çš„èŠ‚ç‚¹çš„ç»“æ„æ˜¯è¿™æ ·å­çš„ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">evaluate</span>: Basic.NumberPow, <span class="attr">left</span>: primary, <span class="attr">right</span>: parsePrimary()&#125;</span><br></pre></td></tr></table></figure><br>Basic æ˜¯ä»¥ä¸é‚£ä¹ˆå¸¸è§çš„æ–¹å¼ä½¿ç”¨ç”Ÿæˆå™¨çš„ï¼Œæ¯”å¦‚å¤šä¸ªç”Ÿæˆå™¨å‡½æ•°ï¼Œå¾ˆå¤š yield points å’Œé€’å½’ç”Ÿæˆå™¨è°ƒç”¨ã€‚Basic ä¹Ÿæœ‰ for-ofï¼Œç±»ï¼ŒMap å’Œ WeakMapã€‚æ‰€ä»¥ä¸Šçš„æµ‹è¯• ES6 ç¨‹åºé€šè¿‡ js å†™çš„ç¨‹åºå¸®åŠ©ç†è§£ ES6 çš„è§£æè¿‡ç¨‹ã€‚</p>
<h1 id="ä»£ç åˆ°-JIT-çš„è¿‡ç¨‹"><a href="#ä»£ç åˆ°-JIT-çš„è¿‡ç¨‹" class="headerlink" title="ä»£ç åˆ° JIT çš„è¿‡ç¨‹"></a>ä»£ç åˆ° JIT çš„è¿‡ç¨‹</h1><p>ProgramExecutable çš„åˆå§‹åŒ–ä¼šç”Ÿæˆ Lexerï¼ŒParser å’Œå­—èŠ‚ç ã€‚å…¥å£æ˜¯ä» JS Binding é‚£å±‚é‡Œè°ƒç”¨ ScriptController::evaluateInWorld è¿›æ¥ï¼Œè¿™ä¸ªæ–¹æ³•é‡Œçš„å‚æ•° sourceCode å°±æ˜¯ js çš„ä»£ç çš„æ¥æºï¼Œæ–¹æ³•å†…é€šè¿‡è°ƒç”¨ runtime/Completion.cpp é‡Œçš„æ–¹æ³• evaluate æ¥è¿›å…¥ executeProgram æ–¹æ³•çš„ã€‚æ€»çš„æ¥è¯´ ProgramExecutable ä¸»è¦æ˜¯æŠŠä»£ç ç¼–æˆå­—èŠ‚ç ï¼ŒInterpreter æ˜¯æ¥æ‰§è¡Œå­—èŠ‚ç çš„ã€‚<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JSValue result = vm.interpreter-&gt;<span class="built_in">executeProgram</span>(source, exec, thisObj);</span><br></pre></td></tr></table></figure><br>executeProgram æ–¹æ³•å°†æºç ç”Ÿæˆ ProgramExecutable è¿™ä¸ªå¯¹è±¡ã€‚<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ProgramExecutable* program = ProgramExecutable::<span class="built_in">create</span>(callFrame, source);</span><br></pre></td></tr></table></figure><br>è¿™ä¸ªå¯¹è±¡é‡Œæœ‰ StringView å¯¹è±¡ï¼Œprogram-&gt;source().view() è¿™æ ·å°±å¯ä»¥å¯¹æºç è¿›è¡Œæ“ä½œäº†ã€‚åœ¨é‚£ä¹‹å‰ä¼šå…ˆåˆ¤æ–­ä¸‹æ˜¯å¦è¿™æ®µ js ä»£ç ä»…ä»…åªæ˜¯ä¸€ä¸ª JSON å¯¹è±¡ï¼Œå¦‚æœæ˜¯å°±åœ°æŒ‰ç…§ JSON å¯¹è±¡å¤„ç†ï¼Œä¸ç„¶å°±æŒ‰ç…§æ™®é€šçš„ js ä»£ç æ¥å¤„ç†ã€‚</p>
<p>æ™®é€šå¤„ç†ä¼šå…ˆç¼–è¯‘æˆå­—èŠ‚ç ï¼Œè¿‡ç¨‹æ˜¯å…ˆåˆå§‹åŒ–å…¨å±€å±æ€§ï¼š<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JSObject* error = program-&gt;<span class="built_in">initializeGlobalProperties</span>(vm, callFrame, scope);</span><br></pre></td></tr></table></figure><br>å¤„ç†çš„ç»“æœéƒ½ä¼šè®°å½•åœ¨ callFrame é‡Œã€‚ä¸»è¦æ˜¯é€šè¿‡ JSGlobalObject è¿™ä¸ªå¯¹è±¡çš„ addFunction å’Œ addVar æ–¹æ³•è®°å½• Parser å‡ºé‚£äº›åœ¨å…¨å±€ç©ºé—´çš„é‚£äº› letï¼Œconst å’Œ class çš„å…¨å±€å±æ€§ï¼Œæˆ–è€… varï¼Œlet å’Œ const çš„å…¨å±€å˜é‡ã€‚</p>
<p>æ¥ä¸‹æ¥ä¼šåˆ›å»ºä¸€ä¸ª codeBlockï¼š<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ProgramCodeBlock* codeBlock;</span><br><span class="line">    &#123;</span><br><span class="line">        CodeBlock* tempCodeBlock;</span><br><span class="line">        JSObject* error = program-&gt;prepareForExecution&lt;ProgramExecutable&gt;(vm, <span class="literal">nullptr</span>, scope, CodeForCall, tempCodeBlock);</span><br><span class="line">        <span class="built_in">EXCEPTION_ASSERT</span>(throwScope.<span class="built_in">exception</span>() == <span class="keyword">reinterpret_cast</span>&lt;Exception*&gt;(error));</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">UNLIKELY</span>(error))</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">checkedReturn</span>(error);</span><br><span class="line">        codeBlock = jsCast&lt;ProgramCodeBlock*&gt;(tempCodeBlock);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><br>è¿™é‡Œ ProgramExecutable ä¼šé€šè¿‡ prepareForExecution æ–¹æ³•é‡Œè°ƒç”¨ prepareForExecutionImpl æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ CodeBlockã€‚<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">CodeBlock* codeBlock = <span class="built_in">newCodeBlockFor</span>(kind, function, scope, exception);</span><br><span class="line">resultCodeBlock = codeBlock;</span><br><span class="line"><span class="built_in">EXCEPTION_ASSERT</span>(!!throwScope.<span class="built_in">exception</span>() == !codeBlock);</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">UNLIKELY</span>(!codeBlock))</span><br><span class="line">    <span class="keyword">return</span> exception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (Options::<span class="built_in">validateBytecode</span>())</span><br><span class="line">    codeBlock-&gt;<span class="built_in">validate</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (Options::<span class="built_in">useLLInt</span>())</span><br><span class="line">    <span class="built_in">setupLLInt</span>(vm, codeBlock);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">setupJIT</span>(vm, codeBlock);</span><br><span class="line"></span><br><span class="line"><span class="built_in">installCode</span>(vm, codeBlock, codeBlock-&gt;<span class="built_in">codeType</span>(), codeBlock-&gt;<span class="built_in">specializationKind</span>());</span><br></pre></td></tr></table></figure><br>è¿™é‡Œçœ‹åˆ°ï¼Œå¦‚æœ Options æ˜¯æŒ‡å®š LLInt çš„è¯å°±ä¼šè°ƒ setupLLInt æ–¹æ³•å»è®¾ç½®è¿™ä¸ª codeBlockï¼Œä¸ç„¶å°±é€šè¿‡ JIT æ¥ã€‚LLInt åœ¨ LLIntSlowPaths.cpp é‡Œé€šè¿‡  C å‡½æ•°å°è£…äº† LowLevelInterpreter.asm é‡Œçš„æ‰§è¡ŒæŒ‡ä»¤çš„æ±‡ç¼–ã€‚è§¦å‘ JIT ä¼˜åŒ–æ˜¯é€šè¿‡çƒ­ç‚¹æ¢æµ‹æ–¹æ³•ï¼ŒLLInt ä¼šåœ¨å­—èŠ‚ç çš„ loop_hint å¾ªç¯è®¡æ•°å’Œ ret å‡½æ•°è¿”å›æŒ‡ä»¤çš„æ—¶å€™è¿›è¡Œç»Ÿè®¡ï¼Œç»“æœä¿å­˜åœ¨ ExcutionCounter é‡Œã€‚å½“å‡½æ•°æˆ–å¾ªç¯ä½“æ‰§è¡Œä¸€å®šæ¬¡æ•°æ—¶ï¼Œé€šè¿‡ checkIfThresholdCrossedAndSet æ–¹æ³•å¾—åˆ°å¸ƒå°”å€¼ç»“æœæ¥å†³å®šæ˜¯å¦ç”¨ JIT ç¼–è¯‘ã€‚</p>
<p>CodeBlock æœ‰ GlobalCodeï¼ŒEvalCodeï¼ŒFunctionCodeï¼ŒModuleCode è¿™äº›ç±»å‹ï¼Œç”¨äº LLInt å’Œ JITã€‚ç¼–è¯‘åçš„ ByteCode ä¼šå­˜åœ¨ UnlinkedCodeBlock é‡Œã€‚</p>
<h1 id="åˆ†å±‚ç¼–è¯‘"><a href="#åˆ†å±‚ç¼–è¯‘" class="headerlink" title="åˆ†å±‚ç¼–è¯‘"></a>åˆ†å±‚ç¼–è¯‘</h1><p>æ€»çš„æ¥è¯´ JavaScriptCore æ˜¯é‡‡ç”¨äº†ç±»å‹æ¨æµ‹å’Œåˆ†å±‚ç¼–è¯‘çš„æ€æƒ³ï¼Œè§£ææˆå­—èŠ‚ç å LLInt çš„ä½œç”¨å°±æ˜¯è®© js ä»£ç èƒ½å¤Ÿæ—©ç‚¹æ‰§è¡Œï¼Œç”±äºè§£é‡Šçš„æ•ˆç‡ä¸é«˜ï¼Œæ‰€ä»¥è¾¾åˆ°ä¸€å®šæ¡ä»¶å¯ä»¥å¹¶è¡Œçš„é€šè¿‡ Baseline JIT ç¼–è¯‘æˆæ›´é«˜æ•ˆçš„å­—èŠ‚ç æ¥è§£é‡Šï¼Œå¦‚æœåˆ°äº†æ›´åŠ å®¹æ˜“ä½¿å¾— LLInt è§£é‡Šæ•ˆç‡å·®çš„æƒ…å†µå°±ä¼šå¹¶è¡Œä½¿ç”¨ DFG JIT ï¼ŒDFG ç¼–è¯‘çš„ç»“æœä¹Ÿæœ‰ä»£è¡¨ On stack replacement çš„ osrExitSites æ•°ç»„ï¼Œè¿™æ ·çš„å­—èŠ‚ç çš„è§£é‡Šæ€§èƒ½ä¼šæ›´å¥½ï¼Œå¦‚æœå‡è®¾è§£é‡Šå¤±è´¥è¿˜å¯ä»¥å†å›åˆ° Baselineï¼Œä¹Ÿä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ã€‚å¯ç”¨ FTL çš„æ¡ä»¶å°±æ›´é«˜äº†ï¼Œå¯èƒ½å‡½æ•°è°ƒç”¨äº†å¥½å‡ ä¸‡æ¬¡ä¹Ÿéƒ½ä¸ä¼šå¼€å¯ã€‚</p>
<p>åˆ†å±‚ç¼–è¯‘çš„ä¸»è¦æ€æƒ³æ˜¯å…ˆæŠŠæºç è§£é‡Šæˆä¸€ç§å†…éƒ¨çš„è¡¨ç¤ºä¹Ÿå°±æ˜¯å­—èŠ‚ç ï¼Œå°†å…¶ä¸­ä½¿ç”¨ç‡é«˜çš„å­—èŠ‚ç è½¬æˆæ±‡ç¼–ä»£ç ï¼Œæ±‡ç¼–ä»£ç å¯ä»¥ç”± CPU ç›´æ¥æ‰§è¡Œæ¥æœ€å¤§ç¨‹åº¦çš„æé«˜æ€§èƒ½ã€‚</p>
<p>LLIntï¼ŒBaseline JIT å’Œ DFG ä¸‰è€…ä¼šåŒæ—¶è¿è¡Œã€‚å¯ä»¥åœ¨ jsc.cpp é‡Œæ·»åŠ æ—¥å¿—è§‚å¯Ÿä»–ä»¬çš„å·¥ä½œçŠ¶æ€<br><img src="/uploads/deeply-analyse-javascriptcore/08.png" alt=""></p>
<p>ç®­å¤´æŒ‡ç¤ºçš„æ˜¯å †æ ˆæ›¿æ¢ on-stack replacementï¼Œç®€ç§° OSRã€‚è¿™ä¸ªæŠ€æœ¯å¯ä»¥å°†æ‰§è¡Œè½¬ç§»åˆ°ä»»ä½• statement çš„åœ°æ–¹ã€‚OSR å¯ä»¥ä¸ç®¡æ‰§è¡Œå¼•æ“æ˜¯ä»€ä¹ˆéƒ½åœ¨å»è§£æå­—èŠ‚ç çŠ¶æ€ï¼Œå¹¶ä¸”èƒ½å¤Ÿé‡æ„å®ƒå»è®©å…¶å®ƒå¼•æ“ç»§ç»­æ‰§è¡Œï¼ŒOSR entry æ˜¯è¿›å…¥æ›´é«˜å±‚ä¼˜åŒ–ï¼ŒOSR exit æ˜¯é™è‡³ä½å±‚ã€‚LLInt åˆ° Baseline JIT æ—¶ OSR åªéœ€è¦è·³è½¬åˆ°ç›¸åº”çš„æœºå™¨ä»£ç åœ°å€å°±è¡Œï¼Œå› ä¸º Baseline JIT æ¯ä¸ªæŒ‡ä»¤è¾¹ç•Œä¸Šçš„æ‰€æœ‰å˜é‡çš„è¡¨ç¤ºå’Œ LLInt æ˜¯ä¸€æ ·çš„ã€‚è¿›å…¥ DFG JIT å°±ä¼šå¤æ‚äº›ï¼ŒDFG é€šè¿‡å°†å‡½æ•°æ§åˆ¶æµå›¾å½“ä½œå¤šä¸ªè¿›å…¥ç‚¹ï¼Œä¸€ä¸ªæ˜¯å‡½æ•°å‡½æ•°å¯åŠ¨å…¥å£ä¸€ä¸ªæ˜¯å¾ªç¯çš„å…¥å£ã€‚</p>
<p>å¦‚æœæ¯ä¸ªå‡½æ•°éƒ½ç”¨åƒ DFG JIT æ¥ä¼˜åŒ–é‚£ä¹ˆæ¶ˆè€—å¤ªå¤§ï¼Œè¿™å°±ç±»ä¼¼æ¯æ¬¡è¿è¡Œå°±æ¥ä¸ªå®Œæ•´çš„æºç ç¼–è¯‘æˆæœ¬åœ°åº”ç”¨é‚£æ ·ã€‚å¦‚æœæ¯ä¸ªè¯­å¥éƒ½åªæ‰§è¡Œä¸€æ¬¡ï¼Œé‚£ä¹ˆ JIT ç¼–è¯‘å°±ä¼šæ¯” LLInt æ˜¯æ—¶é—´è¦é•¿ï¼Œå¦‚æœæ‰§è¡Œçš„æ¬¡æ•°è¶Šå¤šï¼Œé‚£ä¹ˆ LLInt è¿™ç§è§£é‡Šæ–¹å¼å°±ä¼šæ¯”ç¼–è¯‘æ–¹å¼è¦å·®ï¼ŒLLInt çš„å¤§éƒ¨åˆ†æ—¶é—´éƒ½æ¶ˆè€—åœ¨åˆ†æ´¾ä¸‹ä¸ªå­—èŠ‚ç æŒ‡ä»¤çš„æ“ä½œä¸Šäº†ã€‚</p>
<h2 id="DFG-JIT"><a href="#DFG-JIT" class="headerlink" title="DFG JIT"></a>DFG JIT</h2><p>å…¨ç§° data flow graph JIT æ•°æ®æµå›¾ JITã€‚æ˜¯ä¸€ç§æ¨æµ‹ä¼˜åŒ–çš„æŠ€æœ¯ã€‚ä¼šå¼€å§‹å¯¹ä¸€ä¸ªç±»å‹åšå‡ºä¸€ä¸ªèƒ½å¤Ÿå¯¹æ€§èƒ½å¥½çš„å‡è®¾ï¼Œå…ˆç¼–è¯‘ä¸€ä¸ªç‰ˆæœ¬ï¼Œå¦‚æœåé¢å‘ç°å‡è®¾ä¸å¯¹å°±ä¼šè·³è½¬å›åŸå…ˆä»£ç ï¼Œç§°ä¸º Speculation failureã€‚DFG æ˜¯å¹¶å‘ç¼–è¯‘å™¨ï¼ŒDFG pipeline çš„æ¯ä¸ªéƒ¨åˆ†éƒ½æ˜¯åŒæ—¶è¿è¡Œçš„ï¼ŒåŒ…æ‹¬å­—èŠ‚ç è§£æå’Œåˆ†æã€‚</p>
<p><img src="/uploads/deeply-analyse-javascriptcore/09.png" alt=""><br>ä¸Šå›¾æ˜¯ DFG JIT çš„ä¼˜åŒ– pipelineã€‚å¼€å§‹ DFG ä¼šæŠŠå­—èŠ‚ç è½¬æˆ DFG CPS æ ¼å¼ï¼Œè¿™ä¸ªæ ¼å¼ä¼šæè¿°å˜é‡å’Œä¸´æ—¶æ•°æ®ä¹‹é—´çš„æ•°æ®æµå…³ç³»ã€‚å†ç”¨åˆ†æä¿¡æ¯æ¥æ¨æµ‹ç±»å‹ï¼Œé€šè¿‡æ¨æµ‹çš„ç±»å‹å‡å°‘ç±»å‹çš„æ£€æŸ¥ã€‚æ¥ç€è¿›è¡Œä¼ ç»Ÿçš„ç¼–è¯‘å™¨æ–¹é¢çš„ä¼˜åŒ–ï¼Œæœ€åç¼–è¯‘å™¨é€šè¿‡ DFG CPS æ ¼å¼ç›´æ¥ç”Ÿæˆæœºå™¨ç ã€‚</p>
<p>DFG JIT ä¼šå°†å­—èŠ‚ç è§£ææˆ SSA å½¢å¼ï¼ŒæŒ‰æ‰§è¡Œè·¯å¾„æ”¶é›†ç±»å‹ä¿¡æ¯ã€‚ä¼šä½¿ç”¨ inlining å’Œ value profiling ç­‰ä¸€äº›é™æ€åˆ†ææŠ€æœ¯ã€‚ç±»å‹æ¨å¯¼æŠŠ value profile é‡Œçš„å¸¸ç”¨çš„ç±»å‹ä½œä¸ºåé¢ç”¨çš„ç±»å‹æ¥é¢„æµ‹ï¼Œåœ¨ SpeculatedType.h é‡Œå®šä¹‰é‡Œä¸€äº›æ•°æ®ç±»å‹ï¼Œç¬¦åˆ <a href="https://en.wikipedia.org/wiki/Data-flow_analysis">Data-flow analysis</a> è§„èŒƒï¼Œå…·ä½“å®ç°åœ¨ DFGPredictionPropagationPhase.cpp é‡Œã€‚Baseline JIT æ¬¡æ•°è¶…è¿‡ä¸€å®šæ•°é‡å°±ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ç±»å‹ï¼Œå¯èƒ½ä¼šè§¦å‘ DFG ä¹Ÿå¯èƒ½ä¼šè®© Baseline JIT å†æ‰§è¡Œå‡ æ¬¡ã€‚</p>
<p>DFG çš„ register allocator ä¸­æ±‡ç¼–ç¨‹åºä½¿ç”¨çš„æ˜¯äºŒåœ°å€ï¼Œä¸ç”¨ op dest, src1, src2 è¿™æ ·ä¸‰åœ°å€å½¢å¼ï¼Œåªéœ€è¦ op src1, src2 è¿™æ ·çš„äºŒåœ°å€å½¢å¼ï¼Œç»“æœå­˜åœ¨ç¬¬ä¸€ä¸ªæ“ä½œæ•°é‡Œã€‚</p>
<p>DFG JIT å°†ä½æ•ˆå­—èŠ‚ç è½¬æˆæ›´ä¼˜åŒ–çš„é«˜æ•ˆå½¢å¼ã€‚DFG ç»“åˆä¼ ç»Ÿç¼–è¯‘å™¨çš„ä¼˜åŒ–ï¼Œæ¯”å¦‚å¯„å­˜å™¨çš„åˆ†é…ï¼Œæ§åˆ¶æµå›¾çš„ç®€åŒ–ï¼Œå…¬å…±å­è¡¨è¾¾å¼æ¶ˆé™¤ï¼Œæ­»ä»£ç æ¶ˆé™¤å’Œç¨€ç–æ¡ä»¶å¸¸é‡ä¼ æ’­ç­‰ã€‚ä½†æ˜¯æ­£å„¿å…«ç»çš„ç¼–è¯‘å™¨æ˜¯éœ€è¦çŸ¥é“å˜é‡ç±»å‹å’Œå †é‡Œé¢çš„å¯¹è±¡çš„ç»“æ„çš„ï¼Œè¿™æ ·æ‰èƒ½æ›´å¥½çš„ä¼˜åŒ–ã€‚DFG JIT ä½¿ç”¨çš„æ˜¯ LLInt å’Œ Baseline JIT é‡Œåˆ†æå‡ºçš„å˜é‡ç±»å‹æ¥æ¨æ–­çš„ã€‚æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">plusThe</span>(<span class="params">x</span>) </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> x + <span class="number">1</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è¿™é‡Œçš„ x ä»ä»£ç ä¸Šçœ‹æ˜¯çœ‹ä¸å‡ºç±»å‹çš„ï¼Œå®ƒå¯èƒ½æ˜¯å­—ç¬¦ä¸²ä¹Ÿå¯èƒ½æ˜¯ integer æˆ–è€… doubleã€‚LLInt å’Œ Baseline JIT ä¼šä»å‡½æ•°å‚æ•°æˆ–è€…æ¥è‡ªå †çš„è¯»å–æ¥æ”¶é›†æ¯ä¸ªå˜é‡çš„å€¼ä¿¡æ¯ã€‚DFG ä¸ä¼šä¸€å¼€å§‹å°±ç¼–è¯‘ plusThe è¿™ä¸ªå‡½æ•°ï¼Œå®ƒä¼šç­‰åˆ°è¿™ä¸ªå‡½æ•°è¢«æ‰§è¡Œäº†å¾ˆå¤šæ¬¡ï¼Œè®© LLInt å’Œ Baseline JIT å°½å¯èƒ½çš„æŠŠç±»å‹ä¿¡æ¯æ”¶é›†å…¨ã€‚æ ¹æ®è¿™äº›ä¿¡æ¯æ¥å‡è®¾ä¸€ä¸ªç±»å‹ï¼Œä¸€ä¸ªç¡®å®šçš„ç±»å‹ä¼šèŠ‚çœç©ºé—´å’Œæ‰§è¡Œæ—¶é—´ã€‚å¦‚æœå‡è®¾çš„æ£€æŸ¥å¤±è´¥ï¼Œå°±é€šè¿‡ OSR æŠŠæ‰§è¡Œè½¬ç§»åˆ° Baseline JIT ä¸Šã€‚</p>
<h2 id="FTL-JIT"><a href="#FTL-JIT" class="headerlink" title="FTL JIT"></a>FTL JIT</h2><p>DFG JIT å¯ä»¥ä¼˜åŒ– long-running è¿è¡Œçš„ä»£ç æ€§èƒ½ï¼Œä½†æ˜¯ä¼šå½±å“ short-running çš„ç¨‹åºï¼ŒDFG ç¼–è¯‘çš„æ—¶é—´å’Œ DFG ç”Ÿæˆä»£ç çš„è´¨é‡ç›¸æ¯”è¾ƒæ¥è¯´è¿˜æ˜¯è¿‡å¤§ã€‚æƒ³è®© DFG ç”Ÿæˆæ›´å¥½çš„ä»£ç éƒ½ä¼šé™ä½ä»£ç é€Ÿåº¦ï¼Œè¿˜ä¼šå¢åŠ  shorter-running ä»£ç çš„å»¶è¿Ÿã€‚DFG ä¸å¯èƒ½åŒæ—¶æˆä¸ºä½å»¶è¿Ÿä¼˜åŒ–å’Œ high-throughput ä»£ç ç¼–è¯‘å™¨ã€‚è¿™æ—¶å°±éœ€è¦å†å¤šä¸€å±‚æ¥åšè¾ƒé‡çš„ä¼˜åŒ–ï¼ŒåŒæ—¶è®© DFG ä¿æŒè‡ªå·±çš„è½»ä½“é‡ï¼Œä½¿å¾— longer-running å’Œ shorter-running ä»£ç èƒ½å¤Ÿä¿æŒå¹³è¡¡ã€‚<br><img src="/uploads/deeply-analyse-javascriptcore/10.png" alt=""><br>æ–°çš„ä¸€å±‚ FTL å®é™…ä¸Šæ˜¯ DFG Backend çš„æ›¿æ¢ã€‚ä¼šå…ˆåœ¨ DFG çš„ JavaScript å‡½æ•°è¡¨ç¤ºè½¬æ¢ä¸ºé™æ€å•ä¸€æŒ‡æ´¾ï¼ˆSSAï¼‰ æ ¼å¼ä¸Šåšäº› JavaScript ç‰¹æ€§çš„ä¼˜åŒ–ã€‚æ¥ç€æŠŠ DFG IR è½¬æ¢æˆ FTL é‡Œç”¨åˆ°çš„ B3 çš„ IRã€‚æœ€åç”Ÿæˆæœºå™¨ç ã€‚</p>
<p>DFG çš„æœºå™¨ä»£ç ç”Ÿæˆå™¨å¾ˆå¿«ï¼Œä½†æ²¡æœ‰ä½çº§ä¼˜åŒ–ã€‚å¯¹è¿™å—çš„ä¼˜åŒ–é‡‡ç”¨å…ˆè½¬æˆ SSA å½¢å¼ï¼Œæ‰§è¡Œæ¯”å¦‚è‡ªåŠ¨æ‰§è¡Œå¾ªç¯ä¸å˜é‡ä»£ç æ¥æé«˜æ‰§è¡Œé€Ÿç‡çš„å¾ªç¯ä¸å˜é‡ä»£ç ç§»åŠ¨ï¼ˆloop-invariant code motionï¼‰çš„ä¼˜åŒ–æŠ€æœ¯ï¼Œè¿™äº›ä¼˜åŒ–å®Œæˆåå°±å¯ä»¥ straight-forward linear å’Œ ä¸€å¯¹å¤šï¼ˆDFG SSA çš„æ¯ä¸ªæŒ‡ä»¤éƒ½å¯ä»¥äº§ç”Ÿï¼‰çš„è½¬æ¢ä¸ºä¹ŸåŸºäº SSA çš„æ²¡æœ‰ JavaScript è¯­è¨€ç‰¹æ€§çš„ B3 çš„ IRã€‚æ€»çš„æ¥è¯´è¿‡ç¨‹å°±æ˜¯æŠŠæºç ç”Ÿæˆå­—èŠ‚ç ï¼Œæ¥ç€å˜æˆ DFG CPS IRï¼Œå†å°±æ˜¯ DFG SSA IRï¼Œæœ€åæˆ B3 çš„ IRï¼ŒJavaScript çš„åŠ¨æ€æ€§å°±æ˜¯åœ¨è¿™äº›è¿‡ç¨‹ä¸­ä¸€æ­¥æ­¥è¢«æ¶ˆé™¤æ‰çš„ã€‚</p>
<p><img src="/uploads/deeply-analyse-javascriptcore/11.png" alt=""><br>ä»£ç åœ¨ LLIntï¼ŒBaseline JIT å’Œ DFG JIT è¿è¡Œä¸€æ®µæ—¶é—´æ‰ä¼šè°ƒç”¨ FTLã€‚FTL åœ¨å¹¶å‘çº¿ç¨‹ä¸­ä¼šä»å®ƒä»¬é‚£æ”¶é›†åˆ†æä¿¡æ¯ã€‚short-running ä»£ç æ˜¯ä¸ä¼šå¯¼è‡´ FTL ç¼–è¯‘çš„ï¼Œä¸€èˆ¬è¶…è¿‡10æ¯«ç§’çš„å‡½æ•°ä¼šè§¦å‘ FTL ç¼–è¯‘ã€‚</p>
<p>FTL é€šè¿‡å¹¶å‘ç¼–è¯‘å‡å°å¯¹å¯åŠ¨é€Ÿåº¦çš„å½±å“ã€‚</p>
<h2 id="FTL-Backend-B3"><a href="#FTL-Backend-B3" class="headerlink" title="FTL Backend B3"></a>FTL Backend B3</h2><p>B3 çš„å…¨ç§° Bare Bones Backendï¼Œå®ç°äº†å¤§ååé‡åŒæ—¶ç¼©çŸ­æ€»ä½“ FTL ç¼–è¯‘æ—¶é—´ã€‚B3 çš„ IR æ˜¯ä¸€ä¸ªä½çº§åˆ«çš„ä¸­é—´è¡¨ç¤ºï¼Œä½çº§åˆ«æ„å‘³ç€éœ€è¦å¤§é‡å†…å­˜å»è¡¨ç¤ºæ¯ä¸ªå‡½æ•°ï¼Œå¤§é‡çš„å†…å­˜æ„å‘³ç€ç¼–è¯‘å™¨åœ¨åˆ†æå‡½æ•°æ—¶éœ€è¦æ‰«æå¤§é‡å†…å­˜ã€‚B3 æœ‰ä¸¤ä¸ª IRï¼Œä¸€ä¸ªå« B3 IR å¦ä¸€ä¸ªæœºå™¨çº§åˆ«çš„å« Assembly IRï¼Œç®€ç§° Airã€‚è¿™ä¸¤ä¸ª IR çš„ç›®æ ‡æ˜¯ä»£è¡¨ä½çº§æ“ä½œï¼ŒåŒæ—¶èƒ½æœ€å¤§é™åº¦çš„å‡å°‘åˆ†æä»£ç æ‰€éœ€è¦çš„å†…å­˜è®¿é—®ã€‚è¾¾åˆ°è¿™ä¸ªç›®æ ‡éœ€è¦å‡å°‘ IR å¯¹è±¡æ•´ä½“å¤§å°ï¼Œå‡å°‘è¡¨ç¤ºå…¸å‹æ“ä½œçš„ IR å¯¹è±¡æ•°é‡ï¼Œå‡å°‘ IR çš„ pointer chasingï¼Œæœ€åæ—¶å‡å°‘ IR çš„æ€»æ•°ã€‚</p>
<p>B3 è½¬æ¢æˆ Air ä¼šé€šè¿‡æ‰§è¡Œåå‘è´ªå©ªæ¨¡å¼åŒ¹é…æ¥å·§å¦™åœ°é’ˆå¯¹æ¯ä¸ª B3 æ“ä½œé€‰æ‹©æ­£ç¡®çš„ Air åºåˆ—ã€‚å…·ä½“çš„å®ç°å¯ä»¥å‚çœ‹ B3LowerToAir.cpp çš„ä»£ç ã€‚</p>
<p>ä¸‹é¢æ¥çœ‹çœ‹ B3 IR çš„æ‰€åšçš„ä¼˜åŒ–ã€‚</p>
<ul>
<li>Strength reductionï¼šä¸»è¦åŒ…æ‹¬æ§åˆ¶æµç¨‹å›¾çš„ç®€åŒ–ï¼Œå¸¸é‡åˆå¹¶ï¼Œæ¶ˆé™¤æ­»ä»£ç ï¼Œå‰ªé™¤æ•´æ•°æº¢å‡ºçš„æ£€æŸ¥ï¼Œè¿˜æœ‰å…¶å®ƒç®€åŒ–è§„åˆ™ã€‚å®ç°æ–‡ä»¶æ˜¯ B3ReduceStrength.cppã€‚</li>
<li>Flow-sensitive å¸¸é‡åˆå¹¶ï¼šåœ¨ B3FoldPathConstants.cpp æ–‡ä»¶é‡Œã€‚</li>
<li>å…¨å±€å…±ç”¨å­è¡¨è¾¾å¼æ¶ˆé™¤ï¼šå®ç°æ–‡ä»¶ B3EliminateCommonSubexpressions.cppã€‚</li>
<li>Tail duplicationï¼šB3DuplicateTails.cpp</li>
<li>SSA ä¿®æ­£ï¼šB3FixSSA.cpp</li>
<li>ä¼˜åŒ–å¸¸é‡å®é™…çš„ä½ç½®ï¼šB3MoveConstants.cpp</li>
</ul>
<p>Air é‡Œåšçš„ä¼˜åŒ–åŒ…æ‹¬å»é™¤æ­»ä»£ç ï¼Œæ§åˆ¶æµå›¾çš„ç®€åŒ–ä»¥åŠä¿®æ­£éƒ¨åˆ†å¯„å­˜å™¨ stalls å’Œæº¢å‡ºä»£ç ç—‡çŠ¶ã€‚Air æœ€é‡è¦çš„ä¼˜åŒ–æ˜¯å¯„å­˜å™¨åˆ†é…ã€‚</p>
<p>B3 çš„åŠ¨æ€è¯­è¨€æ”¯æŒé çš„æ˜¯ Patchpointsï¼Œè¿˜æœ‰ä¸€åŠåŠŸåŠ³æ˜¯æ“ä½œç çš„ Check familyï¼Œç”¨æ¥å®ç°æ ˆä¸Šæ›¿æ¢ï¼Œå³ OSRã€‚JavaScript æ˜¯ç§åŠ¨æ€è¯­è¨€ï¼Œæ²¡æœ‰å¯ä»¥å¿«é€Ÿæ‰§è¡Œçš„ç±»å‹å’Œæ“ä½œï¼ŒFTL JIT å°±ä½¿ç”¨æ¨æµ‹è¡Œä¸ºæ–¹å¼æŠŠè¿™äº›æ“ä½œè½¬æ¢æˆå¿«é€Ÿä»£ç ã€‚</p>
<p>Air åœ¨å¯„å­˜å™¨åˆ†é…å™¨çš„é€‰æ‹©ä¸Šä½¿ç”¨äº†ç»å…¸çš„å›¾å½¢ç€è‰²å¯„å­˜å™¨åˆ†é…å™¨ï¼Œå«è¿­ä»£å¯„å­˜å™¨åˆå¹¶ï¼Œç®€ç§° IRCã€‚</p>
<h1 id="ç±»å‹åˆ†æ"><a href="#ç±»å‹åˆ†æ" class="headerlink" title="ç±»å‹åˆ†æ"></a>ç±»å‹åˆ†æ</h1><p>Web Inspector å·¥å…·æ˜¯ WebKit é‡Œæä¾›çš„è°ƒè¯•å·¥å…·ï¼Œé€šè¿‡è¿™ä¸ªå·¥å…·å¯ä»¥å¾ˆå¥½çš„è§‚å¯Ÿå“ªäº›å‡½æ•°ç”šè‡³å“ªäº›æ¡ä»¶æ‰§è¡Œäº†æˆ–è€…æ²¡æœ‰æ‰§è¡Œã€‚æœ€é‡è¦çš„æ˜¯å¯ä»¥ç›´è§‚çš„è§‚å¯Ÿå˜é‡ç±»å‹ï¼Œè¿˜èƒ½å¤Ÿè·Ÿè¸ªå€¼çš„ç»§æ‰¿é“¾ã€‚<br><img src="/uploads/deeply-analyse-javascriptcore/12.png" alt=""><br>JavaScript æ˜¯åŠ¨æ€ç±»å‹è¯­è¨€ï¼Œä»»ä½•å˜é‡éƒ½å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼Œè¡¨è¾¾å¼å¯ä»¥æœ‰ä»»ä½•ç±»å‹ï¼Œå‡½æ•°å¯ä»¥è¿”å›ä»»ä½•ç±»å‹ç­‰ç­‰ã€‚ç”±äºä¸èƒ½ç«‹åˆ»å¾—åˆ°ç±»å‹å°±æ²¡æ³•ç¡®å®šåœ°å€å­—èŠ‚å¤§å°ï¼Œéœ€è¦åœ¨è¿è¡Œæ—¶å»åå¤æ¨æ–­ã€‚é™æ€è¯­è¨€å°±ä¸ä¸€æ ·ï¼Œä¸€å¼€å§‹æ˜ç¡®äº†ç±»å‹ï¼Œæ¯”å¦‚ç›®æ ‡å¹³å° int ç±»å‹å ç”¨4ä¸ªå­—èŠ‚ï¼Œå®ƒå¯¹åº”çš„å¯¹è±¡æ˜¯ä¸ªåœ°å€ï¼Œåç§»é‡æ˜¯0ï¼Œè®¿é—® int æ—¶éœ€è¦å°†å¯¹è±¡åœ°å€åŠ ä¸Š4ä¸ªå­—èŠ‚ã€‚æ‰€ä»¥è¯­è¨€è§£é‡Šç³»ç»Ÿåªè¦ç”¨æ•°ç»„å’Œä½ç§»æ¥å­˜å˜é‡å’Œæ–¹æ³•åœ°å€å°±è¡Œäº†ï¼Œè¿™æ ·å‡ ä¸ªæœºå™¨è¯­è¨€çš„æŒ‡ä»¤å°±å¯ä»¥å¯¹å…¶æ‰§è¡Œå„ç§æ“ä½œã€‚</p>
<p>ä¸‹é¢æ¥ä¸ªä¾‹å­ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="number">3</span>;</span><br><span class="line">print(x);</span><br><span class="line">x = [<span class="string">&quot;These&quot;</span>, <span class="string">&quot;is&quot;</span>, <span class="string">&quot;array with string&quot;</span>];</span><br><span class="line">print(x);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> justReturn = <span class="function">(<span class="params">x</span>) =&gt;</span> &#123; <span class="keyword">return</span> x; &#125;;</span><br><span class="line">justReturn(<span class="number">10</span>);</span><br><span class="line">justReturn([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line">justReturn(<span class="string">&quot;I am bad!&quot;</span>);</span><br></pre></td></tr></table></figure><br>JavaScript æ²¡æœ‰ç±»å‹é™åˆ¶ï¼Œè¯­æ³•ä¸é”™å°±æ²¡é—®é¢˜ï¼Œå¦‚æœæ˜¯é™æ€ç±»å‹è¯­è¨€çš„è¯å°±æ²¡æ³•åƒä¸Šé¢çš„ä¾‹å­ä¸€æ ·æŠŠæ•°ç»„èµ‹ç»™æ•°å­—ç±»å‹çš„å˜é‡ã€‚åœ¨ Type Profiler ä¸­ä¼šæ˜¾ç¤ºç±»å‹åä¸º String? å’Œ Integer? è¿™æ ·åé¢è·Ÿç€é—®å·ç¬¦å·çš„è¡¨ç¤ºï¼Œè¿™æ˜¯åœ¨æœ‰å¤šä¸ªä¸åŒç±»å‹è¢«åˆ†é…ç»™ç›¸åŒå˜é‡ï¼Œå‡½æ•°å‚æ•°ä¼ é€’å’Œå‡½æ•°è¿”å›æ—¶å‘ç”Ÿçš„ã€‚æŸ¥çœ‹æ—¶å¯ä»¥çœ‹åˆ°æ‰€æœ‰è¿™äº›è¢«æ”¶é›†çš„ç±»å‹çš„ä¿¡æ¯ã€‚</p>
<p>é‚£ä¹ˆ JavaScriptCore æ˜¯å¦‚ä½•åˆ†æå˜é‡ç±»å‹çš„å‘¢ï¼Ÿå…ˆçœ‹æ®µ js ä»£ç ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å¯¹åº”çš„å­—èŠ‚ç ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>: 10 <span class="title">m_instructions</span></span>; <span class="number">3</span> parameter(s); <span class="number">1</span> variable(s)</span><br><span class="line">[ <span class="number">0</span>] enter             </span><br><span class="line">[ <span class="number">1</span>] get_scope       loc0</span><br><span class="line">[ <span class="number">3</span>] add             loc1, arg1, arg2</span><br><span class="line">[ <span class="number">8</span>] ret             loc1</span><br></pre></td></tr></table></figure><br>ä¸‹é¢çœ‹çœ‹å¼€å¯äº† Type Profiler åçš„å­—èŠ‚ç æ˜¯ä»€ä¹ˆæ ·çš„ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>: 40 <span class="title">m_instructions</span></span>; <span class="number">3</span> parameter(s); <span class="number">1</span> variable(s)</span><br><span class="line">[ <span class="number">0</span>] enter             </span><br><span class="line">[ <span class="number">1</span>] get_scope         loc0</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ†æå‡½æ•°å‚æ•°</span></span><br><span class="line">[ <span class="number">3</span>] op_profile_type   arg1 </span><br><span class="line">[ <span class="number">9</span>] op_profile_type   arg2</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ†æ add è¡¨è¾¾å¼çš„æ“ä½œæ•°</span></span><br><span class="line">[<span class="number">15</span>] op_profile_type   arg1</span><br><span class="line">[<span class="number">21</span>] op_profile_type   arg2</span><br><span class="line">[<span class="number">27</span>] add               loc1, arg1, arg2</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ†æè¿”å›è¯­å¥ï¼Œæ”¶é›†è¿™ä¸ªå‡½æ•°çš„è¿”å›ç±»å‹ä¿¡æ¯</span></span><br><span class="line">[<span class="number">32</span>] op_profile_type   loc1</span><br><span class="line">[<span class="number">38</span>] ret               loc1</span><br></pre></td></tr></table></figure><br>ä¸‹é¢æ˜¯è¿›å…¥ DFG æ—¶è½¬æ¢æˆ DFG IR çš„ä»£ç ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>:  SetArgument(<span class="built_in">this</span>)</span><br><span class="line"><span class="number">1</span>:  SetArgument(arg1)</span><br><span class="line"><span class="number">2</span>:  SetArgument(arg2)</span><br><span class="line"><span class="number">3</span>:  JSConstant(JS|PureInt, Undefined)</span><br><span class="line"><span class="number">4</span>:  MovHint(@<span class="number">3</span>, loc0)</span><br><span class="line"><span class="number">5</span>:  SetLocal(@<span class="number">3</span>, loc0)</span><br><span class="line"><span class="number">6</span>:  JSConstant(JS|PureInt, <span class="attr">Weak</span>:Cell: <span class="number">0x10f458ca0</span> <span class="built_in">Function</span>)</span><br><span class="line"><span class="number">7</span>:  JSConstant(JS|PureInt, <span class="attr">Weak</span>:Cell: <span class="number">0x10f443800</span> GlobalScopeObject)</span><br><span class="line"><span class="number">8</span>:  MovHint(@<span class="number">7</span>, loc0)</span><br><span class="line"><span class="number">9</span>:  SetLocal(@<span class="number">7</span>, loc0)</span><br><span class="line"><span class="number">10</span>: GetLocal(JS|MustGen|PureInt, arg1)</span><br><span class="line"><span class="number">11</span>: ProfileType(@<span class="number">10</span>)</span><br><span class="line"><span class="number">12</span>: GetLocal(JS|MustGen|PureInt, arg2)</span><br><span class="line"><span class="number">13</span>: ProfileType(@<span class="number">12</span>)</span><br><span class="line"><span class="number">14</span>: ProfileType(@<span class="number">10</span>)</span><br><span class="line"><span class="number">15</span>: ProfileType(@<span class="number">12</span>)</span><br><span class="line"><span class="number">16</span>: ValueAdd(@<span class="number">10</span>, @<span class="number">12</span>, JS|MustGen|PureInt)</span><br><span class="line"><span class="number">17</span>: MovHint(@<span class="number">16</span>, loc1)</span><br><span class="line"><span class="number">18</span>: SetLocal(@<span class="number">16</span>, loc1)</span><br><span class="line"><span class="number">19</span>: ProfileType(@<span class="number">16</span>)</span><br><span class="line"><span class="number">20</span>: Return(@<span class="number">16</span>)</span><br></pre></td></tr></table></figure><br>ç°åœ¨è¿˜æœ‰å¾ˆå¤š ProfileTypeï¼Œè¿™äº›æ“ä½œä¼šæœ‰å¾ˆå¤§çš„æ¶ˆè€—ï¼ŒDFG ä¼šæ¨æµ‹å‚æ•°ç±»å‹æ˜¯æ•´æ•°ï¼Œæ¥ä¸‹æ¥ä¼šåœ¨è¿™ä¸ªå‡è®¾ä¸‹å°† ProfileType çš„é‚£äº›æ“ä½œç§»é™¤æ‰ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>:  SetArgument(arg1)</span><br><span class="line"><span class="number">2</span>:  SetArgument(arg2)</span><br><span class="line"><span class="number">3</span>:  JSConstant(JS|PureInt, Undefined)</span><br><span class="line"><span class="number">4</span>:  MovHint(@<span class="number">3</span>, loc0)</span><br><span class="line"><span class="number">7</span>:  JSConstant(JS|PureInt, <span class="attr">Weak</span>:Cell: <span class="number">0x10f443800</span> GlobalScopeObject)</span><br><span class="line"><span class="number">8</span>:  MovHint(@<span class="number">7</span>, loc0)</span><br><span class="line"><span class="number">10</span>: GetLocal(@<span class="number">1</span>, arg1)</span><br><span class="line"><span class="number">12</span>: GetLocal(@<span class="number">2</span>, arg2)</span><br><span class="line"><span class="number">16</span>: ArithAdd(Int32:@<span class="number">10</span>, <span class="attr">Int32</span>:@<span class="number">12</span>)</span><br><span class="line"><span class="number">17</span>: MovHint(@<span class="number">16</span>, loc1)</span><br><span class="line"><span class="number">20</span>: Return(@<span class="number">16</span>)</span><br></pre></td></tr></table></figure></p>
<p>åœ¨å¯¹ç±»å‹çš„å¤„ç†ä¸Š V8 ä½¿ç”¨äº†ä¸€ä¸ªç»“åˆ C++ ä½¿ç”¨ç±»å’Œåç§»ä½ç½®æ€æƒ³çš„éšè—ç±»æ¥è§£å†³é€šè¿‡å­—ç¬¦ä¸²åŒ¹é…æ‰¾å±æ€§çš„ç®—æ³•ã€‚åšæ³•æ˜¯å°†æœ‰ç›¸åŒå±æ€§åå’Œå±æ€§å€¼çš„å¯¹è±¡ä¿å­˜åœ¨åŒä¸€ä¸ªç»„çš„éšè—ç±»é‡Œï¼Œè¿™äº›å±æ€§åœ¨éšè—ç±»é‡Œæœ‰ç€åŒæ ·çš„åç§»å€¼ï¼Œè¿™æ ·è¿™ä¸ªç»„é‡Œçš„å¯¹è±¡èƒ½å¤Ÿå…±ç”¨è¿™ä¸ªéšè—ç±»çš„ä¿¡æ¯ã€‚è®¿é—®å±æ€§çš„è¿‡ç¨‹æ˜¯å¾—åˆ°éšè—ç±»çš„åœ°å€ï¼Œæ ¹æ®å±æ€§åå¾—åˆ°åç§»å€¼ï¼Œé€šè¿‡åç§»å€¼å’Œéšè—ç±»åœ°å€å¾—åˆ°å±æ€§åœ°å€ã€‚é‚£ä¹ˆè¿™ä¸ªè¿‡ç¨‹æ˜¯å¦å¯ä»¥åŠ é€Ÿå‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œé€šè¿‡ Inline Cache ç¼“å­˜ä¹‹å‰æŸ¥æ‰¾ç»“æœæ¥å‡å°‘æ–¹æ³•å’Œå±æ€§çš„å“ˆå¸Œè¡¨æŸ¥æ‰¾æ—¶é—´ã€‚å½“ä¸€ä¸ªå¯¹è±¡æˆ–å±æ€§ç±»å‹å‡ºç°å¤šç§æ—¶ç¼“å­˜å°±ä¼šä¸æ–­æ›´æ–°ï¼ŒV8 å°±ä¼šé€€åˆ°å…ˆå‰æŒ‰ç…§å“ˆå¸Œè¡¨æŸ¥æ‰¾çš„æ–¹å¼æ¥ã€‚</p>
<h1 id="æŒ‡ä»¤é›†æ¶æ„"><a href="#æŒ‡ä»¤é›†æ¶æ„" class="headerlink" title="æŒ‡ä»¤é›†æ¶æ„"></a>æŒ‡ä»¤é›†æ¶æ„</h1><p>JavaScriptCore æ˜¯åŸºäºå¯„å­˜å™¨çš„è™šæ‹Ÿæœº register-based VMã€‚è¿™ç§å®ç°æ–¹å¼ä¸ç”¨é¢‘ç¹å…¥æ ˆï¼Œå‡ºæ ˆå’Œä¸‰åœ°å€çš„æŒ‡ä»¤é›†ï¼Œæ‰€ä»¥æ•ˆç‡é«˜ï¼Œä½†ç§»æ¤æ€§å¼±ç‚¹ã€‚</p>
<h2 id="åŸºäºå¯„å­˜å™¨æŒ‡ä»¤é›†æ¶æ„"><a href="#åŸºäºå¯„å­˜å™¨æŒ‡ä»¤é›†æ¶æ„" class="headerlink" title="åŸºäºå¯„å­˜å™¨æŒ‡ä»¤é›†æ¶æ„"></a>åŸºäºå¯„å­˜å™¨æŒ‡ä»¤é›†æ¶æ„</h2><p>ä¸‰åœ°å€å’ŒäºŒåœ°å€çš„æŒ‡ä»¤é›†ï¼ŒåŸºæœ¬éƒ½æ˜¯ä½¿ç”¨åŸºäºå¯„å­˜å™¨çš„æ¶æ„æ¥å®ç°çš„ï¼Œè¦æ±‚é™¤äº† load å’Œ store å¤–çš„è¿ç®—æŒ‡ä»¤çš„æºéƒ½è¦æ˜¯å¯„å­˜å™¨ã€‚</p>
<p>ä¸‹é¢çš„ä»£ç <br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">i = a + b;</span><br></pre></td></tr></table></figure><br>ä¸Šé¢è¿™å¥è½¬æ¢æˆæœºå™¨æŒ‡ä»¤æ ·å­<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add i, a, b</span><br></pre></td></tr></table></figure><br>è¿™æ ·çš„å½¢å¼å°±æ˜¯ä¸‰åœ°å€æŒ‡ä»¤ï¼Œå¾ˆå¤šçš„ä»£ç éƒ½æ˜¯è¿™æ ·çš„äºŒå…ƒè¿ç®—ç„¶åå†èµ‹å€¼ï¼Œä¸‰åœ°å€æ­£å¥½å¯ä»¥åˆ†é…ä¸¤åœ°å€ç»™äºŒå…ƒè¿ç®—çš„ä¸¤ä¸ªæºï¼Œå‰©ä¸‹ä¸€ä¸ªåœ°å€ç»™èµ‹å€¼ç›®æ ‡ã€‚ARM å¤„ç†å™¨çš„ä¸»è¦æŒ‡ä»¤é›†å°±æ˜¯ä¸‰åœ°å€çš„ã€‚é‚£ä¹ˆäºŒåœ°å€æ˜¯æ€ä¹ˆå¤„ç†çš„å‘¢ï¼Ÿå°†ä¸Šé¢çš„ä»£ç æ¢æˆä¸‹é¢çš„æ ·å­ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">i += a;</span><br><span class="line">i += b;</span><br></pre></td></tr></table></figure><br>æœºå™¨æŒ‡ä»¤å½¢å¼å°±å˜æˆ<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">add i, a</span><br><span class="line">add i, b</span><br></pre></td></tr></table></figure><br>è¿™æ ·ä¸€ä¸ªæºåŒæ—¶ä¹Ÿä½œä¸ºèµ‹å€¼ç›®æ ‡ï¼ŒX86 ç³»åˆ—çš„å¤„ç†å™¨å°±æ˜¯é‡‡ç”¨çš„äºŒåœ°å€ã€‚</p>
<p>æœ‰äº†äºŒåœ°å€å’Œä¸‰åœ°å€ï¼Œé‚£ä¹ˆæœ‰ä¸€åœ°å€ä¹ˆã€‚<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">add a</span><br><span class="line">add b</span><br></pre></td></tr></table></figure><br>è¿™å°±æ˜¯ä¸€åœ°å€ï¼Œåªæœ‰æ“ä½œæºï¼Œé‚£ä¹ˆç›®æ ‡å‘¢ï¼Ÿç›®æ ‡ i æ˜¯éšè—ç›®æ ‡ï¼Œè¿™ç§è¿ç®—çš„ç›®æ ‡ç§°ä¸ºç´¯åŠ å™¨çš„ä¸“ç”¨å¯„å­˜å™¨ï¼Œè¿ç®—éƒ½æ˜¯ä¾èµ–æ›´æ–°ç´¯åŠ å™¨çš„çŠ¶æ€æ¥å®Œæˆã€‚</p>
<h2 id="åŸºäºæ ˆæŒ‡ä»¤é›†æ¶æ„"><a href="#åŸºäºæ ˆæŒ‡ä»¤é›†æ¶æ„" class="headerlink" title="åŸºäºæ ˆæŒ‡ä»¤é›†æ¶æ„"></a>åŸºäºæ ˆæŒ‡ä»¤é›†æ¶æ„</h2><p>é‚£ä¹ˆé›¶åœ°å€å‘¢ï¼ŸJVM å°±æ˜¯é‡‡ç”¨çš„è¿™ç§ã€‚é‚£ä¹ˆå°±å…ˆçœ‹ä¸‹ä¸€æ®µ JAVA ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QuickCalculate</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">byte</span> <span class="title">onePlusOne</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">byte</span> x = <span class="number">1</span>;  </span><br><span class="line">        <span class="keyword">byte</span> y = <span class="number">1</span>;  </span><br><span class="line">        <span class="keyword">byte</span> z = (<span class="keyword">byte</span>) (x + y);  </span><br><span class="line">        <span class="keyword">return</span> z;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è½¬æ¢æˆå­—èŠ‚ç ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">iconst_1   // Push æ•´æ•°å¸¸é‡1</span><br><span class="line">istore_1    // Pop åˆ°å±€éƒ¨å˜é‡1ï¼Œç›¸å½“äº byte x = 1; è¿™å¥</span><br><span class="line">iconst_1   // å† Push æ•´æ•°å¸¸é‡1 </span><br><span class="line">istore_2    // Pop åˆ°å±€éƒ¨å˜é‡2ï¼Œç›¸å½“äº byte y = 1; è¿™å¥</span><br><span class="line">iload_1     // Push xï¼Œè¿™æ—¶ x å·²ç»ä½œä¸ºæ•´æ•°å­˜åœ¨å±€éƒ¨å˜é‡1é‡Œã€‚</span><br><span class="line">iload_2     // Push yï¼Œè¿™æ—¶ y å·²ç»ä½œä¸ºæ•´æ•°å­˜åœ¨å±€éƒ¨å˜é‡1é‡Œã€‚</span><br><span class="line">iadd         // æ‰§è¡ŒåŠ æ“ä½œï¼Œæ ˆé¡¶å°±å˜æˆäº† x + yï¼Œç»“æœä¸ºä¸€ä¸ªæ•´æ•°</span><br><span class="line">int2byte   // å°†æ•´æ•°è½¬åŒ–æˆå­—èŠ‚ï¼Œç»“æœè¿˜æ˜¯å 32ä½</span><br><span class="line">istore_3   // Pop åˆ°å±€éƒ¨å˜é‡3é‡Œï¼Œbyte z = (byte)(x + y)</span><br><span class="line">iload_3    // Push z çš„å€¼ä½¿ä¹‹å¯ä»¥è¢«è¿”å›</span><br><span class="line">ireturn     // è¿”å›ç»“æœï¼Œreturn z</span><br></pre></td></tr></table></figure><br>æ•´ä¸ªè¿‡ç¨‹æˆ‘æ”¾åˆ°äº†æ³¨é‡Šé‡Œã€‚å¯ä»¥çœ‹åˆ°é›¶åœ°å€å½¢å¼çš„æŒ‡ä»¤é›†å°±æ˜¯åŸºäºæ ˆæ¶æ„çš„ã€‚è¿™ç§æ¶æ„çš„ä¼˜åŠ¿æ˜¯å¯ä»¥ç”¨æ›´å°‘çš„ç©ºé—´å­˜æ›´å¤šçš„æŒ‡ä»¤ï¼Œæ‰€ä»¥ç©ºé—´ä¸æ˜¯å¾ˆå¯Œè¶³æ—¶è¿™ç§æ¶æ„æ˜¯å¯å–çš„ï¼Œä¸è¿‡é›¶åœ°å€è¦å®Œæˆä¸€ä»¶äº‹ä¼šæ¯”åŸºäºå¯„å­˜å™¨æŒ‡ä»¤æ¶æ„çš„äºŒåœ°å€ï¼Œä¸‰åœ°å€æŒ‡ä»¤è¦å¤šå¾ˆå¤šæŒ‡ä»¤ï¼Œæ‰§è¡Œæ•ˆç‡è¿˜ä¼šä½ã€‚</p>
<h2 id="æŒ‡ä»¤é›†æ¶æ„æ¼”åŒ–å’Œæ¯”è¾ƒ"><a href="#æŒ‡ä»¤é›†æ¶æ„æ¼”åŒ–å’Œæ¯”è¾ƒ" class="headerlink" title="æŒ‡ä»¤é›†æ¶æ„æ¼”åŒ–å’Œæ¯”è¾ƒ"></a>æŒ‡ä»¤é›†æ¶æ„æ¼”åŒ–å’Œæ¯”è¾ƒ</h2><p>JavaScriptCore é‡‡ç”¨ SquirrleFish ä¹‹å‰çš„è§£é‡Šå™¨ä»–ä»¬éƒ½æ˜¯æ ‘éå†å¼çš„ï¼Œè§£é‡Šå™¨ä¼šé€’å½’éå†æ ‘ï¼Œåœ¨éå†æ ‘ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹çš„æ“ä½œéƒ½æ˜¯æ ¹æ®è§£é‡Šå…¶æ¯ä¸ªå­—èŠ‚ç‚¹è¿”å›çš„å€¼æ¥çš„ã€‚è¿™ç§æ“ä½œå³ä¸æ˜¯åŸºäºæ ˆä¹Ÿä¸æ˜¯åŸºäºå¯„å­˜å™¨ã€‚ä¸¾ä¸ªä¾‹å­<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">i = x + y * z</span><br></pre></td></tr></table></figure><br>æŒ‰ AST çš„ååºéå†ï¼Œæœ€ä¸Šé¢çš„ = ç¬¦å·ä¾èµ–å­èŠ‚ç‚¹ + ç¬¦å·èŠ‚ç‚¹è¿”å›çš„å€¼ï¼Œ+ ç¬¦å·ä¾èµ– x èŠ‚ç‚¹å’Œ <em> ç¬¦å·èŠ‚ç‚¹çš„å€¼ï¼Œä¾æ­¤é€’å½’ä¸‹å»ï¼Œè¿™æ ·æœ€å¼€å§‹è·å–åˆ°å€¼çš„å°±æ˜¯æœ€ä½ä¸€çº§çš„è¿ç®—ï¼Œåœ¨è¿™ä¸ªä¾‹å­é‡Œå°±æ˜¯ y å’Œ z çš„è¿ç®—çš„ç»“æœè¿”å›ç»™ </em> ç¬¦å·èŠ‚ç‚¹ã€‚è¿™ç§å°±æ˜¯å…¸å‹çš„ååºéå†ã€‚CRuby 1.9 ä¹‹å‰ä¹Ÿæ˜¯ç”¨çš„è¿™ç§æ–¹å¼è§£é‡Šæ‰§è¡Œçš„ã€‚</p>
<p>èµ‹å€¼ç¬¦å· = ç¬¦å·çš„å·¦ä¾§å«åšå·¦å€¼ï¼Œå³ä¾§çš„å€¼å«åšå³å€¼ã€‚å·¦å€¼ä¹Ÿå¯èƒ½æ˜¯å¤æ‚çš„è¡¨è¾¾å¼ï¼Œæ¯”å¦‚æ•°ç»„æˆ–è€…ç»“æ„ä½“ã€‚æ ¹æ®æ±‚å€¼é¡ºåºï¼Œå¯¹äºäºŒå…ƒè¿ç®—çš„èŠ‚ç‚¹ï¼Œæ˜¯å…ˆéå†å·¦å­èŠ‚ç‚¹çš„ã€‚æ‰€ä»¥å½“å·¦å€¼æ˜¯å¤æ‚è¡¨è¾¾å¼éœ€è¦è®¡ç®—æ—¶æ˜¯ä¼šä¼˜å…ˆè¿›è¡Œè®¡ç®—çš„ã€‚å†çœ‹ä¸ªå·¦å€¼æ˜¯æ•°ç»„çš„ä¾‹å­ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LeftFirstTest</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">int</span>[] arr = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">1</span>];  </span><br><span class="line">        <span class="keyword">int</span> x = <span class="number">3</span>;  </span><br><span class="line">        <span class="keyword">int</span> y = <span class="number">5</span>;  </span><br><span class="line">        arr[<span class="number">0</span>] = x + y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>arr[0] = x + y; å¯¹åº”çš„å­—èŠ‚ç ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// å·¦å€¼ï¼Œæ•°ç»„ä¸‹æ ‡</span><br><span class="line">aload_1  </span><br><span class="line">iconst_0  </span><br><span class="line">  </span><br><span class="line">// å³å€¼</span><br><span class="line">iload_2 // x</span><br><span class="line">iload_3 // y</span><br><span class="line">iadd</span><br><span class="line"> </span><br><span class="line">iastore  // èµ‹å€¼ç¬¦å·èŠ‚ç‚¹è¿›è¡Œèµ‹å€¼</span><br></pre></td></tr></table></figure><br>å¯ä»¥çœ‹åˆ°å·¦å€¼æ˜¯å…ˆè®¡ç®—çš„ã€‚</p>
<p>ä»æ ‘éå†åˆ°åŸºäºæ ˆçš„è§£é‡Šï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ªå°† AST æ ‘æ‰“å¹³çš„è¿‡ç¨‹ã€‚æ–¹æ³•æ˜¯ååºéå† AST æ—¶ä½¿ç”¨ <a href="https://en.wikipedia.org/wiki/Reverse_Polish_notation">Reverse Polish Notation</a> è¿™ç§åç¼€è®°æ³•ç”Ÿæˆä¸€ä¸ªåºåˆ—ï¼Œæˆä¸ºä¸€ä¸ªçº¿æ€§ç»“æ„ï¼Œåé¢å†è§£é‡Šæ‰§è¡Œè¿™ä¸ªæ“ä½œåºåˆ—ã€‚</p>
<p>JVM æ˜¯ Java è¯­è¨€çš„è™šæœºã€‚Android ä¹Ÿæ˜¯ç”¨çš„ Java è¯­è¨€ï¼Œé‚£ä¹ˆå®ƒçš„è™šæœºä¹Ÿæ˜¯ JVM å—ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ï¼ŒAndroid ä½¿ç”¨çš„è™šæœºå« <a href="https://en.wikipedia.org/wiki/Dalvik_(software">Dalvik VM</a>)ï¼Œè¿™æ¬¾è™šæœºåœ¨å¾ˆå¤šè®¾è®¡ä¸Šéƒ½ä¸ JVM å…¼å®¹ï¼Œå­—èŠ‚ç æ˜¯äºŒåœ°å€å’Œä¸‰åœ°å€å¹¶ç”¨çš„æ–¹å¼ï¼Œæ˜¯åŸºäºå¯„å­˜å™¨çš„æ¶æ„ã€‚Dalvik VM ç”¨åœ¨ç§»åŠ¨ç«¯ä¸ºäº†èƒ½å¤Ÿæ›´åŠ é«˜æ•ˆï¼Œå¼€å§‹å°±æ²¡æœ‰é¡¾åŠå¤ªå¤šå¯ç§»æ¤æ€§ï¼Œè¿™æ ·åŸºäºå¯„å­˜å™¨æ¶æ„çš„ä¼˜åŠ¿å°±èƒ½å¤Ÿæ›´å¥½çš„å‘æŒ¥å‡ºæ¥äº†ã€‚æƒ³æ›´å¤šäº†è§£ Dalvik VM å¯ä»¥é€šè¿‡ <a href="http://www.milk.com/home/danfuzz/">Dan Bornstein</a> åšçš„ä¸€ä¸ª Dalvik çš„å®ç°åŸç†çš„æ¼”è®² <a href="https://sites.google.com/site/io/dalvik-vm-internals">Dalvik VM Internals</a>ã€‚</p>
<p>JVM å’Œ Dalvik VM çš„ä¸»è¦åŒºåˆ«æ˜¯åè€…å­—èŠ‚ç æŒ‡ä»¤æ•°é‡å’Œå†…å­˜æ›´å°‘ã€‚JVM æ¯ä¸ªçº¿ç¨‹æœ‰ä¸€ä¸ª Java æ ˆç”¨æ¥è®°å½•æ–¹æ³•è°ƒç”¨çš„ activation recordï¼Œæ¯è°ƒç”¨ä¸€ä¸ªæ–¹æ³•å°±ä¼šåˆ†é…ä¸€ä¸ªæ–°æ ˆå¸§ï¼Œæ–¹æ³•è¿”å›å°± Pop å‡ºæ ˆå¸§ã€‚æ¯ä¸ªæ ˆå¸§ä¼šæœ‰å±€éƒ¨å˜é‡åŒºï¼Œistore è¿™æ ·çš„æŒ‡ä»¤ç”¨æ¥ç§»åŠ¨å±€éƒ¨å˜é‡å’Œå‚æ•°åˆ°å±€éƒ¨å˜é‡åŒºã€‚æ¯ä¸ªæ ˆå¸§è¿˜ä¼šæœ‰æ±‚å€¼æ ˆï¼Œè¿™ä¸ªæ ˆç”¨æ¥å­˜å‚¨æ±‚å€¼çš„ä¸­é—´ç»“æœå’Œè°ƒç”¨å…¶ä»–æ–¹æ³•çš„å‚æ•°ç­‰ï¼Œä½¿ç”¨ iconst è¿™æ ·çš„æŒ‡ä»¤æ¥è¿›è¡Œæ•°æ®çš„ç§»åŠ¨ï¼Œè¿˜å¯ä»¥é€šè¿‡ iaddï¼Œimul è¿™æ ·çš„æŒ‡ä»¤åœ¨æ±‚å€¼æ ˆä¸­ Pop å‡ºå€¼è¿›è¡Œæ±‚å€¼ï¼Œç„¶åå†æŠŠç»“æœ Push åˆ°æ ˆé‡Œã€‚</p>
<p>Dalvik VM çš„æ¯ä¸ªçº¿ç¨‹æœ‰ç¨‹åºè®¡æ•°å™¨å’Œè°ƒç”¨æ ˆï¼Œæ–¹æ³•çš„è°ƒç”¨å’Œ JVM ä¸€æ ·æ˜¯ä¼šåˆ†é…ä¸€ä¸ªæ–°çš„å¸§ï¼Œä¸åŒçš„æ˜¯ Dalvik VM ä½¿ç”¨çš„æ˜¯è™šæ‹Ÿå¯„å­˜å™¨æ¥æ›¿ä»£ JVM é‡Œçš„å±€éƒ¨å˜é‡åŒºå’Œæ±‚å€¼æ ˆã€‚æ–¹æ³•è°ƒç”¨ä¼šæœ‰ä¸€ç»„è‡ªå·±çš„è™šæ‹Ÿå¯„å­˜å™¨ï¼Œå¸¸ç”¨çš„æ˜¯ v0 - v15ï¼Œæœ‰äº›æŒ‡ä»¤å¯ä»¥ä½¿ç”¨ v0 - v255ã€‚åªåœ¨è™šæ‹Ÿå¯„å­˜å™¨ä¸­è¿›è¡ŒæŒ‡ä»¤æ“ä½œï¼Œæ•°æ®ç§»åŠ¨å°‘å¤šäº†ï¼Œä¿å­˜å±€éƒ¨å˜é‡çš„å­˜å‚¨å•å…ƒä¹Ÿä¼šå°‘å¾ˆå¤šã€‚Dalvik VM çš„å¯„å­˜å™¨æ¯æ¬¡æ–¹æ³•è°ƒç”¨ä¼šä¸€ç»„è‡ªå·±çš„ï¼Œä¸è¿‡åœ¨ X86 æ¶æ„ä¸­å¯„å­˜å™¨æ˜¯å…¨å±€çš„ï¼Œè¿™æ · X86 éœ€è¦è€ƒè™‘ calling converntionï¼Œå°±æ˜¯éœ€è¦ä¿æŠ¤ä¸€äº›å¯„å­˜å™¨çš„çŠ¶æ€ï¼Œåœ¨è°ƒç”¨æ—¶éœ€è¦å¤„ç†è¿™äº›ï¼Œè€Œ Dalvik VM è°ƒç”¨å®Œæ–¹æ³•åï¼Œé‚£äº›å¯„å­˜å™¨å€¼ä¼šæ¢å¤æˆè°ƒç”¨å‰çš„å¯ä»¥å¾ˆå¥½çš„é¿å…è¿™æ ·çš„é—®é¢˜ã€‚</p>
<p>V8 æ²¡æœ‰ä¸­é—´çš„å­—èŠ‚ç ï¼Œè€Œæ˜¯ç›´æ¥ç¼–è¯‘ JavaScript ç”Ÿæˆæœºå™¨ç ã€‚ä¸è¿‡åœ¨å†…éƒ¨ä¹Ÿç”¨äº†è¡¨è¾¾å¼æ ˆæ¥ç®€åŒ–ä»£ç ç”Ÿæˆï¼Œåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ä½¿ç”¨è™šæ‹Ÿæ ˆå¸§æ¥è®°å½•å±€éƒ¨å˜é‡å’Œæ ˆçš„çŠ¶æ€ã€‚ç”Ÿæˆä»£ç çš„è¿‡ç¨‹ä¸­ä¼šæœ‰çª¥å­”ä¼˜åŒ–ç”¨æ¥å»é™¤å¤šä½™çš„å…¥æ ˆå’Œå‡ºæ ˆï¼ŒæŠŠæ ˆæ“ä½œè½¬æˆå¯„å­˜å™¨æ“ä½œï¼Œç”Ÿæˆçš„ä»£ç çœ‹èµ·æ¥å°±å’ŒåŸºäºå¯„å­˜å™¨çš„ä»£ç ç±»ä¼¼äº†ã€‚</p>
<p>è¿™å°±æœ‰ä¸ªç–‘é—®äº†ï¼Œé›¶åœ°å€è¦åšå¤šæ¬¡å…¥æ ˆå’Œå‡ºæ ˆæ“ä½œï¼Œæ‰§è¡Œæ•ˆç‡ä½ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¿˜ä¼šæœ‰è™šæ‹Ÿæœºæ¯”å¦‚ JVM å­—èŠ‚ç è¿˜è¦ç”¨é›¶åœ°å€å½¢å¼å‘¢ï¼Ÿ</p>
<p>åƒ X86 åˆšå¼€å§‹æ—¶çš„å¯„å­˜å™¨å¾ˆå¤šä¸æ˜¯é€šç”¨å¯„å­˜å™¨ï¼Œç”±äºè®©ç¼–è¯‘å™¨å»å†³å®šç¨‹åºé‡Œé‚£ä¹ˆå¤šçš„å˜é‡è¯¥æ€ä¹ˆè£…åˆ°å¯„å­˜å™¨é‡Œï¼Œé‚£äº›åº”è¯¥åº”è¯¥æ˜ å°„åˆ°ä¸€ä¸ªå¯„å­˜å™¨ï¼Œå“ªäº›åº”è¯¥æ¢å‡ºï¼Œè¿™å¹¶ä¸å®¹æ˜“ï¼ŒJVM é‡‡ç”¨é›¶æŒ‡ä»¤è¿™ç§å †æ ˆç»“æ„çš„åŸå› å°±æ˜¯ä¸ä¿¡ä»»ç¼–è¯‘å™¨çš„å¯„å­˜å™¨åˆ†é…ï¼Œæ‰€ä»¥ä½¿ç”¨å †æ ˆç»“æ„ï¼Œè¿™æ ·å°±å¯ä»¥é¿å¼€å¯„å­˜å™¨åˆ†é…è¿™æ ·çš„éš¾é¢˜ã€‚ä¸è¿‡åæ¥ IBM å…¬å¼€äº†ä»–ä»¬çš„å›¾æŸ“è‰²å¯„å­˜å™¨åˆ†é…ç®—æ³•ï¼Œè¿™æ ·ç¼–è¯‘å™¨çš„åˆ†é…èƒ½åŠ›å¾—åˆ°äº†å¾ˆå¤§çš„è¿›æ­¥ï¼Œæ‰€ä»¥ç°åœ¨éƒ½æ˜¯ç¼–è¯‘å™¨æ¥ä¸»å¯¼å¯„å­˜å™¨åˆ†é…ã€‚</p>
<p>å¾ˆå¤šä¸»æµé«˜çº§è¯­è¨€è™šæ‹Ÿæœºï¼ˆhigh-level language virtual machineï¼Œç®€ç§° HLL VMï¼‰æ¯”å¦‚ JVMï¼ŒCPython éƒ½é‡‡ç”¨çš„åŸºäºæ ˆçš„æ¶æ„ã€‚è¿™æ ·åšä¸»è¦æ˜¯å› ä¸ºä¸ç”¨è€ƒè™‘ä¸´æ—¶å˜é‡åˆ†é…ç©ºé—´ï¼Œåªéœ€è¦æ±‚å€¼æ ˆæ¥åšï¼Œè¿™æ ·çš„ç¼–è¯‘å™¨æ›´å®¹æ˜“å®ç°ã€‚è¿˜æœ‰å°±æ˜¯å¯ä»¥æ›´å®¹æ˜“åœ¨ç¡¬ä»¶è¾ƒå·®çš„æœºå™¨ä¸Šè¿è¡Œï¼Œå‰é¢ä¹Ÿè®²åˆ°åŸºäºæ ˆè¿™ç§æ¶æ„æŒ‡ä»¤å¯¹äºå­˜å‚¨ç©ºé—´çš„è¦æ±‚æ›´å°‘ã€‚æœ€åå°±æ˜¯è€ƒè™‘ç§»æ¤ï¼Œå¤æ‚æŒ‡ä»¤è®¡ç®—æœºï¼ˆComplex Instruction Set Computerï¼Œç®€ç§° CISCï¼‰çš„é€šç”¨å¯„å­˜å™¨æ¯”è¾ƒå°‘ï¼Œ32ä½åªæœ‰8ä¸ª32ä½é€šç”¨å¯„å­˜å™¨ã€‚ç²¾ç®€æŒ‡ä»¤é›†è®¡ç®—æœºï¼ˆReduced Instruction Set Computerï¼Œç®€ç§° RISCï¼‰é€šç”¨å¯„å­˜å™¨æ•°é‡ä¼šå¤šäº›ï¼Œ32ä½æœ‰16ä¸ªå¯„å­˜å™¨ã€‚æºæ¶æ„å¯„å­˜å™¨æ•°é‡é€šå¸¸å’Œå®é™…æœºå™¨é€šç”¨å¯„å­˜å™¨æ•°é‡ä¸ä¸€è‡´è€Œå®ç°æ˜ å°„éº»çƒ¦ï¼ŒåŸºäºæ ˆæ¶æ„é‡Œæ˜¯æ²¡æœ‰é€šç”¨å¯„å­˜å™¨çš„ï¼Œå®ç°è™šæœºæ—¶å¯ä»¥å°±å¯ä»¥å¾ˆå®¹æ˜“è‡ªç”±çš„åˆ†é…å®é™…æœºå™¨å¯„å­˜å™¨ï¼Œç§»æ¤èµ·æ¥è‡ªç„¶ä¹Ÿå°±å®¹æ˜“å¤šäº†ã€‚</p>
<p>å¤„ç†å™¨æ¥è¯´å¤šæ˜¯åŸºäºå¯„å­˜å™¨æ¶æ„çš„ï¼Œä½†æ˜¯å¯¹äºè™šæœºæ¥è¯´ï¼Œç”±äºåŸºäºæ ˆæ¶æ„éœ€è¦æ‰§è¡Œæ›´å¤šçš„ load æˆ– store è¿™æ ·çš„æŒ‡ä»¤ï¼Œè¿™æ · Instruction dispatch çš„æ¬¡æ•°å’Œå†…å­˜è®¿é—®çš„æ¬¡æ•°ä¼šæ›´å¤šï¼Œæ‰€ä»¥åŸºäºå¯„å­˜å™¨çš„æ¶æ„åœ¨è™šæœºé‡ŒåŒæ ·ä¹Ÿæ›´ä¼˜äº›ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå¯¹äºé—­ç¯çš„è‹¹æœæ¥è¯´ä¼šåœ¨ JavaScriptCore çš„è™šæœºé‡Œé‡‡ç”¨æ€§èƒ½æ›´å¥½çš„åŸºäºå¯„å­˜å™¨çš„æ¶æ„ï¼Œè€Œä¸å»é¡¾åŠç§»æ¤æ€§ã€‚</p>
<h1 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h1><h2 id="å„å¤§å¼•æ“çš„ä»‹ç»"><a href="#å„å¤§å¼•æ“çš„ä»‹ç»" class="headerlink" title="å„å¤§å¼•æ“çš„ä»‹ç»"></a>å„å¤§å¼•æ“çš„ä»‹ç»</h2><p>å„ä¸ª JavaScript å¼•æ“ä»‹ç»ï¼š</p>
<ul>
<li><p>SpiderMonkeyï¼šç”¨äº Mozilla Firefoxï¼Œæ˜¯æœ€æ—©çš„ JavaScript å¼•æ“ï¼ŒåŸºäºæ ˆçš„å­—èŠ‚ç ã€‚Parser ä½¿ç”¨çš„æ‰‹å†™çº¯é€’å½’ä¸‹é™å¼ã€‚</p>
</li>
<li><p>KJSï¼šKDE çš„å¼•æ“ï¼Œç”¨äº Konqueror æµè§ˆå™¨ã€‚æ ‘éå†è§£é‡Šå™¨ã€‚Parser ä½¿ç”¨çš„æ˜¯ bisonã€‚</p>
</li>
<li><p>Rhinoï¼šä½¿ç”¨ Javaç¼–å†™ï¼Œå¼€å‘æºç ï¼Œä¹Ÿæ˜¯ Mozilla çš„ï¼Œç›¸å½“äº Java ç‰ˆçš„ SpiderMonkeyï¼Œå½“æ—¶çš„æƒ³æ³•æ˜¯æƒ³æŠŠ JavaScript åšæˆæœåŠ¡ç«¯çš„è„šæœ¬è¯­è¨€æ¥ç”¨ã€‚Parser æ˜¯æ‰‹å†™çš„çº¯é€’å½’ä¸‹é™å¼ <a href="https://github.com/mozilla/rhino/blob/master/src/org/mozilla/javascript/Parser.java">rhino/src/org/mozilla/javascript/Parser.java</a> ã€‚</p>
</li>
<li><p>Chakraï¼šä¹Ÿå« JScript å¾®è½¯çš„ Internet Explorer å’Œ Microsoft Edge åœ¨ä½¿ç”¨ã€‚</p>
</li>
<li><p>JavaScriptCoreï¼šè‹¹æœå¼€å‘çš„å¼€æº JavaScript å¼•æ“ï¼Œç”¨åœ¨ Safari ç­‰æµè§ˆå™¨ä¸­ã€‚Safari æ˜¯å¸¦æœ‰ JIT çš„ JavaScriptCore çš„ï¼Œè€Œ UIWebView æ˜¯æ²¡æœ‰çš„ã€‚</p>
</li>
<li><p>V8ï¼šGoogle å¼€å‘çš„å¼€æºå¼•æ“ï¼Œç”¨äº Chromeã€‚Parser ä½¿ç”¨çš„æ˜¯æ‰‹å†™çº¯é€’å½’ä¸‹é™åŠ è¿ç®—ç¬¦ä¼˜å…ˆçº§æ··åˆå¼ã€‚V8 ä½¿ç”¨äº† <a href="http://ariya.ofilabs.com/2012/07/lazy-parsing-in-javascript-engines.html">2-pass</a>ï¼Œä¼šå…ˆæ”¶é›†ä¸€äº›ä¸Šä¸‹æ–‡ä¿¡æ¯å¢åŠ é¢„æµ‹çš„å‡†ç¡®æ€§ã€‚V8 å¼€å§‹æ—¶æ˜¯ä¸ç”¨å­—èŠ‚ç ä¼šç›´æ¥ç¼–è¯‘æˆæœºå™¨ç ï¼ŒDart VM ä¹Ÿæ˜¯è¿™æ ·è®¾è®¡çš„ï¼Œä»–ä»¬ä¸€ä¸ªé—®é¢˜çš„å›ç­” <a href="https://www.dartlang.org/faq#q-why-didnt-google-build-a-bytecode-vm-targetable-by-multiple-languages-including-dart">Why didnâ€™t Google build a bytecode VM targetable by multiple languages including Dart?</a> åŒæ ·é€‚ç”¨äº V8ã€‚ä¸è¿‡ V8 5.9 å¯ç”¨äº† <a href="https://v8project.blogspot.co.id/2017/04/v8-release-59.html">Ignition</a> å­—èŠ‚ç è§£é‡Šå™¨ï¼Œè‡ªæ­¤å‡ å¤§ JS å¼•æ“éƒ½ç”¨äº†å­—èŠ‚ç ã€‚å¯ç”¨å­—èŠ‚ç çš„è€ƒè™‘ä¸»è¦æ˜¯å¸Œæœ›èƒ½å¤Ÿå‡å°‘æœºå™¨ç å¯¹å†…å­˜ç©ºé—´çš„å ç”¨ã€‚ç”±äºæœºå™¨ç å ç”¨çš„ç©ºé—´ä¹Ÿå¾ˆå¤§ï¼Œæ‰€ä»¥ä¸å¥½éƒ½ç¼“å­˜ä¸‹æ¥ï¼Œä¸ç„¶å†…å­˜å’Œç£ç›˜éƒ½åƒä¸æ¶ˆï¼Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–æ—¶é—´éƒ½å¤ªé•¿ï¼Œè¿™æ ·æ¯æ¬¡ç¼–è¯‘çš„æœºå™¨ç éƒ½ä¸æ˜¯å®Œæ•´çš„åªä¼šç¼“å­˜æœ€å¤–çš„ä¸€å±‚ï¼Œå¦‚æœä»£ç æœ€å¤–å±‚åŒ…äº†ä¸€å±‚ï¼Œå¯åŠ¨ä»£ç æ¯æ¬¡éƒ½æ˜¯ä¸åŒçš„è°ƒç”¨å°±ä¼šæ¯æ¬¡éƒ½ç¼–è¯‘ï¼Œä¼šå¯¼è‡´ç¼“å­˜æ²¡æœ‰ä½œç”¨ã€‚ç”±äºå­—èŠ‚ç é€šè¿‡æ¯”è¾ƒå¥½çš„è®¾è®¡åèƒ½å¤Ÿåšåˆ°æ¯”æœºå™¨ç ç´§å‡‘ï¼Œè¿™æ ·å¼•å…¥ Ignition åå†…å­˜æ˜æ˜¾çš„ä¸‹é™äº†ã€‚TurboFan å†å¯¹ Ignition å­—èŠ‚ç æ¥è¿›è¡Œè§£é‡Šã€‚</p>
</li>
</ul>
<h2 id="å„ä¸ªå¼•æ“ä¹‹é—´é€šç”¨æŠ€æœ¯"><a href="#å„ä¸ªå¼•æ“ä¹‹é—´é€šç”¨æŠ€æœ¯" class="headerlink" title="å„ä¸ªå¼•æ“ä¹‹é—´é€šç”¨æŠ€æœ¯"></a>å„ä¸ªå¼•æ“ä¹‹é—´é€šç”¨æŠ€æœ¯</h2><p>æ ¹æ®ä¸‹é¢å…³é”®å­å»æŸ¥æ‰¾ï¼Œå¯ä»¥äº†è§£æ›´å¤šçš„ç›¸å…³çš„è™šæœºæŠ€æœ¯ã€‚</p>
<h3 id="æºç åˆ°ä¸­é—´ä»£ç "><a href="#æºç åˆ°ä¸­é—´ä»£ç " class="headerlink" title="æºç åˆ°ä¸­é—´ä»£ç "></a>æºç åˆ°ä¸­é—´ä»£ç </h3><ul>
<li>Recusive-descent parserï¼šé€’å½’ä¸‹é™å¼ parser</li>
<li>Operator precedence parserï¼šè¿ç®—ç¬¦ä¼˜å…ˆçº§ parser</li>
<li>Deferred parserï¼šå»¶è¿Ÿ parser</li>
</ul>
<h3 id="ä¸­é—´ä»£ç åˆ°ç›®æ ‡ä»£ç "><a href="#ä¸­é—´ä»£ç åˆ°ç›®æ ‡ä»£ç " class="headerlink" title="ä¸­é—´ä»£ç åˆ°ç›®æ ‡ä»£ç "></a>ä¸­é—´ä»£ç åˆ°ç›®æ ‡ä»£ç </h3><ul>
<li>Tiered compilationï¼šå¤šå±‚ç¼–è¯‘</li>
<li>Background compilationï¼šåå°ç¼–è¯‘</li>
<li>Type feedbackï¼šç±»å‹åé¦ˆ</li>
<li>Type specializationï¼šç±»å‹ç‰¹åŒ–</li>
<li>SSA-form IRï¼šé™æ€å•èµ‹å€¼å½¢å¼</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;æœ€è¿‘å¼€å§‹æ¶‰åŠ JS çš„è§£æå’Œå¤„ç†å·¥ä½œï¼Œæ‰€ä»¥ä¸“é—¨ç ”ç©¶äº†ä¸‹è¿™å—ã€‚ç‰¹åˆ«æ˜¯åŠ¨æ€ç±»å‹çš„å¤„ç†ä»¥åŠä¸åŒå¼•æ“å¯¹äºå¹³å°æ— å…³çš„å­—èŠ‚ç çš„è®¾è®¡å’Œå¤„ç†ä¼šæœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚
    
    </summary>
    
      <category term="Programming" scheme="http://ming1016.github.io/categories/Programming/"/>
    
    
      <category term="Web" scheme="http://ming1016.github.io/tags/Web/"/>
    
      <category term="ç¼–è¯‘" scheme="http://ming1016.github.io/tags/%E7%BC%96%E8%AF%91/"/>
    
      <category term="JavaScript" scheme="http://ming1016.github.io/tags/JavaScript/"/>
    
  </entry>
  
</feed>
