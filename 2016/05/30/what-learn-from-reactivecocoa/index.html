<!DOCTYPE html>
<html lang="zh-Hans">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="前滴滴出行技术专家。极客时间《iOS开发高手课》和纸书《跟戴铭学iOS编程》作者。个人博客：戴铭的博客。微信公共号：starming-weixin。微博：@戴铭">
    <meta name="author" content="戴铭">
    
    <title>
        
            从 ReactiveCocoa 中能学到什么？不用此库也能学以致用 |
        
        戴铭的博客
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/img/logo-starming.png">
    
<link rel="stylesheet" href="/css/font-awesome.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"ming1016.github.io","root":"/","language":"zh-Hans"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":true,"init_open":true},"style":{"primary_color":"#0066CC","avatar":"/img/ming.jpeg","favicon":"/img/logo-starming.png","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":false,"scale":false},"first_screen":{"enable":true,"background_img":null,"description":"混乱中的有序"},"scroll":{"progress_bar":{"enable":false},"percent":{"enable":false}}},"local_search":{"enable":false,"preload":false},"code_copy":{"enable":false,"style":"default"},"pjax":{"enable":false},"lazyload":{"enable":false},"version":"3.4.5"};
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>
<meta name="generator" content="Hexo 5.4.2"></head>


<body>
<div class="progress-bar-container">
    

    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                戴铭的博客
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                HOME
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                ARCHIVES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                CATEGORIES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                ABOUT
                            </a>
                        </li>
                    
                    
                </ul>
            </div>
            <div class="mobile">
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">HOME</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">ARCHIVES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">CATEGORIES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">ABOUT</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">从 ReactiveCocoa 中能学到什么？不用此库也能学以致用</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/img/ming.jpeg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">戴铭</span>
                        
                            <span class="author-label">Lv4</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2016-05-30 21:32:02</span>
        <span class="mobile">2016-05-30 21:32</span>
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/Programming/">Programming</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/iOS/">iOS</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/ReactiveCocoa/">ReactiveCocoa</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>2k Words</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fas fa-clock"></i>&nbsp;<span>8 Mins</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <p>从知道ReactiveCocoa开始就发现对这个库有不同的声音，上次参加<T>技术沙龙时唐巧对在项目中已全面使用FRP的代码家提出为什么这种编程模型出现了这么长时间怎么像ReactiveCocoa这种完全按FRP编写的库没能够流行起来这个问题。对这个问题的回答一般都是门槛高，解决方法就是培训和通过熟悉以前的代码来快速入门。其实在我学习的过程中也发现确实会有这个问题，不过就算是有这样那样问题使得ReactiveCocoa这样的库没法大面积使用起来，也不能错失学习这种编程思想的机会。</p>
<p>如果不用这样的库，能不能将这种库的编程思想融入项目中，发挥出其优势呢？答案是肯定的。</p>
<p>FRP全称Function Reactive Programming，从名称就能够看出来这个模型关键就是Function Programming和Reactive Programming的结合。那么就先从函数式编程说起。说函数式编程前先聊聊链式编程，先看看一个开源Alert控件的头文件里定义的接口方法的写法。</p>
<pre class="line-numbers language-objectivec" data-language="objectivec"><code class="language-objectivec"><span class="token comment">/*
 *  自定义样式的alertView
 *
 */</span>
<span class="token operator">+</span> <span class="token punctuation">(</span>instancetype<span class="token punctuation">)</span>showAlertWithTitle<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>title
                           message<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>message
                        completion<span class="token punctuation">:</span><span class="token punctuation">(</span>PXAlertViewCompletionBlock<span class="token punctuation">)</span>completion
                       cancelTitle<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>cancelTitle
                       otherTitles<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>otherTitles<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> NS_REQUIRES_NIL_TERMINATION<span class="token punctuation">;</span>

<span class="token comment">/*
 * @param otherTitles Must be a NSArray containing type NSString, or set to nil for no otherTitles.
 */</span>
<span class="token operator">+</span> <span class="token punctuation">(</span>instancetype<span class="token punctuation">)</span>showAlertWithTitle<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>title
                       contentView<span class="token punctuation">:</span><span class="token punctuation">(</span>UIView <span class="token operator">*</span><span class="token punctuation">)</span>view
                       secondTitle<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>secondTitle
                           message<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>message
                       cancelTitle<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>cancelTitle
                       otherTitles<span class="token punctuation">:</span><span class="token punctuation">(</span>NSArray <span class="token operator">*</span><span class="token punctuation">)</span>otherTitles
                          btnStyle<span class="token punctuation">:</span><span class="token punctuation">(</span>BOOL<span class="token punctuation">)</span>btnStyle
                        completion<span class="token punctuation">:</span><span class="token punctuation">(</span>PXAlertViewCompletionBlock<span class="token punctuation">)</span>completion<span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>库里还有更多这样的组合，这么写是没有什么问题，无非是为了更方便组合使用而啰嗦了点，但是如果现在要添加一个AttributeString，那么所有组合接口都需要修改，每次调用接口方法如果不需要用Attribuite的地方还要去设置nil，这样会很不易于扩展。下面举个上报日志接口的例子。</p>
<pre class="line-numbers language-objectivec" data-language="objectivec"><code class="language-objectivec"><span class="token keyword">@interface</span> SMLogger <span class="token punctuation">:</span> NSObject
<span class="token comment">//初始化</span>
<span class="token operator">+</span> <span class="token punctuation">(</span>SMLogger <span class="token operator">*</span><span class="token punctuation">)</span>create<span class="token punctuation">;</span>
<span class="token comment">//可选设置</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>SMLogger <span class="token operator">*</span><span class="token punctuation">)</span>object<span class="token punctuation">:</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>obj<span class="token punctuation">;</span>                        <span class="token comment">//object对象记录</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>SMLogger <span class="token operator">*</span><span class="token punctuation">)</span>message<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>msg<span class="token punctuation">;</span>               <span class="token comment">//描述</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>SMLogger <span class="token operator">*</span><span class="token punctuation">)</span>classify<span class="token punctuation">:</span><span class="token punctuation">(</span>SMProjectClassify<span class="token punctuation">)</span>classify<span class="token punctuation">;</span>  <span class="token comment">//分类</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>SMLogger <span class="token operator">*</span><span class="token punctuation">)</span>level<span class="token punctuation">:</span><span class="token punctuation">(</span>SMLoggerLevel<span class="token punctuation">)</span>level<span class="token punctuation">;</span>            <span class="token comment">//级别</span>

<span class="token comment">//最后需要执行这个方法进行保存，什么都不设置也会记录文件名，函数名，行数等信息</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>save<span class="token punctuation">;</span>

<span class="token keyword">@end</span>

<span class="token comment">//宏</span>
FOUNDATION_EXPORT <span class="token keyword">void</span> <span class="token function">SMLoggerDebugFunc</span><span class="token punctuation">(</span>DCProjectClassify classify<span class="token punctuation">,</span> DCLoggerLevel level<span class="token punctuation">,</span> NSString <span class="token operator">*</span>format<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token function">NS_FORMAT_FUNCTION</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//debug方式打印日志，不会上报</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">SMLoggerDebug</span><span class="token expression"><span class="token punctuation">(</span>frmt<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> </span><span class="token punctuation">\</span>
<span class="token expression"><span class="token keyword">do</span> <span class="token punctuation">&#123;</span> <span class="token function">SMLoggerDebugFunc</span><span class="token punctuation">(</span>SMProjectClassifyNormal<span class="token punctuation">,</span>DCLoggerLevelDebug<span class="token punctuation">,</span>frmt<span class="token punctuation">,</span> </span><span class="token punctuation">##</span><span class="token expression">__VA_ARGS__<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span></span>
<span class="token comment">//简单的上报日志</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">SMLoggerSimple</span><span class="token expression"><span class="token punctuation">(</span>frmt<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> </span><span class="token punctuation">\</span>
<span class="token expression"><span class="token keyword">do</span> <span class="token punctuation">&#123;</span> <span class="token function">SMLoggerDebugFunc</span><span class="token punctuation">(</span>SMProjectClassifyNormal<span class="token punctuation">,</span>SMLoggerLevelDebug<span class="token punctuation">,</span>frmt<span class="token punctuation">,</span> </span><span class="token punctuation">##</span><span class="token expression">__VA_ARGS__<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span></span>
<span class="token comment">//自定义classify和level的日志，可上报</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">SMLoggerCustom</span><span class="token expression"><span class="token punctuation">(</span>classify<span class="token punctuation">,</span>level<span class="token punctuation">,</span>frmt<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> </span><span class="token punctuation">\</span>
<span class="token expression"><span class="token keyword">do</span> <span class="token punctuation">&#123;</span> <span class="token function">SMLoggerDebugFunc</span><span class="token punctuation">(</span>classify<span class="token punctuation">,</span>level<span class="token punctuation">,</span>frmt<span class="token punctuation">,</span> </span><span class="token punctuation">##</span><span class="token expression">__VA_ARGS__<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>从这个头文件可以看出，对接口所需的参数不用将各种组合一一定义，只需要按照需要组合即可，而且做这个日志接口时发现后续维护过程中会增加越来越多的功能和需要更多的input数据。比如每条日志添加应用生命周期唯一编号，产品线每次切换唯一编号这样需要在特定场景需要添加的input支持。采用这种方式会更加易于扩展。写的时候会是[[[[DCLogger create] message:@”此处必改”] classify:DCProjectClassifyTradeHome] save]; 这样，对于不是特定场所较通用的场景可以使用宏来定义，内部实现还是按照前者的来实现，看起来是[DCLogger loggerWithMessage:@”此处必改”];，这样就能够同时满足常用场景和特殊场景的调用需求。</p>
<p>有了链式编程这种易于扩展方式的编程方式再来构造函数式编程，函数编程主要思路就是用有输入输出的函数作为参数将运算过程尽量写成一系列嵌套的函数调用，下面我构造一个需求来看看函数式编程的例子。</p>
<pre class="line-numbers language-objectivec" data-language="objectivec"><code class="language-objectivec"><span class="token keyword">typedef</span> <span class="token function">NS_ENUM</span><span class="token punctuation">(</span>NSUInteger<span class="token punctuation">,</span> SMStudentGender<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    SMStudentGenderMale<span class="token punctuation">,</span>
    SMStudentGenderFemale
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token function">BOOL</span><span class="token punctuation">(</span><span class="token operator">^</span>SatisfyActionBlock<span class="token punctuation">)</span><span class="token punctuation">(</span>NSUInteger credit<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">@interface</span> SMStudent <span class="token punctuation">:</span> NSObject

<span class="token keyword">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> SMCreditSubject <span class="token operator">*</span>creditSubject<span class="token punctuation">;</span>

<span class="token keyword">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> assign<span class="token punctuation">)</span> BOOL isSatisfyCredit<span class="token punctuation">;</span>

<span class="token operator">+</span> <span class="token punctuation">(</span>SMStudent <span class="token operator">*</span><span class="token punctuation">)</span>create<span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>SMStudent <span class="token operator">*</span><span class="token punctuation">)</span>name<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>name<span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>SMStudent <span class="token operator">*</span><span class="token punctuation">)</span>gender<span class="token punctuation">:</span><span class="token punctuation">(</span>SMStudentGender<span class="token punctuation">)</span>gender<span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>SMStudent <span class="token operator">*</span><span class="token punctuation">)</span>studentNumber<span class="token punctuation">:</span><span class="token punctuation">(</span>NSUInteger<span class="token punctuation">)</span>number<span class="token punctuation">;</span>

<span class="token comment">//积分相关</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>SMStudent <span class="token operator">*</span><span class="token punctuation">)</span>sendCredit<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token function">NSUInteger</span><span class="token punctuation">(</span><span class="token operator">^</span><span class="token punctuation">)</span><span class="token punctuation">(</span>NSUInteger credit<span class="token punctuation">)</span><span class="token punctuation">)</span>updateCreditBlock<span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>SMStudent <span class="token operator">*</span><span class="token punctuation">)</span>filterIsASatisfyCredit<span class="token punctuation">:</span><span class="token punctuation">(</span>SatisfyActionBlock<span class="token punctuation">)</span>satisfyBlock<span class="token punctuation">;</span>

<span class="token keyword">@end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这个例子中，sendCredit的block函数参数会处理当前的积分这个数据然后返回给SMStudent记录下来，filterIsASatisfyCredit的block函数参数会处理是否达到合格的积分判断返回是或否的BOOL值给SMStudent记录下来。实现代码如下</p>
<pre class="line-numbers language-objectivec" data-language="objectivec"><code class="language-objectivec"><span class="token comment">//present</span>
<span class="token keyword">self</span><span class="token punctuation">.</span>student <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span>SMStudent create<span class="token punctuation">]</span>
                   name<span class="token punctuation">:</span><span class="token string">@"ming"</span><span class="token punctuation">]</span>
                  gender<span class="token punctuation">:</span>SMStudentGenderMale<span class="token punctuation">]</span>
                 studentNumber<span class="token punctuation">:</span><span class="token number">345</span><span class="token punctuation">]</span>
                filterIsASatisfyCredit<span class="token punctuation">:</span><span class="token operator">^</span><span class="token function">BOOL</span><span class="token punctuation">(</span>NSUInteger credit<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>credit <span class="token operator">>=</span> <span class="token number">70</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">self</span><span class="token punctuation">.</span>isSatisfyLabel<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">@"合格"</span><span class="token punctuation">;</span>
                        <span class="token keyword">self</span><span class="token punctuation">.</span>isSatisfyLabel<span class="token punctuation">.</span>textColor <span class="token operator">=</span> <span class="token punctuation">[</span>UIColor redColor<span class="token punctuation">]</span><span class="token punctuation">;</span>
                        <span class="token keyword">return</span> YES<span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">self</span><span class="token punctuation">.</span>isSatisfyLabel<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">@"不合格"</span><span class="token punctuation">;</span>
                        <span class="token keyword">return</span> NO<span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>

                <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token operator">@</span><span class="token function">weakify</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>testButton rac_signalForControlEvents<span class="token punctuation">:</span>UIControlEventTouchUpInside<span class="token punctuation">]</span> subscribeNext<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>id x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token operator">@</span><span class="token function">strongify</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>student sendCredit<span class="token punctuation">:</span><span class="token operator">^</span><span class="token function">NSUInteger</span><span class="token punctuation">(</span>NSUInteger credit<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        credit <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
        <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@"current credit %lu"</span><span class="token punctuation">,</span>credit<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>student<span class="token punctuation">.</span>creditSubject sendNext<span class="token punctuation">:</span>credit<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> credit<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>student<span class="token punctuation">.</span>creditSubject subscribeNext<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>NSUInteger credit<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@"第一个订阅的credit处理积分%lu"</span><span class="token punctuation">,</span>credit<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>currentCreditLabel<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token punctuation">[</span>NSString stringWithFormat<span class="token punctuation">:</span><span class="token string">@"%lu"</span><span class="token punctuation">,</span>credit<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>credit <span class="token operator">&lt;</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>currentCreditLabel<span class="token punctuation">.</span>textColor <span class="token operator">=</span> <span class="token punctuation">[</span>UIColor lightGrayColor<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>credit <span class="token operator">&lt;</span> <span class="token number">70</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>currentCreditLabel<span class="token punctuation">.</span>textColor <span class="token operator">=</span> <span class="token punctuation">[</span>UIColor purpleColor<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>currentCreditLabel<span class="token punctuation">.</span>textColor <span class="token operator">=</span> <span class="token punctuation">[</span>UIColor redColor<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>student<span class="token punctuation">.</span>creditSubject subscribeNext<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>NSUInteger credit<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@"第二个订阅的credit处理积分%lu"</span><span class="token punctuation">,</span>credit<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>credit <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>currentCreditLabel<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">@"0"</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>isSatisfyLabel<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">@"未设置"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>每次按钮点击都会增加5个积分，达到70个积分就算合格了。上面的例子里可以看到一个对每次积分变化有不同的观察者处理的操作代码，这里并没有使用ReactiveCocoa里的信号，而是自己实现了一个特定的积分的类似信号的对象，方法名也用的是一样的。实现这个对象也是用的函数式编程方式。下面我的具体的实现代码</p>
<pre class="line-numbers language-objectivec" data-language="objectivec"><code class="language-objectivec"><span class="token keyword">@interface</span> SMCreditSubject <span class="token punctuation">:</span> NSObject

<span class="token keyword">typedef</span> <span class="token keyword">void</span><span class="token punctuation">(</span><span class="token operator">^</span>SubscribeNextActionBlock<span class="token punctuation">)</span><span class="token punctuation">(</span>NSUInteger credit<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">+</span> <span class="token punctuation">(</span>SMCreditSubject <span class="token operator">*</span><span class="token punctuation">)</span>create<span class="token punctuation">;</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>SMCreditSubject <span class="token operator">*</span><span class="token punctuation">)</span>sendNext<span class="token punctuation">:</span><span class="token punctuation">(</span>NSUInteger<span class="token punctuation">)</span>credit<span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>SMCreditSubject <span class="token operator">*</span><span class="token punctuation">)</span>subscribeNext<span class="token punctuation">:</span><span class="token punctuation">(</span>SubscribeNextActionBlock<span class="token punctuation">)</span>block<span class="token punctuation">;</span>

<span class="token keyword">@end</span>

<span class="token keyword">@interface</span> <span class="token function">SMCreditSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> assign<span class="token punctuation">)</span> NSUInteger credit<span class="token punctuation">;</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> SubscribeNextActionBlock subscribeNextBlock<span class="token punctuation">;</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> NSMutableArray <span class="token operator">*</span>blockArray<span class="token punctuation">;</span>

<span class="token keyword">@end</span>

<span class="token keyword">@implementation</span> SMCreditSubject

<span class="token operator">+</span> <span class="token punctuation">(</span>SMCreditSubject <span class="token operator">*</span><span class="token punctuation">)</span>create <span class="token punctuation">&#123;</span>
    SMCreditSubject <span class="token operator">*</span>subject <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">self</span> alloc<span class="token punctuation">]</span> init<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> subject<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>SMCreditSubject <span class="token operator">*</span><span class="token punctuation">)</span>sendNext<span class="token punctuation">:</span><span class="token punctuation">(</span>NSUInteger<span class="token punctuation">)</span>credit <span class="token punctuation">&#123;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>credit <span class="token operator">=</span> credit<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>blockArray<span class="token punctuation">.</span>count <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>SubscribeNextActionBlock block <span class="token keyword">in</span> <span class="token keyword">self</span><span class="token punctuation">.</span>blockArray<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token function">block</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>credit<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>SMCreditSubject <span class="token operator">*</span><span class="token punctuation">)</span>subscribeNext<span class="token punctuation">:</span><span class="token punctuation">(</span>SubscribeNextActionBlock<span class="token punctuation">)</span>block <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>block<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">block</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>credit<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>blockArray addObject<span class="token punctuation">:</span>block<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">mark <span class="token operator">-</span> Getter</span></span>
<span class="token operator">-</span> <span class="token punctuation">(</span>NSMutableArray <span class="token operator">*</span><span class="token punctuation">)</span>blockArray <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_blockArray<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        _blockArray <span class="token operator">=</span> <span class="token punctuation">[</span>NSMutableArray array<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> _blockArray<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Demo地址：<a target="_blank" rel="noopener" href="https://github.com/ming1016/RACStudy">https://github.com/ming1016/RACStudy</a></p>
<p>主要思路就是subscribeNext时将参数block的实现输入添加到一个数组中，sendNext时记录输入的积分，同时遍历那个记录subscribeNext的block的数组使那些block再按照新积分再实现一次输入，达到更新积分通知多个subscriber来实现新值的效果。</p>
<p>除了block还可以将每次sendNext的积分放入一个数组记录每次的积分变化，在RAC中的Signal就是这样处理的，如下图，这样新加入的subscirber能够读取到积分变化历史记录。</p>
<p>所以不用ReactiveCocoa库也能够按照函数式编程方式改造现有项目达到同样的效果。</p>
<p>上面的例子也能够看出FRP的另一个响应式编程的特性。说响应式编程之前可以先看看我之前关于解耦的那篇文章里的Demo<a target="_blank" rel="noopener" href="https://github.com/ming1016/DecoupleDemo">https://github.com/ming1016/DecoupleDemo</a>，里面使用了Model作为连接视图，请求存储和控制器之间的纽带，通过KVO使它们能够通过Model的属性来相互监听来避免它们之间的相互依赖达到解耦的效果。</p>
<p>像上面的例子那样其实也能够达到同样的效果，创建一个Model然后通过各个Subject来贯穿视图层和数据层进行send值和多subscribe值的处理。</p>
<p>了解了这种编程模型，再去了解下ReactiveCocoa使用的三种设计模式就能够更容易的将它学以致用了，下面配上这三种贯穿ReactiveCocoa的设计模式，看这些图里的方法名是不是很眼熟。</p>
<p>ReactiveCocoa里面还有很多可以学习的地方，比如宏的运用，可以看看sunnyxx的那篇《Reactive Cocoa Tutorial [1] &#x3D; 神奇的Macros》<a target="_blank" rel="noopener" href="http://blog.sunnyxx.com/2014/03/06/rac_1_macros/">http://blog.sunnyxx.com/2014/03/06/rac_1_macros/</a></p>

        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    <ul>
        <li>Post title：从 ReactiveCocoa 中能学到什么？不用此库也能学以致用</li>
        <li>Post author：戴铭</li>
        <li>Create time：2016-05-30 21:32:02</li>
        <li>
            Post link：https://ming1016.github.io/2016/05/30/what-learn-from-reactivecocoa/
        </li>
        <li>
            Copyright Notice：All articles in this blog are licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> unless stating additionally.
        </li>
    </ul>
</div>

            </div>
        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/iOS/">#iOS</a>&nbsp;
                    </li>
                
                    <li class="tag-item">
                        <a href="/tags/ReactiveCocoa/">#ReactiveCocoa</a>&nbsp;
                    </li>
                
            </ul>
        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2016/07/21/assembleview/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">制作一个类似苹果VFL(Visual Format Language)的格式化语言来描述类似UIStackView那种布局思路，并解析生成页面</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2016/05/23/try-to-decouple-with-demo/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">竭尽全力的去解耦的一次实践，封装一个TableView和一些功能组合的控件</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2014</span>
              -
            
            2022&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">戴铭</a>
        </div>
        
            <script async  src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        Visitor Count&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        Totalview&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.5</a>
        </div>
        
            <div class="icp-info info-item"><a target="_blank" rel="nofollow" href="https://beian.miit.gov.cn">鄂ICP备17011999号 京公网安备 7011999号</a></div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        
            <li class="tools-item rss flex-center">
                <a class="flex-center"
                   href="/atom.xml"
                   target="_blank"
                >
                    <i class="fas fa-rss"></i>
                </a>
            </li>
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>








<div class="post-scripts">
    
        
<script src="/js/left-side-toggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/toc.js"></script>

    
</div>



</body>
</html>
