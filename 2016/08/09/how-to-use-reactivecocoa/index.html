<!DOCTYPE html>
<html>
<meta  lang="zh-Hans" >
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color" content="#fff" id="theme-color">
  <link rel="icon" href="/img/logo-starming.png">
  <title>戴铭的博客</title>
  <script>
    // control reverse button
    var reverseDarkList = {
      dark: 'light',
      light: 'dark'
    };
    var themeColor = {
      dark: '#1c1c1e',
      light: '#fff'
    }
    // get the data of css prefers-color-scheme
    var getCssMediaQuery = function() {
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    };
    // reverse current darkmode setting function
    var reverseDarkModeSetting = function() {
      var setting = localStorage.getItem('user-color-scheme');
      if(reverseDarkList[setting]) {
        setting = reverseDarkList[setting];
      } else if(setting === null) {
        setting = reverseDarkList[getCssMediaQuery()];
      } else {
        return;
      }
      localStorage.setItem('user-color-scheme', setting);
      return setting;
    };
    // apply current darkmode setting
    var setDarkmode = function(mode) {
      var setting = mode || localStorage.getItem('user-color-scheme');
      if(setting === getCssMediaQuery()) {
        document.documentElement.removeAttribute('data-user-color-scheme');
        localStorage.removeItem('user-color-scheme');
        document.getElementById('theme-color').content = themeColor[setting];
      } else if(reverseDarkList[setting]) {
        document.documentElement.setAttribute('data-user-color-scheme', setting);
        document.getElementById('theme-color').content = themeColor[setting];
      } else {
        document.documentElement.removeAttribute('data-user-color-scheme');
        localStorage.removeItem('user-color-scheme');
        document.getElementById('theme-color').content = themeColor[getCssMediaQuery()];
      }
    };
    setDarkmode();
  </script>
  <script>
    function loadScript(url, cb) {
      var script = document.createElement('script');
      script.src = url;
      if (cb) script.onload = cb;
      script.async = true;
      document.body.appendChild(script);
    }
  </script>
  
  <link rel="preload" href="//at.alicdn.com/t/font_1946621_vpj3dq9ceqa.css" as="style" >
  <link rel="preload" href="//at.alicdn.com/t/font_1952792_89b4ac4k4up.css" as="style" >
  
  <link rel="preload" href="//cdn.jsdelivr.net/npm/fslightbox@3.1.0/index.min.js" as="script">
  
  
  <link rel="preload" href="/js/lib/lozad.min.js" as="script">
  
  
  
  
  
  
  
  
<link rel="stylesheet" href="/css/main.css">

  
  
<link rel="stylesheet" href="//at.alicdn.com/t/font_1946621_vpj3dq9ceqa.css">

  
  
<link rel="stylesheet" href="//at.alicdn.com/t/font_1952792_89b4ac4k4up.css">

  
  
  
  
  
  <link href="/js/lib/prism/prism.min.css" rel="stylesheet" data-prism="prism">
  
  
  
<link rel="stylesheet" href="/js/lib/prism/prism-line-numbers.min.css">

  
  
  
<meta name="generator" content="Hexo 5.4.2"></head>


<body>
  <div class="wrapper">
    
    <nav class="navbar">
  <div class="navbar-logo">
    <span class="navbar-logo-main">
      
      <img class="navbar-logo-img" src="/img/logo-starming.png">
      
      <span class="navbar-logo-dsc">戴铭的博客</span>
    </span>
  </div>
  <div class="navbar-menu">
    
    <a href="/" class="navbar-menu-item">Home </a>
    
    <a href="/archives" class="navbar-menu-item">Archive </a>
    
    <a href="/tags" class="navbar-menu-item">Tags </a>
    
    <a href="/categories" class="navbar-menu-item">Categories </a>
    
    <a href="/about" class="navbar-menu-item">About </a>
    
    <a href="" class="navbar-menu-item">Friends </a>
    
    <a class="navbar-menu-item darknavbar" id="dark"><i class="iconfont icon-weather"></i></a>
  </div>
</nav>
    
    <div class="section-wrap">
      <div class="container">
        <div class="columns">
          <main class="main-column">
<article class="card card-content">
  <header>
    <h1 class="post-title">
      iOS函数响应式编程以及ReactiveCocoa的使用
    </h1>
  </header>
  <div class="post-meta post-show-meta">
    <time datetime="2016-08-09T13:44:10.000Z" style="display: flex; align-items: center;">
      <i class="iconfont icon-calendar" style="margin-right: 2px;"></i>
      <span>2016-08-09</span>
    </time>
    
    <span class="dot"></span>
    
    <a href="/categories/Programming/" class="post-meta-link">Programming</a>
    
    
    
    <span class="dot"></span>
    <span>4.6k words</span>
    
  </div>
  
  <div class="post-meta post-show-meta" style="margin-top: -10px;">
    <div style="display: flex; align-items: center;">
      <i class="iconfont icon-biaoqian" style="margin-right: 2px; font-size: 1.15rem;"></i>
      
      
        <a href="/tags/iOS/" class="post-meta-link">iOS</a>
      
      
      <span class="dot"></span>
      
        <a href="/tags/ReactiveCocoa/" class="post-meta-link">ReactiveCocoa</a>
      
    </div>
  </div>
  
  </header>
  <div id="section" class="post-content">
    <p>打算在项目中大面积使用RAC来开发，所以整理一些常用的实践范例和比较完整的api说明方便开发时随时查阅</p>
<h1 id="声明式编程泛型Declarative-programming"><a href="#声明式编程泛型Declarative-programming" class="headerlink" title="声明式编程泛型Declarative programming"></a>声明式编程泛型Declarative programming</h1><p>函数反应式编程是声明式编程的子编程范式之一</p>
<h1 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h1><p>需要满足两个条件</p>
<ul>
<li>一个或者多个函数作为输入。</li>
<li>有且仅有一个函数输出。</li>
</ul>
<p>objectivec里使用block作为函数</p>
<pre class="line-numbers language-objectivec" data-language="objectivec"><code class="language-objectivec"><span class="token punctuation">[</span>array enumerateObjectsUsingBlock<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>NSNumber <span class="token operator">*</span>number<span class="token punctuation">,</span> NSUInteger idx<span class="token punctuation">,</span> BOOL <span class="token operator">*</span>stop<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@"%@"</span><span class="token punctuation">,</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="映射map"><a href="#映射map" class="headerlink" title="映射map"></a>映射map</h2><pre class="line-numbers language-objectivec" data-language="objectivec"><code class="language-objectivec">NSArray <span class="token operator">*</span> mappedArray <span class="token operator">=</span> <span class="token punctuation">[</span>array rx_mapWithBlock<span class="token punctuation">:</span><span class="token operator">^</span><span class="token function">id</span><span class="token punctuation">(</span>id each<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token operator">@</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">[</span>each integerValue<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="过滤filter"><a href="#过滤filter" class="headerlink" title="过滤filter"></a>过滤filter</h2><pre class="line-numbers language-objectivec" data-language="objectivec"><code class="language-objectivec">NSArray <span class="token operator">*</span>filteredArray <span class="token operator">=</span> <span class="token punctuation">[</span>array rx_filterWithBlock<span class="token punctuation">:</span><span class="token operator">^</span><span class="token function">BOOL</span><span class="token punctuation">(</span>id each<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>each integerValue<span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="折叠fold"><a href="#折叠fold" class="headerlink" title="折叠fold"></a>折叠fold</h2><pre class="line-numbers language-objectivec" data-language="objectivec"><code class="language-objectivec"><span class="token punctuation">[</span><span class="token punctuation">[</span>array rx_mapWithBlock<span class="token punctuation">:</span><span class="token operator">^</span><span class="token function">id</span> <span class="token punctuation">(</span>id each<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>each stringValue<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">]</span> rx_foldInitialValue<span class="token punctuation">:</span><span class="token string">@""</span> block<span class="token punctuation">:</span><span class="token operator">^</span><span class="token function">id</span> <span class="token punctuation">(</span>id memo <span class="token punctuation">,</span> id each<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>memo stringByAppendingString<span class="token punctuation">:</span>each<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Currying"><a href="#Currying" class="headerlink" title="Currying"></a>Currying</h2><p>用函数生成另一个函数</p>
<pre class="line-numbers language-Swift" data-language="Swift"><code class="language-Swift">func filterGenerator(lastnameCondition: String) -&gt; (Staff) -&gt; (Bool) &#123;
    return &#123;staff in
        return staff.lastname &#x3D;&#x3D; lastnameCondition
    &#125;
&#125;

let filterWang &#x3D; filterGenerator(&quot;Wang&quot;)
let filterHu &#x3D; filterGenerator(&quot;Hu&quot;)

staffs.filter(filterHu)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="RAC中使用高阶函数"><a href="#RAC中使用高阶函数" class="headerlink" title="RAC中使用高阶函数"></a>RAC中使用高阶函数</h1><h2 id="映射"><a href="#映射" class="headerlink" title="映射"></a>映射</h2><pre class="line-numbers language-objectivec" data-language="objectivec"><code class="language-objectivec">NSArray <span class="token operator">*</span>array <span class="token operator">=</span> <span class="token operator">@</span><span class="token punctuation">[</span> <span class="token operator">@</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">@</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">@</span><span class="token number">3</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
RACSequence <span class="token operator">*</span> stream <span class="token operator">=</span> <span class="token punctuation">[</span>array rac_sequence<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//RACSequence是一个RACStream的子类。</span>
<span class="token punctuation">[</span>stream map<span class="token punctuation">:</span><span class="token operator">^</span><span class="token function">id</span> <span class="token punctuation">(</span>id value<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token operator">@</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">[</span>value integerValue<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//RACSequence有一个方法返回数组:array</span>
<span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@"%@"</span><span class="token punctuation">,</span><span class="token punctuation">[</span>stream array<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//避免污染变量的作用域</span>
<span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@"%@"</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span>array rac_sequence<span class="token punctuation">]</span> map<span class="token punctuation">:</span><span class="token operator">^</span><span class="token function">id</span> <span class="token punctuation">(</span>id value<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                    <span class="token keyword">return</span> <span class="token operator">@</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">[</span>value integerValue<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">]</span> array<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="过滤"><a href="#过滤" class="headerlink" title="过滤"></a>过滤</h2><pre class="line-numbers language-objectivec" data-language="objectivec"><code class="language-objectivec"><span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@"%@"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span>array rac_sequence<span class="token punctuation">]</span> filter<span class="token punctuation">:</span><span class="token operator">^</span><span class="token function">BOOL</span> <span class="token punctuation">(</span>id value<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                        <span class="token keyword">return</span> <span class="token punctuation">[</span>value integerValue<span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span><span class="token punctuation">]</span> array<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="折叠"><a href="#折叠" class="headerlink" title="折叠"></a>折叠</h2><pre class="line-numbers language-objectivec" data-language="objectivec"><code class="language-objectivec"><span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@"%@"</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span>array rac_sequence<span class="token punctuation">]</span> map<span class="token punctuation">:</span><span class="token operator">^</span><span class="token function">id</span> <span class="token punctuation">(</span>id value<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                    <span class="token keyword">return</span> <span class="token punctuation">[</span>value stringValue<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">]</span> foldLeftWithStart<span class="token punctuation">:</span><span class="token string">@""</span> reduce<span class="token punctuation">:</span><span class="token operator">^</span><span class="token function">id</span> <span class="token punctuation">(</span>id accumulator<span class="token punctuation">,</span> id value<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                    <span class="token keyword">return</span> <span class="token punctuation">[</span>accumulator stringByAppendingString<span class="token punctuation">:</span>value<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="绑定键值"><a href="#绑定键值" class="headerlink" title="绑定键值"></a>绑定键值</h2><pre class="line-numbers language-objectivec" data-language="objectivec"><code class="language-objectivec">RACSignal <span class="token operator">*</span> validEmailSignal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>textField<span class="token punctuation">.</span>rac_textSignal map<span class="token punctuation">:</span><span class="token operator">^</span><span class="token function">id</span> <span class="token punctuation">(</span>NSString <span class="token operator">*</span>value<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token operator">@</span><span class="token punctuation">(</span><span class="token punctuation">[</span>value rangeOfString<span class="token punctuation">:</span><span class="token string">@"@"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>location <span class="token operator">!=</span> NSNotFound<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token function">RAC</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>button<span class="token punctuation">,</span> enabled<span class="token punctuation">)</span> <span class="token operator">=</span> validEmailSignal<span class="token punctuation">;</span>

<span class="token function">RAC</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>textField<span class="token punctuation">,</span> textColor<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">[</span>validEmailSignal map<span class="token punctuation">:</span> <span class="token operator">^</span><span class="token function">id</span> <span class="token punctuation">(</span>id value<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">[</span>value boolValue<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>UIColor greenColor<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>UIColor redColor<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://github.com/ming1016/study/blob/master/pic/CombinePipeline.png?raw=true" alt="绑定键值图示" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://github.com/ming1016/study/blob/master/pic/CombinePipeline.png?raw=true" class="lozad post-image"></p>
<h2 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h2><p>比较好的一个完整的RAC实践的例子：<a target="_blank" rel="noopener" href="https://github.com/ashfurrow/FunctionalReactivePixels">https://github.com/ashfurrow/FunctionalReactivePixels</a></p>
<h3 id="网络请求生成对应model"><a href="#网络请求生成对应model" class="headerlink" title="网络请求生成对应model"></a>网络请求生成对应model</h3><pre class="line-numbers language-objectivec" data-language="objectivec"><code class="language-objectivec"><span class="token operator">+</span> <span class="token punctuation">(</span>RACSignal <span class="token operator">*</span><span class="token punctuation">)</span>importPhotos<span class="token punctuation">&#123;</span>
    RACReplaySubject <span class="token operator">*</span> subject <span class="token operator">=</span> <span class="token punctuation">[</span>RACReplaySubject subject<span class="token punctuation">]</span><span class="token punctuation">;</span>
    NSURLRequest <span class="token operator">*</span> request <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">self</span> popularURLRequest<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span>NSURLConnection sendAsynchronousRequest<span class="token punctuation">:</span>request
                                    queue<span class="token punctuation">:</span><span class="token punctuation">[</span>NSOperationQueue mainQueue<span class="token punctuation">]</span>
                        completionHandler<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>NSURLResponse <span class="token operator">*</span>response<span class="token punctuation">,</span> NSData <span class="token operator">*</span>data<span class="token punctuation">,</span> NSError <span class="token operator">*</span>connectionError<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                id results <span class="token operator">=</span> <span class="token punctuation">[</span>NSJSONSerialization JSONObjectWithData<span class="token punctuation">:</span>data options<span class="token punctuation">:</span><span class="token number">0</span> error<span class="token punctuation">:</span>nil<span class="token punctuation">]</span><span class="token punctuation">;</span>

                                <span class="token punctuation">[</span>subject sendNext<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span>results<span class="token punctuation">[</span><span class="token string">@"photos"</span><span class="token punctuation">]</span> rac_sequence<span class="token punctuation">]</span> map<span class="token punctuation">:</span><span class="token operator">^</span><span class="token function">id</span><span class="token punctuation">(</span>NSDictionary <span class="token operator">*</span>photoDictionary<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                                    FRPPhotoModel <span class="token operator">*</span> model <span class="token operator">=</span> <span class="token punctuation">[</span>FRPPhotoModel new<span class="token punctuation">]</span><span class="token punctuation">;</span>

                                    <span class="token punctuation">[</span><span class="token keyword">self</span> configurePhotoModel<span class="token punctuation">:</span>model withDictionary<span class="token punctuation">:</span>photoDictionary<span class="token punctuation">]</span><span class="token punctuation">;</span>
                                    <span class="token punctuation">[</span><span class="token keyword">self</span> downloadThumbnailForPhotoModel<span class="token punctuation">:</span>model<span class="token punctuation">]</span><span class="token punctuation">;</span>

                                    <span class="token keyword">return</span> model<span class="token punctuation">;</span>
                                <span class="token punctuation">&#125;</span><span class="token punctuation">]</span> array<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

                                <span class="token punctuation">[</span>subject sendCompleted<span class="token punctuation">]</span><span class="token punctuation">;</span>
                            <span class="token punctuation">&#125;</span>
                            <span class="token keyword">else</span><span class="token punctuation">&#123;</span>
                                <span class="token punctuation">[</span>subject sendError<span class="token punctuation">:</span>connectionError<span class="token punctuation">]</span><span class="token punctuation">;</span>
                            <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> subject<span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="过滤相同大小的图片，取出他们的url，返回第一个"><a href="#过滤相同大小的图片，取出他们的url，返回第一个" class="headerlink" title="过滤相同大小的图片，取出他们的url，返回第一个"></a>过滤相同大小的图片，取出他们的url，返回第一个</h3><pre class="line-numbers language-objectivec" data-language="objectivec"><code class="language-objectivec"><span class="token operator">+</span> <span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>urlForImageSize<span class="token punctuation">:</span><span class="token punctuation">(</span>NSInteger<span class="token punctuation">)</span>size inDictionary<span class="token punctuation">:</span><span class="token punctuation">(</span>NSArray <span class="token operator">*</span><span class="token punctuation">)</span>array<span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span>array rac_sequence<span class="token punctuation">]</span> filter<span class="token punctuation">:</span><span class="token operator">^</span> <span class="token function">BOOL</span> <span class="token punctuation">(</span>NSDictionary <span class="token operator">*</span> value<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>value<span class="token punctuation">[</span><span class="token string">@"size"</span><span class="token punctuation">]</span> integerValue<span class="token punctuation">]</span> <span class="token operator">==</span> size<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">]</span> map<span class="token punctuation">:</span><span class="token operator">^</span><span class="token function">id</span> <span class="token punctuation">(</span>id value<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> value<span class="token punctuation">[</span><span class="token string">@"url"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">]</span> array<span class="token punctuation">]</span> firstObject<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="观察model里的图片数据，进行为空过滤判断，将data转为UIImage，再把绑定新信号的值给对象的关键路径"><a href="#观察model里的图片数据，进行为空过滤判断，将data转为UIImage，再把绑定新信号的值给对象的关键路径" class="headerlink" title="观察model里的图片数据，进行为空过滤判断，将data转为UIImage，再把绑定新信号的值给对象的关键路径"></a>观察model里的图片数据，进行为空过滤判断，将data转为UIImage，再把绑定新信号的值给对象的关键路径</h3><pre class="line-numbers language-objectivec" data-language="objectivec"><code class="language-objectivec"><span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>setPhotoModel<span class="token punctuation">:</span><span class="token punctuation">(</span>FRPPhotoModel <span class="token operator">*</span><span class="token punctuation">)</span>photoModel<span class="token punctuation">&#123;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>subscription <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token function">RACObserver</span><span class="token punctuation">(</span>photoModel<span class="token punctuation">,</span> thumbnailData<span class="token punctuation">)</span>
        filter<span class="token punctuation">:</span><span class="token operator">^</span> <span class="token function">BOOL</span> <span class="token punctuation">(</span>id value<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> value <span class="token operator">!=</span> nil<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">]</span> map<span class="token punctuation">:</span><span class="token operator">^</span><span class="token function">id</span> <span class="token punctuation">(</span>id value<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span>UIImage imageWithData<span class="token punctuation">:</span>value<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">]</span> setKeyPath<span class="token punctuation">:</span><span class="token operator">@</span><span class="token function">keypath</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>imageView<span class="token punctuation">,</span> image<span class="token punctuation">)</span> onObject<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>imageView<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="UITableViewCell复用时需要取消cell上各个组件的订阅"><a href="#UITableViewCell复用时需要取消cell上各个组件的订阅" class="headerlink" title="UITableViewCell复用时需要取消cell上各个组件的订阅"></a>UITableViewCell复用时需要取消cell上各个组件的订阅</h3><pre class="line-numbers language-objectivec" data-language="objectivec"><code class="language-objectivec"><span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>prepareForReuse <span class="token punctuation">&#123;</span>
    <span class="token punctuation">[</span><span class="token keyword">super</span> prepareForReuse<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>subscription dispose<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>subscription <span class="token operator">=</span> nil<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Delegate的使用"><a href="#Delegate的使用" class="headerlink" title="Delegate的使用"></a>Delegate的使用</h3><pre class="line-numbers language-objectivec" data-language="objectivec"><code class="language-objectivec"><span class="token comment">//注意：你必须retain这个delegate对象，否则他们将会被释放，你将会得到一个EXC_BAD_ACCESS异常。添加下列私有属性到画廊视图控制器：</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> id collectionViewDelegate<span class="token punctuation">;</span>

<span class="token comment">//同时你也需要导入RACDelegateProxy.h，因为他不是ReactiveCocoa的核心部分，不包含在ReactiveCocoa.h中。</span>
RACDelegateProxy <span class="token operator">*</span>viewControllerDelegate <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>RACDelegateProxy alloc<span class="token punctuation">]</span>
                                    initWithProtocol<span class="token punctuation">:</span><span class="token keyword">@protocol</span><span class="token punctuation">(</span>FRPFullSizePhotoViewControllerDelegate<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span><span class="token punctuation">[</span>viewControllerDelegate rac_signalForSelector<span class="token punctuation">:</span><span class="token keyword">@selector</span><span class="token punctuation">(</span>userDidScroll<span class="token punctuation">:</span>toPhotoAtIndex<span class="token punctuation">:</span><span class="token punctuation">)</span>     fromProtocol<span class="token punctuation">:</span><span class="token keyword">@protocol</span><span class="token punctuation">(</span>FRPFullSizePhotoViewControllerDelegate<span class="token punctuation">)</span><span class="token punctuation">]</span>
        subscribeNext<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>RACTuple <span class="token operator">*</span>value<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token operator">@</span><span class="token function">strongify</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>collectionView
                scrollToItemAtIndexPath<span class="token punctuation">:</span><span class="token punctuation">[</span>NSIndexPath indexPathForItem<span class="token punctuation">:</span><span class="token punctuation">[</span>value<span class="token punctuation">.</span>second integerValue<span class="token punctuation">]</span> inSection<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>
                atScrollPosition<span class="token punctuation">:</span>UICollectionViewScrollPositionCenteredVertically
                animated<span class="token punctuation">:</span>NO<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">self</span><span class="token punctuation">.</span>collectionViewDelegate <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>RACDelegateProxy alloc<span class="token punctuation">]</span> initWithProtocol<span class="token punctuation">:</span><span class="token keyword">@protocol</span><span class="token punctuation">(</span>UICollectionViewDelegate<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>collectionViewDelegate rac_signalForSelector<span class="token punctuation">:</span><span class="token keyword">@selector</span><span class="token punctuation">(</span>collectionView<span class="token punctuation">:</span>didSelectItemAtIndexPath<span class="token punctuation">:</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        subscribeNext<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>RACTuple <span class="token operator">*</span>arguments<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token operator">@</span><span class="token function">strongify</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            FRPFullSizePhotoViewController <span class="token operator">*</span>viewController <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>FRPFullSizePhotoViewController alloc<span class="token punctuation">]</span> initWithPhotoModels<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>photosArray currentPhotoIndex<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">(</span>NSIndexPath <span class="token operator">*</span><span class="token punctuation">)</span>arguments<span class="token punctuation">.</span>second item<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            viewController<span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token punctuation">(</span>id<span class="token operator">&lt;</span>FRPFullSizePhotoViewControllerDelegate<span class="token operator">></span><span class="token punctuation">)</span>viewControllerDelegate<span class="token punctuation">;</span>

            <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>navigationController pushViewController<span class="token punctuation">:</span>viewController animated<span class="token punctuation">:</span>YES<span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="处理异常，完成执行刷新操作，异常打印日志，执行对应方法"><a href="#处理异常，完成执行刷新操作，异常打印日志，执行对应方法" class="headerlink" title="处理异常，完成执行刷新操作，异常打印日志，执行对应方法"></a>处理异常，完成执行刷新操作，异常打印日志，执行对应方法</h3><pre class="line-numbers language-objectivec" data-language="objectivec"><code class="language-objectivec"><span class="token function">RAC</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> photosArray<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span>FRPPhotoImporter importPhotos<span class="token punctuation">]</span>
        doCompleted<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">&#123;</span>
            <span class="token operator">@</span><span class="token function">strongify</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>collectionView reloadData<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">]</span> logError<span class="token punctuation">]</span> catchTo<span class="token punctuation">:</span><span class="token punctuation">[</span>RACSignal empty<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="网络请求处理数据，获取数据返回主线程"><a href="#网络请求处理数据，获取数据返回主线程" class="headerlink" title="网络请求处理数据，获取数据返回主线程"></a>网络请求处理数据，获取数据返回主线程</h3><pre class="line-numbers language-objectivec" data-language="objectivec"><code class="language-objectivec"><span class="token operator">+</span> <span class="token punctuation">(</span>RACSignal <span class="token operator">*</span><span class="token punctuation">)</span>importPhotos <span class="token punctuation">&#123;</span>
    NSURLRequest <span class="token operator">*</span>request <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">self</span> popularURLRequest<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span>NSURLConnection rac_sendAsynchronousRequest<span class="token punctuation">:</span>request<span class="token punctuation">]</span>
                reduceEach<span class="token punctuation">:</span><span class="token operator">^</span><span class="token function">id</span><span class="token punctuation">(</span>NSURLResponse <span class="token operator">*</span>response <span class="token punctuation">,</span> NSData <span class="token operator">*</span>data<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                    <span class="token comment">//注意：我们可以用下面的reduceEach:替代使用RACTuple的第一个map:，以便提供编译时检查。</span>
                    <span class="token keyword">return</span> data<span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">]</span>
                deliverOn<span class="token punctuation">:</span><span class="token punctuation">[</span>RACScheduler mainThreadScheduler<span class="token punctuation">]</span><span class="token punctuation">]</span>
                map<span class="token punctuation">:</span><span class="token operator">^</span><span class="token function">id</span> <span class="token punctuation">(</span>NSData <span class="token operator">*</span>data<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    id results <span class="token operator">=</span> <span class="token punctuation">[</span>NSJSONSerialization JSONObjectWithData<span class="token punctuation">:</span>data options<span class="token punctuation">:</span><span class="token number">0</span> error<span class="token punctuation">:</span>nil<span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span>results<span class="token punctuation">[</span><span class="token string">@"photo"</span><span class="token punctuation">]</span> rac_sequence<span class="token punctuation">]</span>
                        map<span class="token punctuation">:</span><span class="token operator">^</span><span class="token function">id</span> <span class="token punctuation">(</span>NSDictionary <span class="token operator">*</span>photoDictionary<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                            FRPPhotoModel <span class="token operator">*</span>model <span class="token operator">=</span> <span class="token punctuation">[</span>FRPPhotoModel new<span class="token punctuation">]</span><span class="token punctuation">;</span>
                            <span class="token punctuation">[</span><span class="token keyword">self</span> configurePhotoModel<span class="token punctuation">:</span>model withDictionary<span class="token punctuation">:</span>photoDictionary<span class="token punctuation">]</span><span class="token punctuation">;</span>
                            <span class="token punctuation">[</span><span class="token keyword">self</span> downloadThumbnailForPhotoModel<span class="token punctuation">:</span>model<span class="token punctuation">]</span><span class="token punctuation">;</span>
                            <span class="token keyword">return</span> model<span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span><span class="token punctuation">]</span> array<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">]</span> publish<span class="token punctuation">]</span> autoconnect<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">//信号链条最末端的信号操作publish. publish返回一个RACMulitcastConnection,当信号连接上时，他将订阅该接收信号。autoconnect为我们做的是：当它返回的信号被订阅，连接到 该(订阅背后的)信号（underly signal）。</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="信号的信号Signal-of-signals，一个外部信号包含一个内部信号，在输出信号的subscribeNext-块中订阅内部信号，会引起嵌套麻烦。使用flattenMap后会生成一个新的信号，和先前信号平级，订阅会订阅到返回的新信号里的值。map方法也是创建一个新信号，但是会将返回的信号也当做值，这样就得不到真正需要的值了。"><a href="#信号的信号Signal-of-signals，一个外部信号包含一个内部信号，在输出信号的subscribeNext-块中订阅内部信号，会引起嵌套麻烦。使用flattenMap后会生成一个新的信号，和先前信号平级，订阅会订阅到返回的新信号里的值。map方法也是创建一个新信号，但是会将返回的信号也当做值，这样就得不到真正需要的值了。" class="headerlink" title="信号的信号Signal of signals，一个外部信号包含一个内部信号，在输出信号的subscribeNext:块中订阅内部信号，会引起嵌套麻烦。使用flattenMap后会生成一个新的信号，和先前信号平级，订阅会订阅到返回的新信号里的值。map方法也是创建一个新信号，但是会将返回的信号也当做值，这样就得不到真正需要的值了。"></a>信号的信号Signal of signals，一个外部信号包含一个内部信号，在输出信号的subscribeNext:块中订阅内部信号，会引起嵌套麻烦。使用flattenMap后会生成一个新的信号，和先前信号平级，订阅会订阅到返回的新信号里的值。map方法也是创建一个新信号，但是会将返回的信号也当做值，这样就得不到真正需要的值了。</h3><pre class="line-numbers language-objectivec" data-language="objectivec"><code class="language-objectivec"><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>signInButton rac_signalForControlEvents<span class="token punctuation">:</span>UIControlEventTouchUpInside<span class="token punctuation">]</span> flattenMap<span class="token punctuation">:</span><span class="token operator">^</span>RACStream <span class="token operator">*</span><span class="token punctuation">(</span>id value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token keyword">self</span> signInSignal<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">]</span> subscribeNext<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>id x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//x</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@"Sign in result: %@"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="不同信号顺序链接，程序需要等待前一个信号发出完成事件（sendCompleted），然后再订阅下一个信号（then）"><a href="#不同信号顺序链接，程序需要等待前一个信号发出完成事件（sendCompleted），然后再订阅下一个信号（then）" class="headerlink" title="不同信号顺序链接，程序需要等待前一个信号发出完成事件（sendCompleted），然后再订阅下一个信号（then）"></a>不同信号顺序链接，程序需要等待前一个信号发出完成事件（sendCompleted），然后再订阅下一个信号（then）</h3><pre class="line-numbers language-objectivec" data-language="objectivec"><code class="language-objectivec"><span class="token operator">-</span> <span class="token punctuation">(</span>RACSignal <span class="token operator">*</span><span class="token punctuation">)</span>requestAccessToTwitterSignal
<span class="token punctuation">&#123;</span>
    <span class="token comment">// 定义一个错误，如果用户拒绝访问则发送</span>
    NSError <span class="token operator">*</span>accessError <span class="token operator">=</span> <span class="token punctuation">[</span>NSError errorWithDomain<span class="token punctuation">:</span>RWTwitterInstantDomain code<span class="token punctuation">:</span>RWTwitterInstantErrorAccessDenied userInfo<span class="token punctuation">:</span>nil<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建并返回信号</span>
    <span class="token operator">@</span><span class="token function">weakify</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>RACSignal createSignal<span class="token punctuation">:</span><span class="token operator">^</span>RACDisposable <span class="token operator">*</span><span class="token punctuation">(</span>id<span class="token operator">&lt;</span>RACSubscriber<span class="token operator">></span> subscriber<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

        <span class="token comment">// 请求访问twitter</span>
        <span class="token operator">@</span><span class="token function">strongify</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>accountStore requestAccessToAccountsWithType<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>twitterAccountType
                                                   options<span class="token punctuation">:</span>nil
                                                completion<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>BOOL granted<span class="token punctuation">,</span> NSError <span class="token operator">*</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                                    <span class="token comment">// 处理响应</span>
                                                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>granted<span class="token punctuation">)</span>
                                                    <span class="token punctuation">&#123;</span>
                                                        <span class="token punctuation">[</span>subscriber sendError<span class="token punctuation">:</span>accessError<span class="token punctuation">]</span><span class="token punctuation">;</span>
                                                    <span class="token punctuation">&#125;</span>
                                                    <span class="token keyword">else</span>
                                                    <span class="token punctuation">&#123;</span>
                                                        <span class="token punctuation">[</span>subscriber sendNext<span class="token punctuation">:</span>nil<span class="token punctuation">]</span><span class="token punctuation">;</span>
                                                        <span class="token punctuation">[</span>subscriber sendCompleted<span class="token punctuation">]</span><span class="token punctuation">;</span>
                                                    <span class="token punctuation">&#125;</span>
                                                <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> nil<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">//throttle可以避免连续输入造成的不必要的请求，then会忽略前一个信号的值，底层的实现是先过滤之前信号发的值，再使用concat连接then返回的信号。</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">self</span> requestAccessToTwitterSignal<span class="token punctuation">]</span>
      then<span class="token punctuation">:</span><span class="token operator">^</span>RACSignal <span class="token operator">*</span><span class="token punctuation">&#123;</span>
          <span class="token operator">@</span><span class="token function">strongify</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">.</span>searchText<span class="token punctuation">.</span>rac_textSignal<span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">]</span>
     filter<span class="token punctuation">:</span><span class="token operator">^</span><span class="token function">BOOL</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span>text<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
         <span class="token operator">@</span><span class="token function">strongify</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span>
         <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token keyword">self</span> isValidSearchText<span class="token punctuation">:</span>text<span class="token punctuation">]</span><span class="token punctuation">;</span>
     <span class="token punctuation">&#125;</span><span class="token punctuation">]</span>
    throttle<span class="token punctuation">:</span><span class="token number">0.5</span><span class="token punctuation">]</span>
   flattenMap<span class="token punctuation">:</span><span class="token operator">^</span>RACStream <span class="token operator">*</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span>text<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       <span class="token operator">@</span><span class="token function">strongify</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span>
       <span class="token comment">//flattenMap来将每个next事件映射到一个新的被订阅的信号</span>
       <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token keyword">self</span> signalForSearchWithText<span class="token punctuation">:</span>text<span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span><span class="token punctuation">]</span>
  deliverOn<span class="token punctuation">:</span><span class="token punctuation">[</span>RACScheduler mainThreadScheduler<span class="token punctuation">]</span><span class="token punctuation">]</span>
 subscribeNext<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>NSDictionary <span class="token operator">*</span>jsonSearchResult<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
     NSArray <span class="token operator">*</span>statuses <span class="token operator">=</span> jsonSearchResult<span class="token punctuation">[</span><span class="token string">@"statuses"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
     NSArray <span class="token operator">*</span>tweets <span class="token operator">=</span> <span class="token punctuation">[</span>statuses linq_select<span class="token punctuation">:</span><span class="token operator">^</span><span class="token function">id</span><span class="token punctuation">(</span>id tweet<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
         <span class="token keyword">return</span> <span class="token punctuation">[</span>RWTweet tweetWithStatus<span class="token punctuation">:</span>tweet<span class="token punctuation">]</span><span class="token punctuation">;</span>
     <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
     <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>resultsViewController displayTweets<span class="token punctuation">:</span>tweets<span class="token punctuation">]</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span> error<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>NSError <span class="token operator">*</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
     <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@"An error occurred: %@"</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 <span class="token operator">-</span> <span class="token punctuation">(</span>RACSignal <span class="token operator">*</span><span class="token punctuation">)</span>signalForSearchWithText<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>text <span class="token punctuation">&#123;</span>
    <span class="token comment">// 1 - define the errors</span>
    NSError <span class="token operator">*</span>noAccountsError <span class="token operator">=</span> <span class="token punctuation">[</span>NSError errorWithDomain<span class="token punctuation">:</span>RWTwitterInstantDomain
                                                   code<span class="token punctuation">:</span>RWTwitterInstantErrorNoTwitterAccounts
                                               userInfo<span class="token punctuation">:</span>nil<span class="token punctuation">]</span><span class="token punctuation">;</span>
    NSError <span class="token operator">*</span>invalidResponseError <span class="token operator">=</span> <span class="token punctuation">[</span>NSError errorWithDomain<span class="token punctuation">:</span>RWTwitterInstantDomain
                                                        code<span class="token punctuation">:</span>RWTwitterInstantErrorInvalidResponse
                                                        userInfo<span class="token punctuation">:</span>nil<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token operator">@</span><span class="token function">weakify</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>RACSignal createSignal<span class="token punctuation">:</span><span class="token operator">^</span>RACDisposable <span class="token operator">*</span><span class="token punctuation">(</span>id subscriber<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token operator">@</span><span class="token function">strongify</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        SLRequest <span class="token operator">*</span>request <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">self</span> requestforTwitterSearchWithText<span class="token punctuation">:</span>text<span class="token punctuation">]</span><span class="token punctuation">;</span>
        NSArray <span class="token operator">*</span>twitterAccounts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>accountStore accountsWithAccountType<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>twitterAccountType<span class="token punctuation">]</span><span class="token punctuation">;</span>         <span class="token keyword">if</span> <span class="token punctuation">(</span>twitterAccounts<span class="token punctuation">.</span>count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token punctuation">[</span>subscriber sendError<span class="token punctuation">:</span>noAccountsError<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token punctuation">[</span>request setAccount<span class="token punctuation">:</span><span class="token punctuation">[</span>twitterAccounts lastObject<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span>request performRequestWithHandler<span class="token punctuation">:</span> <span class="token operator">^</span><span class="token punctuation">(</span>NSData <span class="token operator">*</span>responseData<span class="token punctuation">,</span>
                NSHTTPURLResponse <span class="token operator">*</span>urlResponse<span class="token punctuation">,</span> NSError <span class="token operator">*</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>urlResponse<span class="token punctuation">.</span>statusCode <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                NSDictionary <span class="token operator">*</span>timelineData <span class="token operator">=</span> <span class="token punctuation">[</span>NSJSONSerialization JSONObjectWithData<span class="token punctuation">:</span>responseData
                                                options<span class="token punctuation">:</span>NSJSONReadingAllowFragments
                                                  error<span class="token punctuation">:</span>nil<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">[</span>subscriber sendNext<span class="token punctuation">:</span>timelineData<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">[</span>subscriber sendCompleted<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token punctuation">[</span>subscriber sendError<span class="token punctuation">:</span>invalidResponseError<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> nil<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://github.com/ming1016/study/blob/master/pic/CompletePipeline.png?raw=true" alt="不同信号顺序链接" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://github.com/ming1016/study/blob/master/pic/CompletePipeline.png?raw=true" class="lozad post-image"></p>
<h3 id="异步加载图片"><a href="#异步加载图片" class="headerlink" title="异步加载图片"></a>异步加载图片</h3><pre class="line-numbers language-objectivec" data-language="objectivec"><code class="language-objectivec"><span class="token operator">-</span><span class="token punctuation">(</span>RACSignal <span class="token operator">*</span><span class="token punctuation">)</span>signalForLoadingImage<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>imageUrl <span class="token punctuation">&#123;</span>

    RACScheduler <span class="token operator">*</span>scheduler <span class="token operator">=</span> <span class="token punctuation">[</span>RACScheduler
                               schedulerWithPriority<span class="token punctuation">:</span>RACSchedulerPriorityBackground<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>RACSignal createSignal<span class="token punctuation">:</span><span class="token operator">^</span>RACDisposable <span class="token operator">*</span><span class="token punctuation">(</span>id<span class="token operator">&lt;</span>RACSubscriber<span class="token operator">></span> subscriber<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        NSData <span class="token operator">*</span>data <span class="token operator">=</span> <span class="token punctuation">[</span>NSData dataWithContentsOfURL<span class="token punctuation">:</span><span class="token punctuation">[</span>NSURL URLWithString<span class="token punctuation">:</span>imageUrl<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        UIImage <span class="token operator">*</span>image <span class="token operator">=</span> <span class="token punctuation">[</span>UIImage imageWithData<span class="token punctuation">:</span>data<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span>subscriber sendNext<span class="token punctuation">:</span>image<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span>subscriber sendCompleted<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> nil<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">]</span> subscribeOn<span class="token punctuation">:</span>scheduler<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

cell<span class="token punctuation">.</span>twitterAvatarView<span class="token punctuation">.</span>image <span class="token operator">=</span> nil<span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">self</span> signalForLoadingImage<span class="token punctuation">:</span>tweet<span class="token punctuation">.</span>profileImageUrl<span class="token punctuation">]</span>
  deliverOn<span class="token punctuation">:</span><span class="token punctuation">[</span>RACScheduler mainThreadScheduler<span class="token punctuation">]</span><span class="token punctuation">]</span>
  subscribeNext<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>UIImage <span class="token operator">*</span>image<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   cell<span class="token punctuation">.</span>twitterAvatarView<span class="token punctuation">.</span>image <span class="token operator">=</span> image<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="观察viewModel里的tableView的数据键值和全部读取键值，只要有一个有新值就会调用"><a href="#观察viewModel里的tableView的数据键值和全部读取键值，只要有一个有新值就会调用" class="headerlink" title="观察viewModel里的tableView的数据键值和全部读取键值，只要有一个有新值就会调用"></a>观察viewModel里的tableView的数据键值和全部读取键值，只要有一个有新值就会调用</h3><pre class="line-numbers language-objectivec" data-language="objectivec"><code class="language-objectivec"><span class="token operator">@</span><span class="token function">weakify</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span>RACSignal merge<span class="token punctuation">:</span> <span class="token operator">@</span><span class="token punctuation">[</span><span class="token function">RACObserve</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>viewModel<span class="token punctuation">,</span>  tweets<span class="token punctuation">)</span><span class="token punctuation">,</span>
                     <span class="token function">RACObserve</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>viewModel<span class="token punctuation">,</span>  allTweetsLoaded<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    bufferWithTime<span class="token punctuation">:</span> <span class="token number">0</span> onScheduler<span class="token punctuation">:</span> <span class="token punctuation">[</span>RACScheduler mainThreadScheduler<span class="token punctuation">]</span><span class="token punctuation">]</span>
    subscribeNext<span class="token punctuation">:</span> <span class="token operator">^</span><span class="token punctuation">(</span>id value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token operator">@</span><span class="token function">strongify</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>tableView reloadData<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//bufferWithTime设置为0是为了避免同一时刻两个值被同时设置新值产生了table进行了两次reloadData</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="封装hook方法，某个selector被调用时，再执行一段指定代码和hook一样。"><a href="#封装hook方法，某个selector被调用时，再执行一段指定代码和hook一样。" class="headerlink" title="封装hook方法，某个selector被调用时，再执行一段指定代码和hook一样。"></a>封装hook方法，某个selector被调用时，再执行一段指定代码和hook一样。</h3><pre class="line-numbers language-objectivec" data-language="objectivec"><code class="language-objectivec"><span class="token operator">@</span><span class="token function">weakify</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span>tableView rac_signalForSelector<span class="token punctuation">:</span><span class="token keyword">@selector</span><span class="token punctuation">(</span>layoutSubviews<span class="token punctuation">)</span><span class="token punctuation">]</span>subscribeNext<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>id x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token operator">@</span><span class="token function">strongify</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token keyword">self</span> doSomethingBeforeTableViewLayoutSubviews<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="使用RACCommand来实现按钮的状态根据输入邮箱判断邮箱是否非法还有提交到服务器后出错处理等"><a href="#使用RACCommand来实现按钮的状态根据输入邮箱判断邮箱是否非法还有提交到服务器后出错处理等" class="headerlink" title="使用RACCommand来实现按钮的状态根据输入邮箱判断邮箱是否非法还有提交到服务器后出错处理等"></a>使用RACCommand来实现按钮的状态根据输入邮箱判断邮箱是否非法还有提交到服务器后出错处理等</h3><p>Demo的github地址：<a target="_blank" rel="noopener" href="https://github.com/olegam/RACCommandExample">https://github.com/olegam/RACCommandExample</a></p>
<pre class="line-numbers language-objectivec" data-language="objectivec"><code class="language-objectivec"><span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>bindWithViewModel <span class="token punctuation">&#123;</span>
  <span class="token function">RAC</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>viewModel<span class="token punctuation">,</span> email<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token keyword">self</span><span class="token punctuation">.</span>emailTextField<span class="token punctuation">.</span>rac_textSignal<span class="token punctuation">;</span>
  <span class="token keyword">self</span><span class="token punctuation">.</span>subscribeButton<span class="token punctuation">.</span>rac_command <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>viewModel<span class="token punctuation">.</span>subscribeCommand<span class="token punctuation">;</span>
  <span class="token function">RAC</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>statusLabel<span class="token punctuation">,</span> text<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token function">RACObserve</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>viewModel<span class="token punctuation">,</span> statusMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">@interface</span> SubscribeViewModel <span class="token punctuation">:</span>NSObject
  <span class="token keyword">@property</span><span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span>RACCommand <span class="token operator">*</span>subscribeCommand<span class="token punctuation">;</span>  <span class="token comment">// writeto this property</span>
  <span class="token keyword">@property</span><span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> NSString <span class="token operator">*</span>email<span class="token punctuation">;</span>  <span class="token comment">// read from this property</span>
  <span class="token keyword">@property</span><span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> NSString <span class="token operator">*</span>statusMessage<span class="token punctuation">;</span>
<span class="token keyword">@end</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">import</span> <span class="token string">"SubscribeViewModel.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">import</span> <span class="token string">"AFHTTPRequestOperationManager+RACSupport.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">import</span><span class="token string">"NSString+EmailAdditions.h"</span></span>

<span class="token keyword">static</span> NSString <span class="token operator">*</span><span class="token keyword">const</span> kSubscribeURL <span class="token operator">=</span><span class="token string">@"http://reactivetest.apiary.io/subscribers"</span><span class="token punctuation">;</span>

<span class="token keyword">@interface</span> <span class="token function">SubscribeViewModel</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">@property</span><span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> RACSignal<span class="token operator">*</span>emailValidSignal<span class="token punctuation">;</span>
<span class="token keyword">@end</span>

<span class="token keyword">@implementation</span> SubscribeViewModel

<span class="token operator">-</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>init <span class="token punctuation">&#123;</span>
       <span class="token keyword">self</span><span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">super</span> init<span class="token punctuation">]</span><span class="token punctuation">;</span>
       <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token punctuation">[</span><span class="token keyword">self</span> mapSubscribeCommandStateToStatusMessage<span class="token punctuation">]</span><span class="token punctuation">;</span>
       <span class="token punctuation">&#125;</span>
       returnself<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>mapSubscribeCommandStateToStatusMessage <span class="token punctuation">&#123;</span>
       RACSignal <span class="token operator">*</span>startedMessageSource <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>subscribeCommand<span class="token punctuation">.</span>executionSignals map<span class="token punctuation">:</span><span class="token operator">^</span><span class="token function">id</span><span class="token punctuation">(</span>RACSignal <span class="token operator">*</span>subscribeSignal<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
              <span class="token keyword">return</span> <span class="token function">NSLocalizedString</span><span class="token punctuation">(</span><span class="token string">@"Sending request..."</span><span class="token punctuation">,</span> nil<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

       RACSignal <span class="token operator">*</span>completedMessageSource <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>subscribeCommand<span class="token punctuation">.</span>executionSignals flattenMap<span class="token punctuation">:</span><span class="token operator">^</span>RACStream <span class="token operator">*</span><span class="token punctuation">(</span>RACSignal <span class="token operator">*</span>subscribeSignal<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
              <span class="token keyword">return</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span>subscribeSignal materialize<span class="token punctuation">]</span> filter<span class="token punctuation">:</span><span class="token operator">^</span><span class="token function">BOOL</span><span class="token punctuation">(</span>RACEvent <span class="token operator">*</span>event<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                     <span class="token keyword">return</span> event<span class="token punctuation">.</span>eventType <span class="token operator">==</span> RACEventTypeCompleted<span class="token punctuation">;</span>
              <span class="token punctuation">&#125;</span><span class="token punctuation">]</span> map<span class="token punctuation">:</span><span class="token operator">^</span><span class="token function">id</span><span class="token punctuation">(</span>id value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                     <span class="token keyword">return</span> <span class="token function">NSLocalizedString</span><span class="token punctuation">(</span><span class="token string">@"Thanks"</span><span class="token punctuation">,</span> nil<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
       <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

       RACSignal<span class="token operator">*</span>failedMessageSource <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>subscribeCommand<span class="token punctuation">.</span>errors subscribeOn<span class="token punctuation">:</span><span class="token punctuation">[</span>RACSchedulermainThreadScheduler<span class="token punctuation">]</span><span class="token punctuation">]</span> map<span class="token punctuation">:</span><span class="token operator">^</span><span class="token function">id</span><span class="token punctuation">(</span>NSError <span class="token operator">*</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
              <span class="token keyword">return</span> <span class="token function">NSLocalizedString</span><span class="token punctuation">(</span><span class="token string">@"Error :("</span><span class="token punctuation">,</span> nil<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

       <span class="token function">RAC</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span>statusMessage<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">[</span>RACSignal merge<span class="token punctuation">:</span><span class="token operator">@</span><span class="token punctuation">[</span>startedMessageSource<span class="token punctuation">,</span> completedMessageSource<span class="token punctuation">,</span> failedMessageSource<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>RACCommand <span class="token operator">*</span><span class="token punctuation">)</span>subscribeCommand <span class="token punctuation">&#123;</span>
       <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>_subscribeCommand<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
              <span class="token operator">@</span><span class="token function">weakify</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              _subscribeCommand <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>RACCommand alloc<span class="token punctuation">]</span> initWithEnabled<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>emailValidSignal signalBlock<span class="token punctuation">:</span><span class="token operator">^</span>RACSignal <span class="token operator">*</span><span class="token punctuation">(</span>id input<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                     <span class="token operator">@</span><span class="token function">strongify</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token keyword">return</span> <span class="token punctuation">[</span>SubscribeViewModel postEmail<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>email<span class="token punctuation">]</span><span class="token punctuation">;</span>
              <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
       <span class="token punctuation">&#125;</span>
       <span class="token keyword">return</span> _subscribeCommand<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token operator">+</span> <span class="token punctuation">(</span>RACSignal <span class="token operator">*</span><span class="token punctuation">)</span>postEmail<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>email<span class="token punctuation">&#123;</span>
       AFHTTPRequestOperationManager<span class="token operator">*</span>manager <span class="token operator">=</span> <span class="token punctuation">[</span>AFHTTPRequestOperationManager manager<span class="token punctuation">]</span><span class="token punctuation">;</span>
       manager<span class="token punctuation">.</span>requestSerializer<span class="token operator">=</span> <span class="token punctuation">[</span>AFJSONRequestSerializer new<span class="token punctuation">]</span><span class="token punctuation">;</span>
       NSDictionary<span class="token operator">*</span>body <span class="token operator">=</span> <span class="token operator">@</span><span class="token punctuation">&#123;</span><span class="token string">@"email"</span><span class="token punctuation">:</span> email <span class="token operator">?</span><span class="token punctuation">:</span> <span class="token string">@""</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
       <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span>manager rac_POST<span class="token punctuation">:</span>kSubscribeURL parameters<span class="token punctuation">:</span>body<span class="token punctuation">]</span> logError<span class="token punctuation">]</span> replayLazily<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>RACSignal <span class="token operator">*</span><span class="token punctuation">)</span>emailValidSignal <span class="token punctuation">&#123;</span>
       <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>_emailValidSignal<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
              _emailValidSignal<span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">RACObserve</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> email<span class="token punctuation">)</span> map<span class="token punctuation">:</span><span class="token operator">^</span><span class="token function">id</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span>email<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                     <span class="token keyword">return</span><span class="token operator">@</span><span class="token punctuation">(</span><span class="token punctuation">[</span>email isValidEmail<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
       <span class="token punctuation">&#125;</span>
       <span class="token keyword">return</span> _emailValidSignal<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">@end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="替换Delegate，直接使用RACSubject"><a href="#替换Delegate，直接使用RACSubject" class="headerlink" title="替换Delegate，直接使用RACSubject"></a>替换Delegate，直接使用RACSubject</h3><h1 id="RAC内存管理"><a href="#RAC内存管理" class="headerlink" title="RAC内存管理"></a>RAC内存管理</h1><p>RAC会维护一个全局的信号集合，一个或多于一个订阅者就可用，所有订阅者都被移除了，信号就被释放了。</p>
<h1 id="RAC需要注意的内存问题"><a href="#RAC需要注意的内存问题" class="headerlink" title="RAC需要注意的内存问题"></a>RAC需要注意的内存问题</h1><h2 id="宏定义"><a href="#宏定义" class="headerlink" title="宏定义"></a>宏定义</h2><pre class="line-numbers language-objectivec" data-language="objectivec"><code class="language-objectivec"><span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>viewDidLoad
<span class="token punctuation">&#123;</span>
    <span class="token punctuation">[</span><span class="token keyword">super</span> viewDidLoad<span class="token punctuation">]</span><span class="token punctuation">;</span>
    RACSignal <span class="token operator">*</span>signal <span class="token operator">=</span> <span class="token punctuation">[</span>RACSignal createSignal<span class="token punctuation">:</span><span class="token operator">^</span>RACDisposable <span class="token operator">*</span><span class="token punctuation">(</span>id<span class="token operator">&lt;</span>RACSubscriber<span class="token operator">></span> subscriber<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//1</span>
        MTModel <span class="token operator">*</span>model <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>MTModel alloc<span class="token punctuation">]</span> init<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// MTModel有一个名为的title的属性</span>
        <span class="token punctuation">[</span>subscriber sendNext<span class="token punctuation">:</span>model<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span>subscriber sendCompleted<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> nil<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>flattenMapSignal <span class="token operator">=</span> <span class="token punctuation">[</span>signal flattenMap<span class="token punctuation">:</span><span class="token operator">^</span>RACStream <span class="token operator">*</span><span class="token punctuation">(</span>MTModel <span class="token operator">*</span>model<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//2</span>
        <span class="token keyword">return</span> <span class="token function">RACObserve</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> title<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>flattenMapSignal subscribeNext<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>id x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//3</span>
        <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@"subscribeNext - %@"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>上面的RACObserve会引起引用不释放的问题，通过RACObserve的定义来看看，里面会对self进行持有。</p>
<pre class="line-numbers language-objectivec" data-language="objectivec"><code class="language-objectivec"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">RACObserve</span><span class="token expression"><span class="token punctuation">(</span>TARGET<span class="token punctuation">,</span> KEYPATH<span class="token punctuation">)</span> </span><span class="token punctuation">\</span>
    <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> </span><span class="token punctuation">\</span>
        <span class="token expression"><span class="token function">_Pragma</span><span class="token punctuation">(</span></span><span class="token string">"clang diagnostic push"</span><span class="token expression"><span class="token punctuation">)</span> </span><span class="token punctuation">\</span>
        <span class="token expression"><span class="token function">_Pragma</span><span class="token punctuation">(</span></span><span class="token string">"clang diagnostic ignored \"-Wreceiver-is-weak\""</span><span class="token expression"><span class="token punctuation">)</span> </span><span class="token punctuation">\</span>
        <span class="token expression">__weak id target_ <span class="token operator">=</span> <span class="token punctuation">(</span>TARGET<span class="token punctuation">)</span><span class="token punctuation">;</span> </span><span class="token punctuation">\</span>
        <span class="token expression"><span class="token punctuation">[</span>target_ rac_valuesForKeyPath<span class="token punctuation">:</span><span class="token operator">@</span><span class="token function">keypath</span><span class="token punctuation">(</span>TARGET<span class="token punctuation">,</span> KEYPATH<span class="token punctuation">)</span> observer<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">]</span><span class="token punctuation">;</span> </span><span class="token punctuation">\</span>
        <span class="token expression"><span class="token function">_Pragma</span><span class="token punctuation">(</span></span><span class="token string">"clang diagnostic pop"</span><span class="token expression"><span class="token punctuation">)</span> </span><span class="token punctuation">\</span>
    <span class="token expression"><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Subject"><a href="#Subject" class="headerlink" title="Subject"></a>Subject</h2><p>对subject进行map这样的操作，这时就需要sendCompleted</p>
<pre class="line-numbers language-objectivec" data-language="objectivec"><code class="language-objectivec"><span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>viewDidLoad <span class="token punctuation">&#123;</span>
    <span class="token punctuation">[</span><span class="token keyword">super</span> viewDidLoad<span class="token punctuation">]</span><span class="token punctuation">;</span>
    RACSubject <span class="token operator">*</span>subject <span class="token operator">=</span> <span class="token punctuation">[</span>RACSubject subject<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span>subject<span class="token punctuation">.</span>rac_willDeallocSignal subscribeCompleted<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">&#123;</span>
        <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@"subject dealloc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token punctuation">[</span><span class="token punctuation">[</span>subject map<span class="token punctuation">:</span><span class="token operator">^</span><span class="token function">id</span><span class="token punctuation">(</span>NSNumber <span class="token operator">*</span>value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token operator">@</span><span class="token punctuation">(</span><span class="token punctuation">[</span>value integerValue<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">]</span> subscribeNext<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>id x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@"next = %@"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span>subject sendNext<span class="token punctuation">:</span><span class="token operator">@</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>但是为什么signal进行map操作，不sendCompleted而不会内存泄漏呢。因为调到bind的比如map、filter、merge、combineLatest、flattenMap等操作如果是RACSubject这样会持有订阅者的信号会产生内存泄漏需要sendCompleted。可以先看看bind的实现</p>
<pre class="line-numbers language-objectivec" data-language="objectivec"><code class="language-objectivec"><span class="token operator">-</span> <span class="token punctuation">(</span>RACSignal <span class="token operator">*</span><span class="token punctuation">)</span>bind<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token function">RACStreamBindBlock</span> <span class="token punctuation">(</span><span class="token operator">^</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">)</span>block <span class="token punctuation">&#123;</span>
    <span class="token function">NSCParameterAssert</span><span class="token punctuation">(</span>block <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/*
     * -bind: should:
     *
     * 1. Subscribe to the original signal of values.
     * 2. Any time the original signal sends a value, transform it using the binding block.
     * 3. If the binding block returns a signal, subscribe to it, and pass all of its values through to the subscriber as they're received.
     * 4. If the binding block asks the bind to terminate, complete the _original_ signal.
     * 5. When _all_ signals complete, send completed to the subscriber.
     *
     * If any signal sends an error at any point, send that to the subscriber.
     */</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>RACSignal createSignal<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>id<span class="token operator">&lt;</span>RACSubscriber<span class="token operator">></span> subscriber<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        RACStreamBindBlock bindingBlock <span class="token operator">=</span> <span class="token function">block</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        NSMutableArray <span class="token operator">*</span>signals <span class="token operator">=</span> <span class="token punctuation">[</span>NSMutableArray arrayWithObject<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// 此处省略了80行代码</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">]</span> setNameWithFormat<span class="token punctuation">:</span><span class="token string">@"[%@] -bind:"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>didSubscribe的开头，就创建了一个数组signals，并且持有了self，也就是源信号，也就是订阅者持有了信号，如果是Subject那么这种信号又会持有订阅者，这样就形成了循环引用。</p>
<p>下面看看sendCompleted如何修复的内存泄漏</p>
<pre class="line-numbers language-objectivec" data-language="objectivec"><code class="language-objectivec"><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">^</span>completeSignal<span class="token punctuation">)</span><span class="token punctuation">(</span>RACSignal <span class="token operator">*</span><span class="token punctuation">,</span> RACDisposable <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">^</span><span class="token punctuation">(</span>RACSignal <span class="token operator">*</span>signal<span class="token punctuation">,</span> RACDisposable <span class="token operator">*</span>finishedDisposable<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    BOOL removeDisposable <span class="token operator">=</span> NO<span class="token punctuation">;</span>
    <span class="token operator">@</span><span class="token function">synchronized</span> <span class="token punctuation">(</span>signals<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token punctuation">[</span>signals removeObject<span class="token punctuation">:</span>signal<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//1</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>signals<span class="token punctuation">.</span>count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token punctuation">[</span>subscriber sendCompleted<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//2</span>
            <span class="token punctuation">[</span>compoundDisposable dispose<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//3</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            removeDisposable <span class="token operator">=</span> YES<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>removeDisposable<span class="token punctuation">)</span> <span class="token punctuation">[</span>compoundDisposable removeDisposable<span class="token punctuation">:</span>finishedDisposable<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//4</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>从signals这个数组中移除传入的signal，也就是让订阅的signal不会持有subject这种信号。</p>
<p>还有replay这样的操作，因为这个方法返回的是一个RACReplaySubject</p>
<pre class="line-numbers language-objectivec" data-language="objectivec"><code class="language-objectivec">RACSignal <span class="token operator">*</span>signal <span class="token operator">=</span> <span class="token punctuation">[</span>RACSignal createSignal<span class="token punctuation">:</span><span class="token operator">^</span>RACDisposable <span class="token operator">*</span><span class="token punctuation">(</span>id<span class="token operator">&lt;</span>RACSubscriber<span class="token operator">></span> subscriber<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token punctuation">[</span>subscriber sendNext<span class="token punctuation">:</span><span class="token operator">@</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span>subscriber sendCompleted<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 保证源信号发送完成</span>
    <span class="token keyword">return</span> nil<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

RACSignal <span class="token operator">*</span>replaySignal <span class="token operator">=</span> <span class="token punctuation">[</span>signal replay<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 这里返回的其实是一个RACReplaySubject</span>

<span class="token punctuation">[</span><span class="token punctuation">[</span>replaySignal map<span class="token punctuation">:</span><span class="token operator">^</span><span class="token function">id</span><span class="token punctuation">(</span>NSNumber <span class="token operator">*</span>value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token operator">@</span><span class="token punctuation">(</span><span class="token punctuation">[</span>value integerValue<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">]</span> subscribeNext<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>id x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@"subscribeNext - %@"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="热信号冷信号"><a href="#热信号冷信号" class="headerlink" title="热信号冷信号"></a>热信号冷信号</h1><ul>
<li>热信号是主动的，不订阅也能够按时发送。冷信号是被动的，只有订阅才会发送。</li>
<li>热信号可以有多个订阅者。冷信号只能够一对一，有不同订阅者，消息会从新完整发送。</li>
</ul>
<h1 id="RAC的API手册"><a href="#RAC的API手册" class="headerlink" title="RAC的API手册"></a>RAC的API手册</h1><h2 id="常见类"><a href="#常见类" class="headerlink" title="常见类"></a>常见类</h2><h3 id="RACSiganl-信号类。"><a href="#RACSiganl-信号类。" class="headerlink" title="RACSiganl 信号类。"></a>RACSiganl 信号类。</h3><ul>
<li>RACEmptySignal ：空信号，用来实现 RACSignal 的 +empty 方法；</li>
<li>RACReturnSignal ：一元信号，用来实现 RACSignal 的 +return: 方法；</li>
<li>RACDynamicSignal ：动态信号，使用一个 block - 来实现订阅行为，我们在使用 RACSignal 的 +createSignal: 方法时创建的就是该类的实例；</li>
<li>RACErrorSignal ：错误信号，用来实现 RACSignal 的 +error: 方法；</li>
<li>RACChannelTerminal ：通道终端，代表 RACChannel 的一个终端，用来实现双向绑定。</li>
</ul>
<h3 id="RACSubscriber-订阅者"><a href="#RACSubscriber-订阅者" class="headerlink" title="RACSubscriber 订阅者"></a>RACSubscriber 订阅者</h3><h3 id="RACDisposable-用于取消订阅或者清理资源，当信号发送完成或者发送错误的时候，就会自动触发它。"><a href="#RACDisposable-用于取消订阅或者清理资源，当信号发送完成或者发送错误的时候，就会自动触发它。" class="headerlink" title="RACDisposable 用于取消订阅或者清理资源，当信号发送完成或者发送错误的时候，就会自动触发它。"></a>RACDisposable 用于取消订阅或者清理资源，当信号发送完成或者发送错误的时候，就会自动触发它。</h3><ul>
<li>RACSerialDisposable ：作为 disposable 的容器使用，可以包含一个 disposable 对象，并且允许将这个 disposable 对象通过原子操作交换出来；</li>
<li>RACKVOTrampoline ：代表一次 KVO 观察，并且可以用来停止观察；</li>
<li>RACCompoundDisposable ：它可以包含多个 disposable 对象，并且支持手动添加和移除 disposable 对象</li>
<li>RACScopedDisposable ：当它被 dealloc 的时候调用本身的 -dispose 方法。</li>
</ul>
<h3 id="RACSubject-信号提供者，自己可以充当信号，又能发送信号。订阅后发送"><a href="#RACSubject-信号提供者，自己可以充当信号，又能发送信号。订阅后发送" class="headerlink" title="RACSubject 信号提供者，自己可以充当信号，又能发送信号。订阅后发送"></a>RACSubject 信号提供者，自己可以充当信号，又能发送信号。订阅后发送</h3><ul>
<li>RACGroupedSignal ：分组信号，用来实现 RACSignal 的分组功能；</li>
<li>RACBehaviorSubject ：重演最后值的信号，当被订阅时，会向订阅者发送它最后接收到的值；</li>
<li>RACReplaySubject ：重演信号，保存发送过的值，当被订阅时，会向订阅者重新发送这些值。可以先发送后订阅</li>
</ul>
<h3 id="RACTuple-元组类-类似NSArray-用来包装值"><a href="#RACTuple-元组类-类似NSArray-用来包装值" class="headerlink" title="RACTuple 元组类,类似NSArray,用来包装值."></a>RACTuple 元组类,类似NSArray,用来包装值.</h3><h3 id="RACSequence-RAC中的集合类"><a href="#RACSequence-RAC中的集合类" class="headerlink" title="RACSequence RAC中的集合类"></a>RACSequence RAC中的集合类</h3><h3 id="RACCommand-RAC中用于处理事件的类，可以把事件如何处理-事件中的数据如何传递，包装到这个类中，他可以很方便的监控事件的执行过程。"><a href="#RACCommand-RAC中用于处理事件的类，可以把事件如何处理-事件中的数据如何传递，包装到这个类中，他可以很方便的监控事件的执行过程。" class="headerlink" title="RACCommand RAC中用于处理事件的类，可以把事件如何处理,事件中的数据如何传递，包装到这个类中，他可以很方便的监控事件的执行过程。"></a>RACCommand RAC中用于处理事件的类，可以把事件如何处理,事件中的数据如何传递，包装到这个类中，他可以很方便的监控事件的执行过程。</h3><h3 id="RACMulticastConnection-用于当一个信号，被多次订阅时，为了保证创建信号时，避免多次调用创建信号中的block，造成副作用，可以使用这个类处理。"><a href="#RACMulticastConnection-用于当一个信号，被多次订阅时，为了保证创建信号时，避免多次调用创建信号中的block，造成副作用，可以使用这个类处理。" class="headerlink" title="RACMulticastConnection 用于当一个信号，被多次订阅时，为了保证创建信号时，避免多次调用创建信号中的block，造成副作用，可以使用这个类处理。"></a>RACMulticastConnection 用于当一个信号，被多次订阅时，为了保证创建信号时，避免多次调用创建信号中的block，造成副作用，可以使用这个类处理。</h3><h3 id="RACScheduler-RAC中的队列，用GCD封装的。"><a href="#RACScheduler-RAC中的队列，用GCD封装的。" class="headerlink" title="RACScheduler RAC中的队列，用GCD封装的。"></a>RACScheduler RAC中的队列，用GCD封装的。</h3><ul>
<li>RACImmediateScheduler ：立即执行调度的任务，这是唯一一个支持同步执行的调度器；</li>
<li>RACQueueScheduler ：一个抽象的队列调度器，在一个 GCD 串行列队中异步调度所有任务；</li>
<li>RACTargetQueueScheduler ：继承自 RACQueueScheduler ，在一个以一个任意的 GCD 队列为 target 的串行队列中异步调度所有任务；</li>
<li>RACSubscriptionScheduler ：一个只用来调度订阅的调度器。</li>
</ul>
<h2 id="常见用法"><a href="#常见用法" class="headerlink" title="常见用法"></a>常见用法</h2><ul>
<li>rac_signalForSelector : 代替代理</li>
<li>rac_valuesAndChangesForKeyPath: KVO</li>
<li>rac_signalForControlEvents:监听事件</li>
<li>rac_addObserverForName 代替通知</li>
<li>rac_textSignal：监听文本框文字改变</li>
<li>rac_liftSelector:withSignalsFromArray:Signals:当传入的Signals(信号数组)，每一个signal都至少sendNext过一次，就会去触发第一个selector参数的方法。</li>
</ul>
<h2 id="常见宏"><a href="#常见宏" class="headerlink" title="常见宏"></a>常见宏</h2><ul>
<li>RAC(TARGET, [KEYPATH, [NIL_VALUE]])：用于给某个对象的某个属性绑定</li>
<li>RACObserve(self, name) ：监听某个对象的某个属性,返回的是信号。</li>
<li>@weakify(Obj)和@strongify(Obj)</li>
<li>RACTuplePack ：把数据包装成RACTuple（元组类）</li>
<li>RACTupleUnpack：把RACTuple（元组类）解包成对应的数据</li>
<li>RACChannelTo 用于双向绑定的一个终端</li>
</ul>
<h2 id="常用操作方法"><a href="#常用操作方法" class="headerlink" title="常用操作方法"></a>常用操作方法</h2><ul>
<li>flattenMap map 用于把源信号内容映射成新的内容。</li>
<li>concat 组合 按一定顺序拼接信号，当多个信号发出的时候，有顺序的接收信号</li>
<li>then 用于连接两个信号，当第一个信号完成，才会连接then返回的信号。</li>
<li>merge 把多个信号合并为一个信号，任何一个信号有新值的时候就会调用</li>
<li>zipWith 把两个信号压缩成一个信号，只有当两个信号同时发出信号内容时，并且把两个信号的内容合并成一个元组，才会触发压缩流的next事件。</li>
<li>combineLatest:将多个信号合并起来，并且拿到各个信号的最新的值,必须每个合并的signal至少都有过一次sendNext，才会触发合并的信号。</li>
<li>reduce聚合:用于信号发出的内容是元组，把信号发出元组的值聚合成一个值</li>
<li>filter:过滤信号，使用它可以获取满足条件的信号.</li>
<li>ignore:忽略完某些值的信号.</li>
<li>distinctUntilChanged:当上一次的值和当前的值有明显的变化就会发出信号，否则会被忽略掉。</li>
<li>take:从开始一共取N次的信号</li>
<li>takeLast:取最后N次的信号,前提条件，订阅者必须调用完成，因为只有完成，就知道总共有多少信号.</li>
<li>takeUntil:(RACSignal *):获取信号直到某个信号执行完成</li>
<li>skip:(NSUInteger):跳过几个信号,不接受。</li>
<li>switchToLatest:用于signalOfSignals（信号的信号），有时候信号也会发出信号，会在signalOfSignals中，获取signalOfSignals发送的最新信号。</li>
<li>doNext: 执行Next之前，会先执行这个Block</li>
<li>doCompleted: 执行sendCompleted之前，会先执行这个Block</li>
<li>timeout：超时，可以让一个信号在一定的时间后，自动报错。</li>
<li>interval 定时：每隔一段时间发出信号</li>
<li>delay 延迟发送next。</li>
<li>retry重试 ：只要失败，就会重新执行创建信号中的block,直到成功.</li>
<li>replay重放：当一个信号被多次订阅,反复播放内容</li>
<li>throttle节流:当某个信号发送比较频繁时，可以使用节流，在某一段时间不发送信号内容，过了一段时间获取信号的最新内容发出。</li>
</ul>
<h2 id="UI-Category（常用汇总）"><a href="#UI-Category（常用汇总）" class="headerlink" title="UI - Category（常用汇总）"></a>UI - Category（常用汇总）</h2><h3 id="rac-prepareForReuseSignal：-需要复用时用"><a href="#rac-prepareForReuseSignal：-需要复用时用" class="headerlink" title="rac_prepareForReuseSignal： 需要复用时用"></a>rac_prepareForReuseSignal： 需要复用时用</h3><ul>
<li>相关UI: MKAnnotationView、UICollectionReusableView、UITableViewCell、UITableViewHeaderFooterView</li>
</ul>
<h3 id="rac-buttonClickedSignal：点击事件触发信号"><a href="#rac-buttonClickedSignal：点击事件触发信号" class="headerlink" title="rac_buttonClickedSignal：点击事件触发信号"></a>rac_buttonClickedSignal：点击事件触发信号</h3><ul>
<li>相关UI：UIActionSheet、UIAlertView</li>
</ul>
<h3 id="rac-command：button类、刷新类相关命令替换"><a href="#rac-command：button类、刷新类相关命令替换" class="headerlink" title="rac_command：button类、刷新类相关命令替换"></a>rac_command：button类、刷新类相关命令替换</h3><ul>
<li>相关UI：UIBarButtonItem、UIButton、UIRefreshControl</li>
</ul>
<h3 id="rac-signalForControlEvents-control-event-触发"><a href="#rac-signalForControlEvents-control-event-触发" class="headerlink" title="rac_signalForControlEvents: control event 触发"></a>rac_signalForControlEvents: control event 触发</h3><ul>
<li>相关UI：UIControl</li>
</ul>
<h3 id="rac-gestureSignal-UIGestureRecognizer-事件处理信号"><a href="#rac-gestureSignal-UIGestureRecognizer-事件处理信号" class="headerlink" title="rac_gestureSignal UIGestureRecognizer 事件处理信号"></a>rac_gestureSignal UIGestureRecognizer 事件处理信号</h3><ul>
<li>相关UI：UIGestureRecognizer</li>
</ul>
<h3 id="rac-imageSelectedSignal-选择图片的信号"><a href="#rac-imageSelectedSignal-选择图片的信号" class="headerlink" title="rac_imageSelectedSignal 选择图片的信号"></a>rac_imageSelectedSignal 选择图片的信号</h3><ul>
<li>相关UI：UIImagePickerController</li>
</ul>
<h3 id="rac-textSignal"><a href="#rac-textSignal" class="headerlink" title="rac_textSignal"></a>rac_textSignal</h3><ul>
<li>相关UI：UITextField、UITextView</li>
</ul>
<h3 id="可实现双向绑定的相关API"><a href="#可实现双向绑定的相关API" class="headerlink" title="可实现双向绑定的相关API"></a>可实现双向绑定的相关API</h3><ul>
<li>rac_channelForControlEvents: key: nilValue:</li>
<li>相关UI：UIControl类</li>
<li>rac_newDateChannelWithNilValue:</li>
<li>相关UI：UIDatePicker</li>
<li>rac_newSelectedSegmentIndexChannelWithNilValue:</li>
<li>相关UI：UISegmentedControl</li>
<li>rac_newValueChannelWithNilValue:</li>
<li>相关UI：UISlider、UIStepper</li>
<li>rac_newOnChannel</li>
<li>相关UI：UISwitch</li>
<li>rac_newTextChannel</li>
<li>相关UI：UITextField</li>
</ul>
<h2 id="Foundation-Category-（常用汇总）"><a href="#Foundation-Category-（常用汇总）" class="headerlink" title="Foundation - Category （常用汇总）"></a>Foundation - Category （常用汇总）</h2><h3 id="NSData"><a href="#NSData" class="headerlink" title="NSData"></a>NSData</h3><ul>
<li>rac_readContentsOfURL: options: scheduler: 比oc多出线程设置</li>
</ul>
<h3 id="NSDictionary"><a href="#NSDictionary" class="headerlink" title="NSDictionary"></a>NSDictionary</h3><ul>
<li>rac_sequence</li>
<li>rac_keySequence key 集合</li>
<li>rac_valueSequence value 集合</li>
</ul>
<h3 id="NSArray"><a href="#NSArray" class="headerlink" title="NSArray"></a>NSArray</h3><ul>
<li>rac_sequence 信号集合</li>
</ul>
<h3 id="NSFileHandle"><a href="#NSFileHandle" class="headerlink" title="NSFileHandle"></a>NSFileHandle</h3><ul>
<li>rac_readInBackground 后台线程读取</li>
</ul>
<h3 id="NSInvocation"><a href="#NSInvocation" class="headerlink" title="NSInvocation"></a>NSInvocation</h3><ul>
<li>rac_setArgument: atIndex: 设置参数</li>
<li>rac_argumentAtIndex 取某个参数</li>
<li>rac_returnValue 所关联方法的返回值</li>
</ul>
<h3 id="NSNotificationCenter"><a href="#NSNotificationCenter" class="headerlink" title="NSNotificationCenter"></a>NSNotificationCenter</h3><ul>
<li>rac_addObserverForName: object:注册通知</li>
</ul>
<h3 id="NSObject"><a href="#NSObject" class="headerlink" title="NSObject"></a>NSObject</h3><ul>
<li>rac_willDeallocSignal 对象销毁时发动的信号</li>
<li>rac_description debug用</li>
<li>rac_observeKeyPath: options: observer: block:监听某个事件</li>
<li>rac_liftSelector: withSignals: 全部信号都next在执行</li>
<li>rac_signalForSelector: 代替某个方法</li>
<li>rac_signalForSelector:(SEL)selector fromProtocol:代替代理</li>
</ul>
<h3 id="NSString"><a href="#NSString" class="headerlink" title="NSString"></a>NSString</h3><ul>
<li>rac_keyPathComponents 获取一个路径所有的部分</li>
<li>rac_keyPathByDeletingLastKeyPathComponent 删除路径最后一部分</li>
<li>rac_keyPathByDeletingFirstKeyPathComponent 删除路径第一部分</li>
<li>rac_readContentsOfURL: usedEncoding: scheduler: 比之OC多线程调用</li>
<li>rac_sequence</li>
</ul>
<h3 id="NSURLConnection"><a href="#NSURLConnection" class="headerlink" title="NSURLConnection"></a>NSURLConnection</h3><ul>
<li>rac_sendAsynchronousRequest 发起异步请求</li>
</ul>
<h3 id="NSUserDefaults"><a href="#NSUserDefaults" class="headerlink" title="NSUserDefaults"></a>NSUserDefaults</h3><ul>
<li>rac_channelTerminalForKey 用于双向绑定，此乃一</li>
</ul>
<h3 id="NSEnumerator"><a href="#NSEnumerator" class="headerlink" title="NSEnumerator"></a>NSEnumerator</h3><ul>
<li>rac_sequence</li>
</ul>
<h3 id="NSIndexSet"><a href="#NSIndexSet" class="headerlink" title="NSIndexSet"></a>NSIndexSet</h3><ul>
<li>rac_sequence</li>
</ul>
<h3 id="NSOrderedSet"><a href="#NSOrderedSet" class="headerlink" title="NSOrderedSet"></a>NSOrderedSet</h3><ul>
<li>rac_sequence</li>
</ul>
<h3 id="NSSet"><a href="#NSSet" class="headerlink" title="NSSet"></a>NSSet</h3><ul>
<li>rac_sequence</li>
</ul>
<h1 id="RAC图片版的API手册"><a href="#RAC图片版的API手册" class="headerlink" title="RAC图片版的API手册"></a>RAC图片版的API手册</h1><h2 id="ReactiveCocoa-objectivec"><a href="#ReactiveCocoa-objectivec" class="headerlink" title="ReactiveCocoa objectivec"></a>ReactiveCocoa objectivec</h2><p><img src="https://github.com/ming1016/study/blob/master/pic/ReactiveCocoaOC.png?raw=true" alt="ReactiveCocoaobjectivec" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://github.com/ming1016/study/blob/master/pic/ReactiveCocoaOC.png?raw=true" class="lozad post-image"></p>
<h2 id="ReactiveCocoa-Swift"><a href="#ReactiveCocoa-Swift" class="headerlink" title="ReactiveCocoa Swift"></a>ReactiveCocoa Swift</h2><p><img src="https://github.com/ming1016/study/blob/master/pic/ReactiveCocoaSwift.png?raw=true" alt="ReactiveCocoaSwift" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://github.com/ming1016/study/blob/master/pic/ReactiveCocoaSwift.png?raw=true" class="lozad post-image"></p>
<h2 id="RXSwift"><a href="#RXSwift" class="headerlink" title="RXSwift"></a>RXSwift</h2><p><img src="https://github.com/ming1016/study/blob/master/pic/RXSwift.png?raw=true" alt="RXSwift" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://github.com/ming1016/study/blob/master/pic/RXSwift.png?raw=true" class="lozad post-image"></p>
<h1 id="本文参考整理自"><a href="#本文参考整理自" class="headerlink" title="本文参考整理自"></a>本文参考整理自</h1><ul>
<li>ReactiveCocoa Tutorial – The Definitive Introduction: Part 1&#x2F;2 <a target="_blank" rel="noopener" href="https://www.raywenderlich.com/62699/reactivecocoa-tutorial-pt1">https://www.raywenderlich.com/62699/reactivecocoa-tutorial-pt1</a></li>
<li>ReactiveCocoa Tutorial – The Definitive Introduction: Part 2&#x2F;2 <a target="_blank" rel="noopener" href="https://www.raywenderlich.com/62796/reactivecocoa-tutorial-pt2">https://www.raywenderlich.com/62796/reactivecocoa-tutorial-pt2</a></li>
<li>iOS的函数响应型编程 <a target="_blank" rel="noopener" href="https://www.gitbook.com/book/kevinhm/functionalreactiveprogrammingonios/details">https://www.gitbook.com/book/kevinhm/functionalreactiveprogrammingonios/details</a></li>
<li>ReactiveCocoa Essentials: Understanding and Using RACCommand <a target="_blank" rel="noopener" href="http://codeblog.shape.dk/blog/2013/12/05/reactivecocoa-essentials-understanding-and-using-raccommand/">http://codeblog.shape.dk/blog/2013/12/05/reactivecocoa-essentials-understanding-and-using-raccommand/</a></li>
<li>iOS ReactiveCocoa 最全常用API整理（可做为手册查询）<a target="_blank" rel="noopener" href="http://www.cocoachina.com/ios/20160729/17236.html">http://www.cocoachina.com/ios/20160729/17236.html</a></li>
<li>ReactiveCocoa和RXSwift速查表 <a target="_blank" rel="noopener" href="http://valiantcat.com/2016/07/22/ReactiveCocoa%E5%92%8CRXSwift%E9%80%9F%E6%9F%A5%E8%A1%A8/">http://valiantcat.com/2016/07/22/ReactiveCocoa和RXSwift速查表/</a></li>
<li>ReactiveCocoa中潜在的内存泄漏及解决方案<a target="_blank" rel="noopener" href="http://tech.meituan.com/potential-memory-leak-in-reactivecocoa.html?from=timeline&amp;isappinstalled=0">http://tech.meituan.com/potential-memory-leak-in-reactivecocoa.html?from=timeline&amp;isappinstalled=0</a></li>
</ul>

  </div>
  <div>
  
  <div class="post-note note-warning copyright" style="margin-top: 42px">
    <p><span style="font-weight: bold;">作者：</span><a target="_blank" rel="nofollow noopener noreferrer" href="https://starming.com/about">戴铭</a></p>
    <p><span style="font-weight: bold;">文章链接：</span><a target="_blank" rel="nofollow noopener noreferrer" href="https://starming.com/2016/08/09/how-to-use-reactivecocoa/">https://starming.com/2016/08/09/how-to-use-reactivecocoa/</a></p>
    <p><span style="font-weight: bold;">版权声明：</span>本博客所有文章除特别声明外，均采用<a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0 协议</a>。转载请注明出处！</p>
  </div>
  
  </div>
</article>
<div class="nav">
  
  <div class="nav-item-prev">
    <a href="/2016/09/02/develop-rss-reader/" class="nav-link">
      <i class="iconfont icon-left nav-prev-icon"></i>
      <div>
        <div class="nav-label">Prev</div>
        
        <div class="nav-title">使用ReactiveCocoa开发RSS阅读器 </div>
        
      </div>
    </a>
  </div>
  
  
  <div class="nav-item-next">
    <a href="/2016/07/21/assembleview/" class="nav-link">
      <div>
        <div class="nav-label">Next</div>
        
        <div class="nav-title">制作一个类似苹果VFL(Visual Format Language)的格式化语言来描述类似UIStackView那种布局思路，并解析生成页面 </div>
        
      </div>
      <i class="iconfont icon-right nav-next-icon"></i>
    </a>
  </div>
  
</div>

<div class="card card-content toc-card" id="mobiletoc">
  <div class="toc-header"><i class="iconfont icon-menu" style="padding-right: 2px;"></i>TOC</div>
<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E%E5%BC%8F%E7%BC%96%E7%A8%8B%E6%B3%9B%E5%9E%8BDeclarative-programming"><span class="toc-number">1.</span> <span class="toc-text">声明式编程泛型Declarative programming</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0"><span class="toc-number">2.</span> <span class="toc-text">高阶函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%A0%E5%B0%84map"><span class="toc-number">2.1.</span> <span class="toc-text">映射map</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4filter"><span class="toc-number">2.2.</span> <span class="toc-text">过滤filter</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%98%E5%8F%A0fold"><span class="toc-number">2.3.</span> <span class="toc-text">折叠fold</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Currying"><span class="toc-number">2.4.</span> <span class="toc-text">Currying</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RAC%E4%B8%AD%E4%BD%BF%E7%94%A8%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0"><span class="toc-number">3.</span> <span class="toc-text">RAC中使用高阶函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%A0%E5%B0%84"><span class="toc-number">3.1.</span> <span class="toc-text">映射</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4"><span class="toc-number">3.2.</span> <span class="toc-text">过滤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%98%E5%8F%A0"><span class="toc-number">3.3.</span> <span class="toc-text">折叠</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%91%E5%AE%9A%E9%94%AE%E5%80%BC"><span class="toc-number">3.4.</span> <span class="toc-text">绑定键值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E8%B7%B5"><span class="toc-number">3.5.</span> <span class="toc-text">实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E7%94%9F%E6%88%90%E5%AF%B9%E5%BA%94model"><span class="toc-number">3.5.1.</span> <span class="toc-text">网络请求生成对应model</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E7%9B%B8%E5%90%8C%E5%A4%A7%E5%B0%8F%E7%9A%84%E5%9B%BE%E7%89%87%EF%BC%8C%E5%8F%96%E5%87%BA%E4%BB%96%E4%BB%AC%E7%9A%84url%EF%BC%8C%E8%BF%94%E5%9B%9E%E7%AC%AC%E4%B8%80%E4%B8%AA"><span class="toc-number">3.5.2.</span> <span class="toc-text">过滤相同大小的图片，取出他们的url，返回第一个</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%82%E5%AF%9Fmodel%E9%87%8C%E7%9A%84%E5%9B%BE%E7%89%87%E6%95%B0%E6%8D%AE%EF%BC%8C%E8%BF%9B%E8%A1%8C%E4%B8%BA%E7%A9%BA%E8%BF%87%E6%BB%A4%E5%88%A4%E6%96%AD%EF%BC%8C%E5%B0%86data%E8%BD%AC%E4%B8%BAUIImage%EF%BC%8C%E5%86%8D%E6%8A%8A%E7%BB%91%E5%AE%9A%E6%96%B0%E4%BF%A1%E5%8F%B7%E7%9A%84%E5%80%BC%E7%BB%99%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%85%B3%E9%94%AE%E8%B7%AF%E5%BE%84"><span class="toc-number">3.5.3.</span> <span class="toc-text">观察model里的图片数据，进行为空过滤判断，将data转为UIImage，再把绑定新信号的值给对象的关键路径</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UITableViewCell%E5%A4%8D%E7%94%A8%E6%97%B6%E9%9C%80%E8%A6%81%E5%8F%96%E6%B6%88cell%E4%B8%8A%E5%90%84%E4%B8%AA%E7%BB%84%E4%BB%B6%E7%9A%84%E8%AE%A2%E9%98%85"><span class="toc-number">3.5.4.</span> <span class="toc-text">UITableViewCell复用时需要取消cell上各个组件的订阅</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Delegate%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">3.5.5.</span> <span class="toc-text">Delegate的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8%EF%BC%8C%E5%AE%8C%E6%88%90%E6%89%A7%E8%A1%8C%E5%88%B7%E6%96%B0%E6%93%8D%E4%BD%9C%EF%BC%8C%E5%BC%82%E5%B8%B8%E6%89%93%E5%8D%B0%E6%97%A5%E5%BF%97%EF%BC%8C%E6%89%A7%E8%A1%8C%E5%AF%B9%E5%BA%94%E6%96%B9%E6%B3%95"><span class="toc-number">3.5.6.</span> <span class="toc-text">处理异常，完成执行刷新操作，异常打印日志，执行对应方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86%E6%95%B0%E6%8D%AE%EF%BC%8C%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E8%BF%94%E5%9B%9E%E4%B8%BB%E7%BA%BF%E7%A8%8B"><span class="toc-number">3.5.7.</span> <span class="toc-text">网络请求处理数据，获取数据返回主线程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%A1%E5%8F%B7%E7%9A%84%E4%BF%A1%E5%8F%B7Signal-of-signals%EF%BC%8C%E4%B8%80%E4%B8%AA%E5%A4%96%E9%83%A8%E4%BF%A1%E5%8F%B7%E5%8C%85%E5%90%AB%E4%B8%80%E4%B8%AA%E5%86%85%E9%83%A8%E4%BF%A1%E5%8F%B7%EF%BC%8C%E5%9C%A8%E8%BE%93%E5%87%BA%E4%BF%A1%E5%8F%B7%E7%9A%84subscribeNext-%E5%9D%97%E4%B8%AD%E8%AE%A2%E9%98%85%E5%86%85%E9%83%A8%E4%BF%A1%E5%8F%B7%EF%BC%8C%E4%BC%9A%E5%BC%95%E8%B5%B7%E5%B5%8C%E5%A5%97%E9%BA%BB%E7%83%A6%E3%80%82%E4%BD%BF%E7%94%A8flattenMap%E5%90%8E%E4%BC%9A%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E4%BF%A1%E5%8F%B7%EF%BC%8C%E5%92%8C%E5%85%88%E5%89%8D%E4%BF%A1%E5%8F%B7%E5%B9%B3%E7%BA%A7%EF%BC%8C%E8%AE%A2%E9%98%85%E4%BC%9A%E8%AE%A2%E9%98%85%E5%88%B0%E8%BF%94%E5%9B%9E%E7%9A%84%E6%96%B0%E4%BF%A1%E5%8F%B7%E9%87%8C%E7%9A%84%E5%80%BC%E3%80%82map%E6%96%B9%E6%B3%95%E4%B9%9F%E6%98%AF%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%B0%E4%BF%A1%E5%8F%B7%EF%BC%8C%E4%BD%86%E6%98%AF%E4%BC%9A%E5%B0%86%E8%BF%94%E5%9B%9E%E7%9A%84%E4%BF%A1%E5%8F%B7%E4%B9%9F%E5%BD%93%E5%81%9A%E5%80%BC%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%B0%B1%E5%BE%97%E4%B8%8D%E5%88%B0%E7%9C%9F%E6%AD%A3%E9%9C%80%E8%A6%81%E7%9A%84%E5%80%BC%E4%BA%86%E3%80%82"><span class="toc-number">3.5.8.</span> <span class="toc-text">信号的信号Signal of signals，一个外部信号包含一个内部信号，在输出信号的subscribeNext:块中订阅内部信号，会引起嵌套麻烦。使用flattenMap后会生成一个新的信号，和先前信号平级，订阅会订阅到返回的新信号里的值。map方法也是创建一个新信号，但是会将返回的信号也当做值，这样就得不到真正需要的值了。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%90%8C%E4%BF%A1%E5%8F%B7%E9%A1%BA%E5%BA%8F%E9%93%BE%E6%8E%A5%EF%BC%8C%E7%A8%8B%E5%BA%8F%E9%9C%80%E8%A6%81%E7%AD%89%E5%BE%85%E5%89%8D%E4%B8%80%E4%B8%AA%E4%BF%A1%E5%8F%B7%E5%8F%91%E5%87%BA%E5%AE%8C%E6%88%90%E4%BA%8B%E4%BB%B6%EF%BC%88sendCompleted%EF%BC%89%EF%BC%8C%E7%84%B6%E5%90%8E%E5%86%8D%E8%AE%A2%E9%98%85%E4%B8%8B%E4%B8%80%E4%B8%AA%E4%BF%A1%E5%8F%B7%EF%BC%88then%EF%BC%89"><span class="toc-number">3.5.9.</span> <span class="toc-text">不同信号顺序链接，程序需要等待前一个信号发出完成事件（sendCompleted），然后再订阅下一个信号（then）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E5%8A%A0%E8%BD%BD%E5%9B%BE%E7%89%87"><span class="toc-number">3.5.10.</span> <span class="toc-text">异步加载图片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%82%E5%AF%9FviewModel%E9%87%8C%E7%9A%84tableView%E7%9A%84%E6%95%B0%E6%8D%AE%E9%94%AE%E5%80%BC%E5%92%8C%E5%85%A8%E9%83%A8%E8%AF%BB%E5%8F%96%E9%94%AE%E5%80%BC%EF%BC%8C%E5%8F%AA%E8%A6%81%E6%9C%89%E4%B8%80%E4%B8%AA%E6%9C%89%E6%96%B0%E5%80%BC%E5%B0%B1%E4%BC%9A%E8%B0%83%E7%94%A8"><span class="toc-number">3.5.11.</span> <span class="toc-text">观察viewModel里的tableView的数据键值和全部读取键值，只要有一个有新值就会调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85hook%E6%96%B9%E6%B3%95%EF%BC%8C%E6%9F%90%E4%B8%AAselector%E8%A2%AB%E8%B0%83%E7%94%A8%E6%97%B6%EF%BC%8C%E5%86%8D%E6%89%A7%E8%A1%8C%E4%B8%80%E6%AE%B5%E6%8C%87%E5%AE%9A%E4%BB%A3%E7%A0%81%E5%92%8Chook%E4%B8%80%E6%A0%B7%E3%80%82"><span class="toc-number">3.5.12.</span> <span class="toc-text">封装hook方法，某个selector被调用时，再执行一段指定代码和hook一样。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8RACCommand%E6%9D%A5%E5%AE%9E%E7%8E%B0%E6%8C%89%E9%92%AE%E7%9A%84%E7%8A%B6%E6%80%81%E6%A0%B9%E6%8D%AE%E8%BE%93%E5%85%A5%E9%82%AE%E7%AE%B1%E5%88%A4%E6%96%AD%E9%82%AE%E7%AE%B1%E6%98%AF%E5%90%A6%E9%9D%9E%E6%B3%95%E8%BF%98%E6%9C%89%E6%8F%90%E4%BA%A4%E5%88%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%90%8E%E5%87%BA%E9%94%99%E5%A4%84%E7%90%86%E7%AD%89"><span class="toc-number">3.5.13.</span> <span class="toc-text">使用RACCommand来实现按钮的状态根据输入邮箱判断邮箱是否非法还有提交到服务器后出错处理等</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%BF%E6%8D%A2Delegate%EF%BC%8C%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8RACSubject"><span class="toc-number">3.5.14.</span> <span class="toc-text">替换Delegate，直接使用RACSubject</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RAC%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"><span class="toc-number">4.</span> <span class="toc-text">RAC内存管理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RAC%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E5%86%85%E5%AD%98%E9%97%AE%E9%A2%98"><span class="toc-number">5.</span> <span class="toc-text">RAC需要注意的内存问题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8F%E5%AE%9A%E4%B9%89"><span class="toc-number">5.1.</span> <span class="toc-text">宏定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Subject"><span class="toc-number">5.2.</span> <span class="toc-text">Subject</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%83%AD%E4%BF%A1%E5%8F%B7%E5%86%B7%E4%BF%A1%E5%8F%B7"><span class="toc-number">6.</span> <span class="toc-text">热信号冷信号</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RAC%E7%9A%84API%E6%89%8B%E5%86%8C"><span class="toc-number">7.</span> <span class="toc-text">RAC的API手册</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%B1%BB"><span class="toc-number">7.1.</span> <span class="toc-text">常见类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RACSiganl-%E4%BF%A1%E5%8F%B7%E7%B1%BB%E3%80%82"><span class="toc-number">7.1.1.</span> <span class="toc-text">RACSiganl 信号类。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RACSubscriber-%E8%AE%A2%E9%98%85%E8%80%85"><span class="toc-number">7.1.2.</span> <span class="toc-text">RACSubscriber 订阅者</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RACDisposable-%E7%94%A8%E4%BA%8E%E5%8F%96%E6%B6%88%E8%AE%A2%E9%98%85%E6%88%96%E8%80%85%E6%B8%85%E7%90%86%E8%B5%84%E6%BA%90%EF%BC%8C%E5%BD%93%E4%BF%A1%E5%8F%B7%E5%8F%91%E9%80%81%E5%AE%8C%E6%88%90%E6%88%96%E8%80%85%E5%8F%91%E9%80%81%E9%94%99%E8%AF%AF%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E5%B0%B1%E4%BC%9A%E8%87%AA%E5%8A%A8%E8%A7%A6%E5%8F%91%E5%AE%83%E3%80%82"><span class="toc-number">7.1.3.</span> <span class="toc-text">RACDisposable 用于取消订阅或者清理资源，当信号发送完成或者发送错误的时候，就会自动触发它。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RACSubject-%E4%BF%A1%E5%8F%B7%E6%8F%90%E4%BE%9B%E8%80%85%EF%BC%8C%E8%87%AA%E5%B7%B1%E5%8F%AF%E4%BB%A5%E5%85%85%E5%BD%93%E4%BF%A1%E5%8F%B7%EF%BC%8C%E5%8F%88%E8%83%BD%E5%8F%91%E9%80%81%E4%BF%A1%E5%8F%B7%E3%80%82%E8%AE%A2%E9%98%85%E5%90%8E%E5%8F%91%E9%80%81"><span class="toc-number">7.1.4.</span> <span class="toc-text">RACSubject 信号提供者，自己可以充当信号，又能发送信号。订阅后发送</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RACTuple-%E5%85%83%E7%BB%84%E7%B1%BB-%E7%B1%BB%E4%BC%BCNSArray-%E7%94%A8%E6%9D%A5%E5%8C%85%E8%A3%85%E5%80%BC"><span class="toc-number">7.1.5.</span> <span class="toc-text">RACTuple 元组类,类似NSArray,用来包装值.</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RACSequence-RAC%E4%B8%AD%E7%9A%84%E9%9B%86%E5%90%88%E7%B1%BB"><span class="toc-number">7.1.6.</span> <span class="toc-text">RACSequence RAC中的集合类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RACCommand-RAC%E4%B8%AD%E7%94%A8%E4%BA%8E%E5%A4%84%E7%90%86%E4%BA%8B%E4%BB%B6%E7%9A%84%E7%B1%BB%EF%BC%8C%E5%8F%AF%E4%BB%A5%E6%8A%8A%E4%BA%8B%E4%BB%B6%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86-%E4%BA%8B%E4%BB%B6%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E5%A6%82%E4%BD%95%E4%BC%A0%E9%80%92%EF%BC%8C%E5%8C%85%E8%A3%85%E5%88%B0%E8%BF%99%E4%B8%AA%E7%B1%BB%E4%B8%AD%EF%BC%8C%E4%BB%96%E5%8F%AF%E4%BB%A5%E5%BE%88%E6%96%B9%E4%BE%BF%E7%9A%84%E7%9B%91%E6%8E%A7%E4%BA%8B%E4%BB%B6%E7%9A%84%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B%E3%80%82"><span class="toc-number">7.1.7.</span> <span class="toc-text">RACCommand RAC中用于处理事件的类，可以把事件如何处理,事件中的数据如何传递，包装到这个类中，他可以很方便的监控事件的执行过程。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RACMulticastConnection-%E7%94%A8%E4%BA%8E%E5%BD%93%E4%B8%80%E4%B8%AA%E4%BF%A1%E5%8F%B7%EF%BC%8C%E8%A2%AB%E5%A4%9A%E6%AC%A1%E8%AE%A2%E9%98%85%E6%97%B6%EF%BC%8C%E4%B8%BA%E4%BA%86%E4%BF%9D%E8%AF%81%E5%88%9B%E5%BB%BA%E4%BF%A1%E5%8F%B7%E6%97%B6%EF%BC%8C%E9%81%BF%E5%85%8D%E5%A4%9A%E6%AC%A1%E8%B0%83%E7%94%A8%E5%88%9B%E5%BB%BA%E4%BF%A1%E5%8F%B7%E4%B8%AD%E7%9A%84block%EF%BC%8C%E9%80%A0%E6%88%90%E5%89%AF%E4%BD%9C%E7%94%A8%EF%BC%8C%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E8%BF%99%E4%B8%AA%E7%B1%BB%E5%A4%84%E7%90%86%E3%80%82"><span class="toc-number">7.1.8.</span> <span class="toc-text">RACMulticastConnection 用于当一个信号，被多次订阅时，为了保证创建信号时，避免多次调用创建信号中的block，造成副作用，可以使用这个类处理。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RACScheduler-RAC%E4%B8%AD%E7%9A%84%E9%98%9F%E5%88%97%EF%BC%8C%E7%94%A8GCD%E5%B0%81%E8%A3%85%E7%9A%84%E3%80%82"><span class="toc-number">7.1.9.</span> <span class="toc-text">RACScheduler RAC中的队列，用GCD封装的。</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%94%A8%E6%B3%95"><span class="toc-number">7.2.</span> <span class="toc-text">常见用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E5%AE%8F"><span class="toc-number">7.3.</span> <span class="toc-text">常见宏</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C%E6%96%B9%E6%B3%95"><span class="toc-number">7.4.</span> <span class="toc-text">常用操作方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UI-Category%EF%BC%88%E5%B8%B8%E7%94%A8%E6%B1%87%E6%80%BB%EF%BC%89"><span class="toc-number">7.5.</span> <span class="toc-text">UI - Category（常用汇总）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#rac-prepareForReuseSignal%EF%BC%9A-%E9%9C%80%E8%A6%81%E5%A4%8D%E7%94%A8%E6%97%B6%E7%94%A8"><span class="toc-number">7.5.1.</span> <span class="toc-text">rac_prepareForReuseSignal： 需要复用时用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rac-buttonClickedSignal%EF%BC%9A%E7%82%B9%E5%87%BB%E4%BA%8B%E4%BB%B6%E8%A7%A6%E5%8F%91%E4%BF%A1%E5%8F%B7"><span class="toc-number">7.5.2.</span> <span class="toc-text">rac_buttonClickedSignal：点击事件触发信号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rac-command%EF%BC%9Abutton%E7%B1%BB%E3%80%81%E5%88%B7%E6%96%B0%E7%B1%BB%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4%E6%9B%BF%E6%8D%A2"><span class="toc-number">7.5.3.</span> <span class="toc-text">rac_command：button类、刷新类相关命令替换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rac-signalForControlEvents-control-event-%E8%A7%A6%E5%8F%91"><span class="toc-number">7.5.4.</span> <span class="toc-text">rac_signalForControlEvents: control event 触发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rac-gestureSignal-UIGestureRecognizer-%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E4%BF%A1%E5%8F%B7"><span class="toc-number">7.5.5.</span> <span class="toc-text">rac_gestureSignal UIGestureRecognizer 事件处理信号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rac-imageSelectedSignal-%E9%80%89%E6%8B%A9%E5%9B%BE%E7%89%87%E7%9A%84%E4%BF%A1%E5%8F%B7"><span class="toc-number">7.5.6.</span> <span class="toc-text">rac_imageSelectedSignal 选择图片的信号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rac-textSignal"><span class="toc-number">7.5.7.</span> <span class="toc-text">rac_textSignal</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E5%AE%9E%E7%8E%B0%E5%8F%8C%E5%90%91%E7%BB%91%E5%AE%9A%E7%9A%84%E7%9B%B8%E5%85%B3API"><span class="toc-number">7.5.8.</span> <span class="toc-text">可实现双向绑定的相关API</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Foundation-Category-%EF%BC%88%E5%B8%B8%E7%94%A8%E6%B1%87%E6%80%BB%EF%BC%89"><span class="toc-number">7.6.</span> <span class="toc-text">Foundation - Category （常用汇总）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#NSData"><span class="toc-number">7.6.1.</span> <span class="toc-text">NSData</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSDictionary"><span class="toc-number">7.6.2.</span> <span class="toc-text">NSDictionary</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSArray"><span class="toc-number">7.6.3.</span> <span class="toc-text">NSArray</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSFileHandle"><span class="toc-number">7.6.4.</span> <span class="toc-text">NSFileHandle</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSInvocation"><span class="toc-number">7.6.5.</span> <span class="toc-text">NSInvocation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSNotificationCenter"><span class="toc-number">7.6.6.</span> <span class="toc-text">NSNotificationCenter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSObject"><span class="toc-number">7.6.7.</span> <span class="toc-text">NSObject</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSString"><span class="toc-number">7.6.8.</span> <span class="toc-text">NSString</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSURLConnection"><span class="toc-number">7.6.9.</span> <span class="toc-text">NSURLConnection</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSUserDefaults"><span class="toc-number">7.6.10.</span> <span class="toc-text">NSUserDefaults</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSEnumerator"><span class="toc-number">7.6.11.</span> <span class="toc-text">NSEnumerator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSIndexSet"><span class="toc-number">7.6.12.</span> <span class="toc-text">NSIndexSet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSOrderedSet"><span class="toc-number">7.6.13.</span> <span class="toc-text">NSOrderedSet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSSet"><span class="toc-number">7.6.14.</span> <span class="toc-text">NSSet</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RAC%E5%9B%BE%E7%89%87%E7%89%88%E7%9A%84API%E6%89%8B%E5%86%8C"><span class="toc-number">8.</span> <span class="toc-text">RAC图片版的API手册</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ReactiveCocoa-objectivec"><span class="toc-number">8.1.</span> <span class="toc-text">ReactiveCocoa objectivec</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ReactiveCocoa-Swift"><span class="toc-number">8.2.</span> <span class="toc-text">ReactiveCocoa Swift</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RXSwift"><span class="toc-number">8.3.</span> <span class="toc-text">RXSwift</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%AC%E6%96%87%E5%8F%82%E8%80%83%E6%95%B4%E7%90%86%E8%87%AA"><span class="toc-number">9.</span> <span class="toc-text">本文参考整理自</span></a></li></ol>
</div></main>
          <aside class="left-column">
            
            <div class="card card-author">
              
<img src="/img/ming.jpeg" class="author-img">

<p class="author-name">戴铭</p>
<p class="author-description">极客时间《iOS开发高手课》和纸书《跟戴铭学iOS编程》作者</p>
<div class="author-message">
  <a class="author-posts-count" href="/archives">
    <span>76</span>
    <span>Posts</span>
  </a>
  <a class="author-categories-count" href="/categories">
    <span>7</span>
    <span>Categories</span>
  </a>
  <a class="author-tags-count" href="/tags">
    <span>44</span>
    <span>Tags</span>
  </a>
</div>

<div class="author-card-society">
  
    <div class="author-card-society-icon">
      <a target="_blank" rel="noopener" href="https://weibo.com/allstarming">
        <i class="iconfont icon-sina society-icon"></i>
      </a>
    </div>
  
    <div class="author-card-society-icon">
      <a target="_blank" rel="noopener" href="https://github.com/ming1016">
        <i class="iconfont icon-github society-icon"></i>
      </a>
    </div>
  
    <div class="author-card-society-icon">
      <a href="mailto:ming1016@foxmail.com">
        <i class="iconfont icon-mail society-icon"></i>
      </a>
    </div>
  
    <div class="author-card-society-icon">
      <a href="/atom.xml">
        <i class="iconfont icon-chrome society-icon"></i>
      </a>
    </div>
  
</div>

            </div>
            
            <div class="sticky-tablet">
  
  
  <article class="display-when-two-columns spacer">
    <div class="card card-content toc-card">
      <div class="toc-header"><i class="iconfont icon-menu" style="padding-right: 2px;"></i>TOC</div>
<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E%E5%BC%8F%E7%BC%96%E7%A8%8B%E6%B3%9B%E5%9E%8BDeclarative-programming"><span class="toc-number">1.</span> <span class="toc-text">声明式编程泛型Declarative programming</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0"><span class="toc-number">2.</span> <span class="toc-text">高阶函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%A0%E5%B0%84map"><span class="toc-number">2.1.</span> <span class="toc-text">映射map</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4filter"><span class="toc-number">2.2.</span> <span class="toc-text">过滤filter</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%98%E5%8F%A0fold"><span class="toc-number">2.3.</span> <span class="toc-text">折叠fold</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Currying"><span class="toc-number">2.4.</span> <span class="toc-text">Currying</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RAC%E4%B8%AD%E4%BD%BF%E7%94%A8%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0"><span class="toc-number">3.</span> <span class="toc-text">RAC中使用高阶函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%A0%E5%B0%84"><span class="toc-number">3.1.</span> <span class="toc-text">映射</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4"><span class="toc-number">3.2.</span> <span class="toc-text">过滤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%98%E5%8F%A0"><span class="toc-number">3.3.</span> <span class="toc-text">折叠</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%91%E5%AE%9A%E9%94%AE%E5%80%BC"><span class="toc-number">3.4.</span> <span class="toc-text">绑定键值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E8%B7%B5"><span class="toc-number">3.5.</span> <span class="toc-text">实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E7%94%9F%E6%88%90%E5%AF%B9%E5%BA%94model"><span class="toc-number">3.5.1.</span> <span class="toc-text">网络请求生成对应model</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E7%9B%B8%E5%90%8C%E5%A4%A7%E5%B0%8F%E7%9A%84%E5%9B%BE%E7%89%87%EF%BC%8C%E5%8F%96%E5%87%BA%E4%BB%96%E4%BB%AC%E7%9A%84url%EF%BC%8C%E8%BF%94%E5%9B%9E%E7%AC%AC%E4%B8%80%E4%B8%AA"><span class="toc-number">3.5.2.</span> <span class="toc-text">过滤相同大小的图片，取出他们的url，返回第一个</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%82%E5%AF%9Fmodel%E9%87%8C%E7%9A%84%E5%9B%BE%E7%89%87%E6%95%B0%E6%8D%AE%EF%BC%8C%E8%BF%9B%E8%A1%8C%E4%B8%BA%E7%A9%BA%E8%BF%87%E6%BB%A4%E5%88%A4%E6%96%AD%EF%BC%8C%E5%B0%86data%E8%BD%AC%E4%B8%BAUIImage%EF%BC%8C%E5%86%8D%E6%8A%8A%E7%BB%91%E5%AE%9A%E6%96%B0%E4%BF%A1%E5%8F%B7%E7%9A%84%E5%80%BC%E7%BB%99%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%85%B3%E9%94%AE%E8%B7%AF%E5%BE%84"><span class="toc-number">3.5.3.</span> <span class="toc-text">观察model里的图片数据，进行为空过滤判断，将data转为UIImage，再把绑定新信号的值给对象的关键路径</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UITableViewCell%E5%A4%8D%E7%94%A8%E6%97%B6%E9%9C%80%E8%A6%81%E5%8F%96%E6%B6%88cell%E4%B8%8A%E5%90%84%E4%B8%AA%E7%BB%84%E4%BB%B6%E7%9A%84%E8%AE%A2%E9%98%85"><span class="toc-number">3.5.4.</span> <span class="toc-text">UITableViewCell复用时需要取消cell上各个组件的订阅</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Delegate%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">3.5.5.</span> <span class="toc-text">Delegate的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8%EF%BC%8C%E5%AE%8C%E6%88%90%E6%89%A7%E8%A1%8C%E5%88%B7%E6%96%B0%E6%93%8D%E4%BD%9C%EF%BC%8C%E5%BC%82%E5%B8%B8%E6%89%93%E5%8D%B0%E6%97%A5%E5%BF%97%EF%BC%8C%E6%89%A7%E8%A1%8C%E5%AF%B9%E5%BA%94%E6%96%B9%E6%B3%95"><span class="toc-number">3.5.6.</span> <span class="toc-text">处理异常，完成执行刷新操作，异常打印日志，执行对应方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86%E6%95%B0%E6%8D%AE%EF%BC%8C%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E8%BF%94%E5%9B%9E%E4%B8%BB%E7%BA%BF%E7%A8%8B"><span class="toc-number">3.5.7.</span> <span class="toc-text">网络请求处理数据，获取数据返回主线程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%A1%E5%8F%B7%E7%9A%84%E4%BF%A1%E5%8F%B7Signal-of-signals%EF%BC%8C%E4%B8%80%E4%B8%AA%E5%A4%96%E9%83%A8%E4%BF%A1%E5%8F%B7%E5%8C%85%E5%90%AB%E4%B8%80%E4%B8%AA%E5%86%85%E9%83%A8%E4%BF%A1%E5%8F%B7%EF%BC%8C%E5%9C%A8%E8%BE%93%E5%87%BA%E4%BF%A1%E5%8F%B7%E7%9A%84subscribeNext-%E5%9D%97%E4%B8%AD%E8%AE%A2%E9%98%85%E5%86%85%E9%83%A8%E4%BF%A1%E5%8F%B7%EF%BC%8C%E4%BC%9A%E5%BC%95%E8%B5%B7%E5%B5%8C%E5%A5%97%E9%BA%BB%E7%83%A6%E3%80%82%E4%BD%BF%E7%94%A8flattenMap%E5%90%8E%E4%BC%9A%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E4%BF%A1%E5%8F%B7%EF%BC%8C%E5%92%8C%E5%85%88%E5%89%8D%E4%BF%A1%E5%8F%B7%E5%B9%B3%E7%BA%A7%EF%BC%8C%E8%AE%A2%E9%98%85%E4%BC%9A%E8%AE%A2%E9%98%85%E5%88%B0%E8%BF%94%E5%9B%9E%E7%9A%84%E6%96%B0%E4%BF%A1%E5%8F%B7%E9%87%8C%E7%9A%84%E5%80%BC%E3%80%82map%E6%96%B9%E6%B3%95%E4%B9%9F%E6%98%AF%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%B0%E4%BF%A1%E5%8F%B7%EF%BC%8C%E4%BD%86%E6%98%AF%E4%BC%9A%E5%B0%86%E8%BF%94%E5%9B%9E%E7%9A%84%E4%BF%A1%E5%8F%B7%E4%B9%9F%E5%BD%93%E5%81%9A%E5%80%BC%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%B0%B1%E5%BE%97%E4%B8%8D%E5%88%B0%E7%9C%9F%E6%AD%A3%E9%9C%80%E8%A6%81%E7%9A%84%E5%80%BC%E4%BA%86%E3%80%82"><span class="toc-number">3.5.8.</span> <span class="toc-text">信号的信号Signal of signals，一个外部信号包含一个内部信号，在输出信号的subscribeNext:块中订阅内部信号，会引起嵌套麻烦。使用flattenMap后会生成一个新的信号，和先前信号平级，订阅会订阅到返回的新信号里的值。map方法也是创建一个新信号，但是会将返回的信号也当做值，这样就得不到真正需要的值了。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%90%8C%E4%BF%A1%E5%8F%B7%E9%A1%BA%E5%BA%8F%E9%93%BE%E6%8E%A5%EF%BC%8C%E7%A8%8B%E5%BA%8F%E9%9C%80%E8%A6%81%E7%AD%89%E5%BE%85%E5%89%8D%E4%B8%80%E4%B8%AA%E4%BF%A1%E5%8F%B7%E5%8F%91%E5%87%BA%E5%AE%8C%E6%88%90%E4%BA%8B%E4%BB%B6%EF%BC%88sendCompleted%EF%BC%89%EF%BC%8C%E7%84%B6%E5%90%8E%E5%86%8D%E8%AE%A2%E9%98%85%E4%B8%8B%E4%B8%80%E4%B8%AA%E4%BF%A1%E5%8F%B7%EF%BC%88then%EF%BC%89"><span class="toc-number">3.5.9.</span> <span class="toc-text">不同信号顺序链接，程序需要等待前一个信号发出完成事件（sendCompleted），然后再订阅下一个信号（then）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E5%8A%A0%E8%BD%BD%E5%9B%BE%E7%89%87"><span class="toc-number">3.5.10.</span> <span class="toc-text">异步加载图片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%82%E5%AF%9FviewModel%E9%87%8C%E7%9A%84tableView%E7%9A%84%E6%95%B0%E6%8D%AE%E9%94%AE%E5%80%BC%E5%92%8C%E5%85%A8%E9%83%A8%E8%AF%BB%E5%8F%96%E9%94%AE%E5%80%BC%EF%BC%8C%E5%8F%AA%E8%A6%81%E6%9C%89%E4%B8%80%E4%B8%AA%E6%9C%89%E6%96%B0%E5%80%BC%E5%B0%B1%E4%BC%9A%E8%B0%83%E7%94%A8"><span class="toc-number">3.5.11.</span> <span class="toc-text">观察viewModel里的tableView的数据键值和全部读取键值，只要有一个有新值就会调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85hook%E6%96%B9%E6%B3%95%EF%BC%8C%E6%9F%90%E4%B8%AAselector%E8%A2%AB%E8%B0%83%E7%94%A8%E6%97%B6%EF%BC%8C%E5%86%8D%E6%89%A7%E8%A1%8C%E4%B8%80%E6%AE%B5%E6%8C%87%E5%AE%9A%E4%BB%A3%E7%A0%81%E5%92%8Chook%E4%B8%80%E6%A0%B7%E3%80%82"><span class="toc-number">3.5.12.</span> <span class="toc-text">封装hook方法，某个selector被调用时，再执行一段指定代码和hook一样。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8RACCommand%E6%9D%A5%E5%AE%9E%E7%8E%B0%E6%8C%89%E9%92%AE%E7%9A%84%E7%8A%B6%E6%80%81%E6%A0%B9%E6%8D%AE%E8%BE%93%E5%85%A5%E9%82%AE%E7%AE%B1%E5%88%A4%E6%96%AD%E9%82%AE%E7%AE%B1%E6%98%AF%E5%90%A6%E9%9D%9E%E6%B3%95%E8%BF%98%E6%9C%89%E6%8F%90%E4%BA%A4%E5%88%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%90%8E%E5%87%BA%E9%94%99%E5%A4%84%E7%90%86%E7%AD%89"><span class="toc-number">3.5.13.</span> <span class="toc-text">使用RACCommand来实现按钮的状态根据输入邮箱判断邮箱是否非法还有提交到服务器后出错处理等</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%BF%E6%8D%A2Delegate%EF%BC%8C%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8RACSubject"><span class="toc-number">3.5.14.</span> <span class="toc-text">替换Delegate，直接使用RACSubject</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RAC%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"><span class="toc-number">4.</span> <span class="toc-text">RAC内存管理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RAC%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E5%86%85%E5%AD%98%E9%97%AE%E9%A2%98"><span class="toc-number">5.</span> <span class="toc-text">RAC需要注意的内存问题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8F%E5%AE%9A%E4%B9%89"><span class="toc-number">5.1.</span> <span class="toc-text">宏定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Subject"><span class="toc-number">5.2.</span> <span class="toc-text">Subject</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%83%AD%E4%BF%A1%E5%8F%B7%E5%86%B7%E4%BF%A1%E5%8F%B7"><span class="toc-number">6.</span> <span class="toc-text">热信号冷信号</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RAC%E7%9A%84API%E6%89%8B%E5%86%8C"><span class="toc-number">7.</span> <span class="toc-text">RAC的API手册</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%B1%BB"><span class="toc-number">7.1.</span> <span class="toc-text">常见类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RACSiganl-%E4%BF%A1%E5%8F%B7%E7%B1%BB%E3%80%82"><span class="toc-number">7.1.1.</span> <span class="toc-text">RACSiganl 信号类。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RACSubscriber-%E8%AE%A2%E9%98%85%E8%80%85"><span class="toc-number">7.1.2.</span> <span class="toc-text">RACSubscriber 订阅者</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RACDisposable-%E7%94%A8%E4%BA%8E%E5%8F%96%E6%B6%88%E8%AE%A2%E9%98%85%E6%88%96%E8%80%85%E6%B8%85%E7%90%86%E8%B5%84%E6%BA%90%EF%BC%8C%E5%BD%93%E4%BF%A1%E5%8F%B7%E5%8F%91%E9%80%81%E5%AE%8C%E6%88%90%E6%88%96%E8%80%85%E5%8F%91%E9%80%81%E9%94%99%E8%AF%AF%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E5%B0%B1%E4%BC%9A%E8%87%AA%E5%8A%A8%E8%A7%A6%E5%8F%91%E5%AE%83%E3%80%82"><span class="toc-number">7.1.3.</span> <span class="toc-text">RACDisposable 用于取消订阅或者清理资源，当信号发送完成或者发送错误的时候，就会自动触发它。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RACSubject-%E4%BF%A1%E5%8F%B7%E6%8F%90%E4%BE%9B%E8%80%85%EF%BC%8C%E8%87%AA%E5%B7%B1%E5%8F%AF%E4%BB%A5%E5%85%85%E5%BD%93%E4%BF%A1%E5%8F%B7%EF%BC%8C%E5%8F%88%E8%83%BD%E5%8F%91%E9%80%81%E4%BF%A1%E5%8F%B7%E3%80%82%E8%AE%A2%E9%98%85%E5%90%8E%E5%8F%91%E9%80%81"><span class="toc-number">7.1.4.</span> <span class="toc-text">RACSubject 信号提供者，自己可以充当信号，又能发送信号。订阅后发送</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RACTuple-%E5%85%83%E7%BB%84%E7%B1%BB-%E7%B1%BB%E4%BC%BCNSArray-%E7%94%A8%E6%9D%A5%E5%8C%85%E8%A3%85%E5%80%BC"><span class="toc-number">7.1.5.</span> <span class="toc-text">RACTuple 元组类,类似NSArray,用来包装值.</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RACSequence-RAC%E4%B8%AD%E7%9A%84%E9%9B%86%E5%90%88%E7%B1%BB"><span class="toc-number">7.1.6.</span> <span class="toc-text">RACSequence RAC中的集合类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RACCommand-RAC%E4%B8%AD%E7%94%A8%E4%BA%8E%E5%A4%84%E7%90%86%E4%BA%8B%E4%BB%B6%E7%9A%84%E7%B1%BB%EF%BC%8C%E5%8F%AF%E4%BB%A5%E6%8A%8A%E4%BA%8B%E4%BB%B6%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86-%E4%BA%8B%E4%BB%B6%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E5%A6%82%E4%BD%95%E4%BC%A0%E9%80%92%EF%BC%8C%E5%8C%85%E8%A3%85%E5%88%B0%E8%BF%99%E4%B8%AA%E7%B1%BB%E4%B8%AD%EF%BC%8C%E4%BB%96%E5%8F%AF%E4%BB%A5%E5%BE%88%E6%96%B9%E4%BE%BF%E7%9A%84%E7%9B%91%E6%8E%A7%E4%BA%8B%E4%BB%B6%E7%9A%84%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B%E3%80%82"><span class="toc-number">7.1.7.</span> <span class="toc-text">RACCommand RAC中用于处理事件的类，可以把事件如何处理,事件中的数据如何传递，包装到这个类中，他可以很方便的监控事件的执行过程。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RACMulticastConnection-%E7%94%A8%E4%BA%8E%E5%BD%93%E4%B8%80%E4%B8%AA%E4%BF%A1%E5%8F%B7%EF%BC%8C%E8%A2%AB%E5%A4%9A%E6%AC%A1%E8%AE%A2%E9%98%85%E6%97%B6%EF%BC%8C%E4%B8%BA%E4%BA%86%E4%BF%9D%E8%AF%81%E5%88%9B%E5%BB%BA%E4%BF%A1%E5%8F%B7%E6%97%B6%EF%BC%8C%E9%81%BF%E5%85%8D%E5%A4%9A%E6%AC%A1%E8%B0%83%E7%94%A8%E5%88%9B%E5%BB%BA%E4%BF%A1%E5%8F%B7%E4%B8%AD%E7%9A%84block%EF%BC%8C%E9%80%A0%E6%88%90%E5%89%AF%E4%BD%9C%E7%94%A8%EF%BC%8C%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E8%BF%99%E4%B8%AA%E7%B1%BB%E5%A4%84%E7%90%86%E3%80%82"><span class="toc-number">7.1.8.</span> <span class="toc-text">RACMulticastConnection 用于当一个信号，被多次订阅时，为了保证创建信号时，避免多次调用创建信号中的block，造成副作用，可以使用这个类处理。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RACScheduler-RAC%E4%B8%AD%E7%9A%84%E9%98%9F%E5%88%97%EF%BC%8C%E7%94%A8GCD%E5%B0%81%E8%A3%85%E7%9A%84%E3%80%82"><span class="toc-number">7.1.9.</span> <span class="toc-text">RACScheduler RAC中的队列，用GCD封装的。</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%94%A8%E6%B3%95"><span class="toc-number">7.2.</span> <span class="toc-text">常见用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E5%AE%8F"><span class="toc-number">7.3.</span> <span class="toc-text">常见宏</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C%E6%96%B9%E6%B3%95"><span class="toc-number">7.4.</span> <span class="toc-text">常用操作方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UI-Category%EF%BC%88%E5%B8%B8%E7%94%A8%E6%B1%87%E6%80%BB%EF%BC%89"><span class="toc-number">7.5.</span> <span class="toc-text">UI - Category（常用汇总）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#rac-prepareForReuseSignal%EF%BC%9A-%E9%9C%80%E8%A6%81%E5%A4%8D%E7%94%A8%E6%97%B6%E7%94%A8"><span class="toc-number">7.5.1.</span> <span class="toc-text">rac_prepareForReuseSignal： 需要复用时用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rac-buttonClickedSignal%EF%BC%9A%E7%82%B9%E5%87%BB%E4%BA%8B%E4%BB%B6%E8%A7%A6%E5%8F%91%E4%BF%A1%E5%8F%B7"><span class="toc-number">7.5.2.</span> <span class="toc-text">rac_buttonClickedSignal：点击事件触发信号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rac-command%EF%BC%9Abutton%E7%B1%BB%E3%80%81%E5%88%B7%E6%96%B0%E7%B1%BB%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4%E6%9B%BF%E6%8D%A2"><span class="toc-number">7.5.3.</span> <span class="toc-text">rac_command：button类、刷新类相关命令替换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rac-signalForControlEvents-control-event-%E8%A7%A6%E5%8F%91"><span class="toc-number">7.5.4.</span> <span class="toc-text">rac_signalForControlEvents: control event 触发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rac-gestureSignal-UIGestureRecognizer-%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E4%BF%A1%E5%8F%B7"><span class="toc-number">7.5.5.</span> <span class="toc-text">rac_gestureSignal UIGestureRecognizer 事件处理信号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rac-imageSelectedSignal-%E9%80%89%E6%8B%A9%E5%9B%BE%E7%89%87%E7%9A%84%E4%BF%A1%E5%8F%B7"><span class="toc-number">7.5.6.</span> <span class="toc-text">rac_imageSelectedSignal 选择图片的信号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rac-textSignal"><span class="toc-number">7.5.7.</span> <span class="toc-text">rac_textSignal</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E5%AE%9E%E7%8E%B0%E5%8F%8C%E5%90%91%E7%BB%91%E5%AE%9A%E7%9A%84%E7%9B%B8%E5%85%B3API"><span class="toc-number">7.5.8.</span> <span class="toc-text">可实现双向绑定的相关API</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Foundation-Category-%EF%BC%88%E5%B8%B8%E7%94%A8%E6%B1%87%E6%80%BB%EF%BC%89"><span class="toc-number">7.6.</span> <span class="toc-text">Foundation - Category （常用汇总）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#NSData"><span class="toc-number">7.6.1.</span> <span class="toc-text">NSData</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSDictionary"><span class="toc-number">7.6.2.</span> <span class="toc-text">NSDictionary</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSArray"><span class="toc-number">7.6.3.</span> <span class="toc-text">NSArray</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSFileHandle"><span class="toc-number">7.6.4.</span> <span class="toc-text">NSFileHandle</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSInvocation"><span class="toc-number">7.6.5.</span> <span class="toc-text">NSInvocation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSNotificationCenter"><span class="toc-number">7.6.6.</span> <span class="toc-text">NSNotificationCenter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSObject"><span class="toc-number">7.6.7.</span> <span class="toc-text">NSObject</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSString"><span class="toc-number">7.6.8.</span> <span class="toc-text">NSString</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSURLConnection"><span class="toc-number">7.6.9.</span> <span class="toc-text">NSURLConnection</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSUserDefaults"><span class="toc-number">7.6.10.</span> <span class="toc-text">NSUserDefaults</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSEnumerator"><span class="toc-number">7.6.11.</span> <span class="toc-text">NSEnumerator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSIndexSet"><span class="toc-number">7.6.12.</span> <span class="toc-text">NSIndexSet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSOrderedSet"><span class="toc-number">7.6.13.</span> <span class="toc-text">NSOrderedSet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSSet"><span class="toc-number">7.6.14.</span> <span class="toc-text">NSSet</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RAC%E5%9B%BE%E7%89%87%E7%89%88%E7%9A%84API%E6%89%8B%E5%86%8C"><span class="toc-number">8.</span> <span class="toc-text">RAC图片版的API手册</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ReactiveCocoa-objectivec"><span class="toc-number">8.1.</span> <span class="toc-text">ReactiveCocoa objectivec</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ReactiveCocoa-Swift"><span class="toc-number">8.2.</span> <span class="toc-text">ReactiveCocoa Swift</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RXSwift"><span class="toc-number">8.3.</span> <span class="toc-text">RXSwift</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%AC%E6%96%87%E5%8F%82%E8%80%83%E6%95%B4%E7%90%86%E8%87%AA"><span class="toc-number">9.</span> <span class="toc-text">本文参考整理自</span></a></li></ol>
    </div>
  </article>
  
  
  <article class="card card-content">
    <div class="categories-card">
  <div class="categories-header"><i class="iconfont icon-fenlei" style="padding-right: 2px;"></i>Categories</div>
  <div class="categories-list">
    
      <a href="/categories/Programming">
        <div class="categories-list-item">
          Programming
          <span class="categories-list-item-badge">49</span>
        </div>
      </a>
    
      <a href="/categories/My-novel">
        <div class="categories-list-item">
          My-novel
          <span class="categories-list-item-badge">4</span>
        </div>
      </a>
    
      <a href="/categories/My-painting">
        <div class="categories-list-item">
          My-painting
          <span class="categories-list-item-badge">8</span>
        </div>
      </a>
    
      <a href="/categories/Podcast">
        <div class="categories-list-item">
          Podcast
          <span class="categories-list-item-badge">3</span>
        </div>
      </a>
    
      <a href="/categories/App">
        <div class="categories-list-item">
          App
          <span class="categories-list-item-badge">10</span>
        </div>
      </a>
    
      <a href="/categories/travel">
        <div class="categories-list-item">
          travel
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/categories/APP">
        <div class="categories-list-item">
          APP
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
  </div>
</div>
  </article>
  
  <article class="card card-content">
    <div class="tags-card">
  <div class="tags-header"><i class="iconfont icon-biaoqian" style="padding-right: 2px;"></i>hot tags</div>
  <div class="tags-list">
    
    <a href="\tags\iOS" title="iOS"><div class="tags-list-item">iOS</div></a>
    
    <a href="\tags\Swift" title="Swift"><div class="tags-list-item">Swift</div></a>
    
    <a href="\tags\Apple" title="Apple"><div class="tags-list-item">Apple</div></a>
    
    <a href="\tags\SwiftUI" title="SwiftUI"><div class="tags-list-item">SwiftUI</div></a>
    
    <a href="\tags\Painting" title="Painting"><div class="tags-list-item">Painting</div></a>
    
    <a href="\tags\Slides" title="Slides"><div class="tags-list-item">Slides</div></a>
    
    <a href="\tags\iPad" title="iPad"><div class="tags-list-item">iPad</div></a>
    
    <a href="\tags\Procreate" title="Procreate"><div class="tags-list-item">Procreate</div></a>
    
    <a href="\tags\LLVM" title="LLVM"><div class="tags-list-item">LLVM</div></a>
    
    <a href="\tags\App" title="App"><div class="tags-list-item">App</div></a>
    
    <a href="\tags\Web" title="Web"><div class="tags-list-item">Web</div></a>
    
    <a href="\tags\Novel" title="Novel"><div class="tags-list-item">Novel</div></a>
    
    <a href="\tags\Manga" title="Manga"><div class="tags-list-item">Manga</div></a>
    
    <a href="\tags\Podcast" title="Podcast"><div class="tags-list-item">Podcast</div></a>
    
    <a href="\tags\macOS" title="macOS"><div class="tags-list-item">macOS</div></a>
    
    <a href="\tags\Performance optimization" title="Performance optimization"><div class="tags-list-item">Performance optimization</div></a>
    
  </div>
</div>
  </article>
  
  
</div>
          </aside>
          <aside class="right-column">
            <div class="sticky-widescreen">
  
  
  <article class="card card-content toc-card">
    <div class="toc-header"><i class="iconfont icon-menu" style="padding-right: 2px;"></i>TOC</div>
<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E%E5%BC%8F%E7%BC%96%E7%A8%8B%E6%B3%9B%E5%9E%8BDeclarative-programming"><span class="toc-number">1.</span> <span class="toc-text">声明式编程泛型Declarative programming</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0"><span class="toc-number">2.</span> <span class="toc-text">高阶函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%A0%E5%B0%84map"><span class="toc-number">2.1.</span> <span class="toc-text">映射map</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4filter"><span class="toc-number">2.2.</span> <span class="toc-text">过滤filter</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%98%E5%8F%A0fold"><span class="toc-number">2.3.</span> <span class="toc-text">折叠fold</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Currying"><span class="toc-number">2.4.</span> <span class="toc-text">Currying</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RAC%E4%B8%AD%E4%BD%BF%E7%94%A8%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0"><span class="toc-number">3.</span> <span class="toc-text">RAC中使用高阶函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%A0%E5%B0%84"><span class="toc-number">3.1.</span> <span class="toc-text">映射</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4"><span class="toc-number">3.2.</span> <span class="toc-text">过滤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%98%E5%8F%A0"><span class="toc-number">3.3.</span> <span class="toc-text">折叠</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%91%E5%AE%9A%E9%94%AE%E5%80%BC"><span class="toc-number">3.4.</span> <span class="toc-text">绑定键值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E8%B7%B5"><span class="toc-number">3.5.</span> <span class="toc-text">实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E7%94%9F%E6%88%90%E5%AF%B9%E5%BA%94model"><span class="toc-number">3.5.1.</span> <span class="toc-text">网络请求生成对应model</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E7%9B%B8%E5%90%8C%E5%A4%A7%E5%B0%8F%E7%9A%84%E5%9B%BE%E7%89%87%EF%BC%8C%E5%8F%96%E5%87%BA%E4%BB%96%E4%BB%AC%E7%9A%84url%EF%BC%8C%E8%BF%94%E5%9B%9E%E7%AC%AC%E4%B8%80%E4%B8%AA"><span class="toc-number">3.5.2.</span> <span class="toc-text">过滤相同大小的图片，取出他们的url，返回第一个</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%82%E5%AF%9Fmodel%E9%87%8C%E7%9A%84%E5%9B%BE%E7%89%87%E6%95%B0%E6%8D%AE%EF%BC%8C%E8%BF%9B%E8%A1%8C%E4%B8%BA%E7%A9%BA%E8%BF%87%E6%BB%A4%E5%88%A4%E6%96%AD%EF%BC%8C%E5%B0%86data%E8%BD%AC%E4%B8%BAUIImage%EF%BC%8C%E5%86%8D%E6%8A%8A%E7%BB%91%E5%AE%9A%E6%96%B0%E4%BF%A1%E5%8F%B7%E7%9A%84%E5%80%BC%E7%BB%99%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%85%B3%E9%94%AE%E8%B7%AF%E5%BE%84"><span class="toc-number">3.5.3.</span> <span class="toc-text">观察model里的图片数据，进行为空过滤判断，将data转为UIImage，再把绑定新信号的值给对象的关键路径</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UITableViewCell%E5%A4%8D%E7%94%A8%E6%97%B6%E9%9C%80%E8%A6%81%E5%8F%96%E6%B6%88cell%E4%B8%8A%E5%90%84%E4%B8%AA%E7%BB%84%E4%BB%B6%E7%9A%84%E8%AE%A2%E9%98%85"><span class="toc-number">3.5.4.</span> <span class="toc-text">UITableViewCell复用时需要取消cell上各个组件的订阅</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Delegate%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">3.5.5.</span> <span class="toc-text">Delegate的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8%EF%BC%8C%E5%AE%8C%E6%88%90%E6%89%A7%E8%A1%8C%E5%88%B7%E6%96%B0%E6%93%8D%E4%BD%9C%EF%BC%8C%E5%BC%82%E5%B8%B8%E6%89%93%E5%8D%B0%E6%97%A5%E5%BF%97%EF%BC%8C%E6%89%A7%E8%A1%8C%E5%AF%B9%E5%BA%94%E6%96%B9%E6%B3%95"><span class="toc-number">3.5.6.</span> <span class="toc-text">处理异常，完成执行刷新操作，异常打印日志，执行对应方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86%E6%95%B0%E6%8D%AE%EF%BC%8C%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E8%BF%94%E5%9B%9E%E4%B8%BB%E7%BA%BF%E7%A8%8B"><span class="toc-number">3.5.7.</span> <span class="toc-text">网络请求处理数据，获取数据返回主线程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%A1%E5%8F%B7%E7%9A%84%E4%BF%A1%E5%8F%B7Signal-of-signals%EF%BC%8C%E4%B8%80%E4%B8%AA%E5%A4%96%E9%83%A8%E4%BF%A1%E5%8F%B7%E5%8C%85%E5%90%AB%E4%B8%80%E4%B8%AA%E5%86%85%E9%83%A8%E4%BF%A1%E5%8F%B7%EF%BC%8C%E5%9C%A8%E8%BE%93%E5%87%BA%E4%BF%A1%E5%8F%B7%E7%9A%84subscribeNext-%E5%9D%97%E4%B8%AD%E8%AE%A2%E9%98%85%E5%86%85%E9%83%A8%E4%BF%A1%E5%8F%B7%EF%BC%8C%E4%BC%9A%E5%BC%95%E8%B5%B7%E5%B5%8C%E5%A5%97%E9%BA%BB%E7%83%A6%E3%80%82%E4%BD%BF%E7%94%A8flattenMap%E5%90%8E%E4%BC%9A%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E4%BF%A1%E5%8F%B7%EF%BC%8C%E5%92%8C%E5%85%88%E5%89%8D%E4%BF%A1%E5%8F%B7%E5%B9%B3%E7%BA%A7%EF%BC%8C%E8%AE%A2%E9%98%85%E4%BC%9A%E8%AE%A2%E9%98%85%E5%88%B0%E8%BF%94%E5%9B%9E%E7%9A%84%E6%96%B0%E4%BF%A1%E5%8F%B7%E9%87%8C%E7%9A%84%E5%80%BC%E3%80%82map%E6%96%B9%E6%B3%95%E4%B9%9F%E6%98%AF%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%B0%E4%BF%A1%E5%8F%B7%EF%BC%8C%E4%BD%86%E6%98%AF%E4%BC%9A%E5%B0%86%E8%BF%94%E5%9B%9E%E7%9A%84%E4%BF%A1%E5%8F%B7%E4%B9%9F%E5%BD%93%E5%81%9A%E5%80%BC%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%B0%B1%E5%BE%97%E4%B8%8D%E5%88%B0%E7%9C%9F%E6%AD%A3%E9%9C%80%E8%A6%81%E7%9A%84%E5%80%BC%E4%BA%86%E3%80%82"><span class="toc-number">3.5.8.</span> <span class="toc-text">信号的信号Signal of signals，一个外部信号包含一个内部信号，在输出信号的subscribeNext:块中订阅内部信号，会引起嵌套麻烦。使用flattenMap后会生成一个新的信号，和先前信号平级，订阅会订阅到返回的新信号里的值。map方法也是创建一个新信号，但是会将返回的信号也当做值，这样就得不到真正需要的值了。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%90%8C%E4%BF%A1%E5%8F%B7%E9%A1%BA%E5%BA%8F%E9%93%BE%E6%8E%A5%EF%BC%8C%E7%A8%8B%E5%BA%8F%E9%9C%80%E8%A6%81%E7%AD%89%E5%BE%85%E5%89%8D%E4%B8%80%E4%B8%AA%E4%BF%A1%E5%8F%B7%E5%8F%91%E5%87%BA%E5%AE%8C%E6%88%90%E4%BA%8B%E4%BB%B6%EF%BC%88sendCompleted%EF%BC%89%EF%BC%8C%E7%84%B6%E5%90%8E%E5%86%8D%E8%AE%A2%E9%98%85%E4%B8%8B%E4%B8%80%E4%B8%AA%E4%BF%A1%E5%8F%B7%EF%BC%88then%EF%BC%89"><span class="toc-number">3.5.9.</span> <span class="toc-text">不同信号顺序链接，程序需要等待前一个信号发出完成事件（sendCompleted），然后再订阅下一个信号（then）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E5%8A%A0%E8%BD%BD%E5%9B%BE%E7%89%87"><span class="toc-number">3.5.10.</span> <span class="toc-text">异步加载图片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%82%E5%AF%9FviewModel%E9%87%8C%E7%9A%84tableView%E7%9A%84%E6%95%B0%E6%8D%AE%E9%94%AE%E5%80%BC%E5%92%8C%E5%85%A8%E9%83%A8%E8%AF%BB%E5%8F%96%E9%94%AE%E5%80%BC%EF%BC%8C%E5%8F%AA%E8%A6%81%E6%9C%89%E4%B8%80%E4%B8%AA%E6%9C%89%E6%96%B0%E5%80%BC%E5%B0%B1%E4%BC%9A%E8%B0%83%E7%94%A8"><span class="toc-number">3.5.11.</span> <span class="toc-text">观察viewModel里的tableView的数据键值和全部读取键值，只要有一个有新值就会调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85hook%E6%96%B9%E6%B3%95%EF%BC%8C%E6%9F%90%E4%B8%AAselector%E8%A2%AB%E8%B0%83%E7%94%A8%E6%97%B6%EF%BC%8C%E5%86%8D%E6%89%A7%E8%A1%8C%E4%B8%80%E6%AE%B5%E6%8C%87%E5%AE%9A%E4%BB%A3%E7%A0%81%E5%92%8Chook%E4%B8%80%E6%A0%B7%E3%80%82"><span class="toc-number">3.5.12.</span> <span class="toc-text">封装hook方法，某个selector被调用时，再执行一段指定代码和hook一样。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8RACCommand%E6%9D%A5%E5%AE%9E%E7%8E%B0%E6%8C%89%E9%92%AE%E7%9A%84%E7%8A%B6%E6%80%81%E6%A0%B9%E6%8D%AE%E8%BE%93%E5%85%A5%E9%82%AE%E7%AE%B1%E5%88%A4%E6%96%AD%E9%82%AE%E7%AE%B1%E6%98%AF%E5%90%A6%E9%9D%9E%E6%B3%95%E8%BF%98%E6%9C%89%E6%8F%90%E4%BA%A4%E5%88%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%90%8E%E5%87%BA%E9%94%99%E5%A4%84%E7%90%86%E7%AD%89"><span class="toc-number">3.5.13.</span> <span class="toc-text">使用RACCommand来实现按钮的状态根据输入邮箱判断邮箱是否非法还有提交到服务器后出错处理等</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%BF%E6%8D%A2Delegate%EF%BC%8C%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8RACSubject"><span class="toc-number">3.5.14.</span> <span class="toc-text">替换Delegate，直接使用RACSubject</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RAC%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"><span class="toc-number">4.</span> <span class="toc-text">RAC内存管理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RAC%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E5%86%85%E5%AD%98%E9%97%AE%E9%A2%98"><span class="toc-number">5.</span> <span class="toc-text">RAC需要注意的内存问题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8F%E5%AE%9A%E4%B9%89"><span class="toc-number">5.1.</span> <span class="toc-text">宏定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Subject"><span class="toc-number">5.2.</span> <span class="toc-text">Subject</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%83%AD%E4%BF%A1%E5%8F%B7%E5%86%B7%E4%BF%A1%E5%8F%B7"><span class="toc-number">6.</span> <span class="toc-text">热信号冷信号</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RAC%E7%9A%84API%E6%89%8B%E5%86%8C"><span class="toc-number">7.</span> <span class="toc-text">RAC的API手册</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%B1%BB"><span class="toc-number">7.1.</span> <span class="toc-text">常见类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RACSiganl-%E4%BF%A1%E5%8F%B7%E7%B1%BB%E3%80%82"><span class="toc-number">7.1.1.</span> <span class="toc-text">RACSiganl 信号类。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RACSubscriber-%E8%AE%A2%E9%98%85%E8%80%85"><span class="toc-number">7.1.2.</span> <span class="toc-text">RACSubscriber 订阅者</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RACDisposable-%E7%94%A8%E4%BA%8E%E5%8F%96%E6%B6%88%E8%AE%A2%E9%98%85%E6%88%96%E8%80%85%E6%B8%85%E7%90%86%E8%B5%84%E6%BA%90%EF%BC%8C%E5%BD%93%E4%BF%A1%E5%8F%B7%E5%8F%91%E9%80%81%E5%AE%8C%E6%88%90%E6%88%96%E8%80%85%E5%8F%91%E9%80%81%E9%94%99%E8%AF%AF%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E5%B0%B1%E4%BC%9A%E8%87%AA%E5%8A%A8%E8%A7%A6%E5%8F%91%E5%AE%83%E3%80%82"><span class="toc-number">7.1.3.</span> <span class="toc-text">RACDisposable 用于取消订阅或者清理资源，当信号发送完成或者发送错误的时候，就会自动触发它。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RACSubject-%E4%BF%A1%E5%8F%B7%E6%8F%90%E4%BE%9B%E8%80%85%EF%BC%8C%E8%87%AA%E5%B7%B1%E5%8F%AF%E4%BB%A5%E5%85%85%E5%BD%93%E4%BF%A1%E5%8F%B7%EF%BC%8C%E5%8F%88%E8%83%BD%E5%8F%91%E9%80%81%E4%BF%A1%E5%8F%B7%E3%80%82%E8%AE%A2%E9%98%85%E5%90%8E%E5%8F%91%E9%80%81"><span class="toc-number">7.1.4.</span> <span class="toc-text">RACSubject 信号提供者，自己可以充当信号，又能发送信号。订阅后发送</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RACTuple-%E5%85%83%E7%BB%84%E7%B1%BB-%E7%B1%BB%E4%BC%BCNSArray-%E7%94%A8%E6%9D%A5%E5%8C%85%E8%A3%85%E5%80%BC"><span class="toc-number">7.1.5.</span> <span class="toc-text">RACTuple 元组类,类似NSArray,用来包装值.</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RACSequence-RAC%E4%B8%AD%E7%9A%84%E9%9B%86%E5%90%88%E7%B1%BB"><span class="toc-number">7.1.6.</span> <span class="toc-text">RACSequence RAC中的集合类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RACCommand-RAC%E4%B8%AD%E7%94%A8%E4%BA%8E%E5%A4%84%E7%90%86%E4%BA%8B%E4%BB%B6%E7%9A%84%E7%B1%BB%EF%BC%8C%E5%8F%AF%E4%BB%A5%E6%8A%8A%E4%BA%8B%E4%BB%B6%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86-%E4%BA%8B%E4%BB%B6%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E5%A6%82%E4%BD%95%E4%BC%A0%E9%80%92%EF%BC%8C%E5%8C%85%E8%A3%85%E5%88%B0%E8%BF%99%E4%B8%AA%E7%B1%BB%E4%B8%AD%EF%BC%8C%E4%BB%96%E5%8F%AF%E4%BB%A5%E5%BE%88%E6%96%B9%E4%BE%BF%E7%9A%84%E7%9B%91%E6%8E%A7%E4%BA%8B%E4%BB%B6%E7%9A%84%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B%E3%80%82"><span class="toc-number">7.1.7.</span> <span class="toc-text">RACCommand RAC中用于处理事件的类，可以把事件如何处理,事件中的数据如何传递，包装到这个类中，他可以很方便的监控事件的执行过程。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RACMulticastConnection-%E7%94%A8%E4%BA%8E%E5%BD%93%E4%B8%80%E4%B8%AA%E4%BF%A1%E5%8F%B7%EF%BC%8C%E8%A2%AB%E5%A4%9A%E6%AC%A1%E8%AE%A2%E9%98%85%E6%97%B6%EF%BC%8C%E4%B8%BA%E4%BA%86%E4%BF%9D%E8%AF%81%E5%88%9B%E5%BB%BA%E4%BF%A1%E5%8F%B7%E6%97%B6%EF%BC%8C%E9%81%BF%E5%85%8D%E5%A4%9A%E6%AC%A1%E8%B0%83%E7%94%A8%E5%88%9B%E5%BB%BA%E4%BF%A1%E5%8F%B7%E4%B8%AD%E7%9A%84block%EF%BC%8C%E9%80%A0%E6%88%90%E5%89%AF%E4%BD%9C%E7%94%A8%EF%BC%8C%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E8%BF%99%E4%B8%AA%E7%B1%BB%E5%A4%84%E7%90%86%E3%80%82"><span class="toc-number">7.1.8.</span> <span class="toc-text">RACMulticastConnection 用于当一个信号，被多次订阅时，为了保证创建信号时，避免多次调用创建信号中的block，造成副作用，可以使用这个类处理。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RACScheduler-RAC%E4%B8%AD%E7%9A%84%E9%98%9F%E5%88%97%EF%BC%8C%E7%94%A8GCD%E5%B0%81%E8%A3%85%E7%9A%84%E3%80%82"><span class="toc-number">7.1.9.</span> <span class="toc-text">RACScheduler RAC中的队列，用GCD封装的。</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%94%A8%E6%B3%95"><span class="toc-number">7.2.</span> <span class="toc-text">常见用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E5%AE%8F"><span class="toc-number">7.3.</span> <span class="toc-text">常见宏</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C%E6%96%B9%E6%B3%95"><span class="toc-number">7.4.</span> <span class="toc-text">常用操作方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UI-Category%EF%BC%88%E5%B8%B8%E7%94%A8%E6%B1%87%E6%80%BB%EF%BC%89"><span class="toc-number">7.5.</span> <span class="toc-text">UI - Category（常用汇总）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#rac-prepareForReuseSignal%EF%BC%9A-%E9%9C%80%E8%A6%81%E5%A4%8D%E7%94%A8%E6%97%B6%E7%94%A8"><span class="toc-number">7.5.1.</span> <span class="toc-text">rac_prepareForReuseSignal： 需要复用时用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rac-buttonClickedSignal%EF%BC%9A%E7%82%B9%E5%87%BB%E4%BA%8B%E4%BB%B6%E8%A7%A6%E5%8F%91%E4%BF%A1%E5%8F%B7"><span class="toc-number">7.5.2.</span> <span class="toc-text">rac_buttonClickedSignal：点击事件触发信号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rac-command%EF%BC%9Abutton%E7%B1%BB%E3%80%81%E5%88%B7%E6%96%B0%E7%B1%BB%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4%E6%9B%BF%E6%8D%A2"><span class="toc-number">7.5.3.</span> <span class="toc-text">rac_command：button类、刷新类相关命令替换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rac-signalForControlEvents-control-event-%E8%A7%A6%E5%8F%91"><span class="toc-number">7.5.4.</span> <span class="toc-text">rac_signalForControlEvents: control event 触发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rac-gestureSignal-UIGestureRecognizer-%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E4%BF%A1%E5%8F%B7"><span class="toc-number">7.5.5.</span> <span class="toc-text">rac_gestureSignal UIGestureRecognizer 事件处理信号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rac-imageSelectedSignal-%E9%80%89%E6%8B%A9%E5%9B%BE%E7%89%87%E7%9A%84%E4%BF%A1%E5%8F%B7"><span class="toc-number">7.5.6.</span> <span class="toc-text">rac_imageSelectedSignal 选择图片的信号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rac-textSignal"><span class="toc-number">7.5.7.</span> <span class="toc-text">rac_textSignal</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E5%AE%9E%E7%8E%B0%E5%8F%8C%E5%90%91%E7%BB%91%E5%AE%9A%E7%9A%84%E7%9B%B8%E5%85%B3API"><span class="toc-number">7.5.8.</span> <span class="toc-text">可实现双向绑定的相关API</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Foundation-Category-%EF%BC%88%E5%B8%B8%E7%94%A8%E6%B1%87%E6%80%BB%EF%BC%89"><span class="toc-number">7.6.</span> <span class="toc-text">Foundation - Category （常用汇总）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#NSData"><span class="toc-number">7.6.1.</span> <span class="toc-text">NSData</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSDictionary"><span class="toc-number">7.6.2.</span> <span class="toc-text">NSDictionary</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSArray"><span class="toc-number">7.6.3.</span> <span class="toc-text">NSArray</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSFileHandle"><span class="toc-number">7.6.4.</span> <span class="toc-text">NSFileHandle</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSInvocation"><span class="toc-number">7.6.5.</span> <span class="toc-text">NSInvocation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSNotificationCenter"><span class="toc-number">7.6.6.</span> <span class="toc-text">NSNotificationCenter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSObject"><span class="toc-number">7.6.7.</span> <span class="toc-text">NSObject</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSString"><span class="toc-number">7.6.8.</span> <span class="toc-text">NSString</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSURLConnection"><span class="toc-number">7.6.9.</span> <span class="toc-text">NSURLConnection</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSUserDefaults"><span class="toc-number">7.6.10.</span> <span class="toc-text">NSUserDefaults</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSEnumerator"><span class="toc-number">7.6.11.</span> <span class="toc-text">NSEnumerator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSIndexSet"><span class="toc-number">7.6.12.</span> <span class="toc-text">NSIndexSet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSOrderedSet"><span class="toc-number">7.6.13.</span> <span class="toc-text">NSOrderedSet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSSet"><span class="toc-number">7.6.14.</span> <span class="toc-text">NSSet</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RAC%E5%9B%BE%E7%89%87%E7%89%88%E7%9A%84API%E6%89%8B%E5%86%8C"><span class="toc-number">8.</span> <span class="toc-text">RAC图片版的API手册</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ReactiveCocoa-objectivec"><span class="toc-number">8.1.</span> <span class="toc-text">ReactiveCocoa objectivec</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ReactiveCocoa-Swift"><span class="toc-number">8.2.</span> <span class="toc-text">ReactiveCocoa Swift</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RXSwift"><span class="toc-number">8.3.</span> <span class="toc-text">RXSwift</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%AC%E6%96%87%E5%8F%82%E8%80%83%E6%95%B4%E7%90%86%E8%87%AA"><span class="toc-number">9.</span> <span class="toc-text">本文参考整理自</span></a></li></ol>
  </article>
  
  
  <article class="card card-content">
    <div class="recent-posts-card">
  <div class="recent-posts-header"><i class="iconfont icon-wenzhang_huaban" style="padding-right: 2px;"></i>Recent Posts</div>
  <div class="recent-posts-list">
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2024-11-04</div>
        <a href="/2024/11/04/introduction-japanese-colors/"><div class="recent-posts-item-content">全网最全的日本传统颜色指南，看完你会更懂日本</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2024-10-28</div>
        <a href="/2024/10/28/kwdc24-in-seoul/"><div class="recent-posts-item-content">我在韩国首尔 KWDC24 做的技术分享</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2024-09-12</div>
        <a href="/2024/09/12/my-pkm/"><div class="recent-posts-item-content">我是怎么做个人知识管理（PKM）的，从史前时代备忘录、Sublime，经历了Evernote，Markdown兴起，Bear的优雅，Notion革命，飞书语雀，Obsidian、Flomo，到最后使用卢曼卡片盒笔记法串起了流程</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2024-09-05</div>
        <a href="/2024/09/05/iOS-performance-optimization-second-time/"><div class="recent-posts-item-content">二刷 iOS 性能与编译，简单点说</div></a>
      </div>
    
  </div>
</div>
  </article>
  
  
</div>
          </aside>
        </div>
      </div>
    </div>
  </div>
  
  <footer class="footer">
  <div class="footer-container">
    <div>
      <div class="footer-dsc">
        <span>Copyright ©
          
          2014 -
          
          2024
        </span>
        <a href="/" class="footer-link">戴铭的博客 </a>
      </div>
    </div>

    
    
    
    <div class="BbeiAn-info">
      <a target="_blank" rel="noopener" href="http://www.beian.miit.gov.cn/">京ICP备2024068292号-1 </a>
    </div>
    
    <div class="BbeiAn-info">
      <span style="padding-left: 25px;background: url(/img/beian.png) no-repeat left center"></span>
      <a target="_blank" rel="noopener" href="https://beian.mps.gov.cn/#/query/webSearch?code=11010802044427 ">京公网安备11010802044427
      </a>
      <br />
    </div>
    
    
    
      <div class="footer-dsc">
        
        本站总访问量<span id="busuanzi_value_site_pv"></span>次
        
        
        <span>&nbsp;|&nbsp;</span>
        
        
        本站总访客数<span id="busuanzi_value_site_uv"></span>次
        
      </div>
      
    
</footer>
  <a role="button" id="scrollbutton" class="basebutton" >
  <i class="iconfont icon-arrowleft button-icon"></i>
</a>
<a role="button" id="menubutton" class="basebutton">
  <i class="iconfont icon-menu button-icon"></i>
</a>
<a role="button" id="popbutton" class="basebutton">
  <i class="iconfont icon-expand button-icon"></i>
</a>
<a role="button" id="darkbutton" class="basebutton darkwidget">
  <i class="iconfont icon-weather button-icon"></i>
</a>

  
  
  
  <script>
  var addImgLayout = function () {
    var img = document.querySelectorAll('.post-content img');
    var i;
    for (i = 0; i < img.length; i++) {
      var wrapper = document.createElement('a');
      wrapper.setAttribute('data-fslightbox', 'gallery');
      wrapper.setAttribute('href', img[i].getAttribute('data-src'));
      wrapper.setAttribute('style', 'width: 100%; display: flex; justify-content: center;');
      img[i].parentElement.insertBefore(wrapper, img[i]);
      wrapper.appendChild(img[i]);
    }
    refreshFsLightbox();
  }
</script>
<script>loadScript("//cdn.jsdelivr.net/npm/fslightbox@3.1.0/index.min.js", addImgLayout)</script>
  
  
  
<script src="/js/main.js"></script>

  
  <script>loadScript("/js/lib/busuanzi.min.js")</script>
  
  
  <script>
    var addLazyload = function () {
      var observer = lozad('.lozad', {
        load: function (el) {
          el.srcset = el.getAttribute('data-src');
        },
        loaded: function (el) {
          el.classList.add('loaded');
        }
      });
      observer.observe();
    }
  </script>
  <script>loadScript("/js/lib/lozad.min.js", addLazyload)</script>
  
  
</body>

</html>